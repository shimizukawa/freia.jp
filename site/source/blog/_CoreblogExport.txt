:id: 1
:date: 2004-04-19 23:16:36
:title: Martin Fowler夫妻とGregor Hohpe氏を囲む会
:categories: ['Agile(XP)', 'Event']
:body type: text/structured
:body:
XPユーザー会に参加してきました。今回はMartin Fowler氏の来日にあわせて開催されたため月曜日の開催だったり、セミナーではなく食事をしながら話を聞く形式だったりと、 前回とは少々趣が異なりました。



:extend type: text/plain
:extend:
会の中でQ&amp;Aがあり、Fowler氏は次のようなことを言っていました。（自分に関係の有りそうな部分のみ抜粋）<br>
<br>
Q: 週40時間労働というプラクティスがありますが、氏はどれくらい働いていますか？<br>
A: 自宅にいるときは、妻がガーデニングを終える頃、つまり日が沈んでから30分後くらいまで働いています。でも仕事以外の時間で本を書いたりしているので私の例は余り参考にならないかもしれません。<br>
<br>
Q: 氏は、作業の効率は図ることが出来ないとおっしゃっていますが、では発注元はなにを基準にソフトベンダーを選択したらいいのでしょうか？<br>
A: まず作業効率を定量化することは出来ません。なぜなら、作業全体には不確定な要素が多数入り込むからです。だから効率以外のものを基準として選択するしかないでしょう。みなさんでそう言う基準を探して形式化するのも面白いと思います。ただ、作業効率のように定量化出来ないものを無理矢理定量化して形式を作っても悪い方向にしか進みません。その点は注意してください。
<br>
<br>
Q: MDAについてどう思いますか？<br>
A: MDAのように最初からモデルを完成させて開発を行うという事が現実的とは思えません。やはり考えながらコードを書いて次第に完成していくものだと思います。ただ、UMLのような共通の言語でサッとモデルを書いて意志を伝えることは大事だと思います。しかし、UML2.0はMDAと密接な関係になってしまって、動作するモデルを書くために文法が厳密になってしまっています。サッと書くことが出来ない方向に進んでしまっていることは残念です。<br>
<br>
Q: XPのプラクティスを広めるにはどうしたらいいでしょう？<br>
A: まず実践することです。たとえばTDDなら、まずやって見せて、一緒にコードを書きながら開発とテストのサイクルを実践してみせることです。自分の会社でもそんな風に広めていって、今ではXPのプラクティスが社内で普通に使われています。<br>
<br>
‥‥<br>
<br>
最近、仕事でプラットフォームのアーキテクチャ設計というのをやっていたりするけど、机上でシーケンスをいじり倒していても、どこまでいっても「おそらく」「だろう」という感じになってしまっている。いつまでも空論してないで実際に実験コードを書いた方がよっぽど話が早いとおもうけど、プラットフォームを構築するためのOS側の仕様がまだ確定していないため全て無駄になるんじゃないかという恐れがあるから踏み込めないでいるんだと思う。<br>
<br>
今日のユーザー会でFowler氏の(MDA周りの)話を聞いて、そんな泥沼状態から脱して行こうと思った。
<br>
<br>
ことろで、今回のユーザー会はMicrosoft協賛らしく、本を2冊ももらってしまった。Microsoft最高！

- Microsoft .NETによるエンタープライズソリューションパターン（非売品）

- Object ***** (なんだっけ‥‥)



%%%%%%%%%

:id: 2
:date: 2004-04-20 22:00:00
:title: パターン勉強会
:categories: ['Pattern', 'Event']
:body type: text/structured
:body:
<a href="http://patterns-wg.fuka.info.waseda.ac.jp/ps2004.html" >http://patterns-wg.fuka.info.waseda.ac.jp/ps2004.html</a><br>
行ってきました。
Reusable Asset Specification と Enterprise Integration Patterns のお話だったのですが、前提知識が少なかったためあまり内容を把握できませんでした。日本語ならまだ分かったかもしれませんが‥‥やっぱり英会話の勉強しないと。<br>
<br>
Enterprise Integration Patterns の方は面白そうだし、ちゃんと読めば分かる内容の様な感じだったので、配付資料をゆっくり読んでみようと思います。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 3
:date: 2004-04-20 23:00:00
:title: 英語の勉強
:categories: ['misc']
:body type: text/structured
:body:
NHK教育の<a href="http://www.nhk.or.jp/100go/">100語でスタート！英会話</a>と<a href="http://www.nhk.or.jp/nhk-text/01_eigo/19245042004.html">実践 ビジネス英会話</a>を録画しまくってます。こういうときPSX便利だなーと思います。<br>
<br>
実践 ビジネス英会話 は講師が本間正人さんでした。本間さんの著書<a href="http://www.amazon.co.jp/exec/obidos/ASIN/4569576443">ケーススタディで学ぶ「コーチング」に強くなる本</a>は良書でした。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 4
:date: 2004-04-20 23:30:00
:title: COREBlogのStructuredText
:categories: ['Zope', 'misc']
:body type: text/structured
:body:
ところで、COREBlogのStructuredTextがよく分かりません。URLリンクの指定の仕方とか、普通のStructuredTextと違うんでしょうか？<br>
<br>
仕方がないので今はStructuredTextの中にbrとかhrefとか書いてます。めんどくさいなぁ。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4224109314
:title: Re: COREBlogのStructuredText
:author: aihatena
:date: 2004-04-21 18:48:37
:email: 
:url: 
:body:
こうすんでない?


:comments:
:comment id: 2005-11-28.4226095038
:title: Re: COREBlogのStructuredText
:author: 清水川
:date: 2004-04-21 18:58:25
:email: taka@freia.jp
:url: 
:body:
"google"なら良いんだけど、"日本語"だとダメみたい。日本語のパースがうまくいってないな‥‥日本語関連のライブラリいじったから？


:comments:
:comment id: 2005-11-28.4227418385
:title: Re: COREBlogのStructuredText
:author: aihatena
:date: 2004-04-21 19:21:47
:email: 
:url: 
:body:
ふむむ。。
あと Entry.py で

#Formats
format_plain = 0
format_stx = 1
format_html = 3
format_wiki = 2

なのに EntryPage ではWikiが無いのはなんでだろ。




:comments:
:comment id: 2005-11-28.4229127086
:title: Re: COREBlogのStructuredText
:author: 清水川
:date: 2004-04-22 09:28:28
:email: taka@freia.jp
:url: 
:body:
SettingFormに0,1,2しかoptionを書いてないからですね。理由は不明だけど。



:comments:
:comment id: 2005-11-28.4230396370
:title: Re: COREBlogのStructuredText
:author: の
:date: 2004-05-20 11:01:20
:email: 
:url: 
:body:
今更かもしれませんが、StructuredText で日本語が扱えないのは、 Zope の StructuredText の実装が腐ってるせいです（＾＾；


このへん参照。
多分2.7でもまだ直ってない。

2.7だとReStructuredTextが標準で入ったようだけど、そっちだとたしょうはましなのかな?
使ったことないからわかんないや


:comments:
:comment id: 2005-11-28.4231705946
:title: Re: COREBlogのStructuredText
:author: 清水川
:date: 2004-05-20 14:31:15
:email: taka@freia.jp
:url: 
:body:
情報ありがとうございます～。
おかげさまで、パッチを当てたら直りました。

パッチは以下のURLのを使いました。

頂いたURLで語られている状態よりはなんぼかましになっているみたいですが、2.6→2.7では全く変わっていないようです。（おかげでパッチがそのまま適用できましたが‥‥）

reStructuredText については日本語で不自由した事は‥‥ちょっとあります(^^  

UTF-8を使っていると日本語の全角文字も1文字として数えてくれるのは良いのですが、テーブルを作るために列あわせをするときに半角・全角とも１文字で数えちゃうんですよね。これはZope-mlで相談したらパッチを作ってもらえました。

%%%%%%%%%

:id: 5
:date: 2004-04-21 19:06:46
:title: 日本語の問題
:categories: ['Zope']
:body type: text/structured
:body:
COREblogで、UTF8表示に設定しているのにHTTPレスポンスヘッダーに8859-1とか出しているっぽいので、しかたなく blog_header の先頭に以下を追加::

  dtml-call "RESPONSE.setHeader('Content-Type','text/html;charset=utf-8')"

邪道だなぁ。

そして、ハイパーリンクの対象となる文字列に日本語を使うと、 &quot;俺サーバー&quot;:http://www.freia.jp/ となってしまうことが判明。 なんでだろ？



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 6
:date: 2004-04-21 23:17:01
:title: PSXが生産休止！？
:categories: ['misc']
:body type: text/structured
:body:
PSXが生産休止らしく。まだ確定はしてないみたいですが。

とりあえず、時々ハングアップするのさえ直ってくれれば、休止しようが何しようが個人的には満足な買い物だったと思います。あ、あとビットレート変換ダビング機能を‥‥（スゴ録と棲み分けられなくなるから無理か）

ところで、ハングアップのタイミングがファームウェアアップデート毎に変わるというのはどういうこと？（きっとモグラたたき現象なんだろうなぁと思いつつ‥‥）

元記事："http://blog.livedoor.jp/takeshi_a/archives/368485.html":http://blog.livedoor.jp/takeshi_a/archives/368485.html


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 7
:date: 2004-04-23 23:54:44
:title: COREblogにおける日本語の問題
:categories: ['Zope', 'Memo']
:body type: text/structured
:body:
"COREblog":http://coreblog.org/ は標準では検索機能が使えません。"HowTo":http://coreblog.org/howtos/ に使えるようにするための手順は載っていますが、それだけでは日本語の検索がうまくいきません。原因はパーサーが日本語をパース出来ないところにあります。（自分の環境固有の話かもしれませんが‥‥）


:extend type: text/plain
:extend:
そこで、"mojix":http://mojix.org/ 氏作の"MJSplitter":http://zope.org/Members/mojix/MJSplitter/ を導入します。このプロタクトは、形態素解析器"MeCab":http://chasen.aist-nara.ac.jp/~taku/software/mecab/ を用いて日本語を解析し、カタログ化するZCTextIndexのパーサーとして機能します。

"MJSplitter":http://zope.org/Members/mojix/MJSplitter/ を手順に従ってインストールすると、ZCTextIndexのWord SplitterとしてMJSplistterを選択できるようになります。COREblogフォルダのcontentsタブでlexiconオブジェクトを削除して、lexiconという名前でZCTextIndexを追加後、EntryタブでRecatalogすると日本語を含むカタログが生成されます。

自分の環境は以下ような感じです。

- UTF-8

- "Zope2.7.0":http://zope.org/Products/Zope/2.7.0

- "COREblog0.61b":http://coreblog.org/

- "MeCab0.76":http://chasen.aist-nara.ac.jp/~taku/software/mecab/src/

- "ipadic2.5.1":http://chasen.aist-nara.ac.jp/stable/ipadic/

- "MeCab-python-bindings0.76":http://chasen.aist-nara.ac.jp/~taku/software/mecab/bindings/

- "JapaneseCodec1.4.10":http://www.python.jp/pub/JapaneseCodecs/JapaneseCodecs-1.4.10.tar.gz


%%%%%%%%%

:id: 8
:date: 2004-04-24 15:31:52
:title: ZWikiがiso-8859-1で表示される問題
:categories: ['Zope', 'Memo']
:body type: text/structured
:body:
自分はWebサイトをUTF-8で構築しているのですが、なぜかZWikiのページだけがiso-8859-1で表示されてしまっていました。ソースを表示してみると、metaタグでちゃんとcharset=utf-8と書いてあるのですが、パケットキャプチャーしてみたところ、ResponseHeaderに::

  Content-Type: text/html; charset=iso-8859-1

の１行が。


:extend type: text/plain
:extend:
OperaはmetaタグよりもResponseHeaderを優先するので、Operaユーザーとしては見過ごせません。というかResponseHeaderとmetaタグの記述が一致してないという方が問題ですが。

そこで、Zopeのソースを眺めたり、ZWikiのソースを眺めたり、Zope-MLの過去ログを漁ったり‥‥と色々と調べてみた結果、よく分かりませんでした（笑）。そこでふと思ったのが、「apacheが何かしてるんじゃないか？」という事でした。そういえばサーバー移行のときに *ついでに* FrontEndにapache2を配置したような‥‥。

さっそくapacheのhttpd.confを修正したところ無事問題解決。１時間くらい悩んでしまいました‥‥。

変更部分::

  #AddDefaultCharset ISO-8859-1
  AddDefaultCharset UTF-8

ZWiki以外はContent-TypeをResponseHeaderに入れるようにしているので、省略時にDefault値をapache2が入れていた事が原因のようです。

# それはそれとして、そろそろZWikiコンテンツの内容更新しないと‥‥

%%%%%%%%%

:id: 9
:date: 2004-04-24 17:10:04
:title: ZWikiでコメント追加後にOperaでリロードされない問題
:categories: ['Memo', 'Zope']
:body type: text/structured
:body:
"ZWiki":http://zwiki.org で以前から気になっていた挙動に、"コメント追加後にOperaでリロードされない"という問題があります。ただ、コメント追加後にリロードするとちゃんとコメントは追加されているようです。



:extend type: text/plain
:extend:
これについてもResponseHeaderのContent-Typeを調べたとき同様パケットキャプチャーしてみたところ、POSTメソッドでコメント追加を行った後で以下のような応答がサーバーからありました::

  HTTP/1.1 302 Moved Temporarily
  Date: Sat, 24 Apr 2004 06:56:13 GMT
  Content-Length: 0
  Etag: 
  Location: http://www.freia.jp/taka/test/zwiki28/X_e5_ae_9f_e9_a8_93_e7_94_a8#bottom
  Content-Type: text/plain; charset=UTF-8

また、ZWiki以外の掲示板ではどうなるのかな、と思って、COREblogのコメント追加で実験してみました::

  HTTP/1.1 302 Moved Temporarily
  Date: Sat, 24 Apr 2004 08:02:07 GMT
  Content-Length: 36
  Etag: 
  Content-Type: text/plain; charset=UTF-8
  Location: http://www.freia.jp/taka/test/blog/4
  X-Pad: avoid browser bug

  http://www.freia.jp/taka/test/blog/4

一番の違いは、後者には本文にLocationと同じURIがあることです。もしかしたらこれが原因？と思い、"RFC2616":http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html を読んでみましたが‥‥よく分かりませんでした(^^;; ZWiki改造して本文にもURI書いたら直るかなぁ‥‥

#実はX-Padの方が原因だったりして。

%%%%%%%%%

:id: 10
:date: 2004-05-13 00:01:33
:title: ファスティングしてみました
:categories: ['food', 'misc']
:body type: text/structured
:body:
"http://www.kenny-chiro.com/fasting.htm":http://www.kenny-chiro.com/fasting.htm

- 効果

  ファスティングをすると、3日で3kg痩せて、その後1週間でさらに3kg痩せ、脂肪
  の燃焼しやすい体に体質が改善されます。おまけに、体内の毒素も取り除かれ健
  康的な体に生まれ変わります。




:extend type: text/plain
:extend:
- やること

  3日間固形物を絶ち、3食ファスティングジュース(生野菜豆乳ミックス)のみで生
  活。他に水を1日2リットル飲みます。

- 実行結果

  5/2,3,4のゴールデンウィーク中にやってみました。それまで73～74kgだった体重
  が、最終日には70.4kgに。翌日から食事を再開したため若干体重が戻りましたが、
  ちょうど一週間経過した今日(5/12)の体重は70.4kg。‥‥予定では68kg前後のは
  ずですが、個人差でしょうか？ファスティング明けから毎日しっかり食べている
  からだ、という話もあります。

- 感想

  楽してダイエット！‥‥の予定でしたが、ファスティング中の3日間は出歩くのが
  つらい日々でした。とりあえずファスティング明けも2リットルの水補給と、エセ
  半日ファスティング(市販野菜ジュースと豆乳ミックス)は続けています。

  果たしていつまで続くのか‥‥。


%%%%%%%%%

:id: 12
:date: 2004-05-16 19:39:42
:title: ZWikiでIssueTracker
:categories: ['Zope']
:body type: text/structured
:body:
ZWikiのIssueTrackerは使いにくいと思います。でもZopeの他のプロタクトに比べるといくらかましかもしれません。

使いにくい原因の一つとして、Issueの追加画面に利用方法とかを書いておきたいのにカスタマイズがしにくい、という点があります。というか、そもそもIssueTrackerを使えるようにするまでが苦難の道でした‥‥。


:extend type: text/plain
:extend:
IssueTrackerを使えるようにするためには、以下のようにURLを入力します。

- http://..../FrontPage/setupTracker

しかし、これではカスタマイズ可能にはなりません。カスタマイズするためにはIssueTrackerページをコンテンツとしてコピーしてこなければいけないのです。そのためには、以下のようにします。

- ZWikiのFolderに'allow_dtml'というAttributeをbooleanで追加し、Trueに設定。

- http://..../FrontPage/setupTracker?pages=1

これで、コンテンツにIssueTracker,FilterIssueが追加されます。


%%%%%%%%%

:id: 13
:date: 2004-05-16 19:53:53
:title: ZWikiで目次が常にFrontPageを指す問題
:categories: ['Zope']
:body type: text/structured
:body:
ZWikiで目次リンクを辿ると、ZWikiコンテンツ一覧が表示されます。現在閲覧しているページには"You are here!"というメッセージが付くのですが‥‥いつの頃からかこのメッセージが常にFrontPageに付くようになってしまいました。

この問題は少なくとも0.28.0～0.30.0で見られます。


:extend type: text/plain
:extend:
原因はUtils.pyでURLを決定する部分が間違っているため。pageUrl()を使うべきところでdefaultPageUrl()を使っているため、現在のページではなく常にFrontPageが使われてしまうのでした。

とりあえず、 ZWiki.orgのIssueTrackerに "レポート":http://zwiki.org/IssueNo0809 を上げておきましたが、この調査をしていて気づいたことが。

Default.pyに入っているデフォルト設定を変更すると色々カスタマイズ出来るんですね。今回はとりあえず SCROLL_CONTENTS=1に変更して、目次表示時に現在のページ部分までジャンプするようにしてみました。（こうするとUtils.pyをいじらなくても問題がない‥‥明らかにバグですね）

Default.py には他にもJavaScriptの許可・ページ名変更時の旧ページ保存の可否等がありました。



:comments:
:comment id: 2005-11-28.4259622772
:title: Re: ZWikiで目次が常にFrontPageを指す問題
:author: 清水川
:date: 2004-05-19 12:29:04
:email: 
:url: 
:body:
 ZWiki.orgのIssueTrackerに投稿したはずのIssueが消えてる‥‥というか別のに置き換わってる？なんで？
%%%%%%%%%

:id: 14
:date: 2004-05-23 18:56:29
:title: インターネット接続時間
:categories: ['misc']
:body type: text/structured
:body:
自宅では "PERSOLのPBR005":http://www.persol-jp.com/seihin/seihin/pbr005.html というルーターを使っているのですが、今日たまたま管理画面を見てみたら接続時間が 118419:44:01 となっていました。118419時間って‥‥13年？買ってからそんなにたったかな？


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 15
:date: 2004-06-05 01:03:13
:title: COREblogのリファラadd-in
:categories: ['Zope', 'misc']
:body type: text/structured
:body:
先日、久々に "regnessem":http://regnessem.sourceforge.jp/ のホームページをチェックした際に "RSS Reader plug-in":http://d.hatena.ne.jp/Sapphire/20030102 というのがあったので早速ゲット。regnessemって、ホント便利ですね。




:extend type: text/structured
:extend:
閑話休題

RSS対応している、いつもよく見に行きたいサイトをポコポコと登録してみたところ、「いつもよく見に行きたい」→「いつもよく見に行く」になった。今更ながらWebチェックツールの偉大さを‥‥と言うか、WWWCは結局フィーリングが合わなかったから使わなかったけど偉大さは知ってました。はい。

だんだん何を言いたいのかよく分からなくなってきたので、そろそろ本題を。

１週間くらい前に "日本のZope情報":http://coreblog.org/jp/jzi/ で、 "COREblogのリファラー記録機能":http://coreblog.org/jp/howtos/referer_howto_html というのを知って早速導入してみました。機能としては、リンク経由でCOREblogサイトにアクセスしたときにリンク元のURLを記録して、そのリファラー元を記事の末尾に付記するわけです。この記事の下の方にもあります(だれかがリファラー付きでアクセスしてくれば、ですが)。

で、今日になって久々にリンク元をチェックしてみたらgoogleからのリンクがいくつか。検索ワードは「ファスティング」‥‥？ "しかも７位":http://www.google.co.jp/search?q=%E3%83%95%E3%82%A1%E3%82%B9%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0&amp;hl=ja&amp;lr=&amp;ie=UTF-8&amp;c2coff=1&amp;start=140&amp;sa=N だし。何が原因でそんなに順位が高いのでしょうかね？



:comments:
:comment id: 2005-11-28.4275550623
:title: Re: COREblogのリファラadd-in
:author: 清水川
:date: 2004-06-06 00:04:59
:email: taka@freia.jp
:url: 
:body:
よく見たら150位だった。そりゃそうか。
%%%%%%%%%

:id: 16
:date: 2004-06-07 08:42:53
:title: 住宅情報
:categories: ['misc']
:body type: text/structured
:body:
先週、両親が東京に来た際にマンションの話が出ました。前々から「もしかしたら買うかも(可能性10%)」と言っていたら本人より親の方が先に本気になってしまったというよくあるパターンなわけです。自分としては、駅から近くて・安くて・広ければ買っても良いかなぁくらいは思っています（そんな物件は無い）。

まぁ、家賃７万出すくらいなら買った方が良いとは前から思ってましたが。

で、両親の上京を機に物件探しが若干本格化したわけですが、FAXが無いと不動産屋さんから物件情報を受け取るのに不便だということがわかりました。

そこで、 "D-FAX":http://www.d-fax.ne.jp/top.html です。googleで検索して "利用されている方の記事":http://hapilaki.air-nifty.com/1/2003/12/fax.html を発見。早速申し込んでみました。



:extend type: text/plain
:extend:
D-FAXは利用料無料のサービスで、FAX受信時に登録したメールアドレス宛にFAX画像を添付して送ってくれるサービスです。このサービスの問題は２つ。送信側に40秒10円の料金がかかることと、FAX番号が020で始まるポケベル番号になること。とはいえ、問題になるまでは使ってみてもいいかな、と思いました。タダだし。

続きは実際に受信してから書くことにして、同様のサービスについて書いておきます。

フリービットがISPと協力して展開しているサービスに "FAVO":http://www.office.fb1.jp/favo/ というものがあります。このサービスはD-FAXとは異なり、契約者がお金を払います。 "ASAHI-NET":http://www.asahi-net.or.jp/service/mail/favo/index.htm だと315円/月の利用料がかかります。まぁその分多機能なわけですが、VOICE受信とか読み上げとかは使わないなぁ‥‥。





:comments:
:comment id: 2005-11-28.4279623074
:title: Re: 住宅情報
:author: のぶ
:date: 2004-06-07 13:56:24
:email: 
:url: 
:body:
はじめまして。のぶと申します。
トラックバックいただいたので、寄らせていただきました。

ご参考になればと思い、使用感など。

利用し始めて数か月たちますが、020の番号の問題ですが送信ができないと連絡が入ったのは１度だけでした。
送信側に料金がかかるのが心配だったのですが、こちらは全く問題ないようです。
家庭用FAX・企業の区別は関係なく受信できており、かなり重宝しています。

画像データなので色々応用が利くのが、本当に便利です。
例えば、
・必要なページだけを選んでプリントアウトできる
・転送したい時も、相手がメールアドレスを持っていればメール添付で済む
・画像処理ソフト（ペイントなど）で整形できる
　→　例えばFAXの内容が地図とコメントだったとして、
　　　コメントを消して地図の部分だけにしたり、目印を追加したり
　　　地図のサイズを拡大・縮小して見やすくする・・・etc.

画像の解像度は高くはないのでOCRで使うにはいまひとつですが
それはちょっと欲張りすぎかなと自分でも思います（笑）




:comments:
:comment id: 2005-11-28.4280906623
:title: Re: 住宅情報
:author: 清水川
:date: 2004-06-07 22:01:22
:email: taka@freia.jp
:url: 
:body:
追加情報ありがとうございます！

早速不動産屋さんにメールで番号を伝えました。FAX受信テストしてないので少々不安ですが‥‥

あと、会社の同僚に話したら興味を持ったみたいで、使ってみると言っておりました(^^
FAX対応機を買う気にはならないけど受信はしたい、という需要はしばらくは無くならないですね‥‥
%%%%%%%%%

:id: 17
:date: 2004-06-11 00:24:56
:title: D-FAX、その後
:categories: ['misc']
:body type: text/structured
:body:
会社から試しに送信してみよう、と思ったのですが、会社のPBXを抜けられずNG。
試しに直接番号を回してみても、::

  「こちらは東京テレメッセージです、おかけになった電話番号は現在使われておりません」

と、つれないお言葉‥‥。
さらにセブンイレブンからもトライしてみたのですが、セブンイレブンの多機能コピー機のFAXさんは::

  「通信中に重大なエラーが発生しました。店員までお知らせください」

と、警告音まで‥‥。



:extend type: text/plain
:extend:
もしかしてまだ開通してないのかな？と思い、サポート宛に問い合わせてみたところ::

  発信されたD-FAX番号の下1桁、又は2桁が欠けている場合に発生致します。PBX等
  をご使用の環境で、外線発信番号等の関係でD-FAX番号を最後まで認識出来ていな
  いものと思われます。

という内容のお返事（実際はもっと丁寧な文面でした）を頂きました。無料サービスなのに（送信側が料金払うけど）、なんて丁寧な‥‥。

で、結局のところ住宅情報FAXが届いてるので問題なく使えています。画像はTIFF形式なのですが、TIFFって複数ページを一つのファイルに持てるんですね。知らなかった‥‥。

%%%%%%%%%

:id: 18
:date: 2004-06-11 00:51:21
:title: Plone2.03も日本語がっ
:categories: ['Zope', 'python']
:body type: text/structured
:body:
会社の上司にZopeを紹介してみました。紹介と言っても業務ではなくプライベート
の範疇で、ですが。で、Zopeを簡単に強力に使う手段として "Plone":plone.jp 
（ZopeのProduct）を勧めてみました。Ploneで構築されているサイトの例としては
 "沖縄ITポータル":http://okiit.okihawk.org/ が有名らしいのでついでに実例と
言うことで紹介しました。

ところで、個人的にはPloneもCMFも使ったこともないしよく分からないというのが
実情だったので、紹介しておいて知らないというのもなぁ‥‥ということで
Windows版の2.03をインストールして軽くさわってみました。



:extend type: text/structured
:extend:
Windows版、楽でイイですね。やっぱり最初の1ステップは楽な方が人に勧めるのに
抵抗がなくて良いと思います。

それはさておき、とりあえずデフォルトのトップページを日本語にしてみよう、と
思って::

  "沖縄ITポータル":http://okiit.okihawk.org/

と書いてみたのですが、リンクになってくれません。しかし、 "先日の件
":http://www.freia.jp/taka/blog/4 もあり、すぐに ZopeのStructuredTextが腐っ
てるんだ！と思いつき、さくっと対応できました。

パッチは
"ここ":http://sukima.ddo.jp/Plone/Members/yusei/Download/Zope-2.6-StructuredText.patch/file_view 
のを当てて、修正したpyファイルを手動で再コンパイル。再コンパイルの方法は、
pythonのMLで教えてもらった方法で手軽に(?)行いました::

  > cd (ploneインストールフォルダ)\Zope\lib\python\StructuredText
  > (ploneインストールフォルダ)\python\python.exe
  --python起動--
  >>> import DocumentClass
  >>> import STletters
  >>> (Ctrl-Zで終了)

ところで、このコンパイル方法って本当に手軽なのでしょうか？pycが無い場合は自
動的にコンパイルして生成してくれる方法がありそうな気がします。


%%%%%%%%%

:id: 19
:date: 2004-06-11 01:08:23
:title: RSSでチェックするサイトが日々増えていく
:categories: ['Zope', 'misc']
:body type: text/structured
:body:
"日本のZope情報":http://coreblog.org/jp/jzi/ の存在を知ってからというもの、巡回サイトが日々増えていきます。 そんなにたくさん見れません！

ところで、みなさんCOREblogのskinを色だけ変えて使っているようで(自分もそうですが)、並べて眺めるとなかなかカラフルです。

色違いCOREblogサイト集（ "日本のZope情報":http://coreblog.org/jp/jzi/ 他より）

  - "bakaukeBlog":http://bakauke.ddo.jp/

  - "Something Red":http://somethingred.dip.jp/blog/

  - "ZenKai":http://zenkai.atransia.co.jp/blog/

  - "生きてま":http://log.giantech.jp/

  - "渋日記":http://shibu.jp/blog/

  - "清水川記":http://www.freia.jp/taka/blog/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 20
:date: 2004-06-23 00:34:21
:title: Anex86 + RAY-III
:categories: ['misc', 'Programming']
:body type: text/structured
:body:
（主カテゴリーが雑談で副カテゴリーがProgrammingという微妙な記事...）

とある事情により、ここ数日、職場にドラゴンクエストの着メロが飛び交っています。そういえば昔はドラクエの曲をMML入力してRAY-IIIで聞いていました‥‥。


:extend type: text/structured
:extend:
ということで、久しぶりにRAY-IIIを起動してみました。
こんな事もあろうかと、当時のDOS環境をイメージ化して "Anex86":http://homepage2.nifty.com/ans/index.htm でいつでも起動できるようにしてあるのです。
ということで、さっそく再生！

  ぴー

なぜか割り込みベクタが競合しているかのように音を出しっぱなしで固まってしまいました。設定を変更してもうまく再生できません。が、こんな事もあろうかとAnex86歴代バージョンが手元にあります。そしてVer2.14で無事再生することが出来ました。（ある意味逃げですが、今回は再生できればOKという事で）

当時入力した曲は結構中途半端な作りになっている物が多く、手直ししたいとも思いましたが、MMLに手を入れるのは‥‥かなりの覚悟が‥‥。そういえば当時(1994年)も半年ほどでMMLからMusicSynapseへ乗り換えたのでした。その頃作ったデータがたしかこの辺に（ごそごそ）。

データはありましたが、専用形式なのでMusicSynapseが無いと読み込めません。たしかソフト本体も１年ほど前に見かけた気が‥‥。

（気が向いたら以下次号）

ところでGoogleで"RAY"を検索してもあまり目的の情報に到達できませんね。 "2ch":http://piza2.2ch.net/dtm/kako/1000/10000/1000023248.html のが欲しい情報に一番近いかな？

%%%%%%%%%

:id: 21
:date: 2004-07-05 15:20:40
:title: 英雄伝説VI
:categories: ['Game']
:body type: text/structured
:body:
Falcomの新作、 "英雄伝説VI 空の軌跡":http://www.falcom.com/ed6/ を6/26に購入してから、日々ちまちまとプレーして、今日ようやくクリアしました。総プレー時間は43時間くらい。実際プレー出来たのはほとんど土日だけなので、一日平均10時間くらい？廃人？

それにしても、久々に廃人になれるゲームだった気がします。テンポ・シナリオ共に良し。戦闘システムも２点ほど気になったとは言え、十分合格点でした。




:extend type: text/plain
:extend:
気になったのはATバーとラストあたりのテンポの悪さで、前者については単に "メンアットワーク！３":http://www.studio-ego.co.jp/030/ego/game/maw3/maw3.html のシステムと混同してしまって「どうやって自分の戦闘順位を遅らせるんだろう？」とか思ってしまっただけでした。後者については‥‥どうなんでしょう？単に自分の戦い方が間違っていた気もします。

あれ、そうすると戦闘システムも問題ないということになりますかね？

心残りなのは、料理が３つ残ってしまったことと、序盤でいくつか依頼をこなさずに進めてしまったことでしょうか。あぁっ、こんなことならちゃんと依頼こなしておくんだったっ！依頼システムもIV以来ですが、IVに比べるとかなり良くなってますね。依頼をこなすことが遊撃士としてのお仕事だったり、複数の依頼が関連していたり（ちょっとだけ）と工夫されています。IVの時みたいにコンプリートするのが苦になりませんでした（コンプリートしてないけど）。

オーブメントとオーバルアーツの仕組みも理解したし、次はコンプリートしたいですね。

- 最終：１級

- 料理：あと３つ

- 少佐戦：勝利



%%%%%%%%%

:id: 22
:date: 2004-07-05 15:46:09
:title: マンション購入
:categories: ['misc']
:body type: text/structured
:body:
色々と考えた末、このたびマンション購入となりました。今日の午前中に引き渡しが完了し、実質自分の物となりました（登記移転完了は２週間後です）。

以下は今回参考にしたサイト集です。情報元は "google":http://www.google.co.jp/ と "aihatena":http://www.freia.jp/aihatena/ 提供情報です。

- "D-house(中古マンション購入時の諸費用)":http://www.d-house.co.jp/select/hiyou2.html

  一番最初に諸費用に関して検索していてたどり着いたサイトです。

- "げっとまいほ～む":http://www4.plala.or.jp/dax/myhome.htm

  マンションを買う流れが分かります。お気軽にマンションを買うというテーマ(?)なので、時々やりとりされる金額のことを忘れそうになります。

- "ISIZE住宅情報(住宅購入完全ガイド)":http://www.isize.com/cgi-bin/rperl5.pl/house/01/edit/jj/guide/000_000_000.html?PAGE_ID=&amp;RANDOM=&amp;SEQUENCE=&amp;ISIZE_AREA_CD=000

  ここもお世話になりました。購入時のポイントポイントについての解説がうれしいです。 *げっとまいほ～む* の情報を固く詳細にした感じでしょうか。

- "リクルートコスモス(新築マンション 税金)":http://www.cosmosmansion.jp/tax/index.html

  物件購入時にかかる税金の話が詳しく載っています。

- "Atractors lab":http://www.a-lab.co.jp/

  マンション購入の情報量に関しては一番です。ここに書いてあることを全部理解できるようになるのはいつの日でしょうか‥‥。

- "住まいの調査団":http://www.chousadan.jp/index.htm

  お金に関するさまざまな事柄の試算が出来るサイトです(と言うと語弊がありそうですが)。 "計算・チェックコンテンツ":http://www.chousadan.jp/kaku-content/keisan-c1.htm が非常に役立ちました。

- "住まいの相談室":http://www.yomiuri.co.jp/homeguide/soudan/

  色々な相談事例があって、トラブル対策に使えます。税金の細かい話、特に消費税のかかり方についての例が参考になりました。

- "札幌発 マンション大規模修繕全記録":http://www.netpassport.or.jp/~wntera/

  一応目を通しましたが‥‥、総戸数15戸ですので。知識としては役に立ちました。




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 25
:date: 2004-07-09 23:59:00
:title: 開発現場で使えるファシリテーション
:categories: ['Event', 'OO']
:body type: text/structured
:body:
"開発現場で使えるファシリテーション":http://www.objectclub.jp/event/workshop#1 の数々、とても参考になりました。さっそく使いたい技がいくつか手に入ったので、有効活用したいと思います。



:extend type: text/plain
:extend:
自分的に感じたのは、会議（今回はワークショップ）の進行がウマイ！という事です。よく「チームで５分間考えてみてください」というようなシーンがあったのですが、その時間の間に次の進行に必要な準備（模造紙を貼ったり）が済んでいて、全体の進行を止めずに進めていた事が一番スゴイと感じました。

また、クリスマスイベントで金澤さんとチームになったときも感じたことですが、模造紙と付箋の使い方もウマかったです。 *誰でも出来る事* だし *ちょっとしたこと* なのですが、とても重要なことだと感じました。ポイントは「常に見える状態で残しておく」事ですね。レジュメとか目標とか参加者の目的とか。

ということで、会社用にも "イーゼルパッド":http://www.mmm.co.jp/office/post_it/body/body_pt20.html 買わなくては。

%%%%%%%%%

:id: 24
:date: 2004-07-09 23:59:00
:title: オブジェクト指向でなぜつくるのか
:categories: ['Event', 'OO']
:body type: text/structured
:body:
主賓講演の平澤さんの *オブジェクト指向でなぜつくるのか* は、本を読まずに聞いたのですが、「そもそも何をオブジェクト指向というのか」という部分がとても考えさせられました。



:extend type: text/plain
:extend:
今自分が関わっているプロジェクトはC言語で、参加メンバーのほぼ100%が「オブジェクト指向って何？」という感じです。プロジェクトの目標は「今までデータもドライバもアプリも渾然一体となっていた世界にプラットフォームを導入して作りやすくしましょう」というところにあり、このプラットフォーム全体のアーキテクチャを考えるときに **オブジェクト指向的思考** がとても重要だと感じました。一緒にアーキテクチャを考える人達やプログラムを作る人達に *オブジェクト指向* という単語は出さないようにしつつも、「データにアクセスするプログラムは一つにする（隠蔽）」「各アプリはデータアクセスプログラムを介してのみデータに触れる（インターフェース）」「特殊なアプリであっても他のアプリからは普通のアプリに見えるように作る（インターフェース？）」という事を前提として進めてきました。

こういったこともオブジェクト指向なんだと思いますが、平澤さんの言うところの「言語の仕組みとしてのOO」以外の部分なんだと思います（メモ取らなかったので実際に何て言うカテゴリに分けていたか忘れてしまいました）。

と言うことで、「OOは非OOな開発現場で使っても良いんだ！」などと勝手に納得してみました。いやー、参加して良かった（笑

%%%%%%%%%

:id: 23
:date: 2004-07-09 23:59:00
:title: オブジェクト倶楽部納涼イベント開催！
:categories: ['Event', 'OO']
:body type: text/structured
:body:
行ってきました、 "オブジェクト倶楽部":http://www.objectclub.jp/ 主催の "納涼イベント":http://www.objectclub.jp/event/2004summer ！

10時に会場入りして、ラスト（２次会）まで参加、そして帰りの電車でOO談義をしつつ新宿まで余すところ無く楽しんで来ました。



:extend type: text/structured
:extend:
参加した感想で一番強く思ったのは、 *「実際に参加して他の参加者と話をする」* 事が一番大事だという事でした。つまり人とのコミュニケーションが大事だ、と。懇親会と２次会に参加することにこのイベントの意義が50%くらい含まれてると思いました。

自分はOOレベルもOO実践度合いもかなり低い方だと思いますが、低いなりに得る物はたくさんありました。また次回も参加しようと思います。今度は誰か巻き込んで、OOの輪を広げたいですね。（とりあえず次は "XP祭り":http://www.xpjug.org/event/20040726maturi/ に参加します。誰か巻き込めるかな‥‥？）

コミュニケーションが大事、と言うことで、お話した方々のblogにトラックバックさせて頂きました。今後ともよろしくお願いします＞みなさま

- "アマアマにっき":http://d.hatena.ne.jp/amapyon/
  より "イベント当日":http://d.hatena.ne.jp/amapyon/20040709

- "生きてま":http://log.giantech.jp/
  より "無事終了":http://log.giantech.jp/221

- "J_Matsumotoの日記":http://d.hatena.ne.jp/J_Matsumoto/
  より "オブジェクト倶楽部":http://d.hatena.ne.jp/J_Matsumoto/20040709

- "福井 厚のBlog (Atsushi Fukui's blog)":http://blogs.users.gr.jp/fukui/
  より "ファシリテーション入門":http://blogs.users.gr.jp/fukui/archive/2004/07/11/3669.aspx

あと、特に今回のイベントについて書かれていない方の分もリンク。

- "渋日記":http://www.shibu.jp/blog

- "Fujiwoの日記":http://d.hatena.ne.jp/Fujiwo/




:trackbacks:
:trackback id: 2005-11-28.4310868214
:title: 無事終了
:blog name: 生きてま
:url: http://log.giantech.jp/221
:date: 2005-11-28 00:47:11
:body:
無事、オブ倶楽イベントが終った。今回は自分がワークショップ講師であることと、イベントの会場設置監督(？)だっただけに、感慨深い。
前回のイベントは、企画は参加していなかったため、とりあえず現場で動くことしかしなかったが、今回はイベントスタッフリーダーの隣で相談に乗りながらすすめていったので、会場、ケータリング、構成、受付手順などなど１つのイベントを作りあげていく様を実感した。懇親会も会場の机の配置から、料理の配置、ビヤサーバの切換えなども自分たちでやったので、手作り感は相当高かったんじゃないか...
%%%%%%%%%

:id: 26
:date: 2004-07-12 01:51:25
:title: 水と空気
:categories: ['misc']
:body type: text/structured
:body:
引越に際して、クーラーが必要になりました。今回はかなり長い期間使うことになるのが予想できるので、ちょっと高くても高機能な物を買うことにしました。そこで選んだのが "National の Kirei":http://prodb.matsushita.co.jp/product/info.do?pg=04&amp;hb=CS-28RCXS です。




:extend type: text/plain
:extend:
"GO":http://www.freia.jp/suzuki-g 君曰く、エアコンはNational！らしいのですが、自分も色々調べていたら結局Nationalにたどり着いたと言う‥‥。ダイキンも良いなぁと思っていたのですが、いくつかの点でNationalに軍配が上がりました。選んだエアコンには以下の機能があります。

- 換気してくれる

- 酸素チャージしてくれる

- 省エネ達成率127%！

- 自動除菌してくれる（凄そう）

- 運転時にフロントパネルがちょっと開く！（重要）

ちょっと(いやかなり)高かったけど、きっと満足のいくモノに違い在りません！来週の引越翌日に取り付けに来てもらう事になったので、感想はまたそのときに‥‥。

クーラーを買ったのはヨドバシカメラだったのですが、驚異の23%還元で4万円分近くもポイントが貯まりました。そこで、そのポイントを使って水質改善アイテムを購入しました(計画的犯行)。

- "スーパー磁王ピュア":http://mythos-plan.com/jioh/

名前はかなり胡散臭いですが、以前 *ようどう* から同様の商品( "ダイポール":http://www.hrd.ne.jp/dp_01.htm )を勧められていて、気になっていた方式の水質改善アイテムです。果たしてどれだけの効果があるのか？さっそく新居に取り付けてきたので引越後に調べてみようと思います。(と言ってもどうやったら調査できるんだろう‥‥？)


%%%%%%%%%

:id: 27
:date: 2004-07-12 01:56:25
:title: 引越準備
:categories: ['misc']
:body type: text/structured
:body:
エアコンを買いに行ったり、日記をまとめて書いたりしているせいか、引越の準備が全然進みません。

今日の成果は、「布団圧縮袋を買ってきて布団類をコンパクトにした」だけです。それにしても本当に1/3になるとは思いませんでした。700円/2枚のアイテムも侮れませんね(掃除機はオーバーヒートしそうになりましたが‥‥)。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 28
:date: 2004-07-14 23:49:54
:title: 計算パズルとpython
:categories: ['python', 'Programming']
:body type: text/structured
:body:
"i?":http://www.freia.jp/aihatena/ から計算パズルを出されました。10分くらい考えてみたのですが答えが出ず、悔しかったのでプログラム(python)で解いてみることにしました。

問題

  1, 1, 5, 8 の4つの数字を使って四則演算を行い、答えが10となる式を作れ。ただし、以下の条件を守ること。

    - 各数字を必ず１回ずつ使う

    - 単項のマイナス演算は不可

    - 二つの数字をくっつけて二桁にするのは不可



:extend type: text/structured
:extend:
pythonで計算するために、まずは逆ポーランド計算機を用意。これはgoogleで探したサイトから流用しました::

  import string
  stack = []
  for x in input:
      if x == '+':
          stack.append(stack.pop() + stack.pop())
      elif x == '-':
          stack.append(stack.pop(-2) - stack.pop())
      elif x == '*':
          stack.append(stack.pop() * stack.pop())
      elif x == '/':
          stack.append(stack.pop(-2) / stack.pop())
      else:
          stack.append(string.atof(x))
  return stack[-1]

へー、リスト型に対してpopが出来るんですね‥‥。pop_frontは無いのでしょうか？自分はpythonでプログラムを一から組んだことが無いので、どんなことが出来るのかすらよく分かっていません。

とりあえずそんな問題は棚上げにして、パズルを解くアルゴリズムを考えます。

逆ポーランド計算機に入れる計算式のパターンは以下で全てのようです(#=数字, o=演算子)::

  #,#,#,#,o,o,o
  #,#,#,o,#,o,o
  #,#,#,o,o,#,o
  #,#,o,#,#,o,o
  #,#,o,#,o,#,o

あとは、'#'に(1,1,5,8)の組み合わせを入れて、'o'に演算子の全組み合わせを入れて全パターン調べるだけです。とりあえずざくざくとプログラムを書いてみたところ、以下のようになりました::

  # n=num, s=sign(+-*/)
  pattern=[]
  pattern.append(['n','n','n','n','s','s','s'])
  pattern.append(['n','n','n','s','n','s','s'])
  pattern.append(['n','n','n','s','s','n','s'])
  pattern.append(['n','n','s','n','n','s','s'])
  pattern.append(['n','n','s','n','s','n','s'])
  
  num=('1','1','5','8')
  sign=('+','-','*','/')
  
  sign_pattern=[]
  for x in range(4):
    for y in range(4):
      for z in range(4):
        tmp = []
        tmp.append( sign[x] )
        tmp.append( sign[y] )
        tmp.append( sign[z] )
        sign_pattern.append( tmp )
  
  num_pattern=[]
  for x in range(4):
    for y in range(3):
      for z in range(2):
        num_copy=[i for i in num]
        tmp=[]
        tmp.append( num_copy.pop( -1-x ) )
        tmp.append( num_copy.pop( -1-y ) )
        tmp.append( num_copy.pop( -1-z ) )
        tmp.append( num_copy.pop() )
        num_pattern.append( tmp )
  
  for n in num_pattern:
    for s in sign_pattern:
      for p_set in pattern:
        nc=[i for i in n]
        sc=[i for i in s]
        input=[]
        for p in p_set:
          if p=='n':
            input.append( nc.pop() )
          else:
            input.append( sc.pop() )
        try:
          if context.rpn(input=input) == 10:
            return input
        except:
          pass
  
  return 'failed'

‥‥初めてC言語でプログラムを書いた頃のことを思い出してしまいました。何というか、とりあえず知っている書き方と本(今回はWeb)を調べて見つけた書き方で何とかしたという雰囲気がよく分かります‥‥。そこはかとなく恥ずかしい気もしますが、習作という事で日記掲載決定です。

次の目標は値のコピーの仕方を覚えることです。関数化するなどでアルゴリズムを見直す方が先という気もしますが、既に目的がすり替わってしまいました。いくらpythonがリテラル以外の代入がコピーではなく参照になるとはいえ、こんな書き方::

  num=['a','b','c','d']
  num_copy=[i for i in num]

をしなくてもコピーできるんじゃないでしょうか？というあたりが気になってしかたありません。

*# なんて事をしてるから引越準備が遅れるワケです。*




:comments:
:comment id: 2005-11-28.4320201680
:title: Re: 計算パズルとpython
:author: micro-8
:date: 2004-07-15 02:49:20
:email: 
:url: 
:body:
切符の数字で遊ぶ奴みたいですね。
こんな理路整然と書いていけるんですね。すごい。

覚えたての私が言うのもなんですが、配列の複製はこんな感じで書いていました。

>>> a0=['1','2','3']
>>> a1=a0
>>> a1[0]='*'
>>> a1
['*', '2', '3']
>>> a2
['1', '2', '3']
>>> a0
['*', '2', '3']

でもやっていることはa2=[i for i in a0]と同じような気がしないでもないです。


:comments:
:comment id: 2005-11-28.4321520347
:title: Re: 計算パズルとpython
:author: 清水川
:date: 2004-07-16 01:39:01
:email: taka@freia.jp
:url: 
:body:
> こんな理路整然と書いていけるんですね。すごい。

(^^;;


なるほど、要素の部分集合の代入はコピーになるんですか。言われてみれば確かにその通りですね。部分集合が参照だった場合、参照元にappendやpopしたらおかしな事になってしまう。これは気づきませんでした（気づく気づかない以前にちゃんとリファレンス読まないと‥‥）。

> でもやっていることはa2=[i for i in a0]と同じような気がしないでもないです。

内部的には多分同じなんだと思いますが、表面的には無駄にラムダを使ってるようにしか見えません。「要素の全コピーを簡潔に書きたい。そうだ、ラムダ式だ！」と、知識が偏っている結果の産物です(;-;

# STLを使っていた頃が懐かしい‥‥

ということで、基本を押さえておかないとちょっとしたことで詰まってしまう、という実例でした。
%%%%%%%%%

:id: 29
:date: 2004-07-16 01:45:49
:title: 引越準備
:categories: ['misc']
:body type: text/structured
:body:
細かい部分と大きい部分以外は大体片づきました。しかし、PC周りとAV周りがまだ全然片づいていません。こんな事で大丈夫なんでしょうか‥‥。

明日の夜は新居へサーバーの移設を行う予定なのですが、その前に梱包等に２時間くらい時間を取られそうです。明日は眠れないかもしれません。

ちなみに現在29箱。11箱が本で、10箱がパソコン関係です。

<img src="images/hikkoshi_box" border="0" alt="詰め終わった箱を壁際に並べてみました" title="詰め終わった箱を壁際に並べてみました">


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 30
:date: 2004-07-17 00:34:36
:title: 引っ越し準備
:categories: ['misc']
:body type: text/structured
:body:
"とみた":http://tomita-net.dyndns.org が車を出してくれたので、サーバーとメインＰＣの移設は完了しました。
いろいろとトラブルはあったものの、今、旧家に戻ってPDA+NetFrontで移設したサーバーのWebにアクセスしてみたところ問題無いようです。

で、ついでにPDAの手書き認識でこの日記を書いてみました。

明日は朝から引越し本番です。片付けにあと４時間はかかるなあ…。ちょっと心配になってきました。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 31
:date: 2004-07-18 14:23:37
:title: 引越完了
:categories: ['misc']
:body type: text/structured
:body:
引越が完了しました。

本日お手伝い頂いた皆様、本当にありがとうございました！
準備不足で梱包作業手伝いが発生したにもかかわらず、実質4時間少々で完了することが出来たのは、みなさまのおかげでございます。

引越作業中は、搬出・搬入とも室内担当だったのでみんなほど疲れなかったのですが、前日から風邪気味＆寝不足で結構しんどかったです。でも荷物を持って階段を３階まで上がるよりは楽だったに違いないです。また遊びに来て階段登ってください(^^

とりあえずほとんどの荷物は４畳半部屋に押し込んだので、今のところ他の空間がかなりスッキリしています。このまま生活出来そうな気も‥‥。

▼台所にPCとサーバー

  <img src="images/kitchen_server" alt="台所にPCとサーバー" title="台所にPCとサーバー" width="400" height="300">

▼４畳半部屋（ウォークインクローゼットと名付けてみる）

  <img src="images/walkin_nando" alt="どちらかというと納戸と呼んだ方が良いかも" title="どちらかというと納戸と呼んだ方が良いかも" width="400" height="300">

*# 寝る前に1000円のユンケル飲んで体力低下対策。*


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4330101916
:title: Re: 引越完了
:author: 清水川
:date: 2004-07-18 14:37:06
:email: taka@freia.jp
:url: 
:body:
あれ？写真と文字の位置関係が‥‥？？

普通に縦に並んで欲しいだけなんですけどね


:comments:
:comment id: 2005-11-28.4331271342
:title: Re: 引越完了
:author: 清水川
:date: 2004-07-20 17:58:59
:email: taka@freia.jp
:url: 
:body:
Extendがあると<p>タグが入れ子になって、その結果画像表示が意図しないものになる。ということは分かりました。とりあえずExtendに書かないようにして対処。


:comments:
:comment id: 2005-11-28.4332543662
:title: Re: 引越完了
:author: aihatena
:date: 2004-07-21 12:57:03
:email: 
:url: 
:body:
倉庫じゃなかったん? >4畳半
というか倉庫にしか見えない(笑)
もしくはサーバルームとか。


:comments:
:comment id: 2005-11-28.4333694995
:title: Re: 引越完了
:author: 清水川
:date: 2004-07-21 23:50:59
:email: taka@freia.jp
:url: 
:body:
サーバールームにするにはクーラーを付けないと‥‥。最上階（低いけど）は暑いのです。

今月の電気代が怖そう‥‥って東京電力に電話するの忘れてた！

%%%%%%%%%

:id: 32
:date: 2004-07-18 17:49:12
:title: エアコン設置
:categories: ['misc']
:body type: text/structured
:body:
部屋にエアコンが付きました。いちおう和室の方には前の住人のモノが残っていたので、昨日は和室の方で生活していたのですが、これでやっとメインの洋室に拠点を移すことが出来ます。とはいえ、窓にカーテンがまだ付いていないので、丸見えですが。

で、エアコンなのですが、換気機能というやつが付いていて、室内の空気を外にはき出せるのにしたのですが、付属のパイプの長さが短かったと言うか、間取りの関係上かなりパイプ経路が長くなってしまったため、中途半端な状態で設置されてしまいました。パイプを取り寄せ次第工事の続きを行う予定です。

と言うことで、ほとんどの機能は問題なく使えるのですが、今換気機能を使うと室内の空気が室内にはき出されます（笑

<img src="images/kanki_aircon" title="換気エアコンの排気が室内に" alt="換気エアコンの排気が室内に">


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 33
:date: 2004-07-19 23:29:12
:title: 旧アパート契約解除
:categories: ['misc']
:body type: text/structured
:body:
今日、以前のアパートの契約を解除してきました。と言っても、一ヶ月前に通知はしていたので、今日は鍵を返してきただけです。その後、調布郵便局へ郵便物の転送届けを出しに行き（遅い）、とりあえず宅急便以外の届け物については対処完了しました。

問題は、宅急便です‥‥。 "恐るべきさぬきうどん":http://www.bellne.com/pc/trends/udon/udon_index.htm の今月分がそろそろ届くのですが、どうしましょう？連絡先も自分の会員番号もわかりません。やっぱりアパートを定期的に見に行くしかないですかねぇ。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 34
:date: 2004-07-22 00:17:29
:title: デスマーチ
:categories: ['Memo']
:body type: text/structured
:body:
XP-jp MLで 小島＠福井コンピュータ さんの紹介。

・ "「デスマーチが起きる理由 - 間違っていた方針」":http://www.hyuki.com/yukiwiki/wiki.cgi?%a5%c7%a5%b9%a5%de%a1%bc%a5%c1%a4%ac%b5%af%a4%ad%a4%eb%cd%fd%cd%b3

面白い！というか色々思うところがありますね。

構造ツリーについてgoogleで調べてみたところ、 "TOC 制約理論のひろば":http://www002.upp.so-net.ne.jp/toc-jp/index.htm というサイトの "思考プロセス":http://www002.upp.so-net.ne.jp/toc-jp/ThinkingProcess.htm というページが引っかかりました。うーん、知らないこと多すぎです。

*# 読みたい本も最近溢れ気味です‥‥*


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 35
:date: 2004-07-22 00:20:41
:title: 恐るべき
:categories: ['misc']
:body type: text/structured
:body:
無事不在伝票を旧アパートから回収できました。明日電話して引っ越し先に配達をお願いしてみます。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 36
:date: 2004-07-22 09:25:22
:title: 文章作成におけるテスト
:categories: ['Memo', 'Agile(XP)']
:body type: text/structured
:body:
"XPのメタモデル（文書作成におけるテストとは）":http://log.giantech.jp/249 、面白いアイディアですね。ちょっと自分で理解するためにxUnitと対応づけて考えてみました。

NGワードチェック（というか用語統一でしょうか）はxUnitには対応する機能はなさそうですが、仮にその機能をxUnit的に作るとしたら‥‥何でしょうか？クラス名やメンバ名の命名規則チェッカー？クラス名は名詞になるように、とか、メンバ変数名はハンガリアン記法にする、とか‥‥？

逆にxUnitのASSERTでやりたいことを文書作成に持ち込むとどうなるでしょうか。ASSERTの目的は一行だけに注目すると、入力に対する出力が期待通りかどうかを確認することです。それが複数行集まると、舵取り（入力集合）は期待通りの航路（出力集合）に結びつくか、の確認になると思います。あぁ、なるほど。文章作成で言うと、たしかに「骨子」を満たした「文章」になっているかどうかを確認する作業と言えますね。書いててやっと納得しました(^^


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 37
:date: 2004-07-26 01:31:23
:title: COREblogを0.61bから0.73bへ
:categories: ['Zope', 'misc']
:body type: text/x-rst
:body:
やっと時間を取れるようになったので、サーバーで使っている COREblog_ を0.61bから0.73bへ上げました。

これでやっと reStructuredText_ を使えるようになります。人に説明したり使ってもらうための敷居は StructuredText_ の方が低いのですが、使い込む用途には reStructuredText_ が良いですね。まぁ部分的に StructuredText_ のにある機能が reStructuredText_ に無くて残念だったりすることもありますが（下線とか）。

.. _Coreblog: http://coreblog.org/

.. _reStructuredText: http://www.freia.jp/taka/wiki/ReStructuredText

.. _StructuredText: http://www.freia.jp/taka/wiki/StructuredText


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 38
:date: 2004-07-26 01:39:23
:title: 電源が‥‥
:categories: ['misc']
:body type: text/x-rst
:body:
今のところに引っ越してきて、まだモノの配置が決定していないために一時的にサーバーの電源を台所のコンセントから取っていたりします。で、今日台所周りのブレーカーが落ちました‥‥(;_;

ウチのブレーカーは主電源(50A)が４系統に分岐しているのですが、それぞれの担当範囲が

- 電灯
- ？灯
- コンセント
- クーラー

でした。「？灯」は貼ってあるシールの文字がかすれていて一文字目がよめなかったのですが、一文字入れるとしたら「電」しか思いつきません。電灯が２系統？？コンセントを台所とそれ以外に分けて欲しいですねぇ‥‥。

今日落ちたのは「？灯」なのですが、これ一つで台所の蛍光灯と(おそらく)全室のコンセントが全滅しました。ということは電子レンジ＋1500Wドライヤーなどということは不可能という事になりますね。せっかく主電源が50Aなのになんだか納得できない作りになっているような気がしてなりません。

*# あとコンセントの配置が×。電話線の口周りにコンセントは必要でしょ？*


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4354313215
:title: Re: 電源が‥‥
:author: aihatena
:date: 2004-07-26 16:44:51
:email: 
:url: 
:body:
昔は局から給電したのでいらなかったのでは..


:comments:
:comment id: 2005-11-28.4355459257
:title: Re: 電源が‥‥
:author: anonymous
:date: 2004-07-26 16:50:49
:email: 
:url: 
:body:
「竿灯」


:comments:
:comment id: 2005-11-28.4356579976
:title: Re: 電源が‥‥
:author: 清水川
:date: 2004-07-27 12:50:42
:email: taka@freia.jp
:url: 
:body:
> 竿灯

それだ！


:comments:
:comment id: 2005-11-28.4357682917
:title: Re: 電源が‥‥
:author: Max
:date: 2004-07-29 00:29:11
:email: 
:url: http://zope.fubyshare.net/Max/SiteBites
:body:
>「竿灯」 

「消灯」

・・・と思ったのですが、インパクトで負けました。

うちも引越した先が回路系統不明なまま使ってます。しかし、電子レンジをつないでいたと思しき回路をたどってみると・・・・

センセイ！ブレーカーが入ってません！

その系統のコンセントは封印しました。


:comments:
:comment id: 2005-11-28.4358825655
:title: Re: 電源が‥‥
:author: 清水川
:date: 2004-07-29 23:34:03
:email: taka@freia.jp
:url: 
:body:
行灯（あんどん）とか。電気使ってないデスけど。‥‥竿灯もか。

そもそも竿灯なんて日本人の２割くらいしか知らないんじゃないでしょうか。「会社の人１０人に聞きました」とかやってみようかな。

> センセイ！ブレーカーが入ってません！

火を噴くブレーカー(^^;
以前築30年のアパートに住んでいた時は15Aのブレーカー（というか半田）がよく焼き切れたものです。近所の東京電力に３回くらい半田（10本セット）をもらいに行きました。


:comments:
:comment id: 2005-11-28.4359990174
:title: Re: 電源が‥‥
:author: aihatena
:date: 2004-07-30 16:59:46
:email: 
:url: 
:body:
ここ読んでる人の5割くらいは秋田県民だろうから
大丈夫かと(笑)
>「竿灯」



:comments:
:comment id: 2005-11-28.4361163393
:title: Re: 電源が‥‥
:author: Max
:date: 2004-08-01 03:42:25
:email: 
:url: http://zope.fubyshare.net/Max/SiteBites
:body:
>火を噴くブレーカー(^^;

ふふふ。火は噴きません。

なんせ回路にブレーカーというものが存在していなかったので（力説

%%%%%%%%%

:id: 39
:date: 2004-07-27 00:44:15
:title: XP祭り2004参加レポート
:categories: ['Agile(XP)', 'Event']
:body type: text/x-rst
:body:
XP祭り2004_ に参加してきました。とりあえず写真メモという形で書いておきたいと思います。

アジェンダ
-----------
議事進行。自分が参加しているプロジェク
トの関係上、「アジャイル開発におけるフレームワーク設計」が非常に気になります。

|XP祭り2004 アジェンダ|


.. _XP祭り2004: http://www.xpjug.org/event/20040726maturi/regist
.. |XP祭り2004 アジェンダ|       image:: images/xpfesta2004_ajenda
 


:extend type: text/plain
:extend:
アジャイル開発におけるフレームワーク設計
------------------------------------------

本日の自分的目玉イベント！でした。が、あんまりアジャイルじゃない...。その前
に講演された関さんの「三年目の報告」のほうが、ちょっと心配なくらいアジャイ
ルMAXな感じだったのに比べると対照的でしたが、でもXPな印象はありました。内容
的にはOOをキッチリやりこんでいて、滝管理者も納得するような内容だったと思い
ます。

今、自分が参加しているプロジェクトチームもフレームワークを作っているので、
アジャイル手法で対外プレイヤーとうまく連携するためのコツみたいなものが得ら
れれば‥‥と思っていたのですが、チームで閉じたフェイズのためドキュメント作
成義務などもない、ということでした。

あと、UMLの使い方が印象的でした。自分は会社でシーケンス図とクラス図しか使っ
ていないので、よけいにそう感じたのかも知れません。とりあえず色々と知らない
ことが多すぎだと言うことは痛感しました。


AgileDeveloperConference報告
----------------------------
常に動き続ける平鍋さん。緑色のポインターを持っている手が止まっている写真を
撮ることが出来ませんでした(^^

|常に動き続ける平鍋さん|

「プロジェクトの進路と時期って台風みたいなものだよね」というADCでのプレゼン
風景の写真の写真。デマルコも著書で「プロジェクトの完了日を正確に見積もるこ
とは出来ない。これくらいの時期には何%の確率で完了している」ということを言っ
ていました。アメリカではもう日本みたいな *納期ありき* スタイルは無いんでし
ょうかね？

|プロジェクトの進路と時期って台風みたいなものだよね| 

抽選会
-------
お楽しみの抽選会。XP祭りの景品になぜかASIMOが！ 渋川さん_ の研修先のお店に
ご協力頂いたそうです。

|XP祭りの景品になぜかASIMOが| 

抽選だけで30分以上やっていた気がしますが、自分はなかなか当たりませんでした。
やっぱり13番という番号がよくなかったのかもしれません。

|景品をもらう人々| 

しかし開始15分くらいのあたりでついに13番が呼ばれました！もらったのは 
Aspect指向の本です。日経ソフトウェアのバックナンバーCDも気になったのですが、
Aspect指向も気になる今日この頃です。ちょうど 8/6 に Aspect指向のセミナー_ 
があるようなので、良い機会だし出席してみようかな...でもリリース日だから多分
無理だろうな...(T-T

|私ももらいました！| 


ライトニングトークス
---------------------

7名の方が発表されましたが、 小島さん_ の「XP式新人研修」と、安井さんの「X
P・アジャイル導入時の敷居の高さ」についてが非常に印象に残りました。どちらも
XPをどうやって導入していくのかという内容で、 小島さん_ は

- 新人に最初からXPが普通！と教える
- TestFirst/TDD 無しにはコードを書けない体質にする
- xUnitに慣れたところでxUnit無しで比較体験させる

といった新人研修の手法について。安井さんは

1. まず今やっていない方法(Practice)を導入
2. 今やっていることを良い方法(Practice)に入れ替える
3. 今やっていて無駄なことをやめる

という、既にやりかたが確立してしまっているところにどうやってXPを入れていけ
ば敷居を低くできるかということを淡々とお話しされました。両者とも、XPを導入
したいけど‥‥と考えている多くの会社の人が直面する切実な問題に対するひとつ
のやり方を示してくれていました。

ただ、現場から変えていく方法ではなく上意下達で一気に進める方が良い場面もあ
る、という意見も(夜の懇親会で)ありました。とはいえそれには信頼貯金が結構貯
まっていないと難しいと思いますし、どれだけ説得力のある絵をイメージさせられ
るかがポイントになるんだと思いました。

*# 明日から自分配下の開発チームでTDDを使おうと思っているのですが、滝な人々にTDDを（出来ればTestFirstを）わかりやすく納得しやすいイメージをどうやって見せようか、とずっと悩んでいるところだったりします(^^;*


懇親会
-------

昼間の部と同じくらい重要な夜の部。40名くらい 1_ の参加者が集まりました。そのな
かで 小島さん_ , 青木さん, t-wadaさん_ , manholeさん_ , アマぴょんさん_ , 
他何名かの方々と楽しくも貴重な時間を過ごすことが出来ました。この場でお話し
させて頂いた、テストしにくい環境にTDDを適用するといった話は随時blogに上げて
いきたいと思います（と自分を追いつめてみる）。

|鷲崎さんの一本締め| 

最後は鷲崎さんの一本締めで閉宴となりました。2次会は翌日の仕事の準備等あった
ので出席せずに帰ってしまいました。もったいない、ああもったいない。

次は 8/4の ソフトウェアパターン勉強会_ に参加します。

.. |常に動き続ける平鍋さん|      image:: images/xpfesta2004_hiranabe
.. |プロジェクトの進路と時期って台風みたいなものだよね| image:: images/xpfesta2004_hurricane
.. |XP祭りの景品になぜかASIMOが| image:: images/xpfesta2004_asimo
.. |景品をもらう人々|            image:: images/xpfesta2004_present
.. |私ももらいました！|          image:: images/xpfesta2004_aspectj
.. |鷲崎さんの一本締め|          image:: images/xpfesta2004_closing

.. _渋川さん: http://www.shibu.jp/
.. _小島さん: http://d.hatena.ne.jp/Fujiwo
.. _t-wadaさん: http://d.hatena.ne.jp/t-wada
.. _manholeさん: http://d.hatena.ne.jp/manhole
.. _アマぴょんさん: http://d.hatena.ne.jp/amapyon

.. _Aspect指向のセミナー: http://www.javadeveloper.jp/entryforms/sheet.jsp?src=a20040806aspect
.. _ソフトウェアパターン勉強会: http://patterns-wg.fuka.info.waseda.ac.jp/study/7th.html

.. [1] 訂正： `福井 厚のBlog`_ によると懇親会は60名の参加だったそうです。

.. _`福井 厚のBlog`: http://blogs.users.gr.jp/fukui/archive/2004/07/27/3979.aspx



:comments:
:comment id: 2005-11-28.4370973809
:title: Re: XP祭り2004参加レポート
:author: 福井 厚
:date: 2004-07-28 17:19:12
:email: 
:url: http://blogs.users.gr.jp/fukui/
:body:
福井＠XPJUGスタッフです、こんにちは。
レポート楽しく拝見させて頂きました。

懇親会では幹事を担当させて頂きましたが、最終的には予定参加人数を超えるほど多くの人に参加して頂き、とても盛り上がった楽しい懇親会でした。(^^)



:comments:
:comment id: 2005-11-28.4372144272
:title: Re: XP祭り2004参加レポート
:author: 清水川
:date: 2004-07-29 23:27:09
:email: taka@freia.jp
:url: 
:body:
参加してたくさんの人と会話をすることで良い影響を受けると、また参加したくなりますね。現在、ポジティブスパイラル進行中です！（懇親会中毒？）



:comments:
:comment id: 2005-11-28.4373285698
:title: Re: XP祭り2004参加レポート
:author: 小島＠福井コンピュータ
:date: 2004-07-30 18:41:13
:email: f_kojima@fukuicompu.co.jp
:url: http://www.shos.info/
:body:
懇親会は楽しかったですね．
色々な人と，アジャイル周辺のお話をお腹いっぱいしました．

二次会もすごい良かったですよー．



:comments:
:comment id: 2005-11-28.4374464245
:title: Re: XP祭り2004参加レポート
:author: 清水川
:date: 2004-07-30 19:21:16
:email: taka@freia.jp
:url: 
:body:
> 二次会もすごい良かったですよー．

(&gt;_&lt;)クゥ～～

次こそは最後まで参加！します！
%%%%%%%%%

:id: 40
:date: 2004-07-27 01:18:01
:title: XP祭り2004の感想を書こうと思ったら
:categories: ['Event', 'Agile(XP)']
:body type: text/x-rst
:body:
XP祭り2004の感想を書こうと思ったら、撮ってきた写真の掲載ではまってしまいました。気がついたらヤバイ時間なので掲載は明日に見送ります‥‥。

「XPがいいよね」「目的を見失っちゃだめだよね」なんて会話を懇親会でしてきて、いきなり **XP祭り参加レポートを書く** という目的を見失って、画像をうまく表示する方法を探しに旅立ってしまいました。全然自分をマネジメントできてませんね‥‥。反省。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 41
:date: 2004-07-27 12:36:03
:title: 時間が‥‥
:categories: ['misc']
:body type: text/x-rst
:body:
会社のプロジェクトがけっこう時間いっぱいいっぱいな状況なのですが、社内の情報共有システム構築に関わろうとしていたり、ネットワーク管理のとりまとめをしていたりと、超いっぱいいっぱいな状態です。

*# 昼休みに* XP祭り2004_ *のレポート書こうと思ってたんですけどね..とりあえずJavaWorld買ってこよう。*

.. _XP祭り2004: http://www.xpjug.org/event/20040726maturi/regist


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 42
:date: 2004-07-27 12:39:43
:title: 時間はないけどやってみる
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
土曜日に参加する ZopeWeekend4_ で、ライトニングトークスに参加してみようと思います。LT初参加、果たしてどうなるか....

ネタは「 *LDAPを用いたZope/Samba/FreeBSDシングルサインオン* 」で行ってみたいとおもいます。（出せるネタがそれくらいしかないという話もありますが）

.. _ZopeWeekend4: http://zope.jp/misc/zopeweekend4/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 43
:date: 2004-07-29 00:12:26
:title: 魔食
:categories: ['food']
:body type: text/x-rst
:body:
私は天下一品のラーメンが好きです。特に体力が落ちているときなどに食べると翌日から体調が良くなるような気がします。



:extend type: text/plain
:extend:
ところが、会社の同僚Kさんと akn_ さんは「駅前の天一は食べるとおなかが痛くなる」と言います。なにやら食べてから数時間後に痛みが襲ってきてその日は深夜まで眠れなかった....とか。

自分はそんな目に遭ったこと無いんですけどねぇ....。 **今日までは** (T-T

.. _akn: http://akn.to/

%%%%%%%%%

:id: 44
:date: 2004-07-29 00:17:04
:title: 携帯の電池の持ちが良くなった
:categories: ['misc']
:body type: text/x-rst
:body:
前のアパートは電波の届かない地域...と言うか電波消滅地帯だったらしく、部屋の中では電波強度が１とか圏外とかという状況でした。強度３でも通話中に突然切れる、とか。

引っ越してからというもの、安定した電波供給を受けているらしく、うちのInfobar君の電池の持ちがかなり良くなった気がします。最近は２日おきの充電でも十分持ちます。（折れたアンテナを修理したらもっと持ちが良くなるのかも....）


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 45
:date: 2004-07-29 00:49:15
:title: 家具
:categories: ['misc']
:body type: text/x-rst
:body:
引越て落ち着いてきたので家具の物色をしています。うーん、 ヤマギワ_ の家具いいなぁ...。

*# とりあえず近所の* ニトリ_ *で我慢です*

.. _ヤマギワ: http://www.yamagiwa.co.jp/interior/
.. _ニトリ: http://www.nitori.co.jp/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 46
:date: 2004-07-30 01:30:19
:title: ライトニングトークス資料作成開始
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
やっと資料作成 [1]_ に取りかかりました。まずは書く前に現状のシステムを把握するところから始めます。半年もたつと色々忘れてますねー。

.. [1] `ZopeWeekend 4`_ のLTで発表する「LDAPを用いたZope/Samba/FreeBSDシングルサインオン」

.. _`ZopeWeekend 4`: http://zope.jp/misc/zopeweekend4/


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4397656478
:title: Re: ライトニングトークス資料作成開始
:author: yasiyasi
:date: 2004-07-31 11:16:56
:email: 
:url: http://yasi.minidns.net/blog/
:body:
どうも、はじめまして。
感想につきましては、TrackBackをご参照いただくとしまして。



:comments:
:comment id: 2005-11-28.4398816322
:title: Re: ライトニングトークス資料作成開始
:author: 清水川
:date: 2004-08-01 01:04:09
:email: taka@freia.jp
:url: 
:body:
コメントともども削除しましょうか？



:comments:
:comment id: 2005-11-28.4399944674
:title: Re: ライトニングトークス資料作成開始
:author: yasiyasi
:date: 2004-08-03 09:24:55
:email: 
:url: http://yasi.minidns.net/blog
:body:
風邪で寝込んでいて、返事が遅れて申し訳ありませんm(_)m

コメントもRefelerも消していただいて問題ないかと。


:comments:
:comment id: 2005-11-28.4401116055
:title: Re: ライトニングトークス資料作成開始
:author: 清水川
:date: 2004-08-14 08:16:36
:email: taka@freia.jp
:url: 
:body:
お返事が遅くなりました。とりあえずRefererPluginのIgnoreに設定してみましたが、うまく働いてないようで‥‥。実害は無いから、放っておきますか。


:trackbacks:
:trackback id: 2005-11-28.4402282208
:title: Zope/Samba/FreeBSDのシングルサインオンか
:blog name: YasiYasi's Blog
:url: http://yasi.minidns.net/blog/64
:date: 2005-11-28 00:47:20
:body:
Zope Weekend4での発表「清水川
貴之（KDDIテクノロジー）『LDAPを用いたZope/Samba/FreeBSDシングルサインオン』」に興味があります。興味はありますが、東京での開催なので、はなから参加するのをあきらめていたり（汗）
Windows系とUNIX（私の趣味でFreeBSDが主眼）系との連動自体に興味があるのですが、それに加えてZopeも、となると、もう（笑）
どこかに資料をアップロードしていただけるとありがたいのですが、清水川さんのBlogの日付を見ていると、そんなこ...
%%%%%%%%%

:id: 47
:date: 2004-07-31 10:14:02
:title: 資料作成中
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
昨日も帰ってきたら23時過ぎで、疲れていたこともあってすぐに寝てしまいました。

ということで、当日の朝に慌てて資料を作っていると言う状態です。一度は誰かにレビューして練習しておきたかったなぁ。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 48
:date: 2004-07-31 12:12:52
:title: 結局間に合わず
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
１時の開始に間に合わせるためにはもう出ないと‥‥。結局資料作成は完成まで行けませんでした。電車の中と会場で仕上げるしかないです。

電車の時間まであと11分。 さぬきうどん_ なんて茹でてる場合じゃないですよ！

.. _さぬきうどん: http://www.bellne.com/pc/trends/udon/udon_index.htm


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 49
:date: 2004-08-01 01:59:09
:title: ライトニングなトークをしてきました
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
会場で自宅サーバーを確認しながら資料作成をしていたら突然サーバーが応答しなくなりました。そのタイミングで落ちるとは‥‥何事？

それはさておき、今日のイベント関連記事をまとめてみました。

- Zope Weekend 4 時間はないけどやってみる_
- Zope Weekend 4 ライトニングトークス資料作成開始_
- Zope Weekend 4 資料作成中_
- Zope Weekend 4 結局間に合わず_
- Zope Weekend 4 資料公開_
- Zope Weekend 4 感想_

.. _時間はないけどやってみる: ../42
.. _ライトニングトークス資料作成開始: ../46
.. _資料作成中: ../47
.. _結局間に合わず: ../48
.. _資料公開: ../50
.. _感想: ../51

あと、関連する方々へリンク。

- *Driftkingdom* より `ZopeWeekend4レポート`_
- *Zopeジャンキー日記* より `Zope Weekend 4 会場より`_
- *じんべぇい* より `Zope Weekend 4 Report`_
- *docmaker.net Colums* より `ZopeユーザのためのミーティングZope Weekend 4が開催されます`_
- *YasiYasi's Blog* より `Zope/Samba/FreeBSDのシングルサインオンか`_

.. _`ZopeWeekend4レポート`: http://drikin.com/blogentry.2004-07-31.4273518183
.. _`Zope Weekend 4 会場より`: http://mojix.org/2004/07/31/131426
.. _`Zope Weekend 4 Report`: http://jinbey.com:8080/blog/195
.. _`ZopeユーザのためのミーティングZope Weekend 4が開催されます`: http://columns.office-server.co.jp/localcolumlist.cgi?mode=detail&amp;id=2004073010200580
.. _`Zope/Samba/FreeBSDのシングルサインオンか`: http://yasi.minidns.net/blog/64



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 50
:date: 2004-08-01 02:19:15
:title: 資料公開
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
今日発表した資料を公開します。

- LDAPを用いたZope,Samba,FreeBSDシングルサインオン [ ppt_ ] [ pdf_ ]
- `passwd.py`_

気がつくと25ページもあって、5分でやるには1ページ12秒で進めなければいけませんでした。多分7分くらいかかったんじゃないかと思います。

資料を読んでも同じ構成を構築することは **出来なそう** なところがポイント低いです。ちょっと古い構成の時はちゃんと `Wikiメモ`_ してあるので、同じようなことをするのであればそれを参考にするしかないかと。

自分も今の構成を作るときに `Wikiメモ`_ を参考にしました（笑）

.. _ppt: file/zopeweekend4/lt_ldap_sso.ppt
.. _pdf: file/zopeweekend4/lt_ldap_sso.pdf
.. _`passwd.py`: file/zopeweekend4/passwd.py
.. _`Wikiメモ`: http://www.freia.jp/taka/wiki/X_e3_82_a2_e3_82_ab_e3_82_a6_e3_83_b3_e3_83_88_e4_b8_80_e6_8b_ac_e7_ae_a1_e7_90_86



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 51
:date: 2004-08-01 02:55:02
:title: 感想
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
感想を帰りの電車の中で MindManager_ で書きました。書き漏らした分をここに書きます。

- 情報展開には *萌え* も必要（懇親会）

  - Ploneの *萌え* 系スキンを作る
  - *萌え* 本を作る
  - 入り口の裾野を広げる
  - 隠れた需要を掘り起こす
  - *萌え* で釣れてもイベントに来る人は少ない
  - でも数は少なくてもチカラになるのではないか？

- Zope Weekend 地方巡業（懇親会）

  - 泊まり込みで集中してやる
  - あるいは若干内容は薄目でも短いスパンで開催
  - 遠いためにこれない人材のキャッチアップ
  - 一度参加すれば遠くても参加するようになるかも
  - でも準備が大変


あとはファイルを見てください。一応変換して掲載してはみますが‥‥読みにくいです。 MindManager_ → Excel → CSV → reStructuredText 変換。遠いなぁ。

.. _MindManager: http://www.nsgnet.co.jp/mm/contents/top.htm




:extend type: text/plain
:extend:
感想


:trackbacks:
:trackback id: 2005-11-28.4419020386
:title: Zope Weekend 4 Report
:blog name: Jinbey
:url: http://jinbey.com:8080/blog/195
:date: 2005-11-28 00:47:21
:body:
Zope Weekend 4
に参加。関連ページの一覧を作成する予定です...手抜きでごめんなさい。
%%%%%%%%%

:id: 52
:date: 2004-08-03 00:42:38
:title: ZW4おまけ
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
当日は資料作成をしていたのでほとんど写真を撮れなかったのですが、会場のビル入り口に貼られていた紙を見て、かなり親近感というか和んだので、記念に撮ってみました。

|会場のビル入り口に貼られていた紙|

もっと大きなイベントにならないとこない人もいるだろうし、今の規模だからこそ参加する人もいるんだろうな、と思ってみたり。

.. |会場のビル入り口に貼られていた紙| image:: images/zopeweekend4



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 53
:date: 2004-08-05 02:20:27
:title: パターン勉強会に参加してから会社にモドル‥‥
:categories: ['Pattern', 'OO']
:body type: text/x-rst
:body:
先日の予告通り パターン勉強会_ に参加してきました。今日の内容はテストのためのパターンと言うことで、自分も仕事でTDD導入のために頑張っている（でもC言語）ところなので、是が非でも参加したい内容でした。

太田さんの発表はXP祭りで聞いた内容とあまり変わりませんでしたが、Dependency Injection の話と Aspect の話が絡んでくるとは思いませんでした。やっぱりC言語の世界にとどまっているとそういう情報から疎遠になるのは否めませんね‥‥。

|太田さん| 

次に「みんなが使っているパターンについてディスカッションしましょう」ということになり、自分が参加したチームも発表を行いました。そのときの発表内容を含んだ資料を置いておきます。

パターン勉強会7 [ mmap_ ] [ ppt_ ] [ pdf_ ] [ xml_ ]

MindManager形式(mmap)のファイルを見る Viewer_ があります(11MB...)。後日他の形式のファイルも置くことにして、今日はもう寝ます。


ファイル形式を追加
------------------

2004/08/07 ファイル形式を追加しました。

# *サーバー落ちまくりです‥‥メンテしなきゃ‥‥。*

.. |太田さん| image:: images/patterns7_intro
.. _パターン勉強会: http://patterns-wg.fuka.info.waseda.ac.jp/study/7th.html
.. _mmap: file/pattern/pattern7_memo.mmap
.. _ppt: file/pattern/pattern7_memo.ppt
.. _pdf: file/pattern/pattern7_memo.pdf
.. _xml: file/pattern/pattern7_memo.xml.lzh
.. _Viewer: http://www.nsgnet.co.jp/mm/contents/download.htm




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4425977011
:title: Re: パターン勉強会に参加してから会社にモドル‥‥
:author: WR
:date: 2004-08-05 23:35:01
:email: 
:url: http://www.csus4.net/WR/d/
:body:
昨日はお疲れ様でした。
ディスカッションの時に清水川さんの左隣に座っていたモノです。
正直、ディスカッションが拡散気味だったと思うのですが、非常に巧くマインドマップにまとめられて非常に感動いたしました。
また機会がありましたら、お話などさせてください。


:comments:
:comment id: 2005-11-28.4427134158
:title: Re: パターン勉強会に参加してから会社にモドル‥‥
:author: 清水川
:date: 2004-08-14 08:20:13
:email: taka@freia.jp
:url: 
:body:
お返事が遅くなりました。超多忙な一週間だったため、返事書かなきゃ、と思いつつ１０日ちかくも‥‥。

テストについてはカウボーイテスターな私よりも体系立ってそうで、うらやましい限りです。また色々とお話したいですね。情報収集もかねて(^^


:trackbacks:
:trackback id: 2005-11-28.4428309696
:title: しみずかわさん
:blog name: t-wadaの日記
:url: http://d.hatena.ne.jp/t-wada/20040804#p3
:date: 2005-11-28 00:47:22
:body:
%%%%%%%%%

:id: 54
:date: 2004-08-05 02:27:37
:title: 風邪気味
:categories: ['misc', 'Unix']
:body type: text/x-rst
:body:
風邪気味です。‥‥サーバーが。

どうやらディスクにバッドセクタかなにかがあるらしく、何かのタイミングでフリーズするようです。仕事がイッパイイッパイなので週末まで問題を解消出来ないのがイタイですね。こういうとき付きっきりで看病してあげられないのが‥‥って何の話でしたっけ？（笑）


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 55
:date: 2004-08-09 03:29:33
:title: mod_proxyはいずこ？
:categories: ['Unix', 'Zope']
:body type: text/x-rst
:body:
Zopeのフロントエンドにapacheを配置して、VirtualHostNameを用いてZopeへマッピングする方法はよく使われる方法ですが、今回FreeBSD(5.2.1)サーバーを再構築した際にapacheのバージョンを2.0.50へ上げたところmod_proxyが使えなくなってしまい、かなり苦労しました。


:extend type: text/x-rst
:extend:
apacheが窓口となる場合、例えば http://www.freia.jp/ というサイトへのアクセスをapacheが受信した際に http://localhost:8080/ へ問い合わせて結果をブラウザへ返すことが出来ます。例えば::

  
    ServerAdmin owner@www.freia.jp
    ServerName www.freia.jp
    ErrorLog /var/log/httpd/freia-error.log
    CustomLog /var/log/httpd/freia-access.log combined
    RewriteEngine On
    RewriteRule ^/(.*) http://localhost:8080/$1 [P]
  

と書くと、ブラウザのURL表示は http://www.freia.jp/ のままapacheが内部的にlocalhost:8080へ問い合わせを行ってくれます。ここでポイントとなるのが *RewriteRule* 行の最後にある *[P]* です。これはproxy動作のためのフラグで、これを付けずに::

    RewriteRule ^/(.*) http://localhost:8080/$1

などと書いてしまうと、ブラウザが直接 *http://localhost:8080/* へ問い合わせてしまいますので、ブラウザが稼働しているパソコン自身の8080ポートへ問い合わせが行われます。

このproxyはmod_proxyという外部モジュールで実現されているのですが、FreeBSDのportのデフォルトではmod_proxyが無効になっていました。もしかしたらapache2.0.50標準で無効なのかもしれませんが、調べていません。(セキュリティー上の問題?)

結果的には::

  > make -DWITH_PROXY_MODULES="YES"

としてapacheをビルドし直し、無事使用できるようになったのですが、ここにたどり着くために Makefile, Makefile.modules, Makefile.modules.3rd などを読み解いたり、apacheのproxy/rewrite周りのドキュメントを解読したりと、かなりの時間を食ってしまいました。

ちなみに、ZopeのVirtualHostMonsterを組み合わせて以下のように *RewriteRule* を記述するとZope上の任意のフォルダをそのサイトのルートフォルダとして表示することが出来ます::

    RewriteRule ^/(.*) http://localhost:8080/VirtualHostBase/http/www.freia.jp:80/freiaroot/VirtualHostRoot/$1 [P]

上記の例では freiaroot というZope上のパスをwww.freia.jpにアクセスしたときに表示します。同じページをZopeで直接表示するには www.freia.jp:8080/freiaroot/ となります。これを使えば複数のドメインを単一のZopeサーバーで管理することが出来るようになります。

それにしてもmod_proxyがデフォルトで使えないとなると、またZope環境構築の障害が一つ増えてしまうのではないかと心配です。



:comments:
:comment id: 2005-11-28.4436138366
:title: Re: mod_proxyはいずこ？
:author: えぐち
:date: 2004-08-29 00:15:57
:email: eguchi@sandeinc.com
:url: 
:body:
わたしも 2.0.50 にアップデートしたあたりで mod_proxy でコンパイルされない問題に遭遇し参考になりました。

１点気づいたのですが
> make -DWITH_PROXY_MODULES="YES"
は
> make WITH_PROXY_MODULES="YES"
ですね

また　portupgrade を使うのであれば
/usr/local/etc/pkgtools.conf に
---
   MAKE_ARGS = {
+   'www/apache2' => "WITH_PROXY_MODULES=yes",
   }
---
を追加すると良いですね。



:comments:
:comment id: 2005-11-28.4437345753
:title: Re: mod_proxyはいずこ？
:author: 清水川
:date: 2004-08-29 12:21:40
:email: taka@freia.jp
:url: 
:body:
> make WITH_PROXY_MODULES="YES"

あれ？-Dで指定しないとmakeのターゲットになるんだと思って、他のportsの時も付けてました。

>/usr/local/etc/pkgtools.conf に.....

なるほど。
portupgradeの設定系はほとんど調べてなかったので知りませんでした‥‥。ので、毎回引数に指定していたのでした(--;;



:trackbacks:
:trackback id: 2005-11-28.4438538680
:title: 迷走の日々
:blog name: 週刊ミケ猫通信
:url: http://blog.livedoor.jp/nadias/archives/18243395.html
:date: 2005-11-28 00:47:23
:body:
なにもかもがうまくいかない。
あんまり質問しすぎたせいか鯖缶さんからも無視される始末。
ううう、すいません、他に質問できるならしてますってば！

ということでSSLのほうは放っておいてqwiweb。
あとちょっとという感はあるんだけど、あまりにも情報がすくなすぎ。


:trackbacks:
:trackback id: 2005-12-18.6771786076
:title: apacheのアップデート
:blog name: Ryuji's Note
:url: http://ryujisnote.homeunix.org/blog/15
:date: 2005-12-18 03:21:18
:body:

さて私はtake-laboさんの所の記事を参考にportsのソースを更新→メールで報告
update があった ports を手動で　portsupgtrade する。
ということをいつもやってますが、６日の報告メールで初の事態が。
/usr/sbin/pkg_version -v | grep -v =　 等でVersionを確認。 apache-2.0.55 ?
orphaned: www/apache2 Σ（￣□￣；）みなしご！？
UPDATINGによるとApache2.2がリリースされ...

%%%%%%%%%

:id: 56
:date: 2004-08-11 00:47:03
:title: サーバー生存確認PythonScript
:categories: ['python']
:body type: text/x-rst
:body:
先週からサーバーが頻繁に落ちるため、土日に新しいサーバーを構築しました。ところが新しいサーバーもなにやら調子が良くないらしく、会社から確認した感じでは朝8時～12時の間にWebやSSHの反応が無くなるようです。

そこで、cronで10分おきに記録をとり続けるScriptをPythonで書いてみました。何でもPythonで書いていればそのうち覚えるんじゃないかという目論見もあります。


:extend type: text/x-rst
:extend:
ということで、以下のコードを書いてみました::

  #!/usr/local/bin/python
  
  import os,time
  
  home = "/home/taka/log/ping/"
  
  cmd = "/usr/bin/touch " + home + time.strftime("%Y%m%d-%H%M")
  os.system(cmd)
  
  if time.localtime()[4] ということで、以下のコードを書いてみました::

  #!/usr/local/bin/python
  
  import os,time
  
  home = "/home/taka/log/ping/"
  
  cmd = "/usr/bin/touch " + home + time.strftime("%Y%m%d-%H%M")
  os.system(cmd)
  
  if time.localtime()[4] 

%%%%%%%%%

:id: 57
:date: 2004-08-12 00:30:13
:title: python編集用WZマクロ
:categories: ['WZ']
:body type: text/x-rst
:body:
WZ使いの `M.Shibataさん`_ のサイトで `python編集用WZマクロの試作品`_ が掲載されていました。

自分の環境(WZ5.01C)ではif文の":"補完やdef文の"()"補完などは動作しましたが、残念ながらEnter入力時などのインデント関係はうまく動作しませんでした。設定の関係でしょうか？

ソースをざっと眺めて、拡張子が"py"であるか文書の設定が"python"であれば動作するらしいことは分かりました。全部の処理は追いませんでしたが、とりあえず一カ所だけ。
":"にカーソルを合わせた状態でEnterを入力したときに *pyeditInsertReturn()* 関数で *fIncreaseIndent* がfalseになっているため、次の処理が行われないようです。

普段 Zope_ 上から ExternalEdit_ でpythonを編集することが多いので、実用できるようになればかなり楽が出来そうです。とりあえず草葉の陰から勝手に期待しておくことにします（笑）。

*# それにしてもWZマクロ関連は半年以上触ってないなぁ‥‥*

.. _`M.Shibataさん`: http://www.emptypage.jp/
.. _`python編集用WZマクロの試作品`: http://www.emptypage.jp/whining/2004-08-11.html
.. _Zope: http://zope.jp/
.. _ExternalEdit: http://www.zope.org/Members/Caseman/ExternalEditor/




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 58
:date: 2004-08-12 23:11:13
:title: アクセス数計測
:categories: ['Programming', 'python']
:body type: text/x-rst
:body:
先週辺りから、Worldから自宅サーバーへのアクセスが出来ない現象が多発しています。サーバーのOSを入れ替えてからOSそのものは落ちていないようなのですが、ナゼか外部からアクセスできなくなるようです。試しに定期的に外部にメールを発信するようにしたところ、そのタイミング毎にアクセスが可能になるようで、OSというよりはルータとかを疑った方が良いような気がしてきました。

ところで、今日は何時頃にアクセスできなくなっていたのか、というのを知りたくなったので、apacheのアクセスログを集計してみることにしました。最近pythonで簡単なプログラムを書くのが趣味になりつつあるので、今日もまたpythonで書いてみます。


:extend type: text/x-rst
:extend:
apacheのログから時間単位のアクセス数を計算::

  #!/usr/local/bin/python
  
  import fileinput
  import re
  
  date = re.compile("(\d+)/\w+/\d+:(\d+):(\d+):(\d+)")
  hour = ""
  times = 0
  
  for line in fileinput.input("/var/log/httpd/freia-access.log"):
    time = date.search(line)
    if time:
      groups = time.groups()
      group = groups[0]+" "+groups[1]
      if hour != group:
        print "%s: %s" % (hour, "*"*(times/10))
        hour = group
        times = 0
      times += 1
  
  print "%s: %s" % (hour, "*" *(times / 10))

結果はこんな感じです::

  12 00: ************
  12 01: *******************************
  12 02: *********
  12 03: *
  12 04: *****
  12 05: ***********
  12 06: *********
  12 07: ******
  12 08: ***************
  12 10: ********
  12 11: ***************
  12 12:
  12 13: *************
  12 14: ************************************************
  12 15: *****************************************
  12 16: ****************************
  12 17: ******************************
  12 18: ********************
  12 19: **********************
  12 20: ***********************
  12 21: **************************
  12 22: ****************************
  12 23: ******

‥‥ここまでやってから気づいたのですが、これでは単なるアクセス数集計で、どの辺りでアクセスが途切れているかを知ることは出来ません。だめじゃん。

とりあえず１分単位で集計して途切れタイミングを知ることだけは出来そうですが、会社のサーバーあたりにcron仕掛けて調べる方が現実的ですね。

%%%%%%%%%

:id: 59
:date: 2004-08-13 00:19:26
:title: アクセス隙間検出
:categories: ['Programming', 'python']
:body type: text/x-rst
:body:
アクセス隙間検出。悔しかったのでリベンジです。

datetimeモジュールとtimeモジュールの間でうまく連携する方法が分からなかったので、かなり泥臭い感じになってしまいました。あとprevtimeとbasetimeの初期化が‥‥。



:extend type: text/x-rst
:extend:
apacheのログから10分以上アクセスの無い時間帯を検出::

  #!/usr/local/bin/python
  
  import fileinput
  import re
  import time
  import datetime
  
  date = re.compile("(\d+/\w+/\d+:\d+:\d+:\d+)")
  prevtime = None
  basetime = None
  
  for line in fileinput.input("/var/log/httpd/freia-access.log"):
    logtime = date.search(line)
    if logtime:
      ttime = time.mktime(time.strptime(logtime.groups()[0], 
      "%d/%b/%Y:%H:%M:%S"))
      dtime = datetime.datetime.fromtimestamp(ttime)
      if not prevtime:
        prevtime = dtime
        basetime = dtime
  
      if dtime - prevtime ＜ datetime.timedelta(0,600):
        if basetime != prevtime:
          print "%s while %s" % (basetime, dtime - basetime)
        basetime = dtime

      prevtime = dtime

結果はこんな感じ::

  2004-08-12 00:31:07 while 0:32:59
  2004-08-12 01:18:19 while 0:12:00
  2004-08-12 03:17:27 while 0:42:16
  2004-08-12 04:24:20 while 0:25:58
  2004-08-12 04:50:22 while 0:19:45
  2004-08-12 05:12:41 while 0:19:16
  2004-08-12 05:46:56 while 0:13:45
  2004-08-12 06:27:23 while 0:11:36
  2004-08-12 06:46:56 while 0:25:55
  2004-08-12 07:22:50 while 0:14:44
  2004-08-12 07:48:35 while 0:14:38
  2004-08-12 08:56:30 while 1:07:35
  2004-08-12 10:28:47 while 0:23:49
  2004-08-12 12:12:04 while 0:48:02
  2004-08-12 13:15:28 while 0:44:42

やった！出来た！（笑）

結果を見ると、朝9時と正午前後あたりに外部からアクセスできていない時間帯があります。未だ原因は分かっていませんが、とりあえず定期的に外部に通信を行うようにして回避してみたいと思います。


%%%%%%%%%

:id: 60
:date: 2004-08-15 01:39:17
:title: 男鹿で花火大会
:categories: ['misc']
:body type: text/x-rst
:body:
実家に帰ってきました。

たまたま帰ってきたその日の花火大会の指定席券(?)があるということで、親と男鹿まで花火を見に行ってきました。ほぼ真下から見たのですが、花火が２つ３つ同時に炸裂すると視界よりも広い範囲に広がり、 始終圧倒されていました。いやあれは言葉では説明できない。良い体験をさせてもらいました。親に感謝せねば。

デジカメ持って行かなかったのが悔やまれますが、下手に写真に残るよりも良いのかもしれません。あ、でもケータイで撮っちゃったから駄目か。あああ、記憶の中の花火がブロックノイズで上書きされていく‥‥。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 61
:date: 2004-08-15 01:46:00
:title: reStructuredTextが‥‥
:categories: ['Zope']
:body type: text/x-rst
:body:
なぜかreStructuredTextを表示しようとすると、Zopeがリブートしてしまいます。とりあえずアクセスの多そうなblogのreST表示をそのまま表示するように切り替えました。

weather_pluginを組み込んでblog入力時の天気を記録するようにした時に、なにかおかしくしてしまったのかもしれません。とりあえず明日実験環境を用意して調べてみようと思います。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 62
:date: 2004-08-16 12:09:23
:title: No module named ja
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
reST表示でZopeがリブートする問題_ は解決しました。

原因は、 StructuredText日本語問題_ に対応するために、DocumentClass.pyなど修正・コンパイルしたせいか、あるいはweather_pluginを入れるためにentry_bodyを修正したせいか、、、。

解決法としては、エラーメッセージから適当に当たりを付けて、jaモジュールをでっち上げてみました。

.. _reST表示でZopeがリブートする問題: http://www.freia.jp/taka/blog/61
.. _StructuredText日本語問題: http://www.freia.jp/taka/blog/4



:extend type: text/x-rst
:extend:
エラーメッセージは、以下のようなものがreStructuredTextのレンダリング時にコンソールに表示されていました::

  No module named ja
  Exiting due to error.  Use "--traceback" to diagnose.
  Please report errors to .
  Include "--traceback" output, Docutils version (0.3.4),
  Python version (2.3.4), your OS type &amp; version, and the
  command line used.

最初のうちは *Use "--traceback" to diagnose* に気を取られていたのですが、どうやってZopeからOptionを指定すればいいのかが分からなかったため、そもそもの問題である *No module named ja* に着目してみました。docutils/languages 以下を見てみると、en.pyと言うのはあるのですが、ja.pyは見あたらなかったため、とりあえずen.pyをja.pyにコピー&amp;コンパイルしてみたところ、問題が解消されたようです。

ちなみに、コンパイルには以前教えてもらった方法「pythonを起動して import ja などとする」を行いました。pythonのコマンドラインオプションでpycを作る方法よりもお手軽です。

それにしても、インストール当初は何ともなかったのに何が原因でdocutilsが異常動作するようになってしまったのかがわかりません。 象歩Blog_ によると「Zope で Locale の扱いに問題がある」ようですが、症状発生の原因はやはりよくわかりませんでした。

.. _象歩Blog: http://owa.as.wakwak.ne.jp/zope/coreblog/96




:trackbacks:
:trackback id: 2005-11-28.4461481004
:title: docutilsのUnitTest
:blog name: 象歩Blog
:url: http://owa.as.wakwak.ne.jp/zope/coreblog/98
:date: 2005-11-28 00:47:26
:body:
reStructuredText で落ちるのは、 docutils に ja.py
ファイルが無いためであることの再確認。 docutils-0.3.5.tar.gz
をダウンロードして試してみました。 PYTHONPATH には zope
のパスを指定します。 $ tar xvzf docutils-0.3.5.tar.gz $ cd
docutils-0.3.5/test $ export PYTHONPATH="/usr/lib/zope/lib/python" $ python
test...
%%%%%%%%%

:id: 63
:date: 2004-08-17 00:01:18
:title: ZAmazonを改造してみる
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
先日 `Zope Weekend 4`_ で「 ZAmazon_ というProductを使って‥‥」という話をしたのですが、実際の所 ZAmazon_ は今(2004/08/16)はそのままでは使えなくなってしまっており、そのまま紹介することは出来ない状態でした。

そこで、使える状態にしたものを公開できればと思いgoogleで引いてみると、micro-8さんが `Something Red`_ で書かれている記事 " ZAmazonを使う_ "," `Zamazon Hack for COREBlog`_ " が引っかかり、既に ZAmazon_ を使いやすいように改造した物を配布して‥‥いたようなのですがリンク切れ(^^; とりあえずpythonやProductの改造練習ということで、自分で手を入れてみることにしました。

[ 清水川改造版ZAmazon_ ]

.. _`Zope Weekend 4`: http://zope.jp/misc/zopeweekend4/report/
.. _ZAmazon: http://douweosinga.com/projects/zamazon
.. _`Something Red`: http://somethingred.dip.jp/blog/
.. _ZAmazonを使う: http://somethingred.dip.jp/blog/106
.. _`Zamazon Hack for COREBlog`: http://somethingred.dip.jp/blog/108
.. _清水川改造版ZAmazon: file/zamazon/zamazon_freia1.tgz



:extend type: text/x-rst
:extend:
まず、 ZAmazonを使う_ でも書かれていますが、 ZAmazon_ を手に入れてもそのままでは使えません。引数の数が合っていなかったりしているので、その辺のつじつまを合わせる必要があります。また、AmazonのWebAPIのURLが固定で埋め込まれていたり(URLは時々変わるようです)、アソシエイトIDが埋め込まれていたり(--;; します。そのへんをZope上から設定できるようにQuickHackしてみました。

|ZAmazon追加|

上記の *Amazon License Key* と *Amazon Associate ID* はAmazonで `デベロッパー・トークンを申し込む`_ ことで入手することが出来ます。また、サンプルで使うためにここではidを *zamazon* とします。(タイトルとProxyはオプション)

そして以下のような *DTML Document* を作成して使います 1_ ::

  ＜dtml-var standard_html_header＞
  ＜table border=1＞
    ＜tr＞
      ＜th＞Asin＜/th＞
      ＜th＞SalesRank＜/th＞
      ＜th＞ProductName＜/th＞
      ＜th＞URL＜/th＞
      ＜th＞Media＜/th＞
      ＜th＞OurPrice＜/th＞
      ＜th＞ImageUrlMedium＜/th＞
    ＜/tr＞
  ＜dtml-in expr="zamazon.searchByASIN('4894716658')" 
  prefix="book"＞＜tr＞
      ＜td＞＜dtml-var expr="book_item['Asin']"＞＜/td＞
      ＜td＞＜dtml-var expr="book_item['SalesRank']"＞＜/td＞
      ＜td＞＜dtml-var expr="book_item['ProductName']"＞＜/td＞
      ＜td＞＜a href="＜dtml-var 
      expr="book_item['URL']"＞"＞Link＜/a＞＜/td＞＜td＞＜dtml-var 
      expr="book_item['Media']"＞＜/td＞
      ＜td＞＜dtml-var expr="book_item['OurPrice']"＞＜/td＞
      ＜td＞＜img src="＜dtml-var expr="book_item['ImageUrlMedium']"＞" /＞＜/td＞＜/tr＞
  ＜/dtml-in＞
  ＜/table＞
  ＜dtml-var standard_html_footer＞

これで *ASIN=4894716658* に対応した本、 *人月の神話* についての情報を引き出すことが出来ます。

searchByASINの部分を以下のように書き換えると::

  zamazon.searchByWishlist('3AEH19HYIMCTJ')

自分のWishListを表示_ することが出来たりします 2_ 。

ZAmazon_ は今のままでもコードさえ書けばたいていのことは出来るのですが、micro-8さんのようにCOREblogで使えるようにするとか、辞書でProductNameを引くなどのコードを書かなくても任意の情報を取得できるようにするとかをしていかないと、一般の人への訴求力はかなり弱いですね。

.. [1] なんか&lt;と書いてもだめなので、とりあえず全角で‥‥
.. [2] 少なくとも2004/8/16現在はWishListが表示されます。実験用URLなので‥‥
.. |ZAmazon追加| image:: images/addamazon.jpg
.. _`デベロッパー・トークンを申し込む`: http://www.amazon.co.jp/exec/obidos/subst/associates/join/webservices.html
.. _自分のWishListを表示: http://root.freia.jp/freia/taka/test/ZAmazon
.. _ZAmazon: http://douweosinga.com/projects/zamazon
.. _ZAmazonを使う: http://somethingred.dip.jp/blog/106




:comments:
:comment id: 2005-11-28.4465803217
:title: Re: ZAmazonを改造してみる
:author: micro-8
:date: 2004-08-17 01:33:50
:email: 
:url: 
:body:
実は、リンク切れというか、CVSでコミットしたときに自動でアーカイブしなおすのってかっこいいなと思いつつ、CVSを導入しただけで終わっているのでした(^^;
すなおにcronにすべきかもしれません。


:comments:
:comment id: 2005-11-28.4466949324
:title: Re: ZAmazonを改造してみる
:author: 清水川
:date: 2004-08-17 07:02:44
:email: taka@freia.jp
:url: 
:body:
> CVSでコミットしたときに自動でアーカイブしなおすのってかっこいいなと思いつつ

確かに、かっこいいかも。
COREblogなんかでアーカイブを参照すると、あとでアップデートした時などにリンク問題で悩むんですよね(--;;

%%%%%%%%%

:id: 64
:date: 2004-08-28 13:38:24
:title: ふっかつのじゅもん
:categories: ['Zope']
:body type: text/x-rst
:body:
渋さんのblog__ [1] より。

__ http://www.shibu.jp/blog/491

すげぇ！

- http://www.imasy.or.jp/~yotti/dqoddpswd.html
- http://www.imasy.or.jp/~yotti/dq1passwd.html
- http://www.imasy.or.jp/~yotti/dq2easy.html

.. [#] TrackbackのURLが無い？



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 65
:date: 2004-09-06 23:13:48
:title: pyuiをいじってみる
:categories: ['python', 'Programming']
:body type: text/x-rst
:body:
久しぶりのpythonです。今回は pyui_ をいじってみます。 pyui_ はGUI系のライブ
ラリなので、Xを設定していないFreeBSDではなくWindows上で動かすために、
pythonのインストールから行いました。

.. _pyui: http://pyui.sourceforge.net/



:extend type: text/x-rst
:extend:
1. Python日本語環境用インストーラ_ (python23jp-20030906.exe)
2. PyGame_ (pygame-1.6.win32-py2.3.exe)
3. PyOpenGL_ (PyOpenGL-2.0.1.08.py2.3-numpy23.exe)
4. PIL_ (PIL-1.1.4.win32-py2.3.exe)
5. GLUT_ (glut-3.7.6-bin.zip)
6. pyui_ (pyui095.zip)

GLUT_ と pyui_ 以外はインストーラで簡単にインストールすることが出来ました。
GLUT_ はOpenGLを手抜き利用するためのものらしいですがよく知りません。入手し
たパッケージに入っているglut32.dllを\\Windows\\system32に入れました。

pyui_ は最新版の1.00があるのですが、間違って0.95を使用しました。0.95のパッ
ケージにはWindows専用インストーラは含まれていませんでしたので、展開してコマ
ンドラインから以下のコマンドを入力してインストールしました::

  c:\pyui95＞ python setup.py install

準備が整ったので、早速実験です。まずは pyui_ のサイトにあるサンプルを入力し
て、以下の最小のサンプルに行き着きました::

  import pyui
  pyui.init(400,300)
  pyui.run()

真っ黒なWindowが表示されて、あとはコンソールにFPSが流れていきます。さすがに
意味のあるサンプルにしたいので、もう一行追加::

  import pyui
  pyui.init(400,300)
  pyui.widgets.Frame(10,10,100,100,"test")
  pyui.run()

無事Windowが表示されたところで、今日はここまで::

  pyui.quit()

おまけ： pyui.widgets.Frame() を３つ出してみる
--------------------------------------
|pyuitest1|


.. _pyui: http://pyui.sourceforge.net/
.. _Python日本語環境用インストーラ: http://www.python.jp/Zope/download/pythonjpdist
.. _PyGame: http://www.pygame.org/download.shtml
.. _PyOpenGL: http://sourceforge.net/project/showfiles.php?group_id=5988
.. _PIL: http://www.pythonware.com/products/pil/
.. _GLUT: http://www.xmission.com/~nate/glut.html
.. |pyuitest1| image:: images/pyuitest1


%%%%%%%%%

:id: 66
:date: 2004-09-09 00:59:32
:title: pyuiの練習
:categories: ['python', 'Programming']
:body type: text/x-rst
:body:
今日はpyuiのmenuをいじってみました::

 import pyui
 pyui.init(800,600)
 def onCreate(item):
  pyui.widgets.Frame(50,50,100,100,item.text)
 menu=pyui.widgets.Menu("create")
 menu.addItem("Green", onCreate)
 menu.addItem("White", onCreate)
 menubar = pyui.widgets.MenuBar()
 menubar.addMenu(menu)
 pyui.run()



:extend type: text/x-rst
:extend:
しかし、これではつまらないので、Menuの選択毎に違う挙動をさせてみたいと思います。本来であれば挙動を定義した関数(上記の例ではonCreate)を複数用意してそれぞれのMenuItemに登録するところですが、ここではlambdaを使って1行で書いてみたいと思います::

  import pyui
  pyui.init(800,600)
  menu=pyui.widgets.Menu("create")
  menu.addItem("Window" ,lambda item: pyui.widgets.Frame(50,50,100,100,item.text))
  menu.addItem("Console",lambda item: pyui.dialogs.Console(100,100,200,100))
  pyui.widgets.MenuBar().addMenu(menu)
  pyui.run()


なかなかすっきりしました。

実際の所、lambdaの乱用はしない方が賢明なのですが、とりあえずlambdaの練習ということで、もう一歩踏み込んでlambdaを使ってみました::

  import pyui
  pyui.init(800,600)
  pyui.widgets.MenuBar().addMenu((lambda menu=pyui.widgets.Menu("create"): menu.addItem("Window",lambda item: pyui.widgets.Frame(50,50,100,100,item.text)) and menu.addItem("Console",lambda item: pyui.dialogs.Console(100,100,200,100)) and menu)())
  pyui.run()

もう読めません（笑）

途中からpyuiは関係なくなってしまいましたが、こんな事も出来る、というのを体験してみたかったと言うことで。
おかげで、既存のpythonのコードを読んでいて時々出てくる and と or を使用したif文の短絡表記方法が理解できました。

やはり習うより慣れろ、という事で、実際にコードを書かないと文法とか表現って身に付かないですね。

%%%%%%%%%

:id: 67
:date: 2004-09-10 00:52:19
:title: ドキュメント自動生成計画
:categories: ['Programming']
:body type: text/x-rst
:body:
仕事のプロジェクトで、慢性的に人手が足りていません。そこで、ドキュメントは出来るだけ自動生成にしようと画策しています。

今のところ、 doxygen_ と CUnit_ を使用して以下のドキュメントが自動生成されています。

- APIリファレンス
- 単体テスト項目書
- 単体テスト成績書

会社のモノを勝手に公開するわけにはいかないので、残念ながら成果物を掲載することは出来ないのですが、生成手順についてメモしておきます。

.. _doxygen: http://www.doxygen.org/
.. _CUnit: http://cunit.sourceforge.net/



:extend type: text/x-rst
:extend:
APIリファレンス
---------------
::

  doxygen_ → html → HTML Help

htmlからWindowsのHTMLHelp形式にするためには、MicrosoftのサイトからHTML Help Workshopをダウンロードしてインストールしておく必要があります。あとはdoxyfileにGENERATE_HTMLHELP = YES と記述して、関連する項目(コンパイラのパス等)を設定するだけで、doxygenが自動的に生成してくれます。

ただし、あまり見やすいヘルプは作ってくれません。自分は、@mainpage と @defgroup を使って、提供機能からAPIを引けるように工夫してみました。


単体テスト項目書
----------------
::

  doxygen_ → XML → 自作XSLTと結合して HTML

GENERATE_XML = YES とすることで、 doxygen_ はXMLを出力してくれます。そこで、XMLに自作のXSLTを結合させて、自動生成のHTML(HTMLHelp)よりも見やすく作ってみました。XMLとXSLTの結合には `Apache XML project`_ の xt を使用しました。

`xt導入`_ には若干手間取りましたが、googleで見つけたサイトで手順が書かれていたので、すんなりと導入することが出来ました。‥‥が、IE6.0の出力結果と微妙に違うようです。

実はHTMLに変換した理由は別にあって、WordでHTMLを読み込ませて、Wordファイルとして提出するためだったりします。別にWordじゃなくても‥‥とか思うんですけどねぇ。


単体テスト成績書
----------------
::

  CUnit_ → XML → 自作XSLTと結合して HTML

CUnit_ もXMLを出力することが出来るので、これもXSLTを用意しました。項目書と成績書の両方ともXMLなのだから、もう一工夫すれば項目書にテスト結果も載せることが出来ると思います。今回は時間が無いので、これは次回の課題としておきます(^^;

今後の自動生成
----------------
次は、後日メンテ用の内部設計書ですかね。あと、コマンド一発で

1. VSSからソース取得
2. VC++でコンパイル
3. テスト実行
4. ドキュメント生成(doxygen,xt)
5. ドキュメントアップロード

とかやってみたいですね。

.. _doxygen: http://www.doxygen.org/
.. _CUnit: http://cunit.sourceforge.net/
.. _`Apache XML project`: http://xml.apache.org/
.. _`xt導入`: http://www.dabesa.org/xml-tips/xslt.html




:comments:
:comment id: 2005-11-28.4481052000
:title: Re: ドキュメント自動生成計画
:author: うっちー
:date: 2005-06-08 15:34:14
:email: hse_uchiyama@access.co.jp
:url: 
:body:
突然質問して申し訳ありません。
うっちーと申します。

CUnitを使用しようとして、セットアップしていますが、
うまくいきません。

Visual Studio 6.0で、CUnit.dswを開いて、
ビルドしようとしていますが、
CUnitはライブラリまで作成できますが、
BasicTestでリンク中外部シンボルは未解決とのエラーになってしまいます。

セットアップの方法が分かるでしたら、
教えていただけないでしょうか？
宜しくお願いいたします。


:comments:
:comment id: 2005-11-28.4482233834
:title: Re: ドキュメント自動生成計画
:author: 清水川
:date: 2005-06-09 00:15:30
:email: taka@freia.jp
:url: 
:body:
> CUnitはライブラリまで作成できますが、
> BasicTestでリンク中外部シンボルは未解決とのエラーになってしまいます。

こんにちは^^

多分、ライブラリと利用側とのコンパイルオプションが異なっているために外部リンケージが見つからないのだと思います。
CUnit のコード生成のオプションはシングルスレッド(/ML)なので、利用側のオプションが一致しているか確認してみてください。異なっていた場合、利用側を合わせるのか、ライブラリ側を変えるのかは必要に応じて決めればいいと思います。



:trackbacks:
:trackback id: 2005-11-28.4483404550
:title: [プログラミング]
:blog name: きまぐれのらねこにっき
:url: http://d.hatena.ne.jp/sakuneko/20051109#p3
:date: 2005-11-28 00:47:28
:body:
%%%%%%%%%

:id: 68
:date: 2004-09-10 12:32:36
:title: 天気が常に"曇り"
:categories: ['Zope']
:body type: text/x-rst
:body:
blogの各エントリーに、登録時の調布の天気を表示するようにしているのですが、常に曇っている気がします。‥‥たまたま？



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 69
:date: 2004-09-25 23:01:26
:title: 休暇
:categories: ['misc']
:body type: text/x-rst
:body:
ここのところIT疲れの症状が出ていて、IT関連に全く興味が向かないという状況が続いていました。高校生くらいから時々あることなのですが、プログラミングとかUnixネットワーク構築とか情報系に長い期間集中していると、ある日突然IT方面にまったく興味が向かなくなってしまうのです。そういうときは小説とか本を読んだりして過ごしていました。

今回は仕事が原因の様な気がします。今週は有休を取ることが出来たので、今日までの7日間をIT以外のことをして過ごしてみました。

ゲーム
-------
- ICO
- プリンスオブペルシャ -時間の砂-
- スキャンダル
- BLOOD THE LAST VAMPIRE 上巻
- BLOOD THE LAST VAMPIRE 下巻

映画
------
- MEMENTO
- CUBE2
- BLOOD THE LAST VAMPIRE
- 黄泉がえり

*# テレビゲームはITに含まれないと思う*



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 70
:date: 2004-09-25 23:19:21
:title: samba3.0へ移行
:categories: ['Unix']
:body type: text/x-rst
:body:
先日サーバーを入れ替えたときにsambaを2.2.xから3.0.xへ移行したのですが、LDAPスキーマの移行が面倒そう(笑)だったのでとりあえず自分のアカウントだけsmbpasswdに作っておいたのでした。とはいえ、そろそろあちこち中途半端なのをなんとかせねばなぁ……ということで、samba.schemaを2.2.xから3.0.xへ移行しました。



:extend type: text/plain
:extend:
移行はUNIX USER 2003年12月号を参考に行いました。以下、その概要です。

1. slapcat -l samba2.ldif
2. net getlocalsid > sid
3. [samba3]/example/LDAP/convertSambaAccount --sid=[2のsid] --input samba2.ldif --output samba3.ldif
4. ldapのデータを初期化
5. slapadd -l samba3.ldif

上記4で、データの上書き・初期化方法が分からなかったので、データベースファイルを削除してしまいました。……いいのかな？

とりあえずsambaのアカウントをLDAP参照にすることはできました。あとこのほかにZope上から変更とか、Unixアカウントと同期とか、pythonでスクリプト組むとかいろいろとやりたいことが残っていますが、ま、ぼちぼちやっていこうと思います。


%%%%%%%%%

:id: 71
:date: 2004-09-29 23:48:54
:title: ATOK17
:categories: ['misc']
:body type: text/x-rst
:body:
さっきパソコンを立ち上げたら日本語入力が使えなかった！です。弟からIMが入ったのに返事が出来ない。仕方ないのでとりあえず「ou, wakatta.」とか会話してました。

先日PCの掃除をしていて、不要なアプリケーションの削除を行いました。Windowsの「アプリケーションの追加と削除」で見ると、一度試しただけのアプリなどに混じってATOK17βテスト版が入っていました。以前βテストしたときのものがそのまま入っており、ATOK17製品版と２重に入っているようでした。

で、β版の方をアンインストールしたせいで、ATOKが使えなくなったようです‥‥。多重インストールした自分が悪いんですけどね。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 72
:date: 2004-09-29 23:50:08
:title: 天気が常に"曇り"
:categories: ['Zope']
:body type: text/x-rst
:body:
今外は台風の影響で雨が‥‥。天気pluginの設定間違えてるかな？


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 73
:date: 2004-10-05 07:06:11
:title: 勉強会が重なった...
:categories: ['misc', 'Event']
:body type: text/x-rst
:body:
パターン勉強会_ と Plone研究会_ の日程がぴったりと重なってしまいました。ううむ‥‥どっちに出よう？

.. _パターン勉強会: http://patterns-wg.fuka.info.waseda.ac.jp/study/
.. _Plone研究会: http://mm.tkikuchi.net/pipermail/zope-users/2004-October/004968.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 74
:date: 2004-10-06 21:54:41
:title: 勉強会出られず
:categories: ['misc', 'Event']
:body type: text/x-rst
:body:
パターン勉強会_ に出るつもりだったのですが、仕事が忙しくて結局出られませんでした。
仕事が忙しくて勉強できない、なんて環境は良くないと思うんですけどね‥‥。

最近学習が止まってるなぁ。

.. _パターン勉強会: http://patterns-wg.fuka.info.waseda.ac.jp/study/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 75
:date: 2004-10-14 00:53:42
:title: InternetDisk使い始めました
:categories: ['misc']
:body type: text/x-rst
:body:
Justsystem_ の InternetDisk_ サービスを使い始めました。以前から気になっていたのですが、１ヶ月無料ということで試用開始しました。（100MBで１ヶ月300円ですが...）

ポイントは、ファイルのコピーを意識せずに離れた場所でファイル同期出来る、というところでしょうか。とりあえず、自宅と会社でちまちまと書き続けているpythonのコードを同期させてみたり、シェアウェア等のライセンスコードを書き留めたファイルを同期させたりしています。

他にも、ATOK17用の同期ツールとiDiskを連動させて辞書を最新の状態に保ったりもできます。しかし、自宅と会社とでは使う用語が異なるので同期するのが良いとは言い切れなかったりもして微妙だったりします。

残念な点は、Internet接続必須というところ……ってそれが売りなのか。

今までPDAを経由して同じようなことはしていたのですが、同期し忘れたり、PDAを忘れたりして何度か痛い目にあったこともあり、自分の使い方においてはiDiskの方が使い勝手が良いようです。

.. _Justsystem: http://www.justsystem.co.jp/
.. _InternetDisk: http://internetdisk.jp/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 76
:date: 2004-10-14 01:01:34
:title: ハーゲンダッツ アップルパイ 発売！
:categories: ['food', 'misc']
:body type: text/plain
:body:
ひと口目はシナモンの香りしかしませんでした。
ふた口目はアップルシナモンでした。
慣れるとまぁまぁアップルパイでした。

ところで、パイ生地はいらない気がします＞メーカーさん


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 77
:date: 2004-10-16 00:03:25
:title: 秋田人チェック
:categories: ['misc']
:body type: text/x-rst
:body:
aihatena_ から 秋田人チェック_ のサイトを教えてもらいました。なんか、あたりまえのことしか書いてない様な気が……（笑

他にいくつか思いついたのでメモ。

- 比内鶏は天然記念物なので普段食べているのは比内地鶏だと知っている
- 山王吾作ラーメンの隣にあるのはSL寿司吾作だ
- 金満のCMが変わったのは許せない
- 家電と言えばデンコードーだ
- AAB(秋田朝日放送)が来るまでは民放は2chだった

.. _aihatena: http://www.freia.jp/aihatena/
.. _秋田人チェック: http://www.linkclub.or.jp/~keiko-n/akita.html



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4517934314
:title: Re: 秋田人チェック
:author: aihatena
:date: 2004-10-18 17:34:50
:email: 
:url: 
:body:
・金満ではなく金萬だ


:comments:
:comment id: 2005-11-28.4519053762
:title: Re: 秋田人チェック
:author: 清水川
:date: 2004-10-19 01:04:37
:email: taka@freia.jp
:url: 
:body:
秋田人からキビシイつっこみ！
秋田度が1下がった！



:comments:
:comment id: 2005-11-28.4520182909
:title: Re: 秋田人チェック
:author: つかぽん
:date: 2004-11-21 09:08:19
:email: 
:url: http://jab-an.plus9.info/
:body:
現役秋田人的に答えてみよう。

    * 比内鶏は天然記念物なので普段食べているのは比内地鶏だと知っている
A.正確に言うとあれは1代雑種。ロードレッドアイランドとの交配だっけ？（From美味しんぼ）
    * 山王吾作ラーメンの隣にあるのはSL寿司吾作だ
A.もうないぞ！もはやサンクスだ！
    * 金満のCMが変わったのは許せない
A.金萬28個食ベマシタ
    * 家電と言えばデンコードーだ
A.昔コジマ今ヤマダじゃないの？
    * AAB(秋田朝日放送)が来るまでは民放は2chだった
AAB5chに設定するか10chに設定するかで喧嘩になるポ。
CATVでTBS（IBC)が見れるぞ（浜田はエリア外じゃ！）
ファミコンは昔から1chだぞ（関東は2chだな）。

ε≡≡≡へ(#＞△＜)ノニゲロッ！


:comments:
:comment id: 2005-11-28.4521394720
:title: Re: 秋田人チェック
:author: 清水川
:date: 2004-11-21 09:33:45
:email: taka@freia.jp
:url: 
:body:
> A.昔コジマ今ヤマダじゃないの？

いやいや、パソコンソフトを買おうと思ったらデンコードー以外ありえなかった。秋田駅前、ホテルハワイの向かいあたりにあったデンコードー。

> ファミコンは昔から1chだぞ（関東は2chだな）。

あ～、そうそう。ファミコンは1chだった。それでおもいだした。
* NHKと言わず、9chと言う。（2chは教育）



:comments:
:comment id: 2005-11-28.4522549924
:title: Re: 秋田人チェック
:author: つかぽん
:date: 2004-11-21 10:35:36
:email: 
:url: http://jab-an.plus9.info/
:body:
＞駅前のデンコードー
パソコンソフトはたしかにそうかもしれん。
あそこケータイ専門から今は空き店舗に(/_;)

*フジ系(AKT)は12chか37ch
%%%%%%%%%

:id: 78
:date: 2004-10-19 01:02:22
:title: KCOMのダイヤルアップサービスが終了
:categories: ['misc']
:body type: text/x-rst
:body:
KCOMから `ダイヤルアップ・フレッツサービス終了のご案内`_ が届きました。ダイヤルアップそのものは使っていなかったのですが、メールアドレスが変わってしまいます。

当初、14,400bps時代にどこぞのプロバイダから始めて、ASCII Internet Freeway 1_ 、Dolphin 2_ を経てKCOM 3_ を使うようになってからメールアドレスをずっと使い続けてきました。途中、ASAHI-NET 4_ に乗り換えた後も一番安いコースに切り替えてKCOMのメールアドレスを使い続けて来たのですが、それも来年の9月までで変更することになりそうです。

とはいえ、最近KCOMアカウント宛のSPAMメールが日に30～50通はくるのでさすがにアドレス変えようかな、と考えていたところでした。自宅サーバーは若干の不安があるので外部のアドレスを何か‥‥インフラに左右されずに使えるのがあればいいのですが。


.. [1] 常に最前面に広告が出るタイプの無料サービスでした。しかし、Diabloやるには広告Windowが邪魔でDolphinに乗り換えたのでした。

.. [2] Dolphin はINS128サービスをINS64と同じ価格で提供してくれました。当時 NetVehicleEX3 でテレホタイムに接続しては日に数百MBのファイル（FreeBSDのパッケージ等）をダウンロードしたりしていました。

.. [3] KCOMに乗り換えた理由は忘れてしまいました。

.. [4] Flet's への対応が遅かったためにKCOMから乗り換えました。安いし。今は実質、CATV経由なのですが、ASAHI-NETのFlet's用アカウントを二つ持っていたりします。使ってないけど。

.. _`ダイヤルアップ・フレッツサービス終了のご案内`: http://www.kcom.ne.jp/access/annai/index.html


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 79
:date: 2004-11-19 22:26:19
:title: こどものびょうき
:categories: ['misc']
:body type: text/x-rst
:body:
先週の水曜深夜に突然38度の熱を出してしまいました。翌日はさすがに会社を休んだのですが昼過ぎから耳が痛くなって耳鼻科に行ったら中耳炎との診断。

その日の夜、限界を超えた痛みをこらえながら救急病院で鎮痛剤をもらってきました。耳が痛くて涙が出たのは始めてかも。「あの痛みは体験してみないと理解できない」と言う尿道結石の人の気持ちがすこしだけ理解できました。（あんたら、すごいよ＞K&A）

で、一週間たった今日もまだ耳が良く聞こえません。そろそろ治って欲しいなぁ。

ところで、中耳炎でWebを調べてみると、子供の話しか載ってないのデスね‥‥。


:extend type: text/plain
:extend:


:comments:
:comment id: 2006-03-03.4551398978
:title: Re:こどものびょうき
:author: Anonymous User
:date: 2006-03-03 23:00:56
:email: ｔａｍｍｙｓ＠ｍｘ３．ｋｃｔ，ｎｅ．ｊｐ
:url: 田沢悠
:body:
これを呼んで子供はいろいろなびょうきにかかるんだなと思いましたかわいそうだなと思いました。「今日僕の友だちの弟の手ずつがありました。足・手の手筒がありました。学校のみんなで千羽ずるをおりました。

%%%%%%%%%

:id: 80
:date: 2004-11-20 11:19:40
:title: PS2延長ケーブル改造
:categories: ['misc']
:body type: text/x-rst
:body:
自宅のPSXには、先日発売された `Logicoolの無線コントローラー`_ が接続されています。しかし、このコントローラーのホスト側、無線アダプタが若干厚いために、PSXに２個装備することは出来ませんでした。無線アダプタ１個と普通のPS2コントローラは同時に接続できるので、微妙な厚さが恨めしいわけです。

そこで、市販の延長ケーブルを買ってきて繋いでみることにしました。

|psx_wl_cable1|

ところで、このケーブルは2mあります。つまりPSXの後ろには2mのケーブルが接続され、その先に小さい無線アダプタが接続されることに‥‥それはちょっと‥‥と思いケーブルを短く改造することにしました（昨日ヨドバシで見かけて、800円なら、と思って改造目的でケーブルを買ってきたんですが）。

で、作業時間１時間の結果がこれです。まぁまぁの出来でしょう。土曜の朝９時から、なんだかクリエイティブな気分に浸ることが出来ました。

|psx_wl_cable2|



.. _`Logicoolの無線コントローラー`: http://www.logicool.co.jp/products/gamecontrollers/lpgc_60000.html
.. |psx_wl_cable1| image:: images/psx_wl_cable1
.. |psx_wl_cable2| image:: images/psx_wl_cable2




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4532521694
:title: Re: PS2延長ケーブル改造
:author: ZERO510
:date: 2005-08-15 10:36:34
:email: jin510@topaz.plala.or.jp
:url: http://plaza.rakuten.co.jp/tomohisa1227/
:body:
同感です！ＰＳＸの裏にいちいちコントローラを差し替えるのは
面倒だと思い、Logicoolの無線コントローラを買いましたが
二つつけれませんでした！！（Ｔ0Ｔ）
が、延長ケーブルのお陰で出来そうです！
困っている方におすすめします！！！！！！（＾0＾）/
ちなみに、改造は簡単でしたか？（＾0＾）？
僕も出来ますかな！


:comments:
:comment id: 2005-11-28.4533673211
:title: Re: PS2延長ケーブル改造
:author: 清水川
:date: 2005-08-16 12:06:11
:email: taka@freia.jp
:url: 
:body:
ぶっちゃけ、コード束ねておけばいいかな、とか思ったり思わなかったり。改造自体はケーブル切って導線繋げる(絶縁剥いて縒る)だけなので、根気があれば出来ると思いますよ。

%%%%%%%%%

:id: 81
:date: 2004-11-20 16:26:35
:title: Zopeでナビゲーション
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
#ですます調に疲れたので、だである調に変更しますです（笑

最近はナビゲーションに対応したブラウザも増えてきたので、自サイトもナビゲーション用のタグを導入してみようと思う。ナビゲーションタグは *<head></head>* 内に::

  <head>
    <link rel="home" href="...." /> 
    <link rel="up" href="...." /> 
    <link rel="index" href="...." /> 
  </head>

と言う感じに記述するらしい。

せっかくZopeを使っているので、各ページに埋め込まずにこれを実現する方法を考えてみた。今回思いついたのは、standard_html_headerの中からpythonスクリプトを呼び出して、 **獲得** を使って必要なナビゲーション(例えばup)を探し、見つかったらそれのURLを *<link rel...>* で埋め込む方法だ。

まずstandard_html_headerに以下の文を埋め込んでおく::

  <dtml-var "navigation('index')">
  <dtml-var "navigation('author')">
  <dtml-var "navigation('home')">
  <dtml-var "navigation('contents')">
  <dtml-var "navigation('search')">
  <dtml-var "navigation('help')">
  <dtml-var "navigation('copyright')">
  <dtml-var "navigation('alternate')">
  <dtml-var "navigation('parent')"><!--same as up-->
  <dtml-var "navigation('up')">
  <dtml-var "navigation('first')"><!--same as begin-->
  <dtml-var "navigation('begin')">
  <dtml-var "navigation('prev')">
  <dtml-var "navigation('next')">
  <dtml-var "navigation('last')"><!--same as end-->
  <dtml-var "navigation('end')">

次に、ここで呼び出されるnavigationというオブジェクトをPythonScriptでルートフォルダに用意。中身はこんな感じ::

  try:
    # targetはscriptの引数。"home"とか"up"とかが入ってくる
    # 今見ているページからtargetの獲得に挑戦。失敗するとexceptへ。
    attr = getattr(context,target)

    # targetと同じ名前のプロパティーとかを捕まえた場合、とりあえず失敗。
    if not hasattr(attr,"meta_type"):
      return '<!--find same name as %s-->' % target

    # みつけたtargetがscriptの場合は値をもらってそのまま返す
    if attr.meta_type == "Script (Python)":
      return attr()

    # script以外が見つかったら、見つけたtargetのurlを返す
    return '<link rel="%s" href="%s" />' % (target,attr.absolute_url())

  except:
    pass

  # 失敗したら一応コメントアウトした文字列だけ返す
  return '<!--link rel="%s"-->' % target

あとは獲得可能な場所に index とか copyright とかの名前でDTML Documentなどを置いておけば、ナビゲーションバーで対象ドキュメントに飛ぶことが出来るようになる、という寸法。ただ、特定のドキュメントを表示したくない場合、たとえば up(親階層) などの場合はDTML Documentでは面倒なので、Python Scriptを up という名前で置いておいて、スクリプトで親階層のURLを含む <link rel...> 文字列を返すように作ればいいようにしてある。

up のPython Scriptの中身は以下のような感じ::

  request = container.REQUEST

  url = request.URL1

  # 今のページが最上位であればコメント文字列を返して終了
  if url == request.BASE0:
    return '<!--link rel="up" href="/"-->'

  # 一つ親の区切りを探す
  col = url.rfind("/")

  # サーバー名まで浸食されたら失敗
  if col < url.find("//")+1:
    return '<!--link rel="up" href="/"-->'

  # 階層一つ分削って link タグを返す
  return '<link rel="up" href="%s">' % url[:col]

findしないでsplit("/")とjoinで構築しようと思ったのだが、なぜかjoin( s, "/")で失敗してしまうため、断念。pythonのヘルプ等には *第二引数で連結部分に入れる文字を指定* と書いてあるのに、なぜか::

  join() takes exactly one argument (2 given)

といって怒られる始末。不思議だ。

今回の方式のウリは、獲得を使っているので必要なところでオーバーライドすることが出来ること。というかこれが出来ないとWebサーバーという性質上話にならない。nextやprevのリンク先がWebサーバー上の前ページで固定でも誰も嬉しくない。

あとの問題は、今回の方式でナビゲーションのリンク先を用意すると、ルートフォルダ等にナビ用のオブジェクトが散乱すること。いちおう手元のはサブフォルダを指定できるようにしてみたけど、あんまり美しくない‥‥。この後の課題ということにしておこう。




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 82
:date: 2004-11-20 16:39:38
:title: Zopeでナビゲーション２
:categories: ['Zope']
:body type: text/x-rst
:body:
`先ほど`_ 作ったナビゲーション用の仕組みはstandard_html_headerに仕込んでいるのだが、COREblogではstandard_html_headerを読み込まないようになっているようなので、standard_html_headerを読み込むように修正してみた。

と言っても、ごくごく簡単で、blog_headerの中身を::

  <dtml-var standard_html_header>

の一行に置き換えただけ。
ただ、これだけだと元のblog_headerにせっかく書いてある *<link rel="alternate" ...>* を消してしまうことになるので、contentsフォルダ内に alternate という名前でPython Scriptを書いて、元々書いてあったタグを返すように変更した。

また、同様にstyle seetの読み込みも消えてしまう、というかstandard_html_headerで指定しているものに置き換わってしまう。自分の場合、standard_html_headerでは default.css というのを読み込んでいるため、先ほどと同様にcontentsフォルダ内に default.css という名前のDTML Methodを作成して、中に一行::

  @import url("style_css");

としてあげた。

これでCOREblogのページでもナビゲーションが表示されるはず。対応ブラウザの方、表示されてますか？（笑）

実は、 `先ほど`_ のnavigationスクリプトはCOREblogで上記の処理をしたときに発生した問題の対処がされている。というのは、ナビゲーション名 "search" がCOREblogのプロパティー(?)とぶつかってしまっていたため、 search.meta_type なんてアクセスするとエラーになってしまっていたのだ。というかそもそもナビゲーションの名前は up とか next とかなのであちこちぶつかりそうな予感がしなくもない。

さて、どうしよう‥‥。


.. _`先ほど`: http://www.freia.jp/taka/blog/81



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4540920650
:title: Re: Zopeでナビゲーション２
:author: つかぽん
:date: 2004-11-21 21:16:40
:email: 
:url: http://jab-an.plus9.info/
:body:
Firefox1.0+LinkToolbar0.9で動きましぇーん。


:comments:
:comment id: 2005-11-28.4542069115
:title: Re: Zopeでナビゲーション２
:author: つかぽん
:date: 2004-11-21 21:20:29
:email: 
:url: http://jab-an.plus9.info/
:body:
ちなみに動かないのは前後移動ね。


:comments:
:comment id: 2005-11-28.4543212418
:title: Re: Zopeでナビゲーション２
:author: 清水川
:date: 2004-12-06 01:41:09
:email: taka@freia.jp
:url: 
:body:
実は前後は実装してないのでした。まだ親階層とホームだけです。

で、今日ちょっとやってみたけどこれがなかなか‥‥むずいーー


:comments:
:comment id: 2005-11-28.4544358357
:title: Re: Zopeでナビゲーション２
:author: 清水川
:date: 2004-12-06 02:10:38
:email: taka@freia.jp
:url: 
:body:
できました。分かってみたら簡単でした。

	return '' % item.entry_url()

と書くべき所を


としていたのが原因。関数オブジェクトをforループに渡してもうまく動く訳がなかったという‥‥。DTMLとごっちゃになってるなあ。



:comments:
:comment id: 2005-11-28.4545502823
:title: Re: Zopeでナビゲーション２
:author: つかぽん
:date: 2004-12-07 20:40:52
:email: 
:url: http://jab-an.plus9.info/
:body:
おお、動いた動いた。
%%%%%%%%%

:id: 83
:date: 2004-11-23 14:37:53
:title: WindowsからのVPN接続認証をLDAPで管理する on FreeBSD5.2.1
:categories: ['Unix', 'Memo']
:body type: text/x-rst
:body:
以前からWindowsクライアントからのVPN接続時の認証管理をLDAPで出来ないか、と考えていましたが、freeradiusを使うことで成功しました。実は mpd (PPPサーバー・クライアントソフト) がRADIUSサーバーと連携できることは知っていたのだけど「RADIUSじゃなくてLDAPと連携して欲しいなぁ‥‥」と思うにとどまっていました。で、ふと思いついて、"RADIUS LDAP"で検索したら「 `LDAP を使った Radius 認証`_ 」というページがあっさりと引っかかったので、他のサイトも調べつつ色々と試してみたらうまくいきました。

ということで、目標。

1. mpdとfreeradiusを連携させる
2. freeradiusとOpenLDAPを連携させる
3. LDAP内にプレーンテキストでパスワードを格納しない（重要！）


.. _`LDAP を使った Radius 認証`: http://www.linux.or.jp/JF/JFdocs/LDAP-Implementation-HOWTO/radius.html



:extend type: text/x-rst
:extend:
以下、環境構築手順ですが、自分の環境用に書いているので設定ファイルの場所はFreeBSDでportsを使用した場合の場所です。と言っても、Linuxの場合は/usr/local/etcを/etcに読み替えるだけで良いような気もします。

サーバー環境
-------------

- FreeBSD-5.2.1-SECURITY
- IP: 192.168.1.200
- mpd-3.18
- freeradius-1.0.1
- openldap-2.2.17
- samba-3.0.7

最後のsambaが意外なところで重要でした。VPNのクライアントがWindowsなので当たり前と言えば当たり前ですが‥‥。結局、sambaアカウントをLDAPで管理していたため、環境の用意が比較的簡単に済みました。というのは、VPN接続認証で使用されるMS-CHAPでsambaパスワード（と言うかNTLMハッシュ）が使われるからです。

ということで、設定法補を順番に説明します。



mpd-3.18の設定
---------------

2004/11/23現在最新の、3.18に付属してくるmpd.conf.sampleには、radiusと連携するための設定が"radius:"セクションに書かれています。ただし、pptpセクション内で"load radius"という行がコメントアウトされているのでそのままでは動作しません。手元の環境にはだいぶ前に作ったmpd.confがあるので、"radius:"セクションをコピーして使いました。

今回使用したmpd.conf::

	default:
		load pptp

	pptp:
		load pptp1
		load pptp2
		load pptp3
		load pptp4

	pptp1:
		new -i ng1 pptp1 link-pptp
		load pptp-conf
		set ipcp ranges 192.168.1.200/32 192.168.1.240/32

	pptp2:
		new -i ng2 pptp2 link-pptp2
		load pptp-conf
		set ipcp ranges 192.168.1.200/32 192.168.1.241/32

	pptp3:
		new -i ng3 pptp3 link-pptp3
		load pptp-conf
		set ipcp ranges 192.168.1.200/32 192.168.1.242/32

	pptp4:
		new -i ng4 pptp4 link-pptp4
		load pptp-conf
		set ipcp ranges 192.168.1.200/32 192.168.1.243/32

	pptp-conf:
		load radius
		set bundle yes radius-acct
		set iface disable on-demand
		set iface enable proxy-arp
		set iface idle 1800
		set bundle disable multilink
		set link yes acfcomp protocomp
		set link no pap chap
		set link enable chap
		set link keep-alive 10 240
		set ipcp yes vjcomp
		set ipcp nbns 192.168.1.200
		set ipcp dns 192.168.1.200
		set bundle enable compression
		set ccp yes mppc
		set ccp yes mpp-e40
		set ccp yes mpp-e128
		set ccp yes mpp-stateless

	radius:
		set radius config /etc/radius.conf
		set radius retries 3
		set radius timeout 3
		set radius acct-update 300
		set bundle enable radius-auth radius-fallback
		set bundle enable radius-acct
		set iface enable radius-idle radius-session radius-mtu radius-route
		set bundle enable compression
		set ccp yes mppc
		set ccp enable radius


この中で使用している /etc/radius.conf::

	auth 127.0.0.1 testing123
	acct 127.0.0.1 testing123

記述の意味としては、radiusサーバーでアカウント確認(acct)と認証(auth)を行うということになります。その際の接続先は127.0.0.1(localhost)で、radiusサーバーとの接続に使用するパスワードが"testing123"です。


freeradius-1.0.1の設定
-----------------------

/usr/local/etc/raddb/radius.conf のデフォルトではたくさんの認証方法が記述されていますが、今回の *LDAPで認証する* ための設定はごくごく少ない行数で書くことが出来ます。（と言っても基本設定部分は残しました）::

	prefix = /usr/local
	exec_prefix = ${prefix}
	sysconfdir = ${prefix}/etc
	localstatedir = /var
	sbindir = ${exec_prefix}/sbin
	logdir = /var/log
	raddbdir = ${sysconfdir}/raddb
	radacctdir = ${logdir}/radacct

	confdir = ${raddbdir}
	run_dir = ${localstatedir}/run/radiusd
	log_file = ${logdir}/radius.log
	libdir = ${exec_prefix}/lib
	pidfile = ${run_dir}/radiusd.pid
	max_request_time = 30
	delete_blocked_requests = no
	cleanup_delay = 5
	max_requests = 1024
	bind_address = *
	port = 0
	hostname_lookups = no
	allow_core_dumps = no
	regular_expressions	= yes
	extended_expressions	= yes
	log_stripped_names = no
	log_auth = yes
	log_auth_badpass = no
	log_auth_goodpass = no
	usercollide = no
	lower_user = no
	lower_pass = no
	nospace_user = no
	nospace_pass = no
	checkrad = ${sbindir}/checkrad
	$INCLUDE  ${confdir}/clients.conf


	modules {
		mschap {
			authtype = MS-CHAP
		}
		ldap {
			server = "localhost"
			basedn = "ou=Users,dc=freia,dc=jp"
			filter = "(uid=%{Stripped-User-Name:-%{User-Name}})"
			start_tls = no
			ldap_connections_number = 5
			timeout = 4
			timelimit = 3
			net_timeout = 1
		}
	}
	authorize {
		ldap
		mschap
	}
	authenticate {
		Auth-Type MS-CHAP {
			mschap
		}
	}

modulesセクション内のldapセクションは環境に合わせて書き換える必要があります。自分の環境ではLDAP通信の暗号化はしていないので、上記のような設定となります。あと、ここではbinddnに関する記述がありませんので、 **LDAPは無認証で一部の情報を参照できるようにしておく必要がありました** （自分はここではまりました‥‥）。

とりあえずLDAPの設定は後にして、radiusの残りの設定を行います。

/usr/local/etc/raddb/clients.conf::

	client 127.0.0.1 {
		secret    = testing123
		shortname = localhost
		nastype   = other
	}

*secret* にはradiusを利用するための認証パスワードを記述します。/etc/radius.conf に記述したパスワードですね。

/usr/local/etc/raddb/users::

	DEFAULT	Auth-Type = LDAP
		Fall-Through = 1

いちおう上記のように書いていますが、デフォルトの設定のままで問題ないようです。このファイルはユーザー個別に認証方式を変えたいときに使うんだと思いますが、今回はLDAPで管理するので、、、、もしかしてusersファイルは空でも問題ないんじゃ‥‥と思い空にしてみたところ、ちゃんと動作しました。不思議。


radius設定の最後は、/usr/local/etc/raddb/ldap.attrmapです。samba2.xを使用している場合は編集する必要はないのですが、samba3以降でスキーマが変更されているため、新しいアトリビュート名に書き換える必要があります。

変更前(samba2用)::

	checkItem	LM-Password			lmPassword
	checkItem	NT-Password			ntPassword

変更後(samba3用)::

	checkItem	LM-Password			sambaLMPassword
	checkItem	NT-Password			sambaNTPassword


これでfreeradiusの設定は完了です。単体で動作確認をしたいところですが、今回のように色々な要素が連携しているとテストするのがなかなか難しくて困りものです。

とりあえず `動作テスト`_ については最後の方に書きます。


openldap-2.2.17の設定
----------------------

LDAPの設定は完了しているものとして、ポイントだけ。

- sambaスキーマを利用している
- VPN接続アカウントは、objectClass=sambaAccountである
- 無認証で sambaNTPassword, sambaLMPassword を参照できる
- VPN接続時のパスワードにはsambaのパスワードが利用される

自分は、sambaNTPassword, sambaLMPassword を認証後でないと閲覧できないようにslapd.confを設定してしまっていたため、radiusdのログで::

  rlm_mschap: No User-Password configured.  Cannot create LM-Password.
  rlm_mschap: No User-Password configured.  Cannot create NT-Password.

なんて怒られていました。


samba-3.0.7の設定
-------------------

がんばりましょう（笑）。こちらもポイントだけ。

- VPN接続時のパスワードにはsambaのパスワードが利用される
- posixのパスワード(userPassword)とsambaのパスワードが同期している必要はない

同期している必要はないですが、認証統合するためには同期していた方がいいですね。自分の環境では、nssを使ってUnixシェル(ssh)の認証をLDAPで行ったり、Zopeのアカウント管理をLDAPでやっていたりします。詳しくは `Wikiページの方`__ を参照してください。（情報古めですが‥‥）

.. __: http://www.freia.jp/taka/wiki/X_e3_82_a2_e3_82_ab_e3_82_a6_e3_83_b3_e3_83_88_e4_b8_80_e6_8b_ac_e7_ae_a1_e7_90_86


動作テスト
-----------

動作テストのために、/usr/local/sbin/mpd -b, および /usr/local/sbin/radiusd -X で起動します。radiusの"-X"オプションはコンソールモードでの起動指定で、認証の流れを見るために指定しています。今回mpdの方は"-b"でバックグラウンド動作にしていますが、必要であれば別のコンソールで /usr/local/sbin/mpd で起動することで、両方ともコンソールモードで起動しておくことも出来ます。

そして、WindowsクライアントからVPN接続したときのradiusの画面出力は以下のようになります（IP・サーバー名・パスワードのハッシュ値などは書き換えてあります）::

	root% /usr/local/sbin/radiusd -X

	Starting - reading configuration files ...
	reread_config:  reading radiusd.conf
	Config:   including file: /usr/local/etc/raddb/clients.conf
	 main: prefix = "/usr/local"
	 main: localstatedir = "/var"
	 main: logdir = "/var/log"
	 main: libdir = "/usr/local/lib"
	 main: radacctdir = "/var/log/radacct"
	 main: hostname_lookups = no
	 main: snmp = no
	 main: max_request_time = 30
	 main: cleanup_delay = 5
	 main: max_requests = 1024
	 main: delete_blocked_requests = 0
	 main: port = 0
	 main: allow_core_dumps = no
	 main: log_stripped_names = no
	 main: log_file = "/var/log/radius.log"
	 main: log_auth = yes
	 main: log_auth_badpass = no
	 main: log_auth_goodpass = no
	 main: pidfile = "/var/run/radiusd/radiusd.pid"
	 main: user = "(null)"
	 main: group = "(null)"
	 main: usercollide = no
	 main: lower_user = "no"
	 main: lower_pass = "no"
	 main: nospace_user = "no"
	 main: nospace_pass = "no"
	 main: checkrad = "/usr/local/sbin/checkrad"
	 main: proxy_requests = yes
	 main: debug_level = 0
	read_config_files:  reading dictionary
	read_config_files:  reading naslist
	Using deprecated naslist file.  Support for this will go away soon.
	read_config_files:  reading clients
	read_config_files:  reading realms
	radiusd:  entering modules setup
	Module: Library search path is /usr/local/lib
	Module: Loaded MS-CHAP
	 mschap: use_mppe = yes
	 mschap: require_encryption = no
	 mschap: require_strong = no
	 mschap: with_ntdomain_hack = no
	 mschap: passwd = "(null)"
	 mschap: authtype = "MS-CHAP"
	 mschap: ntlm_auth = "(null)"
	Module: Instantiated mschap (mschap)
	Module: Loaded LDAP
	 ldap: server = "localhost"
	 ldap: port = 389
	 ldap: net_timeout = 1
	 ldap: timeout = 4
	 ldap: timelimit = 3
	 ldap: identity = ""
	 ldap: tls_mode = no
	 ldap: start_tls = no
	 ldap: tls_cacertfile = "(null)"
	 ldap: tls_cacertdir = "(null)"
	 ldap: tls_certfile = "(null)"
	 ldap: tls_keyfile = "(null)"
	 ldap: tls_randfile = "(null)"
	 ldap: tls_require_cert = "allow"
	 ldap: password = ""
	 ldap: basedn = "ou=Users,dc=freia,dc=jp"
	 ldap: filter = "(uid=%{Stripped-User-Name:-%{User-Name}})"
	 ldap: base_filter = "(objectclass=radiusprofile)"
	 ldap: default_profile = "(null)"
	 ldap: profile_attribute = "(null)"
	 ldap: password_header = "(null)"
	 ldap: password_attribute = "(null)"
	 ldap: access_attr = "(null)"
	 ldap: groupname_attribute = "cn"
	 ldap: groupmembership_filter = "(|(&amp;(objectClass=GroupOfNames)(member=%{Ldap-UserDn}))(&amp;(objectClass=GroupOfUniqueNames)(uniquemember=%{Ldap-UserDn})))"
	 ldap: groupmembership_attribute = "(null)"
	 ldap: dictionary_mapping = "/usr/local/etc/raddb/ldap.attrmap"
	 ldap: ldap_debug = 0
	 ldap: ldap_connections_number = 5
	 ldap: compare_check_items = no
	 ldap: access_attr_used_for_allow = yes
	 ldap: do_xlat = yes
	rlm_ldap: Registering ldap_groupcmp for Ldap-Group
	rlm_ldap: Registering ldap_xlat with xlat_name ldap
	rlm_ldap: reading ldap＜-＞radius mappings from file /usr/local/etc/raddb/ldap.attrmap
	rlm_ldap: LDAP radiusCheckItem mapped to RADIUS $GENERIC$
	rlm_ldap: LDAP radiusReplyItem mapped to RADIUS $GENERIC$
	rlm_ldap: LDAP radiusAuthType mapped to RADIUS Auth-Type
	rlm_ldap: LDAP radiusSimultaneousUse mapped to RADIUS Simultaneous-Use
	rlm_ldap: LDAP radiusCalledStationId mapped to RADIUS Called-Station-Id
	rlm_ldap: LDAP radiusCallingStationId mapped to RADIUS Calling-Station-Id
	rlm_ldap: LDAP sambaLMPassword mapped to RADIUS LM-Password
	rlm_ldap: LDAP sambaNTPassword mapped to RADIUS NT-Password
	rlm_ldap: LDAP radiusExpiration mapped to RADIUS Expiration
	rlm_ldap: LDAP radiusServiceType mapped to RADIUS Service-Type
	rlm_ldap: LDAP radiusFramedProtocol mapped to RADIUS Framed-Protocol
	rlm_ldap: LDAP radiusFramedIPAddress mapped to RADIUS Framed-IP-Address
	rlm_ldap: LDAP radiusFramedIPNetmask mapped to RADIUS Framed-IP-Netmask
	rlm_ldap: LDAP radiusFramedRoute mapped to RADIUS Framed-Route
	rlm_ldap: LDAP radiusFramedRouting mapped to RADIUS Framed-Routing
	rlm_ldap: LDAP radiusFilterId mapped to RADIUS Filter-Id
	rlm_ldap: LDAP radiusFramedMTU mapped to RADIUS Framed-MTU
	rlm_ldap: LDAP radiusFramedCompression mapped to RADIUS Framed-Compression
	rlm_ldap: LDAP radiusLoginIPHost mapped to RADIUS Login-IP-Host
	rlm_ldap: LDAP radiusLoginService mapped to RADIUS Login-Service
	rlm_ldap: LDAP radiusLoginTCPPort mapped to RADIUS Login-TCP-Port
	rlm_ldap: LDAP radiusCallbackNumber mapped to RADIUS Callback-Number
	rlm_ldap: LDAP radiusCallbackId mapped to RADIUS Callback-Id
	rlm_ldap: LDAP radiusFramedIPXNetwork mapped to RADIUS Framed-IPX-Network
	rlm_ldap: LDAP radiusClass mapped to RADIUS Class
	rlm_ldap: LDAP radiusSessionTimeout mapped to RADIUS Session-Timeout
	rlm_ldap: LDAP radiusIdleTimeout mapped to RADIUS Idle-Timeout
	rlm_ldap: LDAP radiusTerminationAction mapped to RADIUS Termination-Action
	rlm_ldap: LDAP radiusLoginLATService mapped to RADIUS Login-LAT-Service
	rlm_ldap: LDAP radiusLoginLATNode mapped to RADIUS Login-LAT-Node
	rlm_ldap: LDAP radiusLoginLATGroup mapped to RADIUS Login-LAT-Group
	rlm_ldap: LDAP radiusFramedAppleTalkLink mapped to RADIUS Framed-AppleTalk-Link
	rlm_ldap: LDAP radiusFramedAppleTalkNetwork mapped to RADIUS Framed-AppleTalk-Network
	rlm_ldap: LDAP radiusFramedAppleTalkZone mapped to RADIUS Framed-AppleTalk-Zone
	rlm_ldap: LDAP radiusPortLimit mapped to RADIUS Port-Limit
	rlm_ldap: LDAP radiusLoginLATPort mapped to RADIUS Login-LAT-Port
	conns: 0x80b8400
	Module: Instantiated ldap (ldap)
	Listening on authentication *:1812
	Listening on accounting *:1813
	Listening on proxy *:1814
	Ready to process requests.
	rad_recv: Access-Request packet from host 127.0.0.1:60238, id=122, length=164
		NAS-Identifier = "host.freia.jp"
		NAS-Port = 0
		NAS-Port-Type = Virtual
		Service-Type = Framed-User
		Framed-Protocol = PPP
		Calling-Station-Id = "219.121.60.xxx"
		User-Name = "taka"
		MS-CHAP-Challenge = 0xbb1068a606df60de71a4068500527c74
		MS-CHAP2-Response = 0x010082e63035745600d200aaa4bf454656070000000000000000b286b1c7530b18a80c82289f90e7ad4db5b01db28a0af076
	  Processing the authorize section of radiusd.conf
	modcall: entering group authorize for request 0
	rlm_ldap: - authorize
	rlm_ldap: performing user authorization for taka
	radius_xlat:  '(uid=taka)'
	radius_xlat:  'ou=Users,dc=freia,dc=jp'
	rlm_ldap: ldap_get_conn: Checking Id: 0
	rlm_ldap: ldap_get_conn: Got Id: 0
	rlm_ldap: attempting LDAP reconnection
	rlm_ldap: (re)connect to localhost:389, authentication 0
	rlm_ldap: bind as / to localhost:389
	rlm_ldap: waiting for bind result ...
	rlm_ldap: Bind was successful
	rlm_ldap: performing search in ou=Users,dc=freia,dc=jp, with filter (uid=taka)
	rlm_ldap: looking for check items in directory...
	rlm_ldap: Adding sambaNTPassword as NT-Password, value B70F540C80BBC4C037910072C04837ED &amp; op=21
	rlm_ldap: Adding sambaLMPassword as LM-Password, value 5F029DC02B6C0D0C87690D42E08DF5EE &amp; op=21
	rlm_ldap: looking for reply items in directory...
	rlm_ldap: user taka authorized to use remote access
	rlm_ldap: ldap_release_conn: Release Id: 0
	  modcall[authorize]: module "ldap" returns ok for request 0
	  rlm_mschap: Found MS-CHAP attributes.  Setting 'Auth-Type  = MS-CHAP'
	  modcall[authorize]: module "mschap" returns ok for request 0
	modcall: group authorize returns ok for request 0
	  rad_check_password:  Found Auth-Type MS-CHAP
	auth: type "MS-CHAP"
	  Processing the authenticate section of radiusd.conf
	modcall: entering group Auth-Type for request 0
	  rlm_mschap: Found LM-Password
	  rlm_mschap: Found NT-Password
	  rlm_mschap: Told to do MS-CHAPv2 for taka with NT-Password
	rlm_mschap: adding MS-CHAPv2 MPPE keys
	  modcall[authenticate]: module "mschap" returns ok for request 0
	modcall: group Auth-Type returns ok for request 0
	Login OK: [taka] (from client localhost port 0 cli 219.121.60.111)
	Sending Access-Accept of id 122 to 127.0.0.1:60238
		MS-CHAP2-Success = 0x01533d41324643393538044345373733063439463246024331353330324146423601383431430241303936
		MS-MPPE-Recv-Key = 0x408c031d5390d2c72b140b004f0df5fc
		MS-MPPE-Send-Key = 0x56815e0082a820e2e891bc02aa20628e
		MS-MPPE-Encryption-Policy = 0x00000001
		MS-MPPE-Encryption-Types = 0x00000006
	Finished request 0


まず起動から見ていきましょう。

起動時にradius上の設定情報とLDAPの情報をマッピングしている箇所で、正しくsambaNTPassword,sambaLMPasswordをマッピングしていればOKです::

	rlm_ldap: LDAP sambaLMPassword mapped to RADIUS LM-Password
	rlm_ldap: LDAP sambaNTPassword mapped to RADIUS NT-Password

WindowsクライアントからVPN接続を行い、mpdから認証要請が来た部分が以下の行です::

	rad_recv: Access-Request packet from host 127.0.0.1:60238, id=122, length=164

その後、mpdからの問い合わせ情報を元に、ldapから認証のための情報を取得しています。LDAPではパスワード認証ではなくアカウントの存在だけがチェックされますが、もう一つの重要な情報、sambaパスワードのハッシュ値がradiusに渡されます::

	modcall: entering group authorize for request 0
	rlm_ldap: - authorize
	rlm_ldap: performing user authorization for taka
	radius_xlat:  '(uid=taka)'
	radius_xlat:  'ou=Users,dc=freia,dc=jp'
	rlm_ldap: ldap_get_conn: Checking Id: 0
	rlm_ldap: ldap_get_conn: Got Id: 0
	rlm_ldap: attempting LDAP reconnection
	rlm_ldap: (re)connect to localhost:389, authentication 0
	rlm_ldap: bind as / to localhost:389
	rlm_ldap: waiting for bind result ...
	rlm_ldap: Bind was successful
	rlm_ldap: performing search in ou=Users,dc=freia,dc=jp, with filter (uid=taka)
	rlm_ldap: looking for check items in directory...
	rlm_ldap: Adding sambaNTPassword as NT-Password, value B70F540C80BBC4C037910072C04837ED &amp; op=21
	rlm_ldap: Adding sambaLMPassword as LM-Password, value 5F029DC02B6C0D0C87690D42E08DF5EE &amp; op=21
	rlm_ldap: looking for reply items in directory...
	rlm_ldap: user taka authorized to use remote access
	rlm_ldap: ldap_release_conn: Release Id: 0
	  modcall[authorize]: module "ldap" returns ok for request 0

上記で、LDAPとうまく連携できていれば、sambaNTPasswordとsambaLMPasswordが NT-Password, LM-Password という変数に取得されていることが表示されます。もしこの二つの値を取得できなかったとしてもldapモジュールでのauthorizeは成功したと表示されてしまう(最後の行)ため、注意してみておく必要があります（ありました...)。

そして最後にMS-CHAPによるパスワードチェックです::

	  rad_check_password:  Found Auth-Type MS-CHAP
	auth: type "MS-CHAP"
	  Processing the authenticate section of radiusd.conf
	modcall: entering group Auth-Type for request 0
	  rlm_mschap: Found LM-Password
	  rlm_mschap: Found NT-Password
	  rlm_mschap: Told to do MS-CHAPv2 for taka with NT-Password
	rlm_mschap: adding MS-CHAPv2 MPPE keys
	  modcall[authenticate]: module "mschap" returns ok for request 0
	modcall: group Auth-Type returns ok for request 0

ここで、以下の二行::

	  rlm_mschap: Found LM-Password
	  rlm_mschap: Found NT-Password

はLDAPからアカウント確認時に取得している値が使用されます。もしLDAPから取得できていない場合、この部分のログが以下のようになってしまいます::

	rlm_mschap: No User-Password configured.  Cannot create LM-Password.
	rlm_mschap: No User-Password configured.  Cannot create NT-Password.
	rlm_mschap: Told to do MS-CHAPv2 for taka with NT-Password

最初これを見て、radiusにUser-Passwordを渡す方法を調べたり、やっぱりLDAP内にプレーンテキストでパスワードを格納するしかないんじゃないか、とか思ったりしていました。


ということで、全てうまく動作すると最後に::

	Login OK: [taka] (from client localhost port 0 cli 219.121.60.111)
	Sending Access-Accept of id 122 to 127.0.0.1:60238
		MS-CHAP2-Success = 0x01533d41324643393538044345373733063439463246024331353330324146423601383431430241303936
		MS-MPPE-Recv-Key = 0x408c031d5390d2c72b140b004f0df5fc
		MS-MPPE-Send-Key = 0x56815e0082a820e2e891bc02aa20628e
		MS-MPPE-Encryption-Policy = 0x00000001
		MS-MPPE-Encryption-Types = 0x00000006
	Finished request 0

となり、VPN接続が行われます。

あとは通常運用用に /usr/local/etc/rc.d/radius.sh が起動するように、rc.conf に以下を記述します::

	radiusd_enable="YES"



参考にしたサイト
-----------------

非常に参考になりました。こういったサイトが無ければ分厚いradiusの本と格闘したり、英語の森の中を1ヶ月くらいさまよっていたのではないかと思います。筆者の方々に深くお礼申し上げます。

- `RADIUSのMS-CHAP認証にLDAPを使う`_ (シーザーサラダとエビカレーの日々 より)
- `mpdとFreeRadius(+PostgreSQL)の連携`_ (未整理文章/コラムの種 より)
- `LDAP を使った Radius 認証`_ (LDAP Implementation HOWTO より)
- `freeRADIUS and openldap on FreeBSD`_ (Nob's Home Page より)

.. _`LDAP を使った Radius 認証`: http://www.linux.or.jp/JF/JFdocs/LDAP-Implementation-HOWTO/radius.html
.. _`freeRADIUS and openldap on FreeBSD`: http://www.y-min.or.jp/~nob/FreeBSD/freeradius-openldap.html
.. _`mpdとFreeRadius(+PostgreSQL)の連携`: http://kozuka.jp/tdiary-blog_html/20030507.html
.. _`RADIUSのMS-CHAP認証にLDAPを使う`: http://www.aineas.net/linux/ldap/radius.php






:trackbacks:
:trackback id: 2006-06-15.9254128351
:title: 続 sambaldap-tools
:blog name: uep on hayate
:url: http://uep.hayate.mine.nu/archives/2006/06/_sambaldaptools.php
:date: 2006-06-15 08:15:26
:body:
pptpの認証もLDAPで行いたいと思い、色々調べてみた。 どうやら、pptp-...

%%%%%%%%%

:id: 84
:date: 2004-12-05 01:35:03
:title: Python2.4をインストール
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
`Python2.4`_ が出たのでサーバーのPythonをアップデートしてみた。同時にZopeを2.7.3[1]にアップデート。そしたらZopeが起動しなくなったのでエラーメッセージを確認したところ::

  no module rotor

とのエラーが。たしかにpython2.4のリリースノートに以下の一文が::

  The mpz, rotor, and xreadlines modules have been removed.

COREBlogのソースを確認してみたところ、rotorを使っているのはMoblog等でパスワードをエンコードするためらしい。とりあえず自分はMoblog機能を使っていないのでrotor周りをコメントアウトし、パスワードチェックは常に失敗するように書き換えて対処した（間違ってるとアブナイのでコードは載せません）。

ということで、メジャーバージョンアップ[2] はもっと慎重にやらなければと思った今日この頃。

.. [1] Zope2.7.4β1がもう出てるけど。
.. [2] 2.3から2.4はメジャーなのか、マイナーなのか‥‥
.. _`Python2.4`: http://www.python.jp/Zope/PyLog//1101828863/index_html



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4553909100
:title: Re: Python2.4をインストール
:author: 清水川
:date: 2004-12-05 18:22:41
:email: taka@freia.jp
:url: 
:body:
同じところではまった方発見。Trackbackしてみました。




:comments:
:comment id: 2005-11-28.4555062652
:title: Re: Python2.4をインストール
:author: yasiyasi
:date: 2004-12-06 09:18:39
:email: 
:url: http://yasi.minidns.net/blog/
:body:
　当方とはちょっと動きが違ったみたいですね。

　当方の場合、Python2.4にする前からZope2.7.3を使っていたのですが、この場合Python2.4にすると、ZopeもPloneも動いたけれど、COREBlogだけはプロダクトの読み込みがうまくいかず、blogインスタンスに「壊れてるよ」アイコンが表示されていました。

　Zopeも起動しなくなったのは、なぜなんでしょうかね？


:comments:
:comment id: 2005-11-28.4556228428
:title: Re: Python2.4をインストール
:author: 清水川
:date: 2004-12-07 00:43:00
:email: taka@freia.jp
:url: 
:body:
> Zopeも起動しなくなったのは、なぜなんでしょうかね？

Pythonと同時にZopeもVerUpしたので*.pycが無効になって、起動時のProductコンパイルで引っかかった‥‥とか？


:trackbacks:
:trackback id: 2005-11-28.4557388537
:title: FreeBSDでのPythonとZopeとの関係修復の状況
:blog name: YasiYasi's Blog
:url: http://yasi.minidns.net/blog/117
:date: 2005-11-28 00:47:35
:body:
　FreeBSDの最新版portsでPython 2.4が標準とされた影響で、Python
2.3を前提としているZope関連のportsが広く悪影響を受けている（COREBlogの例その１（私）、その２（清水川記さん）、ZMｙSQLDAの例（あくまでも　ん？不定期ログさん））件ですが、修正されつつあります。
#
ということなので、atsさんのCOREBlog改良はFreeBSDは気にしなくても大丈夫かと。
　まず、ZopeのportsがPython
2.3を使うように、すでに修正されました。
...
%%%%%%%%%

:id: 85
:date: 2004-12-07 01:16:55
:title: ZopeのPython2.4動作
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
FreeBSDのportsで、Zopeが利用するPythonのバージョンが2.4から2.3に戻された。これ自体は良いとして、問題はPython2.4ベースで入れてしまった自宅サーバーのZopeの扱いをどうするか。

1. make.conf(かpkgtools.conf？)にPython2.4を使うように設定してみる
2. Python2.3を使うようにして入れ直す

‥‥問題が出るまではとりあえず１かな（COREBlogは問題じゃないのか？）。同サーバーを利用しているユーザー様にも意見を聞いてみよう。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 86
:date: 2004-12-10 01:02:27
:title: オブジェクト指向実践者の集い
:categories: ['Event']
:body type: text/x-rst
:body:
http://www.objectclub.jp/event/2004christmas/

午前中は社外の会議があったため、午後から参加しました。というか、明日リリース日なのにセミナー出てて大丈夫なんだろうか‥‥という不安を抱えつつも、電話で聞いた感じでは大丈夫そうだったので参加しました。

- ファシリテーションワークショップ

  微妙に残念なことに、前半が半年前の同イベントのファシリテーション（粕野さん）
  と同じだったり、ファシリテータとしてこんな事をしてるんだよという面が
  見えにくかったのではないかと思いました。とはいえ、コミュニケーションに関する
  トレーニングとしては良かったと思います。

- ライトニングトークス

  `小島さん`_ のＬＴ、相変わらず面白いですわ。
  今回はＴＤＤの動きを画面で見せるためのチュートリアルプログラムの紹介？でした。
  画面上に文字が一文字一文字入力されていくのが見れます。
  ネタが良いのとそれを実際に動かして見せるという点がポイント高いです。

  まじめなところでは、某社の太田さん。DI・AOP・Seaserの紹介でした。
  DIとAOPは分かるけど、ちょっと難しすぎ。
  とりあえず、Javaも大変なんだなーと思っておきます。

  あと、バーンダウンチャートやXFDｓなど、面白いネタ満載でした。（省略します。ごめんなさい）＜誰に謝ってるのだ‥‥？

- 懇親会

  スーパーライトニングトークス（ウルトラだったか？）に出てきました。持ち時間30秒。
  「実装をすぐ出さなきゃいけないときにテストファーストしろ、と言うのは勇気がいるよ」
  とかなんとか。30秒未満だったので、残念ながら `ドラは鳴りませんでした`_ 。残念。

- 二次会

  `寺田さん`_ ・仙石さん・アベさんと盛り上がってきました。
  今回狭かったので席移動はしなかったのが心残りです。
  寺田さんがUML練習のために、システムの境界と機能が明確な自販機をネタにしてる、
  という話があり、これは自分もやってみよう！と思いました。やっぱり、導入や練習に
  適した題材ってあるよね。OOの説明で「ほ乳類」とか「人間」とかを例にして余計な
  混乱を招いたことがあるので、次からは明確な物を題材にして（自分も）練習してみよう
  と思います。

- おまけ

  帰宅してメールを見たら、夜９時頃にバーンアップしたようです。
  そんなわけで、参加レポート（当日版？）は要点だけ書いてみました。
  ‥‥明日のリリース、大丈夫かな？


.. _`小島さん`: http://www.shos.info/develop/oo/oosmnr.html
.. _`ドラは鳴りませんでした`: http://d.hatena.ne.jp/amapyon/about
.. _`寺田さん`: http://www.geocities.jp/u_1roh/


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4564392717
:title: Re: オブジェクト指向実践者の集い
:author: 小島＠福井コンピュータ
:date: 2004-12-17 19:41:31
:email: f_kojima@fukuicompu.co.jp
:url: http://www.shos.info/
:body:
スミマセン。
トラックバックがスパムのようになってしまいました。
どうかお許しください。


:comments:
:comment id: 2005-11-28.4565537053
:title: Re: オブジェクト指向実践者の集い
:author: 清水川
:date: 2004-12-17 20:08:03
:email: taka@freia.jp
:url: 
:body:
ちょっと面白かったです（笑

メールをチェックしてて、一瞬「スパムか!?」と思ったところでした(^^ゞ



:trackbacks:
:trackback id: 2005-11-28.4566696700
:title: クリスマス企画 オブジェクト指向実践者の集い
:blog name: 翔ソフトウェア (Sho's) Fujiwo の日記
:url: http://blog.shos.info/archives/2004/12/post_46.html
:date: 2005-11-28 00:47:36
:body:
上記に参加してきたので、レポートしてみたい。 ■ 詳細             ...


:trackbacks:
:trackback id: 2005-11-28.4567609271
:title: クリスマス企画 オブジェクト指向実践者の集い
:blog name: 翔ソフトウェア (Sho's) Fujiwo の日記
:url: http://blog.shos.info/archives/2004/12/post_43.html
:date: 2005-11-28 00:47:36
:body:
上記に参加してきたので、レポートしてみたい。 ■ 詳細             ...


:trackbacks:
:trackback id: 2005-11-28.4568854107
:title: クリスマス企画 オブジェクト指向実践者の集い
:blog name: 翔ソフトウェア (Sho's) Fujiwo の日記
:url: http://blog.shos.info/archives/2004/12/post_46.html
:date: 2005-11-28 00:47:36
:body:
上記に参加してきたので、レポートしてみたい。 ■ 詳細             ...


:trackbacks:
:trackback id: 2005-11-28.4569762387
:title: クリスマス企画 オブジェクト指向実践者の集い
:blog name: 翔ソフトウェア (Sho's) Fujiwo の日記
:url: http://blog.shos.info/archives/2004/12/post_43.html
:date: 2005-11-28 00:47:37
:body:
上記に参加してきたので、レポートしてみたい。 ■ 詳細             ...
%%%%%%%%%

:id: 87
:date: 2004-12-10 01:10:19
:title: PythonCE for PocketPC
:categories: ['python', 'misc']
:body type: text/x-rst
:body:
帰りの電車の中で、PocketPCにインストールしたPythonをいじっていて遭遇したネタ。

Pytnonのコンソールを終了しようとして::

  >>> exit
  'Use Ctrl-Z plus Return to exit.'

ああ、そうか。Ctrl-Zだったっけ。そう言えばexit()とかquit()っていう関数はないのかな？::

  >>> exit()
  Traceback (most recent call last):
    File "<stdin>", line 1, in ?
  TypeError: 'str' object is not callable

ん？strオブジェクトは関数呼び出し出来ません？‥‥‥‥あーーー！つまり、exitっていうのはstr型の変数なんだ！きっとシステム起動時に exit = 'Use Ctrl-Z plus Return to exit.' ってやってるんだ！

いや、そんだけです。いまさらですかね？

ちなみに sys.exit() はありました。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4573602342
:title: Re: PythonCE for PocketPC
:author: M.Shibata
:date: 2004-12-10 02:05:47
:email: nospam.mshibata@emptypage.jp
:url: http://www.emptypage.jp
:body:
ほんとだ！　Windows XP ですけど、
>>> type(exit)

って出ました。そういう実装だったとはまったく思いつきませんでした。目から鱗です。


:comments:
:comment id: 2005-11-28.4574786898
:title: Re: PythonCE for PocketPC
:author: 清水川
:date: 2004-12-10 08:21:39
:email: taka@freia.jp
:url: 
:body:
すんません、タグとして認識されちゃったみたいですね。

  >>> teype(exit)
  &lt;type 'str'&gt;

ですね
%%%%%%%%%

:id: 88
:date: 2004-12-10 18:27:31
:title: パターン勉強会、またも出られず。
:categories: ['misc', 'Event']
:body type: text/x-rst
:body:
来週１６日の `パターン勉強会`_ 、またもや出席できません。当日の18:00から会社のネットワーク委員会の打合せが入ってしまいました。しまいましたと言うか、調整したのは自分だし。

ここ３，４回出席できてないなぁ‥‥。残念。

*# ガックシ君、スイッチON！*  ○|￣|_

.. _`パターン勉強会`: http://patterns-wg.fuka.info.waseda.ac.jp/study/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 89
:date: 2004-12-11 00:00:38
:title: mixi
:categories: ['misc']
:body type: text/x-rst
:body:
昨日の `冬オブラブ会`_ でお会いした方々を mixi_ で探してみたら‥‥いるいる、ほとんどみんな居ました！ということで、早速マイミクシに登録です。

.. _mixi: http://mixi.jp/
.. _`冬オブラブ会`: http://www.objectclub.jp/event/2004christmas/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 90
:date: 2004-12-11 00:13:47
:title: リリース
:categories: ['work']
:body type: text/x-rst
:body:
今日無事リリースが完了しました。結局夜10時回ってしまいましたが、まあなんとか。

昨日、なにやら問題が起きたらしく「メモを残させるから明日早く来てくれ」と留守電にあり、今朝は7:30に会社に行ったのですが‥‥

メモ::

  うまく動かなくて、どうやら×××の値が取れてないようです。

‥‥せめてファイル名と行番号は欲しかった。状況を把握してる人が来るまで何も出来なかったし。

*# しかも「清水川バグ埋め込み犯説」が流れてるし。原因別の所だし。*



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 91
:date: 2004-12-11 00:21:03
:title: COREBlogのコメント欄
:categories: ['Zope']
:body type: text/x-rst
:body:
`Whining Express`_ より::

  ああん、<type 'str'> って入れたのに、まるごとサニタイズされちゃった。[1]

許可するタグを設定していないので‥‥。あとでPlaneText入力になるように改造してみますです。

.. [1] `PythonCE for PocketPC` の `コメント`__
.. __: http://www.freia.jp/taka/blog/87#comment55
.. _`Whining Express`: http://www.emptypage.jp/whining/2004-12-10.html


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 92
:date: 2004-12-17 00:07:35
:title: 神とオヤジ
:categories: ['work']
:body type: text/x-rst
:body:
最近仕事で「オヤジ出現」という言葉がはやり始めている。

使い方
------
- ○○さーん、ちょっとオヤジがいるっぽいので設計打ち合わせしませんかー
- 今日はオヤジ３匹も倒しちゃったよ

語源
-----
従来との(複雑な)仕様上の互換性を保つ必要があるために、実現が非常に困難な設計を要求されているときに、「これだ！これならいける！」と **神が降臨した** かのような閃きで設計が完成。しかし数分後には問題が見つかってしまい、 **「神だとおもったけど実はその辺のオヤジだった」** と落胆。

応用
------
設計メモの後ろの方に次のようなページがある

- オヤジ出現による仕様差分１
- オヤジ出現による仕様差分２


# `似たような話`_ があるなーとか思ったので書いてみたり。

.. _`似たような話`: http://d.hatena.ne.jp/t-wada/20041216#1103204568



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 93
:date: 2004-12-17 00:12:34
:title: そして今日もオヤジが
:categories: ['work']
:body type: text/x-rst
:body:
デバッグ期間は明日までなのに、今日になってオヤジが出現！しかも退治したと思ったのに退社後にケータイに **オヤジ復活** の知らせが‥‥。

明日もハードな一日になりそうな予感。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 94
:date: 2004-12-17 23:55:37
:title: 日本語ドメイン取ってみました
:categories: ['misc']
:body type: text/x-rst
:body:
`http://清水川.jp/` 取りました。

reStructuredText がURLとして見てくれないのが悲しいですが。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 95
:date: 2004-12-28 00:50:24
:title: 初めて自宅サーバにPOP/SMTPでアクセス
:categories: ['Unix']
:body type: text/x-rst
:body:
某ＷＺ系オフ会用メーリングリストに `taka_@_freia.jp` で登録されていたのに気づかずに、 KCOMのアドレスから投稿したため、メールがはじかれてしまった。とはいえ、KCOMメールアドレスはもう１年も使えないので今から新しいアドレスに徐々に移行しよう‥‥と思ったのが `２ヶ月前`_ 。年の瀬の時の流れの速さを肌で感じる今日この頃（違う）。

とりあえず投稿するために、freia.jpのPOP/SMTPに繋いでみたら未読が650通も貯まっていた。１通目が今年の7/19なので、サーバー移行してからずっとたまり続けていたらしい（でも、ほとんどはそのサーバー自身の動作の定期レポート）。全部KCOMの方に転送していたとはいえ、設定しっぱなしで放置というのはいかがなものかと。

正月休みに設定するか。‥‥でも最近「正月休みに～するか」というせりふが多い様な気が。

.. _`２ヶ月前`: http://www.freia.jp/taka/blog/78


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 96
:date: 2004-12-28 00:55:14
:title: MovableType
:categories: ['misc']
:body type: text/x-rst
:body:
会社の同僚が `MovableTypeを始めた`_ らしい。早速トラックバックしてみる。

えーと。blog開設おめでとうございます～。

.. _`MovableTypeを始めた`: http://akn.to/blog/1



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4602223502
:title: Re: MovableType
:author: AKN
:date: 2004-12-28 01:57:55
:email: webmaster@akn.to
:url: http://akn.to/blog/
:body:
調べたらすぐわかることなんやろーけどトラックバックの仕方わからーん。
し返そうと思ったけど今日はコメントだけにしといたるわ。
年末のDB構築楽しみにしときな！(☆_-)


:trackbacks:
:trackback id: 2005-11-28.4603373559
:title: 今さらブログ始めました。
:blog name: 三國志図書館Blog
:url: http://www.akn.to/mt/archives/2004/12/post_3.html
:date: 2005-11-28 00:47:40
:body:
既にAKN's三國志図書館自体がほったらかし状態になりつつあるのに、今さらながら...
%%%%%%%%%

:id: 97
:date: 2004-12-28 01:11:09
:title: 書くネタ
:categories: ['misc']
:body type: text/x-rst
:body:
最近自分のblog更新が途切れてますが、書くことがないのではなくて、書く暇がないのです（STARTREK VOYAGRのDVD見たり、 MoE_ というMMOやったりで）。

もう昨日の話になるけど、先日買った PSX_ （２台目）に"D端子出力がゲームモード時でだけ映像が乱れる" という初期不良(たぶん)があって、ヨドバシに電話したらすぐに代替品を届けてくれるという話になったり、というネタも書けてないし。

あと、古い方のPSXを友人に売るとか、中身のデータ移行が大変だとか、8000円でUPS買ったとか、クリスマスにタブレットもらったとか。

‥‥なんか技術ネタが少ないかも？（どれもこれもちゃんと書こうとして構えてしまうから書けないのかも）

*# と、* トラックバック_ *を繰り返すワタシ*

.. _MoE: http://moepic.com/
.. _PSX: http://www.psx.sony.co.jp/
.. _トラックバック: http://www.akn.to/mt/archives/2004/12/post_2.html


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 98
:date: 2004-12-29 13:11:12
:title: PSX(DESR-7500)のバグ？
:categories: ['Memo', 'misc']
:body type: text/x-rst
:body:
PSX_ をDESR-5000からDESR-7500に買い換えたところ、ゲーム中のみD端子出力の画像が乱れるという症状にあってしまった。初期不良だと思って販売店に交換してもらったのだけど、同じ症状が出てしまうのでこれはもう初期ロットのバグなんじゃないだろうか。

早速ソニーに電話したが、「大変混み合っております、後ほどお掛け直しください」とメッセージが流れた後電話が切られた。仕方がないのでメールで症状を送ったけど、対応してもらえるのは来年かな‥‥。

ところで、PSXの初期不良交換で自宅へ届けてくれたんだけど、カッター忘れて行ってますよ。あとPSXの裏蓋しまい忘れました。これ読んでたら取りに来てください。（無理か）

.. _PSX: http://www.psx.sony.co.jp/


:extend type: text/plain
:extend:


:trackbacks:
:trackback id: 2005-11-28.4610046918
:title: DESR-7500購入
:blog name: パソコンとカメラの日々
:url: http://tomoaki.cocolog-nifty.com/pc/2005/01/desr7500.html
:date: 2005-11-28 00:47:41
:body:
DESR-7500 - Tom's Wiki SONY PSX 250GB DE
%%%%%%%%%

:id: 99
:date: 2004-12-29 13:13:29
:title: 雪降れこんこん
:categories: ['misc', 'Zope']
:body type: text/x-rst
:body:
雪だ。でも今日から休みなので、部屋でぬくぬくすることにする。

ところで、blogに天気マークを表示するpluginの動作が変な理由が少しだけ分かった。手動でZWeatherAppletのViewを表示するとその後はそのときの天気だけが表示され続けてるっぽい。今は手動で更新したので今日の天気（雪）のマークに変わっている。

ZWeatherAppletかWeatherAppletPluginのインスタンスを作り直したら直るかな？


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 100
:date: 2004-12-31 15:14:48
:title: 大晦日は大雪
:categories: ['Event']
:body type: text/x-rst
:body:
今日は「第二回奈良県奈良市某所オフ」、通称WZオフ(勝手に命名)の開催日。17:00に新宿南口集合なんだけど、15:00の時点で東京としては結構な量の雪が積もっており、まだまだ降り続ける様子。

|wzoff-1|

行きはまだともかく、帰ってこれるだろうか‥‥

.. |wzoff-1| image:: images/wzoff2004-1


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 101
:date: 2004-12-31 22:48:26
:title: WZオフから帰宅
:categories: ['Event']
:body type: text/x-rst
:body:
22:00新宿発の特急はがらがらでした。雪も降り止んでしまい、何事もなく帰宅できてしまいました。残念。

WZオフは、WZ5発売～今日までのWZの動きを振り返り‥‥WZの今後についてはあまり明るい話が出来なかったのが残念。WZを名目に集まる機会をまた持ちたいものです。（でもしばらくは使い続けるだろうなぁ）



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 102
:date: 2005-01-01 15:50:27
:title: 新年明けましておめでとうございます
:categories: ['misc']
:body type: text/x-rst
:body:
本年もよろしくお願いいたします。

去年は仕事に追われて気が付くと終わってしまった感があるので、今年は色々と追い求める年にできればいいな、と思います。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 103
:date: 2005-01-02 14:41:08
:title: バッドセクタが‥‥
:categories: ['Unix']
:body type: text/x-rst
:body:
バッドセクタが検出されてしまった‥‥あぁぁぁディスクが読めてないよ‥‥

とりあえずfsckして様子見。やはりRAID1くらいは入れないと恐いな。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 104
:date: 2005-01-03 08:16:14
:title: Re: バッドセクタが‥‥
:categories: ['Unix']
:body type: text/x-rst
:body:
19G近いデータがlost+foundフォルダに移動してしまいました。ここから重要なデータ（メールとか）を拾い出して復旧するのは大変そう。lost+foundに移動すると名前が数値に変わってしまうのでどれがどれやら‥‥。フォルダ単位でlost+foundしちゃったやつはまだしもファイル単位でやっちゃってるやつは一つ一つファイルの中を見るしかないのかも‥‥？

今回の教訓：
１．冗長構成は必須。
２．データのバックアップは重要。

分かっているのに‥‥分かっていたのに‥‥ガックシ。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 105
:date: 2005-01-08 20:14:36
:title: LDAPのアカウント管理をZopeProductで
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
昨年末からLDAPのユーザーアカウント管理を Zope_ [1]_ 上で行うためのProduct [2]_ を作成している。Productを作るのは初めてなので、ちょっとしたことが分からずに苦労が多い。

LDAPUserFolder_ というProductはZopeのユーザー管理をLDAPで行うことが出来るが、自分が作ろうとしているのはもうちょっとLDAP全般のアカウントやグループを管理するもの。思いつくところで、samba,unix,zope,apache,qmail,radius....というところか。

最初に名前を付けたときに思いつきで *LDAPAccountManager* という名前にしたら、PHPで `同じ名前のツール`_ があることを最近知った...。これつかえば良いような気がしないでもない今日この頃。


.. [1] オブジェクトデータベース型Webアプリケーションサーバー....であってるかな？
.. [2] Zopeの機能を拡張するpluginみたいなもの

.. _Zope: http://zope.jp/
.. _LDAPUserFolder: http://www.dataflake.org/software/ldapuserfolder/
.. _`同じ名前のツール`: http://lam.sourceforge.net/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 106
:date: 2005-01-11 11:28:26
:title: Windows AntiSpyware 入れてみました
:categories: ['misc']
:body type: text/x-rst
:body:
Microsoft製の無料スパイウェアチェッカー、 `Windows AntiSpyware`_ を入れてみた。
実行したら、早速、「WindowsMessenger」と「RealVNC」が引っかかった。

自分が使うPCは全部に同じスパイウェアが検出されていたけど(以前 Spybot_ で検索)、もしかしてRealVNCが原因だったりするだろうか……。

.. _`Windows AntiSpyware`: http://www.microsoft.com/athome/security/spyware/default.mspx
.. _Spybot: http://www.safer-networking.org/en/index.html


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 107
:date: 2005-01-15 17:35:56
:title: 実験用LDAPサーバーをjailで立てる
:categories: ['Unix']
:body type: text/x-rst
:body:
Plone_ のユーザー・グループ管理をLDAPで行うための実験をしようとして、さすがに運用中の Zope_ やLDAPを使って実験するのは怖いのですべて実験用に環境を用意することにした。

で、ちょっと調べてみたけれどOpenLDAPを同一サーバー上に複数立てる方法がわからなくて、しょうがないのでJailで環境を作って立てることにした。ところが、実際にLDAPに行き着くまで結構時間がかかってしまった。

1. FreeBSD-5.2.1-Releaseのソースをcvsupで取ってくる (cvsupに15分)
2. `FreeBSD 5.1-Release でJAILを試すメモ`_ を参考にjail環境を作成する (make world に1時間)
3. ports環境の用意 (cvsupに15分)
4. portsからOpenLDAPをインストールする (make install に30分)

ほとんどが待ち時間というのが‥‥。しかも、LDAPの環境作成してからやっと本題が始まる。遠い‥‥。

.. _Plone: http://plone.jp/
.. _Zope: http://zope.jp/
.. _`FreeBSD 5.1-Release でJAILを試すメモ`: http://www.fkimura.com/jail0.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 108
:date: 2005-01-15 18:01:56
:title: 一つのサーバーでLDAPを複数立てる
:categories: ['Unix']
:body type: text/x-rst
:body:
jail環境に入れたLDAPの設定をしていて気がついた。slapdの起動パラメータでconfファイル指定とかport指定とかするのね‥‥。

‥‥まぁ、現行環境から分離されたLDAP環境ができたから‥‥いい‥‥よね？



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 109
:date: 2005-01-16 19:55:15
:title: PloneのユーザーとグループをLDAPで管理する
:categories: ['Zope']
:body type: text/x-rst
:body:
LDAPですべてのユーザー管理を行うことを目標に、今回はPloneのユーザー・グループ管理をLDAPでやってみる実験をしてみた。

結論： **難解**

結局今のところ、Plone2.1待ちだったりGRUF3.2待ちだったりするので、今公開されているPlone2.0.5やGRUF3.2RC1で運用するにはいくつか我慢しないといけない部分がある。
詳しくは、GRUF3.2RC1に添付されているREADME.txt, README-Plone.stx, README-LDAP.stx を参照。README.txtに同梱されているIRCのチャットログがすべてを物語っている気がする。

それはそれとして。今のバージョンでLDAP管理を使おうとした場合の手順と、自分の作業課題をメモメモ。

*# あーー、つかれたー*


:extend type: text/x-rst
:extend:
確立した手順
--------------
- Products
    - `Plone2.0.5`_
    - `GRUF3.2RC1`_
    - `LDAPUserFolder2.4`_
- Setup （すべてPloneSiteオブジェクト以下で作業）
    - portal_skin/gruf_ldap_required_fields をcustomへ。
        - 何も変更せずに保存。(標準ではなぜかsyntax error）
    - acl_users→sourceの変更
        - UserSourceをLDAPUserFolderに設定、Group Stored on LDAPとする
        - GroupSourceをLDAPGroupFolderに設定
    - ZopeRoleのマッピング
        - PloneのRole名と同じ名前のGroupをLDAPに作り、mappingする
            - acl_users/Groups/LDAPGoupsFolderへ移動
            - GroupsタブでManager,Member,ReviewerをgroupOfUniqueMemberで追加
            - ページ下のAdd LDAP group to Zope role mapping で上記3つをマップ
    - Ploneグループの追加
        - Ploneの管理画面上でふつうに追加可能。
        - Role名がGroupとして見えるが、無視。
    - ユーザー追加
        - ふつうに追加
        - ログインするまではそのままでは検索一覧に見えない


残った問題と課題
----------------
- ユーザーデータ
    - plone上からパスワード変更を行った場合にsambaパスワードも変更したい
    - uidを使えるようにしたい
    - mailaddrをLDAP上に格納したい
    - FullNameをLDAP上に格納したい
    - LDAPのcn,snがどちらもloginIdと同じになる問題
- Plone上でユーザー一覧が表示されない（LDAPUserFolderの制限）
- Plone上にZopeRoleにマッピングしたLDAPのGroupが表示される
- manageページのGRUFでユーザー追加直後に"Clicking here"のリンク先が間違っている
    - リロードしてもNG
    - Usersタブを一度クリックするとOK
- 追加後manageページのGRUFのUser一覧から追加ユーザーのリンクがエラーとなる
    - そのユーザーでログオンするとOKとなる。(readme-plone.stx)
- 追加後ユーザーグループ管理で一覧に出てこない
    - そのユーザーでログオンして個人設定を保存した直後は一覧にでる
    - Groupの追加等を行うと再び表示されなくなる
- manageの各ユーザー設定で、SetGroups,SetRolesでchangeするとエラーとなる
    - グループにroleを割り当てられない件と同一原因ではない。


罠
----
- LDAPUserFolderExtはGRUF3.1.xに取り込まれているため不要
- LDAPUserFolder non-ASCII support complete はLDAPUserFolder2.3β3に取り込まれているため不要


.. _`Plone2.0.5`: http://plone.org/downloads
.. _`GRUF3.2RC1`: http://ingeniweb.sourceforge.net/Products/GroupUserFolder/
.. _`LDAPUserFolder2.4`: http://www.dataflake.org/software/ldapuserfolder/


%%%%%%%%%

:id: 110
:date: 2005-01-17 21:12:42
:title: 調布ラーメン紀行
:categories: ['misc', 'food']
:body type: text/x-rst
:body:
akn_ から、「技術用語ばっかりで楽しくないから、調布ラーメンBlogでも書いたら？」とのアドバイス（？）を受けた。

各ラーメン屋で１食毎にレポートを載せてみるのも面白いかもしれない。

- １日目：坂内ラーメン
- ２日目：坂内ネギラーメン
- ３日目：坂内チャーシューメン
- ４日目：坂内ネギチャーシューメン
- ５日目：坂内餃子
- ６日目：坂内ライス
- ７日目：坂内半ライス
- ８日目：坂内チャーシュー皿
- ９日目：坂内メンマ皿

……こんなんでいいんでしょうか？＞akn

.. _akn: http://akn.to/blog



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 111
:date: 2005-01-17 22:38:57
:title: WZの色分け for python
:categories: ['WZ', 'python']
:body type: text/x-rst
:body:
負けました。＜挨拶

`Whining Express`_ より::

  WZ PYTHON SCRIPT EDITOR
  ご参考までに。Pythonスクリプトを、僕はこんな感じの文書の設定で表示させています。

きめ細かい設定してるなぁ‥‥。自分の場合はというと

色分け::

  rear(use=1;rgb="0x0080FF";atr=0): #
  area(use=1;rgb="0xFFFF00";atr=0;flag=2): " " \"
  area(rgb="0xFFFF00"): ' ' \'
  words(use=1;rgb="0x00FF00";atr=0): if else elif endif
  reword(rgb="0x00FFFF";atr=0;re=1): 0x[0-9a-fA-F]+
  reword(use=1;rgb="0x00FFFF";atr=0;re=2): <(\d+)>
  words(use=1;rgb="0x00FF00";atr=0): and class def except exec float for from import in int is lambda list not or pass print raise return self str try tuple False None True
  chars(rgb="0xFF0000";atr=2): \(kata)

見出し３::

  ^\s*def\s+(\w[\w\d_]*).*

このくらいしか設定してませんわ。早速利用させてもらいましょうかね。


.. _`Whining Express`: http://www.emptypage.jp/whining/2005-01-16.html




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 112
:date: 2005-01-18 22:41:23
:title: PDA, そろそろ買い換え時か……
:categories: ['misc']
:body type: text/x-rst
:body:

久々に通勤中に音楽を聴こうと思って、GENIO君にヘッドフォンジャックを接続。あれ？SDメモリカードが認識してない？しばらくSDメモリをなでたりさすったりしてやっと認識されました。やっぱりもう寿命なのかもしれない。

▼満身創痍。さすがに落下させすぎたか。

|genio_broken1| |genio_broken2|

とか言ってたら `Axim X50/X50v`_ と `iPaq hx2750/hx2410`_ が発売に。比較ポイントは指紋認証か、Bluetooth1.2か……いや、 **Intel 2700Gマルチメディアアクセラレータ** か……？

って、歩いてる振動でSDメモリが認識されなくなって曲が止まった(ToT

.. |genio_broken1| image:: images/genio_broken1
.. |genio_broken2| image:: images/genio_broken2
.. _`Axim X50/X50v`: http://pc.watch.impress.co.jp/docs/2005/0113/dell.htm
.. _`iPaq hx2750/hx2410`: http://pc.watch.impress.co.jp/docs/2005/0113/hp.htm



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 113
:date: 2005-01-18 22:43:28
:title: 今週はいそがしい
:categories: ['work']
:body type: text/x-rst
:body:
今週リリースのコードに問題が見つかり、今週は超忙しくなりそうな予感。土日も覚悟せねば。

でも今日はもう帰ります。(in 会社)



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 114
:date: 2005-01-18 23:47:56
:title: CFに避難
:categories: ['misc']
:body type: text/x-rst
:body:
帰り道は手でPDAへの振動を吸収しつつ、ECLIPSE ONE を聴きながら帰ってきました。そのとき思いつきました。「そうだ、CFスロットがあるじゃないか！」

手持ちのCFは128MBで、CFに入ってないと困るデータが64MBほど占領してました。64MBはちょっと少ないかも。

**やはり、PDA買い換えるしかないのカッ！**



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 115
:date: 2005-01-19 00:12:48
:title: マイクロソフトのスパイ対策
:categories: ['misc']
:body type: text/x-rst
:body:
`Final β Laboratory - 記憶更新履歴`_ より

	*"スパイウェアが変更したページを、自社で運営するオンラインサービスであるMSNのホームページと検索ページに置き換えようとする。これではスパイウェア作者の強引なやり口と同じようなものだ"* ……ってこれ、単にInternet Explorerのデフォルトに戻すということではないの？

ソフトの設定に、乗っ取られた場合に **どのURLで上書きするか** を入力できる項目がありましたよ。

ただ、その設定にたどり着けるのは１０人に１人くらいかもしれませんが（おおげさ）。

*# 引用用のスタイルを作ってなかったー(;-;*

.. _`Final β Laboratory - 記憶更新履歴`: http://www.finalbeta.jp/update_log/2005_01.html#log20050117_2



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 116
:date: 2005-01-20 01:34:25
:title: WZマクロからPythonコードを実行する
:categories: ['WZ', 'python']
:body type: text/x-rst
:body:
`WZ Editor`_ のマクロから Python_ コードを実行するためのDLLを作ってみた。

WZマクロの例::

	int main(TX* text)
	{
		printf( "1: %d\n", fnPygw("pywz","func1","teststrings") );
		printf( "2: %d\n", fnPygw("pywz","func2","teststrings") );
	
		char* code = "reduce(lambda x,y:x+y,[x for x in range(0,10)])";
		printf( "3: %d\n", fnPygw("pywz","func3", code) );
	
		return 0;
	}

呼び出されるPythonコードの例::

	func1 = lambda x: len(x)
	func2 = lambda x: 15
	def func3(x):
		return eval(x)

実行結果::

	1: 11
	2: 15
	3: 45

実行結果が説得力に欠けるな‥‥。

WZマクロ側から指定できるのは今のところ *呼び出すPythonモジュール名* , *モジュールの関数名* , *引数となる文字列* だけで、返値はint決め打ちだから、あんまり複雑なことはできない。でも可能性はあるかも。

file: `pygw20050119.lzh`_

.. _`WZ Editor`: http://www.villagecenter.co.jp/soft/wz50/
.. _Python: http://python.jp/
.. _`pygw20050119.lzh`: file/wz/pygw20050119.lzh



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 117
:date: 2005-01-20 23:00:39
:title: CSSのoverflowプロパティー
:categories: ['Zope', 'Memo']
:body type: text/x-rst
:body:
自分のblogで、 `昨日`_ とか `数日前`_ に改行の入らない引用を用いてしまったためにサイトが見づらい状態になってしまっていた。

そこで **overflow: auto;** ですよ。

というかたまたま別のサイトで目にとまって知ったんだけど、手元のCSS本には載ってなかった。まだまだ知らないCSSプロパティーがたくさんありそうだ。（ブラウザ依存とかありそうだけど）

ということで、見つけたサイトのを一通り眺めてみようかな。

http://www.w3schools.com/css/css_reference.asp

.. _`昨日`: http://www.freia.jp/taka/blog/116
.. _`数日前`: http://www.freia.jp/taka/blog/111


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4665173154
:title: Re: CSSのoverflowプロパティー
:author: micro-8
:date: 2005-01-21 10:39:11
:email: 
:url: 
:body:
私は


にいつも助けられています。


:comments:
:comment id: 2005-11-28.4666316325
:title: Re: CSSのoverflowプロパティー
:author: 清水川
:date: 2005-01-21 10:59:26
:email: taka@freia.jp
:url: 
:body:
おお、めちゃくちゃ細かくかいてある！
今後参考にしたいと思います。ありがとうございます。

その後以下のサイトも見つけたので、メモ。導入には良いかも。

%%%%%%%%%

:id: 118
:date: 2005-01-22 00:16:58
:title: 土曜も忙しい
:categories: ['work']
:body type: text/x-rst
:body:
`土日出勤かもと書いた`_ ら、本当に土曜日出勤になった。忙しくて、やりたいことができない週というのは本当に息が詰まる。けど、あと少しだ！がんばろう！＞みんな

.. _`土日出勤かもと書いた`: http://www.freia.jp/taka/blog/113



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 119
:date: 2005-01-22 01:43:18
:title: WZマクロからPythonコードを実行する２
:categories: ['WZ', 'python']
:body type: text/x-rst
:body:
先日作った pygw 1_ を拡張して、 Python_ のprint文出力先をWZの任意の関数に接続できるようにしてみた。

WZマクロの例::

	#include <windows.h>
	#include "pygw.h"
	
	static FARPROC PrinfRegCode; //RegCode
	
	void CALLBACK Print(char* str)
	{
		printf(str);
	}
	
	int main(TX* text)
	{
		PrinfRegCode = txpcodeRegisterCallback( Print, 1 );
		PYGW_SetStdout( PrinfRegCode );
	
		PYGW_Pygw("pywz","func1","teststrings");
		PYGW_Pygw("pywz","func2","teststrings");
		PYGW_Pygw("pywz","func3","reduce(lambda x,y:x+y,[x for x in range(0,10)])");
		PYGW_Pygw("pywz","func4","Hello");
	
		txpcodeUnregisterCallback( PrinfRegCode );
		PrinfRegCode = NULL;
		return 0;
	}

呼び出されるPythonコードの例::

	import stdout
	
	def func1(x):
		print "1: ", len(x)
		return len(x)
	
	def func2(x):
		print "2: ", x
		return 0
	
	def func3(x):
		print "3: ", x, " ==> ", eval(x)
		return eval(x)
	
	def func4(x):
		print "4: ", [s for s in x]
		return len(x)

実行結果::

	1:  11
	2:  teststrings
	3:  reduce(lambda x,y:x+y,[x for x in range(0,10)])  ==>  45
	4:  ['H', 'e', 'l', 'l', 'o']

実行結果はもちろんWZのSTDOUTに出力される。以下が証拠画像だ！（ねつ造じゃないよ？）

|pygw_wz1|


file: `pygw20050121.lzh`_

.. [1] `WZ Editor`_ のマクロから Python_ コードを実行するためのDLL
.. _`WZ Editor`: http://www.villagecenter.co.jp/soft/wz50/
.. _Python: http://python.jp/
.. _`pygw20050121.lzh`: file/wz/pygw20050121.lzh
.. |pygw_wz1| image:: images/pygw_wz1



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 120
:date: 2005-01-23 00:23:29
:title: PSX(DESR-7500)のバグ、その後
:categories: ['Memo', 'misc']
:body type: text/x-rst
:body:
`PSX(DESR-7500)のバグ？`_ で「メールでの問い合わせに対応してもらえるのは来年かな」と書いたが、今日になって返事が来た。メール出したことすら忘れてたよ‥‥。

メールの返答には若干的はずれなことが書いてあったけど、まあこれはしょうがないと思う。現象自体がおそらくPSX(7500)と日立WOOOとの相性問題だと思うし、D端子をよくわかっていない人向けには「PSXはD1,D2対応だからテレビ側の規格があっているか確認してほしい」という回答も‥‥あれ？D1,D2を受け入れないD端子って一般的にあるのかな？自分もD端子よくわかってないや。

で、メールの最後にテクニカルサポートに問い合わせてくれ、と書いてあったので電話して「ゲームを起動するとD端子出力画像が乱れる・映らない。S出力は映る」と伝えたところ、 **「ゲーム中はS出力に切り替えて使ってほしい」** という返答をいただいた。

まて。まさかソニーのサポートがそんなことを言うとは思わなかったぞ？

# *その後、既知の相性問題であり対処の方針までは決まっているとの回答をもらいました。対応時期は未定だけど。*

.. _`PSX(DESR-7500)のバグ？`: http://www.freia.jp/taka/blog/98



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4676096991
:title: Re: PSX(DESR-7500)のバグ、その後
:author: 友次郎
:date: 2005-01-23 02:11:23
:email: yujiro_remove_this_part_@finalbeta.jp
:url: 
:body:
ブラウン管テレビなどでプログレッシブ表示（D2以上）ができないものは、480i＝D1（インターレース）のみ対応というのはありますね（うちのがそうです）。
プログレッシブ出力に対応しているゲームは多くないはずなので、DVDなどをプログレッシブで出力していてもゲーム時はインターレースで出ていると思われます。ゲームだけ相性問題が起きる理由はその辺っぽいですが……。WOOOにはソースがインターレースの場合用の特殊な設定などないでしょうか？



:comments:
:comment id: 2005-11-28.4677283953
:title: Re: PSX(DESR-7500)のバグ、その後
:author: 清水川
:date: 2005-01-23 11:47:58
:email: taka@freia.jp
:url: 
:body:
> WOOOにはソースがインターレースの場合用の特殊な設定などないでしょうか？

特にないようです。
あ、「D1,D2を受け入れないD端子って」の一文は「D1～D4に対応している機器なのに、D1,D2を受け入れないD端子を持つ機器」があるのかな？という意図でした。前提を書き漏らしていました‥‥(--;;

サポートの人の説明では、「DESR-5000から機能アップのために部品を変えたために起きた問題」のようです。
対策として「専用のD端子ケーブルを作る」とかを考えているらしいです。それで解消できるものなのかは疑問が残るところです。



:comments:
:comment id: 2005-11-28.4678451888
:title: Re: PSX(DESR-7500)のバグ、その後
:author: 友次郎
:date: 2005-01-24 23:27:08
:email: yujiro_remove_this_part_@finalbeta.jp
:url: 
:body:
>D1～D4に対応している機器なのに
あ、了解です。

しかしD端子で相性問題ってあまり聞いたことないですよねえ。
しかもケーブルで直るものとは？ますます謎です(^^;
%%%%%%%%%

:id: 121
:date: 2005-01-24 18:33:28
:title: Python UnitTestのドキュメント
:categories: ['python', 'Memo']
:body type: text/x-rst
:body:
`Python Unit Testing Framework (in Japanese)`_ を発見。これでテスト駆動を始めるきっかけをつかめそう。

でも、ここ数日 pygw_ のためにCコードばっかり書いてる気がする。


.. _`Python Unit Testing Framework (in Japanese)`: http://pyunit.sourceforge.net/pyunit_ja.html

.. _pygw: http://www.freia.jp/taka/blog/119



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 122
:date: 2005-01-24 23:32:31
:title: PSX(DESR-7500)のバグ、寄せられた情報
:categories: ['Memo', 'misc']
:body type: text/x-rst
:body:
`PSX(DESR-7500)のバグ、その後`_ にトラックバックをもらったのだけど、うまくいってないみたい。

- トラックバック元： `DESR-7500購入`_

ホームメニューで画像が乱れる、とのことで、どうやら原因はコピーガードのよう。なんだか画面表示周りで変な問題が多いのかな‥‥＞DESR-7500

同じくDESR-7500を購入した友人Ricは特に何ともない様子。 http://www.satellite.co.jp/picture-t.html の変換ケーブルを使ってPSX ⇒ AVアンプ ⇒ プラズマとつないだら、相性問題が解消されたりしないだろうか？という提案をもらったりもしたのだけど、残念ながらうちのプラズマーにはそういう端子は無いのでした‥‥。


.. _`PSX(DESR-7500)のバグ、その後`: http://www.freia.jp/taka/blog/120
.. _`DESR-7500購入`: http://tomoaki.cocolog-nifty.com/pc/2005/01/desr7500.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 123
:date: 2005-01-24 23:51:40
:title: 新宿 渡邊
:categories: ['food']
:body type: text/x-rst
:body:
新宿の `渡邊`_ で *山かけ* と *鳥わさ* を食す。

鳥わさ。ちょっとわさびが少ないような‥‥。（写真撮る前に箸つけちゃったorz）

  |toriwasa|

山かけ。温蕎麦は蕎麦の香りがほとんど感じられないといつも思う。でも山かけ好き。

  |yamakake|

京王線新宿駅ホームの **高尾山蕎麦フェア広告に惑わされた** わけではない。けっして。

.. _`渡邊`: http://www.bekkoame.ne.jp/~kodama-m/soba/w/watanabe.html
.. |toriwasa| image:: images/watanabe_toriwasa
.. |yamakake| image:: images/watanabe_yamakake



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 124
:date: 2005-01-25 01:00:24
:title: Pythonを利用するDLLのデバッグ
:categories: ['python', 'Programming']
:body type: text/x-rst
:body:
デバッグ版Python32_d.libは標準のパッケージ 1_ には同梱されていない。そしてpython.hをincludeすると内部的に以下のようにかかれているので、Debugだとpython23_d.libを自動的にリンクしようとして失敗してしまう。::

  #ifdef _DEBUG
      #pragma comment(lib,"python23_d.lib")
  #else
      #pragma comment(lib,"python23.lib")
  #endif /* _DEBUG */

なので、Pythonを使うC++アプリをVS.NETで作ってもReleaseでしかコンパイルできないのでデバッグが大変。というかDebug版無しに開発するのはIDEに慣れてしまった身としては苦痛。いや、苦痛とか言ってないでUnitTestすればいいんだけど。

どっかにコンパイル済みのpython23_d.libがあるだろ！と思って調べてみたら、 `もっと簡単な方法`__ が::

	So if you want you should be able to change your source to something
	like this:
	
	#undef _DEBUG
	#include <python.h>
	#define _DEBUG

__ http://mail.python.org/pipermail/python-list/2004-June/226167.html


あー、なるほどー。

.. [1] Python 2.3.4 日本語環境用インストーラ(Win32)を使ってます。 http://www.python.jp/Zope/download/pythonjpdist


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 125
:date: 2005-01-25 17:27:12
:title: Plone2.0でreStructuredTextを使う方法
:categories: ['Zope']
:body type: text/x-rst
:body:
普通のDocumentの「形式」に追加されるのかと思いきや、reStructuredDocumentというアイテムが増えた。……微妙？

http://www.hashikem.com/zope/Plone/Members/kem/InstallHowTo/SetupReStructuredText



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 126
:date: 2005-01-26 20:57:01
:title: 笑えた
:categories: ['misc']
:body type: text/x-rst
:body:
`生きてま`_ より。爆笑！

http://www.geocities.jp/navyfrog993/HibiZakkan/05/Jan05/Jan05.htm

.. _`生きてま`: http://log.giantech.jp/582



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 127
:date: 2005-01-26 21:33:31
:title: FreeBSDのインストーラのkernel入れ替え
:categories: ['Unix', 'work']
:body type: text/x-rst
:body:
FreeBSDの4.11-Releaseでは、ICH6がサポートされていないためにSATA150を認識してくれない。あまつさえIntel915なマザーでSATAなHDDが搭載されていると、インストーラの起動途中でハングアップしてしまう。

で、 調べてみたら `デバイス名の定義を追加するだけ`_ で動いてくれそうなので、別のPCに入れたFreeBSDのカーネルソースにパッチを当てて試してみたところ問題なく動作している。ついでにインストーラのkernelを入れ替えれば万事OK!‥‥でもやりかたが分からない。

ということでさらに調べたら `本家ML`_ と `QandA`_ でヒントを見つけた。これでCDのインストーラーイメージを編集して試してみよう。。

.. _`デバイス名の定義を追加するだけ`: http://archive.pilgerer.org/mharc/html/freebsd-stable/2004-09/msg00125.html
.. _`QandA`: http://www.jp.freebsd.org/cgi/print-QandA.cgi?QandA=1451
.. _`本家ML`: http://home.jp.freebsd.org/cgi-bin/showmail/FreeBSD-users-jp/60516




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 128
:date: 2005-01-26 22:04:21
:title: インフルエンザ、そして花粉
:categories: ['misc']
:body type: text/x-rst
:body:
インフルエンザ、大変そうですね‥‥。このまま回復するといいですね。＞ `あまぴょん`_

自分も予防接種等してないので一抹の不安があります。（予防接種シーズンに中耳炎をやらかしてしまったので接種そのものに不安があったので‥‥言い訳）

インフルエンザの次は花粉、ということで、今年はなにやら `大変らしい`_ です。花粉の量が去年の10倍以上とか‥‥。会社でもすでに影響を受けてる人がいたり‥‥。今まで花粉にやられたことがない自分も一抹の不安が。花粉は予防接種無いからな～。

（今は `花粉情報`_ (予報？)なんてのもあるんだ‥‥）

.. _`あまぴょん`: http://amapyon.org/blog/61
.. _`大変らしい`: http://eco.goo.ne.jp/life/health/kafun/kafun2005/gaiyou/01_1.html
.. _`花粉情報`: http://health.nikkei.co.jp/kafun/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 129
:date: 2005-01-27 09:43:43
:title: シェル出力先リダイレクトの間違い
:categories: ['Zope']
:body type: text/x-rst
:body:
標準出力をファイルに書き出す方法は知っていたけど、エラー出力先を切り替えたりする方法は知らなかった。ちょっと調べれば分かることなのに……。

`Landscape`_ の記事を読んで、標準出力とエラー出力をNULLデバイスに捨てる方法として以下のように書くのは間違いだと言うことはよく分かった(--;::

  # command  2>&1 >/dev/null

正しくは::

  # command >/dev/null  2>&1

.. _`Landscape`: http://sonic64.hp.infoseek.co.jp/2004-03-28.html#2004-03-28-1



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 130
:date: 2005-01-27 21:38:57
:title: _SUPPRESS_ACCESSRULE
:categories: ['Zope', 'Memo']
:body type: text/x-rst
:body:
Zope上で設定や開発をしていてよくはまった罠が二つある。

- Site Rootの設定を間違えた
- Set Access Ruleを設定したPythonScriptが例外を出す状態で保存してしまった

どちらも大抵はサブフォルダ以下にアクセスできなくなってしまう。回避方法の一つにFTP接続で対象オブジェクトを削除してしまうというのがあるけど、もう一つの方法が以下のように対象のURLに回避指定を入れる方法::

  Site Rootの場合は
    http://www.freia.jp/target/_SUPPRESS_SITEROOT/manage
  Set Access Ruleの場合は
    http://www.freia.jp/target/_SUPPRESS_ACCESSRULE/manage

Site Rootの方は `Zopeガイド`_ に載っていたけど、AccessRuleは載っていなかったのでメモ。

.. _`Zopeガイド`: http://www.amazon.co.jp/exec/obidos/ASIN/4839907900



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 131
:date: 2005-02-01 12:59:17
:title: blogパターン
:categories: ['Pattern', 'Memo']
:body type: text/x-rst
:body:
`ブログパターン 「気合い入りすぎると書けない」`_

Yukio Andohさんのコメントが興味深い。これをカタログ化出来たら面白いだろうなぁ。

.. _`ブログパターン 「気合い入りすぎると書けない」`: http://mojix.org/2005/01/31/214200/viewComments



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 132
:date: 2005-02-01 13:01:57
:title: すしメモリ
:categories: ['misc']
:body type: text/x-rst
:body:
`SushiDisk（すし型ＵＳＢメモリ）`_ 一人前欲しい。買う気にならない値段だけど。 ひとつくらいなら……

.. _`SushiDisk（すし型ＵＳＢメモリ）`: http://sa-store.com/shop.php?category_id=25&item01_id=37



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4714852059
:title: Re: すしメモリ
:author: AKN
:date: 2005-02-01 23:41:59
:email: webmaster@akn.to
:url: http://akn.to/blog/
:body:
大将、いくら軍艦で一つお願いしやす。一人前と言わず、一つだけでいいから欲しいが、相場を無視しまくった値段設定やなー。寿司だけに時価！？


:comments:
:comment id: 2005-11-28.4716021739
:title: Re: すしメモリ
:author: 清水川
:date: 2005-02-02 23:54:26
:email: taka@freia.jp
:url: 
:body:
私はカッパで。会社のX31に生やしておこう。
%%%%%%%%%

:id: 133
:date: 2005-02-08 23:14:35
:title: Python による ゲームプログラミング実況中継 (1)
:categories: ['python']
:body type: text/x-rst
:body:
`Python による ゲームプログラミング実況中継 (1)`_

すばらしい！！さっそくみんなに見せよう！

.. _`Python による ゲームプログラミング実況中継 (1)`: http://www.unixuser.org/~euske/doc/pygame/pygameintro1.html


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 134
:date: 2005-02-12 17:13:28
:title: Python Performance Tips
:categories: ['python', 'Memo']
:body type: text/x-rst
:body:
メモ。 `Python Performance Tips`_ 。今後コードを書くときにちょっとした指標になるかも？

.. _`Python Performance Tips`: http://manatee.mojam.com/~skip/python/fastpython.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 135
:date: 2005-02-12 17:24:39
:title: PSX(DESR-7500)のバグ、D端子ケーブルが届いた
:categories: ['Memo', 'misc']
:body type: text/x-rst
:body:
金曜日にソニーから `DESR-7500と日立WOOOシリーズとをD端子接続した場合の問題`_ を解消するためのD端子ケーブルをお送りします、という電話があった。

で、翌日の今日ケーブルが届いたので早速試してみたところ、問題なく映っているるようだ。ただ、S出力に比べるとちょっとだけ赤みが強いような感じもするけど、比較すべきは「市販のD端子ケーブルで接続したときの画像」なので、Sと比べてどうこう言ってもしょうがない。素人目にはノイジーな感じもしないので、しばらく使ってみることにする。

それにしても専用ケーブルで直ると言うことは、ケーブル内部で配線をクロスしたり、抵抗を入れたりしてるんだろうか‥‥。このケーブル、WOOO以外のディスプレーに繋いだらどうなるんだろう？恐くて試せない（笑）

.. _`DESR-7500と日立WOOOシリーズとをD端子接続した場合の問題`: http://www.freia.jp/taka/blog/120



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4725452987
:title: Re: PSX(DESR-7500)のバグ、D端子ケーブルが届いた
:author: つかぽん
:date: 2005-02-25 23:12:48
:email: 
:url: http://hiwai.plus9.info/
:body:
PSX生産完了だってね～。


:comments:
:comment id: 2005-11-28.4726580830
:title: Re: PSX(DESR-7500)のバグ、D端子ケーブルが届いた
:author: 清水川
:date: 2005-02-25 23:26:28
:email: taka@freia.jp
:url: 
:body:
かまいませんとも！
良い物は良い。

別名：井の中の蛙



:trackbacks:
:trackback id: 2005-11-28.4727732081
:title: DESR-7500でゲーム
:blog name: パソコンとカメラの日々
:url: http://tomoaki.cocolog-nifty.com/pc/2005/02/desr7500.html
:date: 2005-11-28 00:47:52
:body:
清水川記 　そういえばDESR-7500って、PS2相当のゲーム機としても動作す
%%%%%%%%%

:id: 136
:date: 2005-02-19 10:23:41
:title: Zope Weekend 5
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
今日は `Zope Weekend 5`_ が開催されます。今回はお手伝いスタッフとして参加します。

*# 久しぶりに食べたベーグルは胡麻ベーグルになっていました。*

.. _`Zope Weekend 5`: http://zope.jp/misc/zopeweekend5/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 137
:date: 2005-02-20 00:18:02
:title: Zope Weekend 5 終了
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
最近いろんなモチベーションやらやる気やらが下がり気味だったので、今回の Zope Weekend 5 も参加しようかどうか‥‥という感じでした。でも、やっぱり参加して良かった！インスピレーション、モチベーション、等々、いろいろと補充させていただきました。

ということで、気持ちがアツイうちに自分のサイトのplone移行を行ってみたいと思います。

３次会まで出席した酔った頭でどこまでできるのか！？？（酔った勢いとも言う）


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 138
:date: 2005-02-20 00:52:45
:title: Ploneへの移行失敗‥‥
:categories: ['Zope']
:body type: text/x-rst
:body:
酔った勢いで自分のサイトをPloneに移行しようとしてはいけないことが分かった。とりあえずUnicodeDecodeErrorが出てしまって、日本語のコンテンツ入力ができないようだ。

‥‥なんで？？



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4736935920
:title: Re: Ploneへの移行失敗‥‥
:author: 清水川
:date: 2005-02-21 02:41:58
:email: taka@freia.jp
:url: 
:body:
lexicon作り直したら大丈夫でした。その代わりCOREblogにentry追加出来なくなりました‥‥
%%%%%%%%%

:id: 139
:date: 2005-02-21 09:01:53
:title: COREblog in Ploneフォルダ
:categories: ['Zope']
:body type: text/x-rst
:body:
Ploneへとりあえず移行しました。

COREblogのインスタンスをPloneフォルダに移動させたところ、

- 初期表示時にFormatが設定値にかかわらずPlainTextになる
- エントリのPreview時に本文が表示されない
- エントリのPreview時にFormat設定値がPlainTextにリセットされる

等々の問題があることが分かりました。が、とりあえずAddEntryは正しく動作しているようなので、このまま様子を見ながら運用してみたいと思います。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4745408069
:title: Re: COREblog in Ploneフォルダ
:author: 清水川
:date: 2005-02-21 11:07:29
:email: taka@freia.jp
:url: 
:body:
追記： 環境依存の可能性は高いと思う。別環境で試してからMLに問い合わせてみよう……。


:trackbacks:
:trackback id: 2005-11-28.4746544401
:title: うわ，ほんとだ(Re: COREBlog in Ploneフォルダ)
:blog name: TRIVIAL TECHNOLOGIES
:url: http://coreblog.org/ats/576
:date: 2005-11-28 00:47:54
:body:
ん。早速試したところ，エントリの投稿時，デフォルトフォーマットが指定したとおりにならない。
多分Ploneインスタンス上にあるattribute(Propertyかなにか)と，COREBlog上のPropertyが衝突して居るんだと思います。明示的にCOREBlogインスタンス上にあるPropertyから...


:trackbacks:
:trackback id: 2005-11-28.4747493431
:title: なんか新しいPLONEとかいうXOOPSみたいなCMS・・・
:blog name: レトロブログ - retroさんのブログ - RETRO-MANIA
:url: http://www.retro-mania.net/modules/weblog/details.php?blog_id=28
:date: 2005-11-28 00:47:54
:body:
PLONEっていうコミュニティサイト構築スクリプトを相棒がインストールしだしたので、興味しんしんで経過を見守っています。見た目は、なんとなくスマート。当サイトでも利用しているXOOPSの場合、各種モジュールを追加することによって、色々な機能を共通の言語で利用することができるのですが（たとえば　imgboard、blog、掲示板、フォーラム、ニュース、ヘッドライン、wiki、ゲームなど）このPLONEってのは、まだマイナーな代わりに、ひじょ〜〜にシンプル。そして、技術者いわく「軽い」そうです。今後、流行す...
%%%%%%%%%

:id: 140
:date: 2005-02-21 13:05:43
:title: Zope Weekend の感想
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
撮影した `写真を掲載`_ しました。各プレゼンの写真はmojixさんが撮影されていたので、それ以外の部分を撮ってみました。

当日は受付半分、聴講半分だったのでメモを残せませんでした。そのなかで一番印象に残ったのは、やはり OGURADIO_ さんでしょう！Zopeもploneも初めてで数週間でここまでくるとは‥‥！


.. _`写真を掲載`: http://www.freia.jp/taka/photo/zw5
.. _`OGURADIO`: http://oguradio.com/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 141
:date: 2005-02-21 18:30:15
:title: 今から大阪
:categories: ['work']
:body type: text/x-rst
:body:
明日朝から大阪で打合せがあるのですが、朝５時台に起きるのは避けたいので勝手に前泊することにしました。（自腹ですが...）

ということで、今から東京駅へ向かいます。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 142
:date: 2005-02-22 00:54:01
:title: PloneのDiscussion設定をOnにしたら権限を失った！？
:categories: ['Zope']
:body type: text/x-rst
:body:
タイトルのまんまだが、Anonymousだろうが、Manageだろうが、トップページを表示しようとすると権限不足ですと言われてしまう。何事！？？

とりあえず、エラーメッセージから、getReplies関数へのアクセス権が無いらしいことが分かったので、これから調べることに‥‥大阪の夜はplone調査‥‥

エラーメッセージ抜粋::

  You are not allowed to access 'getReplies' in this context
  portal.sort_modified_ascending( portal_discussion.getDiscussionFor(here).getReplies())


追記


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 143
:date: 2005-02-23 00:54:07
:title: 大阪出張から帰ってきました
:categories: ['food', 'work']
:body type: text/x-rst
:body:
串カツ食ってきました。時間も限られていたので大阪梅田駅近辺の地下街で入った店でしたが、これがまたうまかった！最高！

というわけで、 `写真です`_ 。

.. _`写真です`: /taka/photo/osakakushi



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 144
:date: 2005-02-23 01:03:50
:title: ZPhotoSliderの画像を表示するportlet_recent_images
:categories: ['Zope']
:body type: text/x-rst
:body:
ploneの便利な点は、拡張性が高いことで、ちょっとHTML(PageTemplate)を書くと「最近公開の画像」という感じでページの左や右に配置することができる。

先日ZPhotoSliderを追加した際に思いついて早速作ってみた。‥‥が、ちょっと横幅取りすぎ。ZPhotoSliderから適切な画像サイズを取得する、あるいは取得した画像を適切なサイズに縮小するひつようがあるんだけど、どうやるんだろう？

‥‥と、簡単に配置できたようなことを書いてるけど、実はものすごい悩んだ。ZCatalogのresultって実オブジェクトじゃなくてカタログインデックスオブジェクト(?)なのね‥‥。

portal_catalog.searchResults()にオブジェクトタイプを指定したまではよかったんだけど‥‥そこから先が分からずにかなり悩んだ。

誤::

  <img tal:replace="structure python:obj.getSymbolicTag()"/>

正::

  <img tal:replace="structure python:obj.getObject().getSymbolicTag()"/>

いままでZCatalogなんてさわったこと無いからなぁ‥‥。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 145
:date: 2005-02-23 01:20:25
:title: 所持金
:categories: ['misc']
:body type: text/x-rst
:body:
`三國志図書館Blog 「★身銭」`_ より

  今日出張で大阪に行く同僚が「財布に1000円しか入ってないのにATMが見当たらん」とか、めちゃくちゃです。

はい。1,000円しか入ってませんでした。
でも、財布に常に5,000円以上入ってることって希なんだけど‥‥。（出張行くときに補充しなかったのはまずかったけど）

というか東京だとほとんど困らない。銀行のキャッシュカード、コンビニATM利用料が0円なのです。大抵、5,000～10,000円くらいずつおろしてます。こうすると銀行の通帳（東京三菱はWebバンクからXMLというかMoneyフォーマットで取得できる）に細かく記録されるので便利。

.. _`三國志図書館Blog 「★身銭」`: http://www.akn.to/mt/archives/2005/02/post_20.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 146
:date: 2005-02-23 20:01:42
:title: ZPhotoSlidesの表示が‥‥遅い‥‥
:categories: ['Zope']
:body type: text/x-rst
:body:
`ZPhotoSlides`_ を利用した写真表示を行っているが、さっき「表示が異様に遅い」指摘されて見てみたら‥‥たしかに。 

`photoページ入り口`_ まではすぐ表示されるのに、そこから各写真を見ようとすると表示されるまでに30～60秒もかかってしまう。一度表示に成功するとそこから先はリロードしてもすぐに表示されるのだが、ブラウザを再起動するとまた表示に時間がかかってしまう。

まさか、

- 毎回サムネイルを作っている
- ブラウザのセッション単位でサムネイルを作っている
- 最初にクライアント側に全写真を送り込んでいる

なんてことは‥‥多分やってないだろうし（一応メモリ量・ファイルシステムアクセス・CPU使用率をチェックしてみた）。

インターネットのお客さんは6秒くらいしか待ってくれないらしいから、このままじゃあ誰も来てくれなくなっちゃうよ‥‥ぐっすん。

.. _`ZPhotoSlides`: http://www.zphotoslides.org/
.. _`photoページ入り口`: http://www.freia.jp/taka/photo



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4768155924
:title: Re: ZPhotoSlidesの表示が‥‥遅い‥‥
:author: 清水川
:date: 2005-02-24 00:48:33
:email: taka@freia.jp
:url: 
:body:
自宅で試してみたらすぐに表示された。会社のネットワークの問題？それとも自宅外からのアクセスで発生する問題？うーん‥‥
%%%%%%%%%

:id: 147
:date: 2005-02-23 21:20:54
:title: COREblogのエントリを表示するportlet_recent_blogentries
:categories: ['Zope', 'Programming']
:body type: text/x-rst
:body:
`portlet_recent_images`_ の次に COREblog_ の最近追加されたエントリ表示をPloneのスロット行う、portlet_recent_blogentriesを作ってみた。 http://www.freia.jp/taka のページで左の柱に表示されていると思う。

作り方は Wiki_ に記載。ファイルもおいた方が良いかな‥‥？

.. _`portlet_recent_images`: http://www.freia.jp/taka/blog/144
.. _COREblog: http://coreblog.org/
.. _Wiki: http://www.freia.jp/taka/wiki/X_e6_9c_80_e8_bf_91_e3_81_aeCOREblogSlot


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 148
:date: 2005-02-25 02:28:42
:title: 深夜残業
:categories: ['work']
:body type: text/x-rst
:body:
まだ会社にいる。不思議だ。

今日は午前中お休みして午後から出社したのだけど、その分のしわ寄せが来てる感じ。リリース前はしょうがないか‥‥。




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 149
:date: 2005-02-27 01:51:43
:title: Ploneの部分的な日本語化ってどうやるのだろう？
:categories: ['Plone']
:body type: text/x-rst
:body:
Ploneの部分的な日本語化ってどうやるのだろう？Productのi18n以下を直接変更するのは避けたいけど、、、。コンテンツを多言語にするのはI18NLayerを入れれば出来るけど、portal_tabs等を増やした場合、Nameに日本語を入れてしまうのは気が引ける。

コンテンツ日本語しか無いから、問題ないんだけど、やっぱり気になる。（そして手が止まる‥‥ぁぅ）

訂正
------
LanguageToolsじゃなくてI18NLayerでした。本文修正しました。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 150
:date: 2005-02-28 01:20:04
:title: ZPhotoSlides日本語化
:categories: ['Plone', 'Zope']
:body type: text/x-rst
:body:
`Zope Developers Camp` にむけて。ネットワーク経由の参加者はまだまだ募集中のよう。参加可能な時間帯に参加できそうな人は参加してみては？＜宣伝

本文


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 151
:date: 2005-02-28 01:54:12
:title: ZCatalogでNot検索
:categories: ['Zope']
:body type: text/x-rst
:body:
目的はPloneのRecentItemのPortletから写真関連を除外することだけど、技術的にはZope標準のZCatalogの使い方について。

`Zopeユーザー会`_ のMLに質問を出したところ、標準のAPIでは無理、という回答。でも代替案をもらったので、 `Wikiメモに追加`_ 。

.. _`Zopeユーザー会`: http://zope.jp/
.. _`Wikiメモに追加`: http://www.freia.jp/taka/wiki/ZCatalog_e3_81_a7Not_e6_a4_9c_e7_b4_a2



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 152
:date: 2005-02-28 02:01:01
:title: 仮面ライダー
:categories: ['misc']
:body type: text/x-rst
:body:
今日はとみたが仮面ライダー龍騎のDVDをごそっと持ってきて上映会を始めた。観客：俺、GO。

えー、ブレイドを見た後だからかもしれないけど、モンスターが「なんか襲ってくる」というのは違和感が。なんでもかんでも「悪者にも理念や目的が必要」‥‥とは言わないけど（言ってる）。

違和感は、今放映中の響鬼の方が大きいけどね。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 153
:date: 2005-02-28 22:08:59
:title: また大阪
:categories: ['work']
:body type: text/x-rst
:body:
明日からまた大阪に行く。明日からというか明日だけだけど、長引いたら泊まりの可能性もないこともない。

大阪人にうまい物を聞いたところ、ネギ焼き、との回答が。うまいのかな。 `うまそうだな‥‥`_ ＜たぶん違う

.. _`うまそうだな‥‥`: http://www.zeitaku.jp/htm/g_tanpin/o-55.htm


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 154
:date: 2005-03-02 03:42:21
:title: 大阪泊まり
:categories: ['work']
:body type: text/x-rst
:body:
打合せのトピックスが尽きなかったため、半予定外の泊まりになった。いちおう泊まりの用意（下着だけ）しておいて良かった。

この打合せ前に「新梅田食道街」で食べたネギ焼き。手前がブタネギのソース・醤油ハーフ＆ハーフ。奥がイカネギ醤油。

|osaka_negiyaki|

.. |osaka_negiyaki| image:: images/osaka_negiyaki


夜は旅の窓口で予約した「法華クラブ大阪」に宿泊。インターネット完備で内装はかなり良い方。7000円なり。だが、歓楽街超隣接で茶髪兄ちゃんのお誘いが多かった。ピンポイントで治安悪そうやなぁ....



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4798264804
:title: Re: 大阪泊まり
:author: 一緒に泊まった同僚
:date: 2005-03-06 02:20:45
:email: 
:url: 
:body:


:comments:
:comment id: 2005-11-28.4799192865
:title: Re: 大阪泊まり
:author: 清水川
:date: 2005-03-07 01:31:34
:email: taka@freia.jp
:url: 
:body:
またあそこ泊まるんですか……って次は泊まりじゃないか(^^;; 水曜また行くのでお昼に寄っていきますか。

%%%%%%%%%

:id: 155
:date: 2005-03-07 01:05:44
:title: Zope Developers Camp 2005 ネットワーク経由参加
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
`Zope Developers Camp 2005 Winter`_ お疲れ様でした。＞関係者の皆さん

自分は Skype_ を使ってネットワーク経由参加しましたが、非常に勉強になりました。特に WingIDE_ でのpython/Zopeデバッグは感激モノです！

Hack!への参加としては、ちょろっとだけZWikiの日本語化に参加しました。土曜は持ち帰りで仕事してたのが残念でした‥‥。それでもなお、参加している間はとても充実した時間を過ごすことが出来、先々週の ZopeWeekend_ に引き続き、またまたZope熱が加速しそうです。

.. _`Zope Developers Camp 2005 Winter`: http://coreblog.org/camp/2005/
.. _Skype: http://web.skype.com/home.ja.html
.. _WingIDE: http://wingware.com/wingide
.. _ZopeWeekend: http://zope.jp/misc/zopeweekend5/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 156
:date: 2005-03-07 01:15:03
:title: ZPhotoSlides20用日本語ファイル
:categories: ['Zope']
:body type: text/x-rst
:body:
気が付くとですます調になってしまう今日この頃。

`Zope Developers Camp 2005 Winter`_ 参加の影で、ZPhotoSlidesの日本語化を進めていた。が、非Plone環境での表示を試してみたところ、全然ダメダメな状況に。日本語部分が全部「????」になってしまっていた。なんで？と思い、ZWikiのzptファイルなんかと比較しながら追っかけてみたところ、ページがutf-8として認識されていないのが原因らしい。それもブラウザが誤認識しているのではなく、i18n化処理の時点で壊れているっぽい‥‥？

とりあえず、強制的にutf-8で認識するようにしたら正しく動作しているようだ（ZWikiの手法を真似てみた）。

ということで、 `成果物`_ 。あとで誰かにレビューたのまなあかんなー。

*#本気で書き言葉が統一できなくなってきてるな‥‥*

.. _`Zope Developers Camp 2005 Winter`: http://coreblog.org/camp/2005/
.. _`成果物`: http://www.freia.jp/taka/wiki/ZPhotoSlides



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 157
:date: 2005-03-07 23:47:18
:title: ZPhotoSlides20日本語化バグ修正
:categories: ['Zope']
:body type: text/x-rst
:body:
昨日アップロードした、ZPhotoSlidesの日本語化050306版はバグがあって正しく読み込めない。ということで、 `修正版`_ 。ごめんなさい。

.. _`修正版`: http://www.freia.jp/taka/wiki/ZPhotoSlides



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 158
:date: 2005-03-14 13:00:02
:title: サーバー機器一新
:categories: ['misc']
:body type: text/x-rst
:body:
自宅サーバーのHDDが二度と飛ばないように、 `3ware Serial ATA RAIDコントローラ  9500S-4LP`_ を購入。また、かねてより計画していたPentiumMサーバーも同時に購入。現在サーバー再構築中。

- M/B: `AOpen i855GMEm-LFS ver2`_
- CPU: PentiumM 730 (1.6G/533MHz)
- MEM: 1GB (SAMSUNG純正,IODATAバルク)
- HDD: MaXLine Plus II 7Y250M0 (250GB) ３つ
- RAID: `3ware Serial ATA RAIDコントローラ  9500S-4LP`_

とりあえずFreeBSD5.3じゃないと9500S-4LPを認識してくれない(ToT　あと、GbEのコネクションが切れるのはHUBとの相性か……？今週中に移行開始したいところだけど、難航してまふ。

.. _`3ware Serial ATA RAIDコントローラ  9500S-4LP`: http://www.ask-corp.co.jp/3ware/3w9500s-4lp.htm
.. _`AOpen i855GMEm-LFS ver2`: http://aopen.jp/products/mb/i855gmemlfs.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 159
:date: 2005-03-14 21:58:38
:title: FreeBSDのバックアップ
:categories: ['Unix']
:body type: text/x-rst
:body:
新しいサーバー機を組んだのでドライバの関係もありFreeBSD5.3-RELEASEを入れることにした。で、HDDストック 1_ の中からMaxtorの80GBを取り出してつないだところ、一代前のサーバー環境が入ってた。そういえばあとで必要なファイル取りだそうとか思ってたんだっけ‥‥。

ほかに手頃な空きDISKもないし、M/BのS-ATAでRAID1をやろうにもHDDを買う余裕はさすがにもうないので、環境をバックアップすることに。さてどうやってバックアップしよう？

1. cpでコピー
2. tar+gzipで圧縮
3. dump （‥‥してからどうするんだろう？）
4. dd + vnconfig 2_ で仮想DISK化
5. FreeBSD5のsnapshot

一番いいのは4なんだけど、ddはパーティションそのものをイメージ化するのでサイズがでかすぎる。20GBのパーティションを取っておくのに20GBの容量が必要‥‥。そこで！ddしたイメージを圧縮して、その圧縮イメージのままmdconfigしてmount出来れば！::

  # dd if=/dev/zero of=zerofile
  # rm zerofile
  # dd if=/dev/ad0s1e | gzip -9 > volume.img.gz
  # mdconfig -a -t vnode -f volume.img.gz -u 0
  # mount /dev/md0 /mnt

  Invalid super block!

‥‥とりあえず出来ませんでしたorz。同じようなことを「出来ないようだ」と結論づけてる人もいたけど、writableは難しいとしても、read-onlyなら出来そうな気がするんだけどなぁ‥‥。

しかたがないので、とりあえずtarで必要な部分だけ固めておくことにした 3_ ::

  # tar cfjpv - /etc | ssh user@backup.server.jp dd of=/backup/etc.tbz

tarを標準出力からsshに流し込んで相手先サーバーでddで受け取ってファイルに書き出す。今回いろいろバックアップ方法を調べて初めて知ったヨ。

.. [1] 二代前のサーバー環境でvinumなRAID5用に使っていた4台のうちの一つ。残りは「現行サーバー」「実験用環境」「とみたに里子」。

.. [2] FreeBSD5系ではmdconfigになっていた。

.. [3] /etcのほかに/usr/local, /var, /boot を保存。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 160
:date: 2005-03-14 22:06:58
:title: 武蔵小金井の「プーさん」は月木定休
:categories: ['food']
:body type: text/x-rst
:body:
東京のインドカレーナンバーワンに認定したい店、 `プーさん`_ 。仕事で中央線沿線にやってきたので帰りに武蔵小金井に寄ってみたら月曜は定休日だった‥‥。

**会社を出る前に見たサイトに書いてありますから！！**

チキンもポークもビーフも旨いが、何より素揚げの野菜が **旨い！** ぜひいちど行ってみてください。ちなみに標準でボリューム満点で、けっこう辛いデス。でも香辛料（≒漢方薬）のせいか胃にもたれません。

あぁ、食べたかったなぁ‥‥。残念。

.. _`プーさん`: http://gourmet.yahoo.co.jp/gourmet/restaurant/Kanto/Tokyo/guide/0203/WV-TOKYO-7RBDS001.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 161
:date: 2005-03-16 00:59:04
:title: FreeBSDでEnhanced SpeedStep
:categories: ['Unix']
:body type: text/x-rst
:body:
PentiumM730の動的なクロック変更に成功。

http://home.jp.freebsd.org/cgi-bin/showmail/FreeBSD-users-jp/83454



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 162
:date: 2005-03-16 14:28:02
:title: 新“PSX”『DESR-7700』『DESR-5700』 発表
:categories: ['misc']
:body type: text/x-rst
:body:
`新“PSX”『DESR-7700』『DESR-5700』 発表`_

生産終了したり、新しいの出したり、大変ですな。

とはいえ、PSPや映像のムーブに対応したのは良いですな。

でもそれよりもDESR-7500でD-VHSやSonyのCSチューナーを繋がるようにして下さい（少数意見だろうな……）。しかし、今回のもiLinkにD-VHSが繋がらないことが仕様一覧に書いてないって言うのはどうなのよ？

.. _`新“PSX”『DESR-7700』『DESR-5700』 発表`: http://www.jp.sonystyle.com/Style-e/Product/Psx/Desr-7700/index.html




:extend type: text/plain
:extend:


:trackbacks:
:trackback id: 2005-11-28.4825886520
:title: 新型PSXまもなく発売！
:blog name: 快適デジタル空間ショップ
:url: http://webcreate.blog6.fc2.com/blog-entry-3.html
:date: 2005-11-28 00:48:02
:body:
SONY PSX DESR-5700 4月15日発売大特価  52,800円 (税込55,440円) 送料別 SONY PSX DESR-7700 HDD搭載DVDレコーダー価格  69,800円 (税込73,290円) 送料込 今回発売される「DESR-7700」、「DESR-5700」では、新機能としてメモリースティックに対応しています。これによって、内蔵HDDに記...
%%%%%%%%%

:id: 163
:date: 2005-03-17 16:18:25
:title: エビフライ、たこ焼き、シュウマイ型のUSBメモリ
:categories: ['misc']
:body type: text/x-rst
:body:
`エビフライ、たこ焼き、シュウマイ型のUSBメモリ`_ が発売に。

シュウマイが地味にイイかも。

.. _`エビフライ、たこ焼き、シュウマイ型のUSBメモリ`: http://pc.watch.impress.co.jp/docs/2005/0317/solid.htm



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 164
:date: 2005-03-19 06:34:11
:title: 朝まで飲み会
:categories: ['misc']
:body type: text/x-rst
:body:
会社の同僚の送別会に参加。同僚は業務委託が今月いっぱいで終わるので委託会社に戻る。さらば。

その後、本人入れて２次会、本人抜きで３次会に参加。３次会が終わったのは朝５時だった‥‥。

で、今帰ってきたのでこれから寝る。３連休初日はいい感じだ。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4832270756
:title: Re: 朝まで飲み会
:author: コイ
:date: 2005-03-19 23:10:37
:email: 
:url: 
:body:
うあ。
朝までだったんですか。お疲れさまです。
ボクは21日ビッグサイトでLive。
22日は有給休暇で通院な予定調和です。
皆様に宜しく。m(_ _)m


:comments:
:comment id: 2005-11-28.4833426372
:title: Re: 朝まで飲み会
:author: 清水川
:date: 2005-03-20 11:17:33
:email: taka@freia.jp
:url: 
:body:
結局土曜日はほとんど寝てました。ぐー。
%%%%%%%%%

:id: 165
:date: 2005-03-20 11:16:48
:title: 福岡・佐賀で震度6弱
:categories: ['misc']
:body type: text/x-rst
:body:
さきほど(10:53)九州で地震があったらしい。最近大きめの地震が連発しているので「そろそろ関東か!?」とか思ってしまう。実家の母と電話で「あと2年以内に大規模な地震が関東で起きる」と言われて「毎年そんな話があるねー」なんて返していたのが冗談では済まなくなるかも？

とりあえず保険のチェックをやり直すか‥‥？



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4837315171
:title: Re: 福岡・佐賀で震度6弱
:author: とやま
:date: 2005-03-23 02:19:51
:email: 
:url: 
:body:
そのとき福岡の天神にいたですよ。
結婚式の打ち合わせで。

百貨店の５階にいたんだけど、マジで死を覚悟したよ・・・。


:comments:
:comment id: 2005-11-28.4838466942
:title: Re: 福岡・佐賀で震度6弱
:author: 清水川
:date: 2005-03-23 09:01:21
:email: taka@freia.jp
:url: 
:body:
> そのとき福岡の天神にいたですよ。

いぃタイミングだ……。
彼女の実家は被害なかったですか？
%%%%%%%%%

:id: 166
:date: 2005-03-20 12:17:53
:title: 第一回Zope3勉強会
:categories: ['Zope']
:body type: text/x-rst
:body:
`第一回Zope3勉強会`_ の開催が告知されたので、早速参加を申し込んだ。開催場所が曙橋なので、当日は `さぬきのうどんや`_ で昼ご飯を食べることに決定。

.. _`第一回Zope3勉強会`: http://www.zope.org/Members/yusei/zope3meeting
.. _`さぬきのうどんや`: http://ww2.et.tiki.ne.jp/~hatabou/s_sanuudo.html


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 167
:date: 2005-03-22 12:07:58
:title: iTunesのDRM技術を破る新アプリ「PyMusique」公開
:categories: ['misc', 'python']
:body type: text/x-rst
:body:
ん……？Py？

http://www.itmedia.co.jp/news/articles/0503/19/news013.html

結局の所、最後の最後には暗号をデコードしてユーザーに表示するわけだから、技術的には可能なわけで。最近では `GPUに出力するバスまで暗号化する方法` を検討してるらしいけど。

Pythonのように開発速度の高い言語が増えると、違法性の有無に関わらずソフトの開発障壁は下がってしまうんだなぁとちょっと思ったり。

追記


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 168
:date: 2005-03-23 00:07:19
:title: vpopmail with LDAP認証 by FreeBSD ports
:categories: ['Unix']
:body type: text/x-rst
:body:
vpopmailでldap認証を使うには::

  ./configure --enable-auth-module=ldap

する。（と README.ldap に書いてあった）

でもこのままmakeしても、-lresolv リンカオプションで引っかかるので、configure, configure.in から -lresolv を削除してみたところ、ビルドに成功したようだ。

あと、vpopmailでLDAPを使うためには、vldap.hにBaseDNやらLDAPアクセス用のパスワードやらを埋め込んでからビルドする必要がありそうなのでそれも入れる‥‥なんてことを毎回手動でやるのはタルイので、port/mail/vpopmail/files にパッチとして置いてみる。

最後に、MakefileをLDAP対応に書き換える‥‥いいやもうLDAPきめうちにしちゃえ。

- `vpopmail-5.4.6-port20050322.tgz`_ (patch-vldap.h書き換えてネver)

というかビルドしただけで全然動かしてもいないのに公開していいものなのか？とりあえず明日動作確認しよう‥‥。

.. _`vpopmail-5.4.6-port20050322.tgz`: file/vpopmail-5.4.6-port20050322.tgz


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 169
:date: 2005-03-23 12:48:47
:title: pythonでHTML解析
:categories: ['python', 'Programming']
:body type: text/x-rst
:body:
会社の同僚が

  「Webサイトに定期的にアクセスして内容を解析して○○××を自動的に実行するプログラムを作りたい。
  Perlで作ろうと思うんだけど……」

という話をしていたので、Pythonを勧めてみた。ついでにサンプルコードを作ってみた。

myparser.py::

    from HTMLParser import HTMLParser
    
    class MyHTMLParser(HTMLParser):
        def handle_data(self, data):
            data = data.strip(" 　\t\r\n")
            if data:
                print 'Data: "%s"' % data
    
        def handle_starttag(self, tag, attrs):
            pass
            #print 'TagStart: "%s"' % tag
    
        def handle_endtag(self, tag):
            pass
            #print 'TagEnd: "%s"' % tag
    
    def main(url):
        import urllib
        data = urllib.urlopen( url )
        mp = MyHTMLParser()
        mp.feed( data.read() )
    
    
    if __name__ == "__main__":
        import sys
        url = "http://python.jp/"
        if len( sys.argv ) > 1:
            url = sys.argv[1]
    
        main(url)

これを引数無しで実行すると、python.jpのページが取れてきて以下のように表示される::

    Data: "Click"
    Data: "here"
    Data: "to get to the FrontPage."

超適当に作った割にはちゃんと動いたなぁ。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4855949363
:title: Re: pythonでHTML解析
:author: uemura
:date: 2005-03-23 16:03:49
:email: makoto.uemura@gmail.com
:url: 
:body:
すみません、質問なのですが、

HTMLParserというかpythonで日本語を含むHPを解析しようと思うと
(たとえばunicode(data).encode("sjis")みたいな処理）
失敗するのですが、どのような処理をしたらいいのでしょうか？






:comments:
:comment id: 2005-11-28.4857113122
:title: Re: pythonでHTML解析
:author: 清水川
:date: 2005-03-24 00:03:46
:email: taka@freia.jp
:url: 
:body:
すみません、pythonプロじゃないので全然詳しくないのですが、unicode(data) ってエンコード判別してくれるんでしょうか？APIマニュアル見た感じだと判別してくれないような気が‥‥。

とりあえず、HTTPレスポンスでContent-Typeを返してくれるサーバーの場合は以下のようにしてエンコードを取得することは出来ました。

    import urllib
    data = urllib.urlopen( url )
    charset = data.headers.getparam('charset')

そして以下のようにして文字変換します。

    data = unicode(data,charset).encode("sjis")

サーバーがContent-Typeをくれない場合はmeta タグのContent-Typeを見るとか、でしょうか‥‥？それもだめなら自動判別‥‥って、どうやるんだろう？



:comments:
:comment id: 2005-11-28.4858298371
:title: Re: pythonでHTML解析
:author: uemura
:date: 2005-03-24 11:28:30
:email: makoto.uemura@gmail.com
:url: 
:body:
ありがとうございます。
自動判別は難しそうですね。

こんな感じで
    import urllib
    data = urllib.urlopen( url )
    charset = data.headers.getparam('charset')
    print charset
        charset = "sjis"  #本来ならここに自動判別のプログラムを入れる。
    mp = MyHTMLParser()
    mp.feed(unicode(data.read(),charset).encode("sjis") )

ある程度のものは読めるようになりました。

RSS,AtomのParserであるuniversal feed parser モジュールはこの辺もしっかりやってるんだろうなとソースを読んでみようかと思ったら発狂しそうになりました。

もうちょっといろいろ調べてみようかと思います。


:comments:
:comment id: 2005-11-28.4859453562
:title: Re: pythonでHTML解析
:author: uemura
:date: 2005-03-24 14:24:29
:email: makoto.uemura@gmail.com
:url: 
:body:
なんどもすみません

    import urllib
    import pykf
    cod = ("UNKNOWN","ASCLL","SJIS","EUC-JP","JIS","utf-8","UTF-16-LE","UTF-16-BE","ERROR")
    data = urllib.urlopen( url )
    urlstring = data.read()
    mp = MyHTMLParser()
    charset = cod[pykf.guess(urlstring)]
    data = urllib.urlopen( url )
    mp.feed(unicode(urlstring,charset).encode("sjis") )

PyKfモジュールで判定はできましたけど、
windowsでutf-8をSJISに変換するときにエラーが出るときがあります。

難しいですね。


:comments:
:comment id: 2005-11-28.4860618397
:title: Re: pythonでHTML解析
:author: 清水川
:date: 2005-03-24 22:42:26
:email: taka@freia.jp
:url: 
:body:
> PyKfモジュールで判定はできましたけど、

おお！すばらしい！！参考にさせていただきます。
とはいえ、自動判別については、既存のブラウザでも完璧なのは無いですし、うまくいかなくてもしょうがない部分はありますね。

> windowsでutf-8をSJISに変換するときにエラーが出るときがあります。

SJISに無い文字が混ざっているとか？（あてずっぽう）



:comments:
:comment id: 2005-11-28.4861761649
:title: Re: pythonでHTML解析
:author: i?
:date: 2005-03-25 09:38:27
:email: 
:url: 
:body:
ここの 683に、いくつかのencodingで変換試して
UnicodeExceptionの場合ハズレ、という方法が。



:comments:
:comment id: 2005-11-28.4862902542
:title: Re: pythonでHTML解析
:author: 清水川
:date: 2005-03-25 23:21:51
:email: taka@freia.jp
:url: 
:body:
> ここの 683に

それはよい方法だね！
実際の所、pykfが無い環境で近似的にやるにはリーズナブルだなぁ。（pykf, 中で同じ方法でチェックしてたりして‥‥）


:comments:
:comment id: 2007-02-25.7602364260
:title: Re:pythonでHTML解析
:author: nagaetty
:date: 2007-02-25 23:12:42
:email: 
:url: http://www6.atwiki.jp/nagae_tatsua/pages/1.html
:body:
python勉強中のものです。大変参考になるソースをありがとうございます。
pykfのあるページが参照できなくなっているので、
http://www.python.jp/Zope/download/pythonjpdist
のWindowsインストーラを入手して、自分のページを参照してみました。



:comments:
:comment id: 2007-02-25.4961561563
:title: Re:pythonでHTML解析
:author: しみずかわ
:date: 2007-02-25 23:24:56
:email: 
:url: 
:body:
各所で出てますが、webarchiveから入手できますよ～

http://web.archive.org/web/20060206123300/http://gembook.jp/tsum/page.pys?wiki=PyKf

あと、HTML解析については、PythonWorkshopで紹介されたBeautiful Soupが良いかもしれません。良い感じで手を抜けそうです。

http://www.python.jp/Zope/workshop/200612/index_html?pp=1

:trackbacks:
:trackback id: 2005-11-28.4864045021
:title: Ploneの使い方
:blog name: PukiWiki/TrackBack 0.1
:url: http://tokyo.atso-net.jp/sitedev/index.php?Plone%A4%CE%BB%C8%A4%A4%CA%FD
:date: 2005-11-28 00:48:06
:body:
%%%%%%%%%

:id: 170
:date: 2005-03-23 23:55:26
:title: 東京ドーム紅虎餃子
:categories: ['food', 'work']
:body type: text/x-rst
:body:
今日は早めに会社を出て武蔵小金井のプーさんに行くつもりだった。が、予定外の打ち合わせが長引きとても間に合わない時間に‥‥。まぁお仕事ですから。

で、目標を変更して久々に東京ドームの紅虎餃子に行った。

お気に入りは‥‥

- ぷりぷり海老春巻き
- トンポーロー
- 酢豚（下写真）

|benitora_subuta|

:清水川: パッと見、豚と山芋と里芋の見分けがつかないのがイイですよね
:同僚K: 俺は酢豚好きだけど、これを酢豚とは認めない。
:同僚H: ちゃうやろ、これ
:清水川: うまー

.. |benitora_subuta| image:: images/benitora_subuta



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 171
:date: 2005-03-24 01:22:53
:title: vpopmail with LDAP認証 by FreeBSD ports (第2回)
:categories: ['Unix']
:body type: text/x-rst
:body:
`第1回`_ に引き続き、vpopmail-ldapの設定を行う。

README.ldap を読み進めたところ、昨日改造したvldap.hに埋め込まれているDNで重要になるポイントは

1. vpopmail から LDAP へアクセスする際の認証アカウント
2. vpopmail から LDAP へアクセスする際の認証パスワード
3. バーチャルドメインを格納するBaseディレクトリ

の3つだった。ということは、1,2については既存のManagerアカウントを指定することにして、3だけを（実験なので深く考えずに）専用ディレクトリとして用意する。デフォルトでは o=vpopmail なのだが、既存のマイLDAP構成に合わせて以下のように変更して、vpopmailのビルド＆インストールをやり直した。

patch-vldap.hの記述変更点::

  #define VLDAP_BASEDN "o=vpopmail,dc=example,dc=jp"

slapd.conf に以下の記述を追加::

  include         /usr/local/etc/openldap/schema/qmailUser.schema
  schemacheck off

vpopmail-5.4.6/ldap/vpopmail.ldif を patch-vldap.h に合わせて修正::

  dn: o=vpopmail,dc=example,dc=com
  objectClass: Organization
  o: vpopmail

LDAPに上記のvpopmail.ldifを食わせる::

  host# ldapadd -f vpopmail.ldif -D 'cn=Manager,dc=example,dc=com' -W

ここまで成功したら、最後にバーチャルドメインを作成してみる::

  /usr/local/vpopmail/bin/vadddomain host.example.com postmasterpassword

うまくいっていれば、postmasterアカウントが作成されているはず::

  host# ldapsearch -LLL -b 'o=vpopmail,dc=example,dc=jp'

  dn: o=vpopmail,dc=example,dc=jp
  objectClass: organization
  o: vpopmail
  
  dn: ou=host.example.jp,o=vpopmail,dc=example,dc=jp
  ou: host.example.jp
  objectClass: organizationalUnit
  
  dn: uid=postmaster,ou=host.example.jp,o=vpopmail,dc=example,dc=jp
  uid: postmaster
  qmailUID: 1
  qmailGID: 0
  qmaildomain: Postmaster
  mailMessageStore: /usr/local/vpopmail/domains/host.example.jp/postmaster
  mailQuota: NOQUOTA
  objectClass: qmailUser


どうやらここまでは成功したみたいなので、次はメールの送受信を確認してみようと思う。

ところで、LDAP上に追加されたアカウント情報を既存のアカウントとどうやって一元管理すればいいのかわからない。ショートカットみたいにして、別のディレクトリにあるuidを参照するような機構ってLDAPにあるのかな‥‥。読みかけで放置してるLDAP本もうすこしちゃんとよまないといかんなぁ。



.. _`第1回`: http://www.freia.jp/taka/blog/168




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 172
:date: 2005-03-24 22:37:43
:title: vpopmail with LDAP認証 by FreeBSD ports (中休み)
:categories: ['Unix']
:body type: text/x-rst
:body:
`オープンソースによるLDAPアカウント対応メールサーバの構築`_

同じようなことをやろうとしている人を発見！

.. _`オープンソースによるLDAPアカウント対応メールサーバの構築`: http://www.ipc.yamanashi.ac.jp/bul/final03/sasamori/index.html



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 173
:date: 2005-03-25 22:33:49
:title: プーさん再び
:categories: ['food']
:body type: text/x-rst
:body:
大学からの親友とやまに誘われて‥‥ってすごく説明っぽい書き出しだなー。まーとにかく今週もまた武蔵小金井の `プーさん`_ に行ってきた。

▼ 野菜ホタテカレー `(写真)`_

|野菜カレー|

うまいわー！うまいわー！都内インドカレーライスオススメ１位ー！

▼ 食後の自家製アイスクリームも絶品。

|アイスクリーム|

実は `先週月曜に定休日に行ってしまい`_ 悲しい思いをしたが、翌日も足を運んでいたりする。でもblogは月曜に定休日だったことしか書かなかったので、それを見たとやまから「ひさしぶりに行かない？」と声がかかった訳だ。いやー、すまんかった＞とやま。

.. _`プーさん`: http://gourmet.yahoo.co.jp/gourmet/restaurant/Kanto/Tokyo/guide/0203/WV-TOKYO-7RBDS001.html

.. _`(写真)`: http://www.freia.jp/taka/photo/foods/pooh

.. |野菜カレー| image:: http://www.freia.jp/taka/photo/foods/pooh/PICT0001.JPG?size=thumb

.. |アイスクリーム| image:: http://www.freia.jp/taka/photo/foods/pooh/PICT0011.JPG?size=thumb

.. _`先週月曜に定休日に行ってしまい`: http://www.freia.jp/taka/blog/160



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 174
:date: 2005-03-27 16:29:18
:title: オープンソースカンファレンス2005春
:categories: ['Event', 'Plone']
:body type: text/x-rst
:body:
`OSC2005`_ に参加しました。

今回写真もメモも全くとらなかったので、参加レポートと言うよりは事後メモという感じで。

.. _`OSC2005`: http://www.ospn.jp/osc2005/


Plone 導入ガイド (26日 13:00)
------------------------------
http://www.ospn.jp/osc2005/modules/eguide/event.php?eid=23

佐久間さんの一人芝居がおもしろかったデス。自分は導入済みなので、導入手順そのものはわかっていたけど、ほかの聴講者のみんなはどのくらいの段階にいたんだろう？何も知らないけど来てみた、っていう人はほとんどいなかったんだとは思うけど‥‥。

`ZopeWeekend5`_ の懇親会でも話題になったことだけど、ターゲットをどこに絞るか、というのは結構難しい問題かもしれない。入門向けと上級者向けに２トラック平行で出来れば良いんだろうけど準備が大変そうだ。

このセッションでの収穫(1)
~~~~~~~~~~~~~~~~~~~~~~~~~~~
- `PloneLocalFS`_ 
- `Plone S5`_ (Opera7.5xではうまく表示できず)
- Ploneのワークフローに条件スクリプトを仕込む

.. _`ZopeWeekend5`: http://zope.jp/misc/zopeweekend5
.. _`PloneLocalFS`: http://zopewiki.org/PloneLocalFS
.. _`Plone S5`: http://takanory.net/plone/products/plones5


Plone のかゆいところに手が届く (26日 14:00)
---------------------------------------------
http://www.ospn.jp/osc2005/modules/eguide/event.php?eid=24

かゆいところに手が届いた！‥‥メモ取ってなかったので紹介されたプロダクト名が‥‥ orz。

UMLからArcheTypesを生成するのはすごく勉強になった。うーん、今直接コード書いてるのがだんだん馬鹿らしくなってきたよ？とりあえず仕組みの勉強ということで続けるけど。

このセッションでの収穫(2)
~~~~~~~~~~~~~~~~~~~~~~~~~~~
- `AlgoUMLで作ったUMLからArcheTypesのコードを生成`_
- ほか多数（忘れちゃったら収穫にならない...）

.. _`AlgoUMLで作ったUMLからArcheTypesのコードを生成`: http://takanory.net/plone/archetypes/archgenxml


Windows ユーザのためのSambaの使い方 (26日 15:00)
---------------------------------------------------
http://www.ospn.jp/osc2005/modules/eguide/event.php?eid=21

Zopeの隣の部屋でやっていたSambaでACLを使うための講義を聴いた。今会社のファイルサーバーをWindows2000からSambaに置き換えようとしているが、情報が足りない！ということで密かに本日の必須セッションだったりする。

プレゼン資料は後日 `Samba-JPのサイト`_ に掲載されるらしい。

このセッションでの収穫(3)
~~~~~~~~~~~~~~~~~~~~~~~~~~~
- 太田さんに会えた！
- FileSystem毎に異なるACLエントリ数に注意が必要
  :JFS: 2048 ( `8000以上?`_ )
  :EXT2,3: 32
  :XFS: 25
  - FreeBSDのUFS2は何個だろう？

- WindowsとUnixの相容れないアクセスコントロールの概念について


.. _`Samba-JPのサイト`: http://www.samba.gr.jp/
.. _`8000以上?`: http://www.vanemery.com/Linux/ACL/linux-acl.html


懇親会０次会 (26日 17:30)
---------------------------
OSC2005の閉会から懇親会までの間に２時間あったので、JZUGイベントWGのみなさんに混ざって０次会へ。最初はあまり飲み食いしないようにしようとしていたけど、jackさんの「懇親会（１次会）は予約数の倍の人数が参加するらしいから食べるもの無いよ！？」の一言で飲み食いモードへ（笑）。

結局18:50頃になってから懇親会会場へ。


懇親会１次会 (26日 19:00)
--------------------------
人多すぎ！食べ物入手出来ず！

歌舞伎町の `刀削麺菜館`_ に200人以上参加。ちなみに椅子は100くらいだった。Zope/Ploneメンバーは会場の隅っこの方で用途不明のカラーボックスを占領し、Zope/Plone島としてみたり。南鳥島の方が面積あるかも。

主催のびぎねっとの方やRubyの方、日本OOoの方などとお話しすることが出来ました。うわー、みんなすごい熱意としっかりしたビジョン持ってるなぁ‥‥。


.. _`刀削麺菜館`: http://www.gcon.jp/h/61736/?url=w02


懇親会２次会 (26日 21:00)
--------------------------
歌舞伎町の `異邦人`_ の個室。作りのおもしろい店だったけど、微妙に狭かった。YahooBBの無線LANアクセスポイントが解放されていたのは良かった。使わなかったかけど。

Python/Ruby, Python/Zope/Plone, Unicode, Zope3, JZUGの運営等々についての話が出ました（"/"は and, or, vs 等色々）。詳しくは書きません（レポートする物でもないしね）。

.. _`異邦人`: http://r.gnavi.co.jp/a073500/


翌日 (27日 15:00)
------------------
JZUGのイベントワーキングのお手伝いに参加しようとおもい、MLへ投稿してみた。現在投稿承認待ち。

前回の `ZopeWeekend5`_ の後もどうしようかと考えたけど、年度末に向けて忙しいのが分かっていたので‥‥とか言ってたらいつまでも何もしなさそうだったので、参加表明。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 175
:date: 2005-03-27 16:42:21
:title: STARTREK VOYAGER DVDBOX5
:categories: ['misc']
:body type: text/x-rst
:body:
`ボイジャーのDVDBOX`_ を買った（木曜日）。また毎日１時間ずつを鑑賞に宛てる日々が続く予感。

数少ない、非コンピューター系娯楽の一つ。なんだけど、結局屋内というあたりには問題あるのかも。

.. _`ボイジャーのDVDBOX`: http://www.usskyushu.com/etc/voy_dvd5.html



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4889404498
:title: Re: STARTREK VOYAGER DVDBOX5
:author: おぐらじお
:date: 2005-04-01 22:27:43
:email: dj@oguradio.com
:url: http://www.oguradio.com/
:body:
リンクを見てみました。
ボーグが出てくるんですね。
僕はTNGしか知らないのですが、映画でボーグは全滅したと思っていたら、テレビシリーズではその後のシリーズでも残っているんですね。



:comments:
:comment id: 2005-11-28.4890551512
:title: Re: STARTREK VOYAGER DVDBOX5
:author: 清水川
:date: 2005-04-01 23:13:03
:email: taka@freia.jp
:url: 
:body:
ボーク出てきます(^^
TNGの次のDS9でもちょろっと出てきますが、VGRではこれでもかとわんさか出てきます。


:comments:
:comment id: 2005-11-28.4891695057
:title: Re: STARTREK VOYAGER DVDBOX5
:author: おぐらじお
:date: 2005-04-03 14:22:54
:email: dj@oguradio.com
:url: http://www.oguradio.com/
:body:
僕はシンセに興味があるのですが、コルグが出したOASYSというシンセのデモ動画で、TNGのテーマが演奏されています。
の
の21分15秒くらいのところからです。
演奏者がすごくうまいので、2回観てしまいました。
DS9やボイジャーのテーマ曲はTNGのと違うのでしょうか。
%%%%%%%%%

:id: 176
:date: 2005-03-29 22:36:21
:title: YetiSportsおもしろすぎ
:categories: ['Game']
:body type: text/x-rst
:body:
http://cabin.jp/yuukan/1-game-simple15.html

YetiSportsおもしろすぎ！ 刺さる！

４は1000m近くまでは行けた。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 177
:date: 2005-03-29 23:13:43
:title: ダイアログからコピペ
:categories: ['misc']
:body type: text/x-rst
:body:
- `ダイアログからコピペ`_

しらなかった‥‥。

ほんとだ‥‥。

.. _`ダイアログからコピペ`: http://akiyah.bglb.jp/blog/628



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 178
:date: 2005-03-30 21:47:47
:title: 休養
:categories: ['work']
:body type: text/x-rst
:body:
先週から背中がギシギシ言ったり唇がバリバリになったりと体調が思わしくない状態が続いていたが、今日はついに会社を休んで休養することにした。あんまり暇な状況ではないので同僚には迷惑をかけてしまった‥‥。反省。

それにしても、あんまり風邪っぽくないのは‥‥過労？歳のせい？


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 179
:date: 2005-03-31 22:03:05
:title: 桜
:categories: ['misc']
:body type: text/x-rst
:body:
`にくしぃ`_ に桜が咲いた。

.. _`にくしぃ`: http://nixi.jp/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 180
:date: 2005-04-01 22:36:34
:title: Re: DTMLファイルの中身を表示する
:categories: ['Zope']
:body type: text/x-rst
:body:
[CD]CoffeeDiaryより

  `DTMLファイルの中身を表示する`_

おもしろい命題なので、獲得を使ってZopeっぽく作ってみる。

sourceという名前のScript(Python)::

  print '<pre>'
  print str(context)
  print '</pre>'
  return printed

これをルートディレクトリ等に作る。
実際に表示させるには::

  http://hoge.jp/foo/bar/index_html/source

という感じでアクセスする。（ 実例__ ）

.. __: http://www.freia.jp/taka/test/view_source/index_html/source

.. _`DTMLファイルの中身を表示する`: http://akiyah.bglb.jp/blog/642



:extend type: text/plain
:extend:


:trackbacks:
:trackback id: 2005-11-28.4906685706
:title: DTMLの中身表示は簡単だった
:blog name: [CD]CoffeeDiary
:url: http://akiyah.bglb.jp/blog/654
:date: 2005-11-28 00:48:10
:body:
『DTMLファイルの中身を表示する』に対して
清水川さんのところで獲得を使ったZopeらしい方法が紹介されていました。
なるほど。
ルートとかで作れば獲得で下のほうのフォルダからも使えるのですね。
さらに、この方法だとURLで指定してソースを見ることが出来るのですね。
勉強になります。
こちらではまた別の方法を見つけてしまいました。
たとえばfooという名前の DTML Method があったら、
と『"』で囲ってあげるだけでソースが見られるのでした!
なーんだ。
というか、逆に『"』で囲っちゃ...
%%%%%%%%%

:id: 181
:date: 2005-04-02 23:22:37
:title: ZPhotoSlidesのサイトが消えたっ！？
:categories: ['Zope']
:body type: text/x-rst
:body:
ZPhotoSlides_ のサイトが消えてしまったみたい。とりあえず WebArchive_ で名残を惜しんでみる。

って、惜しんでる場合でなくて。

良いプロダクトだし、せっかく日本語訳作ってるのに消滅しちゃったらかなり悲しいので、早期の復活を願う。

# ちなみにアーカイブは SourceForge_ に。

.. _ZPhotoSlides: http://www.zphotoslides.org/
.. _WebArchive: http://web.archive.org/web/20040201224330/www.zphotoslides.org/news/
.. _SourceForge: http://sourceforge.net/project/showfiles.php?group_id=68884



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 182
:date: 2005-04-05 22:02:23
:title: WZ
:categories: ['WZ']
:body type: text/x-rst
:body:
`WZが悪いんじゃない！Villagecenterが悪いんだ！`__

.. __: http://www.villagecenter.co.jp/cgi-bin/wzold.cgi?L=146&X=1



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 183
:date: 2005-04-11 23:48:07
:title: ZPhotoSlidesサイト復活
:categories: ['Zope', 'misc']
:body type: text/x-rst
:body:
ZPhotoSlides_ が復活。よかったよかった。

.. _ZPhotoSlides: http://www.zphotoslides.org/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 184
:date: 2005-04-11 23:59:58
:title: Zope3勉強会参加メモ
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope3勉強会に参加。（土曜日）

- `メモ`_

.. _`メモ`: http://www.freia.jp/taka/file/Zope3Study1.pdf


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 185
:date: 2005-04-12 00:04:57
:title: JZUGミーティング初参加
:categories: ['Zope']
:body type: text/x-rst
:body:
`JZUG`_ のミーティングで、 `びぎねっと`_ さんにおじゃましてきました。

いいなぁ。宮原さんいいなぁ。

.. _`JZUG`: http://zope.jp/
.. _`びぎねっと`: http://www.begi.net/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 186
:date: 2005-04-13 00:05:47
:title: 大阪出張、泊まり part 2
:categories: ['work']
:body type: text/x-rst
:body:
また大阪で一泊。今回は前回みたいに

- 深夜0時過ぎに道に迷って１時間彷徨ったり
- そもそもホテルが訪問先から遠かったり

なんてことはない。が……

- 大阪に来て韓国焼き肉

というあたり、食魔人としては悔いが残る。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 187
:date: 2005-04-18 00:13:45
:title: サーバー移行、失敗
:categories: ['Zope']
:body type: text/x-rst
:body:
以前サーバーのマザーボードが壊れてから臨時に１代前のメインPCをサーバーにしていたが、臨時だったためDISKの冗長性とか全然無いまま半年ほど運用していた。で、先日やっと新サーバーを用意して、いろいろと移行の事前テストやら冗長性のテストやらを行って今日やっと移行まで行うことが出来た。

が。なぜか実験時には問題なかったZopeの移行がうまくいかない。Ploneサイトを表示しようとするとAnonymousで許可しているページにもかかわらずエラーになってしまう。

エラー時のログ(抜粋)::

  <FSPageTemplate at /taka/login_form>
  Module Products.PageTemplates.TALES, line 221, in evaluate
  Line 131, Column 4
  Expression: <PythonExpr member.getProperty('formtooltips', showdefault)>

  Unauthorized: Your user account does not have the required permission. 
  Access to 'getProperty' of Anonymous User denied. Your user account, 
  Anonymous User, exists at /acl_users. Access requires 
  View_management_screens_Permission, granted to the following roles: 
  ['Manager']. Your roles in this context are ['Anonymous']. (Also, an 
  error occurred while attempting to render the standard error message.)

うーん、Manager権限が必要なのにAnonymousでアクセスしようとしている、、と言われてもなぁ。とりあえずZopeだけ旧サーバーに戻した。原因解析は明日だなぁ‥‥。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4927198623
:title: Re: サーバー移行、失敗
:author: 清水川
:date: 2005-04-18 00:14:50
:email: taka@freia.jp
:url: 
:body:
今日は曇り。今日は曇り。
%%%%%%%%%

:id: 188
:date: 2005-04-19 01:01:59
:title: サーバー移行、成功
:categories: ['Zope']
:body type: text/x-rst
:body:
昨日の問題は::

  member.getProperty('formtooltips', showdefault)

でProductsフォルダを検索してみたところ、plone_template/header というファイルが引っかかったので、該当箇所を削除することで対処した。実際のところ、削除しちゃって良いのかというと::

  <!-- Old JS from Plone 1.0, remove tal:condition="nothing" if you need to use the old pop-ups.
  Will be removed in Plone 2.1 -->

と書いてあったので問題ないんだろう。多分。

:今日の反省: 問題箇所へのアプローチ方法はそんなに間違ってないと思うんだけど、解決方法に間違いがある、というかよく分からないけど解消したあたりに問題がありそうな。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 189
:date: 2005-04-20 23:03:45
:title: サーバー完全移行（多分）
:categories: ['Unix']
:body type: text/x-rst
:body:
FreeBSDベースの自宅サーバーを新サーバーに完全移行しました（24時間くらい前）。

「やった！これで旧サーバーをシャットダウン出来るゾ！レッツshutdown -p now」

とかやったところ、新サーバーへのSSHログインが出来ず、コンソールからのログインも出来ず‥‥。あわてて旧サーバーを起動しようとしたら電源すら入らない。どうやら電源BOXが不調らしく、 **よく完全移行が完了する今日この瞬間まで動いていたものだと** 感心しました（苦笑）。

タイムアウトしつつ何とかコンソールからログオンして調べたところ、どうやらresolv.confが旧サーバーを見ていたらしく、サクッと修正して事なきを得ました。

ということで、新サーバーは（今日帰ってきたらdhcpdが死んでいたモノの）快調に動作しています。

*#どーやら、ですます調の方が書きやすいらしい＜俺*



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 190
:date: 2005-04-20 23:33:24
:title: 会社の歓迎会
:categories: ['Zope', 'work']
:body type: text/x-rst
:body:
会社の歓迎会で「清水川さんってblog書いてますよね。会社名で色々情報集めてる時に見ました」とか言われてかなりびっくり。そういえば昔（２年くらい前？）は社名出してたなー、とか思ったり。

で、どのくらい検索で引っかかるのかと思ってgoogleで調べたところ、あんまり引っかからない。キーワードを色々変えてみたらやっと１件引っかかった、という程度でちょっと安心。

ところが、googleのリンク先がPloneに移行する前のURLだったため、リンク先に飛んでも昔の日記にアクセス出来ないことが判明。つまり::

  http://www.freia.jp/taka/diary/2004_03

というアドレスにアクセスしても、今上記のURLのコンテンツは::

  http://www.freia.jp/taka/taka_old/diary/2004_03

に移動してしまっているわけ。そこで、http://www.freia.jp/taka/ の位置に diary という名前の *Script(Python)* を作成して、スクリプトの中身を以下のように記述::

  request = container.REQUEST
  RESPONSE =  request.RESPONSE
  
  url = request.VIRTUAL_URL_PARTS[1]
  new_url = '/taka/taka_old/' + '/'.join( url.split('/')[1:] )
  
  RESPONSE.redirect( new_url )

これで旧URLでアクセスした人も新URLへ誘導出来る、という寸法。urlparseモジュールを使う方法もあるかも、と思いつつ使い慣れた方で書いてしまいました。（他にも正規置換とか決め打ち置換とか出来そうだけど）

*#しかし、C言語では書きたくないなー...*

*#というか会社名で検索した人向けに正しいURLに誘導するなよ＜俺*



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 191
:date: 2005-04-21 00:25:30
:title: Zope3勉強会 & ZopeEssentials
:categories: ['Zope']
:body type: text/x-rst
:body:
`Zope3勉強会`_ 、2回目も参加します。

今回は5/8開催ですが、5/10に ZopeEssentials_ があったり、5/6は出勤だったりと、GW最後の方はいろいろとありそうな予感。

.. _`Zope3勉強会`: http://www.zope.org/Members/yusei/zope3meeting/2
.. _ZopeEssentials: http://new.zope.jp/event/zopeessentials/1/



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4939629555
:title: Re: Zope3勉強会 & ZopeEssentials
:author: JJ
:date: 2005-05-01 22:45:32
:email: 
:url: http://forestlaw.zive.net/
:body:
はじめまして、Zope 関連ブログなどよく参考にさせていただいています。

ところで、タイトルのアンパサンドが RSS でサニタイジングされていないため RSS Reader で XML パーサーエラーになってしまいます。

rdf10_xml, rdf91_xml で 　→　のようにしていただけると助かります。






:comments:
:comment id: 2005-11-28.4940799019
:title: Re: Zope3勉強会 & ZopeEssentials
:author: JJ
:date: 2005-05-01 22:49:16
:email: 
:url: http://forestlaw.zive.net/
:body:
↑肝心なところが消えてしまいました。

dtml-var title → dtml-var title html_quote のような修正をしていただけると助かります。

汚してしまって、すいません。



:comments:
:comment id: 2005-11-28.4941957387
:title: Re: Zope3勉強会 & ZopeEssentials
:author: 清水川
:date: 2005-05-02 19:22:04
:email: taka@freia.jp
:url: 
:body:
情報ありがとうございます。修正してみました。
%%%%%%%%%

:id: 192
:date: 2005-04-26 08:55:28
:title: COREBlog1.2+Plonified0.8
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
`COREBlog 1.2a1`_ がML限定公開されました。同時にCOREBlogをPloneと融合して表示するためのSkin, Plonified0.8 が公開されています。

ということで、早速 `実験してみました`_ 。Plone対応という事でCOREBlogオブジェクトのプロパティーが変更になっているため、Plonifiedを使う場合は一度SkinをPlonifiedに切り替えるか、skin/plonified/skin_propertiesを実行する必要があります。また、これまでPloneインスタンス以下にCOREBlogをおいた場合に `ちょっとした問題`_ があったのですが、それも修正されていました。

ということで、まだちょっとしか触っていませんが、大体問題なく動作するようです。一部、COREBlogがCMF対応プロダクトではないために、ナビゲーションやパンくず表示がおかしくなるようですが、分かる部分についてはSkin(ZPT)をいじりながら修正してみようと思います。

とりあえずは、 `旧日記`_ っぽい表示にしてみようかな。あと、refererやZWeatherも表示追加しないと。


.. _`COREBlog 1.2a1`: http://coreblog.org/ats/637
.. _`実験してみました`: http://www.freia.jp/taka/blog/skin/plonified
.. _`ちょっとした問題`: http://www.freia.jp/taka/blog/139
.. _`旧日記`: http://www.freia.jp/taka/taka_old/diary/




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4946007441
:title: Re: COREBlog1.2+Plonified0.8
:author: naka-z
:date: 2005-04-26 23:08:34
:email: 
:url: 
:body:
これやばいっすね！。さっきメールチェックしてて存在しりました
今出張中なので戻ったら早速導入しようと思ってます。

P.S.　コメント入力時は普通の画面になるんですね


:comments:
:comment id: 2005-11-28.4947155159
:title: Re: COREBlog1.2+Plonified0.8
:author: 清水川
:date: 2005-04-27 23:30:00
:email: taka@freia.jp
:url: 
:body:
コメント入力時に以前のスタイルになってしまうのは、URLを見ると分かるのですが、skin/plonified で表示しなくなるからですね。これはCOREBlogに設定したblog_urlがコメント入力等のリンク先に使用されるためだとおもいます。

それにしても、プロダクトをCMF対応しなくてもこういうことが出来る、というのは勉強になりますねー。
%%%%%%%%%

:id: 193
:date: 2005-04-26 09:03:00
:title: 手首が痛い
:categories: ['misc']
:body type: text/x-rst
:body:
昨日深夜、Ploneのスタイルをいじったり ZopeEssentials_ の原稿を書いたりしていたとき、右手首に「ちょっとひねったかな？」という感じの痛みを感じた。それがだんだん強い痛みになってきて、今は手首がムチウチになったみたいな感じです。ムチウチなったことないけど。

とりあえずキーボードを打つには支障がないけど、、、仕事というかキーボード打ちすぎ症？あ、いかん仕事が始まる(^^

.. _ZopeEssentials: http://new.zope.jp/event/zopeessentials/1/





:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4951100354
:title: Re: 手首が痛い
:author: aihatena
:date: 2005-04-26 10:26:47
:email: 
:url: 
:body:
そこで A-Typeキーボードですよ


:comments:
:comment id: 2005-11-28.4952224266
:title: Re: 手首が痛い
:author: 清水川
:date: 2005-04-26 10:49:43
:email: taka@freia.jp
:url: 
:body:
そこでiFrogですよ。




:comments:
:comment id: 2005-11-28.4953347190
:title: Re: 手首が痛い
:author: aihatena
:date: 2005-04-26 14:08:12
:email: 
:url: 
:body:
猫を手枕したとき用によいかも >iFrog
スクリーンキーボードでは効率悪すぎなので。
%%%%%%%%%

:id: 194
:date: 2005-04-26 20:53:16
:title: そして大阪出張
:categories: ['work']
:body type: text/x-rst
:body:
また大阪に行ってきます。前日の定時以降に決定するんだもんなぁ。

このままGWに突入したり、GW中も大阪で仕事してたりしたらやだなぁ。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4957205019
:title: Re: そして大阪出張
:author: M.Shibata
:date: 2005-04-27 01:09:44
:email: 
:url: http://www.emptypage.jp
:body:
こんにちは。

梅田の「はがくれ」は行かれたことあります？

お昼どきはいつも人が店からあふれるほど並んでいるので入るのがたいへんなのですが、おいしいです。今月は僕も大阪に出張があったのですが、時間がなかったのでその日は断念したのでした。

もしまだでしたら一度ぜひ（有名みたいなので、もしご存知だったらすみませんです）。


:comments:
:comment id: 2005-11-28.4958370148
:title: Re: そして大阪出張
:author: 清水川
:date: 2005-04-28 00:10:10
:email: taka@freia.jp
:url: 
:body:
行ってきました！うまかったデス！

ということで、レポート書きましたのでお納めください(^^


%%%%%%%%%

:id: 195
:date: 2005-04-27 02:01:20
:title: CableModemのリンクが切れる
:categories: ['misc']
:body type: text/x-rst
:body:
深夜、とつぜんインターネットに繋がらなくなった。原因はケーブルモデムのアップリンクが切れたためらしい。とりあえずケーブルモデムの電源を入れ直して5分ほど待ってみたものの、アップリンクの状態を示すランプが「接続試行中」を示すゆっくりとした明滅を繰り返すばかりで繋がる気配はない。

とりあえず放置以外に出来ることは無い。朝には復活してることを期待しつつ寝る。明日は大阪だ。




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4962262392
:title: Re: CableModemのリンクが切れる
:author: 清水川
:date: 2005-04-27 08:55:15
:email: taka@freia.jp
:url: 
:body:
復活してた。というかメンテのための計画切断だったらしい。

JCOMメールを定期的に受信してなかったのは自分が悪かったけど、JCOM内からしかメンテナンス情報等にアクセス出来ないというのはどうなの？

%%%%%%%%%

:id: 196
:date: 2005-04-28 00:06:45
:title: 大阪出張の収穫（うどん）
:categories: ['food']
:body type: text/x-rst
:body:
`M.Shibataさんに教えてもらった`_ うどん屋さん、 `梅田はがくれ`_ に行ってきました。

**「うどんは鮮度。」**

その言葉の通り、生きたうどんを堪能出来ました。情報感謝！

▼ かまたま `(Album)`_

|かまたま|

▼ ぶっかけ `(Album)`_

|ぶっかけ|

▼ 生じょうゆ `(Album)`_

|生じょうゆ|


しかしこのお店、おっちゃんの喋りがおもしろすぎ。

:親父: 「兄ちゃん、出来たで。箸で２本だけすくって上まで引っ張り上げるんや」
:自分: 「２本？」
:親父: 「あたりまえやがな！うどん食うときは２本、常識やがな！」
:自分: 『ひょ～ぃ』
:親父: 「よしっ、いまや！そのまま口に持って行ってズルズルズルーっとすするんや！」
:自分: 『ずるずるずるーっ』
:親父: 「よーし。OKや。」

よーし。OK！大阪行ったら、今度は「夏季限定清涼うどん」 **も** 食べよう。


.. |かまたま| image:: http://www.freia.jp/taka/photo/foods/hagakure/PICT0014.JPG?size=thumb

.. |ぶっかけ| image:: http://www.freia.jp/taka/photo/foods/hagakure/PICT0016.JPG?size=thumb

.. |生じょうゆ| image:: http://www.freia.jp/taka/photo/foods/hagakure/PICT0017.JPG?size=thumb

.. _`(Album)`: http://www.freia.jp/taka/photo/foods/hagakure

.. _`M.Shibataさんに教えてもらった`: http://www.freia.jp/taka/blog/194#comments
.. _`梅田はがくれ`: http://www.hagakure.cc/




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4966812162
:title: Re: 大阪出張の収穫（うどん）
:author: M.Shibata
:date: 2005-05-02 23:04:01
:email: 
:url: http://www.emptypage.jp
:body:
気に入っていただけてなによりです。
僕も次はおっちゃんにOKをもらえるようにがんばります。

%%%%%%%%%

:id: 197
:date: 2005-05-02 19:36:47
:title: とやま結婚祝い
:categories: ['Event']
:body type: text/x-rst
:body:
4/30に仲間内で、とやま結婚お祝い会を開いた。場所は調布の Dimple_ というカジュアルフレンチなお店。料理・ワインともおいしく、「友人の結婚のお祝い」ということでお願いしたところ、特別にケーキを出してもらって二人に入刀してもらったりと、すばらしい会になったとおもう。

|dimple_cake|

その後、清水川宅（というか俺んち）にて定例クリスマスイベント写真閲覧会に突入。楽しいひとときでした。

.. |dimple_cake| image:: images/dimple_cake
.. _Dimple: http://home4.highway.ne.jp/hmiya/




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 198
:date: 2005-05-02 19:49:25
:title: 突然風邪
:categories: ['misc']
:body type: text/x-rst
:body:
突然風邪っぽくなってしまったので今日病院に行ったところ、喉が乾燥しているせいだ、と言われた。たしかにここ１年ほど喉が常に渇いた感じがする。さらに、おととい飲み過ぎたせいで喉の乾燥が加速していたのかもしれない。

とりあえず今日は安静にして、GWを風邪休養に消費しないようにしよう。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 199
:date: 2005-05-03 20:51:51
:title: 猫屋敷へ
:categories: ['misc']
:body type: text/x-rst
:body:
aihatena_ が飲み会で仙台に行ってしまったので、猫のおさんどんをしに毛だらけのaihatena宅へ。

|nekoyashiki1|

昔みたいに知らない人を怖がらなくなったけど、昔みたいに寄ってこなくもなってしまったみたい。

.. _aihatena: http://www.freia.jp/aihatena
.. |nekoyashiki1| image:: images/nekoyashiki1



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4976323378
:title: Re: 猫屋敷へ
:author: 番号なんかで呼ぶな
:date: 2005-05-04 14:50:56
:email: no6@prisoner.jp
:url: 
:body:
やあやあ、お疲れさまだ。


:comments:
:comment id: 2005-11-28.4977463206
:title: Re: 猫屋敷へ
:author: 清水川
:date: 2005-05-05 15:18:46
:email: taka@freia.jp
:url: 
:body:
自宅まで毛を持ち帰ってしまった‥‥


:comments:
:comment id: 2005-11-28.4978601268
:title: Re: 猫屋敷へ
:author: aihatena
:date: 2005-05-06 10:29:45
:email: 
:url: 
:body:
サンクス! たいへん助かりました。

人見知りは継続中なので(特にみーさん)
単にしみた氏を覚えたのではないかと。

%%%%%%%%%

:id: 200
:date: 2005-05-05 03:11:53
:title: Pythonパズル
:categories: ['python', 'Game']
:body type: text/x-rst
:body:
`日本のZope情報`_ に掲載された `Python Challenge`_ に挑戦中です。

Level0～4までは難なくクリアしたものの、Level5で3時間くらい悩んでしまい、Level6は未だ解決の糸口が見えていません。なんとなくやるべき事は分かる（気がする）んだけど、対象が分からない。はてさて・・・。

ここまでの感想として、久々に「楽しいパズル！」という感じです。途中、phpが使われてる問題があったりして、ちょっと「え～」とか思いましたが、Level5は悩んだ分、Pythonの内部構造が分かった気になれました（笑）。

.. _`日本のZope情報`: http://coreblog.org/jp/jzi/
.. _`Python Challenge`: http://www.pythonchallenge.com/pc/index.htm


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4982555668
:title: Re: Pythonパズル
:author: 清水川
:date: 2005-05-05 15:18:02
:email: taka@freia.jp
:url: 
:body:
Python以外の部分で悩んでる時間が長い。分かってしまえば後はどう実現するかだけなので、Pythonリファレンスを読んでコードを書くだけなんだけどなぁ。

次はレベル7が解けない‥‥ぼくもう疲れたよ‥‥。



:comments:
:comment id: 2005-11-28.4983714552
:title: Re: Pythonパズル
:author: 清水川
:date: 2005-05-10 02:52:51
:email: taka@freia.jp
:url: 
:body:
レベル7,8解けた～
%%%%%%%%%

:id: 201
:date: 2005-05-06 10:53:35
:title: 今日は会社でFreeBSD5.3 on DELL PowerEdge800
:categories: ['work']
:body type: text/x-rst
:body:
社内サーバー用に購入した `DELL PowerEdge800`_ にFreeBSD5.3で環境構築中。Broadcom 5721用のドライバが無かったので、 `FreeBSD5-stableのソースを取ってきてdiffして`_ if_bgeにパッチしました。

チップの定義を追加するくらいなら、カーネルソースを全く読んだことが無くても出来るけど、動作の保証はヒトバシラーになって使ってみるしか無いわけで。この辺、即対応可能なオープンソースの強みでもあり、保証がない（自分で保証を作っていくしかない）という弱みでもあるなぁ。というか会社のサーバーで人柱するなと。


.. _`DELL PowerEdge800`: http://www1.jp.dell.com/content/products/productdetails.aspx/pedge_800?c=jp&l=jp&s=soho&~tab=specstab#tabtop

.. _`FreeBSD5-stableのソースを取ってきてdiffして`: http://www.freebsd.org/cgi/cvsweb.cgi/src/sys/dev/bge/if_bge.c.diff?r1=1.72.2.2%3ARELENG_5_3&tr1=1.82&r2=1.72.2%3ARELENG_5&tr2=1.72.2.10.2.1


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 202
:date: 2005-05-09 00:31:26
:title: COREBlog1.2+plonifiedカスタム
:categories: ['Plone', 'Zope']
:body type: text/x-rst
:body:
COREBlog1.2＋plonifiedスキン（改造版）へ移行 ＆ サイトの配色を変更してみました。本当はもっとPloneっぽく無くしたかったところですが、とりあえず色変更だけでごまかしてみます（逃）。

まだCOREBlog純正だったころのようなサイドボックスとかの配置が終わっていなかったり、サイト右上の検索ボックスでBlogを検索できなかったりしますが、それはまた追々……。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 203
:date: 2005-05-09 08:45:30
:title: COREBlogのRSS用metaタグを追加
:categories: ['Plone']
:body type: text/x-rst
:body:
COREBlog関連のポートレットやカスタマイズをぼちぼちやっていく予定ですが、とりあえず、 `takanory.net`_ さんのRSSフィードアイコン追加を参考に、「最近のBlogエントリ」にアイコンを追加しました。

あと、RSSフィード用のmetaタグをheaderに仕込むために、plonified/index_html, entry_html 等の *fill-slot="main"* を持っているZPTファイルに以下のコードを追加しました。

.. code-block:: XML

    <metal:main fill-slot="head_slot">
        <link rel="alternate"
              type="application/rss+xml"
              title="RSS 0.91"
              href=""
              tal:attributes="href string:${here/blogurl}/rdf91_xml" />
        <link rel="alternate"
              type="application/rss+xml"
              title="RSS 1.0" href=""
              tal:attributes="href string:${here/blogurl}/rdf10_xml" />
        <link rel="EditURI"
              type="application/rsd+xml"
              title="RSD"
              href=""
              tal:attributes="href string:${here/blogurl}/rsd_xml" />
    </metal:main>


# `SyntaxColoring`_ も使わせてもらっています。柴田さんありがとうございます.

.. _`takanory.net`: http://takanory.net/takalog/183/
.. _`SyntaxColoring`: http://coreblog.org/ats/640



:extend type: text/plain
:extend:


:trackbacks:
:trackback id: 2005-11-28.4993996777
:title: PlonifiedでもFirefoxなどがRSSを見つけられるようにする
:blog name: Feel Fine!
:url: http://forestlaw.ddo.jp/blog/44
:date: 2005-11-28 00:48:19
:body:
COREBlogのRSS用metaタグを追加（清水川記）を参考に Feel Fine!
でも Mozilla Firefox などが RSS を見つけられるようにした。 Zope で
Syntax Coloring（TRIVIAL TECHNOLOGIES）もすばらしいなぁ。
reStructuredTextの書き方が解らないので手を出さなかったのだが、後でやってみよう。
%%%%%%%%%

:id: 204
:date: 2005-05-11 03:05:29
:title: Zope Essentials 1 終了しました
:categories: ['Zope', 'Event']
:body type: text/x-rst
:body:
今日は `Zope Essentials 1`_ が行われました。メインプレゼンテータをつとめたのですが、それなりに反応は良かったようです。

▼ イベントの様子 `(Album)`_

|イベントの様子|

２次会中、気が付いたら終電が終わっていました。多摩方面３人でタクシーで帰ってきました orz..


.. _`Zope Essentials 1`: http://new.zope.jp/event/zopeessentials/1

.. |イベントの様子| image:: http://www.freia.jp/taka/photo/ze1/PICT0004.JPG?size=thumb

.. _`(Album)`: http://www.freia.jp/taka/photo/ze1/




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.4997816996
:title: Re: Zope Essentials 1 終了しました
:author: 清水川
:date: 2005-05-11 14:07:59
:email: taka@freia.jp
:url: 
:body:
内容の感想は別エントリーで書きます～


:trackbacks:
:trackback id: 2005-11-28.4998963139
:title: 「Zope Essentials 1」 開催しました
:blog name: Zopeジャンキー日記
:url: http://mojix.org/2005/05/10/235226
:date: 2005-11-28 00:48:19
:body:
「Zope Weekend」に続く日本Zopeユーザ会の新しいイベントシリーズ、「Zope Essentials」の１回目をやりました。

Zope Essentials 1

会場はアーク森ビルのジェトロ（ジェトロは昨年末、Zope / Ploneでサイトをリニューアルしています）。

いまや100人規模のイベントに成長した「Zope Weekend」に比べると、２時間・30人程度の小じんまりしたイベントでしたが、アットホームな感じで良かったです。
%%%%%%%%%

:id: 205
:date: 2005-05-12 00:29:26
:title: ZopeインストールFlash
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope Essentials 1 の `資料を公開`_ します。まもなく `本家サイト`_ でも公開されると思いますが。


で、本題の、Zopeインストール説明Flashを公開します。

- `ZopeインストールFlash`_
- `ExternalEditorインストールFlash`_

これらは `Wink`_ というツールで作りました。踏み込んだこと（画像として編集とか）はできませんが、手軽にFlashを作れるのは良いです。


.. _`資料を公開`: http://www.freia.jp/taka/file/Zope/ZopeEssentials1Main.zip
.. _`本家サイト`: http://new.zope.jp/event/zopeessentials/1
.. _`ZopeインストールFlash`: http://www.freia.jp/taka/file/Zope/ZopeInstallFlash
.. _`ExternalEditorインストールFlash`: http://www.freia.jp/taka/file/Zope/ExternalEditorFlash
.. _`Wink`: http://www.debugmode.com/wink/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 206
:date: 2005-05-17 01:30:05
:title: いちプログラマの不安
:categories: ['misc', 'Agile(XP)']
:body type: text/x-rst
:body:
`コード読みのコード知らず`_ から始まる `404 Blog Not Found`_ と `Matzにっき`_ の間のやりとりを読んでいると、 **人に理解されない職業** に属する身として一抹の不安を覚えた(将来に？何にだろう？)。正直、読んでてちょっとへこんだ。

その一方で（上記のやりとりとは全然関係ないけど）、 `失敗しない情報システム調達 - 顧客の視点で、アジャイルを説明`_ という文章もあったりしてホッとしたりする。この文章は開発側の人間が視点を変えて「発注側にこうあってほしい」という事を書いたものだけど、実際にこういう体制で発注側が動いてくれるなら、こういう体制・関係を作ることが出来るなら、我々は **理解出来ない「やつら」** ではなくなるんだろうと思う。

我々と言っても、自分は未だプログラマーにもアジャイラーにもなりきれないのだけれども。


.. _`コード読みのコード知らず`: http://blog.livedoor.jp/dankogai/archives/21958446.html
.. _`404 Blog Not Found`: http://blog.livedoor.jp/dankogai/archives/21958446.html
.. _`Matzにっき`: http://www.rubyist.net/~matz/20050514.html#p01
.. _`失敗しない情報システム調達 - 顧客の視点で、アジャイルを説明`: http://www.hyuki.com/yukiwiki/wiki.cgi?%bc%ba%c7%d4%a4%b7%a4%ca%a4%a4%be%f0%ca%f3%a5%b7%a5%b9%a5%c6%a5%e0%c4%b4%c3%a3




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 207
:date: 2005-05-17 03:26:26
:title: SilverCityDocument
:categories: ['Plone', 'Programming']
:body type: text/x-rst
:body:
コードをSynaxColoringしてくれるPloneドキュメント、 SilverCityDocument を Archetypes の練習がてら作成してみました。 `こんな感じ`_ に表示されます。ついでに覚え書きページを用意しました＞ `SilverCityDocument`_

もうちょっとコード足せばそれなりに使えそうな予感。

# Plone本ではPloneSilverCityという名前だったけど...あっちはArchetypes使ってないから、いいかな...

.. _`こんな感じ`: http://www.freia.jp/taka/memo/plone/silvercitydocument/SilverCityDocument
.. _`SilverCityDocument`: http://www.freia.jp/taka/memo/plone/silvercitydocument/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 208
:date: 2005-05-18 01:21:59
:title: COREBlogオフ会
:categories: ['Event', 'Zope']
:body type: text/x-rst
:body:
今日は `COREBlog1.2リリース記念オフ会`_ ということで原宿のベルギービールのお店、 `ブラッセルズ`_ に行ってきました。仕事がちょっとのびてしまって、自己紹介の後に参加したんだけれど、それにしても「ヤッテシマッタ」と言わざるを得ない事をヤッテシマッタ‥‥。

柴田さんに対して **「すみません、お名前教えてください」** って‥‥orz

今まで写真でしか知らなかったんですよぅ‥‥。初めまして、大変失礼しました。

あと、 `takanory.net`_ の たかのり さんに初めてお会いしました。最近、Archetypesさわってるので参考にさせてもらってます。と言ったら、LDAP関係で `自分の記事`_ を参考にされていたようで。あー、GRUF3.2RC1以降さわってないなぁ‥‥。

ということで、総勢13名(多分)の濃い会でした。終電ぎりぎりだったので、挨拶もそこそこに帰ってしまいましたが、またお会い出来ればと思います。ベルギービールもおいしかったし。ホント。

*#白ビールとブドウのやつが気に入って、3杯ずつ飲んだかな？*

.. _`COREBlog1.2リリース記念オフ会`: http://coreblog.org/ats/650
.. _`ブラッセルズ`: http://www.brussels.co.jp/TOP/top.html
.. _`takanory.net`: http://takanory.net/
.. _`自分の記事`: http://www.freia.jp/taka/blog/109

---------

*#ブドウ違う。チェリーだYO*



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 209
:date: 2005-05-19 00:02:32
:title: Drag & Drop Sortable Lists をZopeで使う案
:categories: ['Zope']
:body type: text/x-rst
:body:
自分は今までJavaScriptをまじめに勉強したことが一度もないし、まじめに読んだこともほとんど無いので、これからも勉強するつもりはない。以上、おわり。

‥‥とも言ってられない。

JavaScript無しでやってると、主にform（リストボックスとか）でフラストレーションがたまることが多い。使っていて、ワンクリック毎にサーバーリクエスト＆レスポンス、というのがなんともイライラする。 `ZPhotoSlides`_ の管理画面で100枚近くある写真の順番を手動で並べ直したときは気絶するかと思いましたよ！っていうくらい大変。

で、このフラストレーションを解消出来そうな `Drag & Drop Sortable Lists with JavaScript and CSS`_ 技術を `日本のZope情報`_ 経由で入手。早速Zope(のコンテンツ)上に `載せてみた`_ 。

うまく動くみたいなので、この技術をOrderd Folderなんかに適用出来ないかな～と妄想してみる。多分この技術は、CSSの位置情報をJavaScriptで操作して実現しているので、適用するためにはtable使うの止めて全部 ul, li  タグで書かないといけないんだと思う。大変そうだ。

.. _`ZPhotoSlides`: http://zphotoslides.org/
.. _`日本のZope情報`: http://coreblog.org/jp/jzi/
.. _`Drag & Drop Sortable Lists with JavaScript and CSS`: http://tool-man.org/examples/
.. _`載せてみた`: http://www.freia.jp/taka/memo/javascript/javadrag/



:extend type: text/plain
:extend:


:trackbacks:
:trackback id: 2005-11-28.5014445113
:title: Drag & Drop Sortable Lists で階層的な箇条書きをウンヌンしたい
:blog name: [CD]CoffeeDiary
:url: http://akiyah.bglb.jp/blog/754
:date: 2005-11-28 00:48:21
:body:
Drag & Drop Sortable Lists をZopeで使う案 — 清水川 Webを見て、 Drag &
Dropをやってみたくなってダウンロードしてみた。
おぉ、サンプルを見てみると普通にドラッグアンドドロップが使える！
JsUnitでのテストもなんかグラフィカルですごいし。
で、マインドマップBBS的な物を想像すると、このドラッグアンドドロップが
階層的な箇条書きに対して使えるとすごくうれしいのだけど、
簡単に試してみたらうまく行かなかった。なんかエラーが出ちゃう。
まあ、一発でう...
%%%%%%%%%

:id: 210
:date: 2005-05-19 00:28:58
:title: プーさんで辛さ＋１のチキンカレー
:categories: ['food']
:body type: text/x-rst
:body:
今日は東京の西の方に打ち合わせに行きました。西の方に行ったらかならず寄りたいのが武蔵小金井の `プーさん`_ 。大丈夫、今日は水曜日だし！(月・木定休)

▼ チキンカレー（辛さ＋１） `(写真)`_

|チキンカレー|

▼ アイスクリーム（チョコリンゴ） `(写真)`_

|アイスクリーム|

前回食べたときは、辛さ普通を食べて若干辛さが弱かったと感じていたので、今日は辛さ＋１(=4)に挑戦......辛い～(;o;) でもウマイ。野菜が入ると辛さが弱まるのかもしれないと思った水曜定時退社の日。

.. _`プーさん`: http://gourmet.yahoo.co.jp/gourmet/restaurant/Kanto/Tokyo/guide/0203/WV-TOKYO-7RBDS001.html

.. _`(写真)`: http://www.freia.jp/taka/photo/foods/pooh

.. |チキンカレー| image:: http://www.freia.jp/taka/photo/foods/pooh/PICT0011_2.JPG?size=thumb

.. |アイスクリーム| image:: http://www.freia.jp/taka/photo/foods/pooh/PICT0013.JPG?size=thumb



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5018378741
:title: Re: プーさんで辛さ＋１のチキンカレー
:author: jack
:date: 2005-05-20 15:36:36
:email: 
:url: 
:body:
プーさんまで徒歩10分ちょいのとこに住んでます(笑)
+1というと「辛口」のことでしょうかね(普通の店の激辛の上ですが)。
「極辛」まであって食べるのは辛口か極辛ですね。野菜プチはデフォです(笑)


:comments:
:comment id: 2005-11-28.5020025273
:title: Re: プーさんで辛さ＋１のチキンカレー
:author: 清水川
:date: 2005-05-21 01:39:02
:email: taka@freia.jp
:url: 
:body:
> +1というと「辛口」のことでしょうかね

です。最近辛さ表が貼られるようになって、1(甘口) - 3(普通) - 5(辛口) らしいです。
自分は、野菜入れたら4, 野菜なしなら3が良いのかも。



:comments:
:comment id: 2005-11-28.5021166514
:title: Re: プーさんで辛さ＋１のチキンカレー
:author: jack
:date: 2005-05-22 12:15:24
:email: 
:url: 
:body:
貼ってるんですか・・・気づかなかった。
いつも「野菜プチ極辛でアイスで」といって座ってしまうので。
# 月に一回以上は行ってます。
%%%%%%%%%

:id: 211
:date: 2005-05-19 23:09:10
:title: ベルギービールやばい
:categories: ['food']
:body type: text/x-rst
:body:
どうやらベルギービールにはまったらしい。やばい。父が出張で東京に来たので、近所の西友で朝ご飯とか買ったついでに売り場を見たら、結構ベルギーなビールが置いてあった。お気に入りなチェリーのやつもあった。

見つけてしまったからには、父ちゃんと飲むべく、買って帰らねば。650円に気後れしてはいけない。

▼右がチェリーなやつ（ベルビュー・クリーク）

|belgiumbeer|

うぅむ、お店で飲んだ時の方がウマイような‥‥。隣の白いのはあんまりおいしくなかった。そして父ちゃんは既に寝ていた。起きてくれないよ？

.. |belgiumbeer| image:: images/belgiumbeer




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5025161017
:title: Re: ベルギービールやばい
:author: takanori
:date: 2005-05-20 11:34:06
:email: 
:url: 
:body:
ベルビュークリークおいしいですよね。
他にもベルビューフランボワーズとかいろんな果物の入っているビールがあるので、あの味が気に入ったのなら試してみるといいですよ。

お店で飲んだほうがおいしいのは、雰囲気か酔っ払い状態か注ぎ方の違いでしょうか。


:comments:
:comment id: 2005-11-28.5026312318
:title: Re: ベルギービールやばい
:author: 清水川
:date: 2005-05-21 01:36:37
:email: taka@freia.jp
:url: 
:body:
おお、サクランボの他に木イチゴもありますか。また西友で探してみます。
注ぎ方・グラスの冷え具合というのはあるかも。泡のきめ細かさが大分違ったような気が。

%%%%%%%%%

:id: 212
:date: 2005-05-21 01:34:39
:title: ZPhotoSlidesメモリ・ディスク食い潰し問題
:categories: ['Zope']
:body type: text/x-rst
:body:
最近ふと気が付くと Data.fs [1]_ が17GBにふくれあがっている事が何度かあった。Packさぼってたからかなー‥‥と思って1週間でPackすると6GBくらいになる。いくら何でもおかしい。

最近ふと気が付くとZopeの使用メモリ量が512MBを超えている。そして一部のページを表示するときにMemoryErrorが発生する。どうやらその一部のページというのはZPhotoSlidesコンテンツのようだ‥‥。

なんで写真ページを表示するだけでData.fsが150KB～500KBも増えるのか。そして、botのアクセスがなければここまで深刻な問題ではなかったのかもしれない。

とりあえずソースに以下の変更を加えて対処してみた。

.. code-block:: Python

 rating.py: 75
    def showRatings(self):
        ''' return 1 if object use ratings '''
        if not self.isPrincipiaFolderish:
            if hasattr(self.aq_parent,'show_rating'):
 -               self.show_rating = self.aq_parent.show_rating
 +               return self.aq_parent.show_rating
        return self.show_rating

 ZPhoto.py: 593
                if(not REQUEST.cookies.has_key('visited'+str(self.getId()))):
 -                  self.viewed = self.viewed + 1
 +                  #self.viewed = self.viewed + 1
                    REQUEST.RESPONSE.setCookie('visited'+str(self.getId()),1)

 ZPhoto.py: 623
                if(not REQUEST.cookies.has_key('visited'+str(self.getId()))):
 -                  self.viewed = self.viewed + 1
 +                  #self.viewed = self.viewed + 1
                    REQUEST.RESPONSE.setCookie('visited'+str(self.getId()),1)

どうやら、ZPhotoインスタンスのフィールドを更新しているのが原因らしい。これがUndoに記録されるのかな？こんなの、Undo出来ないんだからUndoされなくてもいいのに‥‥。 [2]_

とりあえずよりよい対処法が見つかるまで、写真のアクセスカウントはしない方向で。というか、botのアクセスがカウントされるのってどうなのよ？

----------------------

.. [1] Zopeのユーザーデータが格納される仮想(?)ストレージ
.. [2] 勝手な憶測です。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 213
:date: 2005-05-23 00:28:41
:title: 大台
:categories: ['misc']
:body type: text/x-rst
:body:
今日（もう昨日か）は30歳の誕生日でした。産地直送のウニをごちそうになったり、焼き鳥をごちそうになったりしました。ごちそうさまでした。しかしもう「20代です」と言えなくなったなぁ‥‥。

男は30を過ぎると急に何かに追い立てられるように走り出す（ランニングを始める）らしいので、トレーナーかなにか用意しておこうかな。

--------------

ごちそうになったウニの写真があるのを忘れていました。

▼殻はかなりおおきい。けど身は少ない。

|hirokiuni|

▼ウニ食べてる間、隣の部屋に閉じこめられていた猫

|hirokiuni_neko|

.. |hirokiuni| image:: images/hirokiuni
.. |hirokiuni_neko| image:: images/hirokiuni_neko




:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5033650011
:title: Re: 大台
:author: setomits
:date: 2005-05-24 23:54:12
:email: 
:url: http://matatabi.homeip.net/blog/setomits/
:body:
同い年ですね。僕は1月に30になります。
もうなっちゃったらどってことないでしょうけど、30というとなかなかやっぱりねえ。

%%%%%%%%%

:id: 214
:date: 2005-05-25 00:03:54
:title: COREBlogページだけportletを切り替える
:categories: ['Plone', 'python']
:body type: text/x-rst
:body:
COREBlog(plonified)のページが表示された場合に、左slotのportletを一部変更するようにしてみました。

簡単にやるためには、COREBlogフォルダのプロパティーにleft_slotsという名前のlines型のフィールドを用意して、表示したいportletマクロを羅列すれば良いのですが、それだと親フォルダで設定したものと別で管理しないといけないので、今回はleft_slotsという名前のScript(Python)を置いて代用しています。

.. code-block:: Python

  path = container.getPhysicalPath()
  path = '/'.join(path[:-1])
  parent = container.restrictedTraverse(path)
  slots = parent.left_slots
  slots = [x for x in slots if 'blog' not in x]
  slots[:0] = ['here/portlets/archives/macros/portlet',
               'here/portlets/categories/macros/portlet',
              ]
  
  return slots

上記のマクロは自分より上位パスから ```left_slots``` を取得して ```blog``` という文字を含むportletを除外してから、 ```archives``` と ```categories``` のportletを追加しています。 ( *parentを一発で手に入れるコードとかありそうな気がするけど...* )

うーん、見ているページによってportletが変わってしまうのはどうなんだろう？違和感ありますが、とりあえずこれでしばらく様子を見てみます。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 215
:date: 2005-05-26 02:22:22
:title: イベントの打ち合わせ
:categories: ['food', 'Event']
:body type: text/x-rst
:body:
今日は次のZopeイベントの打ち合わせをしてきました。その帰りに打合せした数人で麹町のドイツ料理屋さん PAUKE_ に行ってきました。このお店、中に小さいステージがあってそこで `アンサンブルの生演奏`_ が！すーげー！（すんません、あんまりこういうお店行かないもので‥‥）

▼いろいろな種類のビール。最初はレーベンブロイから。

|german_beer|

.. _PAUKE: http://homepage2.nifty.com/undo-aki/pauke2/pauke.htm
.. _`アンサンブルの生演奏`: http://homepage2.nifty.com/undo-aki/pauke2/music.htm

.. |german_beer|  image:: images/german_beer



:extend type: text/plain
:extend:
▼２杯目はジャヴァー。ソーセージが超ウマ

|german_sausage|

▼アイスヴァイン。凍った足、だそうな。でか。

|german_icevain|

いやー、うまかった。いろいろと話をしたり相談に乗ってもらっているうちに終電ギリギリというか終電の時間が来て解散。アイスヴァインは食べ切れませんでした。

最近、ビールづいてる気が。あとミニイベント多すぎ。明日は `XPユーザー会`_ だし。

.. _`XPユーザー会`: http://www.xpjug.org/xpjug_root/event/20050526meeting/regist

.. |german_sausage| image:: images/german_sausage
.. |german_icevain| image:: images/german_icevain




:comments:
:comment id: 2005-11-28.5040978243
:title: Re: イベントの打ち合わせ
:author: 本多重夫
:date: 2005-05-26 09:22:01
:email: 
:url: http://www.shigeo.net
:body:
本多です。昨夜はお疲れさまでした。



:comments:
:comment id: 2005-11-28.5042102130
:title: Re: イベントの打ち合わせ
:author: 清水川
:date: 2005-05-26 09:47:23
:email: taka@freia.jp
:url: 
:body:
> お店の名誉のための、書いておくと……

(^^;;
フラッシュは失敗だったかも..。でもDimageX21感度低いんですよね。

お肉は大変おいしかったです。5人で食べても多すぎでしたが。



:comments:
:comment id: 2005-11-28.5043731993
:title: Re: イベントの打ち合わせ
:author: aihatena
:date: 2005-05-26 11:31:57
:email: 
:url: http://www.freia.jp/aihatena/diary/040116
:body:
ひじ立てて両手でしっかりホールドすればDiMAGE X&amp;ノンストロボでも↑名前のリンクくらいには撮れるよ。
レッツチャレンジ
%%%%%%%%%

:id: 216
:date: 2005-05-27 02:09:44
:title: リモートペアモデリング（違
:categories: ['work']
:body type: text/x-rst
:body:
1. `XPJUGのユーザー会`_ から帰ってきたら「キンキュウ」の対応が必要なお仕事が発生していました。これから対応します（24:30）

2. 会社のPCをつけてもらい、VPNで会社に接続してVNCで会社のPCを操作します。自宅には環境無いからね。今くらいの時間、JCOMの回線はしゃれにならない遅さです（24:50）

3. 会社に残っていた同僚から別件で質問が来たので、会社のMyPCの前に座ってもらって、VNC経由でJUDEでシーケンスを書きつつ質問に答えます（25:00）

4. JUDEファイルをプレゼントして元の「キンキュウ」対応に戻ります。VSS,WZMail5,WZFiler(海賊版),WZGrep,AlaxisMerge6.5,サイボウズデヂエを駆使してがんばります。全部VNC経由です（26:00）

5. VNCの異常切断に悩まされつつ作業終了。まだ仕事している現場のみなさん、お先失礼します（27:30）

.. _`XPJUGのユーザー会`: http://www.xpjug.org/xpjug_root/event/20050526meeting/regist



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 217
:date: 2005-05-28 01:36:38
:title: みかたいぷ
:categories: ['Game']
:body type: text/x-rst
:body:
`ペアグーグリング。とかその他。(Something Red)`_ で美佳のタイプトレーナーのネタが出ていたので思わず反応。今日は超お疲れなのですぐ寝ようと思ったのに‥‥（笑）

その昔、mikatypeを延々とやり続けた頃があって、特にDOSコマンド練習ははまった。入力速度400文字/分が一頃の壁だったなぁ‥‥。

‥‥。

どれ。やってみるか。


.. _`ペアグーグリング。とかその他。(Something Red)`: http://somethingred.dip.jp/blog/392



:extend type: text/plain
:extend:
▼やってみた

|mikatype1|

うわー！ミスタイプ多すぎ～こんなの俺の成績じゃねぇー！俺の成績は610文字の方なんだよぅ‥‥....500文字/分を超えた記憶が無いのですが？これ、誰の成績？

# 最近、 Anex86_ の出番が多いな...

.. |mikatype1| image:: images/mikatype1
.. _Anex86: http://homepage2.nifty.com/ans/




:comments:
:comment id: 2005-11-28.5050888717
:title: Re: みかたいぷ
:author: つかぽん
:date: 2005-05-29 16:48:54
:email: plus9@mail.104.net
:url: http://blog.plus9.info/
:body:
mikatype懐かしいなぁ。
%%%%%%%%%

:id: 218
:date: 2005-05-29 23:59:31
:title: XPユーザー会
:categories: ['Agile(XP)', 'Event']
:body type: text/x-rst
:body:
5/26(木)に `第13回XPユーザー会`_ に参加してきました。今回のユーザー会は初参加者が多かったようで、会場全体に堅めの雰囲気が漂っていました。スーツ姿も多かったような気がします（自分もだけど）。

.. _`第13回XPユーザー会`: http://www.xpjug.org/xpjug_root/event/20050526meeting/regist






:extend type: text/plain
:extend:
`機械猫モッカー`_ によるTDDの促進
-----------------------------------

発表者の伊尾木さんはXPイベントで何度か顔を合わせている方。でも `機械猫の日記`_ の存在は今回のイベント(告知)で初めて知りました(^^;;  で、 `機械猫モッカー`_ ですが、簡単に言うと「テストコード」から「モック」を自動的に生成するツールです。なので、

1. class A の実装をしたい
2. class A は class B を使うが、class B の実装はしばらく先
3. class A から使う class B の機能のテストコードを書く
4. テストコードから **機械猫モッカー** で class B を生成
5. class A の実装を進められる

ということが出来ます。この結果、

- class A のテストを class B の実装に依存せずに実施可能
- class B を実装する頃にはテストケースがほぼ全て用意されている

ということが可能になります。仮に class B が既に出来ていても、DBに依存していたりすると class A のテストは非常に面倒なモノになるところですが、 **機械猫モッカー** で class B のテストコードから瞬時にモックを作り出せば楽に開発が進められます。「あー、XXXに依存しちゃってるからテスト出来ないねー」という会話はこれでこの世から消滅します！（するといいなぁ）

このツール、XP/TDDの開発サイクルでネックになる「テストが難しい・いちいちモックを作っていられない・まだ依存先のClassが出来ていない」という点を解消しているところがすごいなーと思います。

ところで、発表では「DI とか Factory とか Interface とか作らなくてもOKなんです！」と言ってたけど、ということは静的に結合しちゃうんでしょうか？ビルド時にantとかが切り替えてくれる？Javaな人じゃないので、そこはよくわかりません。

*# このツール、Pythonにも欲しいなぁ‥‥。*

▼プレゼン中の伊尾木さん ( Album_ )

|xpjug13_mocker|

.. |xpjug13_mocker| image:: http://www.freia.jp/taka/photo/xpjug13/pict0010.JPG?size=thumb
.. _`機械猫の日記`: http://d.hatena.ne.jp/kikaineko/20050527#p1
.. _`機械猫モッカー`: http://kikainekomocker.hp.infoseek.co.jp/


NAgileのご紹介
---------------

発表者の `福井さん`_ と最初にお会いしたのは最初のObjectClubイベントの時‥‥。テストパターンのワークショップの時はいろいろと勉強になりました。

NAgileとはN*（エヌアスタ：NUnit,NAnt,NMock,Cruise Control .NETなど.NET系ツール）を利用したアジャイル開発プロセスのこと。今回に発表ではJavaでよくお目にかかる *うらやましいツール* の .NET 版の紹介が中心でした。これらがあればJavaいいなーとか言わなくてすむようになります。

‥‥しかし！C/C++はNUnit使えないのですよ！

しかも狙ったかのようなタイミングで数カ所から仕事の電話が‥‥。電話が終わった頃にはプレゼンもほとんど終わっていました。ガックシ君です。 `福井さんが資料を公開している`_ のでそれを見て補完しますか。


▼福井さんのプレゼン（ 高橋メソッド [1]_ だ）( Album_ )

|xpjug13_nagile|

.. |xpjug13_nagile| image:: http://www.freia.jp/taka/photo/xpjug13/PICT0012.JPG?size=thumb
.. _`福井さん`: http://www.users.gr.jp/blogs/fukui/
.. _`福井さんが資料を公開している`: http://www.users.gr.jp/blogs/fukui/archive/2005/05/30/13778.aspx

.. _Album: http://www.freia.jp/taka/photo/xpjug13

ライトニングトークス
-----------------------

倉貫さんの「滝を登れ！ XPer」が印象的でした。が、滝を登る前に下流の方に行ってプロセスを浸透させてこないと‥‥。先は長いなぁ。

次は自分も何かネタ出せるといいなぁ。

懇親会
-------

新宿西口、ファーストキッチン隣のソフマップの裏で開催されました。せまかった‥‥。

---------------

.. [1] 「高橋メソッド」 という名前のプレゼン技法 http://www.rubycolor.org/takahashi/




:comments:
:comment id: 2005-11-28.5055155979
:title: Re: XPユーザー会
:author: 伊尾木
:date: 2005-05-30 10:48:16
:email: 
:url: http://d.hatena.ne.jp/kikaineko/
:body:
参加レポートありがとうございます！
Nagileの途中でお仕事の電話・・・お、お疲れ様です！！

機械猫モッカーについてですが、モッカーはテストをパスするコードを吐くだけなので、その後でそのクラスをDIで呼び出すのも、ファクトリで呼び出すのも全然構わないと思っています。
発表で言ったのは、
「単に嘘クラスが欲しいだけのなに、DIとかやりたくない」っていう気持ちにも応えます☆
ということで、絶対にDIしちゃダメ！というわけじゃないです。



:comments:
:comment id: 2005-11-28.5056321361
:title: Re: XPユーザー会
:author: 福井厚
:date: 2005-06-02 10:55:52
:email: 
:url: http://www.users.gr.jp/blogs/fukui/
:body:
参加レポートありがとうございます！

>電話が終わった頃にはプレゼンもほとんど終わっていました。ガックシ君です

そうですか...残念です(^_^;)
でも懇親会では少しお話できて良かったです。



:comments:
:comment id: 2005-11-28.5057504532
:title: Re: XPユーザー会
:author: 清水川
:date: 2005-06-02 12:48:39
:email: taka@freia.jp
:url: 
:body:
＞伊尾木さん
つたない文章ですみません(--; DIとかFactoryとか以外の便利な使い方がちょっと思いつかなかった、という事を言いたかったデス。
今度何かのイベントで「機械猫モッカーを使った開発プロセス」というワークショップをやってみるとか(笑)。

＞福井さん
組込系のお仕事をしていると、良いツールがあっても導入できない事が多いのがツライです。今回紹介されたツール類から、せめてエッセンスを取り込みたいと思います。自作になっちゃいますけど（^^;;

%%%%%%%%%

:id: 219
:date: 2005-06-01 23:48:58
:title: plonified用Portlet実験中
:categories: ['Plone', 'Zope']
:body type: text/x-rst
:body:
Plone用COREBlogスキン ```plonified``` のためのportletを作ってみました。目的は

- 最近のEntry をBlogページ以下で表示する意味は少ないかも？
- Archive, Comment, Trackback....と並べると狭苦しい気がする

というあたりが気になったためです。なので、 ```plonified``` 標準のportletは使っていません。

しかし作っておいてなんですが、 **一覧性に欠ける** という弱点があります。select option だと長いタイトルとかを複数行で表示することも出来ないので **情報量が少ない** という問題もあるし。

‥‥失敗か？



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 220
:date: 2005-06-02 01:14:34
:title: ZrstAmazon構想
:categories: ['python', 'Zope']
:body type: text/x-rst
:body:
TRIVIAL TECHNOLOGIESで公開されている `ZopeでSyntax Coloring`_ を元ネタに SilverCityDocument_ というPlone用のプロダクトを先日作ってみました。さっそくたかのりさんが `使用レポート`_ を書いてくれています。

.. highlights::

  インストールするときに気になった点として、SilverCityDocument-0.0.5.tgz を解凍して Zope サーバを再起動すると「skins ディレクトリが無いよ」とエラーがでていました。そこで、Products/SilverCityDocument ディレクトリの下に skins ディレクトリを作成して、plone サイトにインストールしなおしました。

  -- `SilverCityDocument をインストール - takanory.net`_

おや。だめじゃん(苦笑)。多分、skin無いのに以下のようなコードがあるのがいかんのだと思います。

.. code-block:: Python

    install_subskin(self, out, GLOBALS)

これは、次の機会になおします。というかBlogに書いて以来手をつけてないのですが...今ちょっと別のことやってて...。


.. _`ZopeでSyntax Coloring`: http://coreblog.org/ats/640
.. _SilverCityDocument: http://www.freia.jp/taka/memo/plone/silvercitydocument/
.. _`使用レポート`: http://takanory.net/takalog/219
.. _`SilverCityDocument をインストール - takanory.net`: http://takanory.net/takalog/219



:extend type: text/x-rst
:extend:
ZSilverCity のソースコードを読んでもう一つ、 **docutilsのdirectiveを使えばISBNコードを入れるだけでAmazonのデータを引っ張って来る仕掛けを作れるんじゃないかなぁ** というのを思い付きました。

早速、 pyamazon_ でデータを引っ張ってくる amazon-block directive を作ってみたところ、それなりに動くモノが出来ました。ZSilverCityと比べると、AmazonのIDとか設定が必要なので、もうちょっとコード書かないといけないです。

くわしくは ZrstAmazon_ のページを作ったのでそちらへどうぞ。


.. _pyamazon: http://www.josephson.org/projects/pyamazon/
.. _ZrstAmazon: http://www.freia.jp/taka/memo/zope/zrstamazon/




:trackbacks:
:trackback id: 2006-09-24.8441435501
:title: ZrstAmazon4公開します
:blog name: SiteBites Blog
:url: http://sitebites.homeip.net/blog/147
:date: 2006-09-24 23:40:44
:body:
清水川さんがつくられた ZrstAmazon の改変版を公開します。
概要 pyAmazon に依存していたのを pyAWS
ベースで手を入れた自前モジュールに変更。Amazon E-Commerce
Service(ECS)のAPI Version 2006-09-13
に準拠(しているはず)。もっとも、pyAmazonベースのオリジナルでも古いAPIで動作はしているみたいです。
オプションに次が指定可能: :image: 清水川さんがつくられた
ZrstAmazon の改変版を公開します。 概要 pyAmazon
に依存していたのを pyAWS
ベースで手を入れた自前モジュールに変更。Amazon E-Commerce
Service(ECS)のAPI Version 2006-09-13
に準拠(しているはず)。もっとも、pyAmazonベースのオリジナルでも古いAPIで動作はしているみたいです。
オプションに次が指定可能: :image:

%%%%%%%%%

:id: 221
:date: 2005-06-02 02:03:51
:title: GENIO e550G 壊れる
:categories: ['misc']
:body type: text/x-rst
:body:
ついに、GENIO君(PDA)が壊れました。画面に何も映らなくなり、バックライトが１秒間隔で点滅を繰り返します。フルリセットをかけても治りません。

**しょーがないなーーー。ぽちっとな。**

思わず、デルの `AXIM X50v`_ をデルのサイトで購入してしまいました。だって無いと困るし。発表当時から欲しかったし。

実は発売日に買おうと思っていたのですが、タッチパネルの感度が悪いとかファームアップデートで感度が上がるとか色々あったようなので買い控えていたのでした。で「今使えてるからいーや」モードに‥‥。

とりあえずAXIM君が来るまでの間、GENIO君の完全同型機が会社の備品にあったので、これを借りて代用します。バックアップデータ取っておいて良かった...。

.. _`AXIM X50v`: http://www1.jp.dell.com/content/products/productdetails.aspx/axim_x50v?c=jp&l=jp&s=dhs



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5067685922
:title: Re: GENIO e550G 壊れる
:author: aihatena
:date: 2005-06-02 08:18:16
:email: 
:url: 
:body:
FOMA M1000じゃないのー?


:comments:
:comment id: 2005-11-28.5068806753
:title: Re: GENIO e550G 壊れる
:author: 清水川
:date: 2005-06-02 12:39:02
:email: taka@freia.jp
:url: 
:body:
それだったら某社の702NKの方がいいな。Python使えるし。

%%%%%%%%%

:id: 222
:date: 2005-06-03 00:16:18
:title: plonifiedなCOREBlogのトップページにRDFを埋め込む
:categories: ['Plone', 'Zope']
:body type: text/x-rst
:body:
`トップページに各記事の RDF がコメントされない２ - Feel Fine!`_ でplonifiedのindex_htmlにRDFが埋め込まれない問題について対策されていますが、別アプローチで対応してみました。以下ようにplonifiedのindex_html(19行目あたり)を修正する、というので合ってるかな？

.. code-block:: XML

  <div tal:repeat="entry python:here.rev_day_entry_items(count=here.top_days)">
  <!-- Entry RDF -->
  <span tal:replace="structure python:here.entry_rdf(entry)" />
  <div metal:use-macro="here/entry_macros/macros/entrybody">



.. _`トップページに各記事の RDF がコメントされない２ - Feel Fine!`: http://forestlaw.ddo.jp/blog/58


:extend type: text/plain
:extend:
最初、RDFを挿入するだけだろ！と思って replace="structure here/entry_rdf" なんて書いたらNGでした。そりゃそうだ、と思いつつ replace="structure entry/entry_rdf" と書いてまたNG。PATH式はcontextを切り替えてくれないので、entry_rdfをentryに対して実行しているわけではないからです。ならば実行対象のcontextを渡してあげれば、、、という事で上記のコードになりました。

ところで、自分はRDFとPINGの関係について全く知らないので、 ```なぜそれがPING時に困ったことになるのか``` が分かっていません。あとでgoogleで調べてみます。





:comments:
:comment id: 2005-11-28.5073046278
:title: Re: plonifiedなCOREBlogのトップページにRDFを埋め込む
:author: JJ
:date: 2005-06-03 09:14:53
:email: 
:url: http://forestlaw.ddo.jp/blog/
:body:
これがやりたかったんですよ。
ありがとうございます。



:comments:
:comment id: 2005-11-28.5074189453
:title: Re: plonifiedなCOREBlogのトップページにRDFを埋め込む
:author: 清水川
:date: 2005-06-03 12:35:20
:email: taka@freia.jp
:url: 
:body:
お役に立てたようで(^^

RDFの埋め込みに関して調べてみたところ、以下のサイトが見つかりました。
サンプルでindexページ（複数エントリが表示されているページ）に対してAuto-Discoveryを行っているみたいですね。必要条件かどうかはわかりませんが・・・。



:trackbacks:
:trackback id: 2005-11-28.5075336902
:title: COREBlogのplonifiedスキン対策
:blog name: Pingサーバ開発日記
:url: http://ping.glyle.com/blog/5
:date: 2005-11-28 00:48:27
:body:
さすが清水川さん。対策をしていらっしゃいました。
私も対策を立てていましたが、もっと複雑に考えていてこの対策が一番簡単であるということが判りました。
plonifiedなCOREBlogのトップページにRDFを埋め込む
##Ping送信時には、BlogURL,BlogTitleなどは送信されてきますが、...
%%%%%%%%%

:id: 223
:date: 2005-06-05 17:47:31
:title: 新大久保の餃子「味むら」
:categories: ['food']
:body type: text/x-rst
:body:
会社の元同僚二人と、新大久保にある餃子のお店 **味むら** に行ってきました(金曜日)。

３人でおなかいっぱい食べて、一人2000円しませんでした。ビール飲まなかったらもっと安かったと思う。おみやげもあったので、何か買って帰れば良かったかな‥‥こんど行ったら買っておこう。



:extend type: text/x-rst
:extend:
.. figure:: images/ajimura1
  :align: left
  :class: visualClear

  奥が水餃子（普通のとニラのとミックス）で、
  手前が焼き餃子（粒ニンニク入り）。
  水餃子のジューシーさにうっとり‥‥

.. figure:: images/ajimura2
  :align: left
  :class: visualClear

  餃子の中から本当に粒のニンニクが出てきた！
  本場の餃子はニンニク入れないというけれど、
  これはこれでウマイ。

.. class:: visualClear

``総評`` : 安い、旨い、遠い。
  駅からはちょっと遠いけど行く価値有り。

``場所`` : 新宿区大久保2丁目19-1
  新大久保駅から徒歩5分
  03-3208-9617

``関連URL`` :
  - http://blog.so-net.ne.jp/chiaki/2005-04-27
  - http://plaza.rakuten.co.jp/msnrkkc/diary/200504270000/
  - http://yaplog.jp/ordinary_k/archive/36




:comments:
:comment id: 2005-11-28.5079323477
:title: Re: 新大久保の餃子「味むら」
:author: 清水川
:date: 2005-07-08 20:08:09
:email: taka@freia.jp
:url: 
:body:
自己メモ。住所。

寄り駅： JR新大久保駅　徒歩5分
住所：新宿区大久保2丁目19-1
tel：03－3208－9617



:comments:
:comment id: 2005-12-17.6815408186
:title: Re:新大久保の餃子「味むら」
:author: 餃子大好きっ子
:date: 2005-12-17 15:08:03
:email: 
:url: 
:body:
餃子が大好きなのでタイトルから入ってきました。
そこの餃子って美味しいですか？
楽天に餃子亭味むらってでてたけど、同じですかね？
http://www.rakuten.co.jp/ajimura/
頼んでみようか迷ってます・・・
またお邪魔します。

:comments:
:comment id: 2005-12-18.8076605165
:title: Re:楽天に餃子亭味むら
:author: 清水川
:date: 2005-12-18 23:40:09
:email: 
:url: 
:body:
> 楽天に餃子亭味むらってでてたけど、同じですかね？

あ、このお店です。楽天で売ってるんだ‥‥知らなかった。
写真みたらまた食べたくなってきた(^^;

:comments:
:comment id: 2007-08-10.7326823450
:title: Re:新大久保の餃子「味むら」
:author: 清水川
:date: 2007-08-10 19:12:13
:email: 
:url: 
:body:
自己メモ２
だいたい21:30頃に閉店するらしい。売り切れ仕舞い？


:comments:
:comment id: 2008-02-23.7991143066
:title: Re:新大久保の餃子「味むら」
:author: laitdecoco
:date: 2008-02-23 09:33:20
:email: neige_yu@hotmail.com
:url: 
:body:
つい懐かしくて検索してたらいきなりヒットしました。写真がおいしそうですー。
おじちゃんもおばちゃんも元気かな？
つぶ入り焼き、にら水餃子、砂肝いため、ザーサイのラー油であえたの、花巻、甕だし紹興酒・・・
連れてった友だち、みんなファンになってました。かくいう私も友達の紹介
んー。

:trackbacks:
:trackback id: 2005-11-28.5080474802
:title: 餃子 味むら
:blog name: ペンギン日記♪
:url: http://blog.so-net.ne.jp/chiaki/2005-04-27
:date: 2005-11-28 00:48:28
:body:
知人たちと、新大久保の美味しい餃子屋さんで晩ゴハン。



遅れてきた４人目が１時間半後くらいに到着するまで、ひたすら食べていたんだけど、その間、２種類の餃子しか食べなかった。・・・でも飽きなかった。
美味しかったですね。


ニラ餃子は、早くいかないとなくなるかな？
これは焼き餃子？



%%%%%%%%%

:id: 224
:date: 2005-06-06 20:33:37
:title: 久々に徹夜
:categories: ['work']
:body type: text/x-rst
:body:
昨日の深夜２時頃に布団に入って、月曜からのお仕事の事をいろいろと考えていたら眠れなくなりました。もやもやと頭の中にあるアルゴリズムっぽいやつは明日起きたら忘れるだろうなー、なんか全然眠れないなー、と言っているうちに深夜３時を過ぎてしまったので、あきらめて仕事開始(笑)。

今日の仕事時間は午前４時～午後７時。いやぁよく働いたなぁ。

*# 帰るのが早いって言われたけど、限界ですわ...*


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 225
:date: 2005-06-08 00:40:46
:title: Python Workshop 1 行ってきました(２次会だけ)
:categories: ['python']
:body type: text/x-rst
:body:
今日は19時から `Python Workshop 01`_ に参加しました！と書きたかったんですが、仕事が終わって(終わらせて)会社を出たのが20:40でした。会は21時までだってば....。

残念ながら2次会からの参加となってしまい、 `subway話`_ とか `docutils話`_ とかを聞けなかったのは非常に残念(最近docutilsいじってるので...)。

しっかし、２次会に参加された皆さん、濃いなー。話について行くのがやっとですよ。自分、半分くらい脱落してたから、ついて行ってないのか。精進せねば。

*# 精進してなんとかなるもんなんだろーか？*

.. _`Python Workshop 01`: http://www.python.jp/Zope/workshop/200506/
.. _`subway話`: http://subway.python-hosting.com/
.. _`docutils話`: http://docutils.sf.net/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 226
:date: 2005-06-09 01:20:12
:title: Apacheの認証をLDAPでActiveDirectoryに問い合わせ
:categories: ['Unix']
:body type: text/x-rst
:body:
Apache2からWindows2003/ActiveDirectoryに対してLDAPで認証を行ってみた。試行錯誤の末、とりあえず目的の半分は達成した。

Windows2003なActiveDirectoryに格納されているユーザーの認証はうまくいっているのに、どうやらWindows2000なActiveDirectoryへの問い合わせがうまくいかないらしい。この2台が同一ドメインの親子関係にあるため ＆ ActiveDirectoryの中身をよく知らなかったことで、問題の切り分けに手間取ってしまった。




:extend type: text/x-rst
:extend:
以下は最終的にとりあえず落ち着いている設定。

.. code-block:: Python

  AuthName "Please enter your ID and password"
  AuthType Basic

  ## for Windows2003 ActiveDirectory
  AuthLDAPBindDN Administrator@dom.example.com
  AuthLDAPBindPassword secret
  AuthLDAPUrl ldap://sub1.dom.example.com:389/dc=sub1,dc=dom,dc=example,dc=com?sAMAccountName?sub

  ## for OpenLDAP
  #AuthLDAPUrl ldap://openldap.example.com:389/ou=Users,dc=example,dc=com?uid?sub

  Require valid-user

DNの記述
---------

BindDNでLDAPだと ```cn=Manager,dc=example,dc=com``` と書くところが、ActiveDirectoryだと ```Manager@example.com``` としないといけないようだ。それでいてユーザー検索のBaseDNは ```ou=Users,dc=example,dc=com``` だったり。混乱するなぁ！

ユーザーIDの指定
-----------------

認証先がOpenLDAPなら、uidとかcnとかのいわゆるアカウント名をブラウザの認証ダイアログに指定する。以下の例なら *taka* と入れるわけだ::

  dn: uid=taka,ou=Users,dc=example,dc=com
  uid: taka

ところが、ActiveDirectoryの場合は(自分には)ちょっと複雑で以下のようになっている::

  dn: CN=清水川,DC=dom,DC=example,DC=com
  cn: 清水川
  userPrincipalName: taka@dom.example.com
  sAMAccountName: taka

Windowsのログイン名がそのまま使えます！と言うためには sAMAccountName 属性を使って認証するしかない？ていうかdnはログイン名(taka)じゃないの？え？日本語？

検索と認証の二段階
-------------------

最初はLDAPにbindする事で認証出来るようにしたかった。そうすればLDAPにアクセスするための管理者アカウント設定等を.htaccessとかに書かなくて良くなるからだ。ところが、前述の `ユーザーIDの指定`_ のようになっていると、ブラウザの認証ダイアログに入力されたアカウント名でもってbindする方法がよくわからなかった。AuthLDAPUrlでは無理なのかも？ということで、今はLDAPにアクセス出来るアカウントが.htaccessに書かれている。セキュリティー気をつけないと。

そして問題
-----------

認証先のActiveDirectoryはドメインツリーを構成しているので、ユーザーが ```dom.example.com``` と ```sub1.dom.example.com``` に分割登録されている。そこで、 ```dom.example.com``` の方にscope=subで検索をかければ全員認証出来るかな？と思って試してみたところ、どうもうまくいかない。で、ldapsearchで試してみたところ、以下のように表示された::

  % ldapsearch -h dom.example.com -a always -s sub -D \
    "Administrator@dom.example.com" -W -b "dc=dom,dc=example,dc=com"

    #中略(親側サーバーに入っている全ユーザーのデータ表示)

  # search reference
  ref: ldap://sub1.dom.example.com/DC=sub1,DC=dom,DC=example,DC=com

あー、サブドメイン側 ```sub1.dom.example.com``` のデータは reference になってるのか...。referenceはよくわからんのだけど、 `mod_auth_ldap`_ では解決してくれないのかな？もしかしてこれのせいでうまくいってないのかな？？

でも冒頭に書いたように、単にWindows2000の方(親の方)でなにか問題が起きてるのかも？そういえばLDAPで直接問い合わせてもなぜかmod_auth_ldapがエラーを起こして認証出来なかったし！と今これを書きながら思ったり。

.. _`mod_auth_ldap`: http://httpd.apache.org/docs-2.0/ja/mod/mod_auth_ldap.html

まとめと逃避
-------------

認証ダイアログでPrincipalNameを打ち込む事にすると解決する問題なのかもしれない。あるいはもしかしたら、LDAP使わなければ簡単に解決出来るんだろうか？Radius認証とか色々Apache用の認証モジュールはあるみたいだし、pamに逃げるという手もある。pam -> samba -> AD とか。簡単に解決する方法を調べるために、もうちょっともがいてみよう....。


*# カテゴリ、Windowsかな..*




:comments:
:comment id: 2005-11-28.5090157732
:title: Re: Apacheの認証をLDAPでActiveDirectoryに問い合わせ
:author: 佐藤敦司
:date: 2005-06-28 19:49:01
:email: atsushi.satoh@gmail.com
:url: http://www.bloglines.com/blog/SatoAtsushi
:body:
Good Job!!
ありがとうございました。
半年ぶりの懸案が片付いたところです。

ただ、やはり王道は pam => winbind/samba => AD
のような気がします。

＃パスワードっていうのがはやり。。。。


:comments:
:comment id: 2005-11-28.5091314934
:title: Re: Apacheの認証をLDAPでActiveDirectoryに問い合わせ
:author: 清水川
:date: 2005-06-28 22:44:13
:email: taka@freia.jp
:url: 
:body:
＞半年ぶりの懸案が片付いたところです。

おお！それはよかった！
こちらは未だにWindows2000Serverに対してmod_auth_ldapでユーザー認証できません...orz。ldapsearchならちゃんと認証してくれるんだけどなぁ..。


:comments:
:comment id: 2006-01-23.4221108234
:title: Re:Apacheの認証をLDAPでActiveDirectoryに問い合わせ
:author: Anonymous User
:date: 2006-01-23 15:57:02
:email: 
:url: http://www.eyesom.com
:body:
Windows2000Serverに対してmod

:comments:
:comment id: 2008-03-17.8058409750
:title: Re:Apacheの認証をLDAPでActiveDirectoryに問い合わせ
:author: Anonymous User
:date: 2008-03-17 09:46:46
:email: nospam
:url: 
:body:
ADではAnonymous認証でないからユーザとパスワードがいるんじゃないの？


:comments:
:comment id: 2008-03-17.0854601007
:title: Re:Apacheの認証をLDAPでActiveDirectoryに問い合わせ
:author: しみずかわ
:date: 2008-03-17 13:28:05
:email: 
:url: 
:body:
cnが日本語じゃなくアカウントIDならそのIDでbindしてしまえるので問題ないんだけど、この例では管理者権限でbindするために.htaccessに記載している。危ない。

%%%%%%%%%

:id: 227
:date: 2005-06-13 23:24:13
:title: 今日のFreia
:categories: ['Unix']
:body type: text/x-rst
:body:
今日は朝からFreia様 [1]_ が応答してくれない状態になっていたようです。というかApacheがおかしな状態になってしまって、Zopeへリクエストを転送してくれなくなってしまっていたようです。

例によってZopeの(Productの)問題かと思ったけど、まさかApacheだったとは...。会社のサーバーにはゾンビプロセスを見つけたらApacheを再起動するスクリプトを仕込んであるけど、自宅にも必要になったのかな...。

------------

.. [1] http://www.freia.jp/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 228
:date: 2005-06-13 23:32:22
:title: いそがしくてネタを書くヒマがない
:categories: ['misc']
:body type: text/x-rst
:body:
忙しさが落ち着いたら書きたいネタをメモ。

- 6/11の `Zope3勉強会`_ メモ。Adapterを制する者はZope3を制す？
- 6/11に `DELLのX50v`_ 到着。VGA,624MHz,Bluetooth,無線,内蔵Flashストレージ...たまらん
- SubversionのHookスクリプトをPerlからPythonに移植 [1]_ 。 `Python Workshop 01`_ で森若さんが「PerlとPerlの正規表現処理系は別の言語」と言っていたのが分かる気がする...
- ADUserFolder_ でZope認証をActiveDirectoryに問い合わせようとしたら無限ループに陥り、対象フォルダ以下リカバリ出来ず...なぜだ!?

---------------

.. [1] Subversionの配布物にmailer.pyというのが入っているのに今気づいた....orz

.. _`Zope3勉強会`: http://www.zope.org/Members/yusei/zope3meeting/3
.. _`DELLのX50v`: http://www1.jp.dell.com/content/products/productdetails.aspx/axim_x50v?c=jp&l=jp&s=dhs
.. _`Python Workshop 01`: http://www.python.jp/Zope/workshop/200506/
.. _`ADUserFolder`: http://www.zope.org/Members/novikov/ADUserFolder



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 229
:date: 2005-06-14 23:47:22
:title: Zope Essentials 2 告知
:categories: ['Zope']
:body type: text/x-rst
:body:
`Zope Essentials 2`_ の `告知`_ を行いました。今回は前回と若干異なり、質問コーナーの時間が半分を占めています。うまくいくといいなぁ。

あと、ちょっとしたことですが、質問登録の掲示板は前回のEssentials1で桜井さんが5分で作成したものです。 `前回の資料ページ`_ から入手して設置してみました。

.. _`Zope Essentials 2`: http://new.zope.jp/event/zopeessentials/2
.. _`告知`: http://ml.zope.jp/pipermail/zope-users/2005-June/005437.html
.. _`前回の資料ページ`: http://new.zope.jp/event/zopeessentials/1/resources/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 230
:date: 2005-07-12 00:11:47
:title: Zope Essentials 2 本日開催
:categories: ['Zope']
:body type: text/x-rst
:body:
本日、有楽町にてZopeEssentials2が行われる予定です。って、前回のBlog投稿が一ヶ月前のZE2告知の時って一体....。

ここ一ヶ月ほど、土日も含めて結構忙しい毎日で、Blog書くヒマがあったら～～ムグムグ、という感じでした。来週くらいからその期間のネタを少しずつ書き留めていきたいと思います。自分的にもったいないし。

ということで、 ZopeEssentials2_ です。準備しないとね！ 

.. _ZopeEssentials2: http://new.zope.jp/event/zopeessentials/2/



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5103979358
:title: Re: Zope Essentials 2 本日開催
:author: 清水川
:date: 2005-07-18 20:17:45
:email: taka@freia.jp
:url: 
:body:
時機を逸したのでコメントで書いちゃいます。
ZopeEssentials2、無事終了しました。あっ！今回写真が無い！と今気づいてみたり。実行委員長を引き受けたものの急に忙しくなってしまい、当日も段取りが悪く、いらした方々が「ぇー」とか思ってなければいいのですが‥‥。

反省点やまもりですね。



:trackbacks:
:trackback id: 2005-11-28.5105139383
:title: 「実写版」ページ・テンプレート
:blog name: チューガナビラの心
:url: http://kariyushi.plala.jp/chewganabira/10
:date: 2005-11-28 00:48:30
:body:
写真に写っているのは、清水川さん がZope Essentials 2
でページ・テンプレートの「マクロ」の仕組みを説明される際に使われた紙です。清水川さん
が飲み会で良い気分になっている隙に、略奪しました。
プレゼンテーション・ソフトのギミックに独りよがりに溺れるのではなく、こうした手触りの感覚のあるカジュアルな道具を使って説明される清水川さん
のお姿を拝見して、「さすがは、エンタープライズな(一般的にはXPが受容されにくい)場面において日々、真摯にXPを実践されている方は、ひと味もふた味も違...
%%%%%%%%%

:id: 231
:date: 2005-07-18 20:36:29
:title: Zope3勉強会 4回目
:categories: ['Zope']
:body type: text/x-rst
:body:
`Zope3勉強会`_ に行ってきました(おととい)。そろそろ簡単な掲示板は作れそうな雰囲気になってきています。

今回から、後半は実際にプログラムを書いてみるということで、デモの掲示板(ZopeBookのMessageBoard Step02)をベースに改造してみたのですが、そろそろZopeBookだけでは分からない事が多くなってきました。基本的にArchetypesの事を知っていると入りやすいけど、細かいところが違っていて苦労しています。

.. _`Zope3勉強会`: http://www.zope.org/Members/yusei/zope3meeting


:extend type: text/x-rst
:extend:
今自分の壁になっている主な違いは...

- アダプターの概念の存在
- ZCMLファイルの存在

この2点です。デザインパターンのアダプターは分かるんです。問題は、Zope3において、どことどこがAdapter,Adapteeの関係になるのか。コンテンツをDublinCoreとして扱うことが出来るのはアダプターが影でゴリゴリやってくれるから、というのは分かる(合ってる?)んですが、今回やりたかったことにアダプターが関係するのかどうかが分からない。多分関係するんだと思うけど。

ということで、やりたかったのは **掲示板の投稿内容をSilverCityでHighlightingする** 事。今回はViewに表示する段階でbodyをSilverCityに渡して変換しましたが、本来はアダプターを介してコンテンツを変換するのが正しいんじゃないかと思っています。そういうアダプターを作れば流用可能だし。これは今後の課題かな。

あとはZCML。何を書くとどことどこが繋がるのか...部分的には分かるけどまだもやもやしてます。どこの名前空間でどのディレクティブを使えるのか、、はディレクティブ定義を探せばいいのか。あとで探してみよう。

.. figure:: images/zope3silvercity/thumb?width=240
  :target: images/zope3silvercity
  :align: left
  :class: visualClear

  とうことで、今回の成果です。
  SilverCityを使ってHighlightingしている状態です。

  この改造をしたファイルも置いておきます。
  `messageboard_step02_silvercity.tgz`__

  .. __: http://www.freia.jp/taka/file/Zope/messageboard_step02_silvercity.tgz

.. class:: visualClear

次回は8/7の予定です。‥‥近いな。


%%%%%%%%%

:id: 232
:date: 2005-07-18 21:14:00
:title: NetDriveというWebDAVをDrive名にマウントするツール
:categories: ['Zope']
:body type: text/x-rst
:body:
会社でSubversionを使っている。というか勝手に使い始めた。で、WebDAV使えば、開発しないけどソースは見たい＆丸ごと取得したい、という用途にピッタリだなーと思いながら `Subversion によるバージョン管理`_ を読んでいたところWindowsのWebフォルダはイケテナイらしいと言うことが分かった。

.. _`Subversion によるバージョン管理`: http://subversion.bluegate.org/doc/book.html



:extend type: text/x-rst
:extend:
.. highlights::

  この問題の回避策として他にもさまざまなうわさがありますが、
  Windows XP のすべてのバージョンとパッチレベルでうまく
  動作するものはなさそうです。私たちのテストでは今示した
  アルゴリズムがどのシステムでも常にうまくいく ように
  思えます。WebDAV コミュニティーの一般的な合意事項として:

  - Webfolder の新しい実装は避けること。古いものを使おう。 

  - Windows XP のファイルシステムレベルのクライアントが
    本当に必要なら、WebDrive か NetDrive を使おう。

  -- `Subversion によるバージョン管理 - Windows Webfolders, WebDrive, Netdrive`_

むむ。 **NetDrive** とな。WebDAVをWindowsのドライブレターにマウントしてくれるとな。これってもしかして、Zopeの ```webdav-source-server``` に利用したら、WebDAVを理解しないエディタ(WZとか)からも編集出来る？

... デキター！

ということで、気になる人は ```NetDrive.exe``` で検索だ。

.. _`Subversion によるバージョン管理 - Windows Webfolders, WebDrive, Netdrive`: http://subversion.bluegate.org/doc/book.html#svn.webdav.clients.windows

追記 7/19
-----------

http://support.microsoft.com/?kbid=287402




:trackbacks:
:trackback id: 2005-11-28.5112182612
:title: FTP を仮想ドライブ化する無料ソフト NetDrive
:blog name: 週刊東京Worker　（東京労働者）
:url: http://tkworker.exblog.jp/3425830
:date: 2005-11-28 00:48:31
:body:


NetDrive

英語が苦手な人は、こっち　＞　清水川ｗｅｂ


他に有料版ソフトとしては WebDrive が有名。
こちらは日本語版もあり、FTP だけでなく WebDAV にも対応している。




:trackbacks:
:trackback id: 2006-05-10.1115514921
:title: Windows/tools/NetDrive
:blog name: Jicoo Corp. PukiWiki plus (PukiWiki/TrackBack 0.3)
:url: http://host4.headoffice.jicoo.co.jp/wiki/index.php?Windows%2Ftools%2FNetDrive
:date: 2006-05-10 13:25:12
:body:
Windows    NetDriveでWebDAVフォルダをマウント    NetDriveでWebDAVフォルダをマウント    MaruhanのM-GISでhalldataサーバをNetDriveでマウントしています http://blog.livedoor.jp/dualcomputer/archives/50255738.html http://www.novell.com/coolsolutions/qna/999....

%%%%%%%%%

:id: 233
:date: 2005-07-18 21:31:30
:title: 水出しコーヒーメーカーを購入
:categories: ['food']
:body type: text/x-rst
:body:
`CoffeeDiary`_ さんのところで紹介されていた水出しコーヒーメーカーを購入しました。ウォータードリッパーが手に入る！と喜んで7/1(プレスリリースに書いてあった発売日)に買いに行って、7月中旬まで出ないという事実に愕然としたのも遙か昔‥‥。

`タイガー魔法瓶 プレスリリース`_ 

とりあえず最初の印象は、 **「電源不要って、水を重力で落としてるだけじゃねーか！」** という感じ。出来たコーヒーがほとんど水、という代物では口も悪くなります。

3回目くらいからだんだんとこつが分かってきて、4回目は結構イケる飲み物になりました。ポイントは

- 粉は作りたい杯数に対して **1.5倍** 必要
- **一度に作る量は4杯分** くらいがよい
- コーヒー粉を **よく** 湿らせる
- 湿らせたコーヒー粉を **押し固めるようにドーム状にする**
- 水滴落下ポイントを **時々変える**

という感じ。

ヨドバシカメラで6,000円台でした。なお、4杯作るのに4時間くらいかかります。

.. _`CoffeeDiary`: http://akiyah.bglb.jp/blog/815
.. _`タイガー魔法瓶 プレスリリース`: http://www.tiger.jp/press_releases/pr_050614_01.html



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5116197919
:title: Re: 水出しコーヒーメーカーを購入
:author: Akiyah
:date: 2005-07-20 09:25:19
:email: mizukoshi@mui.biglobe.ne.jp
:url: http://akiyah.bglb.jp/blog/
:body:
水出しコーヒー、おいしいですよね。
私のうちの水出しシステムは、ゴムの栓のゆるめ具合で水滴を調整するというなかなか難しい仕組みなので、
朝になったら水が残っているのに水滴が止まっていた、なんていう失敗もちょくちょくです。



:comments:
:comment id: 2005-11-28.5117361923
:title: Re: 水出しコーヒーメーカーを購入
:author: 清水川
:date: 2005-07-21 21:53:19
:email: taka@freia.jp
:url: 
:body:
> 水出しコーヒー、おいしいですよね。

こんどは豆の選定に苦労してます(--;
ローストが強い方が良いのかなー‥‥？


:comments:
:comment id: 2005-11-28.5118510654
:title: Re: 水出しコーヒーメーカーを購入
:author: Shigeo Honda
:date: 2005-08-16 14:30:24
:email: lettera@shigeo.net
:url: http://www.shigeo.net
:body:
本多です。ご無沙汰しています。この手の水だしコーヒーを美味しくいただには、

・マンデリンなどの豆を、イタリアンローストなど一番深く焙煎してもらう
・豆はエスプレッソ用に一番細かくひいてもらう

がポイントです。それをギュッつめて、水で少しづつ出すわけです。


:comments:
:comment id: 2005-11-28.5119672771
:title: Re: 水出しコーヒーメーカーを購入
:author: 清水川
:date: 2005-08-16 15:05:31
:email: taka@freia.jp
:url: 
:body:
アドバイスどもです。ロースト強い豆はちょっと苦手なんですが、普通のコーヒー豆だと薄くなっちゃうので、試してみます。
%%%%%%%%%

:id: 234
:date: 2005-07-25 00:10:03
:title: 友人の結婚式に参列
:categories: ['misc']
:body type: text/x-rst
:body:
土曜日に、入社当時からつるんでいる会社同僚の結婚式に参列するため、神戸に行ってきました。新郎新婦とも研修の頃からの知り合いです。

.. figure:: images/20050723manabu
  :align: left
  
  式は神戸の某迎賓館で。とっても良い式でした。




:extend type: text/plain
:extend:
%%%%%%%%%

:id: 235
:date: 2005-07-25 00:41:24
:title: 神戸の帰りに京都に寄る
:categories: ['misc']
:body type: text/x-rst
:body:
神戸に行った帰りに、京都の `天下一品`_ 総本店に寄ってきました。最寄り駅情報と経路検索の結果、とてもひどい事になってしまいました。神戸の三ノ宮から天一最寄りの **茶山** で経路検索をしたところ、::

  三ノ宮→大阪→京橋→(京阪本線)→出町柳→(叡山電鉄)→茶山

という経路になったのでこの経路で移動したわけですが、、、

.. _`天下一品`: http://www.tenkaippin.co.jp/



:extend type: text/x-rst
:extend:
京橋経由で京阪本線なんて使わないで(１時間以上かかった)、普通に京都駅からバスで移動すれば...知らない地方のバスって計画的に乗るのは無理かも。

とは言え、やっぱり京都はバスを中心に考えた方が良いのかもしれません。天一本店行くのに京都駅から徒歩or鉄道は難しいと思った一年間で一番暑い時期の日のこと。こんな日に京都の町をスーツで歩くもんじゃないですね...。

.. figure:: images/kyoto_tenichi1
  :target: images/kyoto_tenichi1
  :width: 240
  :height: 180
  :align: left
  :class: visualClear
  :alt: 本店到着。駅から遠すぎ。

  ということで、道に迷ってナビウォークに案内されつつたどり着いた天下一品総本店。苦労してたどり着いただけあって感無量。というかやけに長い道のりだったような...。駅から1kmあるし...。

.. figure:: images/kyoto_tenichi2
  :target: images/kyoto_tenichi2
  :width: 240
  :height: 180
  :align: left
  :class: visualClear
  :alt: 本店のこってりラーメン。見た目は一緒か..

  肝心の天一本家のラーメンは今まで食べたチェーンよりもやはりうまかったです。なんだろう、コクがあるというか質が違うというか‥‥。これはうまかった。最初ほどの驚きはなかったけど、チェーン店とは一段違う味でした。

.. class:: visualClear

実は、木曜日に水道橋店、金曜日に新宿店で食べたのですが、水道橋店は‥‥しばらく行かないうちに怪しげな食物を客に出すようになったようです。もう行かん。

ということで新評価::

  総本店＞＞八幡山＞神田＞神楽坂＝歌舞伎町＞＞＞水道橋

.. figure:: images/kyoto_inoda
  :target: images/kyoto_inoda
  :width: 240
  :height: 180
  :align: left
  :class: visualClear
  :alt: アラビアの真珠。ミルクを入れた方が旨いコーヒー。

  そして帰りは京都駅地下街の `イノダ`_ で *アラビアの真珠* を一杯。6年くらい前に健と旅行でたまたま寄って以来、京都に来たら必ず寄るお店。おみやげに豆を買うのも忘れずに。


.. _`イノダ`: http://www.inoda-coffee.co.jp/




:comments:
:comment id: 2010-10-27.0877099591
:title: 2010/10/27時点の評価
:author: しみずかわ
:date: 2010-10-27 17:11:30
:email: 
:url: 
:body:
京都総本店＞＞八幡山＞新宿西口＝池袋＝神田＞神楽坂＝歌舞伎町＞＞＞水道橋

「都内では高円寺店と水道橋店が直営店。水道橋店は元本店店長がやってる」という情報ももらったけど水道橋は‥
%%%%%%%%%

:id: 236
:date: 2005-08-03 00:27:00
:title: 銀座 火鍋屋
:categories: ['misc']
:body type: text/x-rst
:body:
昔の同僚と、銀座で豪遊してきました。

‥‥訂正。以前の部署の先輩方と銀座の `火鍋屋`_ で食べ放題2480円でした。

.. figure:: images/ginza_hinabe
  :align: left

  赤い方は唐辛子と山椒たっぷりの見た目ラー油鍋。
  白い方は‥‥なんだろう？辛くはなかったけど。
  ごま油＋刻みニンニク＋塩 のミックスタレがナイス。
  時々、忘れられた肉が赤い方で煮えて、えもいわれぬ辛さに‥‥。
  こんにゃくが凶悪だったな。

.. class:: visualClear

たかいしさん、あべさん、ふじのさん、また東京に来たら声かけてください。

.. _`火鍋屋`: http://r.gnavi.co.jp/g744600/


:extend type: text/plain
:extend:


:comments:
:comment id: 2006-10-12.3062756190
:title: Re:銀座 火鍋屋
:author: しみずかわ
:date: 2006-10-12 16:48:26
:email: 
:url: 
:body:
銀座じゃねえ！赤坂だ！と自分につっこんでおく。orz

%%%%%%%%%

:id: 237
:date: 2005-08-04 20:46:38
:title: 一直線
:categories: ['misc']
:body type: text/plain
:body:
夜暑い
眠れない
クーラー付ける
寒くて夜中に目覚める
クーラー止める
暑くて夜中に目覚める
寝不足になる
体力が回復しない
夏バテる



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5132522457
:title: Re: 一直線
:author: masaru
:date: 2005-08-08 01:13:17
:email: 
:url: 
:body:
あまり地震をもって勧められないのですが
水風呂はいかがでしょうか？
深部体温も下がっていい感じです。


:comments:
:comment id: 2005-11-28.5133665238
:title: Re: 一直線
:author: 清水川
:date: 2005-08-14 11:44:37
:email: taka@freia.jp
:url: 
:body:
水風呂、試してみます。
似たような感じで、クーラーで体を冷やしておいて……というのはやったんですが、寝るときにクーラー切っちゃうと夜中に暑くて目が覚めるようで（苦笑

%%%%%%%%%

:id: 238
:date: 2005-08-29 08:45:14
:title: マンションの総会に初参加
:categories: ['misc']
:body type: text/x-rst
:body:
日曜日にマンションの総会に参加してきました。去年は買った直後に総会があったので、今年が初参加です。

総戸数15戸に対して、参加人数は６人。委任等が５人。ほとんどの時間が会計報告で、あとはゴミの出し方とかをちょっと話し合いました。

……で、何故か次期の理事長になりました。人が少なすぎて選択の余地がないというのがまた何とも。とりあえず理事長権限(そんなモノは無い)でマンション光でも導入してみる？(無理)



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5137580391
:title: Re: マンションの総会に初参加
:author: aihatena
:date: 2005-08-29 09:50:26
:email: 
:url: 
:body:
もう光引いてなかったっけ?


:comments:
:comment id: 2005-11-28.5138710101
:title: Re: マンションの総会に初参加
:author: 清水川
:date: 2005-08-29 10:08:09
:email: taka@freia.jp
:url: 
:body:
引いてないっす。今はCATVなんだけど、夜22時～24時くらいが非常に重い。

でも、15戸だと難しいかも……。提供条件とか同意者数とか。
%%%%%%%%%

:id: 239
:date: 2005-08-29 09:21:38
:title: Zopeイベント ３つ
:categories: ['Zope']
:body type: text/x-rst
:body:
- 9/3(土) `ZopeWeekend6`_
- 9/4(日) `Zope3勉強会`_
- 9/30(金)～10/2(日) `Zope Developers Camp 2005 夏`_

三つとも参加したいところですが、9/30と10/2にどうしてもはずせない用事があり、残念ながら `またしても`__ 現地参加出来ません。

.. __: http://www.freia.jp/taka/blog/155

ということで、今週末はダブルZopeイベントです。 `ZopeWeekend6`_ はまだ参加者募集中ですので、土曜日時間のある方は参加してみてはどうでしょう？CMS入門・事例紹介・Zope3紹介とあり、PloneをSNS風にカスタマイズもあり、Zopeがますます身近になるとおもいます。


.. _`ZopeWeekend6`: http://new.zope.jp/event/zopeweekend/6/
.. _`Zope3勉強会`: http://www.zope.org/Members/yusei/zope3meeting
.. _`Zope Developers Camp 2005 夏`: http://www.coreblog.org/camp/2005s/



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5142848028
:title: Re: Zopeイベント ３つ
:author: masaru
:date: 2005-08-29 10:42:16
:email: 
:url: 
:body:
今週末はハードになりそうですねー
土曜日のZope３の紹介は興味深いところです。


:comments:
:comment id: 2005-11-28.5144007997
:title: Re: Zopeイベント ３つ
:author: 清水川
:date: 2005-08-31 13:11:42
:email: taka@freia.jp
:url: 
:body:
前回Zope3勉強会に参加できなかったので、ついて行けるかどうかの心配も……。予習する時間をなんとか確保しないと……。
%%%%%%%%%

:id: 240
:date: 2005-08-31 12:43:22
:title: 今日はリリース日
:categories: ['work', 'Agile(XP)']
:body type: text/x-rst
:body:
今日は仕事のプロジェクトのリリース日です。イテレーション方式を導入して5回目のイテレーションの終了日なのですが、こんなに穏やかな最終日は初めてかもしれない（笑）。

.. figure:: images/20050831_burndown/thumb?width=320
  :target: images/20050831_burndown

.. class:: visualClear


穏やかと言っても、 バーンダウンチャート [1]_ を見るとそんなに楽なイテレーションだった訳ではないというのが分かりますが。 XPlanner [2]_ を使ってるんですが、深夜0時に前日分のデータを当日の日付でプロットするので、8/31のプロットは「8/31の結果」ではなく「8/31の残量」になっています。

今日はリリース作業も含めて夕方には締められそうなので、打ち上げしようと思いお店に予約を入れてみたり。でも今までリリース日は必ず何かあったので、まだ安心は出来ません……ドキドキ。

--------------

.. [1] 角谷さんがXP祭り2004で発表された `バーンダウンチャートの資料`_ (pdf)
.. [2] XPlanner `本家(英語)`_ , `日本`_

.. _`バーンダウンチャートの資料`: http://www.kakutani.com/articles/XPmatsuri2004-LT.kakutani.pdf
.. _`本家(英語)`: http://www.xplanner.org/
.. _`日本`: http://variousxplanner.sourceforge.jp/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 241
:date: 2005-08-31 13:05:54
:title: 朝起きると台所にゴマが散乱していた
:categories: ['misc']
:body type: text/x-rst
:body:
朝起きると台所の床に白いゴマが散乱していた。冷蔵庫の上に置いてあったゴマの瓶が落ちたみたいなんだけど……昨日深夜に地震でもあったかな？

- 仙台 深夜3時に震度3
- 東京 なし

うーむ...



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5151011443
:title: Re: 朝起きると台所にゴマが散乱していた
:author: aihatena
:date: 2005-08-31 20:02:04
:email: 
:url: 
:body:
リリース完了祈願でごまでもたきましたか。


:comments:
:comment id: 2005-11-28.5152155790
:title: Re: 朝起きると台所にゴマが散乱していた
:author: 清水川
:date: 2005-08-31 23:15:30
:email: taka@freia.jp
:url: 
:body:
護摩ちがう。でも御利益はあったかも。
%%%%%%%%%

:id: 242
:date: 2005-08-31 18:23:42
:title: リリース完了
:categories: ['work']
:body type: text/x-rst
:body:
無事鎮火（リリース）が終わりました。これから宴会してきます。わーい！



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 243
:date: 2005-08-31 23:48:53
:title: 打ち上げ in 刀削麺荘
:categories: ['food']
:body type: text/x-rst
:body:
`刀削麺荘飯田橋店`_ でリリース打ち上げを開催。打ち上げ中に呼び戻されることもなく、無事に打ち上がりました。

.. figure:: http://www.freia.jp/taka/photo/foods/toshomen-so/PICT0072.JPG?size=thumb
  :target: http://www.freia.jp/taka/photo/foods/toshomen-so/PICT0072.JPG/zphoto_view
  :align: left

  刀削麺荘では初挑戦の火鍋。この店の火鍋は `先日のお店`_ のよりも高かったけど、最後に刀削麺を入れて食べるのがおもしろかった。和食の鍋の雑炊みたいなもの？？

  宴席で、「清水川さんのWeb写真は食べ物しかない」と言われたけど、人物写真を載せるのは本人の許可が必要だったりと色々面倒‥‥なんだ自分がものぐさなだけか。

.. class:: visualClear

そして明日からは後始末週間が始まる。文章たくさん書かなきゃ。


.. _`刀削麺荘飯田橋店`: http://r.gnavi.co.jp/g314402/
.. _`先日のお店`: http://www.freia.jp/taka/blog/236



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 244
:date: 2005-09-03 10:50:25
:title: ZopeWeekend6に行ってきます
:categories: ['Zope']
:body type: text/x-rst
:body:
今日は `ZopeWeekend6`_ と `XP祭り2005`_ の日。日がずれていれば両方行きたいところだったけど‥‥。ということで今からZopeWeekend6に行ってきます。


.. _`ZopeWeekend6`: http://new.zope.jp/event/zopeweekend/6/
.. _`XP祭り2005`: http://www.xpjug.org/event/20050903matsuri/


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 245
:date: 2005-09-03 14:13:14
:title: ZopeWeekend6に参加しました
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
`ZopeWeekend6`_ に参加しました。

.. figure:: http://www.freia.jp/taka/photo/zw6/PICT0001.JPG?size=thumb
  :target: http://www.freia.jp/taka/photo/zw6/PICT0001.JPG/zphoto_view
  :align: left

  一応運営側なんですが、今回は `仕事の方でリリース`_ があったり、個人的に色々と忙しかったりと、ほとんど準備に参加できませんでした。次は発表できるネタとか用意したいと思います。

.. figure:: http://www.freia.jp/taka/photo/zw6/PICT0006.JPG?size=thumb
  :target: http://www.freia.jp/taka/photo/zw6/PICT0006.JPG/zphoto_view
  :align: right

  今回の参加者数はスタッフを合わせて50人弱でした。やはり同日開催のXP祭りの影響が少なからず出てしまったようです。

会場はいつもお世話になっている `日本電子専門学校さん`_ です。今回は液晶スクリーンの調子が悪く、１面のみの使用でした。（※後半、写るようになりました）

.. class:: visualClear

ということで、以下感想です。

.. _`ZopeWeekend6`: http://new.zope.jp/event/zopeweekend/6/
.. _`仕事の方でリリース`: http://www.freia.jp/taka/blog/240
.. _`日本電子専門学校さん`: http://www.jec.ac.jp/



:extend type: text/plain
:extend:

プレゼン感想
=============

CMSクラッシュコース
-------------------
JZUG本多さんのCMS紹介。クラッシュコースというのは日本語だと速習とかという意味だそうです。知らなかった。

自分的に感じた話のポイントは、

.. topic:: CMSのメリット

  CMSをコンテンツ管理ツールとして導入するだけで各担当者がコンテンツを作ってワークフローに従ってコンテンツ公開の承認を行うことが出来るので、システム担当者を介さずにフローを流すことが出来る。システム担当者がボトルネックにならない、コストが下がる

……という事ではなく、

.. topic:: CMS導入時に気をつけるべき事

  各担当者の意識を変えることが必須。これまでシステム担当者や広報がやっていた仕事が担当者に降りかかる、と受け取られてしまうと、誰も更新しないWebサイトになってしまう。

という事でした。そういえばZope導入以前にWikiとか掲示板とか置いた事があったけど、ほとんど更新されなかったなぁ...と思ったり。情報共有のためのWeb/CMS導入を草の根的にボトムアップで進めたとしても、それを全体に浸透させるにはそれだけでは難しい訳ですね。


事例紹介:文際アートカレッジ週間bAC
---------------------------------
.. figure:: http://www.freia.jp/taka/photo/zw6/PICT0007.JPG?size=thumb
  :target: http://www.freia.jp/taka/photo/zw6/PICT0007.JPG/zphoto_view
  :align: left

  前回ZopeEssentials2でも発表された永井さんの事例紹介。epozのカスタマイズやArchGenXMLを利用したコンテンツタイプ作成の紹介等、一歩踏み込んだPloneのカスタマイズをされているようです。

  実際のサイト `文際アートカレッジ週間bAC`_ を見ることが出来ますが、今日の発表ではPloneの管理ページを見ることが出来、専門知識が無くてもコンテンツを作ることが出来るように多くの工夫がされていたのが分かります。

.. class:: visualClear

また、組織内に浸透させるために

.. highlights::

  週に一度の活動方向を必ず投稿すること。この投稿を評価に反映する。これをやる気の無いヤツは辞めてもらってもかまわない

というトップダウンの号令を出した、という事に驚きました。しかしこの辺、本多さんの `CMSクラッシュコース`_ を聞いて思ったことに通じてるなぁ。 


Zope3の紹介
------------
ゾープジャパンの柏野さんの発表。

自分は `Zope3勉強会`_ に出ているので大体知っている内容でしたが、会場でZope3にさわっている人はほとんどいないはずなので、難しかったかもしれません。内容はinstallからデフォルトのmanage画面の表示、操作、そして新しいZope3コンポーネント作成の実演、と、Zope2との全レイヤーでの比較が出来る内容でした。……でも、Zope3がZope2より **イイ！** という点が見えにくかったかも。Zope2開発者向けのプレゼンという感じですね。

Zoep3勉強会で分かったことは「Zope3はZope2よりも下位レイヤー部分しか提供されていない、ただし、すごく多機能」という事です。なので、Zope2のZMIみたいなマネージ用のView等を作る事も出来るんじゃないかな。それ自体に意味があるかどうかは別として、そういうのがあってもおかしくない所にZope3のレイヤーがある、とは思います。

ゾープジャパンで `Zope3のトレーニング`_ (3日間)をやるみたいですが、金額が315,000円……参加者どのくらいいるんだろう？


PloneをSNS風味にカスタマイズ
-----------------------------
.. figure:: http://www.freia.jp/taka/photo/zw6/PICT0009.JPG?size=thumb
  :target: http://www.freia.jp/taka/photo/zw6/PICT0009.JPG/zphoto_view
  :align: right

`COREBlogオフ会`_ でお会いした `鈴木たかのりさん`_ の発表。 `Plone S5`_ での発表でした。やー、PloneのプレゼンをPloneでやる。いいですね～ :-)

発表資料は全てWebコンテンツとして、たかのりさんのサイト `takanory.net`_ で公開されています。

中でも気になったのは、ploneのユーザーデータをデータベースに入れて、ユーザー検索でDBに問い合わせている所です。「もしかしてユーザーアカウントをDBに登録しているのかっ！」と思ったのですが、プロフィールが更新されるタイミングでデータをDBに **も** 保存しているという事でした。

導入に際しては、トップダウンの号令があったわけでない、というのが永井さんの発表と異なる点で、まずはアカウントをばらまいて情報発信をしたい人から順に使っているという事でした。
あくまで、書かされるのではなく自分から情報を発信する、そういう情報発信が最終的にSNSになるのを手助けするための仕組みを用意したい、という印象を受けました。



懇親会
=======

懇親会は座和民という西新宿のお店。参加人数は19人。前回利用したプロジェクター付きの
お店は閉店してしまったという事で、とても残念です。LightningTalk in 懇親会 が出来なかった……。
と言っても、今あるのはwxPythonとtkinterの比較ネタだけなんですが。

懇親会で何度かとまどったのは、どうも自分がZopeの有名な人という事になっているらしいという事。
ううむ、調べたことを自分で忘れないようにメモしたものをWebに載せてると有名になれる……ということか。
ただし、名前が広がってても、どのくらい実が伴ってるのかは別かも。
自分が書いたことの中に、先人の情報と同じ事を書いてることも多々あるし。
それでも書いて掲載するのは未来の自分に対する情報発信という意味と、事例が増えて困ることは
無いんじゃないかな、と思うから、かな。まー、書いてる途中で同様の例を見つけたからと言って
文章を捨てるのももったいないし。なんていう話をしてきました。

その後は2次会で同じく西新宿のJiggerBarへ。1次会が17:30開始だっただけあって、2次会は20時から。早いなぁ。

*#懇親会の写真は、カメラの調子が悪くて撮れませんでした...*

.. _`文際アートカレッジ週間bAC`: http://weekly.bac.ne.jp/
.. _`COREBlogオフ会`: http://www.freia.jp/taka/blog/208
.. _`鈴木たかのりさん`: http://takanory.net/
.. _`Zope3勉強会`: http://www.zope.org/Members/yusei/zope3meeting
.. _`Zope3のトレーニング`: http://www.zope.co.jp/workshop/
.. _`Plone S5`: http://takanory.net/plone/products/plones5
.. _`takanory.net`: http://takanory.net/plone/sns/


%%%%%%%%%

:id: 246
:date: 2005-09-04 18:11:05
:title: Zope3勉強会 第6回
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope3勉強会(第6回)に参加してきました。前回8/7は参加できなかったので、記憶が……(笑)

以下、参加メモです。



:extend type: text/plain
:extend:
今日読んだChapter
------------------

- 17

  - コンテナの中身のサイズを取得するAdapterの作成とZCMLへの登録
  - ISizedインターフェースを実装したら、デフォルトのZope3のスキンへの表示が
    変わった。

- 18

  - 国際化(i18n)
  - poファイルをmsgfmtでmoに変更
  - さっそくmessageboardのpoファイルを翻訳してみた

- 19

  - Event,Subscription,Annotation
  - Zope3のオブジェクトはセキュリティークラスでラッピングされている


API Doc について
-----------------

登録したProductのInterfaceやAdapterが自動的にAPIDocに登録・表示される。どのコンテンツがどのInterfaceを実装しているか、どのAdapterを使えるか、という情報が自動的にドキュメント化されるので、誰かが作ったプロダクトの関連プロダクト(やAdapter)を作るときに構成を調べやすい。



%%%%%%%%%

:id: 247
:date: 2005-09-06 15:08:27
:title: Ploneのワークフローでメール通知する
:categories: ['Plone']
:body type: text/x-rst
:body:
`ryouseiさんの資料`_ を横目で見つつ、 `[zope-users:04900] [Q] customize workflow with script`_ を参考にしながら作ってみました。
それにしても、スクリプトが受け取る引数の型がStateChangeInfoだとか、StateChangeInfo.objectが対象ページのインスタンスだとか、どうやって知るんだろう？自分は前述の資料とgrepで知りました。

以下、とりあえず動くスクリプトです。

.. _`[zope-users:04900] [Q] customize workflow with script`: http://ml.zope.jp/pipermail/zope-users/2004-May/004712.html
.. _`ryouseiさんの資料`: http://www.plone.jp/Members/ryousei/




:extend type: text/x-rst
:extend:
emailモジュールを使っているので、Script(Python)で使えるようにしておく必要があります。

.. code-block:: Python

  ## Script (Python) "mail_notify"
  ##bind container=container
  ##bind context=context
  ##bind namespace=
  ##bind script=script
  ##bind subpath=traverse_subpath
  ##parameters=sci
  ##title=
  ##
  try:
      mail = container.MailHost

      hist = sci.getHistory()
      hist = hist[-1]
      obj = sci.object

      data = []
      data.append( "URL: " + obj.absolute_url() )
      data.append( "Date: " + str(sci.getDateTime()) )
      data.append( "Actor: " + hist['actor'])
      data.append( "Title: " + obj.title_or_id() )
      data.append( "Desc: " + obj.Description() )


      data = '\n'.join(data)

      from email.Header import Header
      title = Header(unicode(obj.title_or_id(),'utf-8').encode('iso-2022-jp','replace'), 'iso-2022-jp')

      msg = """\
  From: test@example.com
  To: test@example.com
  Subject: published: %s
  Content-Type: text/plain; charset="iso-2022-jp"

  Page published.

  %s
  """ % (title, data)

      msg = unicode(msg,'utf-8').encode('iso-2022-jp','replace')
      mail.send(msg)

  except:
      pass



%%%%%%%%%

:id: 248
:date: 2005-09-11 17:59:05
:title: 新しいノートPC購入 (IBM X40 2371-K9J)
:categories: ['misc']
:body type: text/x-rst
:body:
今まで使っていた ```東芝 Dynabook SS 3380``` (1999年購入) にさすがに限界を感じ、新しいノートPCを購入しました。購入時のポイントは

- TrackPoint,UltraPoint,AcuPointであること。スライドパッド却下。
- 軽いこと。1.2kgくらい。
- プレゼンに利用できること(外部出力や解像度)

ほかに無線LAN内蔵とかありますが、上記は買ってからではどうにもならないので優先事項でした。って、スライドパッドを避けた時点でIBMかLibrettoくらいしか残りませんでしたが、Librettoは画面表示が細かすぎたのとキーボードのピッチが細かすぎたので落選です。




:extend type: text/x-rst
:extend:
あとはIBM製品の中での比較でしたが、熱と重さを重視して比較しました。

========== ======== =====================
種類       重さ(kg) 熱(特にパームレスト)
---------- -------- ---------------------
X41        1.27     熱い
X41 Tablet 1.88     熱い？(未体験)
X40        1.26     温かい
X31,X32    1.66     冷たい
========== ======== =====================

X41 Tabletは最後まで悩みましたが、重い・熱い・高い、という事で断念。最終的にはX40に決定しました。会社で何度かX40を使っていたというのもあります。X41の熱については店頭でさわっただけなので、もしかしたら許容範囲だったのかもしれず。

ということで、６年ぶりのノートPC買い換えでスペックはかなり上がりました。

======= ===================== ======================
機種    IBM X40 2371K9J       東芝 Dynabook SS 3380 
------- --------------------- ----------------------
CPU     Pentium M 758(1.5GHz) Pentium II 400MHz
MEM     DDR SDRAM 1.5GB       SIMM 192MB
HDD     Ultra ATA100 40GB     Ultra DMA 8GB
重さ    1.26kg                1.34kg
Video   32MB DirectX9対応     2.5MB
有線LAN 1000Base-T            なし
無線LAN 802.11a/b/g           なし
RGB出力 あり                  なし
======= ===================== ======================

ちなみに、ニッシンパルで159,000円(9/8時点)でした。




:comments:
:comment id: 2005-11-28.5174569099
:title: Re: 新しいノートPC購入 (IBM X40 2371-K9J)
:author: masaru
:date: 2005-09-12 17:05:02
:email: 
:url: 
:body:
くるっと回るタイプではないんですね。（見てみたかったです）


:comments:
:comment id: 2005-11-28.5175714403
:title: Re: 新しいノートPC購入 (IBM X40 2371-K9J)
:author: 清水川
:date: 2005-09-12 20:10:06
:email: taka@freia.jp
:url: 
:body:
> 見てみたかったです

自分も見てみたかったです(笑)
でも、見て触ってたら機能比較関係なしに買ってたかも...



:comments:
:comment id: 2005-11-28.5176858481
:title: Re: 新しいノートPC購入 (IBM X40 2371-K9J)
:author: dfm
:date: 2005-09-17 00:23:57
:email: 
:url: 
:body:
>DDR SDRAM 1.5GB
HDDとして使えるじゃないですか。昔なつかしのRAM-DISKでも作って遊んでみたら?



:comments:
:comment id: 2005-11-28.5178015136
:title: Re: 新しいノートPC購入 (IBM X40 2371-K9J)
:author: 清水川
:date: 2005-09-17 02:10:19
:email: 
:url: 
:body:
実は前のノートの時にHDDがあまりにも遅かったので、VisualStudioのビルドの中間ファイル生成用にRAM-DISK作ってました。192MBしかないのに‥‥。

実際、32MBくらいRAM-DISKにして、VisualStudio.NET 2003を動かしてDirectXなゲームのビルドをやってたんだからびっくりですわ‥‥。
%%%%%%%%%

:id: 249
:date: 2005-09-11 20:00:44
:title: IBM X40 を英語キーボードに換装
:categories: ['misc']
:body type: text/x-rst
:body:
価格.comの掲示板で秋葉館に売っていることを知り、ノートPC本体よりも先に買ってきました。外箱無し9,800円。プラスチックのカゴにあと10枚以上はざくざくと刺さってた(9/5時点)。

木曜にノートPCも無事入手したので、電源投入より先に換装しました。本体に初期不良があったら問題になりそうですが、キット大丈夫。




:extend type: text/x-rst
:extend:
.. figure:: images/ibm_x40_101key/thumb?width=240
  :target: images/ibm_x40_101key
  :align: left

  無事乗っかりました。特に難しいことはなく、裏面のキーボードマークの付いたネジを全部外してから、キーボードをヒンジの方にスライドさせるだけではずれました。あとは持ち上げてハーネスを外して、英語キーボードを逆の手順で元に戻して交換完了。

  広いスペースバー。うっとり……。

  交換してから気づいたんですが、自分はWindowsキーとアプリキーを結構多用するので、106キーボードの時(会社のX31)は無変換キーとか変換キーとかに割り当てていたのでした。英語キーボードの場合は……どうしよう？とりあえず右のCTRLをアプリキーに、ALTをWindowsキーにして運用してみる事に。

.. figure:: images/ibm_x40_license/thumb?width=240
  :target: images/ibm_x40_license
  :align: left
  :class: visualClear

  電源を投入したところ、本体・キーボードとも無事に使用できました。写真は初回起動時に表示されたライセンス条項の画面です。なにやらIBMとレノヴォの名前が両方とも表示されてますが、とりあえず気にしにないことに。あ、パームレストや背面のロゴはIBMでした（そりゃそうか）。

.. class:: visualClear

次はPythonやらZope2,3やらの環境構築です。




:comments:
:comment id: 2005-11-28.5182194653
:title: Re: IBM X40 を英語キーボードに換装
:author: waraq
:date: 2005-09-20 12:58:54
:email: waraq@t.vodafone.ne.jp
:url: 
:body:
新品キーボードいいなぁ・・・。
英語キーボードの方が外観すっきりしていて、よさげですね。
自分のX40もそろそろキーボードへたってきたので、交換にチャレンジしてみます(´･ω･`)ノ


:comments:
:comment id: 2005-11-28.5183345958
:title: Re: IBM X40 を英語キーボードに換装
:author: 清水川
:date: 2005-10-02 19:55:44
:email: 
:url: 
:body:
> 自分のX40もそろそろキーボードへたってきたので、
> 交換にチャレンジしてみます(´･ω･`)ノ

交換は簡単ですが、日本語キーボードの入手が難しいのではないかと‥‥。IBM（レノボ？）で売ってくれるのかな？

%%%%%%%%%

:id: 250
:date: 2005-09-12 22:38:08
:title: WindowsでFreeなCモジュールビルド環境 for Python
:categories: ['python', 'Windows']
:body type: text/x-rst
:body:
前々から出来るんじゃないかな、と思いつつまとめきれていなかったネタをまとめました。Windows用のPython拡張モジュールをC言語で書いて、これを無料な環境でビルドします。

- `WindowsでFreeなCモジュールビルド環境`__

.. __: http://www.freia.jp/taka/memo/freevcbuild/

でも一番時間がかかったのはDOS窓風のスタイルシートを書くことだったりします。

こんな風に書きます::

  .. topic:: こんなの
    :class: dos

    C:\\> こんなかんじ。reStructuredTextのtopicディレクティブとCSSを組み合わせました。

.. topic:: こんなの
  :class: dos

  C:\\> こんなかんじ。reStructuredTextのtopicディレクティブとCSSを組み合わせました。


:extend type: text/plain
:extend:
%%%%%%%%%

:id: 251
:date: 2005-10-04 21:27:56
:title: FamiComBand
:categories: ['Event']
:body type: text/x-rst
:body:
知り合いのバンド(FamiComBand)が今週末日曜日に演奏するそーなので、ご紹介。

http://famicomband.org/live_7th

.. topic:: 演奏曲目

  - 一面： オホーツクに消ゆ（完全版）、任天堂メドレー
  - 二面： 魔界村、バンダイメドレー2005、エレベーターアクション、ルート１６ターボ、他
  - 三面： 信長の野望、ドラゴンクエストV～天空の花嫁


面って‥‥。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5196686432
:title: Re: FamiComBand
:author: かけだ
:date: 2005-10-05 16:44:28
:email: 
:url: 
:body:
うわぁ～、オホーツクに消ゆ、LPもってましたわ！！


:comments:
:comment id: 2005-11-28.5197841382
:title: Re: FamiComBand
:author: しみずかわ
:date: 2005-10-05 19:11:38
:email: 
:url: 
:body:
オホーツクに消ゆ、PC98版持ってました(笑
%%%%%%%%%

:id: 252
:date: 2005-10-04 22:15:00
:title: 日本語キーボードから英語キーボードへ
:categories: ['Windows']
:body type: text/x-rst
:body:
自分は英語キーボード好き（スペースバーが長いあたりが）なのですが、最初は日本語キーボードなんだけど途中から英語キーボードを使う、という事がよくあります。

で、こういうときに起きるのが、 **キーボードの刻印と実際の入力が異なる** という現象。よく目にする対応策は大体が

- ドライバを日本語(106)キーボードから英語(101)キーボード用に変更する

という感じ。しかも自分の場合はこれじゃあ治らないことが多い。しょうがないので、レジストリを書き換えたり日本語入力をATOK/MS-IME/EN等と変えてみたりと色々といじってみたので、とりあえず分かった事をまとめてみる。



:extend type: text/x-rst
:extend:
- 今回の前提

  - USBキーボードを使っている
  - WindowsXPセットアップ時に「106/109キーボード」を選択した
  - 英語キーボードが日本語レイアウトで認識されている
  - ATOKを使っている

- 現象

  - MS-IMEは英語レイアウトを適用してくれる
  - ATOK17は日本語レイアウトを適用してくれやがる
  - 入力言語設定でENを使うと英語レイアウトになる(日本語入力不可)

つまり、ATOKが悪い‥‥の？どっちかっていうと、OSセットアップ時に106選んじゃったのが悪いんだと思いたい。でも変更方法が分からない。

とここで、とみた先生からそのものズバリな情報が寄せられた。

- `はてな windowsの入力が変です。`__

.. __: http://www.hatena.ne.jp/1120485462

ポイントだけ抜き出すと、

.. highlights::

  ``HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\i8042prt\Parameters`` の ``LayerDriver JPN`` の値を106とか101とかに適切に書き換える。

という単純明快な回答になる。近くに似たような値のキーがあったので、 ``OverrideKeyboardIdentifier`` も書き換えて再起動したところ、見事、英語キーボードが英語レイアウトで使えました。

しかし、コレ知らないと `OS入れ直すしかない`__ というのはどうにかならないものか。コンパネのキーボードの所で設定できるようにするのは簡単だと思うんだけどなあ‥‥＞Microsoft様。

.. __: http://k-tai.impress.co.jp/cda/article/stapa/18258.html


2011/10/11追記
==========================

Microsoftのサイトにいつのまにか詳細な解説が載ってました。相変わらずレジストリ変更が必要だけど、情報があるのはいいね！ MS +1

`コンピューターに USB キーボードを接続したときに Windows Vista で正しいキーボード レイアウトが使用されないことがある`__
(文書番号: 927824 - 最終更新日: 2009年11月13日)

.. __: http://support.microsoft.com/kb/927824/ja


:comments:
:comment id: 2007-02-23.1623105743
:title: Re:日本語キーボードから英語キーボードへ
:author: ふー
:date: 2007-02-23 23:49:23
:email: spn859m9@aria.ocn.ne.jp
:url: 
:body:
大変助かりました。英語版のＷｉｎＸＰを入れたらキーボードの刻印と実際の入力が異なり困りましたが、HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\i8042prt\Parameters の LayerDriver JPN の値を101にするだけで見事になおりました。
清水へこころより感謝いたします。

:comments:
:comment id: 2010-07-15.8216359478
:title: Re:日本語キーボードから英語キーボードへ
:author: TAZO
:date: 2010-07-15 14:13:42
:email: 
:url: 
:body:
別の日本語キーボードをさしたりUSBやらPS2やら切り替えていた長年の問題が解決しました。
101キーボードを常用している身としては大変助かりました。感謝です。

:trackbacks:
:trackback id: 2006-04-30.4959006564
:title: 日本語キーボードから英語キーボードへ — 清水川Web
:blog name: 白い狼の皮を被った黒い羊
:url: http://herd.txt-nifty.com/blacksheep/2006/04/_web_a00c.html
:date: 2006-04-30 16:34:56
:body:
莉･蜑阪％縺薙〒繧よ嶌縺※縺◆縲∵律譛ｬ隱槭Ξ繧､繧｢繧ｦ繝医Keyboard縺九ｉ縲∬恭隱槭Ξ繧､繧｢繧ｦ繝医↓

%%%%%%%%%

:id: 253
:date: 2005-10-04 22:54:43
:title: メール環境をKCOMからGMailへ
:categories: ['IT-PC']
:body type: text/x-rst
:body:
昨日(10/3)正午で `KCOMのサービスが終了してしまった`_ ため、長年使ってきたメールアドレスが変わりました。移行先はgoogleの無料メールサービスGMail。

サービス終了の1週間前から、あちこちのアドレス登録を変更したりしましたが、多分まだいくつか移行忘れてます。‥‥ま、いいか。

使い勝手ですが、プライベートなメールについてはWeb上の操作で大体の目的を果たすことが出来るので、クライアントいらないかな？ともちょっとだけ思いましたが、POP(over SSL)サービスを使って今まで通りWZMail5で送受信もしてます（WZMail5はSSL非対応なので、 `Stunnel`_ を併用）。

GMailの問題点は、サイトが基本的にAJAXで作られているので、ブラウザの「戻る」とかを押して操作不能になったりする事か（笑）。

ま、しばらく使ってみようと思います。

.. _`KCOMのサービスが終了してしまった`: http://www.freia.jp/taka/blog/78
.. _`Stunnel`: http://stunnel.threechan.jp/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 254
:date: 2005-10-05 19:09:50
:title: Appleストア銀座でZopeイベント
:categories: ['Event', 'Zope']
:body type: text/x-rst
:body:
.. figure:: images/applezope1/thumb?width=320
  :target: images/applezope1/thumb?width=800
  :align: right

  今日はApple銀座でZopeイベントをやってます。
  写真は会場(3Fのシアタールーム)の様子で、
  お客さんは大体30人くらいです。

  自分はMacを持っていませんが、とりあえず先日買った
  iPod nano を見せて入室しました(嘘)。


追記
------

.. figure:: images/ginzasuisan/thumb?width=80
  :target: images/ginzasuisan
  :align: left

  その後、銀座の某所で晩ご飯を食べました。
  銀座にあるのに高くない。一品平均280円。
  というか銀座でもこの値段で儲けが出るんだ‥‥。

.. class: visualClear



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 255
:date: 2005-10-10 12:45:08
:title: 風邪
:categories: ['misc']
:body type: text/x-rst
:body:
三連休、風邪ひいてどこにも行けそうにありません。昨日行こうと思っていたFamiComBandも行けなかったし。今日のZope3勉強会もお休みします。

原因は連休１日目に明け方まで、「良いプログラマを増やすにはどうすればいいか」とかについて、とみたと議論していたせいです。間違いない。




:extend type: text/plain
:extend:
以下、独り言というか議論まとめというか。

良いプログラマを増やすには、とりあえず、小学生の将来の夢に「プログラマーになる」とかが出てこないとだめだろう、と。

スポーツ選手とか飛行機・電車とかと違って目に見えないので難しいのかもしれないけど、簡単なゲーム作成くらいなら小中学生でも出来そうだよなあ、とか。情報系の大学1年の授業でforループの勉強してるようでは遅い‥‥？でも医者とかは大学入ってからだろうし。インターン制度とかいいよね。あとは「ほっといたらプログラマーにならない人」にその方向の道があることを知らせるための見える化が必要か。医者は見えるしなあ。

医者育成モデルを参考にプログラマ(IT技術者でもいいや)育成モデルを作ってみるといいのかも。どうですか？＞母校

# やっぱり目に見えないのが一番の問題...

%%%%%%%%%

:id: 256
:date: 2005-10-11 23:00:34
:title: COREBlog1.2.1がリリース
:categories: ['Zope']
:body type: text/x-rst
:body:
`COREBlog1.2.1`_ がリリースされました。今回のリリースを境にメンテナンスモードに入ると言うことで、これまでの延長線上での機能追加はこれが最後になるようです。

ということで、さっそく今回のリリースで追加された **コメントやトラックバックの追加前にフックメソッドを呼び出す** 機能を使ってみました。


.. _`COREBlog1.2.1`: http://www.zope.org/Members/ats/COREBlog



:extend type: text/plain
:extend:
コメント追加前に *コメントスパム* の可能性があるかどうかをチェックして、
可能性がある場合は *要モデレート* 状態にします。

.. image:: images/coreblog_buzzwords/thumb?width=200
  :target: images/coreblog_buzzwords
  :align: right

今回はとりあえずNGワードを含む投稿をチェックすることにします。
まず、 COREBlogインスタンスのmethodsフォルダ(以下blog/methods)のプロパティーに
``buzz_words`` という名前のプロパティーを ``lines`` 型で追加します。
そして、プロパティーの値として行単位でNGワードを追加します。

自分は最初はpoker等を対象にしていたのですが、最近はきりがなくなってきたので ``href``
をNGワードにしてしまいました。

次に、以下のPythonスクリプトを ``beforeAddComment`` という名前で blog/methods
フォルダに追加します。

.. code-block:: Python

    ## Script (Python) "beforeAddComment"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind subpath=traverse_subpath
    ##parameters=d
    ##title=
    ##
    try:
        if not d["moderated"]:
            return d

        buzz_words = container.getProperty("buzz_words")
        s = str(d).lower()
        for w in buzz_words:
            if s.find(w) >= 0:
                d["moderated"] = 0
                break
        else:
            d["moderated"] = 1
    
    except:
        pass
    
    return d

このへんのコードは `lirisさんの記事`_ から頂いたものをCOREBlog1.2.1用に軽く修正
しています。ありがとうございます。

同様に ``beforAddTrackback`` というスクリプトを用意すれば同じ事が出来ます。


.. figure:: images/coreblog_spams/thumb?width=200
  :target: images/coreblog_spams
  :align: left

  結果、こんな感じでコメントスパムがフィルタリングされています。
  チェックの付いていないやつがフィルタされたスパムです。
  
  ‥‥大杉。今日だけでコメントスパム投稿数 **100件** って何？

.. class:: visualClear

.

.. _`lirisさんの記事`: http://www.liris.org/blog/626/





:comments:
:comment id: 2005-11-28.5215125905
:title: Re: COREBlog1.2.1がリリース
:author: setomits
:date: 2005-10-12 10:59:37
:email: 
:url: 
:body:
なるほど、 beforeAddComment はこうやって使うんですね。参考にさせてもらいます。

ところで d["moderated"] = 1 のとこの else のブロックのインデントがひとつ左にずれて見えるのは Safari だからかしらん。


:comments:
:comment id: 2005-11-28.5216275155
:title: Re: COREBlog1.2.1がリリース
:author: 清水川
:date: 2005-10-12 12:03:08
:email: 
:url: 
:body:
> ところで d["moderated"] = 1 のとこの else のブロックのインデントがひとつ左にずれて見えるのは Safari だからかしらん。

いえ、これはfor文に対するelseです。つまりfor文が回りきった場合のみ実行されてます。

でもよく考えるとbuzz_wordsに引っかからなかったら *放置* するのが正しい動作のような気が...。結果としてはelse節は無くても動作は同じですね(;-;



:comments:
:comment id: 2005-11-28.5217421897
:title: Re: COREBlog1.2.1がリリース
:author: setomits
:date: 2005-10-12 14:17:03
:email: 
:url: 
:body:
なるほど。
にあるあたりですね。
これまでこういう else の使い方をしたことがなかったので、ちょっとびっくりしました。


:comments:
:comment id: 2005-11-28.5218594889
:title: Re: COREBlog1.2.1がリリース
:author: shin
:date: 2005-10-13 12:49:10
:email: 
:url: 
:body:
はじめまして、shinと申します。plonifiedについて質問です。
COREBlog1.2 / COREBlog1.2.1 で
スキンをplonifiedに変更すると、
There is no setting in this skin.  
確認すると、
Site Error
An error was encountered while publishing this resource. 
のエラーで、plonifiedスキン利用出来ないのですが。なぜでしょう。
defaultのスキンは、適用されます。

Apache/2.0.54 (Win32) DAV/2 mod_autoindex_color mod_ssl/2.0.54 OpenSSL/0.9.8 mod_jk2/2.0.4 PHP/5.0.4 SVN/1.2.3

Apache / zope 連携

Ploneバージョン概要
Plone 2.1, 
Zope (Zope 2.7.7-final, python 2.3.5, win32), 

以上の件、宜しくお願い致します。










:comments:
:comment id: 2005-11-28.5219769054
:title: Re: COREBlog1.2.1がリリース
:author: 清水川
:date: 2005-10-13 15:10:03
:email: 
:url: 
:body:
plonifiedに変更したときに
  「スキンの設定を編集してください。'(Blogのタイトル)'.」
  There is no setting in this skin. 
と表示されるのは、plonifiedのskinに設定項目が無いためです。viewで表示すればちゃんとPloneに統合されて表示されませんか？

表示されずに、後半にかかれているようなエラーが起きるのであれば、、、ちょっとわかりません。そこから先はここよりも、COREBlogかZopeのMLで聞かれるのが近道かも。



:trackbacks:
:trackback id: 2005-11-28.5220920963
:title: コメントスパム弾き実験のまとめ
:blog name: blogSetomits
:url: http://matatabi.homeip.net/blog/setomits/476
:date: 2005-11-28 00:48:42
:body:
これまで3度に渡って実験してきたコメントスパム弾き実験をまとめます。
基本的には JavaScript
を無効にしている人にとっては、一旦有効にしてからリロードして...とめんどいし、そのハンドリングを考えるとめんどいので却下。
具体的には時刻情報を埋め込んで、POSTされるときの時刻から許容できるずれ幅を超えていたらはねて...
%%%%%%%%%

:id: 257
:date: 2005-10-12 00:09:04
:title: コメントスパム削除対策（後ろ向き）
:categories: ['Zope']
:body type: text/x-rst
:body:
あまりにもコメントスパムが多いので、手動で削除するのは馬鹿らしくなってきました。
多いときは10分で20投稿くらいされてしまったりします。今日は3時間で100件きました。
しかもアクセス元IPが毎回変わっているのがタチが悪い。

対策としては、setomitsさんが `コメントスパム弾き実験 3`_ で書かれているような、 **投稿させない** 対策と、 `一つ前の記事`_ で書いたような、 **疑わしい投稿をチェックする** 対策が考えられます。

`COREBlog1.2.1`_ の機能でフィルタリングは出来たので、フィルタされた投稿を元に、投稿させない方法を考えてみたいと思います。


.. _`コメントスパム弾き実験 3`: http://matatabi.homeip.net/blog/setomits/473
.. _`一つ前の記事`: http://www.freia.jp/taka/blog/256
.. _`COREBlog1.2.1`: http://www.zope.org/Members/ats/COREBlog



:extend type: text/x-rst
:extend:
とりあえずは投稿されてしまったスパムを一覧化して、傾向を調べたり、削除したり、誤って非表示になってしまったものを表示しにたりするツールを作ってみました。最終的に全部削除するにしても、ZMIでエントリを一つ一つ回って歩きたくないし。

download: `COREBlogModerates-0.1`_ (for COREBlog1.2.1)

作ったと言っても、とりあえず自分が必要そうな機能だけなので、COREBlogにパッチが必要だったり、インストールが面倒だったりします。あとかじりかけのJavaScriptなんかも使って遊んでます。

.. figure:: images/coreblog_moderates01/thumb?width=320
  :target: images/coreblog_moderates01

  画面はこんな感じ。これだとスパムの傾向を分析しにくい、というか出来ないですが、
  とりあえず一括削除くらいは出来ます。


.. _`COREBlogModerates-0.1`: http://www.freia.jp/taka/file/Zope/COREBlogModerates-0.1.tgz/file_view




%%%%%%%%%

:id: 258
:date: 2005-10-14 01:54:37
:title: Googleの「Personalize your Google homepage」を使う
:categories: ['IT-PC']
:body type: text/x-rst
:body:
.. figure:: images/google_personal/thumb?width=200
  :target: images/google_personal
  :align: right

  Googleの `Personalize your Google homepage`_ を試しています。きっかけは、自宅MainPC・ノートPC・会社とローカルなRSSリーダーを使っていると同期がめんどくさかったためです。

  用途は主にRSSチェックなので、 `GoogleのRSSリーダー`_ 使え、という話もありますが、GMailのチェックとBookmarkの管理が同時に出来るので便利かなと思って試しています。おまけで検索語の履歴も表示されるのが微妙に便利かも。

  それにしても、ブラウザ上のGUI操作でここまで出来てしまうと、今後のWebアプリに求められる水準が大きく変わりそうな気もします。というか間違いなく変わるか。

  ということでAJAXを使えるようになるために、まずはJavaScriptの勉強から始めてみます(遅

  ところでこのGoogleのサービス、Operaだとうまく動かない事が多いので、しばらくFirefoxで生活してみることに。がんばれOpera。

.. _`Personalize your Google homepage`: http://www.google.com/ig
.. _`GoogleのRSSリーダー`: http://www.google.com/reader/things/intro



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 259
:date: 2005-10-15 01:14:58
:title: mixiの新着情報をRSSで取得
:categories: ['IT-PC']
:body type: text/x-rst
:body:
昨日の `Googleの「Personalize your Google homepage」を使う`_ で、RSSをチェックしてると書きましたが、ついでにmixiの新着情報もRSSで取得しています。取得には `プチツール - mixipress`_ を使わせてもらいました。

mixipressには ``WWW:Mixi`` と ``HTML:Template`` が同梱されていますが、LWP::Debugが見つからないとか言われてなんかうまく動かなかったので、portsの ``p5-WWW-Mixi-0.33`` と ``p5-HTML-Template-2.7_1`` を入れてそっちを使うようにしたところ、日記取得以外はうまく動いてくれたようです。

しかし...


.. _`Googleの「Personalize your Google homepage」を使う`: http://www.freia.jp/taka/blog/258
.. _`プチツール - mixipress`: http://www.iburiworks.com/petittools/mixipress.html



:extend type: text/plain
:extend:
ここで問題が。

ふつうのRSSリーダーであれば問題にならなかったのかもしれませんが、Googleパーソナライズドホームは各RSSにつき最大7件までしかitemを表示してくれません。そして、このツールの生成するRSSのitemが時間順にソートされていない事もあり(日記・コミュニティー・...等グループ毎には時間順にソートされてる)、ちょっと微妙な感じになってました。

つまり、

- 友達の日記1の更新
- 友達の日記2の更新
- 友達の日記3の更新
- 友達の日記4の更新
- 友達の日記5の更新
- コミュニティー1の更新
- コミュニティー2の更新
- コミュニティー3の更新
- コミュニティー4の更新
- コミュニティー5の更新

とRSSデータのitemエントリが並んでいると、仮に ``友達の日記1の更新`` の更新時刻より ``コミュニティー1の更新`` の更新時刻の方が新しくてもGoogleのページには6番目に表示されます。

今回はGoogleで使うことが目的なので、カテゴリ単位のソートではなくitem全体をソートするようにfeed.cgiを書き換えてみました。

‥‥Perlはよくわからんとです。 `feed.cgi 0.31(全体sort版)`_

主な変更点は

- itemをXML全体で時刻順にソート
- WWW:Mixi(0.33)に合わせてコードを変更
- titleを ``カテゴリ名[名前]タイトル`` で整形

です。まー用途が特殊なんで自分以外使う人はいないと思うけど、使う場合は自己責任でお願いします。

.. _`feed.cgi 0.31(全体sort版)`: file/feed.cgi/file_view


%%%%%%%%%

:id: 260
:date: 2005-10-15 01:21:00
:title: mixiの新着情報をRSSで取れない
:categories: ['IT-PC']
:body type: text/x-rst
:body:
mixiの新機能搭載のためHTMLが変わったらしく、RSS取得がうまくいかなくなってしまった(涙

blog書いたばっかりなのに‥‥

これはWWW:Mixiの改造が必要かな。またPerl書かないといけないのか。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 261
:date: 2005-10-18 21:02:27
:title: mixiの新着情報をRSSで取れた
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`WWW:Mixiの0.40`_ で「mixiの新機能対応HTML」に対応したらしく、正常に取れるようになりました。でも代わりにデバッグ文がコメントアウトされてない問題が。 `0.41`_ で直ってました。更新早いなあ。

今回のmixi側の変更に対応するために、自分でもMixi.pmの中身をいじったけど、mixiのHTMLって解析するの大変だなあ‥‥。アトリビュートのダブルクォートがあったりなかったりするので、マッチさせるための正規表現全部がそういったことを考慮しないといけないとは‥‥。

.. _`WWW:Mixiの0.40`: http://search.cpan.org/~tsukamoto/WWW-Mixi-0.40/

.. _`0.41`: http://search.cpan.org/~tsukamoto/WWW-Mixi-0.41/



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 262
:date: 2005-10-18 21:35:00
:title: Zopeから既存のCGIを動かす方法って？
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
`mixiの新着情報をRSSで取得`_ で使ったRSS取得CGIはPerl製なので、うちのZopeサーバーで動かすのは微妙にめんどくさい。

- FrontにApacheを立てて、特定のURLだけApacheに実行させる
- ZopeがREQUESTを受けて、ExternalMethodでCGIを実行
- 他、何か無いか...(絶対Productとかありそう)

Apache使うのが普通かも。でも今回はExternalMethodでやってみた。


.. _`mixiの新着情報をRSSで取得`: http://www.freia.jp/taka/blog/259



:extend type: text/plain
:extend:
.. code-block:: Python

    def feed(self):
        from urlparse import urlparse
        import os
        request = self.REQUEST
    
        url = request.get('URL')
        u = urlparse(url)
        os.putenv('SERVER_PORT', u[0].find('https') and '443' or '80')
        os.putenv('SERVER_NAME', u[1])
        os.putenv('REQUEST_URI', u[2])
        pi,po,pe = os.popen3("/usr/local/www/ZInstance/Extensions/feed.cgi")
        return po.read()

これをExternalMethodから呼ぶようにする。Extensionsディレクトリに置いた上記コードのファイルのオーナーがZope実行ユーザーになっていなかったり、ファイルを書き換えたらExternalMethodもSaveしないと反映されなかったり、selfが渡ることを知らなかったり、まあけっこう苦労した。いやこんなので苦労してちゃだめなんだが‥‥。

とりあえずCGIが使う環境変数だけでっちあげて完成。ああ、環境変数も最初SERVER_NAMEをそのままコピーしたら公開サーバー名じゃなくてローカルサーバー名になってしまったんだっけ‥‥。


%%%%%%%%%

:id: 263
:date: 2005-10-24 10:14:52
:title: 「IBMのPCではZopeが動かない」を回避
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
先日買ったIBMのノート(X40)でZope2.7と2.8が動かなかった。lib/python/DateTime が datetime をimportしようとしてはまっているらしい。

そうか、Windowsだから大文字小文字が判別できないのか。とか思いつつ環境変数とかを調べていたら、 PYTHONCASEOK なるものを発見。これが定義されているとPythonはモジュールのインポート時に大文字小文字を区別しなくなるらしい。そしてIBMノートには最初からPython(2.2)が入っている関係か、PYTHONCASEOK=1という環境変数が入っていた。

システム設定から、PYTHONCASEOKと、ついでにPython2.2へのパス設定を削除したらちゃんとZope動いてくれた。よかったよかった。

１時間も悩んじゃったよ‥‥。

# http://zope.jp/download/ に書いてあるなぁ...


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5242515412
:title: Re: 「IBMのPCではZopeが動かない」を回避
:author: Terapyon
:date: 2005-10-24 16:35:00
:email: 
:url: 
:body:
知人のマシンで、この現象でした。何で「datetime」で引っかかるのだ・・と思っていました。さっそくやってみたいと思います。


:comments:
:comment id: 2005-11-28.5243656551
:title: Re: 「IBMのPCではZopeが動かない」を回避
:author: 清水川
:date: 2005-10-25 10:23:56
:email: 
:url: 
:body:



:comments:
:comment id: 2005-12-20.0654861680
:title: Re:「IBMのPCではZopeが動かない」を回避
:author: mashu
:date: 2005-12-20 12:24:26
:email: mashu9000@gmail.com
:url: 
:body:
ThinkPadなのですが、動きません。runzope.batには以下のように追加しましたが
だめです。どうしてなんでしょう？？

C:\Zope-Instance\bin>type runzope.bat
@set PYTHON=C:\Program Files\Zope-2.8.4-final\bin\python.exe
@set ZOPE_HOME=C:\Program Files\Zope-2.8.4-final
@set INSTANCE_HOME=C:\Zope-Instance
@set SOFTWARE_HOME=C:\Program Files\Zope-2.8.4-final\lib\python
@set CONFIG_FILE=C:\Zope-Instance\etc\zope.conf
@set PYTHONPATH=%SOFTWARE_HOME%
@set ZOPE_RUN=%SOFTWARE_HOME%\Zope2\Startup\run.py
@set PYTHONCASEOK=
"%PYTHON%" "%ZOPE_RUN%" -C "%CONFIG_FILE%" %1 %2 %3 %4 %5 %6 %7

C:\Zope-Instance\bin>"C:\Program Files\Zope-2.8.4-final\bin\python.exe" "C:\Prog
ram Files\Zope-2.8.4-final\lib\python\Zope2\Startup\run.py" -C "C:\Zope-Instance
\etc\zope.conf"
Traceback (most recent call last):
  File "C:\Program Files\Zope-2.8.4-final\lib\python\Zope2\Startup\run.py", line
 56, in ?
    run()
  File "C:\Program Files\Zope-2.8.4-final\lib\python\Zope2\Startup\run.py", line
 21, in run
    starter.prepare()
  File "C:\Program Files\Zope-2.8.4-final\lib\python\Zope2\Startup\__init__.py",
 line 95, in prepare
    self.makeLockFile()
  File "C:\Program Files\Zope-2.8.4-final\lib\python\Zope2\Startup\__init__.py",
 line 276, in makeLockFile
    os.unlink(lock_filename)
OSError: [Errno 13] Permission denied: 'C:\\Zope-Instance\\var\\Z2.lock'

C:\Zope-Instance\bin>

:comments:
:comment id: 2005-12-20.6391672078
:title: Re:「IBMのPCではZopeが動かない」を回避
:author: 清水川
:date: 2005-12-20 12:33:59
:email: 
:url: 
:body:
Z2.lockファイルに対するアクセス権が無いみたいですが‥‥。

１，実はもう起動している（インストーラから入れるとWindwosのサービスに登録されるので）
２，C:\Zope-Instance\var に書き込み権限がない（Administratorで作って一般ユーザーで起動しようとしたとか）


:comments:
:comment id: 2005-12-20.4146599012
:title: Re:「IBMのPCではZopeが動かない」を回避
:author: mashu
:date: 2005-12-20 13:53:43
:email: 
:url: 
:body:
一応、administrator権限ユーザーでインストールして、同じユーザーで実行してたんですよ。
でも、Z2.lockファイルのアクセス権がありませんでした。
python.exeが握ってたので、解除後、コピーしたら、OKでした。
お騒がせしました。でもおかしいよ～（　ｐｑ）

:comments:
:comment id: 2005-12-20.7349550794
:title: Re:「IBMのPCではZopeが動かない」を回避
:author: 清水川
:date: 2005-12-20 14:15:35
:email: 
:url: 
:body:
そうすると、やっぱり１の方じゃないかな？

:comments:
:comment id: 2005-12-20.0555275656
:title: Re:「IBMのPCではZopeが動かない」を回避
:author: mashu
:date: 2005-12-20 16:00:57
:email: 
:url: 
:body:
そうだったみたいです。
勝手に起動されてたんだ。

%%%%%%%%%

:id: 264
:date: 2005-10-31 01:53:39
:title: サーバートラブル
:categories: ['IT-PC']
:body type: text/x-rst
:body:
サーバーがトラブったため、土日はほとんど落としてメンテしていました。トラブル内容は以下のように多岐にわたっています。日頃から放置しないでちゃんと考えないとだめって事ですね...。

- RAID5のDISK１台不調(デグレはしてなかったが) → 交換
- ZODBデータ破損 → 復旧できずバックアップから戻す
- ZODB容量圧迫 37GB(!) → 450MBにスリム化

COREBlogRefererPluginのインスタンス(1個)を削除したら37GBが450MBになりました。本当？って感じですが今後調査の課題を残しつつ、リファラデータをDBに引っ越し中です。

個々の作業はネタになりそうなので、追々書いていこうかと思います。



:extend type: text/plain
:extend:


:comments:
:comment id: 2006-08-10.9020699945
:title: Re:サーバートラブル
:author: Anonymous User
:date: 2006-08-10 13:41:43
:email: 
:url: 
:body:
私のは Data.fs が 2GB を越えると、重たくて正常に動作しません；； なんでだろう。
zope も 2.8系なので、そこまで古いバージョンでもないと思うのですが。。。

清水川さんは何か Pack 以外に Data.fs に関する特別なカスタマイズはなされているんですか？


:comments:
:comment id: 2006-08-11.0920934236
:title: Re:サーバートラブル
:author: 清水川
:date: 2006-08-11 01:24:53
:email: 
:url: 
:body:
＞ 清水川さんは何か Pack 以外に Data.fs に関する特別なカスタマイズはなされているんですか？

特にはしていません。最近は毎日Packして再起動しているためか、安定しています……ってこれじゃ参考にならないか。


:comments:
:comment id: 2006-08-11.8218104254
:title: Re:サーバートラブル
:author: Anonymous User
:date: 2006-08-11 13:17:02
:email: 
:url: 
:body:
いえいえ。
ご丁寧にご回答ありがとうございました。

%%%%%%%%%

:id: 265
:date: 2005-10-31 22:53:19
:title: ハロウィンカレー
:categories: ['food']
:body type: text/x-rst
:body:
.. figure:: images/2005halloween_curry/thumb?width=200
  :target: images/2005halloween_curry
  :align: right

  今日はハロウィンらしいのでカボチャカレーを作ってみた。

  鶏のモモを大きめに切ってガラムマサラをよくまぶしてから、圧力鍋で10分ほど加圧。その間にフードプロセッサーでみじん切りになったタマネギと生姜を茶色くなるまで炒める。途中かくのめんどくさいので省略して、カレーのできあがり！

  出来合いのルーでも炒めタマネギ入れるとかなり出来が違う。でも肝心のカボチャは今日は売り切れだったので、代わりに冷凍カボチャを使ったのが微妙な感じだけど‥‥。ウマ！かったのでよし。



:extend type: text/plain
:extend:
%%%%%%%%%

:id: 266
:date: 2005-11-03 19:33:14
:title: Python2.3から2.4でmarshal形式データが変更
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
Python2.4で動かしているZopeのgadflyで保存したデータファイルをPython2.3で動かしているZopeでロードしようとしたら、フォーマット異常でロードできませんでした。調べてみたところPython2.4でmarshalモジュールの保存フォーマットが変更になっていました。

gadflyのデータファイルの変換方法について `gadflyのデータフォーマット`_ にまとめてみました。

.. _`gadflyのデータフォーマット`: http://www.freia.jp/taka/memo/zope/gadflyfile

以下のコードで、Python2.3と2.4で作ったmarshalの出力ファイルを相互に読み込ませてみたところ、2.3で作ったファイルは2.4で読み出せるようです。



:extend type: text/x-rst
:extend:
.. code-block:: Python

    import marshal
    import sys

    sv = ''.join([str(x) for x in sys.version_info[0:3]])

    a = [1, 2.3, 'abc', u'uni', (4,5), {6:'7'}]

    marshal.dump(a, file( 'marshal_'+sv+'.msl', 'w'))

    import glob
    gl = glob.glob('./*.msl')
    for f in gl:
        print '%s loading...' % f,
        try:
            marshal.load(file(f,'r'))
            print 'OK'
        except:
            print 'NG'

実行するとこんな感じです。

.. topic:: 実行してみた
  :class: dos

  | C:> python23 marshaltest.py
  | .\marshal_235.msl loading... OK
  | .\marshal_242.msl loading... NG
  | 
  | C:> python24 marshaltest.py
  | .\marshal_235.msl loading... OK
  | .\marshal_242.msl loading... OK
  

リリースノート等にこのフォーマット変更は書かれていませんでしたが、 `Python2.4のライブラリリファレンス`_ には関係ありそうな変更を発見しました。

まぁ、永続化のためにmarshal使うな、って書いてあるのでこの影響を受ける人はほとんどいないはず...。

.. _`Python2.4のライブラリリファレンス`: http://docs.python.org/lib/module-marshal.html


%%%%%%%%%

:id: 267
:date: 2005-11-03 19:47:56
:title: 先日のカレーにトマトを追加して熟成中
:categories: ['food']
:body type: text/x-rst
:body:
.. figure:: images/2005curry_in_oven/thumb?width=200
  :target: images/2005curry_in_oven
  :align: left

  先日のカレーにホールトマトの缶詰を追加して、再加熱。オーブンレンジで加熱すると焦げ付かないので便利。そしてこのまま１時間放置....。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5259004948
:title: Re: 先日のカレーにトマトを追加して熟成中
:author: やまざき
:date: 2005-11-08 19:03:26
:email: hayato@kcf.biglobe.ne.jp
:url: http://jinbey.com/
:body:
あっ、まったく同じ電子レンジです！我が家のレンジ。

これ、もう COREBlog2 ですか？
私は Plone に COREBlog2 をどうインストールするのかすら分からず...
「Plone 上に COREBlog のインスタンスを作る」の方法が...
調べようとしているところです。 

まぁ一歩づつですかね。


:comments:
:comment id: 2005-11-28.5260161354
:title: Re: 先日のカレーにトマトを追加して熟成中
:author: しみずかわ
:date: 2005-11-08 19:16:21
:email: 
:url: 
:body:
> これ、もう COREBlog2 ですか？

いいえ。COREBlog1.xのplonifiedスキンを使っています。
サイトをPlone2.1に移行しないといけないので、しばらく後になりそうです...。

COREBlog2はまだ動かしてませんが、追加方法は
- Ploneの[サイトの管理](ログイン状態でページ右上)に入って
- [プロダクツを追加･削除] でCOREBlog2を追加してあげる
- 任意のフォルダでコンテンツとして追加

という手順ではないかと *想像* しています。あってるかな？


:comments:
:comment id: 2005-11-28.5261322653
:title: Re: 先日のカレーにトマトを追加して熟成中
:author: やまざき
:date: 2005-11-08 20:04:55
:email: hayato@kcf.biglobe.ne.jp
:url: http://jinbey.com/
:body:
> COREBlog2はまだ動かしてませんが、追加方法は
おぉー、"教えてください" みたいになってしまい恐縮です。
でも、バッチリ追加できちゃいましたっ！

しかも、Plone の使い方がなんとなく分かった気がします。
ZOPE = ZMI というイメージが強くて、COREBlog2 のインストールも
てっきり ZMI から行うものと思っていました。

助かりました。ありがとうございます。


:comments:
:comment id: 2005-12-14.6947092104
:title: Re:先日のカレーにトマトを追加して熟成中
:author: ryousei
:date: 2005-12-14 15:11:34
:email: 
:url: 
:body:
> オーブンレンジで加熱すると焦げ付かないので便利。

この方法いいですね。今度やってみよう。

%%%%%%%%%

:id: 268
:date: 2005-11-10 22:14:43
:title: 指先から稲妻
:categories: ['misc']
:body type: text/x-rst
:body:
どうも自分は静電気で痛い思いをする率が他の人よりも高いようで、最近１日に１～２回は静電気が指先でパチッとはじける。

去年の冬は、ディスカッションしながらCRTモニターの画面を指さしたら(触ってない)、かなり痛い思いをした。そのたびに「あいたっ」と叫んで手を振るので、ディスカッションの相手はやかましかったことだろう。

一昨年は事務のスガワラさんから手渡しで何かを受け取ったときに静電気攻撃を加えてしまったこともあった。

で、今年の流行は会社のエレベータのボタンらしい。うぅ、痛いよ...。



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5265253242
:title: Re: 指先から稲妻
:author: masaru
:date: 2005-11-10 22:59:33
:email: 
:url: 
:body:
攻撃されないように気をつけねば・・・


:comments:
:comment id: 2005-11-28.5266382751
:title: Re: 指先から稲妻
:author: 清水川
:date: 2005-11-10 23:11:20
:email: 
:url: 
:body:
今はやりの非接触タイプもあります。
%%%%%%%%%

:id: 269
:date: 2005-11-14 23:32:31
:title: ボードゲーマー
:categories: ['Game']
:body type: text/x-rst
:body:
以前から aihatena の影響でボードゲームはそれなりに知っている方だと思う。

先週金曜日に会社の同僚がボードゲームの話をしていたので聞いてみたら、かなりやりこんでるっぽい事が分かった。カタンはもちろん、自分が知ってるあたり(ブロックス,カルカソンヌ,QJET,ブラフ,,,,)は全部知ってたし話しぶりからすると全部もってそう。

ということで今度カタンやるときは呼んでください。

# なんか社内結構カタンやってる人多いらしい


:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5270271219
:title: Re: ボードゲーマー
:author: i?
:date: 2005-11-15 14:49:13
:email: 
:url: 
:body:
つーか私全然知らない方ですよ。
昔ボドゲ仲間と遊んだゲームとか
ドイツボードゲーム大賞受賞/ノミネート作品ぐらいしか見てないし。

カタソも知ってるかな..

今度呼んで下さい(何


:comments:
:comment id: 2005-11-28.5271425472
:title: Re: ボードゲーマー
:author: 清水川
:date: 2005-11-16 01:15:11
:email: 
:url: 
:body:
>今度呼んで下さい(何

そのときが来たら是非。
%%%%%%%%%

:id: 270
:date: 2005-11-15 00:26:08
:title: COREBlogのrefererを外部RDBに保存
:categories: ['Zope']
:body type: text/x-rst
:body:
先日気が付いたらData.fsの容量が37GBになってました。合掌‥‥ていうネタを `サーバートラブル`_ で書いたのですが、対策としてZope内臓のRDB, GadflyにCOREBlogRefererPluginのデータを移植してみました。(その途中の成果?が `Python2.3から2.4でmarshal形式データが変更`_ です)

結果、RDBの容量自体は5MBで済んだのですがデータ更新のたびに5MBのmarshal形式データを全部書き出されるので、リファラ付き閲覧者がページ表示するのに4～6秒余計にかかってしまいました。

.. _`サーバートラブル`: http://www.freia.jp/taka/blog/264
.. _`Python2.3から2.4でmarshal形式データが変更`: http://www.freia.jp/taka/blog/266



:extend type: text/plain
:extend:
で、ここで話は変わって、リファラデータとアクセスログを眺めてて気づいた事が一つ（多分、今更なんだろーな...）

blogにスパムコメント・スパムトラックバックをしてくる誰かがいるんですが、アクセス元は一カ所なのにリファラが毎回違う。そして、検索サイトで、そのリファラのURLをキーに検索してる痕跡がログにありました。そうやってURLの宣伝をしているわけです。あったまくるなあ、もう。

ということで対策はやっぱり、トラックバックの言及チェックとコメント登録時のCAPTCHA入力かなあ。。。


%%%%%%%%%

:id: 271
:date: 2005-11-16 23:59:45
:title: COREBlog2リリース記念オフ会に参加しました
:categories: ['Plone']
:body type: text/x-rst
:body:
COREBlog2スゲぇ！まだ自分の環境をPlone2.1に移行できていないので実運用には出来ませんが、様々な可能性を見せて頂きました。

発表に使われた資料は `CMS/Blog Exchange Part 0`_ 公開されています。

あと、高級感のある飲み屋さんにプロジェクターとスクリーンを持ち込んでのプレゼンテーション、という滅多に見れない会でした(笑 写真取るの忘れたのが残念っ。

.. _`CMS/Blog Exchange Part 0`: http://coreblog.org/ats/cms-blog-exchange-part-0



:extend type: text/x-rst
:extend:
自己紹介の場で、ATBookshelfというCOREBlog2と連携出来る本棚ツールをちょろっと紹介させて頂きました。ATBookshelfについて詳しくは http://www.freia.jp/taka/memo/plone/atbookshelf を参照してください。

.. figure:: /taka/blog/images/coreblog2_and_atbookshelf001/image_thumb
  :target: /taka/blog/images/coreblog2_and_atbookshelf001

  COREBlog2でのインライン表示。
  COREBlog2のIInlineObjectインターフェースに対応している
  ため、Plone2の関連づけ機能でblogエントリと関連づけられた
  アイテムをインラインで表示させることが出来ます。


%%%%%%%%%

:id: 272
:date: 2005-11-22 02:02:19
:title: 会社の飲み会にて
:categories: ['work']
:body type: text/x-rst
:body:
「清水川Web/清水川記っていうタイトルを見て、40才くらいの人だとずっと思ってました」

違います。25才(+67ヶ月)です。

しかし、ネーミングが年寄り臭いということですな。。。じゃあPlone2.0でサイトリニューアルしたら名前を変えて **清水川Web2.0** とかどうですか？ダメですか。そうですか。

ところでサイトリニューアルはとりあえずデザイン変えずにいきます。今は `こんな感じ`_ 。

.. _`こんな感じ`: http://www.freia.jp/taka2/



:extend type: text/plain
:extend:


:comments:
:comment id: 2005-11-28.5281437059
:title: Re: 会社の飲み会にて
:author: setomits
:date: 2005-11-22 08:05:19
:email: 
:url: 
:body:
なんかrdf10_xml内のこのエントリのdescriptionがシステムエラーとかなんとかってなってます。
aタグがあるところでおかしくなってるのかしらん。


:comments:
:comment id: 2005-11-28.5282592788
:title: Re: 会社の飲み会にて
:author: しみずかわ
:date: 2005-11-22 09:43:39
:email: 
:url: 
:body:
ありがとうございます。直しました。blogエントリ登録時にreStructuredTextのフォーマットエラーを起こしてしまったのがそのままexcerptに保存されてました‥‥。エラーに気づいて本文だけ直してました。やっぱり確認しないで登録しちゃだめですね(-_-)


:comments:
:comment id: 2005-11-28.5283748400
:title: Re: 会社の飲み会にて
:author: masaru
:date: 2005-11-22 18:42:43
:email: 
:url: 
:body:
Zope３で構築ってことで”清水川Web3.0”いかがでしょうか
 
%%%%%%%%%

:id: 273
:date: 2005-11-24 02:22:57
:title: ATBookshelf実装な一日
:categories: ['Programming', 'Plone']
:body type: text/x-rst
:body:
`先日のCOREBlogオフ会`_ の時から少し機能が増えていて、Amazonサイト表示中にブックマークレットで登録する機能とか、画像データの内部保持とか、COREBlog2のIInlineObjectのサイズ指定表示とかに対応しました。

あとAmazonから取得した画像をタイル表示できるようにしてみました。タイル表示だとタイトルがぱっと見てわからないのと、画像が無いアイテムの場合にどうしようか？という感じです。

野望としては、インクリメンタル絞り込みを実装したり、AjaxなD&D並び替えに対応したりしたいところですが、iTunesのユーザーインターフェースを参考にしてしまうと並び替えの意味は無いか・・と思ったり。どちらかというとカテゴリとか★ソートとかが重要か。。

- `ATBookshelf概要ページ`_
- `ATBookshelfデモページ`_


.. _`先日のCOREBlogオフ会`: http://www.freia.jp/taka/blog/271
.. _`ATBookshelf概要ページ`: http://www.freia.jp/taka/memo/plone/atbookshelf
.. _`ATBookshelfデモページ`: http://www.freia.jp/taka2/shelf



:extend type: text/html
:extend:
%%%%%%%%%

:id: plone2-1-coreblog2306b79fb884c
:date: 2005-11-29 02:24:43
:title: Plone2.1, COREBlog2に移行
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
移行してみました。やっと、という感じです。ということで、、、

**RSSのURLが変わります!**

今までのRSSのURLはこの記事までで更新が止まりますのでご了承クダサイ。

以下、苦労した点とか残ってる項目とか。

- Plone2.0.5上でATCTへの変換がうまくいかなかったり
- COREBlog1のマイグレーションがうまくいかなかったり
- StructuredTextを使うとUnicodeDecodeErrorが出たり
- ZopeのImageからATImageに変換したのでURLが変わって表示できてなかったり
- COREBlog用portletがデフォルトだったり
- IEで表示するとレイアウトが乱れたり

‥‥と、まだまだ苦労しそうですが、ATBookshelfを実運用できるのがたのしみ。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2005-11-29.2656376914
:title: Re:Plone2.1, COREBlog2に移行
:author: 清水川
:date: 2005-11-29 12:34:26
:email: taka@freia.jp
:url: http://www.freia.jp/taka
:body:
コメント追加出来てなかったようなので、テスト。


:comments:
:comment id: 2005-11-30.2991827931
:title: コメント追加でメール飛ばすテスト
:author: taka
:date: 2005-11-30 22:39:20
:email: 
:url: http://www.freia.jp/taka/
:body:
メールが送信されれば成功！

%%%%%%%%%

:id: 65b05bbf30eb30fc30fc30eb
:date: 2005-11-30 02:08:20
:title: 新宿でベルギービール
:categories: ['misc']
:body type: text/x-rst
:body:
行ったのは先週火曜日です（笑　サイトの移行が落ち着くまでなかなか書きづらくて‥‥。COREBlog2に移行したので気楽に画像表示出来るのがいいですね。

豪君と二人で新宿の `カフェ・ヒューガルデン`_ に行ったのですが、予約無しの20:00入店では席が無くて、１時間くらい立ち飲みしてました。うーん、立ち飲みって初めてかも。その後席を確保して料理らしい料理を二品食べたところで、とみたとの待ち合わせ時間になり、終了。ビール6本・料理4つで12,000円はなかなか気軽に行けない値段です。。。

.. _`カフェ・ヒューガルデン`: http://www.brussels.co.jp/TOP/top.html

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: plone2-1-1306e30d530a930eb5199771f
:date: 2005-11-30 23:02:12
:title: Plone2.1.1のフォルダで写真
:categories: ['Plone']
:body type: text/x-rst
:body:
aihatenaの猫を世話することに‥‥ってこれも9月の写真。ヨドバシ秋葉オープンの翌日だったかな。

ZPhotoSlidesを改良して使うよりもPlone2.1系のフォルダを使った方が問題が少なそうだったので乗り換えてみました。ZPhotoSlidesから乗り換えて良くなった点と悪くなった点があるけど、標準フォルダ機能だと考えると良くできていると思う。少なくとも、自分の使い方の範囲では乗り換えに耐えられる。

良くなった点
------------
- WebDAVやFTPで一気にアップロード出来る
- メモリリークが起きない
- Plone2.1の作法で作られているのでカスタマイズがしやすい

悪くなった点
------------
- ZODBの外に保存できない
- 概要や名前の修正を一つ一つやるのがめんどくさい(フォルダViewからは出来ない)
- 多くの機能が減った(スライドショーとか)が、もともと使わないので...

変わらない点
-------------
- 写真の並び替えが大変

ATFolderで写真、の先人の方々
---------------------------

- `plone 2.1 の「写真アルバム」ビューは結構いいかも — takanory.net`_
- `Plone 2.1のアルバムビューをカスタマイズ — Central Core : coreblog.org`_

.. _`plone 2.1 の「写真アルバム」ビューは結構いいかも — takanory.net`: http://takanory.net/takalog/374
.. _`Plone 2.1のアルバムビューをカスタマイズ — Central Core : coreblog.org`: http://coreblog.org/ats/customizing-plone-album-view


:extend type: text/x-rst
:extend:
ZPhotoSlidesからATFolderへ変換
------------------------------
以下はPlone2.1.1上でZPhotoSlidesからATFolder/ATImageに変換した時に使ったスクリプト。
一応必要そうなデータは変換できるはず。でもプロパティーとかに値が設定してある場合はそれも変換するコードを追加しないといけない。使い方は省略する方向で。

.. code-block:: Python

    ## Script (Python) "folder_converter"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind subpath=traverse_subpath
    ##parameters=src, dest
    ##title=

    request = container.REQUEST
    
    def convert_image(src_obj, dest_container):
        id = callable(src_obj.id) and src_obj.id() or src_obj.id
        dest_container.invokeFactory(type_name='Image', id=id)
        obj = dest_container[id]
    
        kwargs = {
            'title': src_obj.title,
            'content_type': src_obj.content_type,
            'precondition':'',
            'filedata':src_obj.data,
        }
    
        obj.manage_edit(**kwargs)
        obj.setDescription(src_obj.description)
    
        print id, 'converted.'
        return printed
    
    def convert_atfolder(src_obj, dest_container):
        id = callable(src_obj.id) and src_obj.id() or src_obj.id
        dest_container.manage_addFolder(id, src_obj.title)
        obj = dest_container[id]
        print "'%s'" % src_obj.Description(),
        obj.setDescription( src_obj.Description() )
        obj.indexObject()
        print 'converted.'
        print convert_folder(src_obj, obj)
        return printed
    
    def convert_folder(src_container, dest_container):
    
        for obj in src_container.objectValues():
            id = callable(obj.id) and obj.id() or obj.id
            print 'converting.. ', id, "(%s)" % obj.meta_type,
    
            if obj.meta_type in ('ATFolder',):
                print convert_atfolder(obj, dest_container)
    
            elif obj.meta_type in ('CMF ZPhoto','ZPhoto',):
                print convert_image(obj, dest_container),
    
            elif obj.meta_type in ('CMF ZPhotoSlides',
                                   'CMF ZPhotoSlides Folder',
                                   'ZPhotoSlides',
                                   'ZPhotoSlides Folder',):
                dest_container.manage_addFolder(id, obj.title)
                sub_dest = dest_container[id]
                sub_dest.setDescription( obj.description )
                sub_dest.indexObject()
                print 'converted.'
                print convert_folder(obj, sub_dest)
    
            else: # copy for unknown
                o = src_container.manage_copyObjects(id)
                dest_container.manage_pasteObjects(o)
                dest_container[id].indexObject()
                print '%s copied.' % id
    
        return printed
    
    print 'make "%s"' % dest
    src_container =  container[src]
    container.manage_addFolder(dest)
    dest_container = container[dest]
    dest_container.setDescription( src_container.Description() )
    print convert_folder(src_container, dest_container),
    
    print 'done'
    return printed
%%%%%%%%%

:id: 4e2189aa300130aa30fc30b930c830e930ea30a2306b98db
:date: 2005-12-03 02:31:21
:title: 両親、オーストラリアに飛ぶ
:categories: ['misc']
:body type: text/x-rst
:body:
家に帰ると留守電に実家(秋田)の両親からのメッセージが入っていた。

.. topic:: 両親からの留守電

  - 母「今成田についたー。これからオーストラリアに行く飛行機にのるからー」
  - 父「これからいってきますー。またなー」

え？今日？たしかに１ヶ月くらい前に聞いたきがするけど。あれ？
なんかすごい突然行っちゃったなー。。。

それにしても、定年直後に初海外旅行とは。なかなかアグレッシブな両親だ。

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: nintendo-ds8cb730633066304d307e3057305f
:date: 2005-12-03 02:37:35
:title: Nintendo DS買ってきました
:categories: ['Game']
:body type: text/x-rst
:body:
「みんなでやわらかあたま塾とかやったら楽しそうだなー」とか思って買ってきました。最近のゲームスタイルが多人数でわいわいやるのが楽しい型になっているので、一人で遊ぶことはほとんど無いんだろうなぁ、でもソフト一本も無いというのもさみしいなぁとか思って「スライムもりもり２」を一緒に買ってきました。

スライムは、すごいです。飛びます。

:extend type: text/x-rst
:extend:


:trackbacks:
:trackback id: 2006-01-19.0462122281
:title: 笳螺縺ｪ繧薙〒繧ゅ〒縺阪ｋ縺懶ｼ√ル繝ｳ繝Φ繝峨DS笳裸
:blog name: 珍しいモノ☆ヘンなモノ大図鑑
:url: http://plaza.rakuten.co.jp/raelian/diary/200601090001/
:date: 2006-01-19 12:07:27
:body:
いま巷では売り切れ続出すごいみたいです。ニンテンドーＤＳ。　ニンテンドーDSこれ１つさえあれば、何だって思いのままできちゃうすごく楽しいゲームマシンだそうです☆日本のゲーム機史上、最速実売500万台の売り上げを突破しておりすでに544万台を出荷しているとのこと...

%%%%%%%%%

:id: cms-blog-exchange-1-8b1b5e2b30573066304d307e3057305f
:date: 2005-12-13 01:25:56
:title: CMS/Blog EXchange 1 で講師してきました
:categories: ['Event', 'Plone']
:body type: text/x-rst
:body:
講師と言われると微妙に照れますナ。

いつも通りと言えばいつもどおりプレゼンをしてきました。プレゼン資料は作成しておいたのですが、しゃべる用意を全然してなかったので、資料としゃべる順番が違ったり、実際に動かしてみたら予定外の動きをしたりと、かなり大変なことになってました。聞きに来てくれた皆さん、ごめんなさい o(_ _)o あと、風邪のためにテンション低くてごめんなさい o(_ _)o

ということで、なかなか思うようにいかない発表で時間もまるまる２時間使ってしまいましたが‥‥こんなのでよかったんだろうか？？是非感想をお寄せクダサイ。もし見てたら。

ところで、今日の懇親会はさくら水産でした。このあいだ銀座のAppleでイベントやった後もさくら水産でした。今日は２時間で2000円でした。やすっ！

# おまけ：使った資料を添付しておきます...

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2005-12-14.5218225145
:title: Re:CMS/Blog EXchange 1 で講師してきました
:author: ryousei
:date: 2005-12-14 15:08:42
:email: 
:url: 
:body:
飲みの席でも言いましたが、スラスラ段取りのよいプレゼンについていけないことの多い私にとっては、最高のプレゼンでした。予定外の動きとかも、自分がそうなったときの参考になるし、万事オーケーでした。翌日のと合わせて、大阪から出向いた甲斐がありました。ありがとうございました。

:comments:
:comment id: 2005-12-14.1529991492
:title: Re:CMS/Blog EXchange 1 で講師してきました
:author: 清水川
:date: 2005-12-14 17:49:13
:email: 
:url: 
:body:
プレゼンしながら試行錯誤したせいで、「試行錯誤してるときにどこまで戻ったのか言って欲しかった」というコメントも‥‥笑
次から気をつけマス。

:comments:
:comment id: 2005-12-16.9247955450
:title: Re:CMS/Blog EXchange 1 で講師してきました
:author: ryousei
:date: 2005-12-16 10:52:06
:email: 
:url: 
:body:
>試行錯誤してるときにどこまで戻ったのか言って欲しかった

なるほど、これでパーフェクトなプレゼンになりますね。

ひとくちに「プレゼン」と言っても、今回のような技術的なプレゼンと、翌日のatsさんの概要的なプレゼンとではだいぶ違うと思いました。前者は試行錯誤もコミで価値があり、試行錯誤を見せることも想定内、すなわちそこからの復帰もスマートにやってのければ完璧と。後者は逆に試行錯誤に陥らないようによく段取りされている方がいいと。

堀田さんの発表が聴けなかったのは残念でしたが（つぎ行ける保証ないし^^;）、結果として２時間フルで個人的にはよかったです。できればテストのところも聴きたかったです～。

:trackbacks:
:trackback id: 2005-12-14.6352067286
:title: CMS/Blog Exchange 1
:blog name: Weboo!Log
:url: http://yamashita.dyndns.org/blog/376
:date: 2005-12-14 22:23:55
:body:

もう一昨日(12日)ですけど、参加してきました。またしても、携帯電話を置き忘れたまま家を出てしまいました。私は地図を印刷しない派で、いつもEZナビのお世話になっているので、こういう時は携帯がないと困ります。今回は、1ヶ月くらい前にも行ったことのある場所だったので助かりましたけど…
内容は、清水川さんによる「COREBlog2と連携する最小プロダクトの作成」というものでした。ソースコードを追いながら基本的なプロダクトの作り方を紹介してくれて、私は細かい所は全然分かってませんが、なんとなくPlon...

:trackbacks:
:trackback id: 2005-12-15.1158339450
:title: CMS/Blog EXchange 1 に参加してきました
:blog name: takanori-log
:url: http://takanory.net/takalog/429
:date: 2005-12-15 12:08:36
:body:
清水川さん が講師をした、CMS/Blog EXchange 1
に参加してきました。 柴田さん
も書いてらっしゃいますが、清水川さん、準備してくださったみなさんありがとうございます。
で、私自身はちょっと遅れて参加。
まずビルがこれでいいのかどうかに迷い、ビルに入ってから何回に行けばいいのか迷い、エレベーターを降りてからも会議室が見つからずに迷い。大変でした。(汗)
なんとか無事に着いたので清水川さんの発表を聞く。結局2時間以上使ってしまって、予定にあった堀田さんの発表は流れてしまいました。
...

%%%%%%%%%

:id: 4eca9031306f4eca65e54ee55916516890e898f2307f4f1a
:date: 2005-12-13 20:02:16
:title: 今週は今日以外全部飲み会
:categories: ['misc']
:body type: text/x-rst
:body:
今週、気が付くと今日以外全部飲み会です。

- 月: CMS/Blog EXchange1懇親会
- 火:
- 水: 秘密の同窓会
- 木: 会社の忘年会
- 金: 部の忘年会
- 土: 大学友人グループのクリスマス会
- 日: クリスマス会は48時間
- 月: JZUGの打ち合わせ後飲み会
- 火: 秘密の密会

大変だー。まだ風邪治ってないのに大丈夫かいな。

--

追記: 翌週も続くんだった。。。

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2005-12-14.8545429182
:title: Re:今週は今日以外全部飲み会
:author: 清水川
:date: 2005-12-14 11:55:16
:email: 
:url: 
:body:
コメント書き込みにログインが必要、という指摘をもらったのでテスト。

%%%%%%%%%

:id: coreblog230b330e130f330c88a3153ef
:date: 2005-12-14 12:03:24
:title: COREBlog2でコメント許可
:categories: ['Plone']
:body type: text/x-rst
:body:
COREBlog2でコメント・トラックバックをAnonymousに対して許可するために設定してみた。コメント投稿テストしたときは認証済みアカウントだったので、投稿出来ない事に気づかなかったという...orz

しかしそうするとエントリ投稿時に設定できる「コメント・トラックバックの設定」の設定はどうなるんだろう？帰ったら調べてみよう。。

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2005-12-14.1743156502
:title: Re:COREBlog2でコメント許可
:author: masaru
:date: 2005-12-14 15:36:14
:email: 
:url: 
:body:
よかったよかった。コメントできなくて死にそうでした。

:comments:
:comment id: 2005-12-15.9828424463
:title: Re:COREBlog2でコメント許可
:author: taka
:date: 2005-12-15 02:23:02
:email: 
:url: 
:body:
ちょっとスパムにやられてましたが、取り急ぎNGワードチェックを入れてガードしました。はてさてどうなるか。。。

%%%%%%%%%

:id: coreblog27c216613spam-filter
:date: 2005-12-15 02:48:46
:title: COREBlog2簡易spam-filter
:categories: ['Plone']
:body type: text/x-rst
:body:
コメント追加の許可設定の件を調べようと思ったら、コメント追加が可能になったとたんspamコメントが10件以上投稿されていた。ムカツク。とりあえず、COREBlog1のBuzzWordsチェック機構をCOREBlog2用に改造してチェックするようにしたので、これで様子見。

:extend type: text/x-rst
:extend:
追加コードは意外と少なくて、portal_skins/COREBlog2/validateCommentを以下のようにカスタマイズする。これでBuzzWordsに引っかかった項目がエラーとなって投稿できない。

::

    for key in ['title', 'body', 'author', 'email', 'url']:
        if REQUEST.has_key(key):
            m = context.validateBuzzWords(REQUEST[key])
            if not m:
                state.setError(key, 'Pleae remove NG words.', new_status='failure')
    
    if state.getErrors():

いちおうvalidateBuzzWordsも載せておく。これもportal_skins/custom等に置いて、引数textを取るようにしておく。今回の用途ではmoderated変数が用をなしていないけど、まぁいいか。

::

    buzz_words = (
      'casino',
      'poker',
    )
    
    moderated=True
    try:
        if not moderated:
            return moderated
    
        s = str(text).lower()
        for w in buzz_words:
            if s.find(w) >= 0:
                moderated = False
                break
        else:
            moderated = True
    
    except:
        pass
    
    return moderated


:trackbacks:
:trackback id: 2006-06-13.9575564577
:title: COREBlog2 簡易 trackback spam 対策
:blog name: takalog
:url: http://takanory.net/takalog/553
:date: 2006-06-13 23:29:18
:body:
 最近このサイトに大量の trackback spam が届くようになりました。  で、言及リンク付きかどうかチェックではじこうかと思っていたんですが、いろいろ問題があってできてませんでした。  そうは言っても spam は止まりません。COREB...

%%%%%%%%%

:id: 4eca65e5306f79d85bc6306e540c7a934f1a3001304a3093
:date: 2005-12-15 02:59:09
:title: 今日は秘密の同窓会で、おでん
:categories: ['Event']
:body type: text/x-rst
:body:
今日は秘密の同窓会でした。自分の希望で「おでん」やさんに行くことになり、 `市ヶ谷の「でん」`_ に行きました。

注文時に、おでんメニューの大根230円を人数分の４人前頼もうとしたら「１つで３～４人前あります」と言われて出てきたのが、器の中央で塔のようにそそりたつ大根です‥‥。なんじゃこりゃｗ

同窓会はその後ドイツ料理の `PAUKE`_ に移動し、ビールを堪能してきました。それにしても何度行ってもビールの銘柄と味が一致しない‥‥。

.. _`市ヶ谷の「でん」`: http://www.gcon.jp/h/52403/
.. _`PAUKE`: http://pauke.jp/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: zope3092apache306essl52d5304b305930e130e2
:date: 2005-12-16 01:52:30
:title: ZopeをApacheのSSLで動かすメモ
:categories: ['Zope']
:body type: text/x-rst
:body:
ポイントは、RewriteRuleのVurtualHostBaseの後ろにhttpsと書くこと。ここをhttpで書いてしまうと、Zope君がページを構築するときに同一サーバー内へのリンクをhttpで書いてしまう。

‥‥と、syd.jpの中の人に教わった。詳しくは http://wiki.zope.jp/VHMSetupSample2 を参照。

前提
-----
- ZopeにVirtualHostMonsterがあること(2.7.5からrootに標準である)
- ApacheのSSL設定が終わっていること

設定
----

Apacheのssl.conf::

  RewriteEngine On
  RewriteRule ^/(.*) http://localhost:8080/VirtualHostBase/https/www.freia.jp:443/VirtualHostRoot/$1 [P,L]

manage等にアクセスしたら自動的にhttpsに迂回するhttpd.conf::

  # forwarding to https for manage aceess.
  RewriteRule ^(.*)/manage$ https://www.freia.jp$1/manage [L]
  RewriteRule ^(.*)/manage_(.*) https://www.freia.jp$1/manage_$2 [L]

  # proxy to zope server.
  RewriteRule ^/(.*) http://localhost:8080/VirtualHostBase/http/www.freia.jp:80/VirtualHostRoot/$1 [P,L]


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 30af30ea30b930de30b95fd85e744f1a
:date: 2005-12-18 23:58:46
:title: クリスマス忘年会
:categories: ['Event']
:body type: text/x-rst
:body:
今年も例年通り、友人同士のクリスマス会を開催し、無事終了しました。

今年はいつもと違って、プレゼント交換じゃなくて、賞品争奪戦にしてみました。賞品にはiPod shuffleとかNintendoDSとかを用意することが出来たので、争奪戦もかなり盛り上がりました。ちなみに争奪戦はゲームキューブ２台をLANで繋いで、マリオカートダブルダッシュを８人同時のペア戦、４ペアを５回行った順位で決めました。

さて、また明日からは年末に向けて仕事とか、もろもろがんばらねば。。。

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2005-12-19.0439867961
:title: Re:クリスマス忘年会
:author: i?
:date: 2005-12-19 11:24:06
:email: 
:url: 
:body:
ナイスタッグでした。ありがとー
DS版でミニターボ出せるようがんばるよ

:comments:
:comment id: 2005-12-19.6434297465
:title: Re:クリスマス忘年会
:author: 清水川
:date: 2005-12-19 12:57:24
:email: 
:url: 
:body:
ベビィパーク(超小さいループコース)でぐるぐる回りながら練習だ！

%%%%%%%%%

:id: 671d304b308930b55f015f533001305d3057306630a430c4pauke
:date: 2005-12-20 01:45:40
:title: 朝からサバ弁当、そしてドイツPAUKE
:categories: ['Event']
:body type: text/x-rst
:body:
`昨日はクリスマス会`_ だったので、冷蔵庫は余った食料で一杯。しょうがないので痛みやすそうなあたりから消化します。とういことで、今日(月)の朝ご飯は焼鯖弁当＋ラタトゥイユでした。夜はJZUGの打ち合わせ後、軽く飲み会なので、朝食べるしかありません。というかなんでクリスマス会の食事の残りが鯖弁当なんだろう‥‥。

夜はJZUGの打ち合わせで、打ち合わせ後に PAUKE_ に行きました。 `先週の火曜日`_ にも行った気がします。ギリギリまで飲んでたら終電を逃して、４駅くらい手前からタクシーでした。1200円なり。

これで、先週水曜日から続いている宴会６日目が終わりました。あと１日で今年計画している宴会が終わります。ていうか７日連続は多すぎ。

.. _`昨日はクリスマス会`: http://www.freia.jp/taka/blog/30af30ea30b930de30b95fd85e744f1a
.. _PAUKE: http://pauke.jp
.. _`先週の火曜日`: http://www.freia.jp/taka/blog/4eca65e5306f79d85bc6306e540c7a934f1a3001304a3093


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 790237d9a98f2307f4f1a67007d4265e5
:date: 2005-12-21 01:18:39
:title: ７連続飲み会最終日
:categories: ['misc']
:body type: text/x-rst
:body:
- 今日もまた飲み会
- 途中で帰郷のために予約しておいた切符を購入
- グリーン車に乗れる往復割引切符が無い事を知りショック
- 秋田ではグリーン車往復割引切符を売ってることを知りさらにショック
- 銀座のコリドー街で迷子になり、20分歩き回る
- ７日連続イベントの最後
- また最終電車に乗れなかった
- でもJR接続遅延のおかげで笹塚駅で最終電車に追いついて、無事帰宅


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 663c98ef306b30aa30fc30eb30fc30cc
:date: 2005-12-22 22:07:05
:title: 昼飯にオーベルジーヌ
:categories: ['food']
:body type: text/x-rst
:body:
オーベルジーヌで野菜カレーを食べた。うーん、自分がインドカレー好き好きーなためか、それとも昨日・一昨日もカレーを食べたせいか、あんまり感動もなく‥‥。ランチ客は珈琲150円なのは良い。でもイタリアンローストは苦手。

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2005-12-22.4910755941
:title: Re:昼飯にオーベルジーヌ
:author: masaru
:date: 2005-12-22 23:24:51
:email: 
:url: 
:body:
ジャガイモがそのまま出てきたのにはびっくりしました(＾∇＾)

%%%%%%%%%

:id: 30e130e24ee54e0b309230b930de30fc30c830d530a930eb518d69cb621030573066307f308b
:date: 2005-12-23 17:13:41
:title: メモ以下をスマートフォルダで再構成してみる
:categories: ['Plone']
:body type: text/x-rst
:body:
`このサイトのメモ`_ 以下をPloneのスマートフォルダで再構成してみました。ついでにサイト全体のworkflowとかをいじったせいで、最近の更新portletが大変なことになってますが気にしないことにします。

再構成のポイントは以下のような感じにしてみました。

- memoはフォルダ
- memo直下にスマートフォルダを置いて、memoのデフォルトビューに指定して見せたい物だけ見せる
- memo直下に分類用のスマートフォルダを複数階層で配置（以前はフォルダだった）
- memoの下に全コンテンツをベタ置き
- memo以下の全コンテンツにはプロパティーのキーワードを指定して見せる場所を決めるようにする

こうすることで、複数のキーワードを持たせると複数の場所に見せることが出来るようになります。
このBlogエントリにもPloneキーワードを付けてみました。 http://www.freia.jp/taka/memo/plone に表示されるでしょうか？

長所
-----
- 複数箇所に属するドキュメントを簡単に配置できる
- 同時にRSSを提供できる

短所
-----
- コンテンツを見たときにブレッドクラムが寂しい
- キーワード設定するのがUI的に面倒
- Blogとの境界線が曖昧になり、閲覧者が混乱するかも？
- コンテンツ一つ一つの並び順を指定できない

んー、短所は短所というかBlogの特徴という気がしないでもない。つまり、いっそのことサイト全体のコンテンツをCOREBlog2で書いて、技術メモ等はスマートフォルダで見せればよいという事か？？んー、もうちょっと試行錯誤が必要かな。。。


.. _`このサイトのメモ`: http://www.freia.jp/taka/memo


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: x-mas
:date: 2005-12-23 23:42:55
:title: X'mas
:categories: ['misc']
:body type: text/x-rst
:body:
近所のアパート(?)、毎年恒例の電飾。外壁一面に電飾ががが。５月には鯉のぼりも昇ります。

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 4eca591c306f30e930bf30c830a530a430e6
:date: 2005-12-24 23:34:04
:title: 今夜はラタトゥイユ
:categories: ['food']
:body type: text/x-rst
:body:
先週のクリスマス会で好評だったラタトゥイユをまた作りました。うまー。

作成時間15分。１鍋８００円。１皿で４００円くらい。ズッキーニだけで１本３００円します。次から茄子で代用してやる。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2005-12-25.5986464265
:title: Re:今夜はラタトゥイユ
:author: Anonymous User
:date: 2005-12-25 11:26:39
:email: 
:url: 
:body:
きゅうりだ!

:comments:
:comment id: 2005-12-26.4432601658
:title: Re:きゅうり
:author: しみずかわ
:date: 2005-12-26 09:20:44
:email: 
:url: 
:body:
300円もしやがるズッキーニは、カボチャらしいデス。キュウリを太らせたらカボチャに見えるのかな・・・

:comments:
:comment id: 2005-12-26.5758482491
:title: Re: きゅうりだ！
:author: しみずかわ
:date: 2005-12-26 20:46:17
:email: 
:url: 
:body:
しまった！ズッキーニを一定間隔で輪切りにする様子を横から動画撮影しろということか！＜むり

:comments:
:comment id: 2005-12-27.5583264078
:title: Re:今夜はラタトゥイユ
:author: ma
:date: 2005-12-27 10:55:59
:email: 
:url: 
:body:
ラタトゥイユ、材料がクリスマス色ですね。味付けはどのようにされたのですか？
パンは、我家ではガーリックトーストにします。
パンの片面を軽く焼いて、ペーストを裏に塗りまた焼きます。
《ペースト》
チューブバター＋荒引きにんにくパウダー（生にんにくだとパンが焼けてもまだ火が
とおらないから）＋粉チーズ＋ビン入り粉パセリ


:comments:
:comment id: 2005-12-28.8743483271
:title: Re:今夜はラタトゥイユ
:author: しみずかわ
:date: 2005-12-28 11:44:35
:email: 
:url: 
:body:
味付けは、塩・こしょうのみで、圧力鍋で加圧後に少量を加えただけです。
＞ガーリックトースト
うーん、パンの方が手間がかかりそうな(^^;;でもおいしそう。

%%%%%%%%%

:id: zope-setup-script
:date: 2005-12-26 21:30:00
:title: Zopeインスタンス作成時の定型作業をスクリプトで自動化
:categories: ['Zope']
:body type: text/x-rst
:body:
Zopeのインスタンスをmkzopeinstanceで作った後、たいていの場合management_page_charsetを設定したり、Ploneインスタンスを作ったり、portal_catalogのZCTextIndexをejSplitterに置き換えたりします。そんな定型作業はスクリプト化してしまえ！ということでやってみました。

この ZopeSetupScript_ スクリプトを以下のように使います。

.. topic:: zopectl run zopesetupscript.py
  :class: dos

  C:> zopectl run zopesetupscript.py


まだ、ZCTextIndex差しかえがうまくいってない感じなのが残念無念。とりあえずコメントアウトしておこう。

.. _ZopeSetupScript: http://www.freia.jp/taka/memo/zopesetupscript.py/file_view


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 293
:date: 2005-12-31 23:25:20
:title: Win98をメンテする大晦日
:categories: ['misc']
:body type: text/x-rst
:body:
年末なので実家に帰ってきました。帰って最初にやったのは、実家のWinXPをSP2にしたり、NOD32をインストールしたり、メールアドレス設定を更新したり、MSN Messengerのパスワードを再入力してあげたり‥‥といういつもの作業です。

そんな実家にノートPCとプリンタが増えました。AMD K6 & メモリ64MBなWindows98と、LANポート装備なCanonのLPB-850レーザープリンタです。‥‥古いよ。デカイよ。

とりあえず、全面無線LANにすべく `WHR-G54S/P`_ と `WLI-U2-KG54`_ をヤマダ電機で買ってきました。アクセスポイント(というかルータ)の箱には **NintendoDS対応** のシールも貼ってあります。これでNintendoDSのWiFi接続で遊べます。訂正。屋内にはいずり回るケーブルを撤去できます。

ところで、Windows98ノートの設定を始めてからそろそろ２時間くらいになりますが、まだ終わりません‥‥WindowsUpdateが。実家にはまだ64kbps以上の速度が提供されてません。これではリモートでメンテも難しいです。NTTさん、光はまだですか？とりあえず基地局から7.5kmの距離をADSL提供地域と言うのはやめてください。

あぁ‥‥もうすぐ除夜の鐘か‥‥。今年中に終わらない予感。

.. _`WHR-G54S/P`: http://buffalo.melcoinc.co.jp/products/catalog/item/w/whr-g54s_p/
.. _`WLI-U2-KG54`: http://buffalo.melcoinc.co.jp/products/catalog/item/w/wli-u2-kg54/index.html


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 294
:date: 2006-01-01 01:30:37
:title: 謹賀新年
:categories: ['misc']
:body type: text/x-rst
:body:
あけましておめでとうございます。

今年もよろしくお願いいたします。

2006年 元旦吉日


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 295
:date: 2006-01-04 16:00:00
:title: pythonで辞書に構造体っぽくアクセスするメモ
:categories: ['python']
:body type: text/x-rst
:body:
(2009/3/24 追記)

あるライブラリの関数で引数objに、obj.yearとかobj.monthとかでアクセスする関数があって、テスト用にこのobjをでっち上げる必要が出てきました。素直に書くと

.. code-block:: Python

  class MockData:
    year = 2000
    month = 1

  obj = MockData()

というふうに書かないといけないのですが、このMockを使うのはunittestの中なので、以下のようにして使いたいと思いました。

.. code-block:: Python

  obj = {'year':2000, 'month':1}

ということで、これを実現するために以下のようなクラスを用意してみました。

.. code-block:: Python

  class DictMapper(dict):
      def __getattr__(self, name):
          try:
              attr = super(DictMapper, self).__getattr__(name)
          except:
              if not self.has_key(name):
                  raise AttributeError,name
              attr = self.get(name)
          return attr

  obj = DictMapper({'year':2000, 'month':1})

激しく既出の予感。あともっと簡単な方法がありそうな予感。

------------------

2009/3/24 追記

今日,使いたくなって DictWrapper で検索して見つからなかったので、 DictWrapper でも検索されるようにコメントしておく。

それはそれとして手元に__setattr__してる版が見つかった。あと__getattr__で辞書に無い値にアクセスしたときにNoneを返しているあたりRubyっぽい感じで緩い。__getattr__は属性値があればメソッド呼び出されないので、上記エントリに書いていたsuper(...)は不要だった。

.. code-block:: Python

 class DictMapper(dict):
    def __getattr__(self, name):
        if name in self:
            return self[name]
    def __setattr__(self, name, value):
        self[name] = value

 In [1]: obj = DictMapper({'year':2000, 'month':1})
 In [2]: obj.keys()
 Out[2]: ['year', 'month']
 In [3]: obj.keys
 Out[3]: <built-in method keys of DictMapper object at 0x02444A48>
 In [4]: obj.keys = 1
 In [5]: obj.keys
 Out[5]: 1


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-01-05.4431619861
:title: Re:pythonで辞書に構造体っぽくアクセスするメモ
:author: chewganabira
:date: 2006-01-05 00:44:03
:email: 
:url: http://kariyushi.plala.jp/chewganabira
:body:
このエントリを読んだ**瞬間**、Martin Fowlerの論文"To Be Explicit"のことを思い出しました。

http://martinfowler.com/ieeeSoftware/explicit.pdf


:comments:
:comment id: 2006-01-05.8320619570
:title: Re:pythonで辞書に構造体っぽくアクセスするメモ
:author: 清水川
:date: 2006-01-05 10:17:13
:email: 
:url: 
:body:
おお、早速読んでみます。
とりあえずExcite翻訳にかけたら、著者名が「マーチン野鳥捕獲者」と‥‥

%%%%%%%%%

:id: 296
:date: 2006-01-08 23:50:00
:title: 自転車で秋葉原から調布へ
:categories: ['misc']
:body type: text/x-rst
:body:
自転車で秋葉原から調布まで移動しました。自転車を買おうと思ってaihatenaから借りて実際に長距離乗ってみました。秋葉原から市ヶ谷まで30分。市ヶ谷から調布まで80分かかりました。

とりあえず、この時間でこの距離を移動するとその後体力が尽きて何も出来ないことは分かりました...orz

もうちょっと体力付けねば。。。

:extend type: text/html
:extend:


:comments:
:comment id: 2006-01-10.6781902770
:title: Re:自転車で秋葉原から調布へ
:author: D.F.Mac.
:date: 2006-01-10 10:38:25
:email: 
:url: http://ta.xii.jp/
:body:
体力作りって、できないですねぇ。うちは今日(1/9)初詣に行ってきたんですが、12kgの子供を抱えて石段を上ったら非常に疲れました。
子供が自分で登れるようになるまでがチャンスなので、便乗して鍛えようと思います。

:comments:
:comment id: 2006-01-10.3945481652
:title: Re:体力作り
:author: taka
:date: 2006-01-10 10:43:14
:email: 
:url: 
:body:
子供を抱えて近所をジョギング。体力は付きそうだけど子供は泣くなぁ‥‥。

%%%%%%%%%

:id: 297
:date: 2006-01-15 17:08:37
:title: 1/9～1/15の間
:categories: ['misc']
:body type: text/x-rst
:body:
風邪ひいて倒れてました。それでも地球は回る‥‥

- 会社を2日も休む
- 病院に行ったら、インフルエンザではないとの診断。前日食べた鶏のせいではなかったようだ。
- USB故障で修理に出していたX31が帰ってくる。HDDとバッテリ抜いて送ったけどOKだった。
- IBMの２年間延長保証に申し込む(笑)
- 実家のWindowsPCが故障し、送られてくる。箱を開けると一面のリンゴ(Apple)‥‥
- 実家の父が、ポリテクセンターからmikatype.exe.lnkをFDで持ち帰る
- 「ハウルの動く城」はストーリーがよく分からない
- 布団の中で「逆転裁判 - 蘇る逆転」をクリア


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 298
:date: 2006-01-15 17:35:46
:title: Re: アルバムに lightbox を使ってみました
:categories: ['Plone']
:body type: text/x-rst
:body:
`アルバムに lightbox を使ってみました - takanory.net`_ を見て、超手軽にWeb2.0な雰囲気を味わえる！と感激。感激ついでにプロダクト化してみました。

コード自体はスケルトンを数行変えるだけなので20分くらいで出来ましたが、README.txtを書いたり、著作権どうしようか悩んでみたり [1]_ 、しているうちに1時間くらいになりました。コードのスケルトンは大体用意できてるので、著作権とかREADME.txtとかのスケルトンを作っておこうかしら‥‥。

なお、こんな感じでアイディアをサクっとプロダクト化したいけどPlone2.1のプロダクトを作るのは難しそう！という方は、 `Zope Developers Camp 2006 Winter`_ に参加してみてはどうでしょうか？


----

.. [1] 大本のLightbox JS は Creative Commons Attribution 2.5 License


.. _`アルバムに lightbox を使ってみました - takanory.net`: http://takanory.net/takalog/456
.. _`Zope Developers Camp 2006 Winter`: http://coreblog.org/camp/2006w/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 299
:date: 2006-01-15 20:16:24
:title: apache2.2にしてみる
:categories: ['Unix']
:body type: text/x-rst
:body:
先日 `ZopeをApacheのSSLで動かすメモ`_ を書いた後で、一部のファイル(PNGフォーマットの画像)をSSL経由でアップロードできなくなると言う問題が発覚。色々いじってみたものの原因が分からず syd.jp の中の人に相談したところ「ApacheのSSLが腐ってるんじゃない？」というありがたいお言葉をいただいたので、2.0.54から2.2.0にアップデートしてみたら問題が解消した。

ところで、apache2.2にしたらmod_auth_pamが動作しなくなった。ウチでは認証は全部LDAPにやらせているので、これが使えないとsubversionのcommitが出来なくなってしまう。現状ではまだapache2.2についてのドキュメントは多くなく、apache本家やmod_auth_pamのサイトにも有力な情報がなかった。エラーログを見てみたところ::

  [Sun Jan 15 19:23:34 2006] [error] [client x.x.x.x] (9)Bad file descriptor: Could not open password file: (null)

上記のように記録されていたので、どうやらPAM認証せずにパスワードファイル認証を行おうとしているらしい。それなら、と、以下のようにmod_auth_pamのロードをLoadModuleの先頭に持って行ったらうまくいった::

  LoadModule auth_pam_module    libexec/apache22/mod_auth_pam.so
  LoadModule authn_file_module libexec/apache22/mod_authn_file.so
  LoadModule authn_dbm_module libexec/apache22/mod_authn_dbm.so
  LoadModule authn_anon_module libexec/apache22/mod_authn_anon.so

ロード順が今回の原因だった、というのはおいといて、2.0→2.2の変更内容には特にそれらしい記述は見あたらないんだけどなぁ‥‥。


.. _`ZopeをApacheのSSLで動かすメモ`: http://www.freia.jp/taka/blog/zope3092apache306essl52d5304b305930e130e2


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-01-16.9433770488
:title: Re:apache2.2にしてみる
:author: masaru
:date: 2006-01-16 07:25:50
:email: 
:url: 
:body:
syd.jpの中の人は優秀ですね

%%%%%%%%%

:id: 300
:date: 2006-01-15 22:05:00
:title: SSL証明書を入手
:categories: ['Unix']
:body type: text/x-rst
:body:
ApacheのSSLを利用するために、正規の認証機関でサインされた証明書を入手することができました。利用したのは `Rapid SSL`_ というところで、手続き開始から完了まで30分ほどで完了しました。しかも料金は$30/2年という格安です。

あるSSL証明書発行機関では、証明書発行時に本人確認が必要で、印鑑証明＋実印＋免許証の写し、などを求められました。しかしRapid SSLではその辺を電話で行っており、申請の流れは以下の感じでした:


.. _`Rapid SSL`: http://www.rapidssl.com/


:extend type: text/x-rst
:extend:
1. Webフォームに証明書の種類等の必要事項を記入する
2. 対象サーバーのCSRを入力する
3. URL等CSRの内容確認
4. メールアドレス、カード番号等を入力する
5. 電話番号を入力して、言語に日本語を選択してPlace Call Now ボタンを押す
6. 電話がかかってくる
7. Webページに表示されている番号をPushする
8. 肉声を録音する
9. 最終確認ページのURLがメールで送られてくる
10. URLにアクセスする
11. サイン済みCRTファイルがメールで送られてくる

おもしろかったのは、電話掛けるボタンを押したら電話が鳴ったり、音声が日本語だったり、電話が完了したらWebページが自動的に次のページに進んだりというあたり。ここまでシステム化されたサイトは他に見たことがありません。
もう一つおもしろかったのは、メールアドレスの手入力が出来ないこと。whois情報に登録されているメールアドレスか、登録しようとしているドメイン名のメールアドレス(数種類自動生成)からしか選べませんでした。

作業時間は、CSR作成やCRTの配置を除けば上記の内容で10分もかからないと思いますが、一応EULAに目を通したので結構かかって30分。

料金については、一番安いコースで69$/1年なのですが、Renewal申し込みの場合は約半額の料金設定になっており、FreeTrialからの申し込みもRenewal扱いだったため、$34/1年と$60/2年で迷って、2年の方にしました。

最後に気になった点等:

- 手に入れるのが簡単すぎる気がする
- これで本当に、本人確認を満たしているのか
- FreeTrialしないと金額が倍に‥‥
%%%%%%%%%

:id: 301
:date: 2006-01-20 10:59:52
:title: CMS/Blog EXchange2（飲み会）に行ってきました
:categories: ['Event', 'Zope']
:body type: text/x-rst
:body:
昨日、 `CMS/Blog EXchange2`_ というか `DevCamp2006w`_ の事前懇親会(?)に行ってきました。やはりこういう懇親会はかなり濃い話題が飛び交うのでモチベーションがアップして良い感じです。

内容は、DeveloppersCampの歴史を柴田さんがプレゼンしたり、今年のプログラムリーダーがそれぞれ抱負を語ったり、自己紹介したり、という感じでした。 `nagosui`_ のnyusukeさん(skinカスタマイズリーダ)はskype(音声＋映像)での参加で、柴田さんがヘッドセットを付けて音声中継していました。あと、田原さん(Zope3リーダ)が仕事でこれなかったので、抱負として言いそうなことを代わりに言ってみたりしました。

あー、また写真撮るの忘れた‥‥。飲み屋にプロジェクター＆スクリーンを持ち込んでskypeで中継するシーンはそう滅多に見れるものじゃないのになぁ(無線LAN完備の飲み屋もそうそう無いですが)。

.. _`CMS/Blog EXchange2`: http://coreblog.org/jp/events/cms-blog-exchange-2/
.. _`DevCamp2006w`: http://coreblog.org/camp/2006w/
.. _`nagosui`: http://nagosui.org:8080/Nagosui/



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 302
:date: 2006-01-21 13:02:10
:title: 2006年　東京　初雪
:categories: ['misc']
:body type: text/x-rst
:body:
うっすらと積もりました。JRは大幅にダイヤが乱れているとか。東京の電車は弱いなぁ。

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 303
:date: 2006-01-21 22:16:01
:title: Zope-2.9.0にはInterfacesタブが！の嘘
:categories: ['misc']
:body type: text/x-rst
:body:
先日の `CMS/Blog EXchange2`_ で何人かの方に、「Zope-2.9.0にはInterfacesタブがある！」とか言って実際の表示とかまで見せたんですが、嘘でした。ごめんなさい o(_ _)o

実際には、 ZopePrototype_ というプロダクトを入れているために表示されているのでした。

このZopePrototypeプロダクト、巷で有名なPrototype.jsをZope2に導入するための簡単なプロダクトで、単にprototype.jsが同梱されているだけに近いのですが、プロダクトの作りがZope3のルールで書かれていているのが大きな特徴かもしれません。同梱されているREADME.txtには「Requires Zope 2.8.4 or +」と書かれています。

なお、同梱のEXAMPLE.txtに大きな嘘が含まれていて、Zope3を知らないと気づけない可能性があります。つまり、以下のように書いてもprototype.jsをロードすることは出来ないのです::

  <script type="text/javascript" src="/++resource++js/prototype.js"></script>

正しくは、次のように書く必要があります::

  <script type="text/javascript" src="/++resource++jsprototype/prototype.js"></script>
  あるいは
  <script type="text/javascript" src="/++resource++prototype.js"></script>

ちなみに、Zope3のような以下のような書き方は出来ませんでした。惜しい。

  <script type="text/javascript" src="/@@/jsprototype/prototype.js"></script>
  <script type="text/javascript" src="/@@/prototype.js"></script>

.. _`CMS/Blog EXchange2`: http://coreblog.org/jp/events/news/blog-cms-exchange-2
.. _ZopePrototype: http://www.zope.org/Members/fabiorizzo/zopeprototype



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 304
:date: 2006-01-23 21:30:42
:title: スポーツ自転車を購入
:categories: ['misc']
:body type: text/x-rst
:body:
通勤用に `LOUIS GARNEAU LGS-RA8`_ という自転車を購入。これで片道17km,往復34kmを週の半分乗ることになる‥‥予定。

この自転車を選んだ理由は、オートマだから。甲州街道とか新宿あたりは、信号とか通行人とかの関係で発進停止が超多いので、マニュアルだと手が疲れる。うーん、そんな理由で選んで良いんだろうか(笑)。いちおうマニュアル制御も出来るので困ることはないと思う。

とりあえず今週平日は路面凍結しまくってて危ないので乗れない。仙川で受け取ってから調布までの移動もけっこう危なかった。早く溶けないかな。

.. _`LOUIS GARNEAU LGS-RA8`: http://www.louisgarneausports.com/bike/lgs-ra8.htm


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-01-24.5232999990
:title: Re:スポーツ自転車を購入
:author: takanori
:date: 2006-01-24 11:58:44
:email: 
:url: http://takanory.net/
:body:
おお、ルイガノっすか。かっこいいね。
オートマってすごいなぁ、興味あるのでどんな感じなのか教えてくださいね。
私も寝坊しないでちゃんと自転車通勤しないと...

:comments:
:comment id: 2006-01-24.6987338092
:title: Re:スポーツ自転車を購入
:author: masaru
:date: 2006-01-24 20:05:00
:email: 
:url: 
:body:
かっこいい（・∇・）

:comments:
:comment id: 2006-01-25.5100964883
:title: Re:スポーツ自転車を購入
:author: しみずかわ
:date: 2006-01-25 11:01:52
:email: 
:url: 
:body:
内装変速なので(?)、ギアの切り替わりは4→5の時だけ「ガチャン」といきます。他の切り替わりはほとんど抵抗がないですね。初期設定がギア切り替わりをビープ音で知らせる設定だったので、加速減速の多い道では常にビープ音が(;-; （OFFしました）。

%%%%%%%%%

:id: 305
:date: 2006-01-27 01:32:36
:title: 微妙に忙しくなってきた
:categories: ['misc']
:body type: text/x-rst
:body:
12月の `CMS/Blog EXchange01`_ でプレゼンテータをして以降、微妙に放心状態だったのですが、最近になって復活してるっぽい感じになってきました。そんな感じで水曜は `Plone研究会`_ に呼び出され、木曜は `PythonWorkshop03`_ に行ってきました。いやもうこの二日間は仕事もそれなりに入っていて定時時間内の密度の濃いこと濃いこと。

「やっぱりあるいていど忙しいと色んな事が一気に進むよね。」

とか思ったり。

で、忙しくなるとゲーム消化速度が上がるという不思議な現象も。ラ○○とかPCCとかPCC++とか。マリオカートDSは150ccで詰まったままか。逆転裁判(DS版)は面白かった。でも暇なときはゲームしないんだよなぁ‥‥。やっぱり不思議。

(突然)今日感銘を受けた一言
------------------------

.. highlights::

  「本当は別のことがやりたいんだが、そちらが不可能なので、仕方なく不本意ながらこっちをやっている」 

  という言い方には、「覚悟」がない。 
  そこが決定的に駄目だ。

  -- `「やりたくないけどやってる」なんてものはない`_ (Fujiwoの日記@mixi)


.. _`CMS/Blog EXchange01`: http://coreblog.org/jp/events/news/blog-cms-exchange-1
.. _`Plone研究会`: http://www.plone.jp/Members/retsu/mynews/ploneSeminar9
.. _`PythonWorkshop03`: http://www.python.jp/Zope/workshop/200601/
.. _`「やりたくないけどやってる」なんてものはない`: http://mixi.jp/view_diary.pl?id=79425999&owner_id=94902


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 306
:date: 2006-01-28 13:22:34
:title: spamとの戦い（回顧編）
:categories: ['Zope', 'Plone', 'IT-PC']
:body type: text/x-rst
:body:
なにやらCOREBlogユーザーに大量スパムが投下されたらしい。

  - `スパムコメントたっぷり`_
  - `コメントスパム、、、`_
  - `分散型コメントSPAMツールが来てたらしい`_

.. _`スパムコメントたっぷり`: http://www.junktest.net/zope/junya/524
.. _`コメントスパム、、、`: http://z1r.dip.jp/COREBlog/376
.. _`分散型コメントSPAMツールが来てたらしい`: http://sitebites.homeip.net/blog/115


うちは特に今回は来なかったけど、今までがひどかったのでちょっと歴史としてまとめてみる。ちなみに右の画像は、10月から先のspam投稿数をグラフ化したもので、こうやってまとめてみると今月の **97件が少なく見える** という先月までのspamの多さ！ほんと勘弁して。。。

COREBlog1 未フィルタ期
-----------------------

2005年10月頃。何かに目を付けられたらしく、数分で数十件のspamが来るようになった。この頃はCOREBlogのコードを見始めたばかりだったのでspam-filterを作る事も出来ずとりあえず一括削除するための後ろ向きな対策をしてみたり ( http://www.freia.jp/taka/blog/257/ )。

その後しばらくspam削除の日々が続く。


COREBlog1 フィルタ期
----------------------

2005年某月、lirisさんとこの `COREBlogのコメントスパム対策 ― Emerge Technology`_ を参考に、buzz wordsフィルタリングを行ってみる。禁止語辞書は過去のspamとかから抽出。20語くらい追加したところで、ふと思い立って ``href`` を禁止語に加えてみる。効果覿面。

同じ時期に、せとみつさんも `blogSetomits : コメントスパム弾き実験 3`_ とか `blogSetomits : COREBlog で言及リンクのない TrackBack ping を弾く`_ とか色々とされていた。

.. _`COREBlogのコメントスパム対策 ― Emerge Technology`: http://www.liris.org/blog/626

.. _`blogSetomits : コメントスパム弾き実験 3`: http://matatabi.homeip.net/blog/setomits/473

.. _`blogSetomits : COREBlog で言及リンクのない TrackBack ping を弾く`: http://matatabi.homeip.net/blog/setomits/437


COREBlog2 設置初期
--------------------

2005年11月29日。Zopeを2.7系から2.8系に、Ploneを2.0.5から2.1.1に、そしてCOREBlog1からCOREBlog2αに移行した。移行直後はコメント投稿設定を間違っていたため一切のコメントが投稿できない状態だった。ところがこれを許可したとたん、ものすごい数のspam投稿が。この時点ではまだbuzz wordsフィルタをCOREBlog2用に作っていなかったので、一時コメント投稿を禁止せざるをえくなったりもした。


COREBlog2 フィルタ期
---------------------

2005年12月15日。buzz wordsフィルタをCOREBlog2用に作って設置(`COREBlog2簡易spam-filter ― 清水川Web`_)。これでspamを防げるかと思いきや、PloneとCOREBlog2のコードとかskinとかを知らないと出来ない方法でのspam投稿があることに気づく。Control Page Template の validator を回避して直接投稿してきていた。しかもaction先URLは普通の投稿と同じく見えるように細工までしてあった。 ``:method`` を使ったとしか思えない手の込みよう。

最終的には、直接投稿かどうかを判別する仕組みをCOREBlog2のskinカスタマイズで埋め込んで対処(`[COREBlog 1396] validateCommentを回避`_)。この回避方法で、403を返すようにしたためか、これ以降spamのPOSTリクエストがかなり減少する。

.. _`COREBlog2簡易spam-filter ― 清水川Web`: http://www.freia.jp/taka/blog/coreblog27c216613spam-filter/

.. _`[COREBlog 1396] validateCommentを回避`: http://mail.webcore.co.jp/pipermail/coreblog/2005-December/001395.html


現代
-----
今月は今のところ97件。そのうち以下のIPアドレスが6割を占めているので、さっそくapacheでspam様用にブロックすることにする::

  200.79.91.5
  209.190.4.10
  209.190.4.106
  209.67.219.178

問題は残りの4割。これらはほとんどが異なるIPアドレスなので、やはりbuzz wordsでフィルタするしか無いかと思う。コストの割に効果が高いので、個人サイトならこれでいいや。

別のアプローチとしては、投稿時に画像に書かれた文字列を入れてもらうCAPTCHAを使った方法がある(`COREBlog(2じゃない方)でCAPTCHA ― TRIVIAL TECHNOLOGIES 2.0`_)。面倒がってないでこの方法を導入するのがいいのかもしれない‥‥。


.. _`COREBlog(2じゃない方)でCAPTCHA ― TRIVIAL TECHNOLOGIES 2.0`: http://coreblog.org/ats/coreblog-de-captcha



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 307
:date: 2006-01-29 23:55:00
:title: My自転車に初乗り60km
:categories: ['misc']
:body type: text/x-rst
:body:
土曜日に調布から秋葉原付近にあるaihtena宅まで自転車で行ってみました。途中、裏道を探しながら走ってたら迷子になってしまいました。うーん、ナビが欲しいな‥‥無料で。結局35kmくらいを2時間半かけてのんびりと走りました。

土曜日はそのままaihatena宅に泊まり、秋田の友人達とちゃんんこを食って寝ました。

日曜日は秋葉原付近でZopeなあつまりに顔を出してから帰宅。25kmを1時間半くらいで帰ってきました。もうくたくたです。ほんとに明日から自転車通勤(片道17km)出来るのかな・・・。あ、明日はだめか。あさっては雨？うーん・・・。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-01-30.4889926076
:title: Re:My自転車に初乗り60km
:author: i?
:date: 2006-01-30 11:01:30
:email: 
:url: 
:body:
お疲れさんです。
カーナビあっても見る暇なさそうだし、ポケット地図でも持ち歩くしか?
%%%%%%%%%

:id: 308
:date: 2006-01-30 13:02:25
:title: Plone2.5 最初のα版
:categories: ['Plone']
:body type: text/x-rst
:body:
Plone2.5 最初のα版が出ました。 `Ploneサイトに掲載されたニュース`_ の一部をざっと意訳してみたので、時間のある人はニュースの最後の方にある協力依頼に応えてみてはどうでしょう？

.. _`Ploneサイトに掲載されたニュース`: http://plone.org/news/first-plone-2-5-alpha-released

以下、意訳。

:extend type: text/x-rst
:extend:

Plone 2.5 最初のα版をリリース
================================
2006/1/29 13:21 by Alec Mitchell

PloneチームはPlone2.5の最初の公式プレビューをリリースします。このバージョンはインフラの変更にフォーカスしています。

α版に含まれている新機能
---------------------

- PloneでZope3 MessageIDsを使う機能; これはpythonで翻訳機能を実装するオフィシャルな方法です (plip108_)
- ステータスメッセージをクエリ文字列で渡す機能を廃止し、Zope3的なグローバルユーティリティーを利用します。このため、メッセージの翻訳や複数のメッセージを表示することが出来ます。(plip111_)
- PloneはCMFPlacefulWorkflowを同梱します。このため、ポータル内の場所毎に独立した type->workflow マッピングを行うことが出来ます。(plip52_)

.. _plip108: http://plone.org/products/plone/roadmap/108
.. _plip111: http://plone.org/products/plone/roadmap/111
.. _plip52: http://plone.org/products/plone/roadmap/52

今後のリリースで実装される機能
---------------------------

- 認証メカニズムをGroupUserFolderからPAS/PlonePASに入れ替え、Pluggableで拡張可能なシステムにします。(plip102_)
- Replacing the current python site creation mechanisms with an XML driven portal setup using GenericSetup. (plip113_)
- 多くのpython script、ツール関数、ユーティリティーテンプレートをZope3 Browser Viewに入れ替えます。(plip105_, plip106_)

.. _plip102: http://plone.org/products/plone/roadmap/102
.. _plip113: http://plone.org/products/plone/roadmap/113
.. _plip105: http://plone.org/products/plone/roadmap/105
.. _plip106: http://plone.org/products/plone/roadmap/106

重要！ あなたに手伝って欲しい事
----------------------------

- **インストールやアップグレード** インスタンスをバックアップして、Plone 2.5にしてください。そしてマイグレーションの問題やバグを見つけたらIssue Trackerに報告してください。多くのマイグレーションと報告が行われれば、最終リリースまでにあなたのサイトを問題なくマイグレーション出来るようになると思います。
- **テスト** α版を多くの環境でセットアップして、問題を報告してください。
- **あなたのプロダクトをPlone2.5αでテストしてください** 。もしあなたがサードパーティの開発者なら、あなたのコードをPlone2.5の環境に合わせてアップグレードする事で、スケーラブルでファスターになるでしょう。開発者メーリングリストがあなたの助けになるでしょう。
- もし上記の機能を完了したりデバッグするのを手伝いたいのであれば、PLIPの著者と連絡を取ってください。
%%%%%%%%%

:id: 309
:date: 2006-02-03 23:57:09
:title: 初自転車通勤
:categories: ['misc']
:body type: text/x-rst
:body:
今日は初めて自転車で通勤しました。社会人になってから初です。

朝は30分以上余裕を見て出発したら、電車通勤とそんなに変わらない時間で到着してしまい、いつもよりかなり早く着いてしまいました。というか汗だくだったので結構頑張ってしまったようです。でもそんなに疲れた感じも無く仕事しました。しかし、帰りがものすごく寒い＆風が強くて大変でした。途中で凍えて死ぬかと思った。運動してるのに体温が下がる一方ってのはどうなのよ、と。

それにしても、一日往復約40km、どのくらいのペースで続けられるだろう・・・。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-02-04.8942363528
:title: Re:初自転車通勤
:author: masaru
:date: 2006-02-04 14:44:55
:email: 
:url: 
:body:
継続は力なり、トリノ目指して頑張ろう(*￣_￣)９″

:comments:
:comment id: 2006-02-04.8179529240
:title: Re:初自転車通勤
:author: 清水川
:date: 2006-02-04 16:56:59
:email: 
:url: 
:body:
え゛？自転車でトリノまで行くの？

:comments:
:comment id: 2006-02-11.5453038142
:title: Re:初自転車通勤
:author: shinobu
:date: 2006-02-11 23:35:46
:email: 
:url: http://nakaj.net/Nikki
:body:
私も似たことをしてたのですが、週3回が限度でした。
そのほか、遅くまでプログラミングしてしまった帰りは非常につらかったし、
酒を飲んだ後はもってのほか。その翌日も。
折りたたみ自転車でやっていたのでつらいときは畳んで電車で帰ってました。
でも2年近くやっていて体力は非常につきました。11回まで息を切らさず昇れるくらいまで。

やめたとたんリバウンドして8キロ太りましたけど、、、。

:comments:
:comment id: 2006-02-11.5534430317
:title: Re:初自転車通勤
:author: shinobu
:date: 2006-02-11 23:35:53
:email: 
:url: http://nakaj.net/Nikki
:body:
私も似たことをしてたのですが、週3回が限度でした。
そのほか、遅くまでプログラミングしてしまった帰りは非常につらかったし、
酒を飲んだ後はもってのほか。その翌日も。
折りたたみ自転車でやっていたのでつらいときは畳んで電車で帰ってました。
でも2年近くやっていて体力は非常につきました。11回まで息を切らさず昇れるくらいまで。

やめたとたんリバウンドして8キロ太りましたけど、、、。

:comments:
:comment id: 2006-02-11.6138813916
:title: Re:初自転車通勤
:author: Anonymous User
:date: 2006-02-11 23:36:53
:email: 
:url: 
:body:
ありゃ、二重投稿になってしまった。すみません

%%%%%%%%%

:id: 310
:date: 2006-02-05 17:26:23
:title: SilverCity-0.9.6がうまく動かない
:categories: ['python']
:body type: text/x-rst
:body:
SilverCity-0.9.6がうまく動かない。
問題点をSourceForgeにバグ報告したので、次のバージョンでは直って欲しいな。


:extend type: text/x-rst
:extend:
0.9.6を以下のように実行するとexceptする。

.. code-block:: Python

  >>> from StringIO import StringIO
  >>> out = StringIO()
  >>> from SilverCity import LanguageInfo
  >>> pgen = LanguageInfo.find_generator_by_name('python')()
  >>> pgen.generate_html(out,'import test')
  Traceback (most recent call last):
    File "<stdin>", line 1, in ?
    File "/usr/local/lib/python2.4/site-packages/SilverCity/Python.py", line 60, in generate_html
      lexer.tokenize_by_style(buffer, self.event_handler)
    File "/usr/local/lib/python2.4/site-packages/SilverCity/Lexer.py", line 8, in tokenize_by_style
      call_back
  TypeError: expected sequence of 2 WordLists (1 provided)

調べてみたら、0.9.6で取り込んだscintillaのコードにpython-wrapperが対応できていないようだ。以下のように修正したところ、正しく動いているようだ。

SilverCity-0.9.6/PySilverCity/SilverCity/Python.py (13-15)の

.. code-block:: Python

        self._keyword_lists = [
            WordList(Keywords.python_keywords)
                            ]

を以下のように修正。

.. code-block:: Python

        self._keyword_lists = [
            WordList(Keywords.python_keywords),
            WordList(),
                            ]
%%%%%%%%%

:id: 311
:date: 2006-02-10 23:55:00
:title: デブサミ2006 ～ ZopeEssentials3
:categories: ['Event']
:body type: text/x-rst
:body:
今日は `デブサミ`_ 2日目＆ `ZopeEssentials3`_ でした。

Developers Summit 2006
------------------------

- `小島さん＆中西さんのライトニングトークス`_
- `角谷さんのプロジェクトファシリテーション＆プロジェクトオートメーション話`_
- `XPJUGのXP2.0`_

を聞いてきました。微妙にXP/Agileに偏っている気がします。XP2.0は、XPで社会のあり方を変えよう！というテーマでした。特に日本の受発注構造が本家XPとそぐわない部分が多いので、そういう部分について発想を逆転させよう、というお話でした。どう発想を逆転するかというと、「提案→受注→契約→仕様策定→開発」という流れを「提案用に開発→受注→契約→仕様策定(というか提案時に開発したものへの機能追加)→開発(というか既に保守フェーズ)」としよう！ということです。これならイテレーティブでインクリメンタルな開発をするのが当たり前だし、提案時に成果物が必要なので開発会社の能力が分かるし、良いことずくめです。はやくこんな世界にしたいものです。

ところで、デブサミ会場ではJZUGのブースを出していたのですが、ほとんど誰も立ち止まってくれません。高校の後輩（ほりい君）や、ObjectClubのあまんにょさんとか知り合いとの遭遇率はめちゃくちゃ高いのですが‥‥。やはりIBM・Microsoftが協賛のイベントということでしょうか。そういえば、会場でMicrosoft水が配られていました。一説によると、IT会社が水を売り始めるとヤバイらしいです。某F&●やWZの販売会社も水を売っていたようなので、今後のMicrosoftの動向には気をつけないといけない気がします。

.. _`デブサミ`: http://www.seshop.com/event/dev/2006/
.. _`小島さん＆中西さんのライトニングトークス`: http://www.seshop.com/event/dev/2006/timetable/Default.asp?mode=detail&eid=61&sid=346&tr=05%5F%8AJ%94%AD%83e%83N%83m%83%8D%83W%81%5B
.. _`角谷さんのプロジェクトファシリテーション＆プロジェクトオートメーション話`: http://www.seshop.com/event/dev/2006/timetable/Default.asp?mode=detail&eid=61&sid=302&tr=03%5F%83t%83%40%83V%83%8A%83e%81%5B%83V%83%87%83%93
.. _`XPJUGのXP2.0`: http://www.seshop.com/event/dev/2006/timetable/Default.asp?mode=detail&eid=61&sid=303&tr=05%5F%8AJ%94%AD%83e%83N%83m%83%8D%83W%81%5B


Zope Essentials 3
------------------

デブサミ会場のJZUGブースを撤収した後は、 `ZopeEssentials3`_ でした。目黒から有楽町に移動してイベントを開催しました。今回の参加者数は定員一杯の30人でした。質疑応答も技術的内容から運用の話まででました。「Zope/Ploneのバージョン選択とアップグレード時のMigrationの難しさ」について、などの質疑応答もありました。忘れないうちにまとめてイベントレポートかかないと。そのうちZopeEssentials3のページに載せようと思います。

.. _`ZopeEssentials3`: http://zope.jp/events/zopeessentials/3


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 312
:date: 2006-02-11 23:58:58
:title: Zope3勉強会に参加しました
:categories: ['Event', 'Zope']
:body type: text/x-rst
:body:
今日はニューフェースが二人も増えました。こりゃアダプタの説明とかを簡単にしないといけないのかな、と思っていたらかなり詳しくてそんな必要はなかったり。やはり自分みたいに勉強会の時しか触らないようではイカンということですな。

内容について、詳しくは今日の議事録を参照のこと。 http://qwik.jp/zope3study/45.html でも議事録書いたのが自分なので嘘があるかも。鵜呑みにしちゃだめです。

それにしてももう十一回。次は十二回目で丸1年になります。早いモノだ。

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-02-12.7752477685
:title: Re:Zope3勉強会に参加しました
:author: masaru
:date: 2006-02-12 00:29:35
:email: 
:url: 
:body:
きんぐお疲れ様でした(・∇・)

%%%%%%%%%

:id: 313
:date: 2006-02-17 01:18:55
:title: 気がつくとiPodの電池が切れている
:categories: ['IT-PC']
:body type: text/x-rst
:body:
なんか、1週間ぶりくらいにポケットに入れっぱなしだったiPodで曲を1時間くらい聞いたら、電池が切れた。USBケーブルは持ち歩いてないので、これを期にUSB充電用ケーブルを購入。

買ったのは `CenturyのiArm`_ (iPodと繋がるUSBアダプタの方)と、 `ダイヤテックのモバイルクルーザー`_ (USBに電力を供給する方)。どちらもヨドバシで1280円。この組み合わせとノートPCがあればいつでもどこでも充電可能！これで自宅で充電なんてしなくても大丈夫！

というか、普通の人は毎日充電するんだろうなぁ。元々ケータイも電池が切れるまで充電しないという使い方だしなぁ。


.. _`CenturyのiArm`: http://www.century.co.jp/products/mac/iarm.html
.. _`ダイヤテックのモバイルクルーザー`: http://www.diatec.co.jp/products/det.php?prod_c=294

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-02-17.7912394990
:title: Re:気がつくとiPodの電池が切れている
:author: masaru
:date: 2006-02-17 21:03:12
:email: 
:url: 
:body:
某会社で携帯を充電しようにもコンセント
がふさがっていて困ったことがありました。
＃会社で充電するなよ・・・
そんなときUSBから電力を取って充電するものを見つけ
ノートPCから充電しようとしたのですが
待てど暮らせど携帯は充電完了にならずorz...

:comments:
:comment id: 2006-02-17.2381711351
:title: Re:気がつくとiPodの電池が切れている
:author: 清水川
:date: 2006-02-17 23:07:18
:email: 
:url: 
:body:
> 待てど暮らせど携帯は充電完了にならずorz...

そんな時のためにコンセントからも給電可能！

%%%%%%%%%

:id: 314
:date: 2006-02-21 01:10:00
:title: なぜZSQLMethodの返値はdict準拠じゃないのだろう
:categories: ['Zope']
:body type: text/x-rst
:body:
今日コードを書いていてZSQLMethodの返値がどんな型なのか気になった。

例えば、ZSQLMethodに値を渡す場合、キーワード引数にする必要があるので

.. code-block:: Python

  kwargs = {
    'id': 10,
    'name': 'hoge',
    'age': 20,
  }
  zsqlmethod_update(**kwargs)

とか書くことが多い。さらに、取得したレコードの値を書き換えて書き戻すような場合、

.. code-block:: Python

  records = zsqlmethod_select()

  r = records[0]
  # update record data here.
  r['name'] = 'fuga'
  r['age'] = 30

  zsqlmethod_update(**r)

とやりたいところだけど、zsqlmethodの返値は辞書型じゃないのでこんな事は出来ない(キーワード引数に展開されない)。結局、

.. code-block:: Python

  records = zsqlmethod_select()

  r = records[0]
  keys = records.names()
  dict_r = dict(zip(keys,list(r)))

  # update record data here.
  dict_r['name'] = 'fuga'
  dict_r['age'] = 30

  zsqlmethod_update(**r)

こんなコードになってしまった。

こんなコードになってしまってから、返値の型が書かれている Zope-2.8.5/lib/python/Shared/DC/ZRDB/Results.py をぼーっと眺めていたら、 ``dictionaries`` とかいうMethodがある。なんだコレ使えばいいんだ‥‥。

dict準拠じゃないけどdictには変換できる。その心は‥‥返値がいきなりdict準拠だと書き換え可能だから‥‥かな？


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 315
:date: 2006-02-22 01:30:00
:title: ZopeTestBrowserを使ってみる
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
Zopeから独立したPythonパッケージとして使える ZopeTestBrowser-1.0.0 を使ってみようとしたら、依存してるモジュールが多かったのでどうしたもんかと色々調べてみたら、Zope-2.9.0にふつーに入ってた。Zope2.9.0ではZope3の色々な機能が使えるようになっている。zope.testbrowser もそのうちの一つで、UnitTestコードを書くときにこれがあるとテストの幅が広がるんじゃないかと思う。

ちなみに、ZopeTestBrowser-1.0.0ではGenerator式が使われてるので、そのままではPython-2.3系で動作しない。もしかしたら、ちょっと書き換えたら動くかもしれない。しかしPython-2.3系で使えないと現行のZope用UnitTestに使おうと思うとネックになるかもしれない。

とりあえず気を取り直して、チュートリアルに従ってPythonのコンソールから以下のように動かしてみた。


:extend type: text/x-rst
:extend:

.. topic:: Python
    :class: dos

    | >>> from zope.testbrowser.browser import Browser
    | >>> browser = Browser()
    | >>> browser.open('http://localhost:8080/')
    | >>> browser.url
    | 'http://localhost:8080/'
    | >>> '<title>TopPage</title>' in browser.contents
    | True
    | >>> browser.isHtml
    | True
    | >>> browser.title
    | 'TopPage'
    | >>> print browser.headers
    | Server: Zope/(Zope 2.7.7-final, python 2.3.5, win32) ZServer/1.1
    | Date: Tue, 21 Feb 2006 15:15:12 GMT
    | Content-Length: 572
    | Connection: close
    | Content-Type: text/html; charset=utf-8
    | >>> browser.headers['content-type']
    | 'text/html; charset=utf-8'
    | >>> browser.reload()
    | >>> link = browser.getLink('Hello')
    | >>> link
    | <Link text='Hello' url='http://localhost:8080/subfolder/hello_html'>
    | >>> link.text
    | 'Hello'
    | >>> link.tag
    | 'a'
    | >>> link.url
    | 'http://localhost:8080/subfolder/hello_html'
    | >>> link.attrs
    | {'href': 'subfolder/hello_html'}
    | >>> link.click()
    | >>> browser.url
    | 'http://localhost:8080/subfolder/hello_html'

他に、Formへの入力とかいろいろあり。Basic認証とかもできるらしい。詳しくは `zope/testbrowser/README.txt`_ を参照のこと。（リンク先はZope3のもの。Zope2.9.0のと同じ。）

`DevCamp2006w`_ 向けにUnitTestを調べてたはずなのに、今回はコレは使えないかも。残念。

.. _`zope/testbrowser/README.txt`: http://svn.zope.org/Zope3/trunk/src/zope/testbrowser/README.txt?rev=41673&view=markup
.. _`DevCamp2006w`: http://coreblog.org/camp/2006w/

----------------

追記: 「UnitTestコードを書くときにこれがあるとテストの幅が広がるんじゃないかと思う。」と思ったけど、ZopeUnitTest中のインスタンスにhttpアクセスできないので、そう言う用途には使えないかも。じゃあZope-2.9.0のzope.testbrowserはどういう時に使うんだろう？要調査。

追記2: Zope/lib/python/zope はZope-2.8系から入っている。zope.testbrowserは2.9.0から。
%%%%%%%%%

:id: 316
:date: 2006-02-23 01:32:38
:title: ZopeProductのテストを実行してみよう
:categories: ['Zope']
:body type: text/x-rst
:body:
ZopeのProductには大抵testsディレクトリが付属していて、そのProductの機能が正しく動作するかどうかのテストを行うことが出来る。

Zope2.7, 2.8系では ``zopectl test`` と実行すれば全Productのtestsが実行されたのだけど、Zope2.9.0ではtest.pyが無いため動作しない。また、そもそもWindows環境ではzopectlが使えない。ということで、こういう環境でテストを実行するためには環境変数等、それなりの環境を用意してテストを実行してあげないといけない。とりあえず一つのプロダクトのテストを実行するには、以下のようにする(例はWindowsの場合)。

1. runzope の中の環境変数設定をコピーしてDOS窓で実行する
2. 目的のプロダクトのtestsディレクトリに移動する
3. ``%PYTHON% runalltests.py`` を実行する

これでうまくいけば以下のような結果が表示される。


:extend type: text/x-rst
:extend:

.. topic:: runalltests.py
  :class: dos

  | C:> @set PYTHON=C:\Python24\python24.exe
  | C:> @set ZOPE_HOME=C:\Zope-2.9.0
  | C:> @set INSTANCE_HOME=C:\zope290instance
  | C:> @set SOFTWARE_HOME=C:\Zope-2.9.0\lib\python
  | C:> @set CONFIG_FILE=C:\zope290instance\etc\zope.conf
  | C:> @set PYTHONPATH=%SOFTWARE_HOME%
  |
  | C:> %PYTHON% runalltests.py
  | SOFTWARE_HOME: C:\Zope-2.9.0\lib\python
  | INSTANCE_HOME: C:\zope290instance
  | Loading Zope, please stand by 
  |
  | 中略
  |
  | ----------------------------------------------------------------------
  | Ran 11 tests in 1.781s
  |
  | OK

中略の部分にたくさんのDeprecationWarningが出るけど、気にしない方向で。

ということで、 `最小Procutにもテストコード`_ を書いてみた。framework.py, runalltests.py は Zope-2.9.0/lib/python/Testing/ZopeTestCase/ からのもらいもの。実行には `PloneTestCase`_ とPlone-2.1.2が必要。


.. _`最小Procutにもテストコード`: http://svn.freia.jp/open/ATCTSmallSample/trunk/tests/
.. _`PloneTestCase`: http://plone.org/products/plonetestcase

%%%%%%%%%

:id: 317
:date: 2006-03-02 23:19:59
:title: 明日からZope山ごもり
:categories: ['misc']
:body type: text/x-rst
:body:
あっというまにキャンプ前日。今週は買い出しに出る暇もなかった。

結局準備ほとんど出来てないよ！きっと、スキー場でウエアとか板とかキャップとかゴーグルとか貸してくれるよ！スキー靴だけ持って行っても大丈夫だよ！

さて、明日は5時起きなのでもう寝ないと‥‥。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 318
:date: 2006-03-05 01:11:12
:title: ZopeDevelopersCamp2006w
:categories: ['Event', 'Zope']
:body type: text/x-rst
:body:
`ZopeDevelopersCamp2006w`_ に初参加中！ 初日は10時から4時過ぎまで滑ってました。
スキーは実に7年ぶり。キャンプ中は色々なTipsがどんどん共有されていきます。あとでまとめてキャンプサイトに登録しなきゃ。

TDD良いよ、TDD。

------------

キャンプ参加者のBlogに面白い写真が。

- `ゲレンデに出張メイド!? - Weboo! Returns.`_
- `猿きた!　- takanory.net`_

.. _`ZopeDevelopersCamp2006w`: http://coreblog.org/camp/2006w
.. _`ゲレンデに出張メイド!? - Weboo! Returns.`: http://yamashita.dyndns.org/blog/moblog2006-03-04-16-41
.. _`猿きた!　- takanory.net`: http://takanory.net/takalog/491


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-03-05.1864010133
:title: Re:ZopeDevelopersCamp2006w
:author: masaru
:date: 2006-03-05 17:26:27
:email: 
:url: 
:body:
TDDってなんだろうくん？

:comments:
:comment id: 2006-03-07.3518192689
:title: Re:TDD
:author: taka
:date: 2006-03-07 01:42:32
:email: 
:url: 
:body:
TestDrivenDevelopment. テスト駆動開発。ほんとはこのへんもキャンプでやりたかったっす。

:comments:
:comment id: 2006-03-08.6323843097
:title: Re:ZopeDevelopersCamp2006w
:author: chewganabira
:date: 2006-03-08 01:07:13
:email: 
:url: 
:body:
「釈迦に説法」かとは思いますが、最近では、もはや TDD という呼び方は古くて(というか的を得ていなくて)、BDD(Behavior Driven Development)なんだそうですね。

つまらないコメントについて何卒、寛恕を請う次第です。

.. `A NEW LOOK AT TEST-DRIVEN DEVELOPMENT`:
  http://log.giantech.jp/BDDIntro-ja.html


:comments:
:comment id: 2006-03-08.3133724322
:title: Re: BDD
:author: 清水川
:date: 2006-03-08 10:28:34
:email: 
:url: 
:body:
> もはや TDD という呼び方は古くて(というか的を得ていなくて)

そうですね。古くからTDDをやっているXPerな人たちにとってはBDDの方が全体を俯瞰した呼称だとおもいます。概念に名前が追いついたという感じですね。自分的にはまだBDDは使い慣れない言葉だという感じがあるので、意識してないとTDDと書いてしまいます(^^;;

あぁ、BDDがTDDよりも上位の概念なので、テストコードを書く動機としては間接的に感じてるのかも。

%%%%%%%%%

:id: 319
:date: 2006-03-09 00:15:08
:title: FinalFantasyのポーションは630円
:categories: ['misc']
:body type: text/x-rst
:body:
ファミマで発見FFポーション。とみたにCメールで教えたら早速買ってもってきた。ていうか0時回ってからくるなよぉぃ。

写真ではわかりにくいけど、フタは乗っかってるだけで閉められない。なので、入れ物を再利用するのは難しそう。これがちゃんと閉められるようになってれば一本くらい買っても良いと思ったのに‥‥。

このへん http://www.suntory.co.jp/softdrink/FF/ に通常版200円の写真もあるけど、ぜんぜんポーションっぽくないな。というかFFの世界の人たちは装飾華美ですな。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-03-09.1866152940
:title: Re:FinalFantasyのポーションは630円
:author: masaru masara masaruga
:date: 2006-03-09 22:16:27
:email: 
:url: 
:body:
ポーションが５０ギルだから１ギル１２．６円かな

:trackbacks:
:trackback id: 2006-03-19.4349202880
:title: ポーション飲んでどうなった？
:blog name: オキラクでいいよね？
:url: http://nrsor.blog.ocn.ne.jp/nrsor/2006/03/post_8770.html
:date: 2006-03-19 00:40:36
:body:
ついに、FINAL FANTASY グッズであるポーションを買ってみました。つい

%%%%%%%%%

:id: 320
:date: 2006-03-09 00:32:53
:title: デスクトップキャプチャFlash
:categories: ['IT-PC']
:body type: text/x-rst
:body:
デスクトップ操作やWeb操作の様子を時々Flashにして視覚的にわかりやすく伝える。これを実現するために今までは `wink`_ というフリーウェアを使っていた。しかし、このツールはなかなか融通が利かないところがあって、もうちょっと使いやすいツールはないかと考えていた。個人的に欲しい機能は、

- 一定間隔(秒間4枚とか)で全画面キャプチャ
- キャプチャ画像の前後の差分を抽出してFlash化
- ストリーミング(?)再生
- 日本語の正式対応
- １コマ削除するのに10秒とか待たされない編集機能

ということでGoogleで探してみた。で、CamStudioというのを見つけたんだけど‥‥

`CamStudio(窓の杜)`_ -> `CamStudio`_ -> `Macromedia Captivate`_

気がついたらMacromediaサイトに誘導されていた。なぜだ。$499払えと言うのか。‥‥とりあえず30日トライアル版を使ってみるか。

.. _`wink`: http://www.debugmode.com/wink/
.. _`CamStudio(窓の杜)`: http://www.forest.impress.co.jp/article/2003/03/05/camstudio.html
.. _`CamStudio`: http://www.rendersoftware.com/
.. _`Macromedia Captivate`: http://www.macromedia.com/software/robodemo/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 321
:date: 2006-03-09 00:58:27
:title: 「Ploneによる簡単Webコンテンツ管理」 発売
:categories: ['Plone']
:body type: text/x-rst
:body:
「Ploneによる簡単Webコンテンツ管理」という本が出たようです。対象読者は初級者とのことなので、UI面の記述が中心なのかな？ こんど本屋さんに行ったらチェックしてみよう。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 322
:date: 2006-03-10 02:15:56
:title: Ploneプロダクト作成テンプレート with 日本語詳細コメント
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
`ZopeDeveloperCamp2006w`_ で取り組んだ ``ATCTSmallSample日本語コメント大量入れ込みバージョン`` が完成しました。といっても途中手抜きもありますが、結果としてコメントを入れる前に比べてテキストサイズが2倍になっているので、読み応えはあると思います。また、個人的な裏目標として、TDD/BDD推進のためにTestについてもそれなりに書いたつもりです。

あ、CMS/Blog EXchangeの資料をText化して入れるの忘れてた。ま、いいか。

Subversion:
- http://svn.freia.jp/open/ATCTSmallSample/tags/0.2-with-jpcomments

圧縮ファイル版は `PloneSVNView`_ からどうぞ(下の方にexport zipがあります):

.. _`ZopeDeveloperCamp2006w`: http://coreblog.org/camp/2006w/
.. _`PloneSVNView`: http://www.freia.jp/taka/svn/svnview?subpath=ATCTSmallSample/tags/0.2-with-jpcomments


# あとは、Campサイトへの登録とplone.orgへの登録か。

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 323
:date: 2006-03-10 23:49:20
:title: 怒濤の7日間は日曜まで
:categories: ['misc']
:body type: text/x-rst
:body:
先週の日曜夜にZopeCampから帰ってきてそのまま深夜まで自宅で仕事、平日はいつもより遅くまで仕事、そして明日・明後日は朝7時までに会社に行って仕事。この間、ZopeCampのまとめをしたり、Blood+を見たり、Plone.orgにアカウントを作ったり、英雄伝説VI空の軌跡SCをインストールしたり、Ar tonelicoのサントラ『星詠』『月奏』を延々と聞いたりした。

`Ar tonelico`_ は、とみたがゲームやってるところをちょっと見ただけだけど、曲は良い！ていうか超好き！サントラCDは、舞台設定とメロディーと歌詞と歌詞カードが引き立てあってる感じ。JAM Project聞いてる場合じゃないッスよ！（嘘）

.. _`Ar tonelico`: http://ar-tonelico.jp/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 324
:date: 2006-03-12 12:52:37
:title: モスライス カツカレー
:categories: ['food']
:body type: text/x-rst
:body:
今日も朝7時から出勤。

昼にモスバーガーを食べたくなったので市ヶ谷駅前まで買いに出た。

モスライスカツカレーなるものを食べてみた。

‥‥

何食べてるんだかよく分からなかった。

カレーはおとなしく挟まっていてはくれないようだ。

というかモスバーガー食べたかった。

モスの日とやらでもらった日々草はうちに帰ったら水をやってみよう。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-03-12.0164621724
:title: Re:モスライス カツカレー
:author: masaru
:date: 2006-03-12 18:50:18
:email: 
:url: 
:body:
7時ですか
お疲れさまでした

%%%%%%%%%

:id: 325
:date: 2006-03-13 22:26:50
:title: plone.orgにプロダクトを登録してみた
:categories: ['Plone']
:body type: text/x-rst
:body:
先日のZopeキャンプの成果を `plone.orgに登録`_ してみました。プロダクトの登録申請をしてから許可が下りるまで4日くらいかかりましたが、特にメールが来るでもなく、いつのまにか許可が下りてました。意外と簡単に許可くれるもんだなぁ。

1. plone.orgにアカウントを作る
2. /products でプロダクトを登録する(この時点では概要文のみ)
3. 登録したプロダクトをreview状態に設定する
4. 数日後にpublishされる。メールとかはこない
5. Release物を登録する(初期状態は"将来のリリース")
6. Release物をmake release(公開！)するとTOPページ等に表示される

さすがに概要文とか日本語Onlyはまずいかと思って嘘っぽい英語を書いてみました。一番時間がかかった部分かもしれません。(現状)日本人向けなので、日本語の説明も併記してあります。そういえばplone.orgって日本語で表示されないのね。

登録したプロダクトは、ATContentTypesベースのプロダクトを書くのに必要な情報を‥‥というかほぼ全てのコードに日本語のコメントを付けて、ATCTプロダクトを作る上でひつような情報を取捨選択できるようにしたコードサンプルです。これで、「Ploneプロダクトを作るのは色々面倒そう‥‥」というハードルを下げられればいいなぁ。

ということで、登録記念にスクリーンショットを撮ってみたり。

.. _`plone.orgに登録`: http://plone.org/products/atctsmallsample


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 326
:date: 2006-03-13 22:31:02
:title: 秋葉原クロスフィールドで電動カー発見
:categories: ['misc']
:body type: text/x-rst
:body:
日曜日に秋葉原クロスフィールドに行ったら、時速300km以上で走る電動カーの実機が展示してあった。普通に公道を走れるらしい（ナンバープレート付いてた）。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-03-13.7696333296
:title: Re:秋葉原クロスフィールドで電動カー発見
:author: masaru
:date: 2006-03-13 22:49:30
:email: 
:url: 
:body:
クロスフィールドって駅の構造があーだからかな
ATCTSmallSampleの公開お疲れ様でした

:trackbacks:
:trackback id: 2006-03-15.6496337560
:title: COREBlog2縺ｮ髢｢騾｣繧ｪ繝悶ず繧ｧ繧ｯ繝医陦ｨ遉ｺ
:blog name: Blog
:url: http://www.majingaa.com/blog/coreblog2306e95a2902330aa30a730af30c8306e8868793a
:date: 2006-03-15 22:34:11
:body:
 COREBlog2の関連オブジェクトは、文章中の「上部に横に並べる」とか、「左に縦にならべる」などのレイアウトができる。しかし、FireFoxだとちゃんと表示されるのだが、IE6だとなぜかすべて中央に表示されていた。 しらべてみるとIE6がCSSのflo...

:trackbacks:
:trackback id: 2006-03-15.7435772609
:title: COREBlog2縺ｮ髢｢騾｣繧ｪ繝悶ず繧ｧ繧ｯ繝医陦ｨ遉ｺ
:blog name: Blog
:url: http://www.majingaa.com/blog/coreblog2306e95a2902330aa30a730af30c8306e8868793a-1
:date: 2006-03-15 23:34:12
:body:
 COREBlog2の関連オブジェクトは、文章中の「上部に横に並べる」とか、「左に縦にならべる」などのレイアウトができる。しかし、FireFoxだとちゃんと表示されるのだが、IE6だとなぜかすべて中央に表示されていた。 しらべてみるとIE6がCSSのflo...

%%%%%%%%%

:id: 327
:date: 2006-03-26 16:00:00
:title: 野川サイクリング to 国分寺
:categories: ['food', 'bicycle']
:body type: text/x-rst
:body:
3月のZope合宿以降、土日出勤でOSCにも参加できなかった日々もようやく終わり、土曜日はZope3勉強会、そして日曜日は、ルイガノなとみたと二人で野川をサイクリングしつつ国分寺まで行ってきました。目的地は `すた丼`_ です。

学生時代はけっこう食べに来たのに、社会人になってから来たのは初めて。強烈なニンニク臭に負けずに並盛りをいただきました。とみたや現地集合したTake2はミニすた丼。勝ったな‥‥。

片道10kmを40分くらいと、結構近かったので、こんどはスタミナカレーを食べに来ようかな。

.. _`すた丼`: http://www.sutadon.com/shop-koku.htm


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 328
:date: 2006-03-28 20:48:09
:title: 防衛庁の桜
:categories: ['misc']
:body type: text/x-rst
:body:
会社の真ん前にある防衛庁の桜。今週末は花見かな‥‥。

だがしかし、日曜は雨の予報が。果たして来週まで花は残るか!?

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 329
:date: 2006-03-31 02:11:26
:title: 画像に文字列を埋め込むZope3アダプタ
:categories: ['Zope']
:body type: text/x-rst
:body:
3月の `Zope3勉強会`_ で `俳写`_ をZope3でやってみたい、と言う案がさとうさんから出たので、とりあえず `画像と文字列を合成するAdapter`_ を作ってみました。

最初は、画像フィールドとテキストフィールドを表示時に毎回合成する新しいコンテンツタイプを作ったのですが、途中で、Adapterにすれば新しいコンテンツじゃなくても標準の画像(IImage)にAdaptできるという事に気づき路線変更。さらにEventとAnnotationを使って、画像オブジェクトの編集時のみ画像合成するようにしました。Ploneプロダクト作成の発想からZope3の発想にちょっとだけ切り替えられた気がします。

*# Imageクラスを拡張するという発想はかなり正しかったですよ＞さとうさん*

途中、間違ってAnnnotationに自分自身を格納しようとしてシリアライズ出来ないエラーに悩まされたり、Adapterのセキュリティープロクシ周りのzcmlの書き方に悩まされたりと、Zope3の最初の壁をまだ乗り越えられてない感じです。

.. _`Zope3勉強会`: http://qwik.jp/zope3study/
.. _`俳写`: http://www.50pa.com/haisya.html
.. _`画像と文字列を合成するAdapter`: http://qwik.jp/zope3study/53.html


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-03-31.4919162786
:title: Re:画像に文字列を埋め込むZope3アダプタ
:author: masaru
:date: 2006-03-31 21:34:56
:email: 
:url: 
:body:
そのさとうさんって人アイディアだけじゃね？(￣ｍ￣)ぷっ

:comments:
:comment id: 2006-03-31.6710379116
:title: Re:画像に文字列を埋め込むZope3アダプタ
:author: しみずかわ
:date: 2006-03-31 22:11:11
:email: 
:url: 
:body:
じゃ、あとよろしく＞さとーさん

%%%%%%%%%

:id: 330
:date: 2006-04-01 23:09:32
:title: インドに行ってきました
:categories: ['Event', 'food']
:body type: text/x-rst
:body:
今日は絶好の花見日和だったので、 `インドで花見`_ をしてきました。明日日曜日は雨が降るかもしれないので、今日花見をしなくていつするんだという感じですな。

詳しくは `アルバム`_ を参照のこと。。。

.. _`インドで花見`: http://portal.nifty.com/special03/04/09/
.. _`アルバム`: http://www.freia.jp/taka/photo/india2006/


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-04-03.0730375669
:title: Re:インドに行ってきました
:author: masaru
:date: 2006-04-03 23:04:35
:email: 
:url: 
:body:
田舎から遊びに来ていた母を連れてちょうど土曜日九段に遊びに行きましたよ
話題のイタリア大使館は見たけど、知っていたらインド大使館も行きたかったです

%%%%%%%%%

:id: 331
:date: 2006-04-08 00:58:58
:title: 全ページにURLのQRコードを表示するZope3アダプタ
:categories: ['Zope']
:body type: text/x-rst
:body:
先日、 `日本のZope情報`_ 経由で `python で QR コード`_ という記事を見て、早速Zopeで使えるようにZope3用プロダクトを作ってみました。

:Zope.org: http://www.zope.org/Members/shimizukawa/
:SVN: http://svn.freia.jp/open/z3qrcodeadapter
:Download: http://www.freia.jp/taka/svn/svnview/getExportZip?path=z3qrcodeadapter/tags/0.1&revision=117

タイトルとURLから自動生成してくれるので、細かいことを考えずに全ページにQRコードを表示したい場合はこれで十分だけど、ページ毎に埋め込みたい情報が違う場合はもうちょっと手を入れないといけません。

作った勢いついでに、zope.orgにも登録してみました。承認されたらそのうち出てくるでしょう。
あと、パッケージングのためのドキュメントやライセンスのテンプレートが少しずつ溜まってきたので、パッケージングの手間が最初(ATCTSmallほげほげ)に比べたら大分早くなってきた気がします（勢いで30分くらいでzope.orgに登録できるくらいには）。

Zope3用が一段落したので、めんどくさいZope2用の作成をしようと思ったのですが、Five使えば実は簡単に作れるのかな？

.. _`日本のZope情報`: http://coreblog.org/jp/jzi
.. _`python で QR コード`: http://mooya.ath.cx/CubeDeZope/2006/04/20060404004544

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-04-08.6380364954
:title: Re:全ページにURLのQRコードを表示するZope3アダプタ
:author: masaru
:date: 2006-04-08 20:27:19
:email: 
:url: 
:body:
おお、すばらしい

%%%%%%%%%

:id: 332
:date: 2006-04-17 07:09:08
:title: 今週一週間は夜勤やらなんやら
:categories: ['misc', 'work']
:body type: text/x-rst
:body:
おはようございます。3時間寝て朝4時に会社に戻りました＜挨拶

今週は仕事でシステム切り替えを行うので、交代で待機やら対応やらをします。昨日の日曜夕方からさっそく会社に詰めてます。0時頃に一旦近所のホテルで仮眠しましたが、日曜は14時まで寝てたのでなかなか寝付けません。しかも3時間くらい寝たところで交代の時間が来たので会社に戻ってきました。0時にチェックインして4時にチェックアウト。かなり短いです。

システム切り替え作業はほぼ自動化したので、問題はないと思われましたが、ちょっとミスをしてしまい作業をやり直す羽目に。でもプログラムをチューニングして、元々5時間かかっていたものが2時間で終わるようになっていたので、やり直しても致命的な問題にはなりませんでした。データベースをいじるプログラムは奥が深いです。

待機時間中、ノートPCで古いHDDからデータの取り出しをしてます。裸のHDDにUSB変換ケーブルを繋ぎます。デスクトップPCのケースを開けたりしなくていいので、楽ちんです。外付けケースも無いので持ち運びに便利です。3.5inch, 2.5inch, S-ATAの3種類のHDDが接続できてマーベラスです。 `UD-500SA`_ 新宿ヨドバシで3480円でした。これに `裸族の服`_ を着せれば完璧です。

ああ、ファイルコピーのプログレスバーを見つめていたら眠くなってきました。やばいやばい。

.. _`UD-500SA`: http://www.timely.ne.jp/item/page/UD-500SA.html
.. _`裸族の服`: http://www.century.co.jp/products/accessories/crf25_35.html


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 333
:date: 2006-04-18 14:25:00
:title: 6年放置していた銀行口座を解約
:categories: ['misc']
:body type: text/x-rst
:body:
大学の最後2年間お世話になったアパートの家賃が「XX信用金庫」口座自動引き落とし指定だったので、当時口座を作って家賃を振り込んでいたものの、社会人になってそのアパートを出てしまったのでそれから6年間口座が放置状態だった。そしてついに先日実家に信金から口座解約して～と電話が行ったらしい。ちょうどシフト勤務状態で日中時間を作ることが出来たのでサクッと解約しにいってきた。

もしかしたら1000円くらいは残金が返ってくるかな。返ってきたら久々に新宿の `ステーキの神様`_ で晩ご飯食べようかな。などと思いながら手続きが終わるのを待っていたのに、

受付「清水川さーん、お待たせしました」

オレ「はーい」

受付「8円のお返しになります」

オレ「‥‥8円でどうしろと？」

いや言ってないけど。そんな感じでガックリしつつ今日は夕方から深夜0時までのシフトなのであった。やっぱりステーキ食おう。うん。スタミナつけないとね。

追記
----
神様は17:00開店だったので食えず。代わりにゴーゴーカレーでカツカレーエコノミー食べた。夕方5:55までは100円安い。

.. _`ステーキの神様`: http://www.lemondo-japan.com/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 334
:date: 2006-04-23 01:11:35
:title: 二子玉川サイクリング
:categories: ['misc']
:body type: text/x-rst
:body:
今日はサイクリング日和だったので、とみたのルイガノをGO君に貸し出してもらって、二人で多摩川南下サイクリングに出かけた。多摩川は道程の半分くらいが砂利道で、ちょっと微妙なコースだったかも。目的地の二子玉川には残念ながらナンジャタウンもワンダーエッグもネコタマもなかったので、駅前のケンタッキーでケイジャンチキンを食って帰宅。

帰りは野川沿いに北上。野川沿いは完全舗装だったけど、10回以上道路と交差しているのが微妙な感じ。

次は多摩川を西方向に行ってみようかな。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2006-04-23.5345850528
:title: Re:二子玉川サイクリング
:author: setomits
:date: 2006-04-23 11:48:55
:email: 
:url: 
:body:
多摩川サイクリング情報マップ
http://members.jcom.home.ne.jp/tamariva/map.html
がおすすめです。

:comments:
:comment id: 2006-04-23.5187150886
:title: Re:二子玉川サイクリング
:author: しみずかわ
:date: 2006-04-23 15:25:19
:email: 
:url: 
:body:
>多摩川サイクリング情報マップ

おお！これはすごい。こういうのを見てると、羽田空港まで行ってみたい気になってくる(笑

%%%%%%%%%

:id: 335
:date: 2006-04-25 10:37:59
:title: プロジェクトの忙しさは最初に集中するべき
:categories: ['Programming']
:body type: text/x-rst
:body:
前のプロジェクトが一息ついた翌日から次のプロジェクトがスタートです。プロジェクトリーダーをやることになったので、全然暇になりません。

で、自分がプロジェクトをコントロールできる立場になると、自分の進め方がXPなので、そのプロジェクトは最初に忙しさが集中することになります。昨日も終電くらいまでメンバーとタスク洗い出しをしてたり。今回のメンバーとこういうスタイルでプロジェクトを進めるのは初めてなので、自分も他のメンバーも色々と不安もあるようです。特に、初日から終電というのは今後ずっとこの調子で毎日忙しいんじゃないか、という感覚になります。あと、こんなに時間を掛けてタスク化してないでとっとと実装始めようよという雰囲気もあったり無かったり。

しかし、プログラマってプログラミングスキルに関わらず、 **実装の仕組みを中心にToDoを書く** 傾向が強いのかもしれない。もしかしたら実装イメージへの落とし込みが脳内で瞬時に行われる人ほどその傾向は強い？ストーリーやタスクを書いてもらったら、 *どう実装するか* の列挙は出来ても、それが **何の目的で** 行われるのかは書かれないという‥‥。実装をテストから導くというTDDはイメージできるけど、そもそもテストすべきことを決定する挙動の範囲を絞り込めてないという感じ？

勉強のためにイベントに参加させようにも、最近はAgile関連のイベントなんかも円熟してしまって、XPに初めて触れる人を連れて行きづらい感があるなあ。

なんかタイトルと本文がかけ離れた内容になったけど、まあいいか。

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 336
:date: 2006-04-25 10:58:46
:title: 久しぶりにZope3をupdateしたら色々とDeprecatedに...
:categories: ['Zope']
:body type: text/x-rst
:body:
昨日、Zope3のtrunkを久々にupdateしたところ、起動時に4つくらいDeprecationWarningが表示されるようになってしまった。全部ZCMLのディレクティブについてのWarningで、

- content -> class
- vocabulary -> utility
- factory -> utility

に変わったらしい。これ以外も、 `Zope3Book`_ の内容からは色々な部分が変わってしまっているので、本の通りにサンプルを作っても動かないこともあるかも。かといってOnlineHelpでは仕組みとか概念は勉強できないからなぁ‥‥。

.. _`Zope3Book`: http://www.zope.org/Wikis/DevSite/Projects/ComponentArchitecture/Zope3Book


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 337
:date: 2006-04-26 02:25:24
:title: 今更ながらクリティカル・チェーン読了
:categories: ['Agile(XP)', 'Programming']
:body type: text/x-rst
:body:
今更ながら読了。6時間くらいで一気に読み終わってしまった。扱っている問題はプロジェクト管理におけるクリティカルパスのとらえ方と、さらにその先の問題の考え方について。読み終わって最初に、3日前に引いたPART図を破棄したくなった。ていうか作り直そう。

ところで、この本の内容は3人でやってるXP的なプロジェクトにも適用できるのだろうか？XPでやっていても、ストーリー間・タスク間の依存関係はあるし、それをイテレーション毎にPART図で表すことも出来る。それらを全部つなげたものがクリティカルパスになると言えるのだけど、そういった計画をXPで行うという話を聞いたことがない気がする。では、XPではクリティカルパスを意識する必要がないのだろうか。なんか同意できない。ためしに「XP クリティカルパス」でググってみたらWindows XPと医療関係ばかりひっかかる。

とりあえず、イテレーション内のクリティカルパス認識と、バッファー配置については意識してみようと思う。3人プロジェクトなので、おそらく目に見える効果は無いんじゃないかとおもうけど、トラッキングには役立ちそうな気がする。

*#TOC,スループットは言わずもがな..*


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 338
:date: 2006-04-26 23:44:28
:title: 自転車が増えた
:categories: ['bicycle']
:body type: text/x-rst
:body:
玄関狭いよ玄関狭いよ

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 339
:date: 2006-05-04 21:12:45
:title: 東北の車窓から
:categories: ['misc']
:body type: text/x-rst
:body:
秋田新幹線は在来線の線路を走ります。民家の横を走ったり、踏切があったり、新幹線すれ違い待ちがあったりします。こんなにいろいろあるのに、自由席はありません。


ところで、秋田ではちょうど桜が満開でした。さすがだ秋田。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 340
:date: 2006-05-05 00:35:55
:title: 津軽十二湖で青池を見た
:categories: ['misc']
:body type: text/x-rst
:body:
実家秋田に帰ってきたはずなのに、なぜか白神山地を越えて津軽にいます。日帰りプチ家族旅行？

津軽十二湖という、海辺の山の中に複数の湖が点在しているところに行ってきました。基本的には「ナニガイイノ？ボクワカンナイ」という感じの湖がたくさんあるだけだったのですが、青池を見て素直に「すげぇ！」と感動。いやーホントに青いね。ぼくビックリ。

青かったりタコイカだらけだったりの `白神旅行写真はこちら`_ 。

.. _`白神旅行写真はこちら`: http://www.freia.jp/taka/photo/misc/shirakami/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 341
:date: 2006-05-09 01:51:21
:title: ATCTSmallSampleの英語版をリリース
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
4月末までに作業する予定だった英訳作業をようやく完了しました。変な英文を大量に生産した気がします。

- `ATCTSmallSample 0.3`_

英語を日本語に翻訳するときには、 ``You`` を訳すときに消してしまうとかすればそれっぽい日本語が出来るのですが、逆に、日本語の文章って主語がない場合が多いので、英語にするときにどうしていいのか分からない場合があって困りました。

::

  # ここでportal_skinを取得します
  skins_tool = getToolByName(self, 'portal_skins')

とかいうコード説明の日本語をexcite君に食わせると ``portal_skin is acquired here.`` とか訳されますが、これでいいのかなあ‥‥まあいいか。みたいな。こういうのの勉強するには、教科書を読むよりも、海外産ソースの英語コメントを読んで練習するしかないかな。


.. _`ATCTSmallSample 0.3`: http://plone.org/products/atctsmallsample/releases/0.3



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 342
:date: 2006-05-14 17:55:00
:title: Zopeを2.9.3にアップグレードしてみる
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
前から検討していたのですが、やっとZope2.9にアップグレードすることが出来ました。

- 旧構成

  - Python-2.4.2
  - Zope-2.8.5
  - Plone-2.1.2
  - COREBlog2-0.82?

- 新構成

  - Python-2.4.3
  - Zope-2.9.3
  - Plone-2.1.2
  - COREBlog2-0.9b

Plone-2.1.2はZope-2.9系列でテストされていません。危ないですねー。まあ実験環境だしいいか。あとついでにCMFContentsPanelsを使ってトップページを変えてみました。Plone標準の「最近の更新」portletをanonymousに見せるのはあまり意味がないので止めたかった、というのが理由ですが、今までportletはそれしか表示してなかったので今はportletがありません。なんか寂しくなった気がします。

CMFContentsPanels-2.1はPlone2.1.2に最適化されていないので、これからいろいろとカスタマイズしていこうと思います。ということでまずはCOREBlog2エントリを表示するviewletを作ってみました。（つづく）


:extend type: text/html
:extend:
%%%%%%%%%

:id: 343
:date: 2006-05-15 00:53:55
:title: CMFContentPanelsでトップ画面に複数のCOREBlog2エントリ一覧を表示
:categories: ['Plone']
:body type: text/x-rst
:body:
複数のCOREBlog2インスタンスがあるときに、ポータルのトップページで各Blogの最新の5件くらいを表示したい場合があります。方法の一つとして、CMFContentPanelsで表示してみます。この説明では以下のプロダクトを使用しています。

- `Plone-2.1.2`_
- `CMFContentPanels-2.3`_

.. _`Plone-2.1.2`: http://plone.org/products/plone/releases/2.1.2
.. _`CMFContentPanels-2.3`: http://plone.org/products/cmfcontentpanels/releases/2.3



:extend type: text/x-rst
:extend:
まず、CMFContentPanels-2.3を入手し、Products以下に展開します。Ploneで使えるようにするため、サイト設定の *プロダクトの追加と削除* でCMFContentPanelsを追加しましょう。

次に、任意のフォルダにContentPanelsを追加します。

.. figure:: images/20060514_cpcb2_1.png
  :target: images/20060514_cpcb2_1.png
  :alt: 図1

.. figure:: images/20060514_cpcb2_2.png
  :target: images/20060514_cpcb2_2.png
  :alt: 図2

今回はPloneサイトのトップに追加します。追加したらlayoutタブに移動して、ContentPanelsで表示するパネルを追加します。UIがわかりにくいですが、パネルを追加するには下図の○で囲ってある ``new panel`` をクリックします。

.. figure:: images/20060514_cpcb2_3.png
  :target: images/20060514_cpcb2_3.png
  :alt: 図3

ポップアップWindowが表示されます。

.. figure:: images/20060514_cpcb2_4.png
  :target: images/20060514_cpcb2_4.png
  :alt: 図4

表示対象フォルダを指定する ``Related Content`` でCOREBlog2インスタンスの場所を指定してください。次にCOREBlog2の最新のエントリを表示するためにViewletから ``Recent changes`` を選択してください。

.. figure:: images/20060514_cpcb2_5.png
  :target: images/20060514_cpcb2_5.png
  :alt: 図5

CMFContentsPanelsは、Related Contentの選択しているPloneオブジェクトのタイプによって選択できるViewletの内容が変化します。またViewletによってViewlet settingsの内容が変化します。このUIも慣れるまではわかりにくい気がします。

``Viewlet settings`` の設定で、表示するskin、タイトル、アイテムの種類、審査状態、subfolders(フォルダ以下を内容を表示するかどうか)などを設定します。COREBlog2の投稿のみを表示する場合は、アイテムの種類で ``エントリ`` のみを選択してください。

設定が完了したら ``select this panel`` を押して設定を反映します。これでBlogのエントリが表示されるようになったと思います。表示タブへ移動して内容を確認しましょう。

.. figure:: images/20060514_cpcb2_6.png
  :target: images/20060514_cpcb2_6.png
  :alt: 図6

最後に、ContentPanelをサイトのトップページに表示するように設定します。ホームディレクトリに移動して、ContentPanelをのデフォルトビューに設定しましょう。グリーンのバー部分にある ``表示`` プルダウンメニューからデフォルトビューを設定することが出来ます。

.. figure:: images/20060514_cpcb2_7.png
  :target: images/20060514_cpcb2_7.png
  :alt: 図7

そのフォルダに置かれている、デフォルトビューになることが出来る複数のオブジェクトが一覧表示されるので、作成したContentPanelsを選択します。

.. figure:: images/20060514_cpcb2_8.png
  :target: images/20060514_cpcb2_8.png
  :alt: 図8

トップページに移動して、ContentPanelsが表示されていることを確認してください。

.. figure:: images/20060514_cpcb2_9.png
  :target: images/20060514_cpcb2_9.png
  :alt: 図9

なお、パネルの設定でRecent changesの代わりに ``Folder changes`` を選択するとタイトルと本文の一部が表示されるようになります。

.. figure:: images/20060514_cpcb2_10.png
  :target: images/20060514_cpcb2_10.png
  :alt: 図10

これで一通りの設定が完了しました。同じ手順で他のBlogの内容を表示したりしてみましょう。

次は、COREBlog2エントリを表示するviewletを作った過程について書こうとと思います（つづく）
%%%%%%%%%

:id: 344
:date: 2006-05-17 02:27:48
:title: COREBlog2用のCMFContentPanelsのViewletを作る
:categories: ['Plone']
:body type: text/x-rst
:body:
前回のBlogで、 `CMFContentPanelsでトップ画面に複数のCOREBlog2エントリ一覧を表示`_ することが出来るようになりました。しかしこれだけだと何となく寂しい気がします。という無理矢理な導入で、CMFContentPanelsで使えるオリジナルViewletを作ってみましょう。

なお、今回使用したバージョンは、 `CMFContentPanels-2.3`_ と `COREBlog2-0.9b`_ です。

.. _`CMFContentPanelsでトップ画面に複数のCOREBlog2エントリ一覧を表示`: http://www.freia.jp/taka/blog/343/

.. _`CMFContentPanels-2.3`: http://plone.org/products/cmfcontentpanels/releases/2.3

.. _`COREBlog2-0.9b`: http://www.coreblog.org/jp



:extend type: text/x-rst
:extend:
Viewlet用PageTemplateを作る
----------------------------
CMFContentPanelsでは表示用のパネルをViewletと呼んでいて、CMFContentPanelsインスタンスページに複数並べることが出来ます。この方法を使って、一つのページの上半分をPloneのドキュメント、下半分にCOREBlog2のエントリ一覧表示するといった事が出来るようになります。

まずはViewletを表示するためのPageTemplateファイルを作成します。ZMIで /plone/portal_skins/custom へ移動してPageTemplateを新規に作成します。オブジェクトIDは何でも良いのですが、CMFContentPanelsの命名方法を真似て ``viewlet_coreblog2_list`` としておきます。次にこのオブジェクトの中身を作成します。とりあえず以下のようにスケルトンを用意しましょう。

.. code-block:: XML

    <html xmlns:tal="http://xml.zope.org/namespaces/tal"
          xmlns:metal="http://xml.zope.org/namespaces/metal"
          i18n:domain="plone">

    <body>

    <div metal:define-macro="coreblog_contents_viewletconf">
    </div>

    <div metal:define-macro="coreblog_contents">
    </div>

    </body>
    </html>


viewlet_coreblog2_listには2つのマクロを定義しています。CMFContentPanelsのドキュメントを読むと書いてあるのですが、Viewletのマクロ名を ``hoge`` とした場合、そのViewletの設定用UIのマクロ名を ``hoge_viewletconf`` とする必要があります。ここではViewletのマクロ名と設定用マクロ名は上記のように命名しています。coreblog2じゃなくてcoreblogになってますが、細かいことは気にしない方向でお願いします。


Viewletを登録する
------------------
空っぽのViewletを用意して、次はいきなりViewlet登録を行います。まずは空っぽのViewletが使えるモノかどうかを確認する意味で、実際にCMFContentPanelsで試してみようという作戦です。

設定のためにZMIで ``/plone/portal_contentpanels`` に移動すると、CMFContentPanelsで使えるViewletがずら～っと登録されています。このページの一番下に移動して、今作ったばかりの空Viewletを登録しましょう。

:title: COREBlog2 list
:Id: coreblog2_list_viewlet
:url: string: here/viewlet_coreblog2_list/macros/coreblog_contents
:Permission: View
:Category: GL:folder
:Visible: On

設定値の中で、今作ったPageTemplateのIDとマクロ名が出てきています。タイトルやIDは適当に‥‥いちおうCMFContentPanelsの命名を真似て付けたつもりです。

.. figure:: images/20060517_cpcb_1.png/image_preview
  :target: images/20060517_cpcb_1.png

これでCMFContentPanelsで上記のViewletを使えるようになったはずです。空っぽですが。Categoryを ``GL:folder`` としているので、 ``COREBlog2 list`` というViewlet名を選択できるのは、Related Contentでフォルダ型オブジェクトを選択しているときだけです。

.. figure:: images/20060517_cpcb_2.png/image_preview
  :target: images/20060517_cpcb_2.png

とりあえず、問題が起きたときに切り分けしやすいように、ここまでの内容で動くことを確認しておいた方が良いでしょう。


表示用Viewletを書く
--------------------
今回は、Ploneのフォルダの中身一覧を表示するViewletをコピーして、COREBlog2用に機能拡張したい部分だけカスタマイズします。以下で紹介するコードは、基本的にはCMFContentPanels/skins/cp_viewlets/viewlets_folder_recentのbase_portletマクロがやっている処理を真似して作ったのですが、CMFContentPanelsのPageTemplateはかなり細かく部品化されているので、共通する部分はmetal:use-macroとmetal:fill-slotを駆使して再利用することが出来ました。

.. code-block:: XML

    <div metal:define-macro="coreblog_contents">
    <style type="text/css">
    .cp_cb2_header {
        border-width: 0 0 1px 0;
        border-color: blue;
        border-style: solid;
        overflow: hidden
    }
    
    .cp_cb2_title {
        color: black;
        font-weight: bold;
    }
    
    .cp_cb2_image {
        float: left;
        position: relative;
        z-index: 1;
        padding: 0 4px 0 0;
        margin: 0 0.5em 0 0;
        border-top: solid 1px LightGray;
        border-left: solid 1px LightGray;
        border-bottom: solid 2px DimGray;
        border-right: solid 2px DimGray;
        background-color: white;
        padding: 3px;
        text-align: center;
    }
    </style>
        <div metal:use-macro="here/viewlets_folder_recent/macros/base_portlet">
            <div metal:fill-slot="body">
                <tal:block tal:repeat="item results">
    
                    <div class="portletContent odd"
                         tal:attributes="class python:test(path('repeat/item/even'), 'portletContent even', 'portletContent odd')">
    
                        <tal:block tal:define="result_url item/getURL;
                                               url string:$result_url/view;">
    
                            <a href="#"
                               tal:attributes="href url">
    
                                <p class="cp_cb2_header">
                                    <img src="#"
                                         height="16"
                                         width="16"
                                         alt=""
                                         tal:on-error="structure python:path('here/linkOpaque.gif')"
                                         tal:replace="structure python:path('here/%s' % item.getIcon)"
                                         />
    
                                    <span class="cp_cb2_title" tal:content="item/Title | item/getId">
                                      Title or Id
                                    </span>
    
                                    <span class="discreet"
                                          tal:define="modificationDate item/ModificationDate;
                                                      modificationDate python:here.toLocalizedTime(modificationDate)"
                                          tal:content="string:(${item/Creator}) $modificationDate">
                                          creator   08/19/2001 03:01 AM
                                    </span>
                                </p>
    
                                <div class="cp_cb2_image"
                                     tal:define="cbentry_ref_tag python:context.getCBRefTag(item);"
                                     tal:condition="cbentry_ref_tag">
                                    <img src="#"
                                         height="128"
                                         width="128"
                                         alt=""
                                         tal:replace="structure cbentry_ref_tag" />
                                </div>
                                <div class="formHelp">
                                    <span tal:content="structure item/Description"/>
                                </div>
                            </a>
    
                        </tal:block>
                        <br class="visualClear" />
                        <span></span>
                    </div>
                </tal:block>
            </div>
        </div>
    </div>

上記コードのほとんどは CMFContentPanels/skins/cp_viewlets/content_list_macros.pt の ``<metal:block metal:define-macro="separate_line_description">`` ブロック内をコピーしカスタマイズしました。CSSがPageTemplateに埋め込まれていてあまり美しくないので、本当は別ファイルに分離して、portal_cssとかに登録しておきたいところです。これは各自で工夫してみてください。

改造のポイントは、COREBlog2エントリに結びつけられた画像がある場合は一覧表示に画像をサムネイル表示するようにしている点です。ほかにもいろいろやってますが見た目的に大きな特徴はそれくらいです。で、関連づけられた画像を表示するために ``getCBRefTag`` というScript(Python)を呼び出しています。/plone/portal_skins/custom にgetCBRefTagを作成して、以下のような(テキトーな)スクリプトを記述します。パラメータに ``item`` を受け取るようにしましょう。

:Id: getCBRefTag
:parameters: item

.. code-block:: Python

    cbentry_references = item.getObject().getRefsByKind()
    try:
        cbentry_ref = cbentry_references[0]
        cbentry_ref_tag = cbentry_ref.tag(scale='thumb', css_class='referenceImage')
    except:
        return None
    
    return cbentry_ref_tag

これで表示画面は出来ました。あとは設定画面を用意すれば動くようになります。


Viewletの設定画面を作る
------------------------
表示以外は変えなくても動くので、base_portletの設定画面をそのまま流用します。

.. code-block:: XML

    <div metal:define-macro="coreblog_contents_viewletconf">
        <div metal:use-macro="here/viewlets_folder_recent/macros/base_portlet_viewletconf" />
    </div>

これで設定画面も作成が完了しました。早速みてみましょう。

.. figure:: images/20060517_cpcb_3.png/image_preview
  :target: images/20060517_cpcb_3.png

うまく表示されました。アイテムの種類については「エントリ」以外を選ぶ事は想定していないViewletではありますが、Previewしてみたところちゃんと表示されました。ところで、この設定画面は実は若干問題があります。link moreで ``folder default view`` を選択すると、Viewlet表示で「もっと...」のリンク先がフォルダコンテンツ一覧となってしまいます。COREBlog2用には、エントリ一覧等のページを表示したいところです。

Viewlet表示と言えば、カテゴリアイコンも表示したいとか、細かいことを言えばきりがないので、ここから先は各人でViewletを作成していろんなパターンのViewletが作られると良いなぁと思います。誰か作って公開してくれないかしら‥‥。




:comments:
:comment id: 2007-06-16.4924488332
:title: Re:COREBlog2用のCMFContentPanelsのViewletを作る
:author: ueda
:date: 2007-06-16 12:28:13
:email: 
:url: 
:body:
清水川様
Plone関連の情報について、このページを大変参考にさせていただいております。
上記の「COREBlog2用のCMFContentPanelsのViewletを作る」について
教えていただきたいことがあり、コメントいたしました。
初心者であるため、初歩的な質問で恐縮です。

上記の中項目「表示用Viewletを書く」のコードについてはどこのファイルに記述すればよいのでしょうか。
同様に「Viewletの設定画面を作る」のコードについてはどこのファイルに記述すればよいので
しょうか。


:comments:
:comment id: 2007-06-16.2159645448
:title: Re:COREBlog2用のCMFContentPanelsのViewletを作る
:author: しみずかわ
:date: 2007-06-16 15:43:36
:email: 
:url: 
:body:
> どこのファイルに記述すれば

両方とも、「Viewlet用PageTemplateを作る」に入れます。

:comments:
:comment id: 2007-06-16.2898004794
:title: body内のstyle
:author: しみずかわ
:date: 2007-06-16 15:44:49
:email: 
:url: 
:body:
ところでdivタグ内でstyleタグを使ってるのはよくないです。なんでこんなところに・・。

:comments:
:comment id: 2007-06-16.5875304640
:title: Re:COREBlog2用のCMFContentPanelsのViewletを作る
:author: ueda
:date: 2007-06-16 23:53:08
:email: 
:url: 
:body:
お返事、どうもありがとうございました。
早速、試させていただきます。
今後ともこのサイトを参考にさせていただきます。

:comments:
:comment id: 2007-07-03.6947045370
:title: Re:COREBlog2用のCMFContentPanelsのViewletを作る
:author: ueda
:date: 2007-07-03 22:18:15
:email: 
:url: 
:body:
清水川様

先日は質問にご回答頂き、ありがとうございました。
COREBlog2については、上記によりContentPanelsでタイトルやサムネイル、本文を表示することができました。
大変助かりました。
さて、今度はPloneでフォルダを追加し、そのフォルダ配下にページを作成し、コンテンツを掲載することを考えていますが
その際に上記の上記のCOREBlog2と同様にページを利用してタイトルやサムネイル、本文をContentPanelsで表示するには
上記の表示用Viewletのどこを修正する必要があるでしょうか。ポイントだけでもご教授いただけないでしょうか。
毎々お手数をおかけいたしますが大変恐縮ですがどうぞよろしくお願い申し上げます。

:comments:
:comment id: 2007-07-05.3544550369
:title: Re:COREBlog2用のCMFContentPanelsのViewletを作る
:author: しみずかわ
:date: 2007-07-05 18:55:54
:email: 
:url: 
:body:
以下等を参考にしたり、ZopeやPloneのMLで聞くのがよいでしょう。

CMFContentPanelsのViewletを作る — JZUG
http://zope.jp/documents/tutorial/make-cmfcontentpanels-viewlet
%%%%%%%%%

:id: 345
:date: 2006-05-18 00:37:45
:title: XPユーザー会のLTに参加予定
:categories: ['Agile(XP)']
:body type: text/x-rst
:body:
今週金曜日は `第15回XPユーザ会 トーカーイジリナイト`_ に参加する予定です。ここ1年ほどXP関連イベントからは遠ざかっていたのですが、先月末からまたマネジメント関連に関わることになったので、モチベーションアップも兼ねてライトニングトークしてこようと思います。

今やってるプロジェクトで使っている `XPlanner`_ をLTのネタ元にする予定なので、プロジェクトメンバーの同僚2名を強制参加登録させてみたり。しかし今回のトーカーはなにやらいじられるらしいので、盛り上がりそうなネタを用意できるかどうかドキドキです。今週末までのイテレーションが金曜までにはちょっと終わらなそうなので、その辺をネタにするというのもアリか？とか思ってます。

ちなみにプレゼン資料まだ作ってません。今から作ります。えいご漬けやってる場合じゃないです。

.. _`第15回XPユーザ会 トーカーイジリナイト`: http://www.xpjug.org/event/20060519meeting/registration/
.. _`XPlanner`: http://variousxplanner.sourceforge.jp/cgi-bin/wiki.cgi


:extend type: text/html
:extend:
%%%%%%%%%

:id: 346
:date: 2006-05-21 16:26:36
:title: XPユーザー会のLTでXPlannerを紹介してきました
:categories: ['Agile(XP)', 'Event']
:body type: text/x-rst
:body:
Lightning Talks
----------------
`XPユーザー会のLTに参加予定`_ ‥‥ということで、ライトニングトークしてきました。内容は予定通り、今やってるプロジェクトで使っている XPlanner_ ネタで、グラフィカルに表示されるチャート図や、常時集計されるトラッキング情報が好評だったようです。オチに **というわけでPython良いですよ！** というのを用意していたのですが、銅鑼の音にかき消されました‥‥。

発表に使った資料は文末のリンクからドウゾ。

World Cafe
------------
ライトニングトークス後は、6人のトーカー毎に島を作って `ワールドカフェ`_ をしてきました。が、人数と時間の関係上、ワールドカフェというよりはトークスのwrapupという感じでした。2次会でKKD氏にそのように感想を話したところ **厳密に原則に従う必要はない** ということを言われ、自分もその意見に賛成です。実際の所 *厳密な* ワールドカフェ形式に参加したことがないので何とも言えないのですが、今回のように少人数でメンバー完全入れ替え(連続で話を聞いているのはトーカーだけ)だと、1回目の議論の内容が入れ替え時点でほとんどリセットされてしまい、議論が発展しないんじゃないかと思います。一応1回目の議論の内容は2回目のメンバーに伝えましたが、議論の過程を共有している、というワールドカフェの利点が無かったのが残念でした。

自分はトーカーをしてきたので、最初から最後までPython島‥‥じゃなかったXPlanner島にいました。ので、感想としてはXPlanner島のまとめくらいしか書けません(T-T)。議論の中では、多くの利点と、問題点の指摘を受けました。以下は問題点の一例ですが、XPlannerを使うのであればこういった問題をカバーする方法を考える必要があります。

- 壁に貼るレベルでの見える化はなされない
- タスクカードを壁から剥がす気持ちよさがない
- メンバーの動向がわからない（タスクカード取りに行かないので）
- 文字表現しかできないので紙のような自由度がない

.. _`XPユーザー会のLTに参加予定`: http://www.freia.jp/taka/blog/345
.. _XPlanner: http://variousxplanner.sourceforge.jp/cgi-bin/wiki.cgi
.. _`ワールドカフェ`: http://www.objectclub.jp/ml-arch/magazine/121.html


議論結果発表
------------
議論のまとめに、 **XPlannerを使うべき10の理由** というのを議論参加者みんなで作って発表したのですが、ここではちょっとリファクタリングして10の指標として自分なりにまとめてみます。

XPlannerを効果的に使う10の指標
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- standalone版ならセットアップ簡単！悩む前に動かして使え！
- 守！XP用語とプロセスの学習に使え！(*Tool Driven Development*)
- プランニング(ストーリー・タスク入力)はチーム全員で行え！
- ストーリー・タスクをUpdateし続けろ！
- 集計は自動だ！トラッカーを確保できないチームで使え！
- イテレーション終了時に見積誤差の理由をしっかり追跡しろ！
- 説得力のあるチャートやグラフでチームの進捗を常時共有しろ！
- 見える化支援！壁に貼る代わりに常時表示モニターを置け！
- 破！不要な機能は無視してチームに合った独自の使い方を開拓しろ！
- 離！XPlannerでは物足りないと思ったら、紙と壁に移行しろ！

こんな感じで。れっつXPlanner。

懇親会(メイン)
---------------
- 初めてKKD氏と話した！PythonのDocTestの素晴らしさについて語り合えた
- Rubyな伊尾木さんにDocTestを自慢！Pythonイイヨ
- Pythonistのやっとむ氏には会えなかった。残念。
- けっこう雨が強くて、店がIBM箱崎から遠いのにはめげた
- チムニー安かったけど狭すぎ。写真撮るの忘れた‥‥
- 強制参加させた同僚のウケはよかった。次はXP祭りと `オブラブ夏`_ 参加だ
- 次はDocTestでLTしてみようかな（野望）

.. _`オブラブ夏`: http://www.objectclub.jp/event/2006summer/

関連サイト
---------
- `第15回ユーザー会終了しました - 日本XPユーザーグループサイト`_
- `shrkwの記録 - XPJUG 第15回ユーザー会`_
- `機械猫の日記 - 第15回XPJUGユーザ会`_

.. _`第15回ユーザー会終了しました - 日本XPユーザーグループサイト`: http://www.xpjug.org/index.html/10/
.. _`shrkwの記録 - XPJUG 第15回ユーザー会`: http://d.hatena.ne.jp/shrkw/20060519/1148058754
.. _`機械猫の日記 - 第15回XPJUGユーザ会`: http://d.hatena.ne.jp/kikaineko/20060520#p1

資料
-----
発表に使用した資料です。


:extend type: text/html
:extend:


:comments:
:comment id: 2006-05-21.7274018124
:title: Re:XPユーザー会のLTでXPlannerを紹介してきました
:author: kikaineko
:date: 2006-05-21 22:05:27
:email: 
:url: 
:body:
>次はDocTestでLTしてみようかな
おお、かなり期待です！！

%%%%%%%%%

:id: 347
:date: 2006-05-21 22:34:41
:title: PythonのDocTestでお手軽TDD
:categories: ['python', 'Programming']
:body type: text/x-rst
:body:
.. epigraph::

  『Python凄いんですか？』

  『詳しくは知らないんですが、doctestというのが凄そうです』

  -- `機械猫の日記 - 第15回XPJUGユーザ会`_ のコメント欄より


.. _`機械猫の日記 - 第15回XPJUGユーザ会`: http://d.hatena.ne.jp/kikaineko/20060520#p1

PythonのDocTestで手軽にUnitTestを書く事が出来ます。こいつの **凄い** ところは、

- 実装とドキュメントとテストが一カ所に集中する（生き別れない）
- テストコードが言語レベルでマニュアルとして利用される
- インタラクティブモード（対話コンソール）の内容を貼り付ければテストになる

というところです。まああんまり書きすぎると実装がドキュメント(UnitTest)に埋もれちゃう、という話もありますが、そのへんはバランスを取って書くということで。

それでは早速DocTestを書いてみます。(`vnc2swf - 画面録画ユーティリティ`_ を使ってFlash作ってみました)


.. _`vnc2swf - 画面録画ユーティリティ`: http://www.unixuser.org/~euske/vnc2swf/index-j.html

:extend type: text/x-rst
:extend:
コードだけだと分からないと思うので、使い方等、詳しくはFlashの方を見てください。

.. code-block:: Python

    def add(x, y):
        """ return added value.
        
        add digits.
        
        >>> add(1, 2)
        3
        
        add strings.
        
        >>> add('abc', '123')
        'abc123'
        """
        return x + y
    
    def evens(digits):
        """ return even value's list.
    
        >>> evens([1, 2, 3, 4, 5, 6])
        [2, 4, 6]
        >>> evens([1, 3])
        []
        >>> evens(range(0, 10))
        [0, 2, 4, 6, 8]
    
        """
        return [x for x in digits if x%2==0]
    
    # make and return TestSuite for this module.
    def test_suite():
        import unittest
        from doctest import DocTestSuite
        return unittest.TestSuite(( # make test suite
            DocTestSuite('my_utils'), # register myself as test
            ))
    
    # This if statement is executed only when run this module as main module.
    if __name__ == '__main__':
        import unittest
        unittest.main(defaultTest='test_suite') # execute test.


:comments:
:comment id: 2006-05-21.3484458793
:title: Re:PythonのDocTestでお手軽TDD
:author: kikaineko
:date: 2006-05-21 22:49:08
:email: 
:url: 
:body:
さっそくフラッシュ拝見させていただきました。
これは凄いですね！！確かに対話モードで試してみて、それを貼り付けるってのはアリですよね！！
おーかっこいい！！

:comments:
:comment id: 2006-05-21.0364105491
:title: Re:PythonのDocTestでお手軽TDD
:author: 清水川
:date: 2006-05-21 23:17:16
:email: 
:url: 
:body:
反応はやっ！（笑

日本ではPythonって何？状態なので、こういう機能が意外と知られてないんですよね‥‥。実際便利ですよー。

:trackbacks:
:trackback id: 2006-05-21.8311522462
:title: [ruby]RubyでDocTest
:blog name: 機械猫の日記
:url: http://d.hatena.ne.jp/kikaineko/20060521#p1
:date: 2006-05-21 23:13:51
:body:
 一昨日のXPユーザ会でpythonにDocTestなる非常にクールな機能があることを教えてもらった。 詳しくはこちら http://www.python.jp/doc/release/lib/module-doctest.html ↓こちらは清水川さんのフラッシュ付き解説 http://www.freia.jp/taka/blog/347 これならTDD×Rubyの迷

:trackbacks:
:trackback id: 2006-05-22.8938078777
:title: [Python]PythonのDocTestはすごいらしい :-)
:blog name: きむだらど〜日記
:url: http://d.hatena.ne.jp/afukui/20060522/1148267741
:date: 2006-05-22 12:18:14
:body:
 XPJUGのユーザー会で清水川さんがid:kikainekoさんにその素晴らしさをレクチャーしていたみたい。(^_^) PythonのDocTestでお手軽TDD by 清水川さん http://www.freia.jp/taka/blog/347 Flushでも作成されていて、これを見るとよく分かりますね。 おー、かっこいい！関数内に

%%%%%%%%%

:id: 348
:date: 2006-05-31 00:40:24
:title: クーラー風邪
:categories: ['misc']
:body type: text/x-rst
:body:
台風の影響で先週は湿度の高い日々が続きました。というか毎日雨で自転車乗れません。湿度が高いのは好きじゃないのでクーラーを常用していたら喉と鼻をやられてしまい、病院で炎症を抑える薬とPL(総合感冒薬)をもらってきました。

このPLのせいで、ここ数日一日中眠い。意識はハッキリしてるのにひたすら眠い。コーディングの途中で何やってるんだか分からなくなったりするくらい眠い。今までPLでここまでの副作用は出なかったのに今回はかなりやられてます。


:extend type: text/html
:extend:


:comments:
:comment id: 2006-06-02.3459568347
:title: Re:クーラー風邪
:author: masaru
:date: 2006-06-02 02:02:26
:email: 
:url: 
:body:
>意識はハッキリしてるのにひたすら眠い

矛盾しているような気がしますが
とにかく頑張ってください。

:comments:
:comment id: 2006-06-02.8288146835
:title: Re:クーラー風邪
:author: 清水川
:date: 2006-06-02 02:10:28
:email: 
:url: 
:body:
> 矛盾しているような気がしますが

それくらい眠いって事で。
風邪の峠は越えました。今は仕事の峠を越えようとしてます。
%%%%%%%%%

:id: 349
:date: 2006-06-08 09:51:44
:title: 今日もまくはれ
:categories: ['Event', 'work']
:body type: text/x-rst
:body:
幕張に来ています。INTEROPです。企業ブースです。そろそろ過労で倒れますｗ

あー、メールの未読が溜まっていく・・・


:extend type: text/html
:extend:


:comments:
:comment id: 2006-06-09.0440654275
:title: Re:今日もまくはり
:author: masaru
:date: 2006-06-09 02:00:45
:email: 
:url: 
:body:
>そろそろ過労で倒れますｗ

土曜日までは元気でいてください

:comments:
:comment id: 2006-06-10.9359719011
:title: Re:今日もまくはり
:author: Anonymous User
:date: 2006-06-10 21:52:16
:email: 
:url: 
:body:
お疲れ様でした
戦士に休息を

%%%%%%%%%

:id: 350
:date: 2006-06-14 00:20:28
:title: COREBlog2スパム対策(まとめ)
:categories: ['Plone']
:body type: text/x-rst
:body:
最近仕事の影響で **私** がかなり疎かになってしまっています。そんな中、 `takanory.netさんからtrackbackをもらった`_ のでこれに反応して、自分が行っているCOREBlog2スパム対策をまとめてみます。これを読めば一通り設定できるはず＞for 未来の自分

# 参考： `spamとの戦い（回顧編）`_

.. _`takanory.netさんからtrackbackをもらった`: http://takanory.net/
.. _`spamとの戦い（回顧編）`: http://www.freia.jp/taka/blog/306


:extend type: text/x-rst
:extend:
スパム対策共通BuzzWordチェックスクリプト
-----------------------------------------
`以前にblogに書いたスクリプト`_ と同一です。スパマーがこのエントリを見ているとは思いませんが、念のためbuzzwordは省略します。とはいえ、大抵のスパム投稿には ``url=`` か ``href`` が入っているので、この2つを設定しておけばほとんど防げると思います。

.. _`以前にblogに書いたスクリプト`: http://www.freia.jp/taka/blog/coreblog27c216613spam-filter

以下のコードをportal_skins/custom等に置きます。

.. code-block:: Python

    ## Script (Python) "validateBuzzWords"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind subpath=traverse_subpath
    ##parameters=text, moderated=True
    ##title=COREBlog2: buzzword checker
    ##
    buzz_words = (
      'casino',
    )
    
    try:
        if not moderated:
            return moderated
    
        s = str(text).lower()
        for w in buzz_words:
            if s.find(w) >= 0:
                moderated = False
                break
        else:
            moderated = True
    
    except:
        pass
    
    return moderated



コメントスパム対策
--------------------

まずはcbaddCommentの直接呼び出しを拒否するようにカスタマイズします。これが必要になるシーンは滅多にないとは思いますが、自分は喰らってしまったので対策しています。22行目～27行目が追加されています。

.. code-block:: Python

    ## Controller Python Script "cbaddComment"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind state=state
    ##bind subpath=traverse_subpath
    ##parameters=
    ##title=COREBlog2: modify: refuce direct access
    ##
    from Products.CMFPlone import transaction_note
    from Products.CMFCore.utils import getToolByName
    from Products.CMFPlone.utils import log
    
    cbtool = getToolByName(context, 'coreblog2_tool')
    
    REQUEST = context.REQUEST
    form = REQUEST.form
    RESPONSE = context.REQUEST.RESPONSE
    entry = context
    
    # refuse direct access.
    if script is REQUEST.get('PUBLISHED',None):
        RESPONSE.setStatus(403)
        return '403 Forbidden'
        #return RESPONSE.redirect('403 Forbidden', 403)
    
    if REQUEST.form.has_key('remember_cookie'):
        #Set cookie
        for key in ['author','email','url']:
            if REQUEST.form.has_key(key):
                REQUEST.RESPONSE.setCookie(key,REQUEST.form[key],
                            path='/'.join(context.blog_object().getPhysicalPath()),
                            expires='Sun, 01-Dec-2099 12:00:00 GMT')
    
    #Try to add comment
    entry.addComment2Entry(author=form['author'],email=form['email'],
                            url=form['url'],title=form['title'],
                            body=form['body'],REQUEST=REQUEST)
    
    #Send notify mail if need
    if context.getSend_comment_notification():
        try:
            to_addr   = context.getNotify_to()
            from_addr = context.getNotify_to()
            msgbody = context.translate('comment_notify_body')
            elements = {}
            for k in ('title','author','url','body'):
                if REQUEST.form.has_key(k):
                    elements[k] = REQUEST.form[k]
                else:
                    elements[k] = ''
            elements['post_ip'] = REQUEST.getClientAddr()
            elements['entry_url'] = context.absolute_url()
            msgbody = msgbody % (elements)
            msgsubject = context.translate('comment_notify_title')
            mgsheader = """To: %s
    From: %s
    Mime-Version: 1.0
    Content-Type: text/plain; Charset=utf-8
    
    """ % (to_addr,from_addr)
            cbtool.send_mail(mgsheader+msgbody, to_addr, from_addr, msgsubject)
        
        except Exception,e:
            log( 'COREBlog2/cbaddComment: '
                     'Some exception occured, %s' % e )
    
    #Set next action
    state.setNextAction('redirect_to:string:')
    
    #Display message for user
    state.setKwargs({'portal_status_message':'A comment successfully added.'})
    return state
    
    
    
    return state




validateCommentにBuzzWordをチェックするコードを追加しています。以下のカスタマイズでは、smapの傾向や元IP収集のためにBuzzWordに引っかかった場合に、投稿内容を管理者にメール送信し、投稿フォームにはエラーを表示して投稿自体はされないようにしています。

.. code-block:: Python

    ## Controller Validator "validateComment"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind state=state
    ##bind subpath=traverse_subpath
    ##parameters=
    ##title=COREBlog2: modify: add buzzword check
    ##
    from Products.CMFPlone import transaction_note
    REQUEST=context.REQUEST
    moderated = True
    
    reqs = ['title','body']
    
    #See setting and append required field list
    if context.getComment_require_author():
        reqs.append('author')
    
    if context.getComment_require_email():
        reqs.append('email')
    
    if context.getComment_require_url():
        reqs.append('url')
    
    for key in reqs:
        if REQUEST.has_key(key) and not REQUEST[key]:
            state.setError(key, 'Please enter a value', new_status='failure')
    
    for key in ['title', 'body', 'author', 'email', 'url']:
        if REQUEST.has_key(key):
            m = context.validateBuzzWords(REQUEST[key], True)
            if not m:
                state.setError(key, 'Please remove NG words.', new_status='failure')
                moderated = False
    
    #Try to send mail for Bad comment
    if not moderated:
        context.addCommentMail(
                            author=REQUEST['author'],email=REQUEST['email'],
                            url=REQUEST['url'],title=REQUEST['title'],
                            body=REQUEST['body'], moderated=moderated,
                            remoteip=REQUEST.getClientAddr())
    
    if state.getErrors():
        state.set(portal_status_message='Please correct the errors shown.')
    
    return state




BuzzWordコメント時のメール送信用スクリプトです。これはCOREBlog2がメール送信によるコメント通知をサポートする前に作ったものですが、アクセス元IPを通知してくれるあたりがスパム対策っぽい感じです。

.. code-block:: Python

    ## Script (Python) "addCommentMail"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind subpath=traverse_subpath
    ##parameters=author,email,url,title,body,moderated,remoteip='',message=''
    ##title=
    ##
    try:
        mailhost=getattr(context, \
                         context.superValues(['Secure Mail Host', 'Mail Host'])[0].id)
    except:
        raise AttributeError, "Mail Host object cant be found."
    
    
    mMsg = """To: %s
    From: %s
    Mime-Version: 1.0
    Content-Type: text/plain;
    
    Moderate : %s
    ManageURL: http://www.freia.jp/taka/blog/%s/entry_comments
    ViewURL  : http://www.freia.jp/taka/blog/%s
    RemoteIP : %s
    Author   : %s
    Title    : %s
    URL      : %s
    EMail    : %s
    EntryID  : %s
    Body     :
    %s
    
    Additional message:
    %s
    """
    
    try:
        to_addr   = "admin@example.jp"
        from_addr = "admin@example.jp"
        parent_id = context.getId()
    
        mTo   = to_addr
        mFrom = from_addr
        mSubj = 'blog: A comment %s' % (moderated and 'added!' or 'NEED MODERATE.')
        mMsg  = mMsg % (to_addr, from_addr, str(moderated), parent_id, parent_id, \
                        remoteip, author, title, url, email, parent_id, body, message )
    
        mailhost.send(mMsg, mTo, mFrom, mSubj)
    
    except:
        raise



トラックバックスパム対策
-------------------------

tbpingをカスタマイズして、validateBuzzWordsとスパム時のメール送信を呼び出すようにしています。

.. code-block:: Python

    ## Script (Python) "tbping"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind subpath=traverse_subpath
    ##parameters=
    ##title=Receive trackback: COREBlog2: modify: check buzzwords
    ##
    from Products.CMFCore.utils import getToolByName
    from Products.CMFPlone.utils import log
    
    cbtool = getToolByName(context, 'coreblog2_tool')
    
    REQUEST = context.REQUEST
    form = REQUEST.form
    RESPONSE = context.REQUEST.RESPONSE
    entry = context
    
    excerpt = ''
    if form.has_key('excerpt'):
        excerpt = form['excerpt']
    
    title = cbtool.convert_charcode(form['title'])
    blog_name = cbtool.convert_charcode(form['blog_name'])
    excerpt = cbtool.convert_charcode(excerpt)
    
    #Try to add trackback
    try:
        # !!!STAART modify by shimizukawa!!!
        moderated = True
        for text in [title, blog_name, excerpt]:
            m = context.validateBuzzWords(text, True)
            if not m:
                state.setError(key, 'Please remove NG words.', new_status='failure')
                moderated = False
    
        #Try to send mail for Bad comment
        if not moderated:
            context.addTrackbackMail(
                                title=title, url='',
                                blog_name=blog_name,
                                excerpt=excerpt,
                                moderated=moderated,
                                remoteip=REQUEST.getClientAddr(),
                                message='NEED MODERATE',)
            raise 'NEED MODERATE'
        # !!!END modify by shimizukawa!!!
    
        #Send notify mail if need
        if context.getSend_trackback_notification():
            try:
                to_addr   = context.getNotify_to()
                from_addr = context.getNotify_to()
                msgbody = context.translate('trackback_notify_body')
                elements = {}
                for k in ('blog_name','title','excerpt','url','excerpt'):
                    if form.has_key(k):
                        elements[k] = REQUEST.form[k]
                    else:
                        elements[k] = ''
                elements['post_ip'] = REQUEST.getClientAddr()
                elements['entry_url'] = context.absolute_url()
                msgbody = msgbody % (elements)
                msgsubject = context.translate('trackback_notify_title')
                mgsheader = """To: %s
    From: %s
    Mime-Version: 1.0
    Content-Type: text/plain; Charset=utf-8
    
    """ % (to_addr,from_addr)
                cbtool.send_mail(mgsheader+msgbody, to_addr, from_addr, msgsubject)
            except Exception,e:
                log( 'COREBlog2/tbping: '
                         'Some exception occured, %s' % e )
    
        entry.addTrackback2Entry(title=title,url=form['url'],\
                                blog_name=blog_name,excerpt=excerpt)
    
        return context.tbping_result(client=context,REQUEST=REQUEST,\
                                            error_code=0,message='Thanks :-)')
    except:
        return context.tbping_result(client=context,REQUEST=REQUEST,\
                                        error_code=1,message='Error occured!')



addCommentMailとほぼ同一のスクリプト。トラックバック用。芸のないコピペコード。

.. code-block:: Python

    ## Script (Python) "addTrackbackMail"
    ##bind container=container
    ##bind context=context
    ##bind namespace=
    ##bind script=script
    ##bind subpath=traverse_subpath
    ##parameters=title,url,blog_name,excerpt,moderated,remoteip='',message=''
    ##title=
    ##
    try:
        mailhost=getattr(context, \
                         context.superValues(['Secure Mail Host', 'Mail Host'])[0].id)
    except:
        raise AttributeError, "Mail Host object cant be found."
    
    mMsg = """To: %s
    From: %s
    Mime-Version: 1.0
    Content-Type: text/plain;
    
    Moderate : %s
    ManageURL: http://www.freia.jp/taka/blog/%s/entry_trackbacks
    ViewURL  : http://www.freia.jp/taka/blog/%s
    RemoteIP : %s
    Title    : %s
    URL      : %s
    BlogName : %s
    EntryID  : %s
    Excerpt  :
    %s
    
    Additional message:
    %s
    """
    
    try:
        to_addr   = "admin@example.jp"
        from_addr = "admin@example.jp"
        parent_id = context.getId()
    
        mTo   = to_addr
        mFrom = from_addr
        mSubj = 'blog: A trackback %s' % (moderated and 'added!' or 'NEED MODERATE.')
        mMsg  = mMsg % (to_addr, from_addr, str(moderated), parent_id, parent_id, \
                        remoteip, title, url, blog_name, parent_id, excerpt, message )
    
        mailhost.send(mMsg, mTo, mFrom, mSubj)
    
    except:
        raise



ApacheのIPアドレス制限
-----------------------
ログの出力を標準のアクセスと別にしたり、アクセス時にZopeにアクセスに行かないように設定したりしてます。httpd.confの書き方を全然調査してないので冗長な感じです。あと本当はエラーページじゃなくて403を返すように設定したい。

.. code-block:: Python

    SetEnvIf Remote_addr "(24\.244\.170\.180|81\.177\.8\.26)" spam1
    CustomLog /var/log/httpd/www.freia.jp-access.log combined env=!spam1
    CustomLog /var/log/httpd/www.freia.jp-access-spam1.log combined env=spam1
    ErrorLog /var/log/httpd/www.freia.jp-error.log

    RewriteEngine On

    # for spam filtering.
    RewriteCond %{REMOTE_HOST}  ^(24\.244\.170\.180|81\.177\.8\.26)
    RewriteRule ^/(.*) http://localhost:80/underconstruction/ [P,L]

    # rewrite standard zope server.
    RewriteRule ^/(.*) http://localhost:8080/VirtualHostBase/http/www.freia.jp:80/VirtualHostRoot/$1 [P,L]

上記のhttpd.conf、見やすくするためにIPアドレス制限を2つだけ書いていますが、本当は以下のIPを制限しています。

    24.244.170.180
    65.214.44.212
    66.246.218.107
    69.50.167.122
    81.177.7.108
    81.177.7.154
    81.177.7.37
    81.177.7.81
    81.177.8.26
    85.255.117.18
    194.117.134.72
    195.39.170.102
    200.79.91.5
    202.56.253.184
    209.190.4.10
    209.190.4.106
    209.67.219.178





:trackbacks:
:trackback id: 2006-06-27.0228277053
:title: Akismetを使ったトラックバック・スパム対策
:blog name: Weboo! Returns.
:url: http://yamashita.dyndns.org/blog/reject-trackback-spam-by-akismet
:date: 2006-06-27 23:20:23
:body:
いい加減にトラックバック・スパムがうざくなってきたので対策してみました。COREBlog2におけるコメント＆トラックバック・スパム対策に関しては、清水川さんが纏めてくれているので、それを参考にAkismetというWordPress標準の対策機能を使ってSP...

:trackbacks:
:trackback id: 2006-07-26.3118481816
:title: COREBlog2のコメントスパム・トラックバックスパム対策
:blog name: Triconf Blog
:url: http://triconf.net/blog/coreblog2306e30b330e130f330c830b930e030fb30c830e930c330af30c330af30b930e05bfe7b56
:date: 2006-07-26 16:18:32
:body:
 いつかこういう日が来るとは思っていましたが、突如、COREBlog2に対して膨大な量のコメントスパムがつけられるようになってしまいました。 そこでGoogle神に問い合わせますと、以下の清水川さんの記事に行き当たりました。  COREBlog2スパム対策...

%%%%%%%%%

:id: 351
:date: 2006-06-28 22:19:23
:title: ゴーヤが売っていない件について
:categories: ['food']
:body type: text/x-rst
:body:
最近、食生活が乱れている。

- 朝: 野菜ジュース＆豆乳ミックス
- 昼: パンとサラダ
- 夜: パン

これはイカンと思い、ゴーヤチャンプルーを自作しようと西友に行った。丸美屋あたりのゴーヤチャンプルーの素、卵、豚肉と籠に入れていって、最後にゴーヤを探したが見つからない。 **ゴーヤを売らないとは何事じゃ！**

しょうがないので、代わりに100円の野菜ミックス(ほとんどもやし)を買って帰る。ゴーヤチャンプルーの素、卵、豚肉、もやし。合計400円未満。これはこれで結構旨かったので良しとしよう。


:extend type: text/html
:extend:


:comments:
:comment id: 2006-06-29.1228087002
:title: Re:ゴーヤが売っていない件について
:author: koma2
:date: 2006-06-29 00:55:24
:email: 
:url: 
:body:
ふつーそこで沖縄料理屋に駆け込むんじゃないの？ (w

:comments:
:comment id: 2006-06-29.4273397061
:title: Re:ゴーヤが売っていない件について
:author: 清水川
:date: 2006-06-29 08:30:28
:email: 
:url: 
:body:
調布に沖縄料理の店など無い！というか土曜日に沖縄料理の店に行って、沖縄現地のやつほど苦くなかったので自作しようとおもった。苦い方がおいしいのに・・・

:comments:
:comment id: 2006-06-29.7571967855
:title: Re:ゴーヤが売っていない件について
:author: 清水川
:date: 2006-06-29 12:12:37
:email: 
:url: 
:body:
下北沢 ちゃんぷるー http://www.bento.com/revj/1443.html

これかな？

:comments:
:comment id: 2006-06-29.9638060187
:title: Re:ゴーヤが売っていない件について
:author: koma2
:date: 2006-06-29 14:46:04
:email: 
:url: 
:body:
そっちは行ったことないなぁ（前を通ったことはあるはず）。
私が好きなのは、ココ↓

http://tokyo.gourmet.livedoor.com/restaurant/info/22250.html

:comments:
:comment id: 2006-07-15.7547022043
:title: Re:ゴーヤが売っていない件について
:author: masaru
:date: 2006-07-15 07:05:55
:email: 
:url: 
:body:
http://www.citydo.com/prf/tokyo/guide/sg/280000739.html
西国分寺にも沖縄料理のお店ありますよー
行ったことないけど・・・

:trackbacks:
:trackback id: 2006-06-30.5090838861
:title: ゴーヤチャンプルー
:blog name: ロバートのブログ
:url: http://www.neohawk.org/Members/rbh-ja/roba-to-no-blog/goya-chanpuru
:date: 2006-06-30 12:18:29
:body:
 先程、ブログブラウジングをやっていたら、同じプロンを使っている 清水川さんがゴーヤチャンプルーの投稿 を発見。それで思い出した。 ありさも既に投稿している が、このあいだ北東オハイオ州ホーキンズ家がゴーヤチャンプルーを作った。というか、ありさが作った...

:trackbacks:
:trackback id: 2006-10-11.6644585233
:title: 季節に似合わず
:blog name: 湘南広告屋
:url: http://kokokuya.blog62.fc2.com/blog-entry-7.html
:date: 2006-10-11 21:11:04
:body:
ゴーヤチャンプルーを作ってみました。作り方は、、、

%%%%%%%%%

:id: 352
:date: 2006-06-30 13:50:35
:title: ちゃんぷる～！(>_<)b
:categories: ['food']
:body type: text/x-rst
:body:
今日はゴーヤ売ってました。西友で149円。クックドゥーの味噌系たれを使ったんだけど、ゴーヤチャンプルーは味噌系より塩味の方がおいしいとおもった。ていうか豆腐多かったよ。ちょっとしょっぱかったよ。

ゴーヤ・豚・豆腐・卵、と栄養価の高い一品。カロリーもありそうだけどどうなんだろう？

-----

6/30追記： アメリカのクリーブランドからトラックバックもらった！とおもったらロバートさんだった（笑）。日本語だし。

- `ゴーヤチャンプルー — NeoHAWK`__

.. __: http://www.neohawk.org/Members/rbh-ja/roba-to-no-blog/goya-chanpuru

:extend type: text/html
:extend:
%%%%%%%%%

:id: 353
:date: 2006-07-04 03:43:15
:title: Python2.4.2と2.4.3でMIMETextの挙動が違う
:categories: ['python']
:body type: text/x-rst
:body:
Zope2.9.3をいじってて気づいたんだけど、Python2.4.2と2.4.3とでemail.MIMEText.MIMETextクラスの挙動がちょっと違うっぽい。どう違うかというと、

.. code-block:: Python

  Python 2.4.2 (#1, Jul  4 2006, 01:41:41)
  [GCC 3.4.2 [FreeBSD] 20040728] on freebsd5
  Type "help", "copyright", "credits" or "license" for more information.
  >>> from email.MIMEText import MIMEText
  >>> m = MIMEText('hello', 'plain', 'utf-8')
  >>> m.get_payload()
  'hello'

と

.. code-block:: Python

  Python 2.4.3 (#1, Jul  4 2006, 01:43:57)
  [GCC 3.4.2 [FreeBSD] 20040728] on freebsd5
  Type "help", "copyright", "credits" or "license" for more information.
  >>> from email.MIMEText import MIMEText
  >>> m = MIMEText('hello', 'plain', 'utf-8')
  >>> m.get_payload()
  'aGVsbG8=\n'
  >>> import base64
  >>> base64.decodestring(m.get_payload())
  'hello'

という感じ。payloadがbase64エンコードされちゃってる。 ``エンコードは _charset 引数にもとづき暗黙のうちに行われる`` らしいので、Python2.4.3でこの暗黙の部分が何か変わったんだろうなあ‥‥。もっとも、m['Content-Transfer-Encoding']はPython2.4.2以前からbase64なので、2.4.3の方が正しいのかもしれない。これまでと挙動が違って困るけど。

`What's New in Python 2.4.3?`_ に ``emailモジュールをアップデートした`` という記述はあるけど、直接関連しそうな細目は載ってないんですよね‥‥。リリースノート眺めててもよく分からないので、MLで聞いてみようかな。

.. _`What's New in Python 2.4.3?`: http://www.python.org/download/releases/2.4.3/NEWS.txt

----

MIMETextの第二引数はsubtypeなので、 ``text`` じゃなくて ``plain`` と書くべきでした。Python-ml-jpで柴田さんにやんわりと正されてしまった‥‥しまったなぁ(--;

:extend type: text/html
:extend:
%%%%%%%%%

:id: famicomband-8th
:date: 2006-07-08 01:09:08
:title: FamiComBand 8th
:categories: ['Event']
:body type: text/x-rst
:body:
知り合いのバンド(`FamiComBand`_)が今週末日曜日(7/9)に演奏するそーなので、ご紹介。(と `前回のBlog`_ からコピペる‥‥)

http://famicomband.org/live_8th

.. topic:: 演奏曲目

  - ムコメドレー
  - ドラゴンバスター
  - SPY VS SPY
  - マイクタイソンパンチアウト
  - ロードランナー
  - 格闘メドレィ2006（双截龍、等）
  - スポーツメドレィ2006（キャプ翼、燃えプロ、ファミスタ、等）
  - 他多数


ちなみに場所は `松戸市民会館`_ (`[mapion]千葉県松戸市松戸１３８９－１`_) です。遠すぎます(笑)


.. _`FamiComBand`: http://famicomband.org/
.. _`前回のBlog`: http://www.freia.jp/taka/blog/251
.. _`松戸市民会館`: http://www.morinohall21.com/kaikan/kaikan.htm
.. _`[mapion]千葉県松戸市松戸１３８９－１`: http://www.mapion.co.jp/c/f?uc=1&grp=MapionBB&nl=35/46/39.620&el=139/54/13.291&scl=10000&bid=Mlink


:extend type: text/html
:extend:
%%%%%%%%%

:id: 355
:date: 2006-07-23 16:18:08
:title: 突然ダーツにハマる
:categories: ['Game']
:body type: text/x-rst
:body:
先週1時間くらいプレーしてはまった。そのときやったのはカウントアップとローテーションをそれぞれ1回ずつだったんだけど、翌日さっそくGO君を誘って近所のダーツできる所（調布GOLDONの3F）に行ったりするくらいにはまった。それにしても、ダーツってルールがものすごくたくさんあるのね。あとダーツの得点計算とかルールとかが電子化されてることにびっくり。

昨日も仕事終わってから、とみた・Tad・Goと4人でやってきました。どうやら、DartsLiveカードというやつを買うとプレーヤー名を画面に表示する事が出来る、ということで早速買ってみたり。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 356
:date: 2006-07-26 01:13:34
:title: 単語の出現回数をpythonでカウントする
:categories: ['python']
:body type: text/x-rst
:body:
今日の昼頃、このblogがコメントスパム攻撃を受けた。あとで調べたところ、約2時間に渡って1360 POST受けたようだ。ウチのサイトにそんなに集中攻撃してもおいしくないのに、と思いつつ、検索エンジンの性質と絡めて考えると、狙われるサイトの規模はあまり関係ないのかもしれない。

このblogはCAPTCHAを入れておらずbuzzwordチェックでスパム対策をしている。このためか、今回のような物量攻撃には弱いのかもしれない。POSTの半分がbuzzwordチェック抜けて来ちゃったし。やっぱりCAPTCHA導入しよう。

ここで、気分転換にコメントスパム内の頻出単語上位20位をカウントしてみる。来週、電通大からインターンシップの学生(3年生)がやってくるので、「ああ、一般教養のプログラミング課題はC言語で単語数カウントとかやったなぁ」と懐かしみつつ作成。Pythonは楽でいいなぁ。

今日のコメントスパムを全てspams.txtに保存して以下のコードを走らせる。

.. code-block:: Python

    f = open('spams.txt')
    data = f.read()
    
    # counting
    words = {}
    for word in data.split():
        words[word] = words.get(word, 0) + 1
    
    # sort by count
    d = [(v,k) for k,v in words.items()]
    d.sort()
    d.reverse()
    for count, word in d[:20]:
        print count, word
    

んで、この結果の上位20位がこれ::

    722 neryuids
    146 link
    145 side
    139 effects
    123 and
    110 drug
    99 medication
    97 dosage
    82 generic
    73 tablet
    70 mg
    64 pregnancy
    63 information
    61 medicine
    59 online
    55 for
    54 acne
    53 vs
    45 withdrawal
    44 alcohol

一位の ``neryuids`` って何語？と思ってgoogleで検索したらTopが `takanory.net`_ さんで2位がウチというのがなんとも味わい深い（笑）。

.. _`takanory.net`: http://takanory.net/

:extend type: text/html
:extend:


:comments:
:comment id: 2006-07-26.4320337564
:title: Re:単語の出現回数をpythonでカウントする
:author: koma2
:date: 2006-07-26 11:53:53
:email: 
:url: 
:body:
自分の日記でやったら、こんなんなりますた。

  http://bloghome.lovepeers.org/daymemo2/20060726.html#p01

結果を貼っつけようとしたら「NG word 消せやゴルァ」って言われてしまったので（苦笑）、
リンクだけで。


:comments:
:comment id: 2006-07-27.9622983619
:title: Re:単語の出現回数をpythonでカウントする
:author: takanori
:date: 2006-07-27 12:29:24
:email: 
:url: http://takanory.net
:body:
「ｎｅｒｙｕｉｄｓ」で今検索したら、ランキングに変動がありました。
2位がロバートさんのところで3位が skype の岩田さんのところになっています!!

%%%%%%%%%

:id: 357
:date: 2006-08-02 01:18:32
:title: 徹夜でGO
:categories: ['misc']
:body type: text/x-rst
:body:
明日朝までにプレゼン資料を作ることになりました。なんだかとっても忙しい感じの日々が続いてます。勤め人としてはとっても忙しいけど、マンションの理事長としての打ち合わせがあったり、日本Zopeユーザー会のイベントのプレゼン資料を作ったりもします。あ、明日のイベントの資料も朝までに作らないと。明日はイベントの後会社に戻ってプレゼン資料のレビューがあります。どうやらイベントの宴会には出られそうにありません。イベントは二次会に参加するまで始まらないと思ってるのに……。


:extend type: text/html
:extend:


:comments:
:comment id: 2006-08-02.2202932480
:title: Re:徹夜でGO
:author: masaru
:date: 2006-08-02 03:33:41
:email: 
:url: 
:body:
お疲れ様ですｍ(。。)ｍ
先日は忙しい中ありがとうございました

%%%%%%%%%

:id: 358
:date: 2006-08-12 08:12:09
:title: 夏休みの計画
:categories: ['work']
:body type: text/x-rst
:body:
以下の計画に従って行動する予定。

1. 9月には土日の休みを確保する
2. 9月には夏休みを確保する

昨日会った取引先の方々も、夏休みは「各自取得」らしく、お盆休みというものは日本から消滅してしまったかのようだ。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 359
:date: 2006-08-17 01:03:09
:title: スタートレックエンタープライズ放送スケジュールの謎
:categories: ['misc']
:body type: text/x-rst
:body:
http://www.superdramatv.com/program/title_list.php?title_id=000000012

- 毎週木曜0時放送なのに、水曜0:00amと書かれている。せめて24:00では？
- 木曜日は0時、4時,12時の3回放送がある。
- 同じ回が初回放送含めて1週間に6回放送される

む。最初の項目以外は全然謎じゃないな。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 360
:date: 2006-08-19 18:47:22
:title: 会社 de スイカ
:categories: ['misc', 'food']
:body type: text/x-rst
:body:
実家からスイカが送られてきました。実家の庭で収穫した清水川産です。秋田のお父さん、お母さん、ありがとう。

今日も今日とて休日出勤なので、スイカは会社に送ってもらいました。会社のみんなで食べよう作戦です。ところが、会社には果物ナイフしかありません。相手はスイカです。刃が短くて皮の周辺しか切れないので、かなり苦労しました。

みんな満足するだけ食べて、中玉6kgの半分くらい残ってます。さて、残りはどうした物か……。

ちなみに、スイカの他に2kgくらいのメロンが3つ入ってました。タカミと書いてあるシールが貼ってあるので、これは清水川産じゃないようです。今日中に会社で食べきるのは無理かもしれません。


:extend type: text/html
:extend:


:comments:
:comment id: 2006-08-19.2445856864
:title: Re:会社 de スイカ
:author: masaru
:date: 2006-08-19 19:27:24
:email: 
:url: 
:body:
スイカ割りすればよかったのに

%%%%%%%%%

:id: 361
:date: 2006-08-23 22:40:55
:title: FF3DSを前日から待つモノたち in 新宿ヨドバシ
:categories: ['misc', 'Game']
:body type: text/x-rst
:body:
Tadからメールが来た。FF3DSを買うために前日から新宿ヨドバシに並ぶ人たちがたくさんいるようだ‥‥。

:extend type: text/html
:extend:


:comments:
:comment id: 2006-08-24.5908684912
:title: Re:FF3DSを前日から待つモノたち in 新宿ヨドバシ
:author: koma2
:date: 2006-08-24 14:16:31
:email: 
:url: 
:body:
昨日の夜新宿ヨドに逝ってたけど、こんなオブジェはなかった希ガス…ちょっと時間が早かった(20時半頃)からかな。

:comments:
:comment id: 2006-08-24.8098882540
:title: Re:FF3DSを前日から待つモノたち in 新宿ヨドバシ
:author: 清水川
:date: 2006-08-24 19:38:49
:email: 
:url: 
:body:
22時半です。限定版以外はふつーに今日の朝とか昼とかに買えたようす。

:comments:
:comment id: 2008-12-12.8311551484
:title: Re:FF3DSを前日から待つモノたち in 新宿ヨドバシ
:author: ぽむ
:date: 2008-12-12 12:17:12
:email: 
:url: 
:body:
わあｗｗｗすごすぐるｖそんなににんきだったんだｗｗ

:comments:
:comment id: 2008-12-12.8846520768
:title: Re:FF3DSを前日から待つモノたち in 新宿ヨドバシ
:author: ぽむ
:date: 2008-12-12 12:18:04
:email: 
:url: 
:body:
わあｗｗｗすごすぐるｖそんなににんきだったんだｗｗ

%%%%%%%%%

:id: 362
:date: 2006-08-24 09:59:44
:title: 大雨で足止め
:categories: ['misc']
:body type: text/x-rst
:body:
今日はちょっと涼しいなーと思ったら、大雨になってしまった。駅を出たところでドトールに足止め。お店の子が、こっちが何も言う前にアイスコーヒー持ち帰りを用意し始めたのを押しとどめて、ホットコーヒー店内を頼んでみる。前から一度やってみたかったんだよね(笑)

先日西友で買った980円の折りたたみ傘は根性が足りない。やはりヨーカドーのナノテクコートじゃないと撥水力が足りん。こんど買いに行こう。

そういえば、昨日の夜からFF3DSを買うために並んでいる人たちは大丈夫なんだろうか……


:extend type: text/html
:extend:


:comments:
:comment id: 2006-08-24.4730024060
:title: Re:大雨で足止め
:author: koma2
:date: 2006-08-24 14:14:33
:email: 
:url: 
:body:
顔覚えられてるのか。w ＞ドトール

%%%%%%%%%

:id: 363
:date: 2006-08-25 01:29:45
:title: Re: 私は、こんな悲惨なコードを見た
:categories: ['Programming']
:body type: text/x-rst
:body:
.. epigraph::

  「私は、こんな悲惨なコードを見た」という証言を募集！

  -- `So-net blog:ある nakagami の日記:Java と Oracle って偉いなー、つうか可哀想だなぁ`_


.. _`So-net blog:ある nakagami の日記:Java と Oracle って偉いなー、つうか可哀想だなぁ`: http://blog.so-net.ne.jp/nakagami/2006-08-24

私は見ました。それはある長いプロジェクトの半ばにさしかかった頃でした……。（略）

.. code-block:: CPP

  BOOL IsApplet(CONTEXT* context, BOOL *bFlag)
  {
    ...
    if (bResult==TRUE)
    {
      *bFlag = (hogehoge==fugafuga)? TRUE: FALSE;
    }
    return bResult;
  }


返値はTRUEかFALSEなんですが、TRUEの時には第二引数bFlagにTRUEかFALSEが格納されて返ってくる。つまり3つの状態を返す可能性があったわけです。全然Isじゃない。そう言えば、これが発見されたのは、第三引数にさらに別の値を返そうとしている所を目撃した時だったような気が……。

今はもう、C言語のような難しい言語に触ることはほとんどない生活なので、幸せな毎日を送っています。（実際問題、言語は関係ないんだよね……。）


:extend type: text/html
:extend:
%%%%%%%%%

:id: 364
:date: 2006-08-26 02:07:05
:title: 空を見上げて～英雄伝説空の軌跡ボーカルバージョン
:categories: ['Game']
:body type: text/x-rst
:body:
英雄伝説6のボーカルCDを購入しました。オンラインストアで全曲ダウンロード購入すると、後日CDの実物が送られてくると言うので、DL購入してみたところ、本当に送られてきました。って来なかったら詐欺か。

曲も歌詞もすばらしいけど、半分くらいはスーパーアレンジCDとか購入特典とかで既に持っている曲だというのがちょっと残念。あと2枚組のうち片方がボーカルで、もう片方がカラオケバージョンてのはどうなのよ？（笑）そういえば、ファルコムは昔からカラオケバージョンを付けてたなあ。

そうそう、CDのシリアル(?)が2枚とも同じで、CDDBからタイトル取得するときに判別できないのも-1.

:extend type: text/html
:extend:


:comments:
:comment id: 2006-08-26.5737440839
:title: CDDBは、
:author: Anonymous User
:date: 2006-08-26 06:32:54
:email: 
:url: 
:body:
CDに収録されている曲の長さと曲数をキーにして検索しているらしいです。
  http://arena.nikkeibp.co.jp/col/20031029/106374/

あと、同じTOCのCDが複数ある場合は、iTunesだとどっちにするか選択するダイアログが現れますね。

:comments:
:comment id: 2006-08-26.7576856223
:title: Re:空を見上げて～英雄伝説空の軌跡ボーカルバージョン
:author: 清水川
:date: 2006-08-26 09:22:38
:email: 
:url: 
:body:
＞CDに収録されている曲の長さと曲数をキーにして検索しているらしいです。

お～、そうだったんだ。知りませんでした。
たしかに選択ダイアログ出たけど、同じアルバムなのでほとんど同じタイトルの２択でした……。

%%%%%%%%%

:id: 365
:date: 2006-08-26 12:59:24
:title: マンションの総会2006
:categories: ['Event', 'misc']
:body type: text/x-rst
:body:
午前中、マンションの総会に参加してきました。今年は2回目の参加で、理事長なので議長をしてきました。

総戸数15戸に対して、参加人数は６人。委任等が６人。ほとんど去年と一緒です。次期は大規模改修の話も進めないと行けないので、次期理事長はなかなか忙しくなりそうです。自分が理事長としてやったのは、判子押しと、ゴミ収集用 `折りたたみBOX`_ の購入くらいです。

ところで、在住じゃない区分所有者（つまり賃貸しているとか、投資で持ってるとか）は理事になれない決まりになっています。ところが、うちのマンションでは4戸くらいが在住じゃない感じです。この調子で減っていったら、理事ってどうなるんでしょう？管理組合規約を改正するにしても、住んでないのに理事っていうのも……。まあ減ることはないにしても人数は少ないので、隔年くらいで番が回ってきそうな感じです。

理事長は翌期も脇役として理事になる決まりがあるので、自分も残ることになります。あれ？ということは3年に2回くらいは理事に籍を置いてそうな予感が……。

.. _`折りたたみBOX`: http://www.rakuten.co.jp/tairaml/524052/523280/

:extend type: text/html
:extend:


:comments:
:comment id: 2006-08-26.1125007373
:title: Re:マンションの総会2006
:author: masaru
:date: 2006-08-26 17:15:13
:email: 
:url: 
:body:
あれ？　今日はプロレスじゃなくて、LLは行かなかったんですか？

:comments:
:comment id: 2006-08-26.6007045504
:title: Re:マンションの総会2006
:author: 清水川
:date: 2006-08-26 20:43:21
:email: 
:url: 
:body:
仕事ですが、何か？
9月一杯までの予定は「し・ご・と」

%%%%%%%%%

:id: 366
:date: 2006-09-18 11:20:10
:title: マンションの理事会第1回
:categories: ['Event']
:body type: text/x-rst
:body:
先日の `マンションの総会2006`_ で決めきれなかったことを決めてきました。場所はマンションエントランス。4人の理事が玄関前で30分。30分くらいのことに喫茶店行くまでもないとは言え、あんまり理事会ぽくないなあ。すぐ隣に喫茶店があるけど11時からだし。そうだ、次回は11時からにしよう。そうすれば寝坊しないと思うし。

とりあえず、今期の理事長と使われていない自転車の撤去について管理会社と方針を決めてきました。

.. _`マンションの総会2006`: http://www.freia.jp/taka/blog/365


:extend type: text/html
:extend:
%%%%%%%%%

:id: 367
:date: 2006-09-18 11:26:35
:title: STARTREKまるごと40時間 2006
:categories: ['misc']
:body type: text/x-rst
:body:
この3連休も自宅で仕事をしていたわけですが、3連休は `STARTREKまるごと40時間`_ の放送日だった！気がつくともう3日目に突入しているではないか！放送内容はなんだっけ！？

- 視聴者が選んだ「宇宙大作戦／スタートレック」ベスト・エピソード15
- 「スタートレック　エンタープライズ」最終第4シーズン77話～98話
- ドキュメンタリー3本

見たいのは未放送分のエンタープライズ96～98話の3話と、ドキュメンタリーだけだった・・。ドキュメンタリーは土日に放送されているのでもう見れません。残念。とりあえず3話見れるだけでも良しとするか。

.. _`STARTREKまるごと40時間`: http://www.superdramatv.com/line/st/maru40_2006/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 368
:date: 2006-09-24 00:00:00
:title: 秋田へ
:categories: ['misc']
:body type: text/x-rst
:body:
リリース5日前ですが、秋田に行ってきました。寒風山まつりで見た ``なまはげ太鼓`` がかっこよかった。

*# このblogは2006/10/8に書きました。*



:extend type: text/html
:extend:


:comments:
:comment id: 2006-10-18.8109647864
:title: Re:秋田へ
:author: Anonymous User
:date: 2006-10-18 17:40:11
:email: 
:url: 
:body:
ともこ、ばばへらあいす目撃す。ギザ、食べたし、ウマシ。
この間は来てくれてありがとう。何のおかまいもできず、ごめんね。今度はママが（ともこ）がお休みの日に来てください。あなたのお母さんの上京する日を待っています。楽しみです。

%%%%%%%%%

:id: 369
:date: 2006-09-30 22:00:00
:title: 5ヶ月ぶりに自転車(75km)
:categories: ['bicycle']
:body type: text/x-rst
:body:
仕事が一段落して最初の土日がやってきました。この土日は自転車でサイクリングに行こうと思っていたのですが、いとこから、PCを買い換えたので以前のPCのデータを移し替えたい、というTELがあり、いとこの家に行くことに。どうせならサイクリングも同時にしてしまえ！ということで、自転車で調布から小岩まで行ってきました。片道37kmあります。

出発前は、5ヶ月も乗ってなかったし、会社(20km地点)まで行ければあとは電車で行っても良いかなと思っていたのですが、以前とおなじペースで会社まで行けてしまったので、そのまま目的地まで自転車で行くことに。

途中、浅草橋(26km地点)でaihatenaと合流して二人で自転車で小岩へ。正直、浅草橋から先はかなりきつかった。川を越えるたびに橋を登るので、既に体力を消耗している自分はaihatenaにおいて行かれてしまったり。ていうか普段速くても時速30kmしか出さないのに、aihatenaは時速35kmとか出してて、平坦な道でもおいて行かれてます。

結局、小岩のいとこの家まで37kmを2:30で走破しました。平均時速15km。浅草橋で休憩したのでこんなもんでしょう。

---------------

帰りは行きよりも大変でした。あとで聞いたところによると、ハンガーロック状態になっていたらしく、ペダルをこぐエネルギーが尽きていたようです。途中のコンビニでヴィダーイン・Energyを飲んだら復活しました。あれって本当にエネルギー入ってたんだ(笑)。

帰りは37kmを4時間かけて帰ってきたので、平均時速9kmでした。もうだめ。

---------------

*# このblogは2006/10/8に書きました。*


:extend type: text/html
:extend:
%%%%%%%%%

:id: 370
:date: 2006-10-01 23:00:00
:title: とつぜんボードゲーム大会
:categories: ['Game']
:body type: text/x-rst
:body:
昨日の自転車75kmでぐったりしているところに、会社の同僚kojimaxからメッセンジャーで「ボードゲームしに行きます」との連絡が。突然ボードゲーム大会になりました。参加者は、自分、kojimax、とみた、aihatena、GOの5人です。

今回は自分が知らないボードゲームばっかりやった気がします。

- サンクトペテルブルグ (2h x2)
- ダイヤモンド (20m x2)
- プエルトリコ (3h x1)

ダイヤモンドは超単純な、ダンジョン探索チキンレース(笑)で、トラップ発動確率が計算上の確率よりもなぜかいつも早かったせいで、とみたが一人負け。ゲームに妥協しない男だ。

あとは、サンクトペテルブルグとプエルトリコは経験者のkojimaxの勝ち。プエルトリコは説明を聞いているだけで30分くらいかかった気がする。しかも要素が多くて勝ちに行く条件がなかなか見えない。以前やったカルカソンヌもそんな感じだった。

結局ダイヤモンド以外は勝てなかったなぁ。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 371
:date: 2006-10-09 20:00:00
:title: とつぜん多摩動物公園
:categories: ['Event', 'bicycle']
:body type: text/x-rst
:body:
今日はとみたと自転車でサイクリングに出かけた。最初は高幡不動のとやま夫妻宅に向かう予定だったけど、向かってる途中で連絡したら「多摩動物公園に遊びに来てる」と言われ、目的地を変更（笑）。そういえば5月頃に同じ事をやって、そのときも外出してていなかったんだよな・・。やっぱり先に連絡しておくべきだったかも。

そんないきさつで多摩動物公園にやってきました。男二人で動物園。入場料600円払って動物園。微妙。とやま夫妻と合流したものの、夫婦vs男二人では勝ち目がないので別行動・・・何しに来たんだ？（笑）

とりあえずバクとかモルモットとか見て帰ってきました。往復30kmくらい。たいした運動になってないなぁ。

*# このエントリは10/22に書きました*


:extend type: text/html
:extend:
%%%%%%%%%

:id: 372
:date: 2006-10-28 20:00:00
:title: 鯨会席大満足コース
:categories: ['food']
:body type: text/x-rst
:body:
10/28 オープンソースカンファレンスの後、OSCとは全然関係ないメンバーで新宿の樽一というお店で鯨宴会してきました。最初から最後まですべて鯨な、鯨会席大満足コースというやつを頼んだのですが、最安コースなだけあって、全部ちょびっとずつでした。

鯨、うまかったけど、コース外の料理もすごくきになる‥‥。ホッケとカキだけは注文したけど、こんど行くときはコースとかなしでたのしみたい。

::

  【樽一　たるいち】
  〒160-0021 東京都新宿区歌舞伎町1-17-12第1浅川ビル5F
  http://www.taruichi.co.jp/

  鯨会席大満足コース　3,670円 http://www.urakasumi.com/hpa/taruichi.htm


:extend type: text/html
:extend:
%%%%%%%%%

:id: 373
:date: 2006-11-04 16:00:00
:title: とやま宅でケーキ三昧
:categories: ['misc']
:body type: text/x-rst
:body:
先日、とやま夫妻宅に遊びに行こうとしてなぜか `多摩動物公園に行ってしまった`_ ので、今日はリベンジということで事前に連絡を入れてから遊びに行った。＜あたりまえ

今回は、また自転車でとみたと2人で行くつもりだったんだけど、都合がつかなくなってしまい一人でサイクリングしつつ、調布から高幡不動へ。約19km。自宅から会社までも19kmなんだけど、多摩川土手は信号のないためか7割くらいの時間で到着。

で、着いたら、ケーキ12個が待ってました。。。買いすぎ(笑)。もともと2人で行く予定だったとはいえ、とやま夫妻の分もかんがえても一人3個は多すぎませんか(笑)。

ということで、なぜか1人でものすごい歓待を受けてしまいました。ごちそうさまでした。

.. _`多摩動物公園に行ってしまった`: http://www.freia.jp/taka/blog/371


:extend type: text/html
:extend:
%%%%%%%%%

:id: 374
:date: 2006-11-05 17:16:28
:title: trackback止めました
:categories: ['Plone']
:body type: text/x-rst
:body:
ついにtrackbackを止めました。trackbackスパム多すぎ。そろそろBuzzWordフィルタ＆IP制限にも限界が来ているようです。（なんか負けた気がしないでもないですが・・・）

対策としては、

- 日本語を含まないtrackbackを弾く
- SpamAssasinとかのベイジアンフィルタと連携する

が思いつきますが、、、海外からtrackbackもらうことは無いから、とりあえず前者で対処かな。この流れで行くと、コメント投稿も同様にするか、CAPTCHA入れるしかないのかな。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 375
:date: 2006-11-05 21:42:46
:title: たけちゃん にぼしラーメン
:categories: ['food']
:body type: text/x-rst
:body:
11月4日。調布の奥地から「たけちゃん にぼしラーメン」が調布駅前に引っ越してきた(`Google地図`_)。移転前のお店には食べに行ったことがなかったので、開店当日の昨日食べに行ったとやま&GOの二人に聞いてみたところ、「注文してから出てくるまで長い」「麺がのびてた」とあまり評価は良くなかった。

で、今日食べに行ってみたところ、注文してから出てくるまで15分くらいかかったり、店員が多すぎて手が余ってたりと、若干軌道に乗ってない印象があったものの、ラーメンはうまかった。ていうか煮干しだった。隠し味？のゆずが良い感じだ。

しかし、有名な店だけあって、飯時は常に10人～20人くらい並んでるみたいだ。深夜0時までやってるみたいなので、すいてる時間帯にまた食べに行ってみよう。

（ところで、店外の換気扇からものすごい煮干し臭が出てて、向かいのマンションのエントランスに流れ込んでるんだけど、そのうちマンション住人から苦情がでそうだ by 住んでいる友人）

.. _`Google地図`: http://maps.google.co.jp/maps?f=q&hl=ja&q=%E8%AA%BF%E5%B8%83%E5%B8%82%E5%B8%83%E7%94%B01-45+&ie=UTF8&z=18&ll=35.652048,139.545534&spn=0.002188,0.005359&om=1&iwloc=addr


:extend type: text/html
:extend:
%%%%%%%%%

:id: 376
:date: 2006-11-09 13:36:24
:title: ドトール ズワイガニベーグル
:categories: ['food']
:body type: text/x-rst
:body:
今日の昼ご飯は、ドトールで11/8から発売の `ズワイガニベーグル 漁師風ブイヤベースソース`_ をお持ち帰り。「お口にジュワッと広がる、贅沢なカニの風味をご堪能ください」とあるんだけど、残念ながらカニがベーグルに勝ててない感じ。おしい。

.. _`ズワイガニベーグル 漁師風ブイヤベースソース`: http://www.doutor.co.jp/info/bagel061108/index.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 377
:date: 2006-11-10 23:34:22
:title: 粗大ゴミよりバザー: 調布祭・我楽多市へ
:categories: ['misc']
:body type: text/x-rst
:body:
最近また部屋のものが増えつつあるので、収納系家具を物色しつつ、不要なものはためておかないで捨てるようにしている。で、古いスピーカー4つを粗大ゴミに出そうと思って回収費用をしらべてみたら、１つ630円。4つあるので2520円。うわ高。

そういえば11月は調布祭 [1]_ があるから、たしかバザーあったよなーと思って調べてみたら、ちょうど2週間後の11/17から開催だった。で、我楽多市については生協に電話しろ、と書いてあったので早速電話してみた。最初は、バザーの当日に持って行けばいいのかなと思っていたところ、「明後日でどうですか？」と言われた。「え？明後日持って行けば良いんですか？」って聞いたら、どうやら取りに来てくれるらしい。すげーらくちんだ。しかし、大学生協の人って日曜日も働いてるのかな？業者かな？

ということで、使えるものは粗大ゴミに出さないで、我楽多市にだしましょう（申し込みはお早めに）。

*# 2500円浮いたので宣伝してみる*

.. [1] 電気通信大学の学園祭。調布市にあるから調布祭。 

:extend type: text/html
:extend:


:comments:
:comment id: 2006-11-11.2239964661
:title: Re:粗大ゴミよりバザー: 調布祭・我楽多市へ
:author: koma2
:date: 2006-11-11 01:13:44
:email: koma2@lovepeers.org
:url: 
:body:
大学の場合、「土日」という概念が存在してない人が少なからずいるわけで（いろんな意味でw）。生協が営業してても不思議はない気がする。

ちなみに、私のいた某大学の場合、少なくとも土曜は営業してますた。よく覚えてないけど、日曜も食堂ぐらいはやってたような。

:comments:
:comment id: 2006-11-21.2656362167
:title: Re:粗大ゴミよりバザー: 調布祭・我楽多市へ
:author: ガラクタ運営側一学生。
:date: 2006-11-21 23:44:26
:email: 
:url: 
:body:
私も粗大ゴミの検索をしていたら、ここのブログにたどり着きましたのでコメント。（正確にはガラクタの文字に釣られたのですが）

一応ガラクタ市は生協周辺にいる学生（なんといえばいいのやら）が有志で行なっております。業者ではないです。
あと、お金儲けで働いてるわけでもありません。ただ単にいろんなもの（使える妙なオーディオとか古いＰＣとか、面白い雑貨）を見れたり、地域の方と交流するのが楽しくて毎年行なっております。

写真のスピーカー、見覚えがあります♪（家電担当でしたので）
音楽サークルの方が喜んで購入されていかれました。
来年もよろしければ是非ご利用お願いします。

ＰＳ，電通大自体に土曜授業があるので、土曜は生協営業してますー。日曜は流石にお休み…。

%%%%%%%%%

:id: 378
:date: 2006-11-12 16:17:22
:title: 金色の野
:categories: ['bicycle']
:body type: text/x-rst
:body:
その者、白きルイガノにまたがりて、金色の野に以下略


:extend type: text/html
:extend:
%%%%%%%%%

:id: 379
:date: 2006-11-18 03:37:26
:title: Wiiの予約に並ぶ丑三つ時
:categories: ['misc', 'Game']
:body type: text/x-rst
:body:
新宿ソフマップでWiiの予約のために並んでみました。というか、とやま＆GOが並ぶというのでおもしろそうだから一緒に並んでみます。前日21時に現地に並んだ時点で2番目。さすがに予約にはそんなに人は集まらないみたい。

そして深夜3時。現時点で25人くらいが並んでいます。つーか、始発で来ても余裕だったんじゃ？

それにしても・・・寒い・・・。1つ19円のカイロを3つ併用しても寒い・・・


:extend type: text/html
:extend:


:comments:
:comment id: 2006-11-18.1670009028
:title: Re:Wiiの予約に並ぶ丑三つ時
:author: しみずかわ
:date: 2006-11-18 05:42:47
:email: 
:url: 
:body:
朝5時半。気がついたら列が80人くらいになってる。

%%%%%%%%%

:id: 380
:date: 2006-11-18 09:03:21
:title: Wiiの予約、完了
:categories: ['Game']
:body type: text/x-rst
:body:
昨日体調の悪かったとみたも、朝起きてから参戦。京王線が人身事故で止まるというトラブルに巻き込まれつつも7:12現地着、170番目。7:22には200人に達して締め切り。10分差で間に合うとは‥‥、ヤツはまた伝説を作った！

そして朝8時に予約開始。

今日の戦果
----------

- Wii本体（の予約券）
- はじめてのWiiパック（の予約券）
- Wiiクラシックコントローラ[5000ポイント同梱版]（の予約券）
- スイングゴルフ パンヤ（の予約券）

*# とみたを待ちつつ新宿西口マックから投稿。眠い...*

:extend type: text/html
:extend:
%%%%%%%%%

:id: 381
:date: 2006-12-01 15:47:47
:title: 函館にやってきました
:categories: ['Event', 'Zope', 'Plone']
:body type: text/x-rst
:body:
`はこだて未来大学`_ の授業でCMSというかPloneの講演（講義？）をするために函館にやってきました。ちょうど昨日から雪が降り始めたということで、ちょっと寒いけど、秋田県民としては平気な顔をしなくてはいけません。

ということで、着いていきなり寿司をごちそうになりました。回転だけど、安くてうまい。北海道はネタが新鮮でいいなあ。

さて、講義は16:30からです。資料もうすこし書き足そうかな‥‥。

.. _`はこだて未来大学`: http://www.fun.ac.jp/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 382
:date: 2006-12-01 23:00:00
:title: はこだて未来大学で講義しました
:categories: ['Event', 'Zope', 'Plone']
:body type: text/x-rst
:body:
`はこだて未来大学`_ でCMSの講義をしてきました。評価は上々のようです。鈴木先生には校内を案内してもらったり、おいしいお店に連れて行ってもらったり、大変お世話になりました。また遊びに来ますので、よろしくお願いします。（遊び違う

それにしても、未来大、広くてきれいでかっこいいな～。母校は箱庭だったからな～。

.. _`はこだて未来大学`: http://www.fun.ac.jp


:extend type: text/html
:extend:
%%%%%%%%%

:id: 383
:date: 2006-12-02 13:00:00
:title: 五稜郭～ウニ丼
:categories: ['Event']
:body type: text/x-rst
:body:
ホテル `ドーミーイン`_ から歩いて五稜郭にやってきました。以前五稜郭に来たのはたぶん中学校3年生の修学旅行だけど、何年か前に五稜郭タワーが建て直されて、五稜郭の全景がみれるようになったらしい（未来大鈴木先生談）。100mの高さからでも視界いっぱいで、迫力あるなぁ。しかし写真を撮っても全景が入らないのは残念。この迫力は記憶にとどめておくことにしよう。


五稜郭の夕張メロンアイスを記憶にとどめ、次は路面電車に乗って一路ウニ丼へ。ウニ丼は事前にググっておいた、函館朝市の `むらかみ`_ へ。

函館駅前に着いた頃には、弱吹雪状態で、雪だ！冬だ！さみい！って感じで冬を満喫。むらかみに着くまで、昼過ぎの朝市の中を見て回ったんだけど、みなさん商売熱心ですな。そんな一杯5000円以上するカニは買えませんよ。食堂のおばちゃんも熱心ですね。吹雪の時にそんな露天の食堂に誘わないでくださいよ。

そして着いたむらかみ。むらかみのウニ丼を頼もうとして他のメニューに目移りを‥‥一度に二つ楽しめる二色丼にしよう！‥‥（堪能中）‥‥。ウニうますぎ。甘くとろけるようだよ。どうしよう？ていうかイクラいらん。ALLウニにしておけばよかったorz...。


.. _`ドーミーイン`: http://www.hotespa.net/hotels/goryoukaku/
.. _`むらかみ`: http://gourmet.hakonavi.ne.jp/asaichi/unimurakami.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 384
:date: 2006-12-02 16:00:00
:title: 函館駅～五稜郭駅～函館駅
:categories: ['Event']
:body type: text/x-rst
:body:
ウニでおなかを満たしたので、次はWiiの函館市場調査。函館駅から五稜郭駅に向かおうとして改札をくぐって、次の電車まで40分あることに気がつく。しまった、いつもの癖で時刻表見ないで入っちゃった。

しかたがないので、構内で十二国記を読みつつ次の電車を待ち、やってきました五稜郭駅。五稜郭駅前にはヤマダ電機がある。これは昨日のうちに未来大の鈴木先生から聞いておいた。駅から歩くこと5分。ヤマダ電機の入り口に「Wii 終了しました」の張り紙を見て、調査完了！‥‥帰るか。

函館駅に帰ってきた時には中吹雪になっていて、ちょっと冬を楽しむ余裕が無くなってきた感じ。いちど函館駅内に逃げ込んでみても、土産物屋があるわけでもなし。駅前に大きめの土産物屋があるのを横目で見つつ、空港に移動して、空港で土産を購入。マルセイ バタークッキーと、熊肉入りカレー。

帰ったら、Wii買いにソフマップいこう。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 385
:date: 2006-12-11 10:00:00
:title: ノロ
:categories: ['misc', 'food']
:body type: text/x-rst
:body:
週の最初。僕は病院にいました。ノロウィルスにやられて不足した水分を点滴で補っています。どうやら土曜日に食べた刺身にノロが付着していたようですが、容器とか全部捨てちゃったので証明できません。こういうのって言うだけでも言っておいた方が良いのかな？（ここかな？ `東京都 福祉保険局 2006/12`_)

.. _`東京都 福祉保険局 2006/12`: http://cgi.metro.tokyo.jp/aps/press/inet.cgi?mode=s&yy=2006&mm=12


:extend type: text/html
:extend:
%%%%%%%%%

:id: 386
:date: 2006-12-13 20:00:00
:title: かゆ
:categories: ['food']
:body type: text/x-rst
:body:
うま。

今日から復帰ということで、晩ご飯に久々にお粥。会社の帰りに新宿の京王モールにあるお店で食す。ひさびさにとる塩分はうまい！ほぼ3日間毎食ヨーグルト1個だったので、体重はかなり減ったけど、食べたらすぐ元に戻るんだろうなあ・・・。なんにしても健康がいいね。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 387
:date: 2006-12-20 10:38:58
:title: オブジェクト倶楽部 X'masイベント2006
:categories: ['Agile(XP)', 'Event']
:body type: text/x-rst
:body:
今日はObjectClubの冬イベントに参加。会場の入り口から建物前までの各所に案内の人がサンタ帽子姿で立って‥‥一人目は平鍋さんだ！さすが....。

今日の参加予定セッション:

1. PMが上手にTDDとつきあう方法
2. プロジェクトメンバーを笑顔でも来るための心構え
3. クは駆動のク～Developer TestingとBDD～
4. 明日から使える今どきのWEBデザイン
5. 見える化は改善の道具

今は2つ目のセッション中。とやまと一緒に聴講中。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 388
:date: 2006-12-23 22:01:35
:title: 調布 竹矢 閉店
:categories: ['food']
:body type: text/x-rst
:body:
電気通信大学生なら半分くらいの人が知っている、調布のとんかつ屋 ``竹矢`` が2006/12/26のお昼で閉店してしまう。大学4年の頃には研究室の連中と毎週1回は行っていた気がする。そういえば卒業式の後もみんなで行ったなあ。

ということで、名残を惜しみつつ最後の食事に行ってきました。ウチから徒歩30秒。頼んだのは「とんかつ Big L」1030円。学生時代は「Big L 大盛り」をいっつも食べてた気がするけど、最近はそんなに食べられなくなってきてるので普通盛りに。ちなみに一緒に行ったとみたは「ランチとんかつ」680円だったかな。

おいしかったです。でも昔の方がおいしかった気もします。記憶は美化される・・・ということ？

とにもかくにも、お疲れ様でした。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 389
:date: 2006-12-26 11:30:00
:title: 自前RSSアグリゲータ
:categories: ['python']
:body type: text/x-rst
:body:
複数のRSSを集約してRSS2.0で出力する機能があると便利かなー、と思って feedparser_ を使ってちょろっと書いてみました。集約して最新を取り出す部分は10行程度。feedparser便利だなあ。

.. code-block:: Python

    # -*- coding: utf-8 -*-
    # http://feedparser.org/
    import feedparser
    
    # RSS URL list for aggregation.
    urls = [
        'http://pc.watch.impress.co.jp/sublink/pc.rdf',
        'http://internet.watch.impress.co.jp/cda/rss/internet.rdf',
        'http://www.watch.impress.co.jp/av/sublink/av.rdf',
    ]
    
    d=[]
    # get early 10 entries.
    for u in urls:
        f=feedparser.parse(u)
        for e in f.entries:
            d.append((e.updated_parsed,e.updated,e.title,e.link))
    d.sort()
    d.reverse()
    d = d[:10]
    
    
    # print 10 entries with RSS2.0 format.
    template = u'''<?xml version="1.0"?>  
    <rss version="2.0">
      <channel>
        <title>%(site_title)s</title>
        <link>%(site_link)s</link>
        <description>%(site_desc)s</description>
    %(items)s
      </channel>
    </rss>
    '''
    
    item_tmpl = u'''
        <item>
          <title>%(item_title)s</title>
          <link>%(item_link)s</link>
          <description>%(item_desc)s</description>
          <pubDate>%(item_date)s</pubDate>
        </item>
    '''
    
    item_list = []
    for x in d:
        item_date, item_title, item_link = x[1],x[2],x[3]
        item_desc = u''
        item_list.append(item_tmpl % locals())
    
    items = u''.join(item_list)
    site_title = u'Impress'
    site_link = u'http://watch.impress.co.jp/'
    site_desc = u''
    
    print template % locals()
    

ちなみに、RSSで再出力するだけだと全然意味無かったです。集約なんてRSSリーダがやってくれるもの。。。


.. _feedparser: http://feedparser.org/


:extend type: text/html
:extend:


:comments:
:comment id: 2006-12-28.7951504173
:title: Re:自前RSSアグリゲータ
:author: M.Shibata
:date: 2006-12-28 03:23:17
:email: 
:url: 
:body:
本題ではないのですが、最後の一行が勉強になりました。
こんなやりかたもあるんですね。

:comments:
:comment id: 2006-12-29.4569941967
:title: Re:自前RSSアグリゲータ
:author: しみずかわ
:date: 2006-12-29 04:17:38
:email: 
:url: 
:body:
> こんなやりかたもあるんですね。

怠け者なので(笑)
明示的でない方法なので、時々はまります。あまりお勧めはしません...
%%%%%%%%%

:id: 390
:date: 2006-12-30 12:49:04
:title: クニに帰る
:categories: ['misc']
:body type: text/x-rst
:body:
今日から4日間秋田へ帰ります。でも実家には深夜まで誰もいません‥‥なんで？仕方がないので地元の友達を晩飯に誘ってみたところ、用事があると言われてしまいました。そりゃ当日連絡してもだめだよね。残念。

ところで、新幹線は片道16800円です。秋田新幹線は自由席がありません。12月に入ってからあわてて指定席を買おうとしたらグリーン車しか残ってませんでした。グリーン車は+4000円です。年2回実家に帰ると結構な額になることに今気づきました。まあ九州や北海道に帰郷する人に比べれば全然ましかもしれません。

それにしても秋田は遠い・・。岩手から先が長すぎ。


:extend type: text/html
:extend:


:comments:
:comment id: 2006-12-30.1078667165
:title: Re:クニに帰る
:author: とやま
:date: 2006-12-30 17:41:49
:email: 
:url: 
:body:
福岡まで夜行バスで往復27,000円だよ。でもとても疲れるけど。てか疲れた。
よいお年を～。

:comments:
:comment id: 2006-12-30.9255155246
:title: Re:クニに帰る
:author: koma2
:date: 2006-12-30 22:05:27
:email: koma2@lovepeers.org
:url: 
:body:
ムーンライトえちごで新潟に出て、そこから羽越線で秋田まで…とかいかが？ 昼前には秋田に着くし、余るの覚悟で18切符買っても、新幹線の片道より安いよ。w

%%%%%%%%%

:id: 391
:date: 2007-01-01 22:48:29
:title: 明けましておめでとうございます
:categories: ['misc']
:body type: text/x-rst
:body:
Blogを見ているみなさま、今年もよろしくお願いいたします。

秋田で新年を迎えました。両親と一緒に追分の小泉潟に白鳥を観に行ってきました。食パンをちぎって放り込むと‥‥おお、白鳥がバッサバッサと群がりおるわ。これは今年はいい年になりそうだ（何故？

そんな感じで、今年は亥年です。あれー？


:extend type: text/html
:extend:
%%%%%%%%%

:id: 392
:date: 2007-01-18 23:52:02
:title: WindowsでPython Imaging Library(PIL)をビルドする
:categories: ['python', 'Windows']
:body type: text/x-rst
:body:
python.jpのMLで出た話題。だいぶ前にビルドがうまくいったときにメモっておいたのを、思い出したかのようにBlogに書いてみる。

環境： `WindowsでFreeなCモジュールビルド環境`_ 

- 以下のパッケージを入手

  ::

    Imaging-1.1.6.tar.gz
    jpegsrc.v6b.tar.gz
    zlib-1.2.3.tar.gz

- 以下のように展開

  ::

    Imaging-1.1.6/
      + jpeg-6b
      + zlib-1.2.3

- setup.py を修正

  ::

    JPEG_ROOT = 'jpeg-6b'
    ZLIB_ROOT = 'zlib-1.2.3'

- JPEG_ROOTでビルド

  ::

    ren jconfig.vc jconfig.h
    nmake -f makefile.vc

- ZLIB_ROOTでビルド

  ::

    nmake -f win32\Makefile.msc

- Imaging-1.1.6でビルド

  ::

    python setup.py bulild

  以下のように出力されればOK::

    *** TKINTER support not available (Tcl/Tk 8.4 libraries needed)
    --- JPEG support ok
    --- ZLIB (PNG/ZIP) support ok
    *** FREETYPE2 support not available

- 作成された \*.pyd (.so) を Imaging-1.1.6へコピー
- Imaging-1.1.6をテスト

  ::

    python selftest.py

  以下のように出力されればOK::

    57 tests passed.


.. _`WindowsでFreeなCモジュールビルド環境`: http://www.freia.jp/taka/memo/freevcbuild

:extend type: text/html
:extend:
%%%%%%%%%

:id: 393
:date: 2007-01-27 03:13:25
:title: Zope-2.10.2リリース
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope-2.10.2がリリースされましたので `CHANGES.TXT`_ を翻訳して `zope.jpサイト`_ においておきました。しかし、Trackerとか実装コードの変更とかを見てやっと書いてあることが翻訳できました。そんな感じなので、翻訳した文面を見ても「で、何が直ったの？」という感じです。きっと分かる人には分かるんでしょう。

ちょっとだけ補足すると、、、

Zope-2.10.0からZopePateTemplateの実装がZope3ベースになった影響で、日本語文字列を含むPateTemplateのZMIでの保存時にエラーが発生して保存できない問題が起きていました。これが修正されました。Zope3のAdapterの仕組みを使って修正されており、UnicodeEncodingConflictResolverというやつを切り替えて、エンコード変換エラー時の挙動をカスタマイズ出来るようになったようです。

あと、既存エンコードをon-the-flyで変換するとも書いてあります。変換元エンコードは環境変数ZPT_REFERRED_ENCODINGに設定しておく必要がありそう。この環境変数にshift-jisと設定しておけば、古いZPTインスタンスが内部にshift-jis等で文字列を保持していても、動的に（表示時ではないみたい）Unicodeに変換してくれる仕組みのようです。

おまけ。同梱されるZope3が3.3.1になりましたが、Zope-3.3.1はまだリリースされていないような気がします。

----

そうそう、内部がUnicodeになった、という文面を見てふと思いついて実験してみました。

::

  management_page_charset:  utf-8
  default-zpublisher-encoding:  shift-jis

こんな設定にすると、ZMIはutf-8で公開ページはshift-jisに！でも ``～`` が正しくマッピングされなくて化けました(笑)。こんな変な設定はするなと言うことで。


.. _`CHANGES.TXT`: http://www.zope.org/Products/Zope/2.10.2/CHANGES.txt
.. _`zope.jpサイト`: http://zope.jp/download/zope/releases/2.10.2/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 394
:date: 2007-01-28 23:00:00
:title: ボードゲーム初め
:categories: ['Game']
:body type: text/x-rst
:body:
ボードゲーム初めです。まだぎりぎり１月。ＯＫ。

今日は先日に引き続き、kojimax with しみずかわチーム(自分・とみた・GO・Ric)のボードゲーム大会が開催されました。今日の品目は、

- Battle Line
- ゲシェンク
- Limit
- Catan
- あやつり人形

Battle Lineのゲーム内容を一言で言うと、証明ゲーム。作者は数学者と言うことで納得。2人用なので、人が集まらなくても遊べるけど、知恵熱が出る。やり過ぎに注意。詳しくは `はてな`_ とかを参照。

ゲシェンクはお手軽で、駆け引きと読み合いが楽しいゲーム。重いゲームの合間に。Battle Lineとカタンの間に入れるとちょうど良いかもしれない。

Limitもお手軽系だけど、この手の記憶系は苦手じゃないけど買いたいとは思わないかな。マンマミーヤとかが近い感じ。カタンはカタン。それ以上でもそれ以下でもない。あやつり人形は‥‥変なゲーム。暗殺者が王様を暗殺したり、泥棒が商人を襲う。

ということで、Battle Lineとゲシェンクは買いですよ！


.. _`はてな`: http://d.hatena.ne.jp/keyword/%A5Хȥ%EB%A5饤%A5%F3 


:extend type: text/html
:extend:
%%%%%%%%%

:id: 395
:date: 2007-01-29 23:52:28
:title: Battle Line手に入らず
:categories: ['Game']
:body type: text/x-rst
:body:
新宿イエローサブマリンでゲシェンクを購入。1500円。Battle Lineは売ってなかった。残念。通販も見あたらないなあ‥‥。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 396
:date: 2007-02-04 21:55:44
:title: BattleLineのカード自作(byとみた)
:categories: ['Game']
:body type: text/x-rst
:body:
`BattleLine`_ の国内販売はしばらくなさそうな感じなので自作するしかないかー、と冗談で言っていたら、とみた先生が本当に作ってしまいました！１～１０の数字を６スート分と、戦略カード十数枚をプリントすればOK、って結構めんどくさかったみたい。。

用紙は三和サプライの `JP-MCMARUGK`_ を使用。印刷するまでも大変だったけど、その後紙からカードを切り離すのがまた面倒‥‥。ミシン目が入ってるので簡単とはいえ、かなりの数があるので3人がかりで10分くらいかかったり。小学校N年生とかの雑誌に付いてくる付録みたいだｗ

それにしても‥‥TROOPカードの絵柄が猫とか犬とかなんだけど。戦略カードもなんか違う‥‥。

------------

追記

光沢カードはシャッフルしづらい。パウチするか。

.. _`BattleLine`: http://d.hatena.ne.jp/keyword/%83o%83g%83%8B%83%89%83C%83%93
.. _`JP-MCMARUGK`: http://www.sanwa.co.jp/product/syohin.asp?code=JP-MCMARUGK&cate=5


:extend type: text/html
:extend:


:comments:
:comment id: 2007-02-05.8144677226
:title: Re:BattleLineのカード自作(byとみた)
:author: masaru
:date: 2007-02-05 23:46:55
:email: 
:url: 
:body:
それってなんてカードチャプター？

:comments:
:comment id: 2007-02-06.5123083846
:title: Re:BattleLineのカード自作(byとみた)
:author: taka
:date: 2007-02-06 01:38:32
:email: 
:url: 
:body:
カードチャプター違う

%%%%%%%%%

:id: 397
:date: 2007-02-06 01:37:01
:title: 米Amazonから本を輸入
:categories: ['misc']
:body type: text/x-rst
:body:
先日、はてしない物語の英語版を読みたくなって日本Amazonで注文したけれど、注文から2週間後くらいに「なかなか在庫が見つかりません、まだ探しますか？」というメールが来たので「はい」と返しておいた。その後1ヶ月後くらいに「やっぱりみつかりませんでした。注文はキャンセル扱いになります」などというメールが来てキャンセルされてしまった。

そこで、物は試しと米Amazonサイトで注文したところ翌日には発送され、今日本に向かって船の上を旅しているらしい。なんだ最初から米Amazonで買えば良かったんじゃないか。

本$15, 送料$12なので倍くらいしてますが。それでも日本Amazonの5000円～8000円に比べればかなり安いですな。なんだ最初から米Amazonで以下略

:extend type: text/html
:extend:
%%%%%%%%%

:id: 398
:date: 2007-02-06 02:18:26
:title: portupgradeが動作しなくなってた
:categories: ['Unix']
:body type: text/x-rst
:body:
FreeBSDのパッケージ管理はportupgradeで行っていて、毎日 portversion -vL= の結果がメールで送信される仕組みで運用している。で、いくつかのパッケージ更新があったようなのでportupgradeで更新しようとしたら::

  missing key: categories: Cannot read the portsdb!

なんてエラーが出て止まってしまった。あぁ、先週くらいにMLで出てたなあ、とメールを探したら発見。 `90342`_ からのスレッドで回避策が提示されていた。結局、/usr/ports/Makefileの ``.if ${OSVERSION} >= 601101`` あたりをコメントアウトした状態でportupgrade自身をアップデートしてからMakefileのコメントアウトを解除して残りのパッケージも更新した。というか今更新してる最中。ねむ。

.. _`90342`: http://home.jp.freebsd.org/cgi-bin/showmail/FreeBSD-users-jp/90342


:extend type: text/html
:extend:


:comments:
:comment id: 2007-02-06.8674717075
:title: Re:portupgradeが動作しなくなってた
:author: setomits
:date: 2007-02-06 03:07:48
:email: 
:url: 
:body:
僕は FreeBSD は使わないのでまるでわかっていないのですが、
FreeBSDユーザは要注意!「ports-mgmt」設置、portupgradeはカテゴリ移動へ (MYCOMジャーナル)
http://journal.mycom.co.jp/news/2007/02/05/360.html
というあたりが関係あるのでしょうか。

:comments:
:comment id: 2007-02-09.4022325718
:title: Re:portupgradeが動作しなくなってた
:author: Anonymous User
:date: 2007-02-09 23:13:22
:email: 
:url: http://echo.dip.jp/20070205.html
:body:
手順としてはここが一番簡潔でした。

:comments:
:comment id: 2007-02-18.2473161902
:title: Re:portupgradeが動作しなくなってた
:author: しみずかわ
:date: 2007-02-18 18:17:27
:email: 
:url: 
:body:
情報ありがとうございます。
ports-mgmtに移動する前に数日間実行できない状態になってしまっていたようです。

その後、portversion -vL= とかでバージョン一覧を表示すると
portupgrade-2.2.2_3,2 (=> 'ports-mgmt/portupgrade')
と表示されるようになりました。
%%%%%%%%%

:id: 399
:date: 2007-02-06 22:11:14
:title: もうやんカレー
:categories: ['food']
:body type: text/html
:body:
<p>昨日、西新宿の<a href="http://home.att.ne.jp/sea/moyancurry/">もうやんカレー大忍具</a>に行ってきました。動画は「半もうやんスペシャル」。ビーフ・ポーク・チキン・エビ・チーズが目の前で焼かれます。うまいうまい。ビールによく合う。</p>

<object width="425" height="350"><param name="movie" value="http://www.youtube.com/v/fYN2OqsiwT4"></param><param name="wmode" value="transparent"></param><embed src="http://www.youtube.com/v/fYN2OqsiwT4" type="application/x-shockwave-flash" wmode="transparent" width="425" height="350"></embed></object>

<p>ところで初めてYouTube使ってみたけど、objectタグをCOREBlog2に入れるのはめんどくさい。。。今はとりあえずHTML編集モードでHTML書いて入れればいいとして、なんとかならんかな。<a href="https://svn.plone.org/svn/collective/ATFlashMovie/">ATFlashMovie</a>プロダクトだとFlashファイルをZopeに保存するタイプなので、YouTubeには向かない。外部URLを参照するATExtFlashプロダクトでも作るか。</p>


:extend type: text/html
:extend:
%%%%%%%%%

:id: 400
:date: 2007-02-07 01:24:42
:title: ATExtFlash
:categories: ['Programming', 'Plone']
:body type: text/x-rst
:body:
COREBlog2に外部サイトのFlashを貼り付けるための‥‥ぶっちゃけた話、YouTube動画を貼り付けるためのプロダクト ``ATExtFlash`` を作ってみました。 `ATCTSmallSample`_ をちょろっと書き換えて作ったので動くまで大体20分くらい。まあIInlineObject実装してSchema定義するだけなんで、たいしたコードではないんですが。もしかしたらアイコン作成の方が手間取ってるかもしれない。

ということで早速実験。COREBlog2のメディアサイズ指定でサイズが変わります。

ダウンロード等はsvnからどうぞ。 http://svn.freia.jp/open/ATExtFlash/

.. _`ATCTSmallSample`: http://plone.org/products/atctsmallsample


:extend type: text/html
:extend:
%%%%%%%%%

:id: 401
:date: 2007-02-18 18:00:20
:title: 不二家がイタリアントマトになっていた
:categories: ['food']
:body type: text/x-rst
:body:
調布駅南口の東急ストア前にあった某不二家がイタリアントマトになっていたので、さっそくシブーストを購入。んー、高い分だけ大きいけど、ちょっと飽きるかも。。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-02-18.9652304850
:title: Re:不二家がイタリアントマトになっていた
:author: masaru
:date: 2007-02-18 21:16:06
:email: 
:url: 
:body:
某不二家って・・・

%%%%%%%%%

:id: 402
:date: 2007-02-18 18:09:43
:title: モスのデミカツとチーフォン
:categories: ['food']
:body type: text/x-rst
:body:
昼ごはんにモスで `デミカツドックとチーフォンドック`_ を食べる。どうせなので二つとも食べてみた。デミカツドックは揚げた手アツアツ。あふれんばかりのデミグラスソースがたまりません。ただしカツはメンチカツっぽい。チーフォンドックはバジルポテトソース(?)が微妙にミスマッチ。後に食べたからポテトのボリューム感が余計だったのかも・・・。


感想：１つで十分だった

.. _`デミカツドックとチーフォンドック`: http://www.mos.co.jp/cp/hotdog/070216/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 403
:date: 2007-02-25 11:10:00
:title: PloneのSMTP設定にGMailを指定
:categories: ['Plone']
:body type: text/x-rst
:body:
最近、利用しているCATVインターネット接続でもOP25bが導入され、自宅サーバーのSMTPから自宅外へメール送信することが出来なくなってしまった。このサイトのPloneのSMTP設定もlocalhostを利用していたのだが、通知メールの受け取りを自宅外に設定できないのでは不便なので（というかGMailに転送したいので）、GMailのSMTPサーバーを指定してみた。

Plone サイト設定 -> メールの設定:

:SMTPサーバ: smtp.gmail.com
:SMTPポート: 587
:ESMTPユーザ名: xxxxxx@gmail.com
:ESMTPパスワード: xxxxxxxx

これであとはGMail側でPOPを利用する設定にしておけばメールが送信できる、はずだった。

実際に送ってみたところ、 ``メールを送ることができません: (8, 'EOF occurred in violation of protocol')``
というエラーが送信フォームに表示されてしまった。何だろう・・。
とりあえずこのエラーメッセージで検索してみると、PythonでProxy+SSL通信する例がたくさん見つかる。smtplib もキーワードに追加してみると、以下の内容が見つかった。

.. highlights::

  Most SSL servers and clients (primarily HTTP, but some SMTP as well) are
  broken in this regard: they do not properly negotiate TLS connection
  shutdown.  This causes one end or the other to notice an SSL protocol error.

  多くののSSLサーバーとクライアントの実装は仕様通りでなく、正しいTLS接続のシャットダウン処理が
  行われていない。この実装はSSLプロトコル上のエラーを引き起こす。

  -- `sslerror: (8, 'EOF occurred in violation of protocol') ???`__

.. __: http://mail.python.org/pipermail/python-list/2005-August/338280.html


他にこんな内容も見つかった。

.. highlights::

  As the error states, Google Domains closes the SSL SMTP connection 
  early, in violation of the TLS/SMTP protocol. Please contact Google to 
  fix their SMTP server.

  このエラーはGoogleがSSL SMTP接続を規定よりも早く閉じてしまっていて、これは
  TLS/SMTPプロトコルに反する。GoogleにSMTPサーバーを直すように言ってください。

  -- `[Zope] SecureMailHost Error`__

.. __: http://mail.zope.org/pipermail/zope/2007-February/170430.html


:extend type: text/x-rst
:extend:
そこで、smtp送信を行っているあたりのプログラム(SecureMailHost-1.0.4/mail.py[89-126])を抜粋してPythonの対話モードで試してみたところ、smtp接続を切る段階でたしかにエラーが発生してしまった。

.. code-block:: Python

  >>> smtpserver = smtplib.SMTP('smtp.gmail.com',587)
  >>> smtpserver.ehlo()
  (250, 'mx.google.com at your service, [61.24.99.179]\nSIZE 20971520\n8BITMIME\nSTARTTLS\nENHANCEDSTATUSCODES')
  >>> smtpserver.starttls()
  (220, '2.0.0 Ready to start TLS')
  >>> smtpserver.ehlo()
  (250, 'mx.google.com at your service, [61.24.99.179]\nSIZE 20971520\n8BITMIME\nAUTH LOGIN PLAIN\nENHANCEDSTATUSCODES')
  >>> smtpserver.login('xxxxxxxx@gmail.com','xxxxxx')
  (235, '2.7.0 Accepted')
  >>> smtpserver.quit()
  Traceback (most recent call last):
    File "<stdin>", line 1, in ?
    File "C:\develop\python24\lib\smtplib.py", line 712, in quit
      self.docmd("quit")
    File "C:\develop\python24\lib\smtplib.py", line 374, in docmd
      return self.getreply()
    File "C:\develop\python24\lib\smtplib.py", line 348, in getreply
      line = self.file.readline()
    File "C:\develop\python24\lib\smtplib.py", line 160, in readline
      chr = self.sslobj.read(1)
  socket.sslerror: (8, 'EOF occurred in violation of protocol')
  >>>

SecureMailHostで発生したこのExceptionはキャッチされていないため、エラーが画面に表示される。そこで、もうしょうがないので、smtpserver.quit()のあたりを以下のように書き換えて対処することにした。

.. code-block:: Python

  try:
      smtpserver.quit()
  except socket.sslerror,e:
      pass

エラーの種類見てないけど、quitの時のエラーだし、まあいいか。

%%%%%%%%%

:id: 30af30de309255b03075
:date: 2007-02-25 23:53:47
:title: クマを喰ふ
:categories: ['food']
:body type: text/x-rst
:body:
昨年末に北海道に行ってきたときのおみやげをいつものメンバー（とみた・GO）と食べた。丸3ヶ月も放置してたけど缶詰だから大丈夫（？）。

食べた感じは何というか‥‥ちょっと堅めの肉。まずくもなく、臭くもなく、、、肉。豚肉に比べると野性味がある気がするかもしれない。気のせいかもしれないけど。カレーもネットリ辛めな感じで、へたなレトルトよりはおいしかった。さすが北海道くまー。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-02-26.4942638345
:title: Re:クマー　ウマー
:author: masaru
:date: 2007-02-26 19:58:15
:email: 
:url: 
:body:
トドカレーは？

:comments:
:comment id: 2007-02-26.4608338746
:title: Re:クマを喰ふ
:author: しみずかわ
:date: 2007-02-26 23:34:21
:email: 
:url: 
:body:
トドは無かった。エゾシカはあった。

%%%%%%%%%

:id: 405
:date: 2007-02-26 23:33:26
:title: ダーツもらった
:categories: ['darts']
:body type: text/x-rst
:body:
会社の同僚な方からダーツもらいました。しかも2セットも。先日打合せ中にMSN Messengerのアイコンがダーツだったので話題にしたら、その人はものすごくうまくてびっくり！自分のカウントアップのハイスコアは500ちょうどなんだけど、彼のハイスコアは900台。自分の倍くらいあるし。すげー！大会で2位だったと聞いて、またまたすげー！うちの会社は自転車好きやらボドゲ好きやらダーツ好きやらで構成されてるということがよく分かりました。

ダーツ面白いよ、ダーツ。ダーツ初めてからオブライエンをかなり理解できた気がする。

だがしかし、もらったダーツの価値はよく分かってません。はい。精進します。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-02-27.8972096568
:title: Re:ダーツもらった
:author: masaru
:date: 2007-02-27 23:01:38
:email: 
:url: 
:body:
以前出向していた職場でダーツする人が多くて自分も安物だけどマイダーツ買いました
今の職場でもダーツを広めようと孤軍奮闘していますが・・・


:comments:
:comment id: 2007-02-28.0427304581
:title: Re:ダーツもらった
:author: しみずかわ
:date: 2007-02-28 10:27:24
:email: 
:url: 
:body:
まずは連れて行かなきゃ。

%%%%%%%%%

:id: 406
:date: 2007-03-04 19:02:01
:title: 動画配信奮闘記 in Python Developers Camp 2007 冬
:categories: ['Event', 'python', 'turbogears']
:body type: text/x-rst
:body:
結論から言うと、動画配信に素人が手を出してはいけない。とってもアブナイ。

ページ右にあるのが、今回自分がキャンプに参加してそれぞれなにに時間を割いたかまとめてみたグラフ。簡単にまとめると、

- 撮影関連	42%
- TGハック	28%

開発:撮影関連 = 2:3 ということで、開発よりも撮影の方が長い！なんだそりゃ！その分寝る時間を削ったりしたら1日4時間未満の睡眠時間になってしまった。いったいどこのですマーチですか、これは。

とりあえず帰ってきて片付けも済んだので、次ははまらないように問題点をメモしておこう。



:extend type: text/x-rst
:extend:
1日目
-------

今回事前に分かっていたネックはたくさんある。ほんとにたくさんある。

- 各担当者・機器が現地でやっとそろう

  - 配信担当者(自分)
  - カメラ(jun-g)
  - エンコードPC(kinoshita)
  - 配信サーバー(nakaj_)

- ネットワークは宿(`銀嶺`_)のものを借用

  - ルーターはいじれない
  - 現地に行くまで状況が分からない

- 動画配信経験者がいなかった
- IEEE1394搭載WindowsPCが動画中継にはつらいスペックだった


こんな状態なので、いろいろなトラブルがあるだろうなあと思って機器類をバッグに詰め込んだら大変なことに。バッグにスキー道具は一切入っていないのに **25kg** ぐらいあった。バカじゃないかと。雪山に何しに行くのかと。そして現地で配信のテストをしようとしたら案の定問題が。

- 配信に使おうと思っていた18080ポートが開いてない

最初の配信の30分前だったのでポート番号を変えて実験する余裕もなく、とりあえずPuTTYを入れてssh port forwardingで配信。この方法はCPU負荷と帯域負荷が少し高いのが欠点。あとkeep alive用に ``ping -i 10 localhost`` とかやってても時々sshが切れてしまったのであまりよい代替手段ではなかった。最初の配信ではもう一つ問題があって

- 320x240 15fps では処理が間に合わなかった(音飛びした)

これは使用した中継PCが `VAIO-U3`_ でCPUがTM5800 933MHzだったから。でもこれ以外用意できなかったんだからしょうがない。回線的には100kbps程度なので問題なし。しょうがないので、320x240 10fpsに設定を変えたところ、なんとか音声も音飛び無しでいけるようになった。

その後、発表形式の合間にデータを吸い出してGoogleVideoに上げる予定だったのだが、合間の時間にデータを取り出そうにも等速でしかとりだせない。そしてタイムスケジュール的に取り出してる余裕はほとんどなかった。

- データ吸い出し用デバイスはカメラ以外に用意する必要があった
- 吸い出し担当者と録画担当者は別々の方がよい
- 録画担当者は複数人でローテーションするべきだった

今回、全配信を一人で担当したので全発表型プログラムに拘束^H^H参加した。また、カメラの向きや拡大縮小などもやらないと320x240ではスクリーンの文字が見えないので中座や内職も出来ず。そして起きるトラブル。 **マジで大変** 。

あ、あとこんなことも。

- 撮影者(自分)がDVカメラ初めて操作した

そんなかんじで初日はまともな配信が出来てなかったと思う。とりあえずその日の内に対策できそうなport番号変更から着手。深夜1時頃に配信サーバー担当者(nakaj_)と連絡を取りつつ実施して分かったのは、

- `銀嶺`_ の無線APは外に出るほとんどのportが閉じている
- しょうがないのでwell known portを調べたら23番(telnet)が使えた(笑)

ということだった。そういえばGMailが使えないという声もあったな。とりあえず23番ポートを使えば何とかなるかということで、実験終了。結局1日目はTurboGears触ったのは行きの電車の中だけだった‥‥。


長くなったので、次回につづく。


.. _`銀嶺`: http://www.ginrei.co.jp/
.. _`VAIO-U3`: http://www.vaio.sony.co.jp/Products/PCG-U3/spec_master.html
.. _nakaj: http://nakaj.net/



:comments:
:comment id: 2007-03-04.7540597080
:title: Re:動画配信奮闘記 in Python Developers Camp 2007 冬
:author: Kinoshita
:date: 2007-03-04 21:35:54
:email: 
:url: 
:body:
こんなに大変だったとは！
おつかれさまでしたー。

続きを楽しみにしてます。

※スペック的には、
　ThinkPadS30でもあまり変わらなかったのでしょうかね？

:comments:
:comment id: 2007-03-05.1784097522
:title: Re:動画配信奮闘記 in Python Developers Camp 2007 冬
:author: nakaj
:date: 2007-03-05 11:19:39
:email: 
:url: http://nakaj.net/Nikki
:body:
ごめんなさい、ごめんなさい、ごめんなさい。。。

:comments:
:comment id: 2007-03-05.1815786523
:title: Re:動画配信奮闘記 in Python Developers Camp 2007 冬
:author: しみずかわ
:date: 2007-03-05 12:30:57
:email: 
:url: 
:body:
kinoshitaさん,nakajさん、そしてjun-gさんのおかげで、まがりなりにも動画配信することが出来たと思います。誰が欠けてもうまくいかなかったのではないかと。そして念のためお願いした三脚やカメラなどご協力いただいた皆さんもありがとうございました。

とはいえ次回はトラックナンバーをもうちょっと下げるよう計画したいですね。今回の経験をフィードバックしていきましょう！
（トラックナンバーとは...ググってくださいw）

:comments:
:comment id: 2007-03-05.1705371795
:title: Re:動画配信奮闘記 in Python Developers Camp 2007 冬
:author: kuma8
:date: 2007-03-05 21:36:11
:email: 
:url: 
:body:
あぁ、すんませんでした。
本当にいろいろありがとうございました。m(_ _)m


:comments:
:comment id: 2007-03-05.9810740868
:title: Re:動画配信奮闘記 in Python Developers Camp 2007 冬
:author: jun-g
:date: 2007-03-05 21:49:42
:email: 
:url: 
:body:
本当にお疲れ様でしたー！
っていうか撮影まかせっぱにしてすみませんでした…。

%%%%%%%%%

:id: 407
:date: 2007-03-05 12:28:24
:title: 13日間連続稼働ノートPC
:categories: ['IT-PC']
:body type: text/x-rst
:body:
Python合宿の帰りに、Windowsの動作がちょっととろいなー、と思ってsysteminfoを見てみたら13日連続稼働していた(笑)。 ノートPCを主に使うようになってから、「いつでもどこでもすぐにでも」使えるように、常時電源ONかSuspendでもちあるいているので、まあこんなものか。

13日も使っているとsvchostが100MBもメモリを使っている。起動直後は20MBだから5倍にもふくれあがってる...ってふくれすぎじゃね？


:extend type: text/html
:extend:


:comments:
:comment id: 2007-03-05.2598803043
:title: Re:13日間連続稼働ノートPC
:author: masaru
:date: 2007-03-05 23:51:01
:email: 
:url: 
:body:
何日も連続稼動している人を以前いた職場で見たことがあるけど少しは休める社会になってほしいと思う
＃デブキャンおつかれさまでしした

:comments:
:comment id: 2007-03-07.6791798882
:title: Re:13日間連続稼働ノートPC
:author: しみずかわ
:date: 2007-03-07 01:14:39
:email: 
:url: 
:body:
人間様は13日に一度働くくらいでいい。そんな社会になったら開発効率が上がったりして（笑

%%%%%%%%%

:id: 408
:date: 2007-03-06 23:58:00
:title: 梨ズーム - プレゼンテーションの友
:categories: ['Event', 'IT-PC']
:body type: text/x-rst
:body:
先日、金土日と志賀高原で行われた Python Developers Camp 2007 冬 に参加して、やっぱりみんなプレゼンうまいなー、と思った。話し方、ネタの仕込み、テンポ。そして `梨ズーム`_ 。梨ズーム+IBM X41 Tablet。コレ、最強。AppleのZoomに対抗して梨。Windowsで画面の拡大縮小をやってくれる。さっそくインストールして意味もなく拡大縮小。イイッ！

すばらしいプレゼンを見せてくれた `西尾さん`_ に感謝。

.. _`梨ズーム`: http://www.vector.co.jp/soft/winnt/util/se372416.html
.. _`西尾さん`: http://www.nishiohirokazu.org/blog/2007/03/python_developers_camp_1.html

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2007-03-08.2609428985
:title: Re:梨ズーム - プレゼンテーションの友
:author: Anonymous User
:date: 2007-03-08 14:21:03
:email: 
:url: 
:body:
梨ズーム、面白いですね。
ちなみに同じようなソフトで、ZoomItというのもあります。
http://fw.moongift.jp/intro/i-3400.html
梨ズームと違って拡大時に通常操作はできませんが、代わりにマウスで赤線を引く事ができます。

%%%%%%%%%

:id: 409
:date: 2007-03-07 23:59:20
:title: 動画配信奮闘記2 in Python Developers Camp 2007 冬
:categories: ['Event', 'python', 'turbogears']
:body type: text/x-rst
:body:
ちょっと間が開いてしまったが、 `動画配信奮闘記1`_ の続き。

.. _`動画配信奮闘記1`: http://www.freia.jp/taka/blog/406


2日目 昼
-----------

2日目は朝10時から森さんの ``クラスの初歩`` から始まって `西尾`_ さんの ``クラスなんていらないよ`` 、昼休みを挟んで午後は jbking_ さんの ``Amazon APIを操る`` 森さんの ``setsモジュールのソースコードを読む`` と発表型プログラムが続く。写真はjbkingさんの発表のあたりのやつ。

このあたりでカメラマンがやっとカメラの操作に慣れてきたが、実はカメラの操作どころではなかったりする。



.. _`西尾`: http://www.nishiohirokazu.org/blog/2007/03/python_developers_camp_1.html

.. _jbking: http://d.hatena.ne.jp/jbking/20070303




:extend type: text/x-rst
:extend:
1日目深夜に苦労してport番号を23番に変更したというのに、配信中継PCがIPアドレスを取得できない。中継PCの無線LANの設定では、会場(食堂)から見えるAPはGINREI4のみ。無線の接続自体は問題ないようだけど、IPは取得できない。どうやら恐れていたIP枯渇問題が発生してしまったようだ‥‥。

宿の構造的に、食堂からは最も近いアクセスポイントはGINREI4。実際にはGINREI3やFREESPOTなども見えるはずだが、無線クライアントのスペックや設定によってはGINREI4しか見えない。そしてGINREI4は合宿部隊が占拠しているエリアからも見える。ここで、 **食堂に行くとGINREI4に接続し、以後宿内の行動範囲ではGINREI4を補足し続ける** クライアントが多数発生する。またDHCPのIPリリース時間の問題も合わさって、配信できるIPの上限に達してしまう。‥‥のではないかと勝手に想像。

port問題が解決したら次はIP取得問題ですか、ってことで自宅から持って行ったメディアコンバーターをTurboGears部屋に取りに走り、配信PCに接続。メディアコンバーターの設定はGINREI3にしてあったのでなんとかIPを取得できた。でも発表の頭の方は配信できなかった。ごめんなさい。

とりあえず新たな問題をメモ。

- GINREI4はIPアドレスが枯渇しやすい
- GINREI4はGMailにつながらない


2日目 夜
-----------
夕食後、20:00からのライトニングトークスまでの1時間で、テープに録画しておいた分を大きいサイズ(640x480)で取り出して、GoogleVideoに上げる用意をしていて残念なことが判明した。 `VAIO-U3`_ のHDD容量にはrawデータの取り込みができないので、最低限の圧縮をかけつつ取り出そうとしたけど、残念ながら音飛びが発生してしまった。そこでjun-gさんに取り出しを委託。OSがFreeBSDなので配信は出来ないけどrawデータの取り出しは問題なくできる、ってことで順次取り出してもらうことにした。この時点で、合宿中にGoogleVideoに上げる計画は断念。やはり動画配信には高スペックな機材がたくさん必要ですよ、と。

- 動画配信用に高スペックな機材を調達する方法は？(課題)


そして20:00からライトニングトークスの発表を配信。ここで配信中にまた新たな問題がやってきた。もう来なくて良いのに‥‥。

- GINREI4が熱暴走でリブート?

配信が突然止まったかと思ったら、メディアコンバーターの無線のLEDが消えていた。最初はメディアコンバーターの故障を疑ったんだけど、数分後に復帰。そして切断。そして復帰‥‥。あとで聞いたところによると、このあたりのタイミングで通信が出来なくなった人が何人かいたようなので、おそらく宿のAPが連続通信に耐えきれずにリブートしたんじゃないかと、これまた勝手に推測。
熱が原因ならちょっと間を挟めばまたいけるかな～、と5分くらい放置してから配信を再開したところ、なんとかLTが終わるまでは持ってくれた。今日の配信はこれで終了。



2日目 深夜
-----------
深夜2:30。盛り上がるTurboGears部屋。というか自分はToDoツール作成の遅れを取り戻すべくガシガシ実装中。あとすこし、あとすこし、とやってるうちに気づいたらこんな時間になっていた‥‥。お隣のPlone開発部屋はとっくに就寝してました。

その後、3:30頃に力尽き、3日目に続く。。。


.. _`VAIO-U3`: http://www.vaio.sony.co.jp/Products/PCG-U3/spec_master.html
%%%%%%%%%

:id: 410
:date: 2007-03-08 01:49:34
:title: COREBlog2の各エントリのTrackback設定を一括変更する
:categories: ['Plone']
:body type: text/x-rst
:body:
COREBlog2_ はトラックバックの受付と表示について、各エントリ毎に

- 追加不可/非表示 
- 追加可能/表示 
- 追加不可/表示

を選択できる。これは各エントリに保存されるので、後からUIで変更しようと思うと全部のエントリを一つ一つ変更していく事になってしまう。これではひたすら面倒なのでScript(Python)を書いて一括変更してしまえ、と。

.. _COREBlog2: http://coreblog.org/


:extend type: text/x-rst
:extend:
.. code-block:: Python

    cb = context.blog
    entries = cb.objectValues(['COREBlogEntry'])
    print len(entries), 'entries'
    
    for ent in entries:
        ent.setReceive_trackback(3)
    
    return printed

でけた。

coreblogentry.pyのスキーマ定義を見るとentry_trackbacksというフィールドがある。

.. code-block:: Python

    IntegerField('receive_trackback',
        searchable=0,
        default = 2,
        widget=SelectionWidget(label='Trackback status',
            label_msgid='label_receive_trackback',
            description_msgid='help_receive_trackback',
            i18n_domain='plone',),
        vocabulary=DisplayList(trackback_status),
        schemata='cbentry_extented_fields',
        ),

このフィールドが取り得る値はtrackback_statusで定義されていて、今回はTB禁止にしたいので3を設定すればよい、と。Archetypesではフィールドのsetter,getterメソッドは自動的に生成される。名前の生成規則は基本的に'get'+capitalize(フィールド名)とか'set'+capitalize(フィールド名)で作られるので、今回はsetReceive_trackbackがsetterメソッドになる。

ところで、この方法でいじくったせいかわからないけど、TB禁止なエントリにTBを受けるとメールによる通知だけ届く現象に遭遇中。実際にTBは保存されていないので実害はないけれど、ちょっと気になる。明日調べてみよう。あと、Blogの設定でデフォルトTBステータスを設定しても反映されないような。まとめて明日チェック。
%%%%%%%%%

:id: 411
:date: 2007-03-08 23:58:23
:title: Trackback禁止エントリでTrackback通知メールを送信しない
:categories: ['Plone']
:body type: text/x-rst
:body:
`COREBlog2の各エントリのTrackback設定を一括変更する`__ で遭遇した問題についてコードを確認してみた。

.. __: http://www.freia.jp/taka/blog/410

.. epigraph::

  ところで、この方法でいじくったせいかわからないけど、TB禁止なエントリにTBを受けるとメールによる通知だけ届く現象に遭遇中。実際にTBは保存されていないので実害はないけれど、ちょっと気になる。明日調べてみよう。あと、Blogの設定でデフォルトTBステータスを設定しても反映されないような。まとめて明日チェック。

まず、TB禁止エントリへのTBでメールが通知されるのは ``COREBlog2\skins\COREBlog2\tbping.py`` でメールの送信を行ってからTBをエントリに追加する ``addTrackback2Entry`` を呼んでいて、ここでTB追加禁止がチェックされているからだった。つまりメールの送信をこの関数内で行うようにするか、関数の返値を見てメール送信するかどうかを判断すればよい。

次にBlogのデフォルトTBステータスが新規作成したエントリに反映されていない現象については、反映するように実装されてないからだった。そして `COREBlog2のTrac`_ を見てみたら報告があがっていた。未実装なのかな？

.. _`COREBlog2のTrac`: http://coreblog.org/trac/coreblog2/ticket/50


:extend type: text/x-rst
:extend:
とりあえず自分で使うのに不便なので実装してデフォルト値対応してみた。

.. code-block:: Python

    --- COREBlog2/content/coreblogentry.py.orig	Sun Feb 25 03:02:45 2007
    +++ COREBlog2/content/coreblogentry.py	Fri Mar 09 00:12:52 2007
    @@ -197,6 +197,7 @@
         IntegerField('allow_comment',
             searchable=0,
    -        default = 2,
    +        default_method='getDefaultCommentStatus',
             widget=SelectionWidget(label='Comment status',
                 label_msgid='label_allow_comment',
                 description_msgid='help_allow_comment',
    @@ -207,7 +208,7 @@
     
         IntegerField('receive_trackback',
             searchable=0,
    -        default = 2,
    +        default_method='getDefaultTrackbackStatus',
             widget=SelectionWidget(label='Trackback status',
                 label_msgid='label_receive_trackback',
                 description_msgid='help_receive_trackback',
    @@ -324,6 +325,13 @@
         trackback_open = 2
         trackback_closed = 3
     
    +    def getDefaultTrackbackStatus(self):
    +        blog = self.blog_object()
    +        return blog.getReceive_trackback_default()
    +
    +    def getDefaultCommentStatus(self):
    +        blog = self.blog_object()
    +        return blog.getAllow_comment_default()
     
         def initializeArchetype(self, **kwargs):
             ATCTContent.initializeArchetype(self, **kwargs)

フィールドのdefault_method引数の使い方は `Archetypesマニュアル`_ に書いてあるけど、値にはstringを渡せと書いてあって、インスタンス作成後にcontextにbindして呼び出してくれる。あるいはcallableオブジェクトを設定してもちゃんと呼び出してくれる。

ところで、同じ物をCOREBlog2のTracにも貼っておこうと思ったのだけど、新しいチケットを発行できなかった。なんでだろう？MLの方で聞いてみよう。

.. _`Archetypesマニュアル`: http://plone.org/documentation/manual/archetypes-developer-manual/fields/fields-reference

%%%%%%%%%

:id: 412
:date: 2007-03-10 23:33:33
:title: COREBlog2のtracにpatchを書き込んでみる
:categories: ['misc']
:body type: text/x-rst
:body:
前回のエントリ `Trackback禁止エントリでTrackback通知メールを送信しない`_ で `COREBlog2のtrac`_ にパッチを報告できなかったと書いたけど、MLで質問を出したあとで改めてTopページを見直したら投稿方法がちゃんと書いてあった。どうやら脳みそが英語を超流し読みしてしまったらしい。うぅ・・失敗。

.. _`Trackback禁止エントリでTrackback通知メールを送信しない`: http://www.freia.jp/taka/blog/411#more
.. _`COREBlog2のtrac`: http://coreblog.org/trac/coreblog2/ticket/50


:extend type: text/html
:extend:
%%%%%%%%%

:id: 413
:date: 2007-03-11 01:11:17
:title: Google AnalyticsとAdWordsのリンクを解除
:categories: ['IT-PC']
:body type: text/x-rst
:body:
Google AnalyticsとAdWordsのリンクを解除することは現時点では出来ない。将来的には実装するつもりらしいという2006年2月のML投稿は見たけど、今はまだない。

そもそもなぜ解除したいかというと、

1. AnalyticsとAdWordsがリンクしているとタイムゾーンはAdWords側が使用される
2. AdWordsのタイムゾーンをGMT-8にしてしまっていた(設定した覚えはない)
3. `AdWordsのタイムゾーン設定は1度しか変更できない (ヘルプより)`_
4. だからAnalyticsのタイムゾーンを変えられない

ということで、 `AnalyticsとAdWordsのリンク解除はフォームから依頼せよ (ヘルプより)`_ に従ってGoogle様にAnalyticsとAdWordsのリンク解除依頼を出してみた。

.. Epigraph::

  AdWordsとAnalyticsのリンク解除をお願いいたします。
  
  Google Analytics アカウントの ID
    UA-xxxxxxx
  
  AdWords のお客様 ID (AdWords アカウントのページ上部に表示
    xxx-xxx-xxxx
  
  以上、よろしくお願いします。


これで解除されれば、タイムゾーンの問題も解決される‥‥はず（自信なし）。


.. _`AdWordsのタイムゾーン設定は1度しか変更できない (ヘルプより)`: https://adwords.google.com/support/bin/answer.py?answer=32346&query=time+zone&topic=&type=f
.. _`AnalyticsとAdWordsのリンク解除はフォームから依頼せよ (ヘルプより)`: http://www.google.co.jp/support/analytics/bin/answer.py?answer=30322&ctx=sibling



:extend type: text/html
:extend:
%%%%%%%%%

:id: 414
:date: 2007-03-12 23:59:31
:title: 動画配信奮闘記3 in Python Developers Camp 2007 冬
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
かなり間が開いてしまったけど、 `動画配信奮闘記1`_ , `動画配信奮闘記2`_ の続き。

.. _`動画配信奮闘記1`: http://www.freia.jp/taka/blog/406
.. _`動画配信奮闘記2`: http://www.freia.jp/taka/blog/409

3日目
------

2日目は深夜3:30まで頑張り、それでも3日目は7:30起き。連日4時間しか寝てないと言うべきか、4時間も眠れていると言うべきか。

3日目は朝10時から成果発表が行われた。この成果発表も動画配信したわけだけど、この頃には配信そのものよりも **ちゃんと録画して後で見れるようにしおく** ことの方が大事になっていたり。配信のための環境が完璧にはほど遠いので、今回は仕方ない、というところかな。

で、成果発表の動画配信中にもやっぱり配信が途切れてしまった。原因は昨夜と同じ熱暴走？
熱暴走だとしたらそれはそれで大量の負荷をかけてるストリーミング配信が宿に迷惑をかけていることになる。来年は通信経路の確保を考えなければいけないとおもう。あと成果発表の終盤で1時間20分の録画テープが終了してしまった。3本くらい吸い出しもして使い回していたけど間に合わず、代わりのテープも底をついてしまっていた。

- GINREI4が熱暴走?
- 来年は有線で動画配信しよう
- 録画テープは多めにもっていこう

そんな感じで3日間の合宿は終了した。動画配信については反省点ばっかりや。。。


:extend type: text/x-rst
:extend:
まとめて反省
------------

人員
~~~~~~

- 動画配信経験者がいなかった
- 吸い出し担当者と録画担当者は別々の方がよい
- 録画担当者は複数人でローテーションするべきだった
- 撮影者(自分)がDVカメラ初めて操作した


機材
~~~~~~

- IEEE1394搭載WindowsPCが動画中継にはつらいスペックだった
- 320x240 15fps では処理が間に合わなかった(音飛びした)
- データ吸い出し用デバイスはカメラ以外に用意する必要があった
- 動画配信用に高スペックな機材を調達する方法は？(課題)
- 録画テープは多めにもっていこう


環境
~~~~~

- 配信に使おうと思っていた18080ポートが開いてない
- 銀嶺の無線APは外に出るほとんどのportが閉じている
- しょうがないのでwell known portを調べたら23番(telnet)が使えた(笑)
- GINREI4はIPアドレスが枯渇しやすい
- GINREI4はGMailにつながらない
- GINREI4が熱暴走でリブート?
- 来年は有線で動画配信しよう

やっておいて良かった事
~~~~~~~~~~~~~~~~~~~~~

- Lingrは合宿前から良い感じだった
- 動画配信のためのサーバー・クライアント接続実験


今回は不要だった事
~~~~~~~~~~~~~~~~~

- Skype


来年は動画配信担当者もスキーや開発をもっと楽しめるように負荷分散しよう！
%%%%%%%%%

:id: 415
:date: 2007-03-13 12:44:08
:title: SilverCity-0.9.7
:categories: ['python']
:body type: text/x-rst
:body:
以前、 `SilverCity-0.9.6がうまく動かない`_ というエントリを書いたが、 `0.9.7`_ で修正されたようだ。去年の11月に `バグレポ`_ に対して「直したよ」という返答があったのだが、届いたメールが自宅メールサーバーに埋もれてしまっていた。

それはさておき、さっそく0.9.7を取得して以前と同じテストコードで動作確認してみる。

.. code-block:: Python

    >>> from StringIO import StringIO
    >>> out = StringIO()
    >>> from SilverCity import LanguageInfo
    >>> pgen = LanguageInfo.find_generator_by_name('python')()
    >>> pgen.generate_html(out,'import test')
    >>> out.getvalue()
    '<span class="p_word">import</span><span class="p_default">&nbsp;</span><span class="p_identifier">test</span>'

うまくいった。

.. _`SilverCity-0.9.6がうまく動かない`: http://www.freia.jp/taka/blog/310
.. _`0.9.7`: http://sourceforge.net/project/showfiles.php?group_id=45693
.. _`バグレポ`: http://sourceforge.net/tracker/index.php?func=detail&aid=1424436&group_id=45693&atid=443739


:extend type: text/html
:extend:
%%%%%%%%%

:id: 416
:date: 2007-03-14 23:54:42
:title: Google Analyticsのタイムゾーンを日本に
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`Google AnalyticsとAdWordsのリンクを解除`_ でGoogle様に申請したリンク解除が昨日受理された。対応まで中１日。届いた返信メールの内容は以下の通り。

.. epigraph::

  担当者 様

  平素より Google Analytics をご利用いただき、誠にありがとうございます。

  お客様のご要望にしたがい既存リンクを解除させていただきました。お手数をお掛けしますがご確認宜しくお願いいたします。

  Google Analytics サポート

さっそくタイムゾーン設定画面を見たところ、ちゃんと変更できるようになっており、無事タイムゾーンを日本に変更することが出来た。しかしGoogleAnalyticsはアクセス記録をローカルタイムで保存しているので、タイムゾーン設定の変更前と変更後とで記録される時刻が重複したり間が開いたりしてしまう。今回大西洋時間(GMT-8)から日本時間(GMT+9)に変更したので15時間の空白時間が出来てしまった。んー・・まあ無料のサービスだし、しょうがないね。

# ん？15時間？

.. _`Google AnalyticsとAdWordsのリンクを解除`: http://www.freia.jp/taka/blog/413

:extend type: text/html
:extend:
%%%%%%%%%

:id: 417
:date: 2007-03-15 01:32:58
:title: 過去6週間のアクセス平均ランキング
:categories: ['misc']
:body type: text/x-rst
:body:
Google Analytics関連でBlogを書いた流れで、自分のサイトの記事別訪問者数ランキングを集計してみました。集計期間は2007/2/11～3/10の28日間です。

.. csv-table::
  :header: "順位", "タイトル", "訪問者数", "1日平均"
  :widths: 2, 20, 3, 3

  1, `日本語キーボードから英語キーボードへ`_, 682, 24.4
  2, `WindowsからのVPN接続認証をLDAPで管理する on FreeBSD5.2.1`_, 314, 11.2
  3, `Apacheの認証をLDAPでActiveDirectoryに問い合わせ`_, 299, 10.7
  4, `pythonでHTML解析`_, 169, 6.0
  5, `動画配信奮闘記 in Python Developers Camp 2007 冬`_, 156, 5.6
  6, `WindowsでFreeなCモジュールビルド環境`_, 118, 4.2
  7, `ドキュメント自動生成計画`_, 117, 4.2
  8, `NetDriveというWebDAVをDrive名にマウントするツール`_, 109, 3.9
  9, `CSSのoverflowプロパティー`_, 100, 3.6
  10,`mod_proxyはいずこ？`_, 96, 3.4


結果、英語キーボードのネタがダントツ1位でした。2位のダブルスコアで圧勝です。アクセス元は90%が検索エンジンで、最も多かった検索キーワードは ``英語キーボード`` でした。 `英語キーボードでGoogle検索`_ すると、9位に `スタパトロニクスMobile`_, 10位にうちのサイトがランクインしています。なんかすごいな...。

.. _`日本語キーボードから英語キーボードへ`: http://www.freia.jp/taka/blog/252
.. _`Apacheの認証をLDAPでActiveDirectoryに問い合わせ`: http://www.freia.jp/taka/blog/226
.. _`WindowsからのVPN接続認証をLDAPで管理する on FreeBSD5.2.1`: http://www.freia.jp/taka/blog/83
.. _`pythonでHTML解析`: http://www.freia.jp/taka/blog/169
.. _`NetDriveというWebDAVをDrive名にマウントするツール`: http://www.freia.jp/taka/blog/232
.. _`ドキュメント自動生成計画`: http://www.freia.jp/taka/blog/67
.. _`mod_proxyはいずこ？`: http://www.freia.jp/taka/blog/55
.. _`動画配信奮闘記 in Python Developers Camp 2007 冬`: http://www.freia.jp/taka/blog/406
.. _`CSSのoverflowプロパティー`: http://www.freia.jp/taka/blog/117
.. _`WindowsでFreeなCモジュールビルド環境`: http://www.freia.jp/taka/memo/freevcbuild

.. _`スタパトロニクスMobile`: http://www.watch.impress.co.jp/mobile/column/stapa/2000/03/21/

.. _`英語キーボードでGoogle検索`: http://www.google.com/search?rls=ja&q=%E8%8B%B1%E8%AA%9E%E3%82%AD%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89&ie=utf-8&oe=utf-8

:extend type: text/html
:extend:
%%%%%%%%%

:id: 418
:date: 2007-03-16 21:17:57
:title: PythonでHTML解析 with BeautifulSoup
:categories: ['python', 'Programming']
:body type: text/x-rst
:body:
アクセス解析してみたところ、以前書いた `pythonでHTML解析`_ のアクセス頻度がかなり高いことが分かったので、先日の `Python Workshop 04`_ やPython合宿で紹介されていた BeautifulSoup_ でHTML解析するエントリを書いてみようかと思う。というかアクセス解析した時に大量のURLから各ページのタイトルを抜き出したくなって、試しに使ってみた。

.. code-block:: Python

  >>> urls = [
  ... "/taka/blog/109",
  ... "/taka/blog/117",
  ... "/taka/blog/135",
  ... "/taka/blog/159",
  ... "/taka/blog/169",
  ... "/taka/blog/171",
  ... "/taka/blog/176",
  ... "/taka/blog/209",
  ... "/taka/blog/223",
  ... "/taka/blog/226",
  ... ]
  >>> import urllib
  >>> base = 'http://www.freia.jp'
  >>> datas = [urllib.urlopen(base+x) for  x in urls]
  >>> datas = [x.read() for x in datas]
  >>> from BeautifulSoup import BeautifulSoup
  >>> BS = BeautifulSoup
  >>> datas2 = [BS(x).title.string.split()[0] for x in datas]
  >>> for id,title in zip(urls,datas2):
  ...   print id,',',title
  ...
  /taka/blog/109 , PloneのユーザーとグループをLDAPで管理する
  /taka/blog/117 , CSSのoverflowプロパティー
  /taka/blog/135 , PSX(DESR-7500)のバグ、D端子ケーブルが届いた
  /taka/blog/159 , FreeBSDのバックアップ
  /taka/blog/169 , pythonでHTML解析
  /taka/blog/171 , vpopmail
  /taka/blog/176 , YetiSportsおもしろすぎ
  /taka/blog/209 , Drag
  /taka/blog/223 , 新大久保の餃子「味むら」
  /taka/blog/226 , Apacheの認証をLDAPでActiveDirectoryに問い合わせ

**と　っ　て　も　ら　く　ち　ん　だ！**

なんと言っても、 BeautifulSoup.py 1ファイルで済むのが手軽で良いね。site-packagesに置いとこ。

.. _`pythonでHTML解析`: http://www.freia.jp/taka/blog/169
.. _`Python Workshop 04`: http://www.python.jp/Zope/workshop/200612
.. _BeautifulSoup: http://www.crummy.com/software/BeautifulSoup/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 419
:date: 2007-03-17 18:25:55
:title: Zope2の対話コンソール
:categories: ['Zope']
:body type: text/x-rst
:body:
今日は OSC2007_ だった。Zopeブースに常駐する予定だったんだけど、体調が思わしくなかったため欠席してしまった。。無念。

代わりにZope2の対話コンソールの使い方について、 `pdb埋め込みの方法`_ と `zopectrl debugを使う方法`_ について、zope.jpにドキュメントを書いた。話の流れ的に、次に書くべきはZopeTestCaseの使い方かなあ。

ところで、zopectrl debugをwindows環境で使えないのはどうにかならないものか‥‥。Zope3だったらちゃんと使えるんだけどなあ。


.. _OSC2007: http://www.ospn.jp/osc2007-Spring/

.. _`pdb埋め込みの方法`: http://zope.jp/documents/how-to/pdb-debug
.. _`zopectrl debugを使う方法`: http://zope.jp/documents/how-to/zopectl-debug


:extend type: text/html
:extend:
%%%%%%%%%

:id: 420
:date: 2007-03-18 23:42:20
:title: 横濱カレーミュージアム今月末に閉館！
:categories: ['food']
:body type: text/x-rst
:body:
2007/3/31の閉館前にいっておこう、ということで、最初で最後の横濱カレーミュージアムに行ってきました。メンバーは、自分・とみた・GO・Ric・Yodoの5人。まあまあいつもの調布メンバー。

まず入り口のエレベーターに乗るまで5分、フードコートで空席待ちで15分待ちました。フードコートは複数の店舗のカレーを持ち寄って食べられるので、みんなで思い思いのカレーを持ち寄って交換しながら食べてみましたが、なんというかどの店もコストパフォーマンスが悪いです。自分が食べたKingデリーのカシミールカレーは1100円にしては量少なすぎ！しかも辛さの★Maxなのに、ほんのり辛い程度とはどういうことか！他のカレーも「まあおいしいかも」程度だったし。。つまり、ちょっと気に入った味があったら本店に行って食べないといけないということか。

帰りにお土産コーナーで、誕生日が近かったYodoにレトルトカレーを数個プレゼント。本日のミッション終了！

ところで今日は調布からインテグラで横浜まで向かったのですが、帰ってきたら結構ぐったりしました。久しぶりの車（しかも振動激しいし）に酔ったかも。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 421
:date: 2007-03-19 20:51:12
:title: はじめての鍼
:categories: ['misc']
:body type: text/x-rst
:body:
2月の中頃に腰の右後ろあたりの筋をのばしたような痛みがあって、でも体を動かさなければ痛くなかったのでそのうち治るかな～と病院に行かず様子を見ていたわけですが、最近5分くらい歩くと痛み出すようになってしまった＆痛い範囲が広がっている気がするので病院に行くことにした。

`mixiの調布コミュで過去ログ`_ を調べたら `鈴木整骨院`_ がよいらしいという書き込みがあったので行ってみた。その感想。

先生会話のテンポ早いよ、なんか助手の人に矯正しちゃおうとか言ってるけど患者には説明無しですか？え、ここに寝るの？もう矯正始まってる？鍼ですか？いややったことないです、ていうかもう刺してる？あ、もう終わりですか。おお、だいぶ痛くなくなりました。

そんな感じで診察と矯正が終わり、その後通電とマッサージ。低周波治療器みたいなのを10分くらいとマッサージが10分くらいで本日の診療は終了。結局何が原因で、とか、今後の生活で気をつけること、とかの説明は一切無し。でもこんなに簡単に治してもらえるならもっと早く行っておけばよかったな。

ところで、鍼はいつ刺して、いつ抜いたんだろう‥‥？

.. _`mixiの調布コミュで過去ログ`: http://mixi.jp/view_bbs.pl?id=7605833&comm_id=5898
.. _`鈴木整骨院`: http://maps.google.co.jp/maps?f=q&hl=ja&q=%E8%AA%BF%E5%B8%83+%E9%88%B4%E6%9C%A8%E6%95%B4%E9%AA%A8%E9%99%A2&layer=&ie=UTF8&z=16&ll=35.65571,139.543984&spn=0.008404,0.014398&om=1&iwloc=A


:extend type: text/html
:extend:


:comments:
:comment id: 2007-03-20.1897749500
:title: Re:はじめての鍼
:author: masaru
:date: 2007-03-20 21:19:51
:email: 
:url: 
:body:
清水記のトップページとひとつ前のエントリーが認証がかかって閲覧出来ませんよー
関係のない話題ですまぬ

:comments:
:comment id: 2007-03-20.1419544398
:title: Re:はじめての鍼
:author: しみずかわ
:date: 2007-03-20 22:25:42
:email: 
:url: 
:body:
おおう、情報サンクス。
ていうかIInlineObjectのちょっとした問題よね。。

%%%%%%%%%

:id: 422
:date: 2007-03-21 21:03:29
:title: ZopeのHotfix
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope2.8以降に脆弱性が発見され、Hotfixがリリースされました。
内容はGETメソッドで権限昇格できてしまう、というもので対策としてセキュリティー関連メソッドにはPOSTでのみアクセス出来るようにしたようです。

- http://zope.jp/download/ZopeHotfix/releases/Hotfix-20070320
- http://www.zope.org/Products/Zope/Hotfix-2007-03-20/announcement

HTTP GET での certain types of misuse なんだからそっちを修正するパッチかと思いきや、POSTでのみアクセスできるようにするという対策が施されたHotfixでした。GETの処理が影響を受けないように対策したのかな？


:extend type: text/html
:extend:
%%%%%%%%%

:id: 423
:date: 2007-03-22 20:20:38
:title: Plone研究会にPaul Everitt氏...仕事で行けず
:categories: ['work']
:body type: text/x-rst
:body:
Plone研究会にPaul Everitt氏が来るというので行ってみよう、、と思っていたが、結局仕事で行けなかった。仕事の内容は...待ち。納得いかねえ。

納得いかないので、ふと最近の仕事の傾向を振り返ってみると、立場上マネジメント業務がほとんどで、会社でプログラミングしてることは無かった。3月の割合を見てみると、

- プロジェクト管理: 50%
- ドキュメント書き: 20%
- 人員管理: 10%
- 営業SE: 10%
- 他: 10%

こんな感じだった。こんなんじゃ開発の腕が鈍る！ということで、明日夜から日曜にかけて有志のメンバーで伊豆に開発合宿に行くことにした。有志＆自費なので、仕事とは関係ない開発をしてもOK。目標を立てて、発表して、くらいはする予定。自分はPython合宿の続きでTurboGearsの俺フレームワーク作成を通して色々と学ぶ予定。Djangoのgeneric viewうらやましー！って感じで。



:extend type: text/html
:extend:


:comments:
:comment id: 2007-03-22.6772577297
:title: Re:Plone研究会にPaul Everitt氏...仕事で行けず
:author: masaru
:date: 2007-03-22 20:41:18
:email: 
:url: 
:body:
これは、おもしろい成分解析ですね。
合宿頑張ってください

%%%%%%%%%

:id: 424
:date: 2007-03-23 23:57:52
:title: 開発合宿初日
:categories: ['Event', 'Programming']
:body type: text/x-rst
:body:
開発関係のイベントや合宿に出ていると、仕事とは全く関係なく技術の話などを聞いたり話したりすることが多い。というかそれが主目的なのであたりまえなんだけど。ところが職場を見ると、仕事の現場で同僚とそういう話をすることが少ない気がする。もちろん仕事の上での技術的な話は四六時中しているわけだけど、仕事と関係ない範囲に話が広がることがあまりできない。せっかく身近に深い技術のネタを持っている人がいるのにこれはもったいない！

と、いうわけで。

今日から部署の有志で合宿に出発しました。仕事が終わってから伊豆まで移動して、土曜日はひたすらハックの予定。

18:10 出発
------------

新宿～宇佐美 は小田急線を使うと1400円くらい。湘南ライナーを使うと1800円くらい。新幹線は4000円くらいで高い。今日は晩飯喰ってる間に小田急線がNGになってしまったので、品川から湘南ライナーで行くことになった。湘南ライナーに乗るにはライナー券を買わなくてはいけないらしいので500円で購入。ライナー券って初めて買ったけど、座席指定のない指定席券みたいなものかな？

21:50 宇佐美駅
--------------
かなり遅い時間になってしまった。ケータイの路線案内は国府津で乗り換えろとか指示してくるし、国府津で乗り換えに失敗して今日中に着けないんじゃないかとかドキドキしたし。なんかEzの乗り換え案内は遠距離だとへんな結果を返してくる気がする。


22:30 ペンション SEE BEAR ANNEX 到着
------------------------------------
海熊。海の熊の別館。駅からミニストップを経由してペンションまで、一人で歩いてたらかなり心細い海沿いの街灯のない道を20分あるいて到着。さっそく部屋に入って電源タップやら無線LANメディアコンバータやらの電子機器を設置。それにしても良い感じの部屋ですよ。

24:00 バッテリーが！
--------------------
- ノートPCのバッテリーが切れた
- 電源アダプター忘れたorz
- Let's Note のアダプタ借りて充電して事なきを得た
- 危うく合宿出来なくなるところだった
- 爆発しないだろうな...

25:00 ゲシェンク
-----------------
ノートが使えないので他のみんなを巻き込んでゲシェンクというカードゲームで遊ぶ。ルールは簡単だけどなかなか奥が深いのでお酒を飲みながら3回遊ぶ。単純で奥が深いカードゲームは買いですよ。1500円。でも1回しか勝てなかったなあ。


ということで、明日はひたすらハックします。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-03-27.8991172150
:title: Re:開発合宿初日
:author: koma2
:date: 2007-03-27 00:11:40
:email: koma2@lovepeers.org
:url: http://bloghome.lovepeers.org/daymemo2/
:body:
> 開発関係のイベントや合宿に出ていると、仕事とは全く関係なく技術の話などを聞いたり話したりすることが多い。というかそれが主目的なのであたりまえなんだけど。ところが職場を見ると、仕事の現場で同僚とそういう話をすることが少ない気がする。

まぁ、しみたんのいるフロアは特にそうかもね。
私のいるところはもう少しマシではあるけど。

ホントはソファーの１つも置いてあって、
そこで休憩がてら、とりとめもなく技術の話をするなんてことが
あってもいいと思うんだよね。
そういうところから思わぬ何かが生まれてくることもあるわけで。

…とは言っても、あの会社の偉い人たちにそれを期待するのは間違いだけどね。
白い目で見られてオシマイですわ。〜(-.-)〜
＃ 今までそういう話はイヤというほど聞いているので。

%%%%%%%%%

:id: 425
:date: 2007-03-24 11:43:07
:title: kidのpy:extendsにはまる
:categories: ['turbogears']
:body type: text/x-rst
:body:
たとえば

.. code-block:: Python

   @expose(template="proj.templates.foo")
   def index(self):
       return dict(master="proj.templates.master")

などとしてmasterという変数にtemplateのパスを渡す。それをkidがわで

.. code-block:: XML

   <html xmlns="http://www.w3.org/1999/xhtml"
         xmlns:py="http://purl.org/kid/ns#"
         py:extends="master">

と書くと、masterというnameは定義されていない！と怒られる。でも

.. code-block:: XML

   <html xmlns="http://www.w3.org/1999/xhtml"
         xmlns:py="http://purl.org/kid/ns#"
         py:attrs="{'foo':master}">

これは期待通りに動作する。つまりextendsの評価がindex関数から渡された変数の展開よりも先ということだろう。
ということで、index関数からextendsするテンプレートを渡しても、単純にextendsすることは出来ないということか。

ちなみに<html>タグの前だと${master}もNameErrorになる。<html>タグの後だとエラーにならない。

この辺の理由はkidcでkidをコンパイルしてpyファイルを生成するとわかる。わかるけど、どうすれば上記のextendsをうまくできるようになるかはまだよく分からない。。。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 426
:date: 2007-03-24 12:03:32
:title: inspect.getmro
:categories: ['python']
:body type: text/x-rst
:body:
Pythonでクラスにクラス変数を定義する。そのクラスを継承してそこでクラス変数をoverrideする。

.. code-block:: Python

  # a.py
  class A(object):
      path = 'foo'

  # b.py
  class B(A)
      path = 'bar'

  # c.py
  class C(A)
      pass

  a = A()
  b = B()
  c = C()

このとき、b.pathはもちろん'bar'になるがpathが宣言されているクラス名も欲しくて'B.bar'みたいに文字列を作りたい。

.. code-block:: Python

  import inspect
  def makepath(o):
      objs = inspect.getmro(b.__class__)
      for x in objs:
        if 'path' in x.__dict__:
            return '.'.join(x.__name__, x.path)

  print makepath(a)
  print makepath(b)
  print makepath(c)

これで、 ``A.foo``, ``B.bar``, ``A.foo`` という文字列が取得できる。問題。c.path='moo'が設定された場合、 ``C.moo`` と出力するにはどうすればいいか。ヒント: c.__dict__


うーん、用途を書かないと意味不明だｗ


:extend type: text/html
:extend:
%%%%%%%%%

:id: 427
:date: 2007-03-24 23:58:31
:title: 開発合宿2日目
:categories: ['Event', 'Programming']
:body type: text/x-rst
:body:
合宿2日目。

午前
-----
- 8:00起床。
- ご飯食べて12:00までハック。

午後
-----
- 昼飯はテレビに出たらしい回転寿司屋へ。
- 宿のご主人に車で駅前まで送ってもらい、shibata君と合流。
- 宇佐美駅のsuicaは簡易なので超簡単に突破可能。というか駅員居ないし‥‥
- 帰りにスーパーで夜の酒を買う
- 帰り道で雨に降られコンビニの軒下で雨宿りしてたら、たまたま宿のご主人が車で通りかかり、宿まで便乗。
- 14:00～18:30までハック。
- 自分はTurboGearsの俺フレームワーク作成

  - Python合宿の続き
  - ajax.jsとMochikit.jsの連携でちょっととまどう
  - widgets.LinkRemoteFunction便利だ
  - RemoteFormのvalidationエラー処理を実装した！疲れた

夜
---
- 晩ご飯。豪華でうまい！
- 19:30～21:00までハック。
- 21:00から成果発表・紹介。
- 自分はTurboGearsの概要紹介と自分が作ってる途中のフレームワーク(?)の紹介。

  - プレゼン中にバグ。テスト重要。というかコードまとめ切れてない

- 田原さんはMozart/Ozの紹介。

  - 宣言型言語で並列処理が言語レベルで用意されている。
  - マルチパラダイム言語。10個くらいのパラダイムが入ってる
  - カッコイイ！

深夜
-----
- 岩風呂。
- 酒飲みながらゲシェンク。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 428
:date: 2007-03-25 16:43:55
:title: 開発合宿3日目
:categories: ['Event', 'Programming']
:body type: text/x-rst
:body:
深夜
-----
- 0:00 5人ゲシェンク

  - 5人でやると楽しい
  - 最低4人必要な気がする

- 3:30 就寝。

朝
---
- 8:10 起床。
- 疲れてるけど意外と眠くない
- 朝食後に残りの成果発表
- メモツール

  - shibata君の発表
  - kahua web 使用
  - 今使っているメモツール(kahua webで階層型Wiki)の限界
  - ロジック/HTML/CSS/Javascript全てを ``S式`` で記述

- python nose

  - Georgeの発表
  - discovery test framework
  - 発見型。命名規則でtest関数を見つけてくれる
  - 実現しようとしてることはpy.testと同じか?
  - pluggableに作られている
  - Zope3のDocTestが取り込まれている

- HTMLコンテンツDeploymentの検討

  - sydの発表
  - CMFDeployment

    - 設定が複雑
    - プログラムも複雑
    - CMFにべったり

  - フレームワークに依存しない仕組みが欲しい
  - 他のWebフレームワークでも使えるようにしたい
  - HTML出力、配信、などの機能を個別に扱えるようにしたい
  - 2007年4月頃にファーストリリースしたい

- py.py

  - taharaさんの発表
  - CPythno上で動作するPythonで書かれたPython処理系
  - PythonコードをC言語にトランスレートする機能

    - 関数オブジェクトを渡すだけ
    - フローチャートが表示される(PyGameが使われている)
    - C言語にトランスレートして実行できる
    - トランスレート後の関数は処理が爆速

- BeautifulSoup

  - 清水川の発表
  - 福寿丸で、伊勢海老丸ごと天丼膳を待ちながら
  - 使い方を簡単に説明

昼
---
- シーベアーANNEXから出発

  - 11:00チェックアウト後に1時間食堂を借りてだべり
  - 色々と無理を言ってすみませんでした
  - 料理はおいしく料金は安い
  - 無線LANは一番遠い部屋でギリギリだった
  - 車で駅近くまで送ってもらった

- 福寿丸@宇佐美 で昼食

  - 伊勢海老丸ごと天丼膳 3200円
  - 伊勢海老丸ごと天ぷら御膳 3200円

午後
-----
- 東京へ

  - 宇佐美から新宿まで、東海道線-小田急線で2時間38分/1420円

- お疲れ様でした


:extend type: text/html
:extend:
%%%%%%%%%

:id: 429
:date: 2007-03-27 23:55:00
:title: PloneでReferenceのW/F状態による色分け
:categories: ['Plone']
:body type: text/x-rst
:body:
自宅サーバーのPloneはデフォルトステータスを非公開にしているため、時々ステータスを公開に変更し忘れてしまうことがある。大抵は単に公開されないだけなので後で気がつけば問題ないが、COREBlog2の ``オブジェクトの関連づけ`` で関連づけられた先のオブジェクトが非公開状態の場合、BlogのエントリやBlogのTopページを表示しようとしたときに認証画面に遷移してしまう。

Blog記事を書いたときにどうして気づかないのか、というと、記事を書いてるときは認証済みの状態のため、非公開の関連づけオブジェクトがあっても問題なく表示できてしまう。ここで、表示できてしまっても気づけるようにするため、Plone本体と同じように、関連づけオブジェクトのタイトル文字列に、W/Fの状態による色分けを設定してみる。

COREBlog2/skins/COREBlog2/media_view.pt

.. code-block:: XML

    <!-- macro for Image -->
    <metal:commentform_macro define-macro="image"
     tal:define="scale python:test(mediasizestr != 'no_resize',mediasizestr,None);
                 getInfoFor python:wtool.getInfoFor;
                 item_wf_state obj/review_state|python:getInfoFor(obj, 'review_state', '');
                 item_wf_state_class python:'state-'+normalizeString(item_wf_state);
                 ">
    <div class="contentsHanderItem">
        <div class="contentsHanderImageWrapper">
            <a href="#"
               tal:attributes="href obj/absolute_url;
                               target string:_blank;
                               ">
                <div tal:replace="structure python:obj.tag(scale= scale,css_class='contentsHanderImage')" />
            </a>
        </div>
        <span class="contentsHanderImageCaption"
              tal:content="obj/pretty_title_or_id"
              tal:attributes="class string:$item_wf_state_class contentsHanderImageCaption;" />
    </div>
    </metal:commentform_macro>

ポイントは最初と最後。 item_wf_state_class にcss用のクラス名を生成・代入しておき、タイトル部分でtal:attributesを使ってclassを設定する。色はPloneのものを使用する。

とりあえずこれで見た目で気づくことが出来るようになる。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 430
:date: 2007-03-28 22:17:14
:title: 真光書店にPython本いっぱい
:categories: ['python']
:body type: text/x-rst
:body:
``IronPythonの世界`` を買ってきました。さっそく読みながら色々やろうと思って ``VisualStudio 2005 Express`` をインストールしたものの、Express版ではIronPythonをIDEで使えないらしい（FAQに書いてあった）。残念。

それにしてもPython本が平置きでこれだけの面積を占めるとは。む..あと3種類のPython本が棚にあるな...隣に並べるか...


:extend type: text/html
:extend:
%%%%%%%%%

:id: 431
:date: 2007-03-29 23:12:48
:title: COREBlog2のオブジェクトの関連づけと表示権限
:categories: ['Plone']
:body type: text/x-rst
:body:
`PloneでReferenceのW/F状態による色分け`_ の続き。色によるW/F状態の表示が出来るようになったので、次は ``非公開`` 状態のオブジェクトに関連づけされていても、(ログイン画面じゃなく)ページが正しく表示されるようにする。

関連づけの仕組みはCOREBlog2の実装ではなくPloneが標準で提供しているのだが（実際はArchetypes）、Ploneの ``関連するページ`` 表示では同じような問題はおきない。なぜか。まずはCOREBlog2のどこでUnauthorizedが発生するのかを調べるため、zope.confのVerboseSecurityを有効にして、ログイン画面が出る現象を再現させる。どうやらgetRefsByKind.pyで発生するようだ。

COREBlog2/skins/COREBlog2/getRefsByKind.py

.. code-block:: Python

    for obj in context.getRefs('relatesTo'):

ここのgetRefs呼び出しでアクセス権の問題が起きる。
getRefs は Archetypes/Referenceable.py に実装があって、これはカタログからリファレンスを取得する。
カタログからの取得ではアクセス権のチェック等はされないので、呼出元のScript(Python)に戻るときに権限チェックが行われ、権限チェック中にUnauthorizedがraiseする。

ここでPloneの実装に戻って CMFPlone/skins/plone_content/document_relateditems.pt を見ると、getRefsではなく ``computeRelatedItems`` で取得しているのがわかる。computeRelatedItems の実装は CMFPlone/skins/plone_scripts/computeRelatedItems.py にあって、カタログを使わずに直接Referencesフィールドを参照して権限チェックもやっている。

そこでCOREBlog2のgetRefsByKind.pyを以下のように修正してみた。

.. code-block:: Python

    #for obj in context.getRefs('relatesTo'):
    for obj in context.computeRelatedItems():

成功。

ToDo: 置き換えて機能的な変化が発生しないか？


.. _`PloneでReferenceのW/F状態による色分け`: http://www.freia.jp/taka/blog/429


:extend type: text/html
:extend:
%%%%%%%%%

:id: 432
:date: 2007-04-01 14:45:00
:title: あなたもMacをはじめよう！
:categories: ['misc']
:body type: text/x-rst
:body:
Appleが `Start Mac体験モニター`_ の募集を行っているようです。Windows利用者で、4ヶ月間のモニター期間中にBlogエントリに感想を10回以上書くことが条件のようです。モニター期間終了後は機材をもらえる、ということで早速応募してみました。

申し込みページにBlogのURLと月間アクセス数を入力する欄がありますが、選択肢が:

- 10,000以下
- 10,001 ～ 30,000
- 30,001 ～ 以下略

となっています。自分のBlogはギリギリ10,000台でした。これはちょっと、50名のモニターには選ばれない気がしてきました‥‥。

via `Start Mac体験モニターキャンペーン － takanory.net`_

.. _`Start Mac体験モニター`: http://www.apple.com/jp/articles/startmac_monitor_2/
.. _`Start Mac体験モニターキャンペーン － takanory.net`: http://takanory.net/takalog/691


:extend type: text/html
:extend:
%%%%%%%%%

:id: 433
:date: 2007-04-02 19:34:45
:title: ぶちうま@四谷
:categories: ['food']
:body type: text/x-rst
:body:
会社の同僚と月に1度くらい行く広島つけ麺の店。ぶちうま。いつもは20辛をたのむんだけど、今日は22辛にしてみた（微妙ｗ  ここはキャベツが旨いので、今日はキャベツ増し。


- `つけ麺 / 広島つけ麺 ぶちうま - livedoor 東京グルメ`_ 
- `ラーメン(^-^)つけ麺！ぶちうま＠新宿区 四谷`_

.. _`つけ麺 / 広島つけ麺 ぶちうま - livedoor 東京グルメ`: http://tokyo.gourmet.livedoor.com/restaurant/info/14507.html
.. _`ラーメン(^-^)つけ麺！ぶちうま＠新宿区 四谷`: http://www.01ch.com/ramen/buchiuma.html


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-03.6822051931
:title: Re:ぶちうま@四谷
:author: masaru
:date: 2007-04-03 19:38:05
:email: 
:url: 
:body:
あまった付け汁にご飯をいれて食べるのも楽しみですね。


:comments:
:comment id: 2007-04-03.7379826311
:title: Re:ぶちうま@四谷
:author: しみずかわ
:date: 2007-04-03 21:35:38
:email: 
:url: 
:body:
> 付け汁にご飯

すっごい太りそうな予感がするので、最近はやめました...

:comments:
:comment id: 2007-04-04.5218223441
:title: Re:ぶちうま@四谷
:author: jack
:date: 2007-04-04 11:25:24
:email: 
:url: 
:body:
あー、ひさびさにぶちうまいきたいなぁ。
ご飯は案外カロリーありますね。
吉牛も並660 kcal らしいですが、ライスの量が260g なので、メシだけで400 kcal 以上あることになります。
まぁ、パンやラーメンには余裕で負けますがw

%%%%%%%%%

:id: 434
:date: 2007-04-04 21:33:38
:title: 納税
:categories: ['misc']
:body type: text/x-rst
:body:
毎年忘れた頃にやってくる固定資産税の通知が届きました。今年は去年と同じ額の税額のようです。うう、予定外の出費はつらい（来年は覚えておこう....）。

ところで固定資産税は土地や家屋の評価額と税率から求まるわけですが、去年と同じ額ということは、評価も税率も変わっていないということ。去年は一昨年より評価額が下がっていたので、評価が下がってないというのは「良かった」と取るべきなのか。そういえば、10年後に隣接する道路が整備されるらしいので、そのときには地価が上がったりするんだろうか？立ち退き要求されたりして(笑)


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-05.7078846493
:title: Re:納税
:author: aihatena
:date: 2007-04-05 09:41:49
:email: 
:url: 
:body:
http://www.tax.metro.tokyo.jp/shitsumon/tozei/index_o.htm#o6

:comments:
:comment id: 2007-04-05.3653552551
:title: Re:納税
:author: しみずかわ
:date: 2007-04-05 10:09:25
:email: 
:url: 
:body:
評価は3年ごとなのか～。じゃあ2年後にまた下落する、と。。

:comments:
:comment id: 2007-04-06.3352608085
:title: Re:納税
:author: aihatena
:date: 2007-04-06 13:55:37
:email: 
:url: 
:body:
http://www.nta.go.jp/category/rosenka/rosenka.htm
ほとんど同じだけどちょびっと上がったくらい?

%%%%%%%%%

:id: 435
:date: 2007-04-05 22:30:51
:title: auケータイからgmail
:categories: ['misc']
:body type: text/x-rst
:body:
`Gmailが国内でもau携帯電話に対応、ドコモとソフトバンクは利用できず`_ というニュースが2006年11月08日に発表されて、その頃にW42Hでアクセスしてみたら問題なく見れていた。EzWebでアクセスできるので安い方の定額通信でGMailが見れて結構便利だったのに、その後気がつくと文字化けして見れなくなっていた。 `みんなが調べた「Gmailが使える携帯」`_ によると機種によって見れたり見れなかったりするらしく、W42Hは見れる機種に含まれていない。

で、それ以来、月に1度くらいアクセスしてみていたんだけど、今日見てみたらちゃんと日本語が化けずに表示された。今のGMailは外部のPOPサーバーからメールを受信できるので、いろんなメールをGMailに集約できて、ケータイで見れる。便利だ！

全ての情報がGoogleに集まっていく....。いいのかな(´･ω･`)

.. _`Gmailが国内でもau携帯電話に対応、ドコモとソフトバンクは利用できず`: http://www.itmedia.co.jp/bizid/articles/0611/08/news009.html
.. _`みんなが調べた「Gmailが使える携帯」`: http://www.itmedia.co.jp/bizid/articles/0611/08/news124.html


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-08.1524225805
:title: Re:auケータイからgmail
:author: kojimax
:date: 2007-04-08 09:45:53
:email: 
:url: 
:body:
Googleさんは、こんなことも始めるようです。
http://www.asahi.com/business/update/0407/TKY200704070205.html?ref=rss

:comments:
:comment id: 2007-04-08.1083624890
:title: Re:auケータイからgmail
:author: しみずかわ
:date: 2007-04-08 10:35:08
:email: 
:url: 
:body:
Googleすげー！
でも以前、迷惑メールが即削除になって、誤判定メールが消失したことがあったけど、そのへん大丈夫なのかな？

%%%%%%%%%

:id: 436
:date: 2007-04-06 19:49:03
:title: 久々に自転車通勤
:categories: ['bicycle']
:body type: text/x-rst
:body:
今日は久々に自転車通勤。最後に自転車通勤をしてた時期は‥‥ちょうど1年前くらい。1年経つのが早いなあ。久々過ぎて速度のペースがよく分からなかったせいか、1年前に自転車通勤してた頃は1:10かかってたのが今日は1:00ちょうどくらいで着いてしまった。どうりでむちゃくちゃ疲れてるわけだ‥‥。

自宅から会社までは、約19km。1時間なら時速19km。あんまり速くないな。

いまの会社は一つのビルの中の4フロアをつかっていて、自分がいるのは4F。なので自転車をエレベータに入れて4Fまで運ぶ。4Fエレベータ前には自動販売機と会議スペースがあるので、窓際に駐輪。これなら盗難の心配は無い、と、思う。鍵くらいはかけるべきか？

これでしばらくすれば体重が減ってるんじゃないかと思うわけだけど、ちゃんと減るかな？


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-06.9667577999
:title: Re:久々に自転車通勤
:author: masaru
:date: 2007-04-06 20:46:07
:email: 
:url: 
:body:
減るといいですねー

:comments:
:comment id: 2007-04-07.4810939431
:title: Re:久々に自転車通勤
:author: koma2
:date: 2007-04-07 01:04:42
:email: koma2@lovepeers.org
:url: http://bloghome.lovepeers.org/daymemo2/
:body:
「あれって誰の自転車？」って話題になってたよ。;)

:comments:
:comment id: 2007-04-08.1424549688
:title: Re:久々に自転車通勤
:author: しみずかわ
:date: 2007-04-08 10:35:42
:email: 
:url: 
:body:
It's mine!

%%%%%%%%%

:id: 437
:date: 2007-04-08 23:57:32
:title: TurboGearsのお手軽Controller
:categories: ['turbogears']
:body type: text/x-rst
:body:
TurboGearsを使っていて最初に不満に思ったのは、crudフォームとしてcatwalkが提供されているものの、あれをそのまま実運用で使うことは出来ない＆カスタマイズが難しい、ということでした。Ploneほどのcrud機能は無くても良いので、Model定義すしただけで項目の一覧表示、追加、削除、編集、バリデーションが出来ればいいなあ、と思っていました。

色々調べて、DataGrid -> AjaxGrid -> TGFastData と順に使っていったのですが、TGFastDataでもまだ望む機能は満たされていませんでした（あとTGFastDataは0.9a6の時点からメンテナンスされていないようです）。そこで、TGFastDataをもうちょっと使いやすくした仕組みを作ってみました。名前は安直にtgdatacontroller。

tgdatacontrollerは、出来るだけ少ない実装で項目の一覧表示と各項目の編集を行うための枠組みです。たとえばグループの一覧表示と編集画面を用意するための最小のコードは以下のようになります。

.. code-block:: Python

    class Group(DataControllerEx):
        sql_class = model.Group

また、フィールドの表示順を変更したり、表示する項目を限定する場合は以下の
ように記述します。

.. code-block:: Python

    class Group(DataControllerEx):
        sql_class = model.Group
        form_fields = ('group_name', 'display_name', 'created',)

上記クラスはTurbuGearsのcontrollerとして作成されるので、通常のcontroller
と同様にcontroller.pyのRootクラスの属性に設定するなどして利用します。

まあ、あちこちバグがあるし、DataGrid,AjaxGrid,TGFastDataの方向性で育てていくのは、拡張性の面で限界があるので、ある程度まで形になったら、controllerじゃなくてwidgetにバラして再構築かなー。

SVNは以下のURLですが、easy_installには対応していません。

- http://svn.freia.jp/open/tgdatacontroller/

Screen Castも作ってみました。7分。微妙。YouTubeだと文字が潰れるよ

- http://devcamp.freia.jp/others/tgdatacontroller.wmv


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-15.0568224749
:title: Re:TurboGearsのお手軽Controller
:author: しみずかわ
:date: 2007-04-15 17:50:57
:email: 
:url: 
:body:
リポジトリのURLが変わりました。詳しくは以下を参照。

tgdatacontrollerをegg化
http://www.freia.jp/taka/blog/445

%%%%%%%%%

:id: 438
:date: 2007-04-09 00:54:00
:title: patchだらけのtgdatacontroller
:categories: ['turbogears']
:body type: text/x-rst
:body:
`TurboGearsのお手軽Controller`_ として作成したtgdatacontrollerですが、利用するためにはSQLObjectやtgfastdataにpatchを手動で当てる必要があります。いちおうそれぞれtrackerに報告はしたのですが、本流に取り込まれるまでは、パッチ当て面倒＆動作保証が怪しい気がする、と、startupはあまりスムーズじゃない気がします。しかもtgfastdataについては0.9a6から更新が無くて、修正してくれるのかどうか怪しい感じ。

以下、適用の必要があるpatch（報告分＋既に報告されていた分）です。

- sqlobject/col.py

  - fix: ForeignKey validation.
         http://sourceforge.net/tracker/index.php?func=detail&aid=1696359&group_id=74338&atid=540672

  - fix: datetime validation.
         http://sourceforge.net/tracker/index.php?func=detail&aid=1696365&group_id=74338&atid=540672

- turbogears/paginate.py

  - fix: paginate page controll.
         http://trac.turbogears.org/ticket/1321

- tgfastdata/formmaker.py

  - fix: typo: column_widget_date_col to column_widget_datetime_col.
         http://trac.turbogears.org/ticket/1350

  - fix: ForeignKey field name include ID. (is correct?)
         http://trac.turbogears.org/ticket/1294

SQLObjectについては再現テストを作成してみました。
http://svn.freia.jp/open/tgdatacontroller/trunk/patch/sqlobject/tests/

.. _`TurboGearsのお手軽Controller`: http://www.freia.jp/taka/blog/437


:extend type: text/html
:extend:
%%%%%%%%%

:id: 439
:date: 2007-04-10 00:43:41
:title: tgcrudを試す
:categories: ['turbogears']
:body type: text/x-rst
:body:
TurboGearsの周辺プロジェクトが格納されている http://svn.turbogears.org/projects/ を久しぶりに眺めてみたところ、FastData2とかToscaWidgetsとか色々増えてました。その中にtgcrudというのもあり、昨日tgdatacontrollerを公開した身としては気になるところです。

ということで、早速試してみました。

インストールは easy_install http://svn.turbogears.org/projects/tgcrud/ で終了。以降、以下のようにtg-adminのコマンドとして使えるようになります::

  % tg-admin tgcrud Todo TodoController

上記コマンドを実行するとカレントのプロジェクトにTodoControllerという名前でcrudフォーム用のcontrollerのソースコードが追加されるので、これを好きなURLにマッピングして使う、というアプローチのようです。

http://groups.google.com/group/turbogears/browse_thread/thread/7abbf88d4edb36ba/cfec4759cf29f55e?lhl=ja

しかし、上記のリリースノートにもあるように、特別なことが出来るようになるわけではなく、crudフォームを作る時のコード作成の手助けをしてくれるだけのものです。また、現時点では、指定したModelのフィールド情報からWidgetを選択してコード生成してくれるわけでもないので、この点については今後の発展に期待、というところです。

生成されたコードから先は各自で実装する必要があるので、細かなカスタマイズはしやすいのかもしれませんが、コード生成は個人的にはあまり好きじゃなかったりします。(VC++の頃のいやな思い出が...)

いろんな意味でtgdatacontrollerとは対極のアプローチ。


ところで、SQLObjectとSQLAlchemyの両方に対応しているのは良い点なのですが、O/Rマッパーの自動判定分岐が真偽反転していて、SQLObject使ってるのにSQLAlchemyのコードをはき出されて、ちょっと悩みました、ってことで、 `バグレポ`_ しました。片言の英語とコマンドラインとdiff貼り付けできっと通じる。

.. _`バグレポ`: http://trac.turbogears.org/ticket/1351


:extend type: text/html
:extend:
%%%%%%%%%

:id: 440
:date: 2007-04-11 00:15:01
:title: 魔理沙は大変なものを盗んでいきました
:categories: ['misc']
:body type: text/x-rst
:body:
`イオシス - 「東方乙女囃子」特設ページ(2006-08-10)`_
-------------------------------------------------
via `とみた`_ .

『魔理沙は大変なものを盗んでいきました』Flash. 一度聞くと耳について離れない不思議メロディー。
でも、東方はやったことない。

グーテンモルゲンは違うだろ。

.. _`とみた`: http://tomita-net.dyndns.org/
.. _`イオシス - 「東方乙女囃子」特設ページ(2006-08-10)`: http://shatyou.hp.infoseek.co.jp/toho2.html


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-11.8103321849
:title: Re:魔理沙は大変なものを盗んでいきました
:author: masaru
:date: 2007-04-11 22:06:51
:email: 
:url: 
:body:
とみたさんへのリンク先のURLが"トミテーネット"になってますよ

(とみたさんってあのとみたさんなのか？）

:comments:
:comment id: 2007-04-12.9598847085
:title: Re:魔理沙は大変なものを盗んでいきました
:author: しみずかわ
:date: 2007-04-12 01:29:20
:email: 
:url: 
:body:
直しました。
多分違うとみたさん。
それはそうと、viaの使い方を間違っている気がする。リンク先には元記事がある訳じゃないので。。

%%%%%%%%%

:id: 441
:date: 2007-04-11 00:17:47
:title: TypingMania3β
:categories: ['misc']
:body type: text/x-rst
:body:
- `TypingMania3β - SightSeekerStudio.com`_

via aihatena_ .

ハレ晴レユカイでタイピングして、ランクA, スコア169048.

流れが速いので、タイプミスするとかなり残念な結果になってしまう。
ていうか、速すぎ。

.. _aihatena: http://www.freia.jp/aihatena/
.. _`TypingMania3β - SightSeekerStudio.com`: http://www.sightseekerstudio.com/yanmani/typingmania3.html


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-11.1498320804
:title: Re:TypingMania3β
:author: しみずかわ
:date: 2007-04-11 08:35:51
:email: 
:url: 
:body:
更新。ランク AA, スコア 170238

%%%%%%%%%

:id: 442
:date: 2007-04-13 22:06:24
:title: FirefoxのCopyURL+をIEとOperaにも欲しい
:categories: ['javascript']
:body type: text/x-rst
:body:
FirefoxのCopyURL+を使うと、ページのURLとタイトルをクリップボードにコピーしてくれる。たとえばこのサイトのトップページで行うと以下のような文字列がクリップボードに保存される::

  最近の清水川Web — 清水川Web 
  http://www.freia.jp/taka

これがあると他の人にURLを伝えるときにタイトル付きなのでわかりやすい。あとメモをに書き写すときとかblogに引用元のURLを書くときとか。

これをIEやOperaでも出来るといいなあ、と思ってGoogleで探して、欲しい物に一番近いコードをbookmarkletとして改造してみた。引用元は `最速インターフェース研究会 :: Firefoxでテキストをクリップボードにコピーする方法`_ 。

Opera用::

  javascript:(function(text){var swf_data = "http://ma.la/setClipboard.swf";var tmp = document.createElement("div");tmp.innerHTML = '<embed src="'+swf_data+'" FlashVars="code='+encodeURI(text)+'" width="0" height="0"></embed>';with(tmp.style){position ="absolute";left = "-10px";top  = "-10px";visibility = "hidden";};document.body.appendChild(tmp);setTimeout(function(){document.body.removeChild(tmp)},1000);})(document.title+"\n"+location.href)


最近はJavaScriptにも以前より慣れたとはいえ、Opera用は自力では作れなかったなぁ。OperaではJavaScriptでクリップボードを操作する方法が無い(と思う)ので、Flashを経由してクリップボードに保存しているようだ。上記のコードをそのまま使うと、Flashファイルをma.laドメインに取りに行くので、アクセスログに色々残る可能性あり。自分のサーバー等にコピーして利用するか、引用元サイトで第3の方法として提示されている外部Flashファイルを使わない方法にチャレンジする必要がある。

ところで、IEのJavaScriptはクリップボード操作ができるので、以下のコードで動作する。

IE用::

  javascript:(function(text){clipboardData.setData("Text",text);})(document.title+'\n'+location.href);


そうだ、reStructuredText用に、出力文字列を以下のようにしてみようかな::

  `最近の清水川Web — 清水川Web`_
  .. _`最近の清水川Web — 清水川Web`: http://www.freia.jp/taka



.. _`最速インターフェース研究会 :: Firefoxでテキストをクリップボードにコピーする方法`: http://la.ma.la/blog/diary_200601100445.htm


:extend type: text/html
:extend:
%%%%%%%%%

:id: 443
:date: 2007-04-14 23:58:18
:title: 公衆無線LANサービスFONに入ってみる
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`公衆無線LANサービス「FON」対応ルータ本日のみ無料提供中 - GIGAZINE`_ を参考に23:50に無料の申し込みを完了。送料等で1000円くらいかかった。

FONの台数は国内で1万を超えたとはいえ、調布駅前近辺は3カ所だし、無線LANのカバー範囲なんて最大で半径100m、実質50mもないと思うので、しばらくは使えないサービスになりそうな予感。とりあえず加入してると面白そうなので入ってみた。届いたらとりあえず自宅内ネットワークと切り離して接続してみよう。。



.. _`公衆無線LANサービス「FON」対応ルータ本日のみ無料提供中 - GIGAZINE`: http://gigazine.net/index.php?/news/comments/20070414_fon_free/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 444
:date: 2007-04-15 13:50:43
:title: 新モスバーガーを食べる
:categories: ['food']
:body type: text/x-rst
:body:
`モスバーガーがバーガー商品を全面刷新、クーポン割引を導入 - GIGAZINE`_ ということで、スパイシーモスチーズバーガーを食べてみた。見た目としてはミートソースの赤味が薄れて、食感は全体的に固くなった感じがする。食べたやつのバンズがちょっと冷えていたせいもあるかもしれないけど、ミートは確実にクリスプな感じになっていた。これもたまたま焼きすぎたのか‥‥？

評価：微妙

店員が慣れた頃にもう一度食べてみよう。

.. _`モスバーガーがバーガー商品を全面刷新、クーポン割引を導入 - GIGAZINE`: http://gigazine.net/index.php?/news/comments/20070412_mos/


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-21.9446002703
:title: Re:新モスバーガーを食べる
:author: 泡盛マイスター
:date: 2007-04-21 10:45:46
:email: 
:url: http://plaza.rakuten.co.jp/awamorimeister/diary/200704210000/
:body:
モスバーガーの『新.モスバーガー』＆『新.テリヤキバーガー』、さっそく食べてきました。実は、近くのモスバーガー・首里店のチラシに割引券がついてたんです。

新. モスバーガー、野菜のたっぷり入ったソースと、どっさり入ったタマネギがスパイシー。パティもボリュームがあって、ジューシー。なるほど、おいしくなりました。新.テリヤキバーガーも、２種類の味噌をブレンドしたソースと、たっぷりのマヨネーズが、とってもグッド！　お店にもよるのかもしれませんが、自分は結構満喫です。

%%%%%%%%%

:id: 445
:date: 2007-04-15 17:50:16
:title: tgdatacontrollerをegg化
:categories: ['python', 'turbogears']
:body type: text/x-rst
:body:
easy_install
-------------

`TurboGearsのお手軽Controller`_ で公開したTGDataControllerをegg化してみました。あと公開URLを変更しました。以下のURLからeasy_installで手軽にインストールできるようになっています。

- TGDataController: http://svn.freia.jp/open/tg/TGDataController/trunk
- 利用サンプルアプリ: http://svn.freia.jp/open/tg/TGDataController/trunk/tgdatacontroller/sample/todo

easy_installでインストールする場合は以下のように実行します。

.. Topic:: easy_install
  :class: dos

  | C:> easy_install http://svn.freia.jp/open/tg/TGDataController/trunk


dependency
-----------
eggの依存情報のところに, ``"SQLObject == bugfix, >=0.7.5,<=0.7.99"`` という記述を入れています。SQLObject-0.8系は動作確認してません。あと、SQLAlchemyには対応していません。


egg化
------
プロダクトをegg対応するには、基本的にdistutils用のsetup.pyを作るのとほぼ同じようにsetup.pyを書けばいいようだ。 `TurboGearsのsetup.py`_ を参考にして必要なパラメータをsetup関数に指定。あとはpython環境にsetuptoolsがインストールされていれば、以下のようにコマンドを実行してeggファイルを作ることが出来るようになる。

.. Topic:: bdist_egg
  :class: dos

  | C:> python setup.py bdist_egg

- 参考: `setuptools - The PEAK Developers' Center`_


.. _`TurboGearsのお手軽Controller`: http://www.freia.jp/taka/blog/437
.. _`TurboGearsのsetup.py`: http://svn.turbogears.org/trunk/setup.py
.. _`setuptools - The PEAK Developers' Center`: http://peak.telecommunity.com/DevCenter/setuptools


:extend type: text/html
:extend:
%%%%%%%%%

:id: 446
:date: 2007-04-15 22:07:13
:title: FormEncodeで複合validation
:categories: ['Pattern', 'python', 'turbogears']
:body type: text/x-rst
:body:
TurboGearsのサンプルコードで、validatorの設定方法やvalidators.Schemaを使ったTableFormのvalidationの例はけっこうたくさん見つかるが、複数の条件でバリデーションを行う方法については日本語の情報があまり見つからなかった。FormEncodeのマニュアルを眺めてみたら発見したので、以下使い方。

.. code-block:: Python

    # AND operation
    validator = validators.All(validators.String(), validators.NotEmpty())

    # OR operation
    validator = validators.Any(validators.URL(), validators.Email())

PloneのArchetypesの場合は ``validators = (...)`` という感じに複数設定する前提の設計になっているけど、FormEncodeの場合はcompositeパターンで構築されている。利用する立場ではどっちでも良いけど、validatorを書く立場の場合は後者の方が使いやすい気がする。なんとなく。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 447
:date: 2007-04-16 00:02:19
:title: COREBlog2のカテゴリの関連づけと表示権限
:categories: ['Plone']
:body type: text/x-rst
:body:
`PloneでReferenceのW/F状態による色分け`_ や `COREBlog2のオブジェクトの関連づけと表示権限`_ で行った対策で、COREBlog2のエントリが関連付いている画像などが非公開状態の場合に、赤文字で表示したり閲覧時に認証画面が出ないようにしたつもりだった。でも実はカテゴリも同じように対処が必要だったことが今日発覚。あたらしく追加したJavaScriptカテゴリを公開にするのを忘れていたようだ。

ということで、同じように対策してみた。対策内容は添付のpatchを参照のこと。

前回の対策と合わせて `COREBlog2 - Trac`_ に提案登録してみよう。


.. _`COREBlog2のオブジェクトの関連づけと表示権限`: http://www.freia.jp/taka/blog/431/
.. _`PloneでReferenceのW/F状態による色分け`: http://www.freia.jp/taka/blog/429
.. _`COREBlog2 - Trac`: http://coreblog.org/trac/coreblog2/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 448
:date: 2007-04-16 00:05:11
:title: Python温泉
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
清水川Webは、第一回 Python 温泉に参加します！

団体申し込みの締め切りは過ぎてしまいましたが、個別に宿を確保すれば、まだ参加は可能のようです。てことで、詳しくは以下を参照。

- `Django and TurboGears 温泉 | Djangoと日本の仲間たち`_
- `Twisted Mind - 締切り一週間前なので最終告知`_
- `Twisted Mind - Python温泉ロゴ`_

.. _`Twisted Mind - 締切り一週間前なので最終告知`: http://d.hatena.ne.jp/Voluntas/20070325/1174830404
.. _`Twisted Mind - Python温泉ロゴ`: http://d.hatena.ne.jp/Voluntas/20070410/1176213784
.. _`Django and TurboGears 温泉 | Djangoと日本の仲間たち`: http://djangoproject.jp/spa/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 449
:date: 2007-04-18 21:05:09
:title: ZopeEssentials6 参加log
:categories: ['Event', 'Zope', 'Plone']
:body type: text/x-rst
:body:
今日は `Zope Essentials 6`_ に参加してきました。
天気は残念ながら雨でしたが、参加者30名の定員いっぱいでした。それにしても最近寒すぎ。

PART 1 : Plone in New Zealand
-------------------------------
ニュージーランドでPlone会社を経営しているTim Knappが、ニュージーランドでのPlone事情を紹介してくれました。ちなみに会社名は `Emerge Technology`_ というそうです。

最初、PCが起動しなくなってかなりハラハラしましたが、PCも無事起動し、プレゼンが始まりました。

.. epigraph:: 

  私たちは、必要な機能性、信頼のおけるヒストリー、十分なデベロッパサポート付きのオープンソースソリューションを求めています。Ploneはこれら全ての条件を満たしています。

  -- Laurence Millar

ニュージーランドでオープンソースを使用しているのはベンチャー企業と政府が主だそうです。日本はどうですか？とTimさんから会場に質問が出ましたが、あまり良い反応はありませんでした。ニュージーランドに比べると、残念ながら日本政府でのオープンソース利用はまだまだ初期段階という感じです。

開発に使っている主要ツールとして、 `Instance manager`_ と `ArchGenXML`_ が上げられました。Instance managerは複数の環境でまったく同じProductを設置して設定して‥‥という初期設定を設定に従って一発で行ってくれる超便利なツールっぽいです。また、ArcheGenXMLも2年前に見たときにくらべてかなりパワーアップしていて、ワークフローの設定やテストのセットアップについても **超** 手軽に作ることが出来るようです。実際にTimさんがデモでInstance managerとArchGenXMLを組み合わせて、サクっとコンテンツタイプとワークフローを作って動く状態にしていました。すごすぎ！要チェックや！

最後に、プレゼントということでPloneのTシャツがプレゼントされました。ほしかったー


PART 2 : Plone Sprint レポート
------------------------------
ジョナサンのPlone Sprintレポートです。最近寺田さんがジョナサンのとこの大学でPloneについてホゲホゲしてるらしく、今日もちょっと遅れてやってきました。PloneインストーラでインストールしたらVistaで動かなかったらしいです。Program Filesにインストールしちゃだめよー。

前回のSprintは、目標がきっちりきまっていて発表盛りだくさんだったのに対して、今回のSprintは、発表無し＆みんなやりたいことを自由にやる、というかんじの、かなりイタリアンな感じだったようです。

Plone3.0に向けてKSSをSeleniumでのテストがたくさん作られたけど、新しく入ったAjaxの仕組みとKupuの仕組みがバッティングして大変だったようです。

XML import/exportの機能をPloneに実装。でもLinguaPloneのように多言語対応コンテンツはコンテンツのインスタンス間にリファレンスが張られていて、XMLで書き出したデータを他の環境で読み込んだ時にリファレンス情報を正しく復元するのがかなり大変だったようです。でもちゃんと出来たらしい。

他にも以下のような開発があったそうです。

- media file 対応
- formlib widget作成
- remember (CMF Memberの置き換え)作成
- deliverance （デザイナー向け、Ploneテンプレート作成）

Q and A
~~~~~~~~~

Plone-3.0は実用になるか？

- Plone-3.0はまだバグが多い
- でもPlone-3.0がリリースされればPlone-2.1系はサポートされなくなる
- LinguaPloneはPlone-2.5系にちゃんと対応してない。3.0はもっと対応してない。

Sprintに行ったのは仕事？趣味？

- 開発スキルはそれほどないので貢献はなかなかしづらい
- でも開発者達のオーラを浴びることが出来る！
- あるいみ無料のトレーニング
- Sprintから得るものはものすごく大きい
- 何気ない会話からチーム内の会話まで全部Plone。

  - 一番困る顧客はPloneをちょっと知っている人
  - 勝手にPloneプロダクトを入れてしまう
  - 一番良い顧客はPloneかどうかを気にしない人
  - 契約でZMIへのアクセスを禁止したりする

PART 3 : 二次会
---------------
これから行ってきます:-)


.. _`Zope Essentials 6`: http://zope.jp/events/zopeessentials/6
.. _`Emerge Technology`: http://www.emergetec.com
.. _`ArchGenXML`: http://plone.org/products/archgenxml
.. _`Instance manager`: http://plone.org/products/instance-manager



:extend type: text/html
:extend:
%%%%%%%%%

:id: 450
:date: 2007-04-20 23:58:56
:title: 仕事の責任範囲
:categories: ['misc', 'work']
:body type: text/x-rst
:body:
KDDI時代の同期が密かに結婚していたので、お祝い（飲み）に `銀座 かまくら`_ に行ってきた。彼らとは新卒で入社したときの社会人研修A班の頃からのけっこう長いつきあいで、年に数回は集まっていたのだけど、最近は年１回ちょっとになっていたらしい。おかげで疎外感はあんまり無かったけど、GATビルの入り口にセキュリティーのための改札が設置された、という話題にはちょっとびっくりした。

飲んで話してるうちに、仕事の責任範囲の話になった。A部署が仕事の依頼側、B部署が開発側だとしたときに、A部署はB部署がやっている作業の内容を知る必要があるのかどうか。逆に、B部署はA部署からの依頼の意図をどこまで把握する必要があるのか。

- 依頼の意図や、作業の内容を知る必要はない
- 意図は説明されなくても気づくべきだし、相手の作業も把握すべき
- 期限を守れないのは他に優先度の高い事があるから
- 期限を守れない人がどれだけ忙しくても、依頼側が気にすることではない
- 開発物の仕様が決まった段階で運用の計画をするべき（完成は１年後）

実際の状況の中に居ないので聞き間違ってるかもしれない。

とりあえず自分としては、指示を受けるとき、指示を出すとき、つまり依頼のInput側とOutput側のレイヤーまでは意図や実作業の内容を把握するべきだと考えている。そうしないと適切な行動を取れないし、無駄を省くことも出来ない。そもそもスケジュールを立てられない。「一つ上・ひとつ下」を見ずに仕事してたら歯車になっちゃうから多分楽しくないだろうし。

仕事は、責任感の強い人や仕事をこなせる人のところに集まってくる。そしてそういう人は色々な事に気づいて色々な仕事を発生させるのでさらに忙しくなる。そして、やりすぎてしまうと自分が仕事に押しつぶされてしまう。これもまた全く楽しくない。KTECの時の上司も責任感の強い人で、かなり広い範囲を見ていて、そしてかなりの量の仕事に追われ続けていたようだった。今はどうなってるだろう...今度聞いてみよう。

解決方法の一つは、「一つ上・ひとつ下」レイヤーを知り気づき能力のある部下を持つ。あるいはそのように育てる事か。そうでない人を増やしても多分仕事は減らない。やっつけ仕事が増えてますます仕事が増える。

大きい会社の方が教育関係の制度や仕組みはしっかりしていて、良い人材が多く仕事が円滑に回る、と思っていたけど、会社の大小はあまり関係ないのかも。と思った夜であった。

# そして終電を逃し、三鷹から調布まで３割増料金のタクシーですよ


.. _`銀座 かまくら`: http://r.gnavi.co.jp/g469901/

:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-21.7100064032
:title: Re:仕事の責任範囲
:author: jack
:date: 2007-04-21 22:05:12
:email: 
:url: 
:body:
プロジェクトとして一体なのであれば部署割りを気にしている時点で負けな気がします。
まぁ、そうなるのはよくわかるんですけど。

両方の部署に責任のある人を能動的に動かすのが最短距離かと。たとえそれが社長でも。
正直、いろいろできる人材は前職のほうがいた可能性が高い気もしますが、組織の能動性
では今のほうがいいような気もします。

:comments:
:comment id: 2007-04-22.9939426571
:title: Re:仕事の責任範囲
:author: kojimax
:date: 2007-04-22 00:06:34
:email: 
:url: 
:body:
いわゆる日本的な企業では、部署間の壁ってはかなり高いですからねぇ。
近いようで遠い、というか。場合によっては、別会社より性質が悪いことも。

> 良い人材が多く...
人数で言ったらそうでしょうけど、比率で言うと大して変わらないか、
逆転すると思ってます。
自分は、仕事はある程度の（実感できる）責任をセットで与えないと
仕事を受けた側が成長しないと思っているのですが、大きいところは
責任ある仕事ができるようになるまでの期間が長すぎるんじゃないかなぁと。
＃大企業で働いていたわけじゃないので、想像ですけどね。

p.s. なんか上手くトラックバックできなかったので負けた気分です（ぉ

:comments:
:comment id: 2007-04-22.4437140052
:title: Re:仕事の責任範囲
:author: しみずかわ
:date: 2007-04-22 01:20:43
:email: 
:url: 
:body:
> プロジェクトとして一体なのであれば部署割りを気にしている時点で負けな気がします。

中長期的なプロジェクト、というか運用の一環なので、プロジェクトとして見ることは出来ないかも。たとえば、ケータイの電波状況監視と基地局の増強と基地局設備の開発、の一連の流れはどこからどこまでがプロジェクトなのやら。
別部署だから、というより、お互い抱えているものが大きくて接点が一部分しかないから、相手のことをちゃんと理解できてないだけかも。「問題vs私たち」にしようにも、問題が共通になってない。


> 責任ある仕事ができるようになるまでの期間が長すぎるんじゃないかなぁと。

責任を持って行動する人は早く責任ある仕事に就ける仕組み、だった気がする。
# 年功序列時代に役職に就いた方々が責任もって行動する人かどうかには触れない...

トラックバックはデフォルト閉じてるので..というか閉じてた

%%%%%%%%%

:id: 451
:date: 2007-04-21 23:55:00
:title: InstanceManagerでZope/Plone環境自動構築
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
先日の `Zope Essentials 6`_ で仕入れたネタ InstanceManager を試してみました。
InstanceManagerはeasy_installで一発インストールできますが、その後の設定がけっこうめんどくさかったです。しかし、設定さえ出来てしまえば、同じ環境をなんどでもコマンド一発で再構築することが出来ます。

とりあえずインストール。Ploneのサイトからもダウンロードできますが、けっこうバグ修正が進んでいるようなので、easy_installを使うかリポジトリから取ってくるのが良いでしょう。

.. topic:: easy_install instancemanager
    :class: dos
    
    | c:\>easy_install instancemanager
    | Searching for instancemanager
    | 
    | Best match: instancemanager 1.0rc.dev-r36992
    | 
    | Installing instancemanager-script.py script to C:\Develop\Python24\Scripts
    | Installing instancemanager.exe script to C:\Develop\Python24\Scripts
    | 
    | Installed c:\develop\python24\lib\site-packages\instancemanager-1.0rc.dev_r36992-py2.4.egg
    | Processing dependencies for instancemanager


無事終わりました。次に一度、空起動します。INSTALL.txtによると、空起動によりホームディレクトリに.instancemanagerが作成され、そこにあるuserdefaults.pyがデフォルト設定を行うファイルになるようです。

.. topic:: instancemanager
    :class: dos

    | c:\>instancemanager
    | usage: Usage: instancemanager [options] [multi-action] <project>
    | multi-action: default ones are 'fresh' and 'soft'.
    | project: the name of the project, available projects are:
    |     You can look at userdefaults.py to change
    |     instancemanager to your local config.
    |     Or run instancemanager again with <project> and <action>.

ずらずらーっとusageが表示されますが、とりあえず無視してホームディレクトリ/.instancemanager/userdefaults.py を編集します。ここまでの実行はWindowsで行いましたが、Windowsだと色々と問題があるので、続きはUnixでやることにします。

うまく環境が構築できると、以下のコマンド一発でPloneの環境が添付画像のように構築されます。

.. topic:: instancemanager fresh
    :class: dos

    % instancemanager fresh testproj


つ・づ・く

- `Instance manager — plone.org`_
- `Revision 40922: /instancemanager`_

.. _`Revision 40922: /instancemanager`: https://svn.plone.org/svn/collective/instancemanager/
.. _`Instance manager — plone.org`: http://plone.org/products/instance-manager
.. _`Zope Essentials 6`: http://www.freia.jp/taka/blog/449


:extend type: text/html
:extend:
%%%%%%%%%

:id: 452
:date: 2007-04-22 01:03:38
:title: InstanceManagerでZope/Plone環境自動構築 2
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
コマンド一発でZopeのインスタンスを作り、Ploneのtgzを展開し、svnからソースコード取ってきて、zopeを起動してploneのインスタンスを作ってプロダクトの追加までやってくれる便利なライブラリ、instance managerの設定についてのメモです。インストールについては `InstanceManagerでZope/Plone環境自動構築`_ を見てください。

ではさっそく、userdefaults.py の中身について。


.. _`InstanceManagerでZope/Plone環境自動構築`: http://www.freia.jp/taka/blog/451


:extend type: text/x-rst
:extend:

.. code-block:: Python

  python = 'python2.4'
  zope_version = '2.9.7'
  
  zope_location_template = '%(user_dir)s/zope/Zope-%(zope_version)s'
  zope_instance_template = '%(user_dir)s/instances/%(project)s'
  archive_basedir_template = '%(user_dir)s/download/'
  archivebundle_basedir_template = '%(user_dir)s/download/'
  symlink_basedir_template = '%(user_dir)s/svn/'
  symlinkbundle_basedir_template = '%(user_dir)s/svn/'
  
  development_machine = True
  user = 'admin'
  password = 'admin'
  port = '8080'
  ftp_port = None

  plone_site_name = 'portal'

このへんが共通設定かな、という感じでコメントに書かれていた説明を解読しつつ設定してみました。

上記の設定に従って、利用するZopeを~/zope/以下に適切な名前でインストールしておく必要があります。上記の例なら ~/zope/Zope-2.9.7 が必要です。また、tgzファイル置き場として~/download を、svnのチェックアウトコード置き場として~/svn/を使用するように指定しているので、それぞれディレクトリを作成しておきましょう。

userdefaults.pyはあくまで共通設定なので、これを設定しただけでは環境を構築することは出来ません。ということで次に環境構築用の設定を作成します。環境構築設定を記述するファイルとして、~/.instancemanager フォルダに<projectnamem>.pyを作成します。projectnameは好きに付けて良いので今回はtestproj.pyとします。

.. code-block:: Python

  zope_version = '2.9.7'
  development_machine = True
  
  symlink_sources = [
      {'source':'ATCTSmallSample',
       'pylib':False,
       'develop':False,
       'droplist':(),
       'url':'http://svn.freia.jp/open/ATCTSmallSample/trunk'
      },
      {'source':'ATBookshelf',
       'pylib':False,
       'develop':False,
       'droplist':(),
       'url':'http://svn.freia.jp/open/ATBookshelf/trunk'
      },
      {'source':'ATExtFlash',
       'pylib':False,
       'develop':False,
       'droplist':(),
       'url':'http://svn.freia.jp/open/ATExtFlash/trunk'
      },
  ]
  
  archivebundle_sources = [
      {'source': 'Plone-2.5.2-1.tar.gz',
       'develop':False,
       'droplist':('Five'), # drop Five from this bundle
       'url':'http://plone.googlecode.com/files/Plone-2.5.2-1.tar.gz'
      },
  ]
  
  main_products = [
      'ATBookshelf',
      'ATCTSmallSample',
      'ATEventRegistry',
      'ATExtFlash',
  ]
  

これで設定が出来ました。では早速実行してみましょう。

.. topic:: instancemanager fresh
    :class: dos

    % instancemanager fresh testproj

このツール、エラーが起きても止まらずに最後まで走ってしまうので、うまく動いて居なそうな場合は-vオプションを付けて出力されるログをよく観察する必要があります。エラーが起きなければ、8080ポートでZopeが動いているはずです。

InstanceManagerは、このほかにも以下のような機能があります。

- ZEO環境の構築
- テストの実施
- Data.fsの定期的なバックアップ
- Data.fsのPack
- zope.confの設定
- GenericSetupとの連携
- Zope3での使用

機能豊富です。ていうかGenericSetupまで入ってるし。

しかし、内部のコードはsvn,tar,unzipなどをos.system等で呼び出していて、Windowsで動かすには障害が多そうな感じです。特にzopectlコマンドはWindowsでは使えないので、quickinstaller呼び出しやtestの実行はうまく動きません。今のところUnixでつかえ、という感じなのかな。
%%%%%%%%%

:id: 453
:date: 2007-04-23 01:25:06
:title: 5年ぶりに免許更新
:categories: ['misc']
:body type: text/x-rst
:body:
忘れた頃にやってくる運転免許証の更新に行ってきました。

最近視力が下がってきているので、昨日土曜日に新しいコンタクトレンズも調達してきました。乱視用は値段が倍くらいになるけど自分の乱視度ではあまり意味無いらしい。ということでサンプルはもらったものの実際に買ったのは非乱視用のワンデイアキュビュー。4年前に買った30日分がまだ5日分くらい残ってることを考えると、今回買った30日分も消費するのに5年くらいかかることだろう‥‥あ、車運転するときは使うか。

で、府中免許センターに愛車（自転車）で乗り付けて免許を更新してきました。ICに記録する本籍情報などにアクセスするための暗証番号入力の手順が増えていた以外は大体いつもの通り。ICに記録されている情報には2段階あるので、暗証番号4桁も2種類必要。どっちがどっちだったか覚えてられなそうな予感。免許証交付後に確認してみたところ、顔写真も白黒ながらICに記録されてました。ふーん。

で、で。帰りに野川沿いを走ってたら大漁の鯉を発見。30尾くらい。ここまで連なってると鯉幟というよりメザシに見える。子供には良い思い出になるだろうなあ、メザシ。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-04-23.5487056189
:title: Re:5年ぶりに免許更新
:author: masaru
:date: 2007-04-23 20:25:51
:email: 
:url: 
:body:
そのＩＣどう使うんだろ？
ＩＣ化することでどっかの小役人の
利権になったりするんだろうな・・・

(コナンメガネは今かけてないんですか？)

:comments:
:comment id: 2007-04-23.4728333651
:title: Re:5年ぶりに免許更新
:author: しみずかわ
:date: 2007-04-23 22:21:14
:email: 
:url: 
:body:
コナン眼鏡て‥‥

免許証ってたしかに違反しないと使わないからなあ・・

%%%%%%%%%

:id: 454
:date: 2007-04-25 22:14:44
:title: Fonのルーターがそろそろ届くらしい
:categories: ['misc']
:body type: text/x-rst
:body:
フォン・ジャパン株式会社から、ルーター送ったよメールが届きました。

::

     ご注文日時          ： 2007年4月14日  23時44分58秒
     ご注文番号          ： 17040
     ご注文商品          ： ＦＯＮ　Ｓｏｃｉａｌ　Ｒｏｕｔｅｒ
     お支払い額          ： 945円
     お支払い方法        ： 代金引換
     お受取受付番号      ： 9447
     お受取り方法        ： 宅配

発送までに10日以上かかるとは‥‥。申し込みしたことすら忘れてましたよ？
あるいは、4/14の無料日に大量に申し込まれて発送が追いつかなかったかな？

:extend type: text/html
:extend:
%%%%%%%%%

:id: 455
:date: 2007-04-28 23:55:00
:title: 猫合宿
:categories: ['misc']
:body type: text/x-rst
:body:
今日は、GW帰郷で留守にしている aihatena_ の猫の世話のために2泊3日の合宿にきています。メンバーは俺・ `とみた`_ ・ `GO`_ 。部屋には無線LANがあるもののWEPのキーはaihatena本人も知らないという。その無線LANには何の意味が‥‥。しかたがないので有線LANにいつも持ち歩いているHUBを接続してシェア。USB給電のLAN-HUBは非常に便利だ。

.. _aihatena: http://www.freia.jp/aihatena/
.. _`とみた`: http://tomita-net.dyndns.org/
.. _`GO`: http://www.freia.jp/suzuki-g/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 456
:date: 2007-04-30 21:44:30
:title: FONは公開と非公開２つのSSIDを持つ
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`猫合宿`_ から帰ってきたので、おととい届いたFONのルーターをセットアップしました。特徴を簡単に書くと、FONの無線LANルーターは

- ２つのSSIDがある
- SSIDはプライベートと公開の２つ
- SSIDは任意の名前に出来る（けど公開はFON_APにすべきだろう）
- プライベートのSSIDはWPA2が標準
- 公開のSSIDは鍵なし
- 公開からInternetへのアクセスはWeb認証が必要
- 公開から宅内のLANは見えない
- プライベートのSSIDからでも宅内LANとは異なるサブネットになる
- ルーターの設定はFONのサイトで行う
- 公開に提供する帯域の上限を設定できる

という感じ。おそらく公開サブネットはFONのサイトかどこかとVPNしてるのかも？

自分は385939台目の参加者で日本国内には1万以上あるらしいけど、調布駅前で見ると4台目。無線LANのカバー範囲を考えるとかなりスカスカです。果たして自宅外でFONを見かけることがあるだろうか‥‥？

.. _`猫合宿`: http://www.freia.jp/taka/blog/455


:extend type: text/html
:extend:
%%%%%%%%%

:id: 457
:date: 2007-05-01 20:30:27
:title: freia.jpが熱暴走で停止していた
:categories: ['IT-PC']
:body type: text/x-rst
:body:
ゴールデンウィーク前半は猫合宿に出かけていたが、連休3日目にfreia.jpサーバーが熱暴走で停止。今年もついにサーバー置き部屋のクーラーが24時間体制で稼働を開始した。現状、250GBのSATA-HDDが4台接続していて、RAID5(3台+Hotスタンバイ1台)を構成している。今はもう1TBのHDDも出始めているので、1Tを2台でミラーリングすれば総合的に改善されるんじゃないかとも思ってみたり。HardRAIDはRAIDカードが壊れたらアウトなのに対して、ミラーリングなら簡単復旧＆安価なんじゃないかと思う。電気代も熱も下がりそう。

ていうか、そろそろさくらインターネットか何かをレンタルするのが良いのかもしれない。しかし、手元にある利便性を考えると‥‥悩む。


`AKIBA PC Hotline! Junk Blog.: Lubicで作ったHDDケースと24台のHDDを使ったRAIDデモ`__ 。こんなのは真似できないよ！

.. __: http://akiba-pc.watch.impress.co.jp/blog/archives/2007/04/lubichdd24hddra.html

:extend type: text/html
:extend:


:comments:
:comment id: 2007-05-02.0116178311
:title: Re:freia.jpが熱暴走で停止していた
:author: aihatena
:date: 2007-05-02 09:16:53
:email: 
:url: 
:body:
うちは復旧容易性をとってRAID1にしてま..したが今はRAID1+0です。

電気代も考えるとレン鯖もよいけど、さくらは無償でも第三者貸与ができないのが難。ねこ写真移動するしかないか..

:comments:
:comment id: 2007-05-02.5896726993
:title: レンタルサーバー
:author: しみずかわ
:date: 2007-05-02 09:59:49
:email: 
:url: 
:body:
> ねこ写真移動するしかないか..

いやいや、考えてるだけで多分やらないｗ
iTunesの楽曲が遠隔にあるのは多分色々と大変だし。。

%%%%%%%%%

:id: 458
:date: 2007-05-11 10:51:08
:title: 北海道へ
:categories: ['misc']
:body type: text/x-rst
:body:
とある目的のため、函館へ行きます。

今回、ANAのWebサイトでチケットを購入したら、ケータイをかざすだけで保安検査とか搭乗ゲートとかを通ることができました。 `スキップサービス`_ というやつらしいです。

チケットレスなので色々待たずに乗れるのに、飛行機の出発が20分遅れてしまい待合室で待ちぼうけです。原因はトイレの清掃に手間取っているから‥‥ってどんな状態なんだろう？恐ろしい。

どうでもいいですが、飛行機がピカチュウ柄でした。

.. _`スキップサービス`: http://www.ana.co.jp/dom/checkin/skip/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 460x
:date: 2007-05-25 08:33:21
:title: IEのCSS, word-breakって初めて知ったよ！
:categories: ['misc']
:body type: text/x-rst
:body:
`word-break－スタイルシートリファレンス`_

これでIEのテーブル勝手に拡張の挙動を押さえ込んでやる

::

  ようすけ の発言:
  limit-break・・・必殺技を出すこと指定する（FFが独自に採用）
  FF7

  limit-breakプロパティは、Finalfantasy7が独自に採用したもので、攻撃される度に
  ゲージがたまっていきます

.. _`word-break－スタイルシートリファレンス`: http://www.htmq.com/style/word-break.shtml


:extend type: text/html
:extend:
%%%%%%%%%

:id: 459x
:date: 2007-05-25 08:33:23
:title: はこだて未来大学で講義しました2007春
:categories: ['Event']
:body type: text/x-rst
:body:
昨年に引き続き、はこだて未来大学で講義してきました。（昨年： `はこだて未来大学で講義しました`_ ）


.. _`はこだて未来大学で講義しました`: http://www.freia.jp/taka/blog/382


:extend type: text/html
:extend:
%%%%%%%%%

:id: 459
:date: 2007-05-25 08:38:33
:title: 沖縄へ
:categories: ['misc']
:body type: text/x-rst
:body:
ぼーっとしてるうちに社員旅行の日になってしまいました。はこだで未来大での講義レポートもまだ書いてないのに・・・。社員旅行は沖縄です。今月は北海道に行ったり沖縄にいったりで日本全国制覇な感じです。両親同行。微妙に親孝行？

今日出発が48人。明日出発が50人くらい。飛行機落ちたら会社終わるな・・・。

写真に写ってるのはほぼ社員。わらわら。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 460
:date: 2007-05-25 23:59:24
:title: 首里城～ひめゆり～平和記念公園
:categories: ['trip']
:body type: text/x-rst
:body:
前回首里城に来たのは5年くらい前。前回は真夏だった気がするけど、今回は5月。梅雨の真っ最中だけあって、かなり蒸し暑い。ていうか湿度高すぎ。一緒に来た両親はかなり満足してくれたみたい。

次に行った、 **ひめゆりの塔** は思うところはあるもののそれほどのインパクトではなく。どちらかというとカーナビが田んぼのあぜ道に車を誘導してくれたのが印象的。これ以降カーナビ君の信用がた落ち。正しい道を案内しても誰も信じなかったり。

最後の **平和記念公園** がインパクトMax。戦没者の名前が彫られた石版が延々と並んでいる、というのはかなりインパクトがある光景だった。名前は沖縄以外の県やアメリカ・韓国もあり、いったい何人分くらいあるんだろう。こうやって目に見える形で並べられると、そのインパクトはかなりでかい。「うわっ‥‥」って感じ。戦争って‥‥


:extend type: text/html
:extend:


:trackbacks:
:trackback id: 2011-01-12.9612030523
:title: 犬山城
:blog name: 青春18切符で行く,日本の「城」巡り43
:url: http://oojijisun43.seesaa.net/article/171911439.html
:date: 2011-01-12 08:02:42
:body:
oojijisunです,青春18切符で行きます お城巡りを準備中です、参考になります。

%%%%%%%%%

:id: 461
:date: 2007-07-05 21:07:05
:title: 復帰
:categories: ['misc']
:body type: text/x-rst
:body:
某Zope3製品案件で2ヶ月ほど忙殺されていましたが、7/2に無事リリースを迎えたので、またぼちぼち更新して行こうと思います。

この2ヶ月ほど、一旦書けない状態になると色々書きたいことをちゃんと書く時間が取れなくて、ちょっとしたことも書けなくなる病にかかっていたような感じ。これもブロガーの壁？ [1]_ そんな感じで書けなかった、「はこだて未来大講義2007春まとめ」とか「沖縄社員旅行レポ」とか「今年もINTEROP出展」とか「ぱいそん温泉行けませんでした」とかは多分今後も書かれません。というかもう書けない。ということでここでまとめて書いちゃいます。

はこだて未来大
-------------
- 校舎がきれい。ガラス張りで、冬は冷気がガラス越しに入り込み、夏は温室のように暑くなるらしいです。住んでる人にとってはけっこう厳しい環境らしい。
- 講義して...
- 夜は飲み屋でちゃんちゃん焼き。鮭とキャベツの味噌炒め。豪快。

沖縄社員旅行
-----------
- 同伴OKとはいえ、両親を連れて行ったのは自分だけでした。
- 車の運転2年ぶり、3日間ぶっ通しで。さすがに疲れた。
- あちい。

INTEROP出展
-----------
- 某Zope3製品で出展。
- 幕張遠い。片道2時間半。
- Skypeの岩田さんが見に来てくれました。

ぱいそん温泉
-----------
- 某Zope3製品案件のリリース直前で、行けませんでした。
- 次は秋口にあるらしいので絶対参加してやる。


.. [1] `ブロガーの壁(その1) - ジョエル・ウィンフリー`_

.. _`ブロガーの壁(その1) - ジョエル・ウィンフリー`: http://www.aoky.net/articles/steve_yegge/bloggers_block_1_joelprah.htm


:extend type: text/html
:extend:


:comments:
:comment id: 2007-07-06.1584276722
:title: Re:復帰
:author: Anonymasarus User
:date: 2007-07-06 23:12:39
:email: 
:url: 
:body:
日本を北から南まですごいなぁ
今度会うときあったらお土産もらうっす

:comments:
:comment id: 2007-07-08.8683575292
:title: Re:復帰
:author: ロバート
:date: 2007-07-08 11:47:49
:email: rbh@neohawk.org
:url: http://www.neohawk.org/Members/rbh-ja/index_html/view?set_language=ja
:body:
おかえり。

沖縄か。いいな。

:trackbacks:
:trackback id: 2007-07-27.2983277948
:title: 北海道の鮭 鮭児は 最高ですね 鮭の食べ方いろいろあります 観光名所を回って温泉観光地などいろいろな料理がありますので是非食事をしてください 旨いです
:blog name: 北海道札幌から始まり全道の観光地、観光名所、市町村の情報紹介
:url: http://xn--djrs4x26g8vg460c.sblo.jp/article/4833599.html
:date: 2007-07-27 12:18:19
:body:
北海道の鮭は、庶民の味でもあります。鮭は、１ヶ月の食事のなかで、食卓にあがらないことはまずないというくらい北海道では食べられている魚です。ただし、鮭でもいろいろランクはあります。中でも鮭児という鮭の名前を聞いたことありますか。鮭児は、けいじと読みます。訛ってけんちと呼ばれることもあります。卵巣、精巣が未成熟であります。漁獲量は普通の鮭1万匹に対して1~2匹程度しかなく、幻の鮭といわれています。その身は大変に脂が乗っており（脂肪率が通常の鮭2~15%に対し鮭児は20~30%）本...

%%%%%%%%%

:id: 462
:date: 2007-07-07 19:50:19
:title: Plone2.5のRadius認証Plugin
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
PASRadius - Radius authentication plugin for PluggableAuthService ver 0.1 七夕リリース。

- `PASRadius-0.1.tgz`_　

Plone-JP のMLでPASのradius認証プラグイン無いねー、という話が出ていたので、PluggableAuthServiceの勉強がてらに作ってみました。

PluggableAuthServiceのコードはそれなりにzope3化されているので、Zope3を知っていればとても簡単、知らなくてもわかりやすいフレームワークに仕上がってる感じです。逆に、Zope2なコードを書くのは結構久しぶりだったので変なところではまりまくりました。どうして公開メソッドにはDocStringが必須なんだっけ‥‥（1時間くらい悩んだ）。

それにしても、PAS用RADIUSプラグインなんてもうあるんじゃないの？と思って検索してみても、ヒットするのは

1. PASを使うと簡単に認証を拡張できる
2. でもRADIUS用のpluginは今のところ無い
3. しょうがないからPlone2.1系を使う

という流ればっかりでした。RADIUSの需要が無いのか、認証系はバグがあるとアブナイのでだれも作りたがらないのか‥‥。需要という意味では、自宅のRADIUSサーバーも実際はLDAPに問い合わせしてるだけ。mpdというVPNサーバーがLDAP認証できないけどRADIUS認証出来るので、そのために立ち上げてるだけ。そういう意味ではPASRadiusを作ったものの、常用はしないだろうなあ‥‥。

参考: `PlonePASとPluggableAuthService — Garage with Blue Sky`_

.. _`PASRadius-0.1.tgz`: http://www.zope.org/Members/shimizukawa/PASRadius
.. _`PlonePASとPluggableAuthService — Garage with Blue Sky`: http://www.wedgeshape.com/wedge/gwbs/plonepas-pluggableauthservice


:extend type: text/html
:extend:
%%%%%%%%%

:id: 463
:date: 2007-07-13 13:24:57
:title: 色々わが家にやってきた
:categories: ['misc']
:body type: text/x-rst
:body:
先週末から昨日にかけて、いろいろな物がやってきました。

- ウォーターサーバー (コスモウォーター)
- イーモバイル D01NX (CFタイプ)
- AppleTV (40GB)
- ドラゴンクエストソード (Wii)

水は旨い。イーモバイルは速い。AppleTVはカコイイ。ドラクエ剣はまだ起動してない。
そんな感じ。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 464
:date: 2007-07-18 21:08:24
:title: スープカレーの店「うどん」（五反田）
:categories: ['food']
:body type: text/x-rst
:body:
仕事で五反田の某所に向かう途中で裏道を通ったらスパイスの良い香りのするスープカレーの店を発見。後で調べてみたら結構有名な店だった。

`かれーの店うどん`_

ホームページはエキセントリック。うどんは扱ってないようだ(笑)

食べたのは ``バジルポーク750円`` 。運んできた時に「スープを飲んでご飯を食べる、別々に食べる感じて食べてください」って教えてくれた。後で思ったけど、ご飯にかけちゃったら台無しな気がする。

カレーの辛さは鮮烈！飲み込むと熱の固まりが胃に流れていく感じ。そのあとご飯を食べると、後口が不思議と甘い。あとポークも甘い。

機会があったら是非もう一度行きたいな。

Webで見つけた関連ページ:

- `@nifty：デイリーポータルZ：かれーの店うどん`_
- `[を] 「うどん」という名のスープカレーの店（五反田）`_

.. _`かれーの店うどん`: http://www18.ocn.ne.jp/~c.udon/
.. _`[を] 「うどん」という名のスープカレーの店（五反田）`: http://chalow.net/2005-03-07-2.html
.. _`@nifty：デイリーポータルZ：かれーの店うどん`: http://portal.nifty.com/koneta04/11/24/02/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 467
:date: 2007-07-20 02:26:59
:title: TurboGearsのVirtualHost化ではまりまくる
:categories: ['python', 'turbogears']
:body type: text/x-rst
:body:
今日はTurboGearsのアプリをmod_proxyの陰で動かし、VirtualHostで任意のパス以下に配置しようとしてはまりまくってました。

たとえば http://example.com/myapp/ がTurboGearsアプリのルートになる場合、TurboGearsのプログラム上やテンプレート上には"myapp"は書かずに、cfgに ``server.webpath="myapp"`` と書けばそれでOK！...と思ってました。それでは、はまり度の軽い方から並べてみます。

  1. server.webpath="/myapp", base_url_filter.on = True をcfgに書く
  2. テンプレート内のパスは ${tg.url('/hoge')}のようにtg.urlでくるむ
  3. リダイレクトは turbogears.redirect('hoge') ではなく turbogears.redirect('/hoge')と書く

(1),(2)は基本、(3)は知らないと悩むことになりそう。redirect('hoge')だと http://example.com/hoge にリダイレクトされます。redirect('/hoge')ならちゃんと http://example.com/myapp/hoge にリダイレクトされます。

  4. base_url_filter.use_x_forwarded_host = False を明示的に指定する
  5. base_url_filter.base_url = "http://example.com/myapp" のようにmyappまで書く

(4),(5)は本当にこれで正しいのかアヤシイです。でもこうしないと http://example.com/myapp/hoge にアクセスしたときに http://example.com/hoge/ にリダイレクトされてしまいます。cherrypyはControllerオブジェクトにアクセスしたときはURL末尾に"/"が付くようにリダイレクトしようとします。しかし、リダイレクトのURL生成ではturbogearsのredirectやurl関数のようにmyappを考慮してくれません。この対処のため(4)で実サーバーURLの自動的検出をOFFにし、(5)でURLをmyapp付きで与えることにより、強制的にbase_urlを指定します。

いや、指定します、とか書いてますが、本当にこれでいいんだろうか‥‥。日英両方の文献を見てもこういう例が見あたらない気がします。みんなmod_pythonでやってて問題にならないからかな？

まとめ.

- prod.cfg

.. code-block:: XML

    server.webpath="/myapp"
    base_url_filter.on = True
    base_url_filter.use_x_forwarded_host = False
    base_url_filter.base_url = "http://example.com/myapp"

- httpd_tg.conf

.. code-block:: XML

  <VirtualHost *:80>
    ServerName example.com
    RewriteEngine On
    RewriteRule ^/myapp(/.*|$) http://localhost:8080$1 [P,L]
  </VirtualHost>

- 参考文献

  - `TurboGears1.0.2.2をmod_pythonで起動する - the technote`_
  - `SumiTomohikoの日記 - [TurboGears] redirect関数の引数にurl関数の戻り値を与えてはならない。`_
  - `turbogears   apache(mod_proxy) (yamakk blog)`_
  - `1.0/BehindApache - TurboGears Documentation`_

.. _`TurboGears1.0.2.2をmod_pythonで起動する - the technote`: http://luna.loop-net.co.jp/blog/htanaka/2007/06/22/1182448638466.html
.. _`SumiTomohikoの日記 - [TurboGears] redirect関数の引数にurl関数の戻り値を与えてはならない。`: http://d.hatena.ne.jp/SumiTomohiko/20070218/1171791817
.. _`turbogears   apache(mod_proxy) (yamakk blog)`: http://yamakk.infogami.com/blog/mod_proxy
.. _`1.0/BehindApache - TurboGears Documentation`: http://docs.turbogears.org/1.0/BehindApache


:extend type: text/html
:extend:
%%%%%%%%%

:id: 468
:date: 2007-07-20 03:13:05
:title: TurboGearsとCherryPyのリダイレクトについてもう少し
:categories: ['python', 'turbogears']
:body type: text/x-rst
:body:
いっこ前のエントリで謎な設定をしたらうまく動くようになった理由。

- CherryPy はコントローラオブジェクトへの末尾"/"無しアクセスは"/"ありにリダイレクトする

  - CherryPy-2.2.1-py2.4.egg/cherrypy/_cphttptools.py (297)

  .. code-block:: Python

                    # We found the extra ".index". Check if the original path
                    # had a trailing slash (otherwise, do a redirect).
                    if not objectpath.endswith('/'):
                        atoms = self.browser_url.split("?", 1)
                        newUrl = atoms.pop(0) + '/'
                        if atoms:
                            newUrl += "?" + atoms[0]
                        raise cherrypy.HTTPRedirect(newUrl)

末尾に"/"が無い場合に、self.browser_urlなるものを使ってリダイレクト先URLを構成している。このbrowser_urlは以下のように作成されている。

- CherryPy-2.2.1-py2.4.egg/cherrypy/_cphttptools.py (208)

.. code-block:: Python

    def _get_browser_url(self):
        url = self.base + self.path
        if self.query_string:
            url += '?' + self.query_string
        return url

で、self.base はmyappを含まない。self.pathも含んでいない。self.baseの生成は以下で行われている。

- CherryPy-2.2.1-py2.4.egg/cherrypy/filters/baseurlfilter.py

これは30行ほどの短いファイルなのですぐ読める。ここでbaseをhost名から生成しようとするので、cfgで自動生成をOffにして明示的に与えてやる。これで一応解決する。が、あくまでホスト名を生成するためのbase_url_filterを変な使い方して回避するのは腑に落ちない。

ここでvirtual_hostフィルターとかありそうだよなーと思ってcherrypy/filtersフォルダを眺めてみたらvirtualhostfilter.pyを発見。‥‥あれ？これでいけるんじゃないかな？


:extend type: text/html
:extend:
%%%%%%%%%

:id: 469
:date: 2007-07-21 23:59:36
:title: AppleTV
:categories: ['misc']
:body type: text/x-rst
:body:
先日わが家にやってきた `AppleTV`_ 。転職してフランスに行く田原さんと飲んだときに2000円で買い取りましたｗ。「買っては見たものの、自宅にワイドテレビがないから」と言って譲ってくれたんだけど、定価3万円くらいの未使用品に2000円は安すぎたか‥‥（すんませんすんません）。

で、譲ってもらったはいいけどAppleTVの出力はHDMIかコンポーネント。自宅にはHDMIはないのでコンポーネントをD端子に変換するケーブルをヨドバシから2000円で買ってきて接続‥‥、しようとおもったら空きがない。テレビのD端子入力は3つしかないのに、DVD, PSX, AvelLink, Wiiと4つもデバイスがある、ていうか足りてない。しかたないのでとりあえずPSXをS端子に切り替えてつないでみた。そろそろD端子とHDMI入力があるアンプを買うか‥‥。

AppleTVの機能
-------------
ムービー
~~~~~~~~~~~
再生できる動画ファイルがH.264, .m4v, .mp4, .mov。普段使ってないフォーマットばっかりだ。wmvとかaviとかDVDから簡単に変換するツールとかないかな‥‥。昔DVDとかDVHSから変換したことはあるけど手軽とは言えなかったしなあ。しばらく使うことはなさそう。

YouTube
~~~~~~~~~~~
見れる。でも検索がローマ字入力Onlyで日本語入力できない。しかも検索に引っかかる件数が異様に少ない。これは使うことはない気がする。

写真
~~~~~~~~~~~
PhotoShop Albumの写真も共有できる！すばらしい！ さっそく共有してみる。む‥‥サムネイル一覧とか無くて、スライドショーでしかみれないのか。じゃあスライドショーで‥‥うーん、自分のアルバムをテレビで見るのは恥ずかしいもんだな‥‥。ミュージック再生中のスクリーンセーバーにも設定できるらしいので早速やってみよう‥‥、はっ、‥‥はずかしすぎる！解除解除！これは危険な機能だ。封印。

ミュージック
~~~~~~~~~~~
すばらしい。iPodとほとんど同様の再生方法ができるだけで十分。再生中のスクリーンセーバーでは各曲に設定されているアートワークをランダムで表示してくれる。難としては、スクリーンセーバーモードにはいると再生中の曲タイトルも表示されないので、今何が再生されてるかわからないことか。曲の切り替わり時にはちょろっと表示されるんだけど。

そして一番気に入ったところは、AppleTV自身はiTunesのクライアントでありつつ、40GBものキャッシュがあるため、ホストとなるiTunesが起動して無くても曲を再生してくれるところ。自分のiTunesホストはノートPCにいるので常に起動してるとは限らない。すばらしい。

アートワーク
-------------
iTunesに登録している曲にはできるだけアートワークを設定していたんだけど、iPodで表示されればいいやと思ってかなり小さい画像を登録していた。１曲１曲のmp3ファイルに画像が同梱されるのであんまり大きな画像を登録したくなかったというのもある。が、それがテレビで大きく表示されると、ぼや～っとした画像になっちゃうわけですよ。さっきから2時間くらい「GoogleとAmazonで画像探し」「各アルバムに設定」をくりかえしてますよ。なんて言うかそんな暇あるのか、俺。画像探しながら見かけたCDをバスケットに入れたりしてるし‥‥。罠？

熱と電源
-------------
AppleTVはリモコンで電源Off(サスペンド)しても実は稼働しっぱなし。なので消費電力は多分一緒？常に熱いし。それだけならまだしも、ビデオ信号が止まらないのでテレビがサスペンドしてくれず真っ暗な画面が表示され続ける。最初の夜はそれに気づかずに朝までテレビが付きっぱなしだった。ファームウェアの更新で改善されることを期待したい。


.. _`AppleTV`: http://www.apple.com/jp/appletv/


:extend type: text/html
:extend:


:comments:
:comment id: 2007-07-24.3264303260
:title: Re:AppleTV
:author: しみずかわ
:date: 2007-07-24 08:45:27
:email: 
:url: 
:body:
フランス。先週火曜日に行っちゃった。

%%%%%%%%%

:id: 470
:date: 2007-07-25 18:00:00
:title: だまされた
:categories: ['misc']
:body type: text/x-rst
:body:
何気なくWindowsのデスクトップを見たら、 ``apatch`` というファイルが置いてあった。

あれ？アパッチ？あ、いや、綴りが間違ってる？

よく見たら、 ``a.patch`` だった。誰だよこんな名前付けたの！（オレオレ


:extend type: text/html
:extend:


:comments:
:comment id: 2007-07-30.9120165239
:title: Re:だまされた
:author: masaru
:date: 2007-07-30 19:38:33
:email: 
:url: 
:body:
誰だったか
よく考えず、関数名とか　tt() とかにしちゃって
後でハマって
部長に突っ込まれていた人がいたなぁ

%%%%%%%%%

:id: 471
:date: 2007-07-29 21:13:49
:title: 5年ぶりのカラオケ
:categories: ['misc']
:body type: text/x-rst
:body:
多分5年ぶり。Ricから突然誘われて行ってみたカラオケ。30分400円‥‥ってこんなに高かったっけ？ちなみに平日日中は50円。価格差ありすぎ。

で、店に入ったら画面付きリモコンがおいてあって、これで曲検索したり視聴したりできる！すげー。5年前はこんなの無かった気がする。マイクも5年前は有線だったが今は無線になってる。時代が変わったなあ‥‥テクノロジーも、金額も。

歌った曲は激しく非公開。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 472
:date: 2007-07-30 17:04:52
:title: 南与野に行くはずがなぜか大宮に着いた
:categories: ['misc']
:body type: text/x-rst
:body:
今日は仕事で南与野へ。池袋から快速に乗って、→武蔵浦和→与野本町→大宮。大宮は多分行き過ぎ。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 473
:date: 2007-08-02 00:57:17
:title: 深夜の緊急対応
:categories: ['work']
:body type: text/x-rst
:body:
- 0:06, お客さんからコールセンター経由で不具合の連絡が入り、緊急対応開始。
- 0:26, 問題を修正し、状況終了。apacheの設定ミス....ミスかな？ミスかも。
- 0:50, レポートを作成し、派生で見つかった問題をバグトラッカーに登録完了。

sshトンネルを使えば自宅で対応できる。e-Mobileがあれば実質どこからでも対応出来る。PCとケータイがあればAnyTime,AnyWhere対応できる。

うぐぅ。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-08-02.3968180096
:title: Re:深夜の緊急対応
:author: masaru
:date: 2007-08-02 19:43:17
:email: 
:url: 
:body:
会社が自宅ってこと？

:comments:
:comment id: 2007-08-03.6623704360
:title: Re:深夜の緊急対応
:author: しみずかわ
:date: 2007-08-03 11:04:22
:email: 
:url: 
:body:
> 会社が自宅ってこと？

そんなのやです。
%%%%%%%%%

:id: 474
:date: 2007-08-03 11:01:33
:title: Re: [Python] メソッドを一時的に変更する方法とその実例
:categories: ['python']
:body type: text/x-rst
:body:
- `SumiTomohikoの日記 - [Python] メソッドを一時的に変更する方法とその実例`_

おー、なるほど！ ``self.bar = self.baz`` としてもクラス属性が上書きされる訳じゃなくてインスタンスの属性に設定されるだけだから、あとで ``del self.bar`` すれば元のクラス属性のbarが使われるようになるのか！ということは、これはメソッドでなくても同じ事ができるね。

.. topic:: Python2.4
  :class: dos

  | In [1]: class Foo(object):
  |    ...:     bar = 1
  |    ...:
  | 
  | In [2]: f = Foo()
  | 
  | In [3]: f.bar
  | Out[3]: 1
  | 
  | In [4]: f.bar = 10
  | 
  | In [5]: f.bar
  | Out[5]: 10
  | 
  | In [6]: del f.bar
  | 
  | In [7]: f.bar
  | Out[7]: 1

ちなみに ``Foo.bar = 5`` とかするとクラス属性が書き換わる。

.. _`SumiTomohikoの日記 - [Python] メソッドを一時的に変更する方法とその実例`: http://d.hatena.ne.jp/SumiTomohiko/20070802/1186075455


:extend type: text/html
:extend:
%%%%%%%%%

:id: 475
:date: 2007-08-03 13:51:13
:title: 某宅配伝票問い合わせPHP
:categories: ['web']
:body type: text/x-rst
:body:
某宅配伝票問い合わせページのURLが以下のようになっていた。

  http://example.com/list.php?denpyo[0]=123456789

GETで配列指定してるんだけど、PHPだとこういう事が出来るのか‥‥というか安全なんだろうか？

ZopeだとDTMLで

.. code-block:: XML

  <input name="hoge:list" ...>
  <input name="hoge:list" ...>
  <input name="hoge:list" ...>

としておくと、各入力をリストにしてくれる仕組みがあるけど、上記のPHPのGETだと ``0`` というマジックナンバーが出現しているのが気になる。ググってみたらPHP関連のページで普通に紹介されてるなあ。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 476
:date: 2007-08-13 23:26:00
:title: Django勉強会 Disk 4 に参加します
:categories: ['python', 'django']
:body type: text/x-rst
:body:
`Disk 4 | Djangoと日本の仲間たち`_

.. _`Disk 4 | Djangoと日本の仲間たち`: http://www.djangoproject.jp/etude/4/

朝6時から3時間で満員になったらしい第4回勉強会。申し込んだのは9時ちょっと前なのでギリギリだったらしく。18番目。
参加申し込みしている方々がなんだかすごい人ばっかりに見える今日この頃。当日はサイボウズラボの写真をいっぱい撮ってこよ（違

当日までに最低限チュートリアルくらいはやっておきたい。そうだ、夏休みを取ってDjangoしよう。Django休暇。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 477
:date: 2007-08-17 20:47:46
:title: ラーメン 藍嶌（あおしま）調布
:categories: ['food']
:body type: text/x-rst
:body:
`藍嶌（あおしま）調布｜さすらいのラーメン道`_


今日は夏休みで一回休みです。別名Django休暇。

昨日、mixiの調布コミュでラーメンネタが出ていたのでGO君を誘って行ってみた。上記のリンク先にもあるように、平日夜7時にしてはお客さんが少なく、おじさん１人。食べてる間に後から２人やってきたけど、ちょっと客入りが少ないかもしれない。やっぱり立地の問題かなあ。

食べたのは、特製らーめん（太麺・醤油）900円 とエビスビール。壁のメニューにビンって書いてあった気がするけど出てきたのはエビスビールの500ml缶。居酒屋とかで瓶ビールが出てきても全然気にならないのに、缶ビールは気になる。なんでだろ？ビールの付け合わせのネギチャーシュー味玉は少量ながらうまかった。ラーメンのチャーシュー期待大。

ラーメンは最初、表面の油がちょっと気になったものの、魚ダシも臭すぎず塩加減も良い塩梅。地味に旨い。次に来たらつけ麺を食べてみたい。

店舗情報
--------
:最寄り駅: 京王線布田・調布
:住所: 東京都調布市布田2-24-3
:営業時間: 11:00～14:00, 17:00～20:00
:定休日: 火

.. iframe:: http://www.quikmaps.com/ext/41148?w=298&mh=252&t=1&ln=0&sn=0&zb=1&zs=0&d=1&it=1&icd=0&lat=35.65227488233256&lng=139.54660177230835&zl=16&mt=0
  :width: 300
  :height: 300


おまけ：自分が好きなラーメン
--------------------------

地味に旨い系
~~~~~~~~~~~
- `坂内`_ （調布）
- `藍嶌`_ （調布）

インパクトのある旨い系
~~~~~~~~~~~~~~~~~~~~
- `第一旭`_ （京都）
- `天下一品`_ （京都本店＞八幡山＞西新宿＝神田＞歌舞伎町＞神楽坂＞＞＞水道橋）

次点
~~~~~
- `たから家`_ （調布）
- `たけちゃんにぼしらーめんラーメン`_ （調布）

.. _`藍嶌（あおしま）調布｜さすらいのラーメン道`: http://p-38design.com/ramen/a-o/aoshima.html
.. _`藍嶌`: http://p-38design.com/ramen/a-o/aoshima.html
.. _`坂内`: http://www.mensyoku.co.jp/
.. _`天下一品`: http://www.tenkaippin.co.jp/pcindex.html
.. _`第一旭`: http://www.daiichiasahi.com/
.. _`たから家`: http://www5a.biglobe.ne.jp/~tacky/rdb/rdb-903-takaraya.htm
.. _`たけちゃんにぼしらーめんラーメン`: http://www.takenibo.com/


:extend type: text/html
:extend:


:comments:
:comment id: 2007-08-18.2625100736
:title: Re:ラーメン 藍嶌（あおしま）調布
:author: jack
:date: 2007-08-18 11:47:42
:email: 
:url: 
:body:
たけにぼ、駅前に移転してからたべたらそんなにうまく感じなかったです。慣れの問題か、場所の問題か、味の問題か？
缶はなんとなくガッカリ感があるには禿同。

調布経由で行き帰りすることがあればよってみます・・・が、なんとも中途半端な位置だなぁ(^^;;

:comments:
:comment id: 2007-08-18.0891934991
:title: Re:ラーメン 藍嶌（あおしま）調布
:author: しみずかわ
:date: 2007-08-18 12:18:09
:email: 
:url: 
:body:
たけにぼは移転直後にくらべて煮干し感が薄くなった気が。慣れちゃったのかな...。
藍嶌、どう考えても場所が微妙ｗ

:comments:
:comment id: 2007-08-21.9568591904
:title: Re:ラーメン 藍嶌（あおしま）調布
:author: zen
:date: 2007-08-21 22:45:58
:email: zen@zenich.com
:url: http://zenich.com
:body:
毎週のようにこの道を自転車で走っているのですが、

全く知りませんでした。

今度行ってみるっす！！

:comments:
:comment id: 2007-10-29.5747418764
:title: Re:ラーメン 藍嶌（あおしま）調布
:author: jack
:date: 2007-10-29 18:36:16
:email: 
:url: 
:body:
やっとたべてきましたよ！

普通にうまいとは思いましたが、どうにも場所が微妙(笑)
布田のほうが近い感じだし(知ってるからマイナーな東口から出たけど)。

個人的には、わざわざまた行くってほどではなかったです。場所の問題含めて。

:comments:
:comment id: 2007-10-31.6806526500
:title: Re:やっとたべてきましたよ！
:author: しみずかわ
:date: 2007-10-31 01:11:21
:email: 
:url: 
:body:
> 普通にうまいとは思いましたが、どうにも場所が微妙(笑)

うん(^^;;
北口のあたりにあったら時々行くかもしれないのに。もったいない。

:comments:
:comment id: 2007-12-28.4422298856
:title: Re:ラーメン 藍嶌（あおしま）調布
:author: たけ＠ちょうふ
:date: 2007-12-28 11:37:23
:email: 
:url: http://takeya.homeip.net/nucleus/
:body:
こんにちは。
調布関連のブログを書いております。
こちらのエントリにリンクを張らせていただきました。
もし不可でしたら、削除いたします。

いつも空いていて、待たなくてすむのはいいのですが、
人ごとながら大丈夫なのかと心配しています。
でも、ずいぶん続いていますから、ちゃんと成り立っているのでしょうね。
夜、早く閉まってしまうので、食べたいと思っても
うまく時間が合わないことが多かったです。

%%%%%%%%%

:id: 478
:date: 2007-08-18 18:54:50
:title: pywin32でSysTrayIcon
:categories: ['python']
:body type: text/x-rst
:body:
keyowrd: systray tasktray trayicon タスクトレイ トレイ アイコン. (自分でこのエントリを見つけやすいように追加 2008/11/18)

pythonでタスクトレイにアイコンを表示して常駐する処理を書くためにpywin32を使うと楽に出来るかな、と思いググってみたら、いきなり見つけてしまった。夏休みの自由研究、終ー了ー。

- `Small Values of Cool: Windows system tray icons with Python`_
- `SysTrayIcon.py`_ (ソースコード)

昔Cで書いたシステムトレイアイコン用Pythonモジュールを久しぶりに引っ張り出してきたものの、例外処理があまくて常用するのは危険な感じ。システムトレイ領域にファイルをドラッグアンドドロップ出来るようになってたり、意欲的というかちょっと危ないことをしているせいで、冷害が発生するとshellごと死ぬ。危ない。ビルドにVisualStudioが必要だったりするのも、ハードルが高いかも。

http://svn.freia.jp/open/trayicon/


.. _`Small Values of Cool: Windows system tray icons with Python`: http://www.brunningonline.net/simon/blog/archives/001835.html
.. _`SysTrayIcon.py`: http://www.brunningonline.net/simon/blog/archives/SysTrayIcon.py.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 479
:date: 2007-08-26 02:02:30
:title: Django勉強会DISC4に参加しました
:categories: ['python', 'django']
:body type: text/x-rst
:body:
場所
=====
- サイボウズラボ
- 赤坂見附
- プレデンシャルタワー
- 参加者30人くらい

プレゼンとか
-------------
他の人のBlogかLingrのDjango-ja見てね！（超手抜き）
というか動画が公開されるかも。

http://groups.google.com/group/django-ja/browse_thread/thread/21503c49b25256b6

質問とか
---------
:Pythonを仕事に使ってる人:
  10人くらい
:Djangoを仕事に使ってる人:
  4人くらい
:Mac率:
  半分くらい？
:年齢分布:
  高校生 １,
  大学生 ０,
  失業者 １,
  会社員 他全員
:djangoproject.jpを知ってますか:
  8割くらい知ってた
:newforms使ってますか:
  半々くらい


感想
-----
- oldforms は詳しく解説されなかったのであまり把握できなかったけど、 newforms はとても理解しやすい構造だった。これから使うとしたらnewforms以外ありえない！
- django.contrib.admin ステキすぎ
- 普段見てるBlogの人とかお世話になってるサイトの人とかに会えた！
- ueblogの中の人から `MOO`_ で作った名刺をもらった！俺も作ろうかな。。
- ウノウの中の人から `/dev/null Tシャツのサイト`_ を教えてもらった！買おうかな。。
- 今週リリースしたFlashで大富豪！ http://plash.jp/ Wiiで遊べる！
- 高校生Pythonista山岸さんキター！しかも偽名(違) 正字正かな、て。将来は書店の店員て！？
- amachang さんカッコエエ！
- サイボウズラボかっこええ！
- 次のDjango勉強会は高校の体育館に西尾さんデビュー！？


ところで、Model, Field, Form, Widget という分割は自分はとても理解しやすかった。今まで触った他のWebフレームワークが似た構成だったから。

:Django:
  Model, (Modelの)Field, (Formの)Field, Form, Widget

:Zope2(archetypes):
  Schema(=Model), Field, ContentType(=Form), Widget

:Zope3:
  Interface(=Model), Field, formlib.form_fields(=Form). Widget

:TurboGears:
  Model, Field, Form, Widget

FieldのプレゼンテーションレイヤーとなるWidgetはデフォルトでどれが使われるかが決まっていて、ある状況下で変更するためには密結合(Fieldの初期化で渡すとか)する必要があるところも似ている。Zope3はDIなのでもうちょっとだけ柔軟性が高いけど、設定のためにはXML書かないといけない。Django的に柔軟性をもたせるならurls.pyみたいな設定でFormとWidgetのデフォルトの対応を決められればいいのかな。このサイトではToscaWidgetセットを使う、とか、AJAXなWidgetセットを使う、とかごそっと切り替えられるとうれしい人もいるかも。


.. _`MOO`: http://www.moo.com/vox/
.. _`/dev/null Tシャツのサイト`: http://www.upsold.com/imshop/app/b/13614/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 480
:date: 2007-09-03 23:47:22
:title: Python.exeの使い方が誤っています
:categories: ['misc', 'python']
:body type: text/x-rst
:body:
最近仕事で忙殺されています。今日はRSS巡回する時間すら取れなかったし。

自分はWindowsなので、Windowsのbat経由でPythonなWebサーバーを呼び出すこともまあまああります。
そんなbatをCtrl+Cで止めたところ変なメッセージが。

.. topic:: Python.exe
  :class: dos

  | バッチ ジョブを終了しますか (Y/N)?
  | ^C^C^CC:\\Develop\\Python24\\python.exe の使い方が誤っています。
  |
  | C:\\> 

怒られちゃった・・・。

ついでなんで、某有名ネタ。

.. topic:: Python.exe
  :class: dos

  | C:\\>(\*´Д｀)ﾊｧﾊｧ
  | ﾊｧﾊｧ の使い方が誤っています。
  | 
  | C:\\>


:extend type: text/html
:extend:
%%%%%%%%%

:id: 481
:date: 2007-09-30 23:00:08
:title: 夏休みが欲しい
:categories: ['misc']
:body type: text/x-rst
:body:
そろそろ夏休みが欲しいなあと思いつつ気がつくともう9月も終わり。10月は何日か休もう。。
とりあえずPython温泉秋の陣に参加するための休暇は確保してるけど、他に1週間くらい休めないかな。無理かな。

休んだらゲームばっかりしてそうだけど。

今やりかけのゲーム:

- 英伝6-3
- オルタのフェイブル
- ドラクエソード


:extend type: text/html
:extend:


:comments:
:comment id: 2007-10-21.4347702051
:title: Re:夏休みが欲しい
:author: にわけん
:date: 2007-10-21 23:53:54
:email: 
:url: 
:body:
休みは正当な権利です。計画してすぱっとさっさと取らないとうやむやになりまっせ(´･ω･`)

%%%%%%%%%

:id: 482
:date: 2007-09-30 23:38:57
:title: Puttyごった煮版のpfwdでsshポートフォーワード
:categories: ['misc', 'Windows']
:body type: text/x-rst
:body:
社外から社内のネットワークにssh経由で接続することがとても多いので、puttyのsshトンネル機能を使っています。でも、トンネルを張るためにputtyのコンソールが一つ常に開いているというのが邪魔で、タスクトレイに常駐するsshトンネルツールないかなあと色々調べてみました。

- putty.exe:

  ここが出発点。トンネル出来るのはとても便利なんだけどコンソールが邪魔。

- `OpenSSH for Windows`_ :

  cygwinを利用したWindows用のOpenSSHサーバー。ssh接続するとcmd.exeを遠隔
  操作できる。Installer付きなのでセットアップは簡単。sshクライアントも
  付いてるけどDOS窓が邪魔。SSHサーバーにトンネル設定できれば
  解決なんだけど、sshdはあまり詳しくない。

  とりあえずこれはこれで便利なので何かの機会に利用しよう。
  (Unix Service for Windows のsshdは有料らしい？)

- plink.exe:

  putty付属のコンソール用sshクライアント。
  やっぱりDOS窓が邪魔なんだけど、よく考えると何かの子プロセスとして起動
  してやればDOS窓開かなくて済みそうな。。

- plinkw.exe:

  `PuTTY ごった煮版`_ のDOS窓のないplink. 本家にはない。
  WindowsアプリなんだけどWindow表示しないので、パラメータを指定して起動
  すると画面の邪魔にもならず良い感じ。終了とかどうするんだろ？
  
  ‥‥と思いきや、ネットワークが切断したらダイアログが出てきて、
  OK押したら終了してしまった。再接続機能が欲しいなあ。

- pfwd.exe:

  `PuTTY ごった煮版`_ のポートフォワードツール。本家にはない。
  タスクトレイに常駐してくれて、ネットワーク切断時には再接続してくれる。
  しかし、とても惜しいことに切断時にダイアログが出てきて、再接続に
  成功するか終了するまで消えない。邪魔。。。後一歩。
  
  ちなみにputty-0.59, 0.60ごった煮版のpfwdは再接続に失敗して終了する
  らしいので、0.58版で試してみました。


ここで取り得る選択肢は、「plinkあたりをタスクトレイ常駐するプログラムから
子プロセスとして呼び出して切断したら接続をリトライする」ようにするか、
「pfwd.exeを改造してダイアログ出さずにリトライする」ように改造する。

タスクトレイ常駐は `pywin32でSysTrayIcon`_ でネタだししたので、ちょっと
頑張れば出来そう。pfwdの改造はすぐ出来そう。うーむ。

.. _`OpenSSH for Windows`: http://sshwindows.sourceforge.net/
.. _`PuTTY ごった煮版`: http://yebisuya.dip.jp/Software/PuTTY/
.. _`pywin32でSysTrayIcon`: http://www.freia.jp/taka/blog/478


:extend type: text/html
:extend:
%%%%%%%%%

:id: 483
:date: 2007-10-01 00:09:56
:title: Puttyごった煮版のpfwdを改造して自動再接続
:categories: ['Programming', 'Windows']
:body type: text/x-rst
:body:
「pfwd.exeを改造してダイアログ出さずにリトライする」ように改造してみた。

1. Putty-0.58 ごった煮版を取得
2. ごった煮版のマニュアルに従って本家の0.58のソースを取得
3. ごった煮版同梱のpatchを本家0.58に適用
4. とりあえずbuildしてみる。

とりあえずここまでは成功。patch適用はFreeBSD上でやった。buildは `WindowsでFreeなCモジュールビルド環境`_ という環境。Python関係なくWindowsアプリのビルドが出来ますよ。

最後に以下の修正を行ってビルド。

.. code-block:: CPP

	--- putty58/windows/pfwd.c.orig	Sun Sep 30 23:50:28 2007
	+++ putty58/windows/pfwd.c	Sun Sep 30 23:46:45 2007
	@@ -762,11 +761,9 @@
	 	break;
	     case WM_DISCONNECTED:
	 	ChangeTrayIcon(hwnd, IDI_ICOND);
	-	if (DialogBox(m_hInst, MAKEINTRESOURCE(IDD_DISCONNECT), hwnd, DisconnectedProc) == IDOK) {
	-	    PostMessage(hwnd, WM_CONNECTING, 0, 0);
	-	}else{
	-	    SendMessage(hwnd, WM_CLOSE, 0, 0);
	-	}
	+	auto_connect_count++;
	+	Sleep(1000);
	+	PostMessage(hwnd, WM_CONNECTING, 0, 0);
	 	break;
	     case WM_CONNECTING:
	 	if (m_hThread == NULL) {

WindowMessage処理の中でSleepして大丈夫だったっけ...？ま、いっか。

これでネットワーク切断後も1秒間隔で延々と黙々と接続チャレンジするように
なった。

ついでに、切断時と接続時にバルーン表示するようにしてみたところ、激しく目障りだったのでバルーンは使わないようにしよう...。

.. code-block:: CPP

	--- putty58/windows/pfwd.c.orig	Sun Sep 30 23:50:28 2007
	+++ putty58/windows/pfwd.c	Sun Sep 30 23:56:39 2007
	@@ -1,6 +1,7 @@
	 /*
	  * PLink - a command-line (stdin/stdout) variant of PuTTY.
	  */
	+#define _WIN32_IE 0x0500
	 
	 #include <stdio.h>
	 #include <stdlib.h>
	@@ -644,6 +645,26 @@
	 	Shell_NotifyIcon(NIM_ADD, &nid);
	 }
	 
	+
	+static void UpdateBalloon( HWND hwnd, const char* pszTitle, const char *pszText, DWORD dwFlag, unsigned int uTimeout )
	+{
	+	static NOTIFYICONDATA nid = {
	+		sizeof nid,
	+		NULL,
	+		IDI_ICON,
	+	};
	+	return;
	+	nid.hWnd = hwnd;
	+
	+	nid.uFlags |= NIF_INFO;
	+	strncpy( nid.szInfo, pszText, 255 ); // 255 is specify by MSDN document.
	+	nid.uTimeout = uTimeout;
	+	strcpy( nid.szInfoTitle, pszTitle );
	+	nid.dwInfoFlags = dwFlag;
	+
	+	Shell_NotifyIcon( NIM_MODIFY, &nid );
	+}
	+
	 static void DelTrayIcon(HWND hwnd)
	 {
	     NOTIFYICONDATA nid = {
	@@ -758,15 +779,17 @@
	 	break;
	     case WM_CONNECTED:
	 	ChangeTrayIcon(hwnd, IDI_ICON);
	+	UpdateBalloon(hwnd, "pfwd", "Connected", NIIF_INFO, 1 );
	 	auto_connect_count = 0;
	 	break;
	     case WM_DISCONNECTED:
	 	ChangeTrayIcon(hwnd, IDI_ICOND);
	-	if (DialogBox(m_hInst, MAKEINTRESOURCE(IDD_DISCONNECT), hwnd, DisconnectedProc) == IDOK) {
	-	    PostMessage(hwnd, WM_CONNECTING, 0, 0);
	-	}else{
	-	    SendMessage(hwnd, WM_CLOSE, 0, 0);
	+	if (auto_connect_count == 0) {
	+	    UpdateBalloon(hwnd, "pfwd", "Disconnected", NIIF_WARNING, 1 );
	 	}
	+	auto_connect_count++;
	+	Sleep(1000);
	+	PostMessage(hwnd, WM_CONNECTING, 0, 0);
	 	break;
	     case WM_CONNECTING:
	 	if (m_hThread == NULL) {



.. _`WindowsでFreeなCモジュールビルド環境`: http://www.freia.jp/taka/memo/freevcbuild/


:extend type: text/html
:extend:


:comments:
:comment id: 2007-10-11.2421208264
:title: Re:Puttyごった煮版のpfwdを改造して自動再接続
:author: しみずかわ
:date: 2007-10-11 02:10:42
:email: 
:url: 
:body:
再接続を一定回数以上繰り返すとpfwdが落ちます。やっぱり手抜きは良くない。

:trackbacks:
:trackback id: 2007-10-01.9813608809
:title: [Django][Python][jQuery][CSS][その他]巡回
:blog name: 常山日記
:url: http://d.hatena.ne.jp/johzan/20071001/1191208935
:date: 2007-10-01 12:23:02
:body:
 Google Code: New: idjango これからに期待! :) videosoft Update: django-pantheon django-evolution deseb django-cms komercha clapton djangobrasil spini-portal django-generics Blog: [Django][django-registration] ユーザー認証をやってみる さくらインターネット

%%%%%%%%%

:id: 484
:date: 2007-10-11 02:09:37
:title: 5回線もあったインフラを整理中
:categories: ['misc', 'Memo', 'IT-PC']
:body type: text/x-rst
:body:
先日買ったemobileデータ通信カードで生きていけそうな気配がするので、これを機に回線とか契約とかを色々見直してみることに。気がつくと、物理回線が４つ、ISPアカウントが６つもあった。

- J:COM CATV Internet
- NTT東日本 Flet's ADSL
- ASAHI-NET Flet's ADSLのコース
- ASAHI-NET Flet's ADSLのコース
- Willcom AIR-EDGE ネット25 128kbps
- KCOM AIR-EDGE接続コース
- emobile

モバイル端末はemobile買った移行期なのでダブってるのは分かるとして、なぜ自宅回線が２つあったりADSL接続用のISPアカウントが２つあったりするのかよくわからない。しかもASAHI-NET片方アカウントIDすら忘れてるし。

ASAHI-NETに問い合わせたらIDとパスワードを郵送で送ってくれることになった。が、その直後にIDとパスワードが書かれた2年半前の郵便物を発見。orz

とりあえず、CATVインターネットは解約しようと思う。夜20時～24時くらいは重くて使い物にならない。

emobileが使えない場所での代替手段としてAIR-EDGEの契約を続けるのは、月々5000円くらい大変。かといってWillcom解約した場合、auの携帯電話を使った接続手段しか残されないが、携帯でインターネットするのは1MBあたり1000円くらい大変。自宅のADSLのISPアカウントでPIAFS接続が共有できるので、PIAFS専用データ通信カード（8000円）を買って月々1000円の支払いにすれば2ヶ月でペイできるかも。

ということで整理案。

解約

- J:COM CATV Internet
- ASAHI-NET Flet's ADSLのコース
- Willcom AIR-EDGE ネット25 128kbps
- KCOM AIR-EDGE接続コース

継続

- NTT東日本 Flet's ADSL
- ASAHI-NET Flet's ADSLのコース
- emobile

新規

- Willcom TWO-DATA Link (PIAFS専用, 接続先固定) 初期8000円, 月々1000円, 接続10円/分


これで月々1万円は経費が下がる計算。

さて、KCOMの契約者番号を問い合わせるかな...。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-10-12.1696800011
:title: Re:5回線もあったインフラを整理中
:author: 大海
:date: 2007-10-12 23:59:30
:email: 
:url: 
:body:
それはさすがに多すぎでしょう！＜5回線
通信費、かなり高そうですなぁ。

:comments:
:comment id: 2007-10-19.2639482886
:title: Re:5回線もあったインフラを整理中
:author: しみずかわ
:date: 2007-10-19 01:17:44
:email: 
:url: 
:body:
> 通信費、かなり高そうですなぁ。

使ってないCATVインターネット5000円は高い。
使ってないAirEdge128の5000円も高い。
書かなかったけど、PHS(通話用)の回線も１つ持ってた。

‥‥すげーな、俺。

:comments:
:comment id: 2007-10-21.2704412335
:title: Re:5回線もあったインフラを整理中
:author: にわけん
:date: 2007-10-21 23:51:11
:email: 
:url: 
:body:
E-Mobileは今の所都内地上部で不自由した事は無いですね。
固定IP等不要なら、ADSLもEアクにすればもっと安くなりそう。

:comments:
:comment id: 2007-10-22.5390267794
:title: Re:5回線もあったインフラを整理中
:author: しみずかわ
:date: 2007-10-22 00:28:59
:email: 
:url: 
:body:
> E-Mobileは今の所都内地上部で不自由した事は無いですね。

東京のけっこう西の方でも普通に使えますねー。
埼玉や神奈川でも大丈夫だったし。
あとは秋田で繋がれば・・・。

> 固定IP等不要なら、ADSLもEアクにすればもっと安くなりそう。

固定必要なんですよ。
このサーバーが自宅だし。
光入れたいなあ。15戸のマンションは一番入れにくいかも。
%%%%%%%%%

:id: 485
:date: 2007-10-25 01:13:53
:title: ソースコード探訪：turbogears.toolbox.shell.WebConsole
:categories: ['python', 'turbogears']
:body type: text/x-rst
:body:
`turbogears.toolbox.shell.WebConsole`_ クラスのコードを読む。
Web画面上でPython対話コンソール(InteractiveShell)を実現するためのサーバー側実装コードは100行無かった！こんなに短いとは‥‥。全ては code.InteractiveConsole クラスのお力か。

で、このコードを発展させて、自分でソケットを開いてリモート対話シェルを作ってみる。

.. code-block:: Python

    import sys
    import StringIO
    from code import InteractiveConsole
    import socket
    
    def init_ps():
        try:
            sys.ps1
        except AttributeError:
            sys.ps1 = '>>> '
        try:
            sys.ps2
        except AttributeError:
            sys.ps2 = '... '
    
    
    class RemoteConsole(object):
        """Remote Python interpreter"""
    
        def __init__(self):
            self.console = None
            init_ps()
    
        def process_request(self, line):
            more, output = self._process_request(line)
            return dict(more=more, output=output)
    
        def _process_request(self, line):
            myout = StringIO.StringIO()
            try:
                sys.stdout = myout
                sys.stderr = myout
                more = self.console.push(line)
            finally:
                sys.stdout = sys.__stdout__
                sys.stderr = sys.__stderr__
    
            output = myout.getvalue()
            return ( more, output.rstrip() )
    
        def new_console(self):
            locs = dict(__name__='RemoteConsole',
                        __doc__=None,
                        reload_console=self.new_console,
                        )
            self.console = InteractiveConsole(locals=locs)
    
        def connect(self):
            if not self.console:
                self.new_console()
    
        def disconnect(self):
            if self.console:
                self.console = None
    
    
    def server():
        rc = RemoteConsole()
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.bind(('',10000))
        s.listen(1)
        conn,addr=s.accept()
        rc.connect()
        while 1:
            data = conn.recv(1000000)
            #print 'r',len(data)
            ret = rc.process_request(data)
            ret = unicode(ret)
            #print 's',len(ret)
            conn.send(ret)
    
    
    def client():
        init_ps()
        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        s.connect(('localhost',10000))
        more = False
        while 1:
            data = raw_input(more and sys.ps2 or sys.ps1)
            if len(data) == 0:
                data = '\n'
            s.send(data)
            ret = s.recv(1000000)
            ret = eval(ret)
            output = ret.get('output')
            more = ret.get('more', False)
            if output:
                print output
    
    
    if __name__ == '__main__':
        if len(sys.argv) == 1:
            print 'Run as server'
            server()
        else:
            print 'Run as client'
            client()
    

ちょー適当だけど、とりあえず動くだけなら出来た。97行。

このコードをtestconsole.pyとして保存して実行してみる。

.. topic:: server起動
  :class: dos

  | C:\\> python2.4 testconsole.py
  | Run as server


.. topic:: client起動
  :class: dos

  | C:\\> python2.4 testconsole.py client
  | Run as client
  | >>> a=1
  | >>> b=2
  | >>> a+b
  | 3
  | >>> def foo(n):
  | ...   return n*n
  | ...
  | >>> foo(2)
  | 4
  | >>>

見た目分かりづらいけど、ネットワーク越しにPython対話シェルもどきが動いている。この先にあるのは、パクり元のWebConsoleのネットワーク版。

Pythonで書かれたサーバーにモニタリング用ポートを開けて、好きなタイミングでサーバー稼働中のPythonプロセスで対話シェルを操作できるようになる‥‥といいなあ。モデルの状態を見たり、メモリ利用状態の調査をしたり色々できるんじゃなかろうか。

.. _`turbogears.toolbox.shell.WebConsole`: http://svn.turbogears.org/tags/1.0.3.2/turbogears/toolbox/shell.py


:extend type: text/html
:extend:


:comments:
:comment id: 2007-10-25.3756648588
:title: Re:ソースコード探訪：turbogears.toolbox.shell.WebConsole
:author: aihatena
:date: 2007-10-25 23:59:35
:email: 
:url: http://edocs.beasys.co.jp/e-docs/wls/docs92/config_scripting/using_WLST.html
:body:
WLS9.x以降のWLSTもそんな感じやね。
Jythonで動いてリモートからJMX叩いて
値取り出したりメソッド実行したりできる。

%%%%%%%%%

:id: 486
:date: 2007-10-26 00:21:38
:title: コメント入力復活
:categories: ['misc']
:body type: text/x-rst
:body:
もういいや、って感じでコメントとトラックバックに非ASCIIを必須にしてみた → 各入力フィールドに非アスキー文字が必須になった orz

なおしました。

あー、 `常山日記`_ のトラックバック受付に失敗したー（涙


.. _`常山日記`: http://d.hatena.ne.jp/johzan/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 487
:date: 2007-10-26 00:21:44
:title: Python 温泉へ持って行く課題
:categories: ['python']
:body type: text/x-rst
:body:
`Python 温泉へ持って行く課題 - Twisted Mind`_

明日からPython温泉に行ってきます。ヘビ入り温泉。

ということで、俺課題。

- `PASRadius`_ のバグ報告もらったので修正する
- Pythonクックブックを読む（デバッグとメモリについて）
- twistedのリアクターを勉強する
- Webアプリ用のリモートコンソールを作ってみる

WingIDEを使えば良いんじゃまいか？というツッコミはスルーで。

.. _`Python 温泉へ持って行く課題 - Twisted Mind`: http://d.hatena.ne.jp/Voluntas/20071023/1193150740
.. _`PASRadius`: http://www.freia.jp/taka/blog/462


:extend type: text/html
:extend:
%%%%%%%%%

:id: 488
:date: 2007-10-27 23:18:22
:title: PASRadius-0.2 for PluggableAuthService(Zope/Plone)
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
PASRadius - Radius authentication plugin for PluggableAuthService ver 0.2 Python温泉リリース。

- `PASRadius-0.2`_　

Web投稿で以下のようなメッセージをもらった(原文は英語)。

.. Topic:: もらったメッセージ超訳

  Hi there, PASRadiusにemailアドレスが見つからなかったのでweb formから送るよ。
  PluggableAuthService(1.5-final)でPASRadius使うと、以下のエラーがでるよ：
  
    File "/home/faassen/working/instances210/RadiusZope/Products/PASRadius/radiusplu gin.py", line 26,
    in ? from Products.PluggableAuthService.utils import classImplements,Interface

    ImportError: cannot import Interface
  
  これはradiusplugin.pyを次のようにすれば簡単に修正できる：
  
  :元:
      from Products.PluggableAuthService.utils import classImplements, Interface
  
  :先:
      from Products.PluggableAuthService.utils import classImplements

      from zope.interface import Interface
  
  （classImplementsもzope.interfaceからimportすれば良いんじゃない？）
  この修正を行って新しい版をリリースしない？

ということで、Python温泉合宿タスクとして、直してみました。PAS-1.5対応。

classImplementsはPluggableAuthService.utilsで何かやってるので、まだ直接importするのは
避けた方がいいかなぁ、ということでそこはとりあえずtry/exceptでゴニョゴニョ。

# 半月放置ごめんなさい..

.. _`PASRadius-0.2`: http://www.zope.org/Members/shimizukawa/PASRadius



:extend type: text/html
:extend:
%%%%%%%%%

:id: 489
:date: 2007-10-28 01:55:13
:title: OP25b回避にGMailを利用 (on python)
:categories: ['python']
:body type: text/x-rst
:body:
Python温泉の成果2。

以前 `PloneのSMTP設定にGMailを指定`_ というネタを書きましたが、ソースコードをPython一般で使えるように抽出してみました。以下のサンプルはパスワードが含まれてるので、実用のためにはそのへんをゴニョっとする必要があります。

.. code-block:: Python

  #!/usr/local/bin/python
  # -*- coding: utf-8 -*-
  
  ID = 'xxxxxxx@gmail.com'
  PW = 'dummy'
  FROM = 'xxxxx@example.com'
  
  import smtplib
  
  def sendmail(toaddrs,subject,msg):
      if isinstance(toaddrs, basestring):
          toaddrs=[toaddrs]
      smtpserver = smtplib.SMTP('smtp.gmail.com',587)
      smtpserver.ehlo()
      smtpserver.starttls()
      smtpserver.ehlo()
      smtpserver.login(ID,PW)
  
      t=', '.join(toaddrs)
      msg='From: %s\nTo: %s\nSubject: %s\n\n%s' % (FROM,t,subject,msg)
      smtpserver.sendmail(FROM, toaddrs, msg)
      try:
          smtpserver.quit()
      except socket.sslerror,e:
          pass
  
  if __name__ == '__main__':
      sendmail('testaddr@example.com','subject','testmail')



.. _`PloneのSMTP設定にGMailを指定`: http://www.freia.jp/taka/blog/403?searchterm=gmail

:extend type: text/html
:extend:
%%%%%%%%%

:id: 490
:date: 2007-10-28 09:09:46
:title: WindowsXPのハードリンクは不安定？
:categories: ['misc', 'python', 'Windows']
:body type: text/x-rst
:body:
Python温泉の成果（文面だけ）。

Pythonにはファイルシステム操作関連機能としてハードリンクやシンボリックリンクを扱う機能があるが、この機能はプラットフォーム依存機能のため、利用できる環境はUnix系に限定されている。しかし、Windowsでも実はハードリンクを扱う機能は以前からAPI的には提供されていて、WindowsXPではコマンドラインでハードリンクを作成する機能が提供されている。

`＠IT：Windows XPの正体 強化されたコマンドライン・ツール（中編） 2．ディスク／ファイル関連ツール（2）`_ に載っているように、 ``fsutil hardlink create DEST SRC`` でファイルのハードリンクを作ることが出来る。

これをPythonで扱えるように以下のように書いてみた。

.. code-block:: Python

  # -*- coding: utf-8 -*-
  
  import os, sys, shutil
  
  WIN32_USE_HARDLINK = True
  
  if sys.platform == 'win32':
      def win32_hardlink(src, dest):
          args = [
              'fsutil',
              'hardlink',
              'create',
              dest,
              src,
          ]
          r = os.system(' '.join(args))
          if r:
              raise os.error(r, str(args), '%s -> %s' % (src, dest))
      if WIN32_USE_HARDLINK:
          link = win32_hardlink
      else:
          link = shutil.copyfile
  
  else:
      link = os.link
  

ついでにディレクトリをハードリンク的に扱う関数。

.. code-block:: Python
  
  def makedirs(d):
      if not os.path.exists(d):
          return os.makedirs(d)

  
  def lndir(srcdir, destdir):
      makedirs(destdir)
  
      for name in os.listdir(srcdir):
          srcpath = os.path.join(srcdir, name)
          destpath = os.path.join(destdir, name)
          if os.path.isdir(srcpath):
              lndir(srcpath, destpath)
          else:
              if os.path.exists(destpath):
                  os.remove(destpath)
              link(srcpath, destpath)
  

こんな感じで作って動かしてみたところ、なぜか安定動作してくれない。時々ハードリンクの作成に失敗してパーミッションエラーのコードが返ってくる。しょうがないのでWIN32_USE_HARDLINK=Falseにして使うことに。すごくイケテナイ。pyd作ったら安定動作するだろうか？


.. _`＠IT：Windows XPの正体 強化されたコマンドライン・ツール（中編） 2．ディスク／ファイル関連ツール（2）`: http://www.atmarkit.co.jp/fwin2k/xp_feature/013commandtool/commandtool3.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 491
:date: 2007-10-31 13:34:17
:title: さぬきのうどんや 曙橋
:categories: ['food']
:body type: text/x-rst
:body:
今日の昼ご飯。 `さぬきのうどんや`_ の冷やしぶっかけは、うどんの弾力が素晴らしい。生醤油で食べてみたい逸品。

.. iframe:: http://www.quikmaps.com/ext/46055?w=371&mh=303&t=1&ln=1&sn=0&zb=0&zs=1&d=1&it=1&icd=0&lat=35.692715800365356&lng=139.72186267375946&zl=19&mt=0
  :width: 373
  :height: 392


.. _`さぬきのうどんや`: http://ww2.et.tiki.ne.jp/~hatabou/s_sanuudo.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 492
:date: 2007-11-05 22:21:31
:title: ASP.NETに触れた日
:categories: ['Windows', 'web']
:body type: text/x-rst
:body:
仕事の都合でWindows20003のIIS上で動作する超簡単な動的ページを作ることになりました。Pythonで書くことも考えたんですが、PythonのCGIでハマる可能性を考えると、標準で使えるASP.NETで作るのが良いのかなと思いリファレンスを引きながら2時間くらいで作成。だがしかし。。。

- <asp:...> の使い方はあまりハマらない
- 変数の型宣言せずに代入しようとしてハマる
- "文字列".Split(...) の使い方にハマる
- 配列の最後の要素を取得しようとして val[-1] と書いてハマる
- Python的辞書を使いたくて探してハマる

ほとんどC#でハマってましたorz

しかし、色々と勉強になりました。
これを機に、各Webアプリプラットフォームの入門だけ一通りやってみたくなった今日この頃。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 493
:date: 2007-11-07 23:59:15
:title: 初めてのC#のコード in ASP.NET
:categories: ['Programming', 'web']
:body type: text/x-rst
:body:
先日のエントリ `ASP.NETに触れた日`_ で実際に以下のようなコードを書いた。

.. code-block:: XML

  <%@ PAGE LANGUAGE="C#" %>
  <html>
  <head>
  <script runat="server">
  char[] delimiter = new char [] {'\\'};
  void Page_Load(object sender, EventArgs e) {
    String user = Request.ServerVariables["REMOTE_USER"];
    String uid = "";
    foreach(string sub in user.Split(delimiter)){
      uid = sub;
    }
    UserName.Text = uid;
    if (uid=="user_a") {
       id1.Value = "aaa";
    }else if (uid=="user_b"){
       id1.Value = "bbb";
    }else if (uid=="user_c"){
       id1.Value = "ccc";
    }else if (uid=="user_d"){
       id1.Value = "ddd";
    }else{
       id1.Value = "other";
    }
  }
  </script>
  </head>
  <body>
    <p>ようこそ<strong><asp:Label id="UserName" runat="server"/></strong>さん</p>
  
    <form action="search" method="get">
      <input type="hidden" value="dummy" name="id1" id="id1" runat="server"/>
      <input type="text" name="query" id="query" />
      <input type="submit" value="検索" name="submit"/>
    </form>
  </body>
  </html>

これはひどい‥‥。

最初の頃のPythonコードはまだましだった気がする。 `サーバー生存確認PythonScript`_ このへんかな？


.. _`ASP.NETに触れた日`: http://www.freia.jp/taka/blog/492
.. _`サーバー生存確認PythonScript`: http://www.freia.jp/taka/blog/56


:extend type: text/html
:extend:
%%%%%%%%%

:id: 494
:date: 2007-11-09 22:39:29
:title: IISとファイルの暗号化ではまる
:categories: ['Windows', 'web']
:body type: text/x-rst
:body:
WindowsXPなどでファイルのプロパティーから ``内容を暗号化してデータをセキュリティで保護する`` よう設定できる。ノートPCのあるフォルダ以下はこの設定になっていて仕事関連のファイルを置いていたりするんだけど、ここで作成したindex.htmlをサーバーのWeb公開用フォルダに複製したら、暗号化設定付きのまま複製されたらしく、このindex.htmlファイルをWebブラウザで閲覧しようとするとブラウザの認証ダイアログが表示されてしまった。

まとめると、

1. IISで公開するファイルに暗号化設定する
2. このファイルにAnonymousでアクセスすると認証ダイアログが表示される

こうやってまとめてみると、アヤシイ閲覧者(Anonymous)に暗号化してあるファイルを見せない、という至極まっとうな現象なんだけど、自分としては **ノートPCからコピーしたファイルはIISで公開できない** という現象にしか見えなかったので、1時間くらい悩んでしまった。こういうのって、IIS使いの人には普通の事なのかなあ‥‥。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 495
:date: 2007-12-01 22:37:00
:title: AmazonのURLコピーするbookmarklet
:categories: ['javascript']
:body type: text/x-rst
:body:
最近のAmazonはURLに日本語が含まれていて、IMで渡しにくいので、短いURLに変換するブックマークレットを作ってみた。

promptをpopupする版(URLのみ)::

  javascript:var%20p=prompt('URL%20is...',location.href.replace(/.*\/([A-Z\d]{10})\/.*/,'http://www.amazon.co.jp/dp/$1'))

promptをpopupする版(タイトルとURL)::

  javascript:var%20p=prompt('URL%20is...',document.title.replace(/^\s+(.*)\s+$/,'$1')+"  "+location.href.replace(/.*\/([A-Z\d]{10})\/.*/,'http://www.amazon.co.jp/dp/$1'))


Windowsのクリップボードに渡す版(URLのみ)::

  javascript:(function(text){var swf_data = "http://www.freia.jp/taka/setClipboard.swf";var tmp = document.createElement("div");tmp.innerHTML = '<embed src="'+swf_data+'" FlashVars="code='+encodeURI(text)+'" width="0" height="0"></embed>';with(tmp.style){position ="absolute";left = "-10px";top  = "-10px";visibility = "hidden";};document.body.appendChild(tmp);setTimeout(function(){document.body.removeChild(tmp)},1000);})(location.href.replace(/.*\/([A-Z\d]{10})\/.*/,'http://www.amazon.co.jp/dp/$1'))

Windowsのクリップボードに渡す版(タイトルとURL)::

  javascript:(function(text){var swf_data = "http://www.freia.jp/taka/setClipboard.swf";var tmp = document.createElement("div");tmp.innerHTML = '<embed src="'+swf_data+'" FlashVars="code='+encodeURI(text)+'" width="0" height="0"></embed>';with(tmp.style){position ="absolute";left = "-10px";top  = "-10px";visibility = "hidden";};document.body.appendChild(tmp);setTimeout(function(){document.body.removeChild(tmp)},1000);})(document.title.replace(/^\s+(.*)\s+$/,'$1')+"\n"+location.href.replace(/.*\/([A-Z\d]{10})\/.*/,'http://www.amazon.co.jp/dp/$1'))


参考にしたサイト:

- `AmazonのURL - Vox`_

.. _`AmazonのURL - Vox`: http://takeshi.vox.com/library/post/amazon%E3%81%AEurl.html


:extend type: text/html
:extend:


:comments:
:comment id: 2008-12-17.3934052472
:title: Re:AmazonのURLコピーするbookmarklet
:author: big fat gay
:date: 2008-12-17 08:49:54
:email: gay@iggy-pop-gay.com
:url: http://iggy-pop-gay.com/map-of-gay-world/
:body:
Gay line dancing
<url>http://iggy-pop-gay.com/map-of-gay-world/|Map of gay world</url>

%%%%%%%%%

:id: 496
:date: 2007-12-02 23:23:30
:title: LDAP認証統合について後でまとめる
:categories: ['Unix']
:body type: text/x-rst
:body:
2004/7/31のZopeWeekend4で発表したときの資料を発見。この頃はまだRadius認証でWindowsのVPN接続というのはやってなかったようだ。年末あたり時間を作って、設定を書き出しておこう。



:extend type: text/html
:extend:
%%%%%%%%%

:id: 497
:date: 2007-12-03 22:20:44
:title: サイトのSSL証明書を更新
:categories: ['web']
:body type: text/x-rst
:body:
`www.rapidssl.com`_ で www.freia.jp のSSL証明書を更新。2年で$79.00。安いし、10分くらいで発行してくれるんだけど、残念ながら携帯用(特にau)には使えない。

しかしよく考えると管理画面メンテ用にしかSSL使ってないので、もったいない気がしてきた。

.. _`www.rapidssl.com`: http://www.rapidssl.com/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 498
:date: 2007-12-15 15:23:53
:title: 勝手に俺俺リファクタリング for やっつけスクリプト
:categories: ['python']
:body type: text/x-rst
:body:
気分転換に、知り合いのblogに載ってたPythonコードを勝手に俺俺リファクタリングしてみます。方針としては、動作を変えず、可読性を損なわず、で。自分ならこう書く、というくらいのものです。

- 元記事: `2007-12-14 - 倖せの迷う森`_

*# こういうの、* cookbook_ *か* `ja.doukaku.org`_ *にありそうだなあ。*

以下、元記事の課題と、俺俺リファクタリング。

.. _`2007-12-14 - 倖せの迷う森`: http://d.hatena.ne.jp/ocs/20071214#1197631241
.. _cookbook: http://aspn.activestate.com/ASPN/Python/Cookbook/
.. _`ja.doukaku.org`: http://ja.doukaku.org/


:extend type: text/x-rst
:extend:
.. Topic:: 課題

  指定したディレクトリをルートとして、このディレクトリ以下のすべての java ファイルに対して class のコメントを編集します。

変換元ファイル::

  /**
   * Action の基底クラスです。<br>
   * すべての Action は、このクラスを継承します。
   * 
   * @author foo
   */
  public abstract class BaseActionSupport extends ActionSupport {


変換先ファイル::

  /**
   * Action の基底クラスです。<br>
   * すべての Action は、このクラスを継承します。
   * 
   * @author foo
   * @version $Revision$
   * Copyright: (C) xxxxxxxxxx All Right Reserved.
   */
  public abstract class BaseActionSupport extends ActionSupport {


以下が元コード。

.. code-block:: Python
    
    # -*- coding: sjis -*-
    import shutil
    import os
    import time
    
    ### functions
    def search_author_tag(filename):
        cnt = 0
        mark = 0
        for line in file(filename, 'r'):
            cnt += 1
            if line.startswith(' * @author'):
                mark = cnt
        
        return mark
    
    def copy_file(filename, srcdir, destdir):
        if not srcdir.endswith('\\'):
            srcdir += '\\'
        if not destdir.endswith('\\'):
            destdir += '\\'
        
        shutil.copy2(srcdir + filename, destdir + filename)
        return destdir + filename
    
    def set_version():
        return ' * @version $Revision$'
    
    def set_copyright():
        return ' * Copyright: (C) xxxxxxxxxx All Right Reserved.'
    
    def append_comment(filepath, mark):
        reader = file(filepath, 'r')
        buf = ''
        cnt = 0
        for line in reader:
            cnt += 1
            buf += line
            if cnt == mark:
                buf += set_version() + '\n'
                buf += set_copyright() + '\n'
        reader.close()
        writer = file(filepath, 'w')
        writer.write(buf)
        writer.close()
    
    
    ### variables
    rootdir = 'D:\\all-in-one-eclipse\\workspace\\someproject\\src\\'
    backupdir_base = 'D:\\backup$date$\\'
    backupdir = backupdir_base.replace('$date$', time.strftime('%y%m%d_%H%M%S'))
    
    
    ### main
    for root, dirs, files in os.walk(rootdir):
        newdir = root.replace(rootdir, backupdir, 1)
        
        if not '\\CVS' in newdir:
            os.makedirs(newdir)
            print 'Create: ' + newdir
            
            for fileentry in files:
                if fileentry.endswith('.java'):
                    # copy
                    destpath = copy_file(fileentry, root, newdir)
                    print 'Copy: ' + root + '\\' + fileentry + ' -> ' + destpath
                    
                    # set doc-comment
                    marker = search_author_tag(destpath)
                    print 'Info: ' + destpath + ': line ' + str(marker) + ': ' + ' @author タグを検出しました。'
                    append_comment(destpath, marker)



以下が俺俺リファクタリングしたコード。OS依存を無くす、os.path.joinを使う、内包表記で.javaだけ抽出、インデントを減らす、''.join(list)で文字連結、...などなどやってみました。

.. code-block:: Python
    
    # -*- coding: sjis -*-
    import shutil, os, time
    
    ### functions
    def search_author_tag(filename):
        mark = 0
        for cnt,line in enumerate(file(filename, 'r')):
            if line.startswith(' * @author'):
                mark = cnt
        
        return mark
    
    def copy_file(filename, srcdir, destdir):
        src = os.path.join(srcdir, filename)
        dest = os.path.join(destdir, filename)
        shutil.copy2(src, dest)
        return dest
    
    def set_version():
        return ' * @version $Revision$'
    
    def set_copyright():
        return ' * Copyright: (C) xxxxxxxxxx All Right Reserved.'
    
    def append_comment(filepath, mark):
        reader = file(filepath, 'r')
        buf = []
        for cnt,line in enumerate(reader):
            buf.append(line)
            if cnt == mark:
                buf.append(set_version()+'\n')
                buf.append(set_copyright()+'\n')
        reader.close()
        writer = file(filepath, 'w')
        writer.write(''.join(buf))
        writer.close()
    
    
    ### main
    def main(rootdir, backupdir):
        for root, dirs, files in os.walk(rootdir):
            newdir = root.replace(rootdir, backupdir, 1)
            if os.sep + 'CVS' in newdir:
                continue
    
            os.makedirs(newdir)
            print 'Create:', newdir
    
            files = [x for x in files if x.endswith('.java')]
    
            for fileentry in files:
                # copy
                destpath = copy_file(fileentry, root, newdir)
                srcpath = os.path.join(root, fileentry)
                print 'Copy: %(srcpath)s -> %(destpath)s' % locals()
    
                # set doc-comment
                marker = search_author_tag(destpath)
                ln = marker+1
                print 'Info: %(destpath)s: line %(ln)d:' \
                      ' @author タグを検出しました。' % locals()
                append_comment(destpath, marker)
    
    
    ### variables
    ROOTDIR = r'D:\all-in-one-eclipse\workspace\someproject\src\'
    BACKUPDIR_BASE = r'D:\backup$date$\'
    BACKUPDIR = BACKUPDIR_BASE.replace('$date$',
                                       time.strftime('%y%m%d_%H%M%S'))
    
    if __name__ == '__main__':
        main(ROOTDIR, BACKUPDIR)


行数は変更前・後変わらず71行。速度向上とかは特にしていないので、仕事でこの修正コストが認められるかどうかは微妙。(UnitTestコードも無いしね...)



:comments:
:comment id: 2007-12-16.7985907926
:title: Re:勝手に俺俺リファクタリング for やっつけスクリプト
:author: ocs
:date: 2007-12-16 01:23:19
:email: 
:url: 
:body:
なるほどなるほど。勉強になります。

> こういうの、 cookbook か ja.doukaku.org にありそうだなあ。
どう書くorgに似たようなネタがあった気もします。
まぁ向こうのほうがお題はハイレベルですが。

%%%%%%%%%

:id: 499
:date: 2007-12-15 15:45:53
:title: 以前書いたLDAP関連のメモなど
:categories: ['ldap']
:body type: text/x-rst
:body:
以前書いたLDAP関連のメモなどを集めたぺージを作ってみました。Ploneはこういうアグリゲーションが手軽に出来るので便利。

http://www.freia.jp/taka/memo/ldap/



:extend type: text/html
:extend:
%%%%%%%%%

:id: 501
:date: 2007-12-15 16:44:54
:title: RADIUSって
:categories: ['Unix', 'ldap']
:body type: text/x-rst
:body:
`nakagamiさんのblogで言及`_ された！(ちょびっと)

ところで、RADIUSは通信（PPPとか、無線LANとか）の認証によく登場する気がする。逆に、Webの認証ではあんまり聞かないかも。そもそも自分はRADIUSのことをよく分かっていない...。自宅ではいちおうFreeRadiusサーバーが稼働しているけど、認証はLDAPにリレーしているだけ。なので、LDAP認証機能は無いけどRADIUS認証はある、というクライアントのためのアダプターにしか使ってない感じ。

せめてRADIUSの特徴やLDAPとの違いくらいは勉強しておくべきか...。

.. _`nakagamiさんのblogで言及`: http://blog.so-net.ne.jp/nakagami/2007-12-15-1


:extend type: text/html
:extend:


:comments:
:comment id: 2007-12-19.0423245305
:title: Re:RADIUSって
:author: nakagami
:date: 2007-12-19 16:40:43
:email: 
:url: 
:body:
>せめてRADIUSの特徴やLDAPとの違いくらいは勉強しておくべきか...。
本貸しますよ

%%%%%%%%%

:id: 500
:date: 2007-12-15 17:04:09
:title: LDAPのインストールと設定
:categories: ['ldap']
:body type: text/x-rst
:body:
openldapサーバーのインストールとかslapd.conf, 初期のldifの投入などは参考になるサイトがたくさんあるので、ここでは参考になりそうなサイトの紹介だけ。

- `LinuxでLDAPサーバを構築するには － ＠IT`_ FedoraCoreにインストール
- `2010-10-10 - Twisted Mind`_ 説明サイトリンクからインストールまで色々勉強されてます
- `【FreeBSD 5.3】OpenLDAP の設定`_ FreeBSDでログインまで


あと、自宅のLDAPサーバー構築メモが以下にあるけど、ちょっと古い＆sambaの認証データ保持のための手順も混在しているので、参考程度にどうぞ。

- http://www.freia.jp/taka/memo/wiki/LDAP

次のエントリからはLDAPそのものの設定とかについては省略しよう。

.. _`LinuxでLDAPサーバを構築するには － ＠IT`: http://www.atmarkit.co.jp/flinux/rensai/linuxtips/904ldapserver.html
.. _`2010-10-10 - Twisted Mind`: http://d.hatena.ne.jp/Voluntas/20101010
.. _`【FreeBSD 5.3】OpenLDAP の設定`: http://www.abk.nu/~nabe/document/openldap.htm


:extend type: text/html
:extend:
%%%%%%%%%

:id: 502
:date: 2007-12-16 00:53:39
:title: ワイズノットが民事再生手続開始
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
`スラッシュドット ジャパン | ワイズノットが民事再生手続開始`_ って！本名プレイ中につきコメントは自粛するが、オープンソースを掲げる会社に勤める身としては、色々と思うところ満載。


.. _`スラッシュドット ジャパン | ワイズノットが民事再生手続開始`: http://slashdot.jp/article.pl?sid=07/12/15/1414237


:extend type: text/html
:extend:
%%%%%%%%%

:id: 503
:date: 2007-12-16 18:37:40
:title: ノロウィルスの季節です
:categories: ['misc']
:body type: text/x-rst
:body:
みなさん、ナマモノ（特に海鮮）には気をつけましょう。

ちょうど１年前にノロで倒れた経験があるから免疫が出来てる、と思って油断してはいけません。今年は生もの食べてないのに似たような症状になりました。全然消化してくれないので昨日から水だけで生きてます。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-12-17.6955418455
:title: Re:ノロウィルスの季節です
:author: jack
:date: 2007-12-17 12:04:57
:email: 
:url: 
:body:
それはタイヘン・・・ヴィダーインゼリーでもポカリのお湯わりでもいいのでいくらかでも栄養を摂取しないと・・・

風邪引いてます。二週間以上経つのですが一向に寛解しません・・・

:comments:
:comment id: 2007-12-17.7452408031
:title: Re:ノロウィルスの季節です
:author: しみずかわ
:date: 2007-12-17 23:29:06
:email: 
:url: 
:body:
去年のノロの時に医者からもらった薬のおかげか、やっと栄養摂取できるようになったので、毎食ヨーグルト食べてます。でもまだ、5分以上立ってると嫌な感じの汗が出てきます。
%%%%%%%%%

:id: 504
:date: 2007-12-17 23:49:41
:title: SOAPpyでAmazonにアクセス
:categories: ['python']
:body type: text/x-rst
:body:
実は今までSOAPを実際に触ったことがありませんでした。今回ちょっと必要があったので勉強中です。
とりあえず `python soap` で検索して見つけたIBM developerWorksの記事に目を通します。

`Python Web Servicesデベロッパー: Python SOAPライブラリー`_

で、次にSOAPpyをインストール。先にfpconstが必要っぽいです。

.. topic:: install
  :class: dos

  | C> easy_install fpconst
  | C> wget http://nchc.dl.sourceforge.net/sourceforge/pywebsvcs/SOAPpy-0.12.0.tar.gz
  | C> tar zxf SOAPpy-0.12.0.tar.gz
  | C> cd SOAPpy-0.12.0
  | C> python setup.py install
 
インストール完了。

次に、SOAPpy-0.12.0.tar.gzに同梱されていたサンプルコードを色々試してみようと思ったのですが、サンプルコードが利用しているURLのほとんど(全て？)が閉鎖されてしまっていたので、Amazonを例にして試してみようと思います。

.. code-block:: Python

    >>> from SOAPpy import WSDL
    >>> proxy = WSDL.Proxy('http://soap.amazon.com/schemas3/AmazonWebServices.wsdl')
    >>> proxy.methods
    {u'ActorSearchRequest': <SOAPpy.wstools...>,
     u'AddShoppingCartItemsRequest': <SOAPpy.wstools...>,
     u'ArtistSearchRequest': <SOAPpy.wstools.WSDLTools...>,
     u'AsinSearchRequest': <SOAPpy.wstools.WSDLTools...>,
    ...

とりあえず、wsdlファイルからメソッドを取得することが出来ました。しかし、実際の呼び出しは次のようにうまくいきませんでした。

.. code-block:: Python

    >>> proxy.AsinSearchRequest()
    faultType: <Fault SOAP-ENV:Client:
    We encountered an error at our end while processing
    your request. Please try again: The request contains
    an invalid SOAP body.>

ううむ、引数に何を渡せば良いんだろう？WSDLには定義されてるんだろうけど、interactive shellで表示できると良いなあ‥‥、というところで、次回に続く。


.. _`Python Web Servicesデベロッパー: Python SOAPライブラリー`: http://www.ibm.com/developerworks/jp/webservices/library/ws-pyth5/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 505
:date: 2007-12-21 20:13:27
:title: SEOコンサルなサイト
:categories: ['web']
:body type: text/x-rst
:body:
「SEOに関する更に詳しい情報は 'こちら' から」と書かれていて、 ``こちら`` にリンクが張られているSEOコンサル会社のサイトを見かけた。

業務改善を提案する会社の業務が旧泰然としているというのはよくある話だけど、このリンクの話はワールドワイドに見えちゃってるので問題があるとおもう。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 506
:date: 2007-12-27 08:28:56
:title: Thinkpad 15th Anniversary
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`ThinkPad 15th Anniversary`_ なX61sを購入しました。11月末に申し込んで年内発送ということだったのですが、26日発送、27日到着というメールがとどきました。でも今日から一足早く秋田にいるので受け取れません‥‥。受け取りは年明けだなあ。

今のスペック(X40)からだいぶスペックがパワーアップするんだけど、Vistaへの乗り換えはそれなりに苦労しそうな予感。

.. _`ThinkPad 15th Anniversary`: http://www-06.ibm.com/jp/pc/awards/15th/


:extend type: text/html
:extend:


:comments:
:comment id: 2007-12-27.0393829282
:title: Re:Thinkpad 15th Anniversary
:author: masaru
:date: 2007-12-27 20:47:20
:email: 
:url: 
:body:
おお　おかえり！

%%%%%%%%%

:id: 507
:date: 2007-12-28 15:42:34
:title: 携帯、ヘッドホンは禁止　自転車の運転で新ルール
:categories: ['bicycle']
:body type: text/x-rst
:body:
`携帯、ヘッドホンは禁止 自転車の運転で新ルール - MSN産経ニュース`_

.. Topic:: 引用

  走行中の携帯電話、ヘッドホンステレオの使用禁止、保護者が幼児を乗せる際はヘルメット着用を
  義務付けることなどを盛り込んだ報告書をまとめた。

たしかに、自分もイヤホンを付けて自転車に乗ってると周りの音が聞こえにくくて怖かった覚えがある。
ヘルメットも車道を走るなら付けてないと結構怖いし。

そ　れ　よ　り　も。自転車専用レーンが欲しい。道路脇の排水の溝にハマってパンクするのはもう嫌‥‥。自転車専用チューブでもいいな。

`Velo-City：空中を走る自転車用チューブウェイ - Engadget Japanese`_


.. _`携帯、ヘッドホンは禁止 自転車の運転で新ルール - MSN産経ニュース`: http://sankei.jp.msn.com/affairs/disaster/071227/dst0712271214008-n1.htm
.. _`Velo-City：空中を走る自転車用チューブウェイ - Engadget Japanese`: http://japanese.engadget.com/2006/01/30/velo-city/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 508
:date: 2007-12-28 19:34:30
:title: SOAPpyでAmazonにアクセス その2
:categories: ['python']
:body type: text/x-rst
:body:
`SOAPpyでAmazonにアクセス`_ の続き。

とりあえず分かったのは、提供されているメソッドに対して渡すパラメータはキーワード引数ではなく辞書で渡す必要があると言うこと。前回の記事のあとキーワード引数でなんどか試していて、正しそうなRequestが出ているもののレスポンスがエラーばっかりだった。

この違いはSOAPpyのドキュメントを読んでいてもなかなか気づかなかった。よくよく読むと SOAPpy-0.12.0/docs/MethodParameterNaming.txt に言及があるんだけど、自分は以下のサイトのコードを参考にしてやっと気づきましたよ。

- `ふってぃろぐ - PythonでSOAP版Amazon Web Service`_


実際にやってみると、キーワード引数の場合は以下のようにエラーになる。

.. code-block:: Python

    >>> from SOAPpy import WSDL
    >>> proxy = WSDL.Proxy('http://soap.amazon.com/schemas3/AmazonWebServices.wsdl')
    >>> results = proxy.KeywordSearchRequest(keyword='python',
    ...                                      page='1',
    ...                                      mode='books-jp',
    ...                                      locale='jp',
    ...                                      type='lite',
    ...                                      tag='freiaweb-22',
    ...                                      devtag='D2XXXXXXXXXXX')
    ...
    Traceback...
    ...
    SOAPpy.Types.faultType: <Fault SOAP-ENV:Client: We encountered an error at
    our end while processing your request. Please try again
    : The request contains an invalid SOAP body.>
    >>>

以下は辞書渡しにしたらうまくいった例。

.. code-block:: Python

    >>> from SOAPpy import WSDL
    >>> proxy = WSDL.Proxy('http://soap.amazon.com/schemas3/AmazonWebServices.wsdl')
    >>> results = proxy.KeywordSearchRequest(dict(keyword='python',
    ...                                           page='1',
    ...                                           mode='books-jp',
    ...                                           locale='jp',
    ...                                           type='lite',
    ...                                           tag='freiaweb-22',
    ...                                           devtag='D2XXXXXXXXXXX'))
    ...
    >>> results.TotalPages
    '3'
    >>> results.TotalResults
    '27'
    >>> book0 = results.Details[0]
    >>> book0.Asin
    '4797341815'
    >>> book0.ProductName
    u'\xe3\x81\xbf\xe3\x82\x93\xe3\x81\xaa\xe3\x81\xaePython Web\xe3\x82\xa2\xe3
    \x83\x97\xe3\x83\xaa\xe7\xb7\xa8 [\xe3\x81\xbf\xe3\x82\x93\xe3\x81\xaa\xe3
    \x81\xae\xe3\x82\xb7\xe3\x83\xaa\xe3\x83\xbc\xe3\x82\xba]'

ここで、ProductNameがへんな事になっている。中身はutf-8なのにu'...'になっていてうまく扱うことができない。とりあえず以下のようにして表示。

.. code-block:: Python

    >>> print ''.join([chr(ord(x)) for x in book0.ProductName]).decode('utf-8')
    みんなのPython Webアプリ編 [みんなのシリーズ]

はて、コレを直すにはどうすればよいのだろうか...。SOAPpyが xml.sax でparseするときに正しくなるようにする方法があるのかなあ。

ところで、proxy.KeywordSearchRequestはうまくいくようになったけど、proxy.AsinSearchRequestはまだうまくいかない。何故だ！？

.. _`SOAPpyでAmazonにアクセス`: http://www.freia.jp/taka/blog/504/edit
.. _`ふってぃろぐ - PythonでSOAP版Amazon Web Service`: http://sun.ap.teacup.com/futot/21.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 509
:date: 2007-12-30 23:54:29
:title: DIGA DMR-XP11
:categories: ['misc']
:body type: text/x-rst
:body:
この冬休みは実家秋田に帰ってきています。

母にビデオデッキが壊れたと相談を受けたので、 `DIGA DMR-XP11`_ を買ってあげました（父と弟から1万円ずつ徴収したんだけど）。これで実家も地上波デジタル対応だぜ、と思いつつ自分が使っているPSXと機能比較をしてみた。

DIGAの長所(PSXとの比較):

- 番組表が新聞のテレビ欄ぽくてよい。
- 地上波デジタルに対応している
- SDメモリのスロットがある

DIGAの短所(PSXとの比較):

- 地上波デジタルチャンネルの録画中は他チャンネル視聴できず
- DRモード(ストリーム直接保存)以外だと追っかけ再生出来ない
- リモコンが分かりにくい(録画停止と再生停止が共用って・・・)
- 特定の操作が画面には表示されない(本体の7segに頼っている)
- 録画の再生中に早送り等すると全体のどのへんを観てるかわからない
- チャンネル切り替え時の反応が遅い(地上波デジタルだから?)
- チャンネル切り替え時にどのチャンネルか画面表示してくれ！
- 30秒スキップを押すと一気に30秒後に移動する(経過が見えない)
- 15秒スキップが欲しい
- 全体的にUIが分かりにくい

こういった短所はどうなんだろう。うちの両親に教えるにはなかなか難しいUIのような気がする。自分が持ってるPSXのクロスバーメニュー(XMB)も癖のあるUIだけどDIGAに比べたらPSXの方がわかりやすくて全然ましなような気がする。しかも実家のテレビ台には布のカバーが掛けてあって7segが見えないので、一部の操作が7segが見えないのは致命的なのかもしれない。ていうかリモコンよく効いてるな‥‥。

ということでHDDレコーダのUIについてまとめ。

- UIは全てTV画面に集中すべし(本体の7segいらぬ)
- 全ての操作の結果は画面に表示すべし
- リモコンのボタンを兼用すべからず

`DIGA DMR-XP11`_ は民生品として見てもPSXに勝てないんじゃないかと思った年末であった。UIって大事だね。

*# ビデオデッキとの比較？既存のテープは見れないね...*

.. _`DIGA DMR-XP11`: http://ctlg.national.jp/product/info.do?pg=04&hb=DMR-XP11


:extend type: text/html
:extend:
%%%%%%%%%

:id: 510
:date: 2007-12-31 14:57:16
:title: Oracle10gをWindowsに入れてみる
:categories: ['Memo', 'database']
:body type: text/x-rst
:body:
Oracle10gは開発や評価用に無料で使用することが出来るので、WindowsXPなノートPCに入れてみた。

インストーラを入手する
--------------------

インストーラはOTN(Oracle Technology Network)から入手できるけど、なぜか `日本語のOTNサイト`_ では入手できないらしいので `英語のOTNサイト`_ から入手することにします。英語サイトからダウンロードするためには無料のアカウント登録が必要です。ところで、OperaだとなぜかBASIC認証が表示されてしまい、取得したID/PWを入れてもだめだったので、IE7でダウンロードしました。

Googleで検索すると、英語サイトでなら無料で入手できる、という話はほとんど見つからない。けっこう有名な話だと思ってたんだけどなあ。

.. _`日本語のOTNサイト`: http://otn.oracle.co.jp/software/products/database/#db10g
.. _`英語のOTNサイト`: http://www.oracle.com/technology/software/products/database/index.html


インストールする
---------------

ダウンロードした 10201_database_win32.zip を展開してsetup.exeを実行すると初期インスタンスの作成まで行ってくれます。が、今までOracleを触ったことがなかったので、いろんな用語がよくわからない。インスタンスとサービスとSIDとあとなんだっけ？SIDって何？とりあえず実験用なのでそのへんよくわかんなくてもまあいいか。

:port: 1521
:SID: testdb
:共通PW: test


ユーザーを追加する
-----------------

インストール後に、スタートメニューからSQLPlusを起動して、Databaseに接続します。

:ユーザー名: system
:パスワード: test
:ホスト文字列: (空白)

ホスト文字列って何だろう。とりあえず空白でよいらしい。ユーザー名 system はインストール時に必ず用意される物らしい。ログインしたら以下のコマンドで通常利用用のユーザーを追加する::

  create user foo identified by foopw;
  grant connect, resource to foo;

grantで何を許可するのが一番良いのかまだよく分かってないけど、fooユーザーがこれでテーブル作成等もできるので良いことにしておく。多分ちゃんと仕事で使うためにはこんなんじゃ駄目だと思うけど。


DBを使う
--------

まだ繋いでないので何とも。Pythonから使うにはcxOracleかな。

マニュアルを読む
---------------

森の中のようだ‥‥。なかなか目的の情報にたどり着けないし、今どの辺を読んでるのかも分からなくなってきた。

- `OTN Japan - ドキュメント : Oracle Database 10g`_


.. _`OTN Japan - ドキュメント : Oracle Database 10g`: http://otn.oracle.co.jp/document/products/oracle10g/


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-01.4001269165
:title: Re:Oracle10gをWindowsに入れてみる
:author: ocs
:date: 2008-01-01 00:03:21
:email: 
:url: 
:body:
＞ホスト文字列
別ホストのOracleインスタンスに繋ぎにいく時に使います。

＞grantで何を許可するのが一番良いのか
とりあえず connect, resource だけで良いんじゃないですかね。

＞ドキュメント
Oracleのドキュメントは分かりにくいですよ。。。
どれ読めばいいのかも良く分からないですし。

自分は、リファレンスとして使うことがほとんどだった気がします。

:comments:
:comment id: 2008-01-01.1920506749
:title: Re:Oracle10gをWindowsに入れてみる
:author: しみずかわ
:date: 2008-01-01 10:49:53
:email: 
:url: 
:body:
> ocsさん

おお、わざわざフォローどうもです。あのドキュメントで迷子になるのが自分だけじゃないというのが分かって安心しましたｗ

%%%%%%%%%

:id: 511
:date: 2007-12-31 21:01:08
:title: ちゃんとした会社に入ってないから
:categories: ['misc']
:body type: text/x-rst
:body:
年末実家に帰ってから、両親にことある毎に **ちゃんとした会社に入ってないから...** と言われるのは正直たまらん。仕事のストレスなんか比べ物にならんな、これは‥‥。


:extend type: text/html
:extend:


:comments:
:comment id: 2007-12-31.8478125747
:title: Re:ちゃんとした会社に入ってないから
:author: koma2
:date: 2007-12-31 23:20:48
:email: koma2@lovepeers.org
:url: http://bloghome.lovepeers.org/daymemo2/
:body:
ま、事実だし。ｗ＞ちゃんとした会社に入ってない

そのうち、見合い・結婚話との合わせ技が…(ry

%%%%%%%%%

:id: 512
:date: 2007-12-31 21:15:30
:title: 年越しZope-2.11.0-b1
:categories: ['Zope']
:body type: text/structured
:body:
12月28日に "Zope-2.11.0-b1":http://www.zope.org/Products/Zope/2.11.0b1 (β1)がリリースされました。ということで、CHANGELOG.txt を翻訳してみました。MailHostの実装変更はjaMailHostあたりに影響がありそうな気がします(未確認)。

Zope-2.11.0-b1の概要

  - 最新のZopeコンポーネント(Zope-3.4.0)を組み込んでいます

  - BLOB(binary large objects)に対応したZODB 3.8にアップデートしました

  - トランザクション対応のMailHost実装に対応し、非同期でメール送信を行うようになりました



:extend type: text/structured
:extend:
Zope-2.11.0-b1の変更点

  再構築(Restructuring)

    - メソッド manage_afterAdd, manage_beforeDelete, manage_afterClone の
      deprecation警告をdiscouraged警告に変更した。これらのメソッドは
      Zope2.11では削除されないことになったが、近い将来無くなるだろう。イベ
      ントの仕組みを使うことを強く推奨する。

    - 2つの宣言の実装をFiveから実クラスへ移動した。

    - Document.sequence: zope.sequencesort に置き換えた。

    - 全てのProductsフォルダ(zopeやzope.appフォルダ)はsetuptools名前空間パ
      ッケージで定義されるようになった。詳しくは以下のURLを参照。
      http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages

    - ZPT: ZPT警告の画面表示を削除。zope.pagetemplateの実装から削除されたた
      め。

    - パッチ当て版ではない標準のdocutils 0.4 をZopeに同梱した。Both 
      trusted and untrusted code are stillprotected against unwanted file 
      inclusion.

    - ZGadflyDA を削除した(Zope 2.9からdeprecated)。コードは以下から取得可
      能。 http://svn.zope.org/Products.ZGadflyDA

    - OFS.content_types を削除した(Zope 2.9からdeprecated)。

    - zLOGのdeprecatedを解除。まだ後方互換性のために必要。(which will 
      remain a backward-compatibilityshim for the Python logging module.)

    - Indexes: 使用されていないパラメータを '_apply_index' メソッドから削除

    - '__ac_permissions__' と 'meta_types' 属性によるプロダクトの初期化の素
      賞されないサポートを削除。

    - reStructuredText/ZReST: セキュリティー上の理由により、raw_enabled を
       0 に設定。

    - OFS Image: 画像とファイルでisinstance(data, str)を使うように更新し、
      unicodeオブジェクトに遭遇した場合はTypeErrorをraiseするようにした。

    - OFS Application: deprecation warnings (推奨しないことを表す警告) を更
      新した。 '__ac_permissions__' と 'meta_types' サポートをZope 2.11で削
      除し、 'methods' サポートはまだ残す。


  機能追加(Features added)

    - Zope2 startup: ZopeはDatabaseOpendとProcessStartingイベントを起動時に
      送るようになった。

    - Testing.ZopeTestCase: "ZopeLite" テストレイヤーを導入した。これはZTC
      と非ZTCテストをより手軽に混在させることが可能とする。

    - Testing/custom_zodb.py: DemoStorage以外のストレージ使用のサポートを追
      加した。FileStorageは $TEST_FILESTORAGE環境変数によってカスタム
      Data.fsをマウントできる。ZEOサーバーは$TEST_ZEO_HOSTと$TEST_ZEO_PORT
      環境変数で設定できる。この新しい機能により、標準のZopeテストランナー
      で既存のZopeインストール環境のためのテストを書き、実行することが出来
      るようになる。

    - ZPublisherのHTTPリクエストに、Zope3に相当するdebugとlocaleの属性を持
      つようになった。debug属性は今までのところ、Zope3 ZPTエンジンを働かせ
      るようにzope.*名前空間からコードに制限されました。locale属性は
      zope.i18n.interfaces.locales.ILocaleオブジェクトへの、localeに関連し
      た情報(日時のフォーマット情報、言語変換、国名など)付きでのアクセスを
      提供する。Form variables of both debug and locale will shadow
      these two attributes and their use is therefor discouraged.

    - MailHost: メールの配信にzope.sendmailを使うようになりました。これによ
      り、MailHostがZopeのトランザクションシステム(コンフリクトエラーでの送
      信emailの複製を除く)に対応しました。追加で、MailHostが非同期メール配
      信サポートに対応しました。 'Use queue' コンフィグオプションにより、フ
      ァイルシステム上に('Queue directory' 以下に)メールキューが作成され、
      queueスレッドが起動し3秒ごとにqueueをチェックします。これにより、メー
      ル送信時の衝撃を吸収します。また、MailHostにTLS/SSLによる暗号通信サポ
      ートが追加されました。

    - ZODB 3.8 にインテグレートしました(BLOBサポート対応)
  
    - 最新の Zope3 コンポーネントをインテグレート(Zope 3.4)

    - Windowsでzopectlを使えるようになりました。全てのコマンドがサポートさ
      れています。また、Windows専用に2つのコマンド install と remove が追加
      されています。これらはWindows Serviceへの登録と解除を行います。
      start, stop, restart の各コマンドはWindowsサービスを操作します。これ
      らのコマンドを使用する前に 'bin\zopectl install' を一度行う必要があり
      ます。

    - ZCatalog の返値となるobject (catalog brains) は
      ZCatalog.interfaces.ICatalogBrains インターフェースを持つようになりま
      した。

    - 新しいモジュール, AccessControl.requestmethod は一つのリクエスト利用
      にのみメソッドの利用を制限するデコレータファクトリーを提供します。例
      えば、メソッドを @requestmethod("POST") のようにマーキングすると、
      publish時にPOSTリクエストでのみ利用できるよう制限されます。いくつかの
      セキュリティーに関連したメソッドはPOSTのみに制限されます。

    - PythonScripts: Pythonのsetsモジュールを使えるようになりました。

    - 'fast_listen' ディレクティブをetc/zope.confの http-server と 
      webdav-source-server セクションに追加しました。これにより、起動フェー
      ズでソケットを開く順番を遅らせます。これはZopeがロードバランサーの背
      後で動作している場合などの特定の状況で使用します。(patch by Patrick 
      Gerken)

    - ZopePageTemplate の内部実装にunicodeを使用するようにしました。非
      unicodeインスタンスはon-the-flyでunicodeに変換されます。ところでこれ
      が正しく働くのはZPTインスタンスがutf-8かISO-8859-15でエンコードされて
      いる場合のみです。他のエンコーディングの場合は、環境変数
      ZPT_REFERRED_ENCODING の値のutf-8とISO-8859-15の前に使用するエンコー
      ディングを設定してください。

      'output_encodings' プロパティーが、WebDAV/FTP操作での各エンコーディン
      グとunicodeとの相互変換をコントロールします。

    - ZPTの実装はUnicodeDecodeError時の振る舞いについてコンフィグ出来るよう
      になりました。カスタム UnicodeEncodingConflictResolver をZCMLで設定す
      ることが出来ます。詳しくは Products/PageTemplates/(configure.zcml, 
      unicodeconflictresolver.py, interfaces.py) を参照のこと。

    - AccessControl.Role: 新しいメソッド 
      manage_getUserRolesAndPermissions() が追加されました。

    - AccessControl: "Security" タブのフォームに新しくユーザーに関連したパ
      ーミッションとロールのフォームを追加しました。

    - Zope 3 ベースの、Zopeが起こしたいくつかの例外のための例外viewをZCMLで
      登録できるようになりました。例外Viewを以下のように登録できます::

        <browser:page
          for="zope.publisher.interfaces.INotFound"
          class=".view.SomeView"
          name="index.html"
          permission="zope.Public" />

      これに関連する、Viewを持っている例外は:

      - zope.interface.common.interfaces.IException

      - zope.publisher.interfaces.INotFound

      - zope.security.interfaces.IForbidden

      - zope.security.interfaces.IUnauthorized

      注意として、例外viewが動作するためには name は 'index.html' でなけれ
      ばならない。(patch by Sidnei da Silva from Enfold,
      integration by Martijn Faassen (Startifact) for Infrae)

    - DateTime のタイムゾーンデータに pytz を使うようになりました。これによ
      って多くのタイムゾーン追加と夏時間情報の更新されました。


  バグ修正(Bugs Fixed)

    - "Collector #2113":http://www.zope.org/Collectors/Zope/2113 :
      'zopectl test' が Ctrl-C をマスクしていて効かない問題.

    - "Collector #2190":http://www.zope.org/Collectors/Zope/2190 :
      zope.security.management.checkPermission 呼び出しがZope2のセキュリテ
      ィーポリシーに迂回されていなかった。

      注意: もしあなたがすでにZope2.10のインスタンスを使用しているなら、 イ
      ンスタンスを作り直すか、以下の数行をetc/site.zcmlファイルに追加する必
      要がある::

        <securityPolicy
              component="Products.Five.security.FiveSecurityPolicy" />

    - "Collector #2223":http://www.zope.org/Collectors/Zope/2223 :
      TALESにおけるboolean評価時のdefaultの扱いについて。

    - "Collector #2213":http://www.zope.org/Collectors/Zope/2213 :
      "古い" ZopePageTemplateを編集できない問題を修正。

    - "Collector #2235":http://www.zope.org/Collectors/Zope/2235 :
      いくつかの ZCatalog メソッドがオブジェクトのブール評価行っていたため、
      Noneではなく__len__で評価されていた。いくつかの 'if not obj' を 'if 
      obj is None' に置き換えた。


参考: "CHANGE.txt":http://www.zope.org/Products/Zope/2.11.0/CHANGES.txt の原文(英語)
%%%%%%%%%

:id: 513
:date: 2008-01-01 11:46:41
:title: 明けましておめでとうございます。
:categories: ['misc']
:body type: text/x-rst
:body:
今年はもうちょっと色々勉強しないとね。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-19.7293199431
:title: Re:明けましておめでとうございます。
:author: D.F.Mac.
:date: 2008-01-19 22:18:51
:email: 
:url: 
:body:
D.F.Mac.です。あけましておめでとうございます。
今年もよろしくお願いします。

さて、今年の勉強ネタですが
・人間がプログラムを書かずにソフトウエアを作る方法
・人間がプログラムを書かずに機械がプログラムを出力した結果、人間が修正するハメになることを防止する方法
について、考えませんか？

早く業界構造を変えて、
http://mtg.upf.edu/reactable/
http://www.youtube.com/watch?v=0h-RhyopUmc
こういった面白そうな研究に没頭したい。これは楽しそうだ。

というわけで、キックオフを兼ねて、新年会しましょう。よろしくお願いします。
%%%%%%%%%

:id: 514
:date: 2008-01-01 11:57:00
:title: 年末年始は出費多い
:categories: ['IT-PC']
:body type: text/x-rst
:body:
どうして年末年始はこんなに出費が多いんだろう。

- freia.jp の SSL証明書更新 (RapidSSL_)
- freia.jp ドメイン更新 (JapanRegistory_)
- 清水川.jp ドメイン更新 (JPRS_)
- アンチウィルスのライセンス更新 x 2 (NOD32_)
- DNS登録サービス更新 (`Microtech`_)

けっこうなお値段ですね。。。

.. _RapidSSL: http://www.rapidssl.com/
.. _JapanRegistory: http://www.japanregistry.co.jp/
.. _JPRS: http://jprs.jp/
.. _NOD32: http://www.canon-sol.jp/product/nd/
.. _`Microtech`: http://www.mtgsy.net/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 515
:date: 2008-01-01 12:19:03
:title: 紅白歌合戦をラジカセで録音
:categories: ['misc']
:body type: text/x-rst
:body:
うちの母が、紅白の気に入った曲をテープに入れておきたい、とラジカセを持ってきておもむろに録音ボタンをおしてた。ケーブルとか繋がずに。自分も小学校2年生くらいの頃に同じ事をやった覚えがある。懐かしいなぁ。

とりあえず、個人利用だし劣化しまくりなので著作権には触れないと思う。

ケーブルで繋げよ、というツッコミはあえてしない。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 516
:date: 2008-01-21 21:10:50
:title: X61sのIntel VTをOnにしてみた
:categories: ['IT-PC']
:body type: text/x-rst
:body:
Core2Duoに搭載されている ``Virtualization Technology`` 機能は、ThinkPad X61sのBIOSではデフォルトでOffになっていた。しばらくこれに気づかずにVirtualPC2007を使っていて、X40で動かしてたときに比べてあんまり速くないなー、と思ってました。すみません。

で、BIOSのCPU設定でIntelVTをEnableに変更したところ、VirtualPCの中断データがすべて無効になってしまった。処理の途中だったのに。

気を取り直して仮想化機能を有効にした状態のVirtualPCで処理をやり直してみたところ‥‥有効にする前よりも遅くなった気がする。少なくとも体感では速くなっていないと思う。なんでだろう？と思って調べてみると以下のような記事が見つかった。

.. highlights::

  結果は見て分かるように、VT-xでもAMD-Vでも有効にしない方が速いという結果になっている。
  この結果だけを見るならば、どちらも今のところ意味がないとしか言いようがない。

  -- `笠原一輝のユビキタス情報局`__ (2007/3/15)

.. __: http://pc.watch.impress.co.jp/docs/2007/0315/ubiq177.htm

つまり、仮想化機能はあんまり意味がないどころじゃなく、使うと遅くなると言うことか。それってどうなの？
しかも、ついさっき突然Windows上であらゆるコピー操作ができなくなった。上記引用はすべて手入力。きっとVTのせいに違いない。VTイクナイ。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-23.9931930167
:title: Re:X61sのIntel VTをOnにしてみた
:author: M.Shibata
:date: 2008-01-23 13:36:34
:email: nospam.mshibata@emptypage.jp
:url: 
:body:
VT を有効にしたほうが遅くなるという話があったんですね。
Virtual PC はラップトップで動かすと（電力管理との相性みたいなもので？）パフォーマンスに問題が出るという話は読んだことがあります。以前 MSDN のブログに、その現象と対策についていくつか記事が出てました。

Virtual PC Guy's WebLog : Last resort for performance issues with Virtual PC on laptops
http://blogs.msdn.com/virtual_pc_guy/archive/2007/03/27/last-resort-for-performance-issues-with-virtual-pc-on-laptops.aspx

上の記事とそこから辿れるふたつです。すでにお読みでしたらご容赦を。
でももう乗り換えちゃったからあんまり関係ないかしら。


:comments:
:comment id: 2008-01-23.8583399026
:title: Re:X61sのIntel VTをOnにしてみた
:author: しみずかわ
:date: 2008-01-23 23:50:59
:email: 
:url: 
:body:
Virtual PC Guy で言及されているのは電力が低下してるときの事みたいですね。とりあえず乗り換えちゃったというのと、自分の時の性能低下は電源供給時の現象だったので。。でもリンク先のSppedSwitchXPはおもしろそう。GuestOSに入れてみようかな。


:comments:
:comment id: 2008-01-24.1526525803
:title: Re:X61sのIntel VTをOnにしてみた
:author: M.Shibata
:date: 2008-01-24 02:09:13
:email: nospam.mshibata@emptypage.jp
:url: 
:body:
電力というか、どのプロセス（スレッド）にどれだけ処理能力を分けるかというスケジューリング（ていうの？）の問題でしょう。モバイル CPU はこれをまめに必死でやるので Virtual PC にはかえってあだになっているという。それはバッテリー駆動時でなくてもやってますよね（省電力設定にもよると思いますが）。自分は最後の options.xml の設定変更でずいぶん改善を感じました。
そういえば、別件で Windows XP がパフォーマンスを発揮できないという問題もあったような気がします。いいのか MS。
終わった話で長々とゴメンナサイ。それでは。

:comments:
:comment id: 2008-01-24.9281117446
:title: Re:X61sのIntel VTをOnにしてみた
:author: しみずかわ
:date: 2008-01-24 23:45:28
:email: 
:url: 
:body:
確かに、細かく電源管理してるからって書いてますね。試しにコンセントぬいてバッテリー駆動モードにしたらものすごく遅くなった‥‥ VirtualPCとVMWare Server両方とも‥‥。とりあえずバッテリー駆動中の仮想マシンパフォーマンスは今のところ求めてないけど、対策は用意しておいた方がいいかも。

it will drain your battery power much faster than normal. ってのが気になりますが(^^;;
%%%%%%%%%

:id: 517
:date: 2008-01-22 23:59:48
:title: やっぱりVirtualPCよりVMWareの方が速い
:categories: ['IT-PC']
:body type: text/x-rst
:body:
VirtualPCはUIが使いやすいんで「ちょっと使おう」という気にはなるんだけど、HDDアクセス速度がすぐに実用に耐えない速度になってしまう。これはHDDイメージサイズを非固定長にして使っているせいなのかもしれないけど。VMWareはそのへんの問題が起こらないっぽいんだけど、時々大量SWAPが発生してものすごく重くなるときがある(気がする)。

総合的に見てやはりVMWareの勝利だなあ、と思いつつVirtualPCから乗り換え。

でも、VirtualPCにある、HOSTの任意のフォルダをClientの仮想ドライブとしてマウントする機能は超便利だった。VMWareでは同じことはできないのか？ぜひほしい機能だ。

ところで、 VMWare Server 1.0.4 の機能にVirtualPCからのインポート機能があるんだけど、うまくいったためしがない。HDDイメージサイズが非固定長だからじゃないかと、とみたが言っていたけど、どうなんだろう。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-23.7001008004
:title: Re:やっぱりVirtualPCよりVMWareの方が速い
:author: Yujiro Nakamura
:date: 2008-01-23 10:28:21
:email: 
:url: 
:body:
VMwareはWorkstationのv4を使っていましたが、任意フォルダのドライブマウントは可能でした。今は使ってないので具体的な設定などは分かりませんが……。

ちなみに、今はVirtualBoxを使っていますが、こちらはドライブではなく共有フォルダとしてマウントできます。
個人的な評価ですが、VirtualBoxはVirutl PCよりはパフォーマンスがよく、VMwareよりはUIが使いやすいという、ちょうど両ソフトの中間に位置するような印象です。信頼性は若干両ソフトに劣る（Vistaでブルースクリーン経験あり、あとクリップボードが突然ホストと共有できなくなることがときどき）ので、開発系での利用は微妙かもしれませんが……。

:comments:
:comment id: 2008-01-23.5378131114
:title: Re:やっぱりVirtualPCよりVMWareの方が速い
:author: しみずかわ
:date: 2008-01-23 11:48:58
:email: 
:url: 
:body:
VMWare Server 1.0.4 では共有フォルダ機能が無いっぽいです。VMWare Tool に共有フォルダ機能があるんですが標準ではインストールされない(インストール時にcustomで指定)うえに、インストールしても特に何も変わらない‥‥。

無理矢理使えるように頑張ってる人もいるみたいですが...
http://www.katch.ne.jp/~kakonacl/douga/virtualmachine/vmware/sharedfolder.html

VirtualBoxはおもしろそうですね。今度いれてみよう。
http://www.forest.impress.co.jp/article/2007/03/01/virtualbox.html
%%%%%%%%%

:id: 518
:date: 2008-01-23 00:18:04
:title: WZからの乗り換えを試行錯誤中
:categories: ['WZ', 'IT-PC']
:body type: text/x-rst
:body:
さすがにWZを使い続けるのは、拡張性とか改善とかの面から限界かなーと思い、主環境がVistaになったのを機に乗り換え先を試行錯誤中。

:エディタ: WZ Editor 5 -> `gvim`_
:メーラ:   WZ Mail 5 -> gmail(個人), `Thunderbird`_ (会社)
:ファイラ: WZ Filer海賊版 -> Explorer
:Grep: WZ Grep -> Explorer
:Clipboard履歴: WZ Icon -> `ToClip`_

こうやってみると、WZは統合環境だったんだなあと思う。Emacsみたいだ。

移行先を検討してみると、WZの(エディタ部分以外のｗ)換えが務まるツールがほとんど見あたらない。エディタはそれなりに良いのがある(gvimは気に入っている)けど、メーラ、ファイラは換えが利かない気がする。Grepはちゃんと探せばなんとかなるかな。


.. _`ToClip`: http://www5f.biglobe.ne.jp/~t-susumu/
.. _`gvim`: http://www.kaoriya.net/
.. _`Thunderbird`: http://www.mozilla-japan.org/products/thunderbird/


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-23.8043949404
:title: Re:WZからの乗り換えを試行錯誤中
:author: jack
:date: 2008-01-23 11:36:45
:email: 
:url: 
:body:
Meadow は・・・もちろん検討してヤメたんだろうなぁ・・・

:comments:
:comment id: 2008-01-23.5950171393
:title: Re:meadow
:author: しみずかわ
:date: 2008-01-23 11:49:55
:email: 
:url: 
:body:
Emacsはどうも苦手で...。


:comments:
:comment id: 2008-01-25.6801549731
:title: Re:WZからの乗り換えを試行錯誤中
:author: Anonymous User
:date: 2008-01-25 01:21:20
:email: 
:url: 
:body:
うそ、VZってまだ売ってるの？
http://www.villagecenter.co.jp/soft/vz16.html
%%%%%%%%%

:id: 519
:date: 2008-01-24 00:18:23
:title: vim(gvim)の設定を晒す
:categories: ['vim']
:body type: text/x-rst
:body:
まだ設定周りはよくわかってませんが、とりあえず晒します。ほとんどあちこちのサイトで公開されていたもののコピペです。

まずは参考にしたサイトから。

- `.vimrc - Twisted Mind`_
- `gVim覚書`_
- `名無しのvim使い`_
- `vimを使っている方は、便利に使うためにどんなテクニックがありますか？ あるいはvimスクリプトがあったら教えてください。 現在使っているのは easy (un)commenting out o.. - 人力検索はてな`_
- `OZACC.blog: Vista ファイルの関連付け`_

設定が落ち着いたら、 `Vimpi`_ に登録してプロフィールと一緒にvimrcを晒すことにしよう。


.. _`Vimpi`: http://vimpi.net/user/dubhead
.. _`.vimrc - Twisted Mind`: http://d.hatena.ne.jp/Voluntas/20070427/1177695694
.. _`gVim覚書`: http://www002.upp.so-net.ne.jp/janus/vim.html
.. _`名無しのvim使い`: http://nanasi.jp/
.. _`vimを使っている方は、便利に使うためにどんなテクニックがありますか？ あるいはvimスクリプトがあったら教えてください。 現在使っているのは easy (un)commenting out o.. - 人力検索はてな`: http://q.hatena.ne.jp/1137486621
.. _`OZACC.blog: Vista ファイルの関連付け`: http://blog.ozacc.com/archives/001741.html



:extend type: text/x-rst
:extend:
::

	colorscheme darkblue
	set guioptions-=T
	
	" Source other vim command
	"if has('mac')
	"    source $VIMRUNTIME/delmenu.vim
	"	set langmenu=ja_jp.utf-8
	"	source $VIMRUNTIME/menu.vim
	"	set antialias
	"	set macatsui
	"	set termencoding=japan
	"	set guifont=Osaka-Mono:h15
	"endif
	if has("gui_win32")
		if $TERM == ""
			set shell=$BASHPATH\ --login
		else
			set shell=$BASHPATH
		endif
		set shellslash
	
		" Add .vim directory to runtimepath
		set runtimepath+=$HOME\.vim
	
		" Windows setting for Access permissions
		set backupcopy=yes
		set nobackup
	endif
	if has('kaoriya')
	  highlight CursorIM guibg=Purple guifg=NONE
	  inoremap <silent> <ESC> <ESC>:set iminsert=0<CR>
	  set iminsert=0 imsearch=0
	endif
	
	highlight SpecialKey cterm=underline ctermfg=darkgrey
	highlight ZenkakuSpace cterm=underline ctermfg=lightblue guibg=white
	match ZenkakuSpace /　/
	
	set transparency=220
	
	".vimrc
	
	
	" Common options
	syntax on
	"set nobk
	set grepprg=search\ $*
	set iminsert=0
	set imsearch=0
	set listchars=eol:$,tab:>-
	set ruler
	set shortmess+=I
	set visualbell
	set scrolloff=2
	
	set fileformats=unix,dos,mac " 改行コードの自動認識
	"set showcmd
	"set number
	set nocompatible
	set clipboard+=unnamed
	set wildmode=list:longest
	set autoread
	set showmode
	set hidden
	set noinsertmode
	set showmode
	set cmdheight=1
	set nowrap
	"set wrap
	set laststatus=2
	"set cmdheight=2
	set showcmd
	set title
	set statusline=%<%f\ %m%r%h%w%{'['.(&fenc!=''?&fenc:&enc).']['.&ff.']'}%=%l,%c%V%8P
	
	if has("gui_win32")
		set guifont=ＭＳ_ゴシック:h12:cSHIFTJIS
		set printfont=ＭＳ_ゴシック:h10:cSHIFTJIS
		" autocmd GUIEnter * simalt ~x
		" autocmd GUIEnter * winpos 100 0
		autocmd GUIEnter * winsize 80 52
	else
		au BufNewFile,BufRead fstab setf fstab
		if has("gui_running")
			if $LANG == "ja_JP.utf-8"
				inoremap   :set iminsert=0
				if $HOSTNAME == "vaio"
					" set guifontset=-alias-fixed-medium-r-normal-*-*-160-*-*-c-*-jisx0201.1976-0
					set printfont=-alias-fixed-medium-r-normal-*-*-160-*-*-c-*-jisx0201.1976-0
					set guifont=gothic\ Medium\ 14
				else
					set guifontset=-alias-fixed-medium-r-normal-*-*-160-*-*-c-*-jisx0201.1976-0
					set printfont=-alias-fixed-medium-r-normal-*-*-160-*-*-c-*-jisx0201.1976-0
				endif
				set imactivatekey=S-space
			endif
			autocmd GUIEnter * winsize 80 45 
		else
			set mouse=a
		endif
	endif
	
	"tab
	set tabstop=4
	set shiftwidth=4
	set smarttab
	set expandtab
	set softtabstop=4
	set autoindent
	
	"edit
	set smartindent
	set showmatch
	set backspace=indent,eol,start
	set nolist
	
	" search
	set ignorecase
	set smartcase
	"set hlsearch
	set nohlsearch
	set incsearch 
	
	" backup
	set nobackup
	set nowritebackup
	set swapfile
	
	" □とか○の文字があってもカーソル位置がずれないようにする
	set ambiwidth=double
	
	"set encoding=utf8 "menu encoding...
	set fileencoding=utf8
	
	" 文字コードの自動認識
	if has('iconv')
	  let s:enc_euc = 'euc-jp'
	  let s:enc_jis = 'iso-2022-jp'
	  " iconvがeucJP-msに対応しているかをチェック
	  if iconv("\x87\x64\x87\x6a", 'cp932', 'eucjp-ms') ==# "\xad\xc5\xad\xcb"
	    let s:enc_euc = 'eucjp-ms'
	    let s:enc_jis = 'iso-2022-jp-3'
	  " iconvがJISX0213に対応しているかをチェック
	  elseif iconv("\x87\x64\x87\x6a", 'cp932', 'euc-jisx0213') ==# "\xad\xc5\xad\xcb"
	    let s:enc_euc = 'euc-jisx0213'
	    let s:enc_jis = 'iso-2022-jp-3'
	  endif
	  " fileencodingsを構築
	  if &encoding ==# 'utf-8'
	    let s:fileencodings_default = &fileencodings
	    let &fileencodings = s:enc_jis .','. s:enc_euc .',cp932'
	    let &fileencodings = &fileencodings .','. s:fileencodings_default
	    unlet s:fileencodings_default
	  else
	    let &fileencodings = &fileencodings .','. s:enc_jis
	    set fileencodings+=utf-8,ucs-2le,ucs-2
	    if &encoding =~# '^\(euc-jp\|euc-jisx0213\|eucjp-ms\)$'
	      set fileencodings+=cp932
	      set fileencodings-=euc-jp
	      set fileencodings-=euc-jisx0213
	      set fileencodings-=eucjp-ms
	      let &encoding = s:enc_euc
	      let &fileencoding = s:enc_euc
	    else
	      let &fileencodings = &fileencodings .','. s:enc_euc
	    endif
	  endif
	  " 定数を処分
	  unlet s:enc_euc
	  unlet s:enc_jis
	endif
	" 日本語を含まない場合は fileencoding に encoding を使うようにする
	if has('autocmd')
	  function! AU_ReCheck_FENC()
	    if &fileencoding =~# 'iso-2022-jp' && search("[^\x01-\x7e]", 'n') == 0
	      let &fileencoding=&encoding
	    endif
	  endfunction
	  autocmd BufReadPost * call AU_ReCheck_FENC()
	endif
	
	"taglist.vim
	set tags=tags
	
	"python.vim
	let python_highlight_all = 1
	
	"minibufexpl.vim
	"set minibfexp
	let g:miniBufExplMapWindowNavVim=1
	let g:miniBufExplSplitBelow=0
	let g:miniBufExplMapWindowNavArrows=1
	let g:miniBufExplMapCTabSwitchBufs=1
	let g:miniBufExplModSelTarget=1
	let g:miniBufExplSplitToEdge=1
	
	" minibufexpl.vim
	nmap <Space> :MBEbn<CR>
	nmap <S-Space> :MBEbp<CR>
	
	if has('mac')
	  set iskeyword=@,48-57,_,128-167,224-235
	  " SpotlightOpen
	  let g:spotlightopen_match = 2
	endif
	
	" key map
	nmap j gj
	nmap k gk
	vmap j gj
	vmap k gk
	
	" mru.vim 
	let MRU_Max_Entries = 50
	let MRU_Exclude_Files = '^/tmp/.*\|^/var/tmp/.*'
	let MRU_Window_Height = 20 
	" let MRU_Use_Current_Window = 1
	" let MRU_Auto_Close = 0


:comments:
:comment id: 2009-01-05.8239722741
:title: Re:vim(gvim)の設定を晒す
:author: 通りすがり
:date: 2009-01-05 15:27:05
:email: 
:url: 
:body:
" 文字コードの自動認識
" 日本語を含まない場合は fileencoding に encoding を使うようにする
のふたつをコピーして利用させてもらいました。
MacOS 10.5 + MacVimで問題なく動作しています。
非常に便利になりました。ありがとうございました。多謝！！
%%%%%%%%%

:id: 520
:date: 2008-01-24 00:32:39
:title: emobile D01NX ファームウェアアップデートに失敗
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`イー・モバイル、「D01NX」の最新ファームウェア公開`_ という記事を1/9に読んで、その日のうちにアップデートを実施したら失敗。Vistaが悪かったのか何が悪かったのかよく分からないけど、デバイスを接続するとUSBデバイスが2つ見つかるようになり、しかもドライバが適合しなくなってしまった。

その後、emobileに電話したらペリカンが引き取りにやってきて、今日無事に戻ってきました。約2週間のあいだ、緊急用回線(PHS 64kbps)でモバイル通信。GMailとサイト閲覧くらいなら意外と何とかなるもんだなー。

ところで、修理費とかかかるのかしら‥‥。

.. _`イー・モバイル、「D01NX」の最新ファームウェア公開`: http://k-tai.impress.co.jp/cda/article/news_toppage/37920.html?ref=rss


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-24.5602649040
:title: Re:emobile D01NX ファームウェアアップデートに失敗
:author: にわけん
:date: 2008-01-24 09:12:41
:email: 
:url: 
:body:
私は無事アップデート出来ました（onVistaBusiness)。が、気付いたのが昨日なので、同一モジュールかどうかは不明。
しかし、安定したかは微妙。前は端末がハングしていた状態は無くなったが、こっそりと回線が切れる頻度が上がった様な。
余裕があったら7.2Mカード端末にリプレースしたい所。

:comments:
:comment id: 2008-01-24.1711320865
:title: Re:emobile D01NX ファームウェアアップデートに失敗
:author: しみずかわ
:date: 2008-01-24 23:32:51
:email: 
:url: 
:body:
前のノートPC(XP)で使ってたときは、サスペンド時に接続してるとOSリセットしてくれたけど、今のPC(Vista)では安定している気がする。
7.2Mにはできない。emobileローン中なので‥‥。というか速度十分だし。

:comments:
:comment id: 2008-02-10.7707676100
:title: Re:吉村メモ
:author: しみずかわ
:date: 2008-02-10 11:32:51
:email: 
:url: 
:body:
そのトラックバック元のURLはどうなのよ？

:trackbacks:
:trackback id: 2008-02-07.2142578609
:title: 吉村メモ
:blog name: PukiWiki Plus! (PukiWiki/TrackBack 0.3)
:url: https://58.157.52.199:443/localwiki/index.php?%B5%C8%C2%BC%A5%E1%A5%E2
:date: 2008-02-07 17:33:35
:body:
イーモバ（D01NX）、やヴぁい件 (08.02.04)   最近イーモバがよく切れます。。。 ユーティリティは接続を表示してるが、実際は接続できてない。。。 同様の症状が巷でもあるらすぃ（R6+D01NXなんて、一緒の構成じゃまいか！！） http://d.hatena.ne.jp/delmo/20071023/119...

%%%%%%%%%

:id: 521
:date: 2008-01-24 23:17:48
:title: ML115を買ってしまった
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`ML110と鎌風2の風92とML115キャンペーン | Weboo! Returns.`_ を読んで買ってしまった。 Athlon64 3500+, 80GB HDD、512MBメモリで15,750円。ありえない価格。メモリを値上がりする前に8GBくらい積んでVMのHostにしようかなぁ。8GBで16,000円くらい‥‥ML115と同じくらいだなぁ。

ところで、ML115は昨年のpyspa2の前から欲しいとは思っていて、定期的にそのときのサイトをチェックしてたんだけど、

:チェックしてたURL: http://nttxstore.jp/_II_HP12154264
:今日買ったURL: http://nttxstore.jp/_II_HP12312916

**URLが違う！** なんという驚愕の事実！ orz

今日の昼過ぎに80台あったのが、今(23時)は残り49台。今週中になくなりそうな感じ。（そしてすぐ補充されそう‥‥）


.. _`ML110と鎌風2の風92とML115キャンペーン | Weboo! Returns.`: http://yamashita.dyndns.org/blog/kamakaze2/


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-25.0955254438
:title: Re:ML115を買ってしまった
:author: D.F.Mac.
:date: 2008-01-25 01:11:36
:email: 
:url: 
:body:
安！

うるさくない？


:comments:
:comment id: 2008-01-25.7970474798
:title: Re:ML115を買ってしまった
:author: しみずかわ
:date: 2008-01-25 10:16:37
:email: 
:url: 
:body:
デフォだとうるさいらしいけど、そこはML115を静かにする先駆者たちがたくさんいるので大丈夫かな、と。
明日受け取り予定。あ、代引きだから現金用意しなきゃ。


:comments:
:comment id: 2008-01-25.6391447230
:title: Re:ML115を買ってしまった
:author: しみずかわ
:date: 2008-01-25 11:37:20
:email: 
:url: 
:body:
今2008/01/25 11:36時点であと10台。夕方には無くなるかな？

:comments:
:comment id: 2008-01-25.0829154528
:title: Re:ML115を買ってしまった
:author: jack
:date: 2008-01-25 12:01:23
:email: 
:url: 
:body:
ML110使ってるけどうるさくないよ。
ヘタなショップものより静かなくらい

:comments:
:comment id: 2008-01-25.8268702504
:title: Re:ML115を買ってしまった
:author: しみずかわ
:date: 2008-01-25 13:22:38
:email: 
:url: 
:body:
2008/01/25 13:19。残り台数が201台に増えた！

ただし。「在庫：在庫ございません。 お取り寄せとなります。」

%%%%%%%%%

:id: 522
:date: 2008-01-25 00:05:16
:title: WZMailの*.mbxをThunderbirdにインポートする
:categories: ['python', 'WZ']
:body type: text/x-rst
:body:
WZMailのメールボックスは \*.mbx ですが、中身が微妙に独自形式なので他へ移行する際にみんなそれぞれ苦労しているらしい。たしかWZの本家掲示板が生きていた頃にそんな話をいくつか見かけた気がする。

で、今回自分もThunderbirdへの移行を画策して、移行ツールを探してみたけど案の定「これ一発で行けますぜ旦那！」っていう感じのツールは見つからなかった。しょうがないので、変換スクリプトをPythonで書いてみたら意外とすぐいけてしまった。

変換できたら、Thunderbirdのメールデータ用フォルダに変換後のファイルを置いてThunderbirdを起動するだけでフォルダツリーに表示される。クリックするとインデックスの更新が行われて無事取り込み完了（のはず）。
文字コード変換の処理を手抜きしているので、変換できない文字が空白に置き換えられる。あと、Subjectが壊れることがあるみたい。5万件のメッセージを変換して10件くらいSubjectが壊れたけど、まあいいか。

ところで、1フォルダに5万件のメールが入ってると表示が遅いのは何とかならないものか。UIもいろいろ気になるところ...。Thunderbirdが手になじむツールになる日は..来るのだろうか？

というこで、以下、変換コードです。


:extend type: text/x-rst
:extend:
.. code-block:: Python

    import os, sys
    
    def output(out, mfrom, stack):
        stack.insert(0, mfrom)
        out.write(''.join(stack))
    
    ignore_chars = r'\/:*?"<>|'
    
    def getsubject(filename):
        cfgname = filename[:-4] + '.cfg'
        f = file(cfgname,'r')
        for l in f:
            if l.startswith('Subject:'):
                subject = l[8:].strip()
                break
        else:
            subject = 'new_' + filename
    
        # char replace
        for c in ignore_chars:
            subject = subject.replace(c,'_')
    
        # name chooser
        if os.path.exists(subject):
            n = 0
            while os.path.exists(subject+str(n)):
                n += 1
            subject += str(n)
    
        return subject
    
    def main(filename):
        f = file(filename, 'r')
        subject = getsubject(filename)
        print subject
        o = file(subject, 'w')
        
        stack = []
        mfrom = 'From dummy\n'
        
        for l in f:
            if l == '\x08<mh>\n':
                print '.',
                output(o, mfrom, stack)
                stack = []
                mfrom = 'From dummy\n'
            else:
                try:
                    j = l.decode('cp932','replace').encode('iso2022-jp','replace')
                except:
                    print l
                    raise
                stack.append(j)
                if j.startswith('From:'):
                    mfrom = 'From '+j[5:]
                    mfrom = mfrom.strip() + '\n'
        else:
            if stack:
                output(o, mfrom, stack)
        
        o.close()
        f.close()
        print
    
    def conv_all_mbx():
        from glob import glob
        l = glob('*.mbx')
        for f in l:
            main(f)
    
    if __name__ == '__main__':
        if len(sys.argv) == 2:
            filename = sys.argv[1]
            main(filename)
        else:
            conv_all_mbx()


:comments:
:comment id: 2008-01-25.3823230908
:title: Re:WZMailの*.mbxをThunderbirdにインポートする
:author: M.Shibata
:date: 2008-01-25 02:39:43
:email: mshibata@emptypage.jp
:url: 
:body:
自分も昔おんなじようなことしました。
http://www.emptypage.jp/whining/2006-09-24.html
Python はテキスト処理のパーサが書きやすいですよね。
で、Thunderbird からメールを IMAP のメールフォルダに移動させて Gmail で吸い上げました。


:comments:
:comment id: 2008-01-25.6142969273
:title: Re: Thunderbird > IMAP > Gmail
:author: しみずかわ
:date: 2008-01-25 10:13:35
:email: 
:url: 
:body:
やはり先駆者がいましたか。そんな気はしてたんです（笑

>で、Thunderbird からメールを IMAP のメールフォルダに移動させて Gmail で吸い上げました。

それは思いつかなかった！
WZ掲示板もそれで移行できるなあ...


:comments:
:comment id: 2008-01-31.9823448837
:title: Re: Thunderbird > IMAP > Gmail 
:author: M.Shibata
:date: 2008-01-31 19:39:43
:email: mshibata@emptypage.jp
:url: 
:body:
今日気づいたのですが、いつの間にか日本語版の Gmail も IMAP 設定できるようになってますね。
いまなら直接 Gmail にドロップできるかもしれません。
WZ BBS のログはそのままにしてますが、取り込めたら面白いですね。ヘッダの独自部分をうまく扱ってやるだけでいけそうですが……。
# 下の「確認」ボタンって動いてる？

:comments:
:comment id: 2008-01-31.7016972443
:title: Re:確認ボタン
:author: taka
:date: 2008-01-31 23:45:01
:email: 
:url: 
:body:
動いていませんでした。なおしました。

%%%%%%%%%

:id: 523
:date: 2008-01-26 22:39:48
:title: ML115が届いたのでメモリを8G搭載してみた
:categories: ['IT-PC']
:body type: text/x-rst
:body:
木曜日に注文したML115が金曜日には配達されていた（不在だったけど）。で、今日の朝受け取って昼過ぎにメモリを買いに秋葉原へ。ML115でVMWareを動かして、その上でfreia.jpを稼働させようかと思っている。ということで、メモリはまあまあ載せた方がいいのかな。

今日買ってきたメモリは、UMAXのDDR2-800 2GBが1枚で約4000円。2000円/GB。安すぎ。とりあえず4GB購入で8200円。

一緒に行ったとみたも同じメモリを4GB買ったので、それを借りて合計8GBをML115に搭載。memtest86を走らせてみたけど特に問題なくテスト完了。ML115は公式にはECCメモリが必要なんだけど、 `ML115のwiki`_ にも書いてあるようにECCじゃなくても動作するらしい。一部のメモリで相性問題が出るっぽいけど、今日買ったUMAXのやつは相性問題はなさそう。

早速 `Ubuntu 7.10 server`_ と `VMWare Server 1.0.4`_ をインストールしてみよう。

.. _`ML115のwiki`: http://wiki.nothing.sh/page/hp%BB%AA-ProLiant-ML115(%B3ʰ%C2Server)/Linux
.. _`Ubuntu 7.10 server`: http://www.ubuntu.com/getubuntu/download
.. _`VMWare Server 1.0.4`: http://www.vmware.com/download/server/


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-27.0375569931
:title: Re:ML115が届いたのでメモリを8G搭載してみた
:author: voluntas
:date: 2008-01-27 00:07:18
:email: 
:url: 
:body:
ぅぁーいいですねー。
8G が格安すぎです。

8200 円て ...

どこら辺で売ってます？

:comments:
:comment id: 2008-01-27.9612237903
:title: Re:ML115が届いたのでメモリを8G搭載してみた
:author: しみずかわ
:date: 2008-01-27 03:42:42
:email: 
:url: 
:body:
あ、いや、4Gで8200円です。紛らわしくてすみません。
買ったのはツクモでしたが、どの店でも非バルクでだいたい2GBが4000円くらいでしたよ。


:comments:
:comment id: 2008-01-27.1725030863
:title: Re:ML115が届いたのでメモリを8G搭載してみた
:author: koma2
:date: 2008-01-27 11:16:13
:email: koma2@lovepeers.org
:url: http://bloghome.lovepeers.org/daymemo2/
:body:
4G 8200円でもじゅーぶん安いよ。ｗ
わたしゃトランセンドでECC付きのを買ったので倍ぐらいしたけど、それでも安いと思ってしまった。

:comments:
:comment id: 2008-04-24.1467398320
:title: Re:ML115が届いたのでメモリを8G搭載してみた
:author: Anonymous User
:date: 2008-04-24 02:35:48
:email: 
:url: 
:body:
つんでもみました。グラフィックボードを認識しなくなりました。2Gにしたら復活。うーん、いくらなんでも2Mのオンチップグラフィックで使えというのは、酷じゃないかなと思うのですが。

%%%%%%%%%

:id: 524
:date: 2008-01-27 18:50:48
:title: 納豆パーティー
:categories: ['food']
:body type: text/x-rst
:body:
ある切っ掛けで納豆に合うトッピングの話になり、検索してみたらgooとlivedoorでトッピング人気調査をしていた。さらに納豆blogまで...。

- `アナタは何を入れる？ 納豆のトッピングランキング - goo ランキング`_
- `【納豆】 「あなたがオススメする納豆のトッピングは？」 - livedoor リサーチ`_
- `納豆Blog`_

ということでその場にいた、とみた・Go・俺の3人で実際に色々買ってきて試してみた。

納豆
-----

- `金のつぶ`_ (梅風味)
- `黒豆小粒`_ (わさび付き)
- `平家納豆`_ (カラシ付き)
- `丹精`_ (カラシ、ゴマ、刻み海苔付き)

トッピング具材と感想
------------------

:刻みネギ: 実はこの組み合わせは初めてかも。普通にうまい。
:梅肉: 梅肉を入れすぎて納豆が負けました。調整すればうまいかな。
:なめたけ: 微妙。さらに大根おろしを足せばバランスがとれそう。
:マヨネーズ: 糸を引くマヨネーズ。納豆の風味はゼロ。昔、弟がよく食べていた。
:キムチ: 納豆の風味消滅。糸引きキムチになった。
:シーチキン: 自分的にはこれは無いな。魚臭さと納豆は合わない。Go君は有り判定。
:おにぎり味噌: 味噌の勝ち。納豆消滅。

ということで、たいていは納豆の風味が消滅してしまうという結果に。
単体よりおいしくなったトッピングはネギくらいだったような気が‥‥。

そういえば実家にいたときはミョウガを合わせた気がする。ミョウガは庭に植わってたのでよく食卓にでてきました。あ、実家で納豆といえば `納豆汁`_ か。正月に帰郷したときにも大量に食べました。おいしゅうございました＞母上。


.. _`アナタは何を入れる？ 納豆のトッピングランキング - goo ランキング`: http://ranking.goo.ne.jp/ranking/013/natto_topping/
.. _`【納豆】 「あなたがオススメする納豆のトッピングは？」 - livedoor リサーチ`: http://research.livedoor.com/QuestionnaireTotal2.cgi?research_cd=czyqqrsltj5585053315
.. _`納豆Blog`: http://blog.goo.ne.jp/gawa_chi

.. _`金のつぶ`: http://www.mizkan.co.jp/chilled/shohinshokai/06_kurosu.html
.. _`黒豆小粒`: http://www.adumas.co.jp/info/kotubu.htm
.. _`平家納豆`: http://www.koishiya.co.jp/lineup/heike.html
.. _`丹精`: http://www.kume-natto.com/showcase/tansei.htm

.. _`納豆汁`: http://ja.wikipedia.org/wiki/%E7%B4%8D%E8%B1%86%E6%B1%81


:extend type: text/html
:extend:
%%%%%%%%%

:id: 525
:date: 2008-01-27 19:12:29
:title: ML115 Challenge! 1
:categories: ['Unix', 'IT-PC']
:body type: text/x-rst
:body:
とりあえずメモリを標準搭載のDDR2-677-512MB-ECCからDDR2-800-4096MB-NonECCに変更してmemtest86は特に問題なし。

VMWareのHostにするOSの選択に迷い、とりあえずUbuntu Server 7.10を入れてみたが、VMWareを動かすには色々と手動でパッケージを入れる必要があり(makeとかgccとか)、初めてさわるRedHat以外のLinuxなのであまり調査もせずに断念。

次にUbuntu Desktop 7.10ならXとか色々入ってるだろうと思い入れてみた。が、なぜか解像度が720x400という不思議な解像度しか選択できず、VMWareをインストールしてみたけど結局起動までは至らず断念。このへんで明け方4時。

次にDebianをインストールしてみたが、こちらもなぜか解像度が720x400という不思議な解像度しか選択できず。仕方がないのでそのままVMWareのインストールを続行し、libX11.so.6が無いという警告にはまる。検索してみたら ``apt-get install ia32-libs`` すれば良いことが分かる。でもia32ですか？と思いつつもVMWareは無事起動した。この辺で明け方5時過ぎ。

ところでVMWareのライセンスキーはWindowsとLinuxとで互換性がないことに気づいた。VMWareのusサイトでLinux用のライセンスキーを10個ほど入手し設定。無事仮想マシンが起動。朝7時。

睡眠。

`debian-amd64`_ というページを見つけ、先は長そうだな‥‥とため息。＜いまここ


.. _`debian-amd64`: http://kmuto.jp/open.cgi?debian-amd64


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-27.1497783066
:title: Re:ML115 Challenge! 1
:author: Anonymous User
:date: 2008-01-27 20:42:32
:email: 
:url: 
:body:
Ubuntu Server で、VMware Server は下記を sorces.list に追加するだけで aptitude で入りますよ:-)

deb http://archive.canonical.com/ubuntu gutsy partner

aptitude install vmware-server


:comments:
:comment id: 2008-01-29.4662976930
:title: Re:ML115 Challenge! 1
:author: しみずかわ
:date: 2008-01-29 01:24:27
:email: 
:url: 
:body:
おお！天の声が！aptitudeって何だろう！？FreeBSDのportutilみたいなもんかな。
今は画面解像度問題の方が気になってるので、後ほど試してみます。


:comments:
:comment id: 2008-01-30.6405240245
:title: Re:ML115 Challenge! 1
:author: voluntas
:date: 2008-01-30 09:57:21
:email: 
:url: 
:body:
あ ... Anonymous になってました ... 。
すみません ... 。

%%%%%%%%%

:id: 526
:date: 2008-01-28 23:27:57
:title: ckwとnyacusとztop
:categories: ['Windows']
:body type: text/x-rst
:body:
開発にWindowsを使っているとcmd.exeを結構な頻度で使う。Windowsで開発する人はcoLinuxかcygwinを使う人が多そうな気もするけど、ここではそれは置いておく。（cygwinはちょっと苦手...）

で、このcmd.exeというやつが結構使いにくくて、

- コピー・ペーストの手順がちょっと多い(putty等に比べて)
- 最大化しても横幅が変わらない
- Windowの半透明化ツール(`ZTop`_ など)を使っても半透明にならない

などという困った点がある。横幅固定とか半透明にならないとか、どういう仕様なんだろう？

...といった問題を解消してくれるのが、 `ckw`_ 。しかし、バイナリは入手できなかったので、
ソースを自分でビルドしてたんだけど、ckwのバグを修正した版を公開してくれてる人がいたので
そっちに乗り換えました。

- `ckw 0.8.10 改造版`_

ついでに、この方のページで紹介されていた `NYACUS`_ も使用開始。
tcshっぽい操作感ですごく便利だ！


.. _`ckw`: http://www.softantenna.com/lib/3553/index.html
.. _`ckw 0.8.10 改造版`: http://d.hatena.ne.jp/hideden/20071115/1195229532
.. _`NYACUS`: http://www.nyaos.org/
.. _`ZTop`: http://www15.plala.or.jp/then/


:extend type: text/html
:extend:


:comments:
:comment id: 2008-01-30.9113847360
:title: Re:ckwとnyacusとztop
:author: jack
:date: 2008-01-30 11:41:51
:email: 
:url: 
:body:
これはよさそう・・・

:trackbacks:
:trackback id: 2009-05-31.1226238521
:title: Windowsのコマンドプロンプトをフリーソフトで便利にする
:blog name: ナレッジエース
:url: http://blog.blueblack.net/item_358
:date: 2009-05-31 01:15:22
:body:


Windowsのコマンドプロンプト(cmd.exe)を開発などで頻繁に使っていると、何かと不便な点が気になってきます。

ウィンドウの最大化が制限されていたり、コピー・ペーストが右クリックメ...

%%%%%%%%%

:id: 527
:date: 2008-01-29 23:59:49
:title: NTT Flet's光マンションタイプがやってきた
:categories: ['IT-PC']
:body type: text/x-rst
:body:
昨年末のマンション総会で可決された、NTT Flet's光導入に伴い、MDFに接続されるVDSL変換BOXが取り付けられた。これでこのマンションに越してきてから難儀していた回線難民状態からやっと解放される感じ。

ちなみにこのBOXは取り付け工事無料、共用電源使用料はNTT支払い、加入戸数１戸から対応、と大安売り状態。全体で１５戸というマンションには戸数縛りがあると導入が難しい光も、これで手軽に導入できる時代になったんだなあ。

‥‥そして、マンションがNTT縛りになる。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 528
:date: 2008-01-30 01:38:36
:title: Thinkpad X61s 7666-BH5
:categories: ['Agile(XP)', 'IT-PC']
:body type: text/x-rst
:body:
前回のノートPC購入から2年。買い換えは早いか遅いか。(前回:2005/09/11, 今回:2007/12/27)

前回購入時のエントリ( `新しいノートPC購入 (IBM X40 2371-K9J)`_ )と同じようにスペックを書いてみる。

.. _`新しいノートPC購入 (IBM X40 2371-K9J)`: http://www.freia.jp/taka/blog/248


今まで使っていた ``IBM X40 2371-K9J`` (2005年購入) はまだまだ現役で使えるPCだったが、最近仮想環境(VMWareやVirtualPC)を使う機会が多くなってきていて、メモリ容量やHDD容量を増やせない(HDDが1.8inchのため60GBが限界)などの点に問題があった。正直なところ買い換えは結構な期間悩んだんだけど、15周年モデルが出るということで勢いで購入。その後約半額で買えるX61でも良かったかな‥‥と思わなくもない。X61sはL7500だけど、X61はT7500でCPUパワーは高いし。まあ買っちゃったものはしょうがないということで。あ、でも英語キーボードを選択できるというのは大きかったかもしれない。

購入時のポイントは前回から増えてます。

- TrackPoint,UltraPoint,AcuPointであること。スライドパッド却下。
- 軽いこと。1.2kgくらい。
- プレゼンに利用できること(外部出力や解像度)
- 無線LAN内蔵
- 長時間バッテリー稼働
- 英語キーボード

もう、スライドパッド以外となると選択肢は無いよね。


:extend type: text/x-rst
:extend:
今回は、前回購入時のようにX40, X41比較とかはしてません。チップセットの発熱問題とかも今回のGM965では無さそうだったし、HDDやCPUの搭載位置がパームレスト下には無いため熱くはならないだろうと想定。実際熱くはないです(X40と同等くらい)。

メモリは標準搭載が2GB。先日2G足して合計4Gになったけど、32bit OSの宿命ということで、Windowsでは3.2GBまでしかつかえません。

前回は６年ぶり、今回は2年ぶりのノートPC買い換えでスペック以下のようになりました。

========= ====================== ===================== ======================
機種      Thinkpad X61s 7666BH5  IBM X40 2371K9J       東芝 Dynabook SS 3380 
--------- ---------------------- --------------------- ----------------------
CPU       Core2Duo L7500(1.6GHz) Pentium M 758(1.5GHz) Pentium II 400MHz
MEM       DDR2 SDRAM 4GB         DDR SDRAM 1.5GB       SIMM 192MB
HDD       SATA 200GB             Ultra ATA100 40GB     Ultra DMA 8GB
重さ      1.28kg                 1.26kg                1.34kg
Video     ??MB DirectX10対応     32MB DirectX9対応     2.5MB
有線LAN   1000Base-T             1000Base-T            なし
無線LAN   802.11a/g/n            802.11a/b/g           なし
Bluetooth あり                   なし                  なし
RGB出力   あり                   あり                  なし
========= ====================== ===================== ======================

む...、CPU周波数はあまり上がっていない...。

あと、 **Windows Vista Ultimateです** 。

参考
-----
- `ThinkPad 15 周年記念モデル`_

.. _`ThinkPad 15 周年記念モデル`: http://www-06.ibm.com/jp/pc/notebooks/thinkpad/x-series/x61s_lineup_15th.shtml


:comments:
:comment id: 2008-01-30.3155779823
:title: Re:Thinkpad X61s 7666-BH5
:author: jack
:date: 2008-01-30 11:31:56
:email: 
:url: 
:body:
Vista なにかと面倒ですね。結構カスタマイズに時間をとられた記憶があります。
CPU速度はサーバやデスクトップではむしろさがったりしてますから、変化ないならいいのでは(笑)

%%%%%%%%%

:id: 529
:date: 2008-01-31 23:12:59
:title: blog更新頻度を上げて公私のバランスを保つMethod
:categories: ['misc']
:body type: text/x-rst
:body:
最近、頓に忙しくなってきたのでバランスをとるために、このblogの更新頻度を上げてみた。カレンダー的に毎日更新をとりあえずの目標に頑張っている。ネタに困ると `納豆パーティー`_ とかで更新、くらいの感じ。

.. Highlights::

  最近なぜかとても更新頻度が上がっていて嬉しい。

  -- `清水川記の更新頻度 - Twisted Mind`_

納豆ですみません。


ところで、忙しくなると本気でblog更新する暇が無くなるんだけど、この期間に起きたことや見つけた技術ネタはちゃんと(blogに)メモしておかないと、起きたこと・見つけたことそのものを忘れてしまうので、仕事が忙しいときこそblogにメモをとってバランスを保つ必要がある。

いや、メモ先はblogじゃなくてもいいんだけど。まあそんな感じで今日も忙しい。


.. _`清水川記の更新頻度 - Twisted Mind`: http://d.hatena.ne.jp/Voluntas/20080130/1201655397
.. _`納豆パーティー`: http://www.freia.jp/taka/blog/524


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-01.3813506223
:title: 携帯でなくても
:author: jack
:date: 2008-02-01 08:33:02
:email: 
:url: 
:body:
moblog にするといいかも。

%%%%%%%%%

:id: 530
:date: 2008-02-01 00:00:27
:title: 納豆革命
:categories: ['food']
:body type: text/x-rst
:body:
Go君からのタレコミ。

.. Highlights::

  お待たせしました！　おはよう納豆のヤマダフーズから新しい納豆の登場です。
  その名もスティック納豆。第一弾としまして2008年１月22日、
  ３つの美味しさでいよいよ発売スタート！

  -- 株式会社ヤマダフーズ: `納豆革命！ スティック納豆`_

メニューからたどれる ``納豆カスタマイズ`` のページは準備中らしい。とても気になる...。 ``お問い合わせ`` のページも準備中らしい。頑張れヤマダフーズ！

秋田魁新報社のWebサイト `さきがけonTheWeb｜東北・関東でスティック納豆発売へ ターゲットは単身世帯男性`_ によると、今月下旬から東北、関東の大手コンビニエンスストアで発売するらしい。もう売ってるかもしれない。明日探してみよう。

*# でもキムチは合わないと思うんだ*

.. _`さきがけonTheWeb｜東北・関東でスティック納豆発売へ ターゲットは単身世帯男性`: http://www.sakigake.jp/p/akita/news.jsp?kc=20080110j

.. _`納豆革命！ スティック納豆`: http://www.yamadafoods.co.jp/stick/stick-top.html


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-01.6080679459
:title: キムチと納豆
:author: jack
:date: 2008-02-01 08:36:48
:email: 
:url: 
:body:
あうよ。よく食べる。
ただし、タレはあまる。

:comments:
:comment id: 2008-02-01.1363033577
:title: Re:キムチと納豆
:author: しみずかわ
:date: 2008-02-01 08:45:36
:email: 
:url: 
:body:
> あうよ。よく食べる。

うーん、リアルキムチと１：１で混ぜたのが良くなかったのかな。
食感はシャクシャク、味はキムチ風味のキムチ味だった...。


:comments:
:comment id: 2008-02-02.2426579166
:title: Re:キムチと納豆
:author: takanori
:date: 2008-02-02 18:40:44
:email: 
:url: http://takanory.net/
:body:
キムチと納豆は合うよ!キムチはそんなに多くなくていいかも。
あと、ゆでたニラとあわせてニラ納豆もおすすめ。

ごみが少なくてすむので、この商品いいかも。

:comments:
:comment id: 2008-02-06.3632222129
:title: シャクシャクしすぎるならきざむとかでしょーか
:author: jack
:date: 2008-02-06 19:06:04
:email: 
:url: 
:body:
そうですね。白菜の厚いとこは少なめだと特にいいっす。または包丁で適当に細かくするとか
# 普通に売ってる切ってあるパックのキムチを想定してます。

ごみはあっしも strongly agree です。ゴミ、いっぱいでるもんね

:comments:
:comment id: 2008-02-07.8295477621
:title: Re:納豆革命
:author: しみずかわ
:date: 2008-02-07 02:10:30
:email: 
:url: 
:body:
キムチ＆納豆につっこみがハゲしいｗ。是非、スティック納豆をゲットして本当においしいか再検討してみたいところ。でも行動範囲内のコンビニではまだ見かけてない...。

%%%%%%%%%

:id: 531
:date: 2008-02-01 01:01:56
:title: これはよい:vimでCtrl+o, reddit ja, IE jsメモリリーク検出
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
vimでCtrl+o
-------------

via `一時的に挿入モードから抜ける方法があった - maeda.na@はてな`_

編集モード中に一時的にコマンドモードに移行し、コマンド完了時に自動的に編集モードに復帰。
間違ってCtrl+oを二回やると過去に開いたファイルが開かれる。vim初心者の僕には何が起きてるか分からなかったよ！バッファって何！？

.. _`一時的に挿入モードから抜ける方法があった - maeda.na@はてな`: http://d.hatena.ne.jp/maedana/20080129/1201614372


reddit ja
----------

via `田原悠西の日記(2008-01-31)`_

無くなったと思っていた日本語redditがちゃんと残っていた！ http://ja.reddit.com/r/ja
ありがとう、okujiさん！（ここでお礼を言っても伝わらない..

.. _`田原悠西の日記(2008-01-31)`: http://yusei.tdiary.net/20080131.html#c01


IE jsメモリリーク検出
--------------------

`[JS]MicrosoftからJavaScriptのメモリリーク検出ツール | コリス`_ via `ja reddit`_

とりあえずインストールだけしてみた。

.. _`[JS]MicrosoftからJavaScriptのメモリリーク検出ツール | コリス`: http://coliss.com/articles/build-websites/operation/javascript/773.html
.. _`ja reddit`: http://ja.reddit.com/r/ja



:extend type: text/html
:extend:
%%%%%%%%%

:id: 532
:date: 2008-02-02 23:55:00
:title: 日本一大きなジャンボシュークリーム: 洋菓ミノン(調布)
:categories: ['food']
:body type: text/x-rst
:body:
日本一というのは伊達じゃないかも。しかも普通に毎日売ってます。横にemobileのPCカードと500円玉を置いてみると、普通のシュークリームよりどれくらい大きいか分かります。

今日買ってきたのは630円のやつですが、店頭にはもっと大きいのも飾られてました。値札付いてなかったけどいくらくらいするんだろう？ちなみに、大きいやつの右にちょっと見えるのが普通のシュークリーム。下の方に２個並んでるのが今日買ってきたやつ。

日本一のシュークリーム、とか、世界一のシュークリームとかで検索してみても、大きさでこれに対抗できる製品は見つかりませんでした。ギネスブックに載っているであろう一番大きなシュークリームはさすがにもっと大きいんだろうなぁ。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 533
:date: 2008-02-03 23:31:13
:title: ML115 Challenge! 2
:categories: ['Unix', 'IT-PC']
:body type: text/x-rst
:body:
`ML115 Challenge! 1`_ で色々ハマりつつ構築したVMWare用環境も、Hostに debian 4.0r2 amd64 (debian-40r2-amd64-netinst.isoからインストール)して今のところ安定動作中。解像度を1024x768にできない問題も `コンセプトの壺 - システム開発のFAQ`_ を見てxorg.confの色深度を24から16に落としたら解決しました。

今はVMWare上にUbuntu Serverを入れたり、Windowsを入れたりして色々検証中。とりあえずFedora7はインストール後に動作が非常に不安定だったため削除。VMWareのVM環境作成ウィザードのOS一覧にも出てこないし、しょうがないのか。ところで、あのOS種別設定って、サポートOSかどうかが分かる以上の、何かの意味があるんだろうか？

*#VMWare Challengeにタイトル変えようかな..。*

.. _`コンセプトの壺 - システム開発のFAQ`: http://www.ibcs.jp/modules/xoopsfaq/index.php?cat_id=2
.. _`ML115 Challenge! 1`: http://www.freia.jp/taka/blog/525


:extend type: text/html
:extend:
%%%%%%%%%

:id: 534
:date: 2008-02-04 13:23:03
:title: ライブドアのアクセスポイントがFON対応に！
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
...という表題のメールが来た。

.. highlights::

  フォネロの皆さん、エイリアンの皆さん、こんにちは。
  ＦＯＮより皆様へ嬉しいお知らせがございます。

  山手線内約2200ヶ所のライブドアアクセスポイントが無料で利用できます！

  本日、2月4日、FONは株式会社ライブドアとの提携を発表いたしました。
  この提携によりフォネロの皆さんはライブドアの全てのアクセスポイントが利用可能となります。


おお！今のところアクセスポイントが全然見つからないFONだけど、これでもしかしたら少しは使うことがあるかも！？
でもLivedoor Wireless契約していたときも一度しかつながなかったし、今はアクセスポイント探す前にemobile使っちゃうからなあ。

で、メール文面の続き。

.. highlights::

  エイリアン向けフリーアクセスキャンペーンを実施 

  さて、エイリアンの皆さん、朗報です！
  本提携を記念いたしまして、本日より2ヶ月間「フリー・アクセス・キャンペーン」を実施いたします。

日本語で **エイリアン** と言われるとエイリアンVSプレデターを思い出してしまう。日本語訳してるのは誰なんだろう？


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-05.6752781921
:title: Re:ライブドアのアクセスポイントがFON対応に！
:author: jack
:date: 2008-02-05 09:51:16
:email: 
:url: 
:body:
ライブドアワイヤレスまだやってたのね(笑)。

個人的にはそこそこ使えました。が、十分あるような無いような微妙なエリア感でやめてしまったけど。

FONね、FONもねぇ～。実際FON であっしがアクセスポイント提供しても、ウチのおとなりさんくらいしか使えない。マンションの3Fだし、窓から見えるのは中学校の校庭だし。

%%%%%%%%%

:id: 535
:date: 2008-02-04 13:36:29
:title: easy_installでPILをインストールするhack
:categories: ['python', 'Plone']
:body type: text/x-rst
:body:
- `setuptoolsでPILをインストール - 三次元日誌`_
- `Problems Installing (Easy_Install) Pil – martin-geber.com`_


上記２サイトで書かれている方法だと、 import PIL; できなくなってしまう。
この問題に直面しているのがPloneで、以下のような議論も発生している。

`#5883 (PIL not found by plone when installed as an egg) - Plone - Trac`_

"I agree with Martin that this is a bug in the PIL egg and not in Plone."

PILの問題であって、Ploneの問題ではないというMartinの主張に同意する。 というコメントともにチケットのステータスは **closed defect: wontfix** に変更されている。

Image-SIG MLでの反応。

`Re: [Image-SIG] cannot import from PIL when easy_installed`_

ということで、何とかならないかいじってみた。

.. _`setuptoolsでPILをインストール - 三次元日誌`: http://d.hatena.ne.jp/ousttrue/20071117/1195253720
.. _`Problems Installing (Easy_Install) Pil – martin-geber.com`: http://www.martin-geber.com/weblog/2007/08/22/problems-installing-easy_install-pil/
.. _`#5883 (PIL not found by plone when installed as an egg) - Plone - Trac`: http://dev.plone.org/plone/ticket/5883
.. _`Re: [Image-SIG] cannot import from PIL when easy_installed`: http://www.mail-archive.com/image-sig@python.org/msg01373.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 536
:date: 2008-02-06 03:08:17
:title: C++のtemplateでBREW用にshared_ptrを書いてみた
:categories: ['work', 'cpp']
:body type: text/x-rst
:body:
追記： **修正版があります！** http://www.freia.jp/taka/blog/594

--------------

とりあえずVC++ではビルドできるけど、実機で問題なく使えるかどうかは不明。ARMコンパイラがちゃんとビルドしてくれれば動くかもしれない。夜中に寝ながら書いたので動作保証ありません、と言ったら職場で採用が見送られました。そんなコードですが、誰か使ってみてうまくいったら教えてください。次のプロジェクトで使ってみます。

いや、冗談ですが、半分本気です。なんて言うか、このへん動作保証できるBREWアプリ開発者が日本に何人いるのか非常に怪しい、と思うくらいにBREW開発って罠が多い気がする。

コード中では operators.h をインクルードしてるけど、これはソフィアあたりから取得してください。operator new 系をBREWのMALLOCで実装してるやつです。

以下、コード。


:extend type: text/x-rst
:extend:
.. code-block:: CPP

    #ifndef __BREW_SHARED_PTR_H__
    #define __BREW_SHARED_PTR_H__
    #include ".\operators.h"
    
    class shared_counter {
    private:
    	int count;
    public:
    	shared_counter():count(1){}
    	~shared_counter(){}
    
    	int inc() {return ++count;}
    	int dec() {return --count;}
    };
    
    template<class T>
    class shared_ptr {
    private:
    	T* px;
    	shared_counter* pn;
    
    public:
    	shared_ptr()
    		:px(0),pn(0)
    	{}
    
    	template<class T>
    	shared_ptr(T* p)
    		:px(p),pn(0)
    	{
    		pn = new shared_counter()
    	}
    
    	template<class T>
    	shared_ptr(shared_ptr<T> r)
    		:px(r.px),pn(r.pn)
    	{
    		pn->inc();
    	}
    
    	~shared_ptr()
    	{
    		if(pn && pn->dec()==0)
    		{
    			delete pn;
    			delete px;
    		}
    	}
    
    	template<class T>
    	shared_ptr& operator=(T* const p)
    	{
    		if(pn && pn->dec()==0)
    		{
    			delete pn;
    			delete px;
    		}
    		px = p;
    		pn = new shared_counter();
    		return *this;
    	}
    
    	template<class T>
    	shared_ptr& operator=(shared_ptr<T> const & r)
    	{
    		px = r.px;
    		pn = r.pn;
    		pn->inc();
    		return *this;
    	}
    
    	T& operator*() const
    	{
    		return *px;
    	}
    
    	T* operator->() const
    	{
    		return px;
    	}
    
    	operator T*() const
    	{
    		return px;
    	}
    };
    
    
    #endif // __BREW_SHARED_PTR_H__


:comments:
:comment id: 2008-06-29.4793257296
:title: あらかじめ言い訳を書いておく
:author: しみずかわ
:date: 2008-06-29 00:30:24
:email: 
:url: 
:body:
西尾さんのblog http://d.hatena.ne.jp/nishiohirokazu/20080628 からリンクされてしまったので、あらかじめ言い訳を書いておく。

・バグがあってもいじめないでね。
・shared_ptrは参照カウントよりリンクリストのほうが効率いい (thanks とやま)
・リンクリストにすればshared_counterいらないよね


:comments:
:comment id: 2008-06-29.8331508502
:title: やっぱりバグがあった
:author: しみずかわ
:date: 2008-06-29 02:57:13
:email: 
:url: 
:body:
・代入演算子で自分を解放していない！
・自己代入で変なことになる！

%%%%%%%%%

:id: 537
:date: 2008-02-08 01:15:56
:title: ついに会社に泊まり込み
:categories: ['work']
:body type: text/x-rst
:body:
ここ最近忙しい日々が続いていて、忙しくなるにつれてBlogを毎日書いたり、いくつかのMLに投稿したりと現実から逃避...じゃなくてリフレッシュしていたわけですが。

ついに。

会社に泊まり込みですよ(´･ω･`)ノ

とりあえず今の目標は、午前3時までに提案見積書を１つ作る。その後4時までにWebページを1ページ作って、仮眠したい。
起きたらBREWやる。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 538
:date: 2008-02-09 06:41:51
:title: 会社に2泊目
:categories: ['work']
:body type: text/x-rst
:body:
昨日は結局提案見積書に午前5時までかけてしまって、Webページは7時半に起きてから作った。気がついたら9時半も過ぎてみんな出勤してきた。

そして気がつくと深夜0時。なぜかおなかがすかない。BREWの画面作成に取りかかる。

そして気がつくと朝6時過ぎ。まだ眠くない。svn up したらメモリリークが増えた。

今日は夕方にWebページのレビューだ。先に多重解放をつぶすか。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-09.8220100514
:title: Re:会社に2泊目
:author: jack
:date: 2008-02-09 11:07:02
:email: 
:url: 
:body:
あまり根をつめて鬱とかにならないでね・・・
# けっこう実例をみているだけにねぇ・・・

:comments:
:comment id: 2008-02-09.5421849713
:title: Re:会社に2泊目
:author: koma2
:date: 2008-02-09 12:59:03
:email: koma2@lovepeers.org
:url: http://bloghome.lovepeers.org/daymemo2/
:body:
「2泊目」よりも、「2徹」の方が気になるなぁ。まぁ、もっとすごい事になっているフロアもあるわけだが…

:comments:
:comment id: 2008-02-10.9509014554
:title: Re:会社に2泊目
:author: しみずかわ
:date: 2008-02-10 11:35:51
:email: 
:url: 
:body:
短期のヘルプなので、まだ楽しい範囲。長期で関係する方々はそろそろ休養が必要かと...。

> koma2
1泊目は4Fの関係で、2泊目は7Fの関係ですた
今日も出社デス

%%%%%%%%%

:id: 539
:date: 2008-02-10 11:30:00
:title: マンションに外骨格が生えた
:categories: ['misc']
:body type: text/x-rst
:body:
会社泊まり込みは2泊で終了し一時帰国したところ、2日ぶりに帰ったマンションに外骨格が生えていた。ちょっとびっくり。

外壁改修は4月末までかけて行われる予定。そして工事費用が各戸に100万くらいかかります‥‥。たけえよ。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-11.7652615588
:title: Re:マンションに外骨格が生えた
:author: しみずかわ
:date: 2008-02-11 11:09:25
:email: 
:url: 
:body:
記事公開処理忘れてた...。

%%%%%%%%%

:id: 540
:date: 2008-02-11 12:36:11
:title: ATOK2008を購入したが
:categories: ['IT-PC']
:body type: text/x-rst
:body:
一言言いたい。

ATOKを買ったのに「この商品をチェックした人はこんな商品にも...」と言ってATOKの別セットをサジェストするのはやめていただきたい。Amazonとかでもそうなんだけど、別セットを大量に扱っているJustSystemとしては一太郎を薦めるとか辞書を薦めるとか他に方法があるんじゃないかと。あるいは買う前に「こんなATOKセットもありますよ」なら分かるんだけど..。
と言いつつ、そこまでの機能を用意するのが色々大変なのは分かるんだけどね。

そんなことよりも気になったのは、ダウンロード販売で購入したんだけど、ダウンロードした実行ファイルを実行すると「解凍先フォルダの指定」のダイアログで ``C:\Windows\system32`` デフォルト値なのはいかがなものかと。そこにsetup.exeとかを展開する気ですか。そうですか。（Vistaだけ？）

Vista+ATOK2006からVista+ATOK2008へ移行して安定環境！とか思ったのに、インストールする前にとても不安定な気持ちになりましたよ。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-11.5688530706
:title: Re:ATOK2008を購入したが
:author: Yujiro Nakamura
:date: 2008-02-11 13:19:30
:email: 
:url: 
:body:
サジェストはJust MyShopの話ですよね。僕も一昨日同じ事を思いました。特定商品の除外くらいできないものなんでしょうかねえ。
で、同じくATOK2008を買いましたが、展開先のデフォルトはカレントフォルダ（アーカイヴのあるフォルダ）でした。ちなみにVistaです。ATOK2006あたりから毎回ダウンロードで買ってますが、追加辞書なども含め基本的に展開先はカレントのようです。
何らかの理由でカレントフォルダの取得で不具合があったか……。ちなみに、Firefoxのダウンロードマネージャー上でダウンロードした自己展開EXEを起動すると、Firefoxのインストールフォルダがカレントになってしまうことがありますが、似たようなことが起きているのかもしれません。ってキャプチャー見るとデスクトップ上から起動してるみたいだし関係ないかな……。

:comments:
:comment id: 2008-02-11.8678175053
:title: Re:ATOK2008を購入したが
:author: しみずかわ
:date: 2008-02-11 14:14:29
:email: 
:url: 
:body:
> サジェストはJust MyShopの話ですよね。

ですです。ハンバーガー単品買ったら「ご一緒にダブルバーガーセットはいかがですか？」って言われた気分です(^^;;

展開先はなんでしょうね。自己解凍だからインストール済みのアーカイバDLLの設定とかは関係ないだろうし。ためしにネットワークドライブに置いて実行してみたら、そのフォルダが展開先デフォルト値になりました。Yujiroさんの言うとおり、カレントフォルダパス取得失敗という説が正解なんじゃないかなあ。

:comments:
:comment id: 2008-02-11.7614912808
:title: Re:ATOK2008を購入したが
:author: にわけん
:date: 2008-02-11 17:32:42
:email: niwaken@nsdev.co.jp
:url: 
:body:
私もATOK2008をAAA優待版でJustMyShopから購入しました。前回はダウンロード版だったのですが、今回はパッケージ版。何故かと言うと広辞苑セットが欲しかったから保存も兼ねて。
先程東京に帰国して今インストールが済んだ所です。

あのサジェスチョン、暇つぶしには良いのですが普段は結構鬱陶しい事が多いですね。
そんなサジェスチョンに釣られクマー(ノ ﾟДﾟ)ノって気分になるわたしゃひねくれ者ですか？(笑)

:comments:
:comment id: 2008-02-11.0748528265
:title: Re:クマー
:author: しみずかわ
:date: 2008-02-11 17:54:35
:email: 
:url: 
:body:
Amazonでなら時々釣られます...。あ、宅配DVDレンタルではよく辿るなあ。釣られても高々400円。

:trackbacks:
:trackback id: 2008-04-03.4522790159
:title: ATOK2008を5,000円以下でお得に買う方法
:blog name: ニートのFXブログ
:url: http://www.fxneet.com/cat7/atok20085000.php
:date: 2008-04-03 15:48:49
:body:
(&acute;･&omega;･`)まぁ　ATOKだけに限らず何でもそうなんで...

%%%%%%%%%

:id: 541
:date: 2008-02-14 23:55:00
:title: 支那麺はしご
:categories: ['food']
:body type: text/x-rst
:body:
最近なにかと縁のある築地・新富町界隈。会社の、いしださんに勧められて昼飯に ``支那麺はしご`` に行ってきました。写真はあんまりきれいに撮れてない（ケータイだし）ですが、けっこううまかったです。

- `ぱいこうだんだんめん／支那麺はしご 銀座本店`_

注文したのは、ぱいこうだんだんめん（排骨担担麺）。担々麺だけどゴマじゃなく醤油味。排骨はスープに浸かってるのに衣がパリッとしていて、無料のご飯に乗せて食べるとかなりいける。排骨丼作って欲しい。スープはあまり辛くなかったですが、後から来た客が「辛口で」と注文してたので調節が利くみたいです。

#支那ってATOK2008では変換出来ないね。差別用語だから？

ところで築地といえば築地場外ですが、最近は観光地化が激しいようです。そんな場外でおいしい店を探して彷徨うより、築地駅4番出口前の、某ネット名前出し禁止のお店の方が良いと思う今日この頃。



.. _`ぱいこうだんだんめん／支那麺はしご 銀座本店`: http://majin.myhome.cx/pot-au-feu/address/tokyo-chuohku/shinamen_hashigo_ginza_honten/shinamen_hashigo_ginza_honten-sichuan_hot_noodle_with_bbq_spare_rib.html

:extend type: text/html
:extend:
%%%%%%%%%

:id: 542
:date: 2008-02-15 01:37:00
:title: Python Developers Camp 2008 冬
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
Python Developers Camp 2008 冬 に参加します！

実は、３月第二週の終わり頃は、仕事が目一杯忙しくなることがほぼ確定していたりしますが、忙しいときこそ絶対参加の前提で公私とも進行してみようと思います。

ということで、絶対参加するために、トークに立候補してみたり。もう後には引けません..。

.. Topic:: 自動テスト実行環境 buildbot

  （担当：清水川） 

  buildbotはプログラムのユニットテストを実行し続けてくれる便利なツールです。ユニットテストが書かれていることが前提になりますが、ユニットテストとbuildbotがあれば常にプログラムを正しい状態に保ち続けることができます。あと、SeleniumによるGUIテストを行ったり、自動的にtracにチケットを発行してくれたり、なんてことも。

  参加対象者

  ユニットテストを有効に活用したい方。単調な作業はプログラムにおまかせ、なPythonista。


関連リンク。

- `Python Developers Camp 2008 冬 参加者募集`_
- `Python Developers Camp 2008 Winter | Google グループ`_
- `[Python-ml-jp 4235] Re: 「Python Developers Camp 2008 冬」のお知らせ`_


ついでに10分でイベント用ポートレット for plone を作ってみました。画像も勝手にでっち上げなのでいけてないです。フォントとか持ってないしorz。 そんなんでも欲しいという奇特な方向けDLリンク。

- http://www.freia.jp/taka/file/portlet_python_devcamp2008w.zip

.. _`Python Developers Camp 2008 Winter | Google グループ`: http://groups.google.co.jp/group/pydevcamp2008w
.. _`[Python-ml-jp 4235] Re: 「Python Developers Camp 2008 冬」のお知らせ`: http://www.python.jp/pipermail/python-ml-jp/2008-February/004232.html
.. _`Python Developers Camp 2008 冬 参加者募集`: http://www.python.jp/Zope/PyLog/1201102994



:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-15.5483601820
:title: Re:Python Developers Camp 2008 冬
:author: aihatena
:date: 2008-02-15 15:55:49
:email: 
:url: 
:body:
Bittenの代わりに立候補?
http://d.hatena.ne.jp/perezvon/20080210/1202664033


:comments:
:comment id: 2008-02-15.0918043758
:title: Re:Python Developers Camp 2008 冬
:author: aihatena
:date: 2008-02-15 16:21:32
:email: 
:url: 
:body:
... BuildBotを新たに作ったのかと勘違いしてました orz

%%%%%%%%%

:id: 543
:date: 2008-02-16 12:09:36
:title: NTT Flet's光マンションタイプになった
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
`NTT Flet's光マンションタイプがやってきた`_ でも書きましたが、先日うちのマンションが光Readyになりました。そして今日は宅内の切り替えを行って、我が家もついに！というか約4年ぶりに光にもどってきました！

アパートの時は普通に光が使えたのになあ...。

ということで、早速プロバイダ（ASAHI-NET）の契約を変更して接続。IPアドレスが変わった。DNS登録変更。完了。TTL=3600だから正午までには復旧するでしょう。

速度:

:Download: 3MB/s
:Upload: 6MB/s

今まで下りが1MB/sでemobileの方が早かったので、ようやく挽回できた感じ。それにしても登りの方が早いとは‥‥。サーバー設置にはうれしいですな！（特に重いもの流してないけど、VPNやVMWare Console接続とかする時役立ちそう）。

ところで、ほかのプロバイダがどうかは知らないけど、 `ASAHI-NET`_ のサービスはすばらしいと思う。ADSLから光の切り替えはWeb画面で数クリックだし、事前にクリックしておけば最初の接続時から実切り替えだし、今日は切替忘れてたけどemobileで繋いで即切替終わったし、基本料金安いし、固定IPオプション500円だし。でも、カスタマーサポート画面は使いにくい。そこだけが残念だ。


.. _`NTT Flet's光マンションタイプがやってきた`: https://www.freia.jp/taka/blog/527/
.. _`ASAHI-NET`: http://asahi-net.jp/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 544
:date: 2008-02-17 02:00:33
:title: svn for win32コマンドの文字化け対策でpysvn落ちる
:categories: ['python']
:body type: text/x-rst
:body:
Windows Vista に乗り換えてから、必要に応じて環境を再構築しているわけですが、今日はsvn.exe周りではまりました。今日のはVista関係ないんだけど、再構築はなかなか大変。

`svn-win32-1.4.6.zip`_ をインストールしてWindowsのコマンドラインでsvnコマンドを使えるようにしたところ、日本語メッセージが化けてしまいました。対策は `コマンドプロンプトでsvnコマンドの文字化け`_ に載っていたので、さっそくregeditを起動して::

  HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Command Processor

に文字列値としてAutoRunを作って値に::

  set APR_ICONV_PATH=<Subversionをインストールしたパス>\iconv

を設定。たしかに文字化けは解消されました。が、Python2.4.4とpy24-pysvn-svn140-1.5.0-742の組み合わせで以下を実行したところ、pythonが落ちました。

.. code-block:: Python

    import pysvn
    client = pysvn.Client()

とりあえずしょうがないのでレジストリを元に戻しましたが、なんで落ちるかな...。メッセージ化けてもたいして問題ないのでいいんだけど。


.. _`コマンドプロンプトでsvnコマンドの文字化け`: http://blog.noworks.net/uma/archives/000909.html

.. _`svn-win32-1.4.6.zip`: http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=8100&expandFolder=8100&folderID=8100


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-17.6535378958
:title: Re:svn for win32コマンドの文字化け対策でpysvn落ちる
:author: 常山
:date: 2008-02-17 03:47:34
:email: 
:url: 
:body:
なるほど、Instant Djangoでもsvn-win32-1.4.6を使っていたので
svn updateに失敗したようですね。
原因が分かりました。
ありがとうございます:)

:trackbacks:
:trackback id: 2008-02-17.5025776344
:title: [Python]巡回
:blog name: 常山日記
:url: http://d.hatena.ne.jp/johzan/20080217/1203186472
:date: 2008-02-17 03:28:24
:body:
 svn for win32コマンドの文字化け対策でpysvn落ちる Pythonで全角から半角への変換 Cygwin SQLAlchemy Install Puzzler Pythonの多次元リストをどのように作るべきか Python でsnmp　プリンタの印刷カウント監視 nkf Python Windows で nkf pythonを使う Python MySQL 文字

%%%%%%%%%

:id: 545
:date: 2008-02-18 23:15:14
:title: また忙しくなる...ピークはDevCampのあたり？
:categories: ['work']
:body type: text/x-rst
:body:
ということで、今日の客先訪問でまた忙しくなる日程が決定しました（笑

ピークは3月7日あたりになりそうですが、ピークを今週に持ってくれば後半は楽になるはず...いやまて、今週は別のピークがあるんだった。まあでも納品前にスケジュールに追い立てられるより先にこなした方がいいよね。

ところで、DevCampの参加申し込み締め切りが2/28(木)まで延長されたようです。お近くの方は是非お立ち寄りください。八王子から大体2時間くらいです。

Talks用の準備も今週末には用意しないとなー。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-02-19.1964895139
:title: Re:また忙しくなる...ピークはDevCampのあたり？
:author: chewganabira
:date: 2008-02-19 01:46:37
:email: 
:url: 
:body:
忙しさを増やしてしまっているようで、すみません。

:comments:
:comment id: 2008-02-19.8584711885
:title: Re:また忙しくなる...ピークはDevCampのあたり？
:author: しみずかわ
:date: 2008-02-19 11:40:59
:email: 
:url: 
:body:
いやいやいやｗ
仕事があるのは良いことです:-)

%%%%%%%%%

:id: 546
:date: 2008-03-02 23:01:35
:title: VistaでVMWare Serverが固まる
:categories: ['IT-PC']
:body type: text/x-rst
:body:
最近忙しくて2/18以来半月ぶりのblog更新です。

来週のPythonキャンプに向けてbuildbot/SeleniumRC/Tracのデモ環境を用意しようとVMWareにWindowsXPとUbuntu7 Desktop, Server の３つのOSをセットアップしたのですが、HostであるVistaを再起動したあとに起動しようとしたらHDDにアクセスしっぱなしになり20分後くらいにWatchDocTimerか何かでOSがリブートしました（泣

以前にも同じ事があったので、何か情報はないかとGoogle検索してみたところ、以下の記事がヒット。

.. Highlights::

  1. 仮想マシンの Advanced オプションで disable memory page timing にチェックをいれる。

  2. 仮想マシンの環境設定ファイル .vmx に mainMem.useNamedFile = "FALSE" の１行を加える。

  -- `VMware が頻繁にディスクアクセスして OS 全体が固まる件`_

これだ！と思い、設定してVMWareのGuestOSを起動したら、さっきと同じように固まってしまいました...（大泣  で、HDDアクセスから帰ってきてくれるかもしれないと思いつつ待ってる間暇なのでこのエントリを書いてます。今10分ちょっと経過。

ところで、以前同じ現象に遭遇した際は数分間固まった後で復活した後はどのVMもすぐに起動するようになったので、もしかしたら一度起動すればそのあとは平気になるのかもしれません。そういう理由なのかどうか分かりませんが、今日の昼間にデモ環境セットアップしようと起動したときには数十秒固まったものの起動できたのですが、もしかしたら新規作成したVMのGuestだったからなのかもしれません。前述の記事によると、GuestOS用に仮想メモリを使うために仮想メモリファイルへの書き込みが頻繁に行われ...ということだったので、メモリ1MBくらいの仮想マシンを用意してこれを最初に起動するようにすればうまくいくかも。


ところで、放置していたHostOSは15分くらいの時点でHDDアクセスが止まって、ブルースクリーンになりました。 NO_PAGES だって。

.. _`VMware が頻繁にディスクアクセスして OS 全体が固まる件`: http://www.drk7.jp/MT/archives/001215.html


:extend type: text/html
:extend:


:comments:
:comment id: 2008-06-03.5466585459
:title: Re:VistaでVMWare Serverが固まる
:author: ukky
:date: 2008-06-03 17:25:47
:email: ukichon@gmail.com
:url: 
:body:
私も同じ症状で困っていました。
記事をみてなるほどと思い、ダミーの仮想OSから起動させるのを試してみました。メモリは最低が4MBからだったので1MBにはできませんでした。
仮想OSを作ってからそちらを起動したら・・・以前と同様にHDDのアクセスランプつきっぱなしになって15分ほど何も操作できなくなりました。
ちなみに私の環境はVista Ultimate、Core2Duo T9300、4GBRAMです。次の手段としてはVmserver2.0が出たそうなのでそちらに切り替えてみることです。

:comments:
:comment id: 2008-06-04.9749461492
:title: Re:VistaでVMWare Serverが固まる
:author: しみずかわ
:date: 2008-06-04 23:49:36
:email: 
:url: 
:body:
コメントどうもです(^^
こちらも未だに改善できず。実験のたびにBlueScreenを見ることになるのでなかなか・・・。
最近はGoogle等で、対策がうまくいった例が多く引っかかる様になってきたので、もうちょっと頑張れば何とかなるのかも？

VMWare 2.0はまだちょっと恐いな。

:comments:
:comment id: 2008-06-06.7645271929
:title: Re:VistaでVMWare Serverが固まる
:author: ukky
:date: 2008-06-06 13:16:09
:email: ukichon@gmail.com
:url: 
:body:
Vmserver2.0入れてみました。Consoleが専用アプリではなくブラウザのUIらしいです。
インストールできたのですがホスト起動時に「vmware-hostd が停止しました」というエラーが起きます。
インストール後にデスクトップにできるショートカットアイコンは1.0.5のときはConsoleの起動でしたが、
2.0ではブラウザが立ち上がってローカル内のどこかにアクセスしようとするのですがページが表示できません。とのこと。
結局何もできず、今度はVMplayerを試してみました。
VMplayerだとホストが停止することなく仮想OSを起動できました。
しかし仮想イメージの種類によってエラーが起きて起動できないものもありました。
はっきりしてませんが、Vistaで使用していた仮想イメージはエラーがでて、以前作ってあった仮想イメージだと起動できた感じです。
結局気持ち悪くて1.0.5に戻しました。
でもこんなことを繰り返していて自分のマシンに不信感を感じ、結局マシン自体リカバリーしてしまいました。

ちなみにこんなサイトを見つけました。
http://jp.brothersoft.com/downloads-vista-vmware-server.html
ここを見ると、1.0.3がVistaに対応しているように書いてあるんですが真偽はわかりません。
ホストOSとしての対応状況が明記されていれば、Vistaに対応しているものを入れたいのですが・・・
マシンも綺麗になったので1.0.3を入れようかなと思っているのですが。
この辺の知識が薄くたいした情報にならずすみません。
%%%%%%%%%

:id: 547
:date: 2008-03-06 02:10:00
:title: プレ合宿（会社）
:categories: ['work']
:body type: text/x-rst
:body:
今週金曜日から `Python Developers Camp 2008 冬`_ が始まります。が、その前に会社に泊まり込みました。2週間くらい前にも２連泊したので堅い床での仮眠にも慣れてきました。

今夜は帰れるだろうか...。

.. _`Python Developers Camp 2008 冬`: http://www.python.jp/Zope/PyLog/1201102994


:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-06.2787505385
:title: Re:プレ合宿（会社）
:author: masaru
:date: 2008-03-06 22:48:00
:email: 
:url: 
:body:
そのまま永眠だけは気をつけて頑張ってください

%%%%%%%%%

:id: 548
:date: 2008-03-07 00:15:26
:title: プレ合宿２
:categories: ['python', 'work']
:body type: text/x-rst
:body:
今夜も泊まり。ありえん。

まあ金曜の分の仕事を昨晩と今からで片付けようとしてるんだけど。気分は家族旅行の日程を開けるために残業し続けるお父さん。過労危険。

明日の予定。

- 13:30まで会社。
- 14:30に自宅出発。
- 14:55調布発。
- 17:30松本着

俺、この仕事が落ち着いたら `Python Developers Camp 2008 冬`_ に行くんだ。

.. _`Python Developers Camp 2008 冬`: http://www.python.jp/Zope/PyLog/1201102994


:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-07.4811185669
:title: Re:プレ合宿２
:author: voluntas
:date: 2008-03-07 01:21:21
:email: 
:url: 
:body:
って、明日じゃないですかでぶきゃんｗ

%%%%%%%%%

:id: 549
:date: 2008-03-11 23:55:00
:title: Python Developers Camp 2008に行ってきました
:categories: ['python']
:body type: text/x-rst
:body:
幹事の方々は忙しい中本当にお疲れ様でした。
今回は全く何も手伝えなかったので心苦しい限りです。

参加した皆さんの感想が以下のURLで公開されています。

- `Python Developers Camp 2008 Winter 開催情報`_

ところで、自分は合宿期間中も明け方まで仕事してました＞＜

ていうか感想を書く時間がとれません！＞＜

ということで、buildbotのプレゼン資料だけ上げておきます。

.. _`Python Developers Camp 2008 Winter 開催情報`: http://www.python.jp/Zope/workshop/devcamp2008w/

:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-12.3159994271
:title: Re:Python Developers Camp 2008に行ってきました
:author: voluntas
:date: 2008-03-12 08:15:17
:email: 
:url: 
:body:
ありがたく読ませていただきます:^)

:trackbacks:
:trackback id: 2008-03-14.7298381049
:title: Solarisも一緒にBuildbot？
:blog name: 渋日記
:url: http://sky.ap.teacup.com/shibu/32.html
:date: 2008-03-14 22:18:50
:body:
Buildbotを使って、仮想環境も利用すると一台で多数OSのテストを行える、というのがPyDevCampで清水川さんに教えて頂いたことです。マルチOSなテストは今はしてないけど、いつかはこういう環境を用意したいと思います。PySpecもwxPytnonがない状態でのテストも一緒にできたらいいな、と思うし。あ、そんなときのvirtualenvか。でもBuildbotと共存できるかどうかは調査が必要かな。

builder by ZDNetの記事によると、Intel CPUのMacOS XマシンにはSolarisもインストールできるとか。この記事はBootcampだけど。もし仮想PCとして起動できるなら、MacOS X, Windows, Linux, Solaris, FreeBSDなど、多くのテストを一台でまかなえるようになるのかな？これならXeonのMac Proを買ってもエコな気がする。買わないけど。

---

この記事と関係ないけど、Firefoxのスペルチェック機能って便利だね。僕みたいにちょくちょくプアな英語力で英語を書こうという人には。FireFoxアドオンでPySpecのGUIを作るってのはどうかな？できるか分からないけど。FireFoxアドオンもちょっと調べてみよう。

%%%%%%%%%

:id: 550
:date: 2008-03-12 04:47:51
:title: ポスト合宿
:categories: ['work']
:body type: text/x-rst
:body:
ありえん。ちょう、ありえん。

しかし先週泊まったときより大分暖かい。春が近いなあ。

:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-12.5711200619
:title: Re:ポスト合宿
:author: masaru
:date: 2008-03-12 23:19:32
:email: 
:url: 
:body:
今年もみんなでガンダム鑑賞したのかなあ？

:comments:
:comment id: 2008-03-13.6425963593
:title: Re:ポスト合宿
:author: ryousei
:date: 2008-03-13 09:04:03
:email: 
:url: 
:body:
合宿では、ありがとうございました。お体お大事に。

%%%%%%%%%

:id: 551
:date: 2008-03-17 05:15:53
:title: ねむたいでござる
:categories: ['work']
:body type: text/x-rst
:body:
あれ？もう朝？

このWeb業界、短納期に耐えうる方法は何があるのか。

- パッケージソフト化して売り切り
- ライブラリを充実させて速攻組み合わせ
- 複数のパッケージを扱い最適を選ぶ
- 複数のフレームワークを扱い最適を選ぶ
- HTMLのテンプレ化を高速にこなす方法を編み出す

結局は、開発規模や要員のスキルに左右される気がする。

そして作業者の工数がかかるということはベースの値段が下がらないということになり、固定金額のかかるある程度高いパッケージソフトは不利なんじゃなないかと思えてくる。でもパッケージがマッチする要件なら使った方が。。。案件による、という答えしか出てこない。。。眠くてまとまりがない。。。

寝よう。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 552
:date: 2008-03-17 13:24:44
:title: Joel記事から本購入。誘導されている。
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`Joelに聞く、「優れた開発者」の要件・心構え・努力すべきこと：CodeZine`_ via reddit.

やはり良い開発者を見極めるのも重要だね。ということで紹介されていた本を予約してみる。3/20発売予定。

- `Amazon.co.jp： ソフトウェア開発者採用ガイド: Joel Spolsky,青木 靖: 本`_

そしてもう一冊。著者曰く、心構えというかエッセイというかQAだけじゃなくて全体的なこと。らしい。達人プログラマー（黒）みたいな感じかな。

- `Amazon.co.jp： プロジェクトを成功に導く品質管理 ~ソフトウェア開発でのマネージャの役割: 橋本 健一: 本`_


そういえば、技術書的なものを読むのは久々かもしれない。


.. _`Joelに聞く、「優れた開発者」の要件・心構え・努力すべきこと：CodeZine`: http://codezine.jp/a/article/aid/2292.aspx?p=1

.. _`Amazon.co.jp： ソフトウェア開発者採用ガイド: Joel Spolsky,青木 靖: 本`: http://www.amazon.co.jp/dp/4798115827

.. _`Amazon.co.jp： プロジェクトを成功に導く品質管理 ~ソフトウェア開発でのマネージャの役割: 橋本 健一: 本`: http://www.amazon.co.jp/dp/4774133027


:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-18.2913204830
:title: Re:Joel記事から本購入。誘導されている。
:author: にわけん
:date: 2008-03-18 17:51:32
:email: 
:url: 
:body:
お、Joelさんのその本はわしも予約しました。
そして下の本は当人の所に行けば、もらえるかもしれません。

:comments:
:comment id: 2008-03-21.3352813540
:title: Re:Joel記事から本購入。誘導されている。
:author: しみずかわ
:date: 2008-03-21 00:18:56
:email: 
:url: 
:body:
> 下の本

当人の印税のためにも買ってあげないとｗ
いや、実際良い本らしいということなので。

%%%%%%%%%

:id: 553
:date: 2008-03-21 00:27:35
:title: ソニーのデジタルフォトフレームほしい！
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
`ソニーが全力で作り込んだデジタルフォトフレーム「S-Frame（エスフレーム）」速攻実機レビュー - GIGAZINE`_

かっこいい！！

`DPF-V900 DPF-V700 | 商品情報 | デジタルフォトフレーム エスフレーム | ソニー`_

V700の方でいいなあ。

以前からデジタルフォトフレームは欲しかったんだけど、画面が小さかったり機能の割に高かったりでなかなか買う気になれなかった。当時検討したのが1万円少々なので、それに比べるとV700でも2万5000円で倍する。けどそれにみあう十分なデザインと機能があるんじゃないかな、これ。

5月9日発売。ほしいなあ。

.. _`ソニーが全力で作り込んだデジタルフォトフレーム「S-Frame（エスフレーム）」速攻実機レビュー - GIGAZINE`: http://gigazine.net/index.php?/news/comments/20080320_sony_dpf/
.. _`DPF-V900 DPF-V700 | 商品情報 | デジタルフォトフレーム エスフレーム | ソニー`: http://www.sony.jp/products/Consumer/Peripheral/DPF/V900V700/index.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 554
:date: 2008-03-22 15:38:16
:title: Joel本「ソフトウェア開発者採用ガイド」が届かない
:categories: ['misc']
:body type: text/x-rst
:body:
Amazonからメールが来た。在庫が確保できなくて発送が遅れるらしい。

::

  未発送の商品：
  配送予定日： 2008/4/14 - 2008/4/28 1 点 ソフトウェア開発者採用ガイド


4月半ばって。遅れるってレベルじゃねーぞ！

キャンセルして駅前の真光書店で買った方が早そうだ‥‥。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-22.1605072404
:title: Re:Joel本「ソフトウェア開発者採用ガイド」が届かない
:author: にわけん
:date: 2008-03-22 16:49:21
:email: 
:url: 
:body:
私もアマゾンキャンセルして、本屋で今日買ってきました。
ついでにドメイン駆動その他も確保、あっさり万券が消滅していきました。

:comments:
:comment id: 2008-03-22.7755267260
:title: 買ってきた
:author: しみずかわ
:date: 2008-03-22 18:06:16
:email: 
:url: 
:body:
駅前の本屋で買ってきました。
うう、現金を使うのは精神的につらい...。

:comments:
:comment id: 2008-03-22.7499322602
:title: Re:Joel本「ソフトウェア開発者採用ガイド」が届かない
:author: mshibata
:date: 2008-03-22 21:25:51
:email: mshibata@emptypage.jp
:url: 
:body:
出たらすぐ欲しい本やCDはAmazon.co.jpの予約では買わないのが定石ですよん。
# 出てから「在庫あり」になってたら大丈夫だけど、
# 予約の時点でカートに入れて発売日に入手できたためしがありません。

:comments:
:comment id: 2008-03-22.8544135354
:title: Re:Joel本「ソフトウェア開発者採用ガイド」が届かない
:author: しみずかわ
:date: 2008-03-22 23:57:34
:email: 
:url: 
:body:
> Amazon.co.jpの予約では買わないのが定石ですよん。

うぅ。Amazonで予約ってしたこと無かったんで...。
Amazon HACKS に載ってなかったし！（違
%%%%%%%%%

:id: 555
:date: 2008-03-22 23:29:22
:title: レトルトカレー大会
:categories: ['food']
:body type: text/x-rst
:body:
投稿555記念。レトルトカレー大会。

aihatena_ が蔵前のインドスパイス専門店 `アンビカトレーディング`_ で
レトルトカレーを買ってきました。ということで、突然レトルトカレー大会です。

で、aihatenaが内輪のメーリスでレトルト食おうとメールを流したところ、
総勢8人がうちに集まりました。ってレトルトで何で8人も...楽しい奴らだな（笑

8人だとうちの5合炊きのジャーでは足りないと思ってナンの素を400で買ってきて
ホットプレートで焼いてみました。これが意外とけっこういける。

カレーの方はパラックパニールというほうれん草とチーズのカレーがうまかった。
サグパニールとは違うのか？よくわかりません。ダル（豆）はあまり人気無かった。
あれ？バターチキンだと思って食べてたのはどれだろう？よくよく見たら全部
ベジタブルカレーだ。チキンは・・・あれぇ？

ということで、カレーのあとはブラフとニムト。なんか俺は仕事してたケドorz


3/23追記:
----------
このblogをみた母からメールが届いた::

  レトルトカレーを買った店を表示してみたら危険なネットに　つながったそうで即座にけしたのですが変な店らしいです。

変な店とちがうよ！いや変な感じのサイトだけど！ ということで、変じゃない紹介サイトを追記しておくのである。

- `アンビカトレーディング 訪問記 - Niki' Kitchen`_
- `アンビカトレーディング株式会社 - ｉタウンページ`_

.. _aihatena: http://www.freia.jp/aihatena/
.. _`アンビカトレーディング`: http://www.ambikajapan.com/
.. _`アンビカトレーディング 訪問記 - Niki' Kitchen`: http://blog.goo.ne.jp/nikikitchen/e/ca6c1a1b45eb3de3b45b9019e6597df5
.. _`アンビカトレーディング株式会社 - ｉタウンページ`: http://nttbj.itp.ne.jp/0358226655/index.html?Media_cate=populer


:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-23.0255253246
:title: Re:レトルトカレー大会
:author: masaru
:date: 2008-03-23 00:00:25
:email: 
:url: 
:body:
ナンつー大会ｗ

:comments:
:comment id: 2008-03-23.1482488498
:title: Re:レトルトカレー大会
:author: しみずかわ
:date: 2008-03-23 15:19:09
:email: 
:url: 
:body:
しまった、ナンがうまくいったことに気を取られて重要なことを書き忘れた！
カレーはレトルトながらも「インド料理」の味をちゃんと再現していて、レトルトカレーというよりはレトルトインド料理。値段も300円少々とリーズナブルです。近所で売ってたら定期的にストックしたいくらいに美味しくて安いと思います。

ということで「レトルトカレー大会」改め「インド料理試食会」て事にしよう。
%%%%%%%%%

:id: 8d6430cb30e030c8
:date: 2008-03-23 00:44:43
:title: 赤ニムト
:categories: ['boadgame']
:body type: text/x-rst
:body:
６ニムトよりも戦略の高い赤ニムト。1ゲーム30分くらい。プレーヤーは、aihatena,Ric,うびぞ,tad,ありの,Go,俺。2ペアいるので5人対戦。

1回目は+13点で俺トップ。2回目は俺0点で3位。

熱い、ぜー。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 557
:date: 2008-03-26 12:53:30
:title: インド大使館 桜バザー 今年は？
:categories: ['Event', 'misc', 'food']
:body type: text/x-rst
:body:
毎年4月頭に行われているインド大使館の桜バザー。屋台がたくさん出ていろんなカレーを食べられます。

- 2006年の写真 `インド大使館 桜バザー2006 - 清水川Web`_
- 2006年のblog `インドに行ってきました - 清水川Web`_

今年は今週末あたりかなーと思って調べてみたら、なんと大使館が千鳥ヶ淵から移転しているという情報を発見！移転先は仮の場所らしいと言うき情報も発見したので、もしかしたら今年は行われないのかも？今日の時点では大使館のサイトでの告知は見あたりません。残念。

- `インド大使館で毎年開催されるという 桜バザーの今年の日程を知りたいです。 一度... - Yahoo!知恵袋`_

ところで、2006年のblogのタイトル ``インドに行ってきました`` って、桜バザーとかで検索に引っかからないんですけど‥‥。SEO弱いなあ。どうなのよ？＞2年前の自分


.. _`インド大使館 桜バザー2006 - 清水川Web`: http://www.freia.jp/taka/photo/india2006

.. _`インド大使館で毎年開催されるという 桜バザーの今年の日程を知りたいです。 一度... - Yahoo!知恵袋`: http://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q1115524151

.. _`インドに行ってきました - 清水川Web`: https://www.freia.jp/taka/blog/330



:extend type: text/html
:extend:


:comments:
:comment id: 2008-03-27.8217720133
:title: Re:インド大使館 桜バザー 今年は？
:author: aihatena
:date: 2008-03-27 10:03:42
:email: 
:url: 
:body:
Sakura Charity Bazaar でよいのでは。
2008情報は無いようですが。。

%%%%%%%%%

:id: 558
:date: 2008-04-01 23:56:35
:title: いなり寿司パーティー
:categories: ['food']
:body type: text/x-rst
:body:
最近なんだか変なパーティーばっかり開いてる気がする。とみた宅で『我が家のお稲荷さま。』をのコミックを読んだら無性に食べたくなった。

ということで、お稲荷さん3種。新宿の京王デパート地下と、西友の地下から調達しました。1000円分のいなり寿司を2人で食べるのはほんの少し多かったかもしれない。味はそれぞれが大分違っておもしろい。西友の地下で売ってる普通のやつが一番地味な味だった。もうちょっと色んな具が入った楽しい感じのいなり寿司ってどこかに売ってないだろうか。京樽とかにいけばありそうな気もする。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-04-02.3707618519
:title: Re:いなり寿司パーティー
:author: jack
:date: 2008-04-02 10:06:10
:email: 
:url: 
:body:
東京駅の新しい商業施設(いわゆるエキナカ)に一個単位でいろいろないなりを売ってる店があったよ。
値段も84円から上も150円はいってなかったと思う。


:comments:
:comment id: 2008-04-02.9327820049
:title: Re:いなり寿司パーティー
:author: しみずかわ
:date: 2008-04-02 23:02:13
:email: 
:url: 
:body:
これですね！早速行ってみます！

商品紹介：株式会社 豆狸
http://www.mameda.co.jp/item/
%%%%%%%%%

:id: 559
:date: 2008-04-02 00:17:45
:title: 四角い頭を丸くする算数の問題をPythonで解いてみる
:categories: ['python']
:body type: text/x-rst
:body:
今日、電車で見かけた算数の問題。

.. topic:: 回文数

  "121" や "3333" のように右から読んでも左から読んでも同じ並びになる数値を回文数とよぶことにします。
  この回文数について以下の問いに答えなさい。

.. topic:: 問い1

  5を掛けると回文数となる、3桁の数値のうち最大の数値を答えなさい。


この問題をPythonでプログラムを書いて解いてしまったんだけど、落ち着いて考えれば暗算で解けそう。というか後から考えてみたら暗算で解けた。あああ、もったいないことをした。

ということで以下コード。



:extend type: text/x-rst
:extend:
.. code-block:: Python

    In [1]: def check(n):
       ...:     sn = str(n)
       ...:     for i,s in enumerate(sn):
       ...:         if sn[-(i+1)] != s:
       ...:             return False
       ...:     return True
    
    In [2]: for n in range(999,0,-1):
       ...:     if check(n*5):
       ...:         print n, n*5
       ...:         break
       ...:
    119 595


答えは119らしい。5倍した回文数は595。実はもっと大きな値になると思っていた。

今度は証明っぽく解いてみる。長いこと証明書いてないので書き方の定石は忘れちゃった。

.. Topic:: 問い1の証明

  最大値が999なので、5倍した最大値は4995。ところで5倍すると言うことは下一桁がかならず0か5になるので、最上位桁も0か5にならねばならない。しかし最上位桁が0というのはこの場合あり得ないため、下一桁は5であると言える。また、5倍した値が4桁だと仮定すると積は5000～5999ということになるが、最大を超えるのでこれもありえない。

  ここで3桁で最上位桁が5の値について考えると、商は5n5となり、nは0～9どれでも5で割れるので、最大値の9を採用する。

  以上により、商=595, 解=595/5=119.

とけた。ポイントが分かれば簡単やね。

書き写し間違ってるかもしれないけど問い2、問い3。また電車の中で考えよう...

.. Topic:: 問い2

    15で割り切れる3桁の回文数のうち、最も大きい数を答えなさい。なお答えに至る過程についても述べなさい。

.. Topic:: 問い3

    15で割り切れる4桁の回文数のうち、商が回文数となる値を答えなさい


# 回文数で検索するとけっこうヒットする


:comments:
:comment id: 2008-04-02.9148261860
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: mshibata
:date: 2008-04-02 01:22:04
:email: mshibata@emptypage.jp
:url: 
:body:
わーい、「続きを読む」前に正解を出せたぞ。

「5倍した値が4桁だと...」の部分はいらないような気がしますが……。
# あとs/商/積/？

1. 5の倍数では1の位の数字は5または0である。
2. 3桁の回文数はABAの形をとる。ただしAは0でない。
3. 1., 2. から求める回文数は5n5の形をとる。この形をとる最大の整数は595である。
4. 595/5=119、よって答は 119。
おしまい

自分はこんな感じで解きましたが、ロジカルになってるかな。
# 関係ないけどわたくしも幼少のみぎり四角い頭を丸くするところにかつて通っておりました。

Pythonで書くなら……、これじゃだめ？（笑）
print [x for x in range(100, 1000) if x % 5 == 0 and x / 100 == x % 10][-1] / 5

:comments:
:comment id: 2008-04-02.9877627627
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: しみずかわ
:date: 2008-04-02 01:39:48
:email: 
:url: 
:body:
>「5倍した値が4桁だと...」の部分はいらないような気がしますが……。

「5を掛けると回文数となる3桁の数値」なので、
「3桁の回文数」ではなくて「3桁の数字 * 5 = 回文数」なのですよ。（電車で見間違えてなければ）

> # あとs/商/積/？

おおう。修正！


:comments:
:comment id: 2008-04-02.6014387001
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: mshibata
:date: 2008-04-02 02:23:23
:email: mshibata@emptypage.jp
:url: 
:body:
> 「3桁の回文数」ではなくて「3桁の数字 * 5 = 回文数」なのですよ。

あーっ、なるほど！　失礼しました。
くやしいから修正したワンライナーを……。

max(x for x in range(100, 1000) if str(x * 5) == ''.join(reversed(str(x * 5))))
# 1000 のところの桁を増やしてくとちょっと興味深い（総当たりだから超遅いけど）。

:comments:
:comment id: 2008-04-02.9063441259
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: jack
:date: 2008-04-02 09:58:27
:email: 
:url: 
:body:
一応暗算でできた。ABBAは 0 でも5 でもなりたたないからABAで、あとはすぐですね。でも問2はそしたら一瞬じゃないの？

:comments:
:comment id: 2008-04-02.1659422107
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: aihatena
:date: 2008-04-02 10:52:46
:email: 
:url: a2:585_a3:5445
:body:
解けた。回答は↑のリンクに。
問2：5x5として(5+x+5)mod3=0なxの最大値
問3：5xx5として(5+x+x+5)mod3=0なxは3通り。
　　　15で割って回文数になるのは1通り。

:comments:
:comment id: 2008-04-02.5744168278
:title: たくさん釣れたｗ
:author: しみずかわ
:date: 2008-04-02 23:12:54
:email: 
:url: 
:body:
みんなに解かれちゃって、解く楽しみが。。悔しいので短く速くしちゃう。

> max(x for x in range(100, 1000) if str(x * 5) == ''.join(reversed(str(x * 5))))

max(x for x in xrange(999,99,-1)if`x*5`==`x*5`[::-1])

上限を上げると確かに興味深い解が...


:comments:
:comment id: 2008-04-03.7685306074
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: Anonymous User
:date: 2008-04-03 02:36:09
:email: 
:url: 
:body:
おー、コメント付いてますね。
呑み会でしこたま飲んだ後、電車の中で頭の中ぐるぐるしながら暗算で解いた記憶がｗ

:comments:
:comment id: 2008-04-03.8153937773
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: ocs
:date: 2008-04-03 02:36:55
:email: 
:url: 
:body:
名前入れ忘れました。

:comments:
:comment id: 2008-04-03.4895232626
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: ocs
:date: 2008-04-03 07:48:10
:email: 
:url: 
:body:
>上限を上げると確かに興味深い解が...
以下問い1のn桁版の証明。

問い：5を掛けると回文数となる、3桁の数値のうち最大の数値を答えなさい。
回答：
5倍して得られる数の1の位は0, 5 のいずれかであるため題意を満たすのは5.
よって、得られる回文数は以下のいずれかである.

i) 5○○○○...○5 (n+1桁)
ii) 5○○○○...○5 (n桁)

i) の場合、5で割るとn桁にならないため不適. ii) の形について考える。
求める数を X(n) とすると回文数は 5X(n) であり、

5X(n) = 5*10^n + a1*10^(n-1) + a2*10^(n-2) + ... + an-1*10 + 5
(ただし a1, a2, ..., an-1 ∈ {0, 1, ... , 9})

両辺を5で割り、

X(n) = 10^n + 2a1*10^(n-2) + 2a2*10(n-3) + ... + 2an-1 + 1

上記の形から、a1, a2, ..., an-1 の値がいくつであっても X(n) は整数となる。
題意を満たすように a1, a2, ..., an-1 の値を定めると、

a1 = a2 = a3 = ... = an-1 = 9 

よって、得られる X(n) は

X(n) = 10^n + 2*9*10^(n-1) + 2*9*10^(n-2) + ... + 2*9 + 1
     = 10^n + 1 + 2*9*(10^(n-1) + 10^(n-2) + ... + 1)
     = 1000...0 + 1 + 18*(111...1)
     = 1000...0 + 1 + 199...8
     = 1199...9

以上.

:comments:
:comment id: 2008-04-03.0748985867
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: しみずかわ
:date: 2008-04-03 10:11:15
:email: 
:url: 
:body:
しまった。max()だと高速じゃないや。().next()にしないと。
証明おもしろい。学生時代にこういう問題に遭遇したかったなあ。


:comments:
:comment id: 2008-04-03.6611050430
:title: Re:四角い頭を丸くする算数の問題をPythonで解いてみる
:author: mshibata
:date: 2008-04-03 20:54:21
:email: mshibata@emptypage.jp
:url: 
:body:
> max(x for x in xrange(999,99,-1)if`x*5`==`x*5`[::-1])

おお、スライスのステップ数に負の値を入れるとそうなるんですか。reversed() に入れても元のシーケンスと同じ型でじゃなくてジェネレータで返ってきたから、「おや」とは思ったんですが。
`x` も、こんなシンタックスシュガーが Python にあったのかという感じで、なんだか意外です。

いいこと知りました。

:comments:
:comment id: 2008-04-03.7923662892
:title: repr
:author: しみずかわ
:date: 2008-04-03 22:53:12
:email: 
:url: 
:body:
`x` は __repr__ が呼び出されます。str(x)は __str__ が呼び出されます。
str()の代替ではないのでご注意を...

:comments:
:comment id: 2008-04-03.5409020551
:title: Re:repr
:author: mshibata
:date: 2008-04-03 23:22:21
:email: mshibata@emptypage.jp
:url: 
:body:
> str()の代替ではないのでご注意を...

あ、補足どもです。

%%%%%%%%%

:id: 560
:date: 2008-04-03 10:20:45
:title: ThinkPad X61s(15th Anniv)の修理申し込み
:categories: ['IT-PC']
:body type: text/x-rst
:body:
微妙に ``15th Anniv`` を主張したタイトルにしてみた。

今のX61sを買った当初から無線LANがよく死ぬ。昨日は再起動後5分くらいで死んでしまって、いい加減実用に耐えないのであきらめて修理に出すことにした。で、Lenovoサイトから申し込みを実施。症状を書く欄に詳しく記載。

.. Topic:: 最初に入力した文

  利用中に無線LANが応答しなくなります。応答が無くなると、ハードウェアスイッチによる無線機器Offにしても、「Offにしました」ダイアログは画面に表示されるものの、無線LANのLEDは点灯したままです。再び通信できるようにするためには、OSの再起動が必要です。サスペンドや休止では修復されません。また、Windowsのドライバ管理から802.11nのOffや電源コントロールなどのパラメータを変更しようとすると設定ダイアログの応答がなくなりOS再起動する必要があります。負荷の高低は関係ないようです。通常運用中、起動直後、サスペンドからの復帰直後など発生タイミングは特定できません。問題の発生後も有線LANは使用できます。

  購入後すぐにこの現象が発生していたため無線LANモジュールの初期不良ではないかと考えております。
  ドライバのアップデートやドライバの再インストールも行いましたが改善されませんでした（Lenovo System Updateツールで行いました。Intelで配布しているドライバは使用していません）。OSはVistaUltimateです。SP1にアップデートしていますが、アップデート前からこの現象は発生していました。

で、入力し終わってPOSTしようとしたら半角300文字以内にしてくださいと警告が出た。そういうのは先に書いておきなさい、先に。しょうがないので文章を大幅に削ってみた。

.. Topic:: 全角150文字にした文

  無線LANが応答しなくなり、修復にはOSの再起動が必要です。発生タイミングは特定できません。購入後すぐに発生していたため初期不良と考えています。OSはVista.


これじゃ症状伝わらないだろ...。

とりあえず4/5(土)に引き取りに来るので1週間ほどメインPCが無い生活に。色々と不安だ。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 561
:date: 2008-04-03 13:54:56
:title: 防衛省の桜2008
:categories: ['work']
:body type: text/html
:body:
<p>
さくらさく<br />
ことしも花見<br />
いけませぬ<br />
</p>
<p>
3年ちかく在籍していて、今年は珍しく会社の花見の日に桜が散ってなかった！けど行けなかったヨ...。
</p>


:extend type: text/html
:extend:


:comments:
:comment id: 2008-04-03.0331861359
:title: Re:防衛省の桜2008
:author: koma2
:date: 2008-04-03 15:43:53
:email: koma2@lovepeers.org
:url: http://bloghome.lovepeers.org/daymemo2/
:body:
そもそも、花見の日に雨が降ってなかったのがかなり珍しいようなw

%%%%%%%%%

:id: 562
:date: 2008-04-05 15:16:40
:title: ThinkPad X61s(15th Anniv)の無線LANモジュールを自力で交換してみた
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`ThinkPad X61s(15th Anniv)の修理申し込み - 清水川Web`_ (4/2) で申し込んだ翌日(4/3)の午前中に確認の電話が来た（素早い対応＋１）。電話で本体の引き取り修理と、無線LANモジュール（mini-PCI）送付どちらがよいかと聞かれたので、ぜひモジュールを送って下さい！と回答（対応の幅の広さ＋１）。公私ともメインなPCが1週間前後手元にない状況はかなりキツイので。。

さらに翌日(4/4)の午前中に自宅に届いていたらしいけど、金曜日は当然仕事なので土曜日に再配達してもらう。

さらに翌日(4/5)の今日、モジュールが届いた。ペリカン便だった。送り主はアイビーエム。Lenovoじゃないんだね。そういえば電話応対してくれた人もアイビーエムを名乗る日本人女性だった。ウワサによるとDELLのサポートは日本語が難しいらしい。

で、さっそく入れ替えようとして、アクセスパネルではmini-PCIを交換できないことが発覚。送られてきたモジュールには交換方法なんかは同梱されていなかったので、紙の本体マニュアルを読んでみたところ、本体カバーを開けて交換する必要があるらしい。詳しくはオンラインマニュアルを読んで下さい、ってもうPC電源落としちゃったんですけど！まあいいや、開ければ分かるだろう。

ねじを外したら苦労せずにカパッっと外すことが出来たので、mini-PCIのネジを外して交換。油断してネジ山を削ってしまって、泣きそうになりながらペンチやらニッパーやら経の小さいドライバーやらで悪戦苦闘したあげくなんとかネジを外すことに成功、というようなトラブルはありつつも、交換自体は10分くらいでおわりそうなくらい簡単だった。モジュールを差し替えて、無線LANアンテナとの接続を繋ぎ直すだけ。ネジとの格闘は30分くらいだった＞＜

交換の結果、ネジ山がつぶれて、MACアドレスが変わって、WindowsVistaが2つめの無線LANデバイスとして認識している事以外は特に問題なく使えているっぽい。サスペンド・レジュームをなんどか繰り返してみたけど、いまのところ無線LANが死ぬ現象は再現していない。交換したデバイスは1ヶ月以内に返送すればいいらしいので、1週間ほど様子を見てみることにしよう。

ところで、mini-PCIポートはもう一つ空きがあるようにみえる。Felicaとか読むヤツ売ってないかな？


.. _`ThinkPad X61s(15th Anniv)の修理申し込み - 清水川Web`: https://www.freia.jp/taka/blog/560


:extend type: text/html
:extend:


:comments:
:comment id: 2008-04-06.3937134611
:title: Re:ThinkPad X61s(15th Anniv)の無線LANモジュールを自力で交換してみた
:author: ocs
:date: 2008-04-06 01:19:53
:email: 
:url: 
:body:
私も購入直後に無線LANの動作がおかしくなってサポセンに送ったのですが、
電話は「IBMサポートセンター」からかかってきました。
サポセンの対応が丁寧で分かりやすくていいですね。マシンは若干不安定な気がするのですが・・・(自分はX60s)。

%%%%%%%%%

:id: 563
:date: 2008-04-05 17:55:15
:title: 豆狸のいなり寿司を買ってきた
:categories: ['food']
:body type: text/x-rst
:body:
`いなり寿司パーティー - 清水川Web`_ のコメント欄でjackさんから `株式会社 豆狸`_ の事を教えてもらったので、早速買ってきた。東京駅構内のグランスタにお店があったので、仕事の途中、乗り換えのときに買うことが出来た。エキナカ、便利かも。

味はまあ普通にいなり。特別豪華な味（？）もしないけど、スーパーのよりは美味しいかったかな。 ``わさびいなり`` だけは今まで食べたことのない興味深い味だった。価格は平均1個100円。

次は、豪華な感じのいなり寿司を食べてみたい。どんなんだろう？錦糸卵とか乗ってるやつ？うーん、なにか別の食べ物と混同している気が。。。

.. _`いなり寿司パーティー - 清水川Web`: https://www.freia.jp/taka/blog/558
.. _`株式会社 豆狸`: http://www.mameda.co.jp/



:extend type: text/html
:extend:


:comments:
:comment id: 2008-04-05.9881809521
:title: 豪華な稲荷寿司
:author: jack
:date: 2008-04-05 22:59:49
:email: 
:url: 
:body:
なんとなく形容矛盾な気もしないではないが(笑)。

稲荷といえば豊川稲荷。東京から見れば、おおむね名古屋のほう(現地の人にとっては違うんだろうけど)。
あのへんでは鰻いなりとか、味噌カツいなりとかを車で流しているときに見たことある。
天むすのいなりversion, 海老天稲荷もきっとある(たぶん)。

味噌カツはともかく、鰻というかひつまぶしの稲荷寿司風味はいけそうな気がする。

わさびいなりも好きですが、それよりは豪華だと思いますが・・・なんとなく、わさびいなりをひつまぶし風
にしたものがあれば豪華かどうかはおいといてうまそうな気はします。

メシ物で豪華というと、海鮮(いくら、ウニ、カニとか)か、海老天とか鰻とか・・・発想が貧困ですまんす。
海鮮丼稲荷はくいづらそう・・・

:comments:
:comment id: 2008-04-06.4378810974
:title: Re: 形容矛盾
:author: しみずかわ
:date: 2008-04-06 15:13:58
:email: 
:url: 
:body:
Wikipediaで読む限りは、いなり寿司は安価な庶民の食べ物でしたか。
あと、助六寿司ってメーカー名じゃなかったのか。知らなかった～


:comments:
:comment id: 2008-04-06.1341080857
:title: 常識は
:author: jack
:date: 2008-04-06 19:02:14
:email: 
:url: 
:body:
変化するものだから、稲荷寿司が豪華な豪華な具材と鮨飯とを油揚げでつつんだもの、
になったら、それはそれなんだけど、いまはまだではないかと。

元禄寿司はベンダー名称(笑)だけど、助六寿司は幕の内(ぉぉ某社のようだ)弁当と同様の
寿司の盛合せ様式の名称だったと思う。

%%%%%%%%%

:id: 564
:date: 2008-04-06 16:26:44
:title: emobileのH11Tを1円で買ってきた
:categories: ['IT-PC']
:body type: text/x-rst
:body:
D01NX（CF型のやつ）を使ってますが、前のノート（X40+XP）や今のノート（X61s+Vista）のどっちの環境でも、通信接続した状態でサスペンドさせるとPCがリセットするという状態に困ってました。会社で何人か使ってる人が居るけどそんな話は聞いたことがないのがまた困りもの。もうUSBでいいやとか思ってたところ、 ``携帯電話型のやつが本体1円、月額0円`` という話を聞いて、さっそく購入してきました。まあ実際にはそんなうまい話があるはずもなく...。

- ケータイプランは1000円～4980円。
- データプラン入ってる人はケータイプランから1000円引き
- でも、本体価格1円＝分割1000円/月払いが2年間必要
- D01NXがスーパーライトデータだとケータイの割引は無くなる
- ところで新規の事務手数料が2835円かかる
- あとH11Tでフルブラウザ(EMnet)使うには月額315円かかる
- 国内ローミングするには月額105円かかる
- 割り込み通話するには月額210円かかる
- 修理保証は購入時しか加入できなくて月額315円かかる

実質、月額0円になる人はほとんど居ないんだろうなあ...。自分は分割1000円+EMnet315円。

EMnet入らなくてもPCからモデムとして使えるんだろうか。カタログには書いてないけど、これがOKなら自分は分割分の1000円で済みそうな気がする。使い勝手に支障がなければ5980円のD01NXは解約の方向で考えてるので、そうなると月々最低2000円かな。

以下雑感をつらつらと。

emailの転送がなかったり、ワンセグがみれたり、ヒンジが回転したり、とかは実質どうでもよろし。自分にとってこれはBluetooth/USBモデムなので。D02HWにバッテリーとBluetoothを内蔵してたら間違いなくそっちを買うね！（安ければ）ていうかリセットしなきゃ今のままでもいいんだけどな。EMONSTER(S11HT)はWindowsMobileなので却下。BluetoothモデムにそのようなOSは不要である。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-04-06.8906190667
:title: Re:emobileのH11Tを1円で買ってきた
:author: jack
:date: 2008-04-06 18:41:31
:email: 
:url: 
:body:
こないだ、たまごがたの02をかってきたばかり。
実家方面で運用してみたが、公式情報でギリギリエリア外な地域らしく、南側の部屋しか使えなかった。
# まぁ、使えるだけいいけど。

:comments:
:comment id: 2008-04-06.9779411571
:title: Re:emobileのH11Tを1円で買ってきた
:author: koma2
:date: 2008-04-06 23:26:18
:email: koma2@lovepeers.org
:url: http://bloghome.lovepeers.org/daymemo2/
:body:
どこの販売店？＞本体1円

%%%%%%%%%

:id: 565
:date: 2008-04-09 23:33:05
:title: 京稲荷をタイムセールで買ってきた
:categories: ['food']
:body type: text/x-rst
:body:
新宿京王百貨店の地下食品売り場は、午後8時に戦場と化す。1500円のタラバガニ弁当が800円に値下がりするのを目の当たりにしました。買わなかったけど。

今回は京稲荷を買ってきました。これも650円くらいのやつが400円に値下げされてました。お買い得です。買ってきた京稲荷の特徴は、とってもジューシーなお揚げ。これに尽きる。見た目は豪華だけど具は上に乗ってるだけで、ご飯は普通に酢飯。お揚げがジューシーじゃなかったら「具が乗ってる普通のいなり寿司」になっちゃう、っていうくらいジューシーなお揚げが良い感じ。

とりあえず、豪華な感じのいなりもGET出来たので、いなり寿司祭りもこれで一旦終了で。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 566
:date: 2008-04-10 00:48:38
:title: emobileのH11TでBluetooth接続
:categories: ['IT-PC']
:body type: text/x-rst
:body:
H11Tは携帯電話型のemobile端末です。PCと接続するとモデムとして利用することが出来ます。接続方式はUSB2.0とBluetooth1.2が使用できます。ということで、使ってみた雑感など。

- Bluetoothのペアリングは特に戸惑うことなく完了
- ダイヤルアップ時に、H11Tの画面で「はい」を選択する必要がある(面倒)
- USB/赤外線を使うためにはBluetoothをOffにする必要がある
- USB/赤外線を使った後はBluetoothを手動でOnにしておく必要がある
- USB接続での充電にはデバイスドライバが必要(充電してくれない)
- フル充電時ならBluetooth接続状態で2時間はインターネット接続できる
- 通信速度は1MB未満と思われ。計測してないけど、まあ使える。
- PCMCIAカード型よりは邪魔
- ダイヤルアップ接続したままサスペンドしてもリセットしなくなった！

とりあえず、ダイヤルアップ時にH11T側でワンクリック必要な事以外は問題なし。普段赤外線もUSBも使わないので、切り替えの手間は些細な問題（ない方が良いけど）。ということで、D01NXは忘れる方向で。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-04-11.0440500291
:title: Re:emobileのH11TでBluetooth接続
:author: Anonymous User
:date: 2008-04-11 21:47:25
:email: 
:url: 
:body:
信頼デバイスに設定すればワンクリックする必要はないですよ。
鞄にいれたままで使ってます。

:comments:
:comment id: 2008-04-12.2007227734
:title: Re:信頼デバイス
:author: しみずかわ
:date: 2008-04-12 18:23:22
:email: 
:url: 
:body:
> 信頼デバイスに設定すればワンクリックする必要はないですよ。

おお！神の声が！うまくいきました。
マニュアル読まないとやっぱり駄目ですね。
%%%%%%%%%

:id: 567
:date: 2008-04-22 14:51:21
:title: Python riddle 1, 2
:categories: ['python']
:body type: text/x-rst
:body:
Pythonのマニュアルは大抵のことが載っているので、良く読め、という話なんだけど、
riddle的な要素を抽出してドリル形式にしたら、どこかで需要があるかもしれない（Python合宿とか）。
あるいはどこかにPythonのriddleを集めたサイトが既にあるかもしれない。

ということで、最近遭遇した小ネタ。

.. topic:: 問い1

    リストLが ``L = ['a','b','c','d','e','f']`` のように与えられたとき、
    以下のコードを出来るだけ短く書け

    | >>> a, b, c = L[:3]
    | >>> L = L[3:]


.. topic:: 問い2

    16bitの符号付き値Nの値として ``N = -100`` が与えられたとき、
    Nを16進数表現でprintするコードを書け。（出力例： ``0xff9c`` ）

    なおC言語では以下のように記述できる。

    short s = -100;
    printf("0x%hx\n", s);


参考サイト
----------
riddleでは無いな。。

- `The Python Challenge`_
- `ActiveState O'Reilly Python cookbook code samples ratings review`_

.. _`The Python Challenge`: http://www.pythonchallenge.com/
.. _`ActiveState O'Reilly Python cookbook code samples ratings review`: http://aspn.activestate.com/ASPN/Python/Cookbook/


:extend type: text/html
:extend:


:comments:
:comment id: 2008-05-16.0967177415
:title: Re:Python riddle 1, 2
:author: jack
:date: 2008-05-16 06:14:58
:email: 
:url: 
:body:
unpack代入に *args はつかえないよねぇ・・・どうやるんだろ

:comments:
:comment id: 2008-05-16.8508536106
:title: Re:Python riddle 1, 2
:author: しみずかわ
:date: 2008-05-16 12:17:33
:email: 
:url: 
:body:
> unpack代入に *args はつかえないよねぇ・・・どうやるんだろ

回答はこちらに。。
http://d.hatena.ne.jp/Isoparametric/20080417/1208387767

:comments:
:comment id: 2008-05-20.0005221877
:title: Re:Python riddle 1, 2
:author: jack
:date: 2008-05-20 13:33:20
:email: 
:url: 
:body:
それでいいんだ。でも [::-1]もそうだけど、あまりやると可読性はもうひとつになるよね

:trackbacks:
:trackback id: 2008-04-23.1537476563
:title: [Python][Mercurial]巡回
:blog name: 常山日記
:url: http://d.hatena.ne.jp/johzan/20080423/1208881139
:date: 2008-04-23 01:19:15
:body:
 ファイルを連結して標準出力に出力するPythonスクリプト Pythonで特定のディレクトリ以下のファイルとディレクトリを一覧・特定ディレクトリ以下を全削除 [Python]Mercurialのhgwebdir.cgiでsyntax highlightする。 Python riddle 1, 2 続・円の交点を求める　Brainstorm バ

%%%%%%%%%

:id: 568
:date: 2008-04-28 16:18:51
:title: Python riddle 3, 4
:categories: ['python']
:body type: text/x-rst
:body:
riddleというか定石っぽいのを問題形式にしただけなんですが、そもそも定石というよりは最初に知ったときに「へー」って思ったことを書いてるだけなので、マニュアルとかPythonチュートリアルとかを読めばいくらでも作れそうな気がしてきた今日この頃。

と言い訳しつつ。

.. topic:: 問い3

    リストLが ``L = ['a','b','c','d',]`` のように与えられたとき、
    以下のプログラムをenumerateを使って書き直せ

    .. code-block:: Python

      >>> for i in range(len(L)):
      ...     print 'L[%d] =' % i, L[i]

enumerateを使え、って、それはもうriddleじゃないような...

.. topic:: 問い4

    リストLが ``L = ['a','b','c','d',]`` のように与えられたとき、
    並びを逆順にする以下のプログラムを出来るだけ短く書け

    .. code-block:: Python

      >>> L_tmp = []
      >>> for x in L:
      ...     L_tmp.insert(0, x)
      >>> L = L_tmp

出来るだけ短く、と言われても。これは分かる人には分かる系のあまりよくない出題。ちなみに、9文字で書けます。


:extend type: text/html
:extend:


:comments:
:comment id: 2008-05-16.4930890259
:title: Re:Python riddle 3, 4
:author: jack
:date: 2008-05-16 05:31:51
:email: 
:url: 
:body:
3. は単なるenumerate の紹介では(^^;;
4. は9文字だと reverse()じゃないのか・・・。じゃぁ、あれか。でも、reverse()ってしておくと思います。

:comments:
:comment id: 2008-05-16.4890911183
:title: Re:Python riddle 3, 4
:author: しみずかわ
:date: 2008-05-16 12:11:30
:email: 
:url: 
:body:
> 3. は単なるenumerate の紹介では(^^;;

うんｗ

%%%%%%%%%

:id: 569
:date: 2008-05-16 01:42:42
:title: Rubyの大場さんと、うまいもの屋で飲み
:categories: ['Event', 'food', 'work']
:body type: text/x-rst
:body:
今日はaihatenaの仲介でJRubyの開発にも関わった某SI会社の大場さんと飲んできました。
奥様は忙しいらしくお会いできなかったのが残念！

ちょっと飲み過ぎて、うまいもの屋の料理をあまり食べた記憶がありません。
鮎の塩釜はワタが苦かった。ホッキ貝はミルキー。あと今年初スイカくった。

元々は日本で開発者として将来も仕事していくためにとかいうテーマを中心に
話そうと言うことになっていたんだけど、色々派生して、ゆとり教育とか、
管理職はつまらんとか、プライベートで開発時間欲しいとか、
SI業界の先行きについて、というか日本のSI業界の構造はもうだめだろう、
とか酔った勢いで色々話した様な話された様な。

俺的一番重要＆意見が合ったと思うのは、「開発者」＝「開発だけしてればいい人」
ではないということ。持論は「隣のレイヤーの仕事を理解しろ」なので、
開発目的や期間を忘れちゃう開発者はホント勘弁して欲しい・・＜愚痴

まあ、何にしても俺ももうちょっと色々アウトプットしないと駄目ね。
結局のところ、技術の研鑽と蓄積、あとはそれをアウトプットするという実績が
あれば今後もなんとでもなるのかなーとか思ったり。

あとは、「Blogトップページから前の3日が見れないのは不便！」とか
「技術ネタ以外も書いて！」「自転車ネタ！」とかご意見いただいたり（笑） 
技術ネタもうちょっと書かないとなーと思ってたんですが...そうか、
はてなの「前の3日」は便利だったか...。

さて、そろそろ酔いが覚めてきたところで仕事します。るるるー


:extend type: text/html
:extend:
%%%%%%%%%

:id: 570
:date: 2008-05-18 16:10:49
:title: PLAYSTATION3とINFOBAR2を買ってきた
:categories: ['misc']
:body type: text/x-rst
:body:
PLAYSTATION3
--------------

先々週くらいから、とみた宅でPS3のWARHAWKというゲームをやってたんだけど、その影響で(?)、今週の火曜にはRicがPS3を買い、木曜にはGOがPS3を買い‥‥、近隣友人のPS3人口が一気に３倍に！これはもう自分もPS3買うしか！ていうかホントに買うのか俺！？‥‥と2日ばかり悩んで結局買ってしまいました。ゲーム機として考えたら高いけど、これはHD画質でDVDを観たり、BDを観たり、DLNAクライアントだったりするお得なデバイスなんだ！それにもうすぐ誕生日だし！

買ってきて早速接続しようと思ったら想定外のことが。確かうちのAVアンプはHDMI入力をD端子出力にコンバートできたはずだ、と思ってHDMIケーブルを買ってきんだけど、そんなダウンコンバートはできませんでした。あれー。。。テレビは6年前のプラズマなのでHDMI入力なんてないし。しょうがないので黄色いビデオ端子で繋いでみたものの「これはひどい」。PS2用のD端子ケーブルなんて持ってないので明日買いに行くかと思っていたところに、Ricが余ってるのを貸してやる、と持ってきてくれて無事解決。そしてそのまま朝までゲームへ・・。

ということで、PS3人口は一週間前の4倍に。次は誰の番だ？


INFOBAR2
----------
INFOBAR -> talby -> W42H と使ってきて、ハード的にはINFOBARが一番使いやすかったということもありINFOBAR2は発売当初から欲しかったんだけど、高くて値下がりを待ってました。先月に3150円まで下がったのもスルーしてたんだけど、 `EZweb端末価格調査： W61Tが値下げ`_ の記事で ``「INFOBAR 2」の在庫を切らす店舗が出ている`` というのを読んで買ってきました。幸い新宿ヨドバシでは買う予定だったウォームグレイは在庫あり。MIDORIは在庫切れ。

3150円の端末価格も、auのポイントで全てまかなえたし、事務手数料もUIM機種間の変更なので無料。実質無料で機種変できました。フルサポート契約で2年縛りはついちゃうけど、いつも2年前後は使うんで問題なし。

端末を変えてみて難点なのは「一般の液晶保護シールを貼れない」ことと「予測変換がバカ」なこと。W42HのATOKは良かった...。Felicaの移動も面倒だけど問題は特になし。ちなみに「Suica」「Edy」「nanaco」「cmode」「ヨドバシゴールドポイント」「ANAマイレージ」が入ってます。INFOBAR2にはプリセットで「QUICPay」が入ってました。入れすぎ？

さて、液晶保護というか覗き見防止フィルタはどうするかな。専用品がありそうだけど選択肢ないだろうなあ。

.. _`EZweb端末価格調査： W61Tが値下げ`: http://k-tai.impress.co.jp/cda/article/price/39898.html



:extend type: text/html
:extend:


:comments:
:comment id: 2008-05-31.8550070814
:title: Re:PLAYSTATION3とINFOBAR2を買ってきた
:author: たはら
:date: 2008-05-31 05:04:16
:email: yusei@domen.cx
:url: 
:body:
PS3買ったんですね！僕はダウンロード購入した鉄拳5にハマっています。
よかったら今度フレンド登録してください。それでは〜。

:comments:
:comment id: 2008-05-31.2991126640
:title: Re:PLAYSTATION3とINFOBAR2を買ってきた
:author: たはら
:date: 2008-05-31 05:11:39
:email: yusei@domen.cx
:url: 
:body:
ID書き忘れてました。。。Limbo54です。
それでは。

:comments:
:comment id: 2008-06-04.0610990146
:title: Re:PLAYSTATION3とINFOBAR2を買ってきた
:author: しみずかわ
:date: 2008-06-04 23:51:06
:email: 
:url: 
:body:
フレンド登録依頼してみました。よろしう～

%%%%%%%%%

:id: 571
:date: 2008-05-20 00:27:15
:title: 文字コード判定して一括でuft-8に変換するPythonスクリプト
:categories: ['python']
:body type: text/x-rst
:body:
utf-8でのHTML作成を依頼したらEUC-JPで送られてきたので自分で変換してしまう。findとnkfを組み合わせれば良いんだろうけど、とりあえず手元にWindowsしか無かったんでPythonで作ってしまった。

カレントディレクトリ以下のテキストと思われるファイルを全てutf-8に変換する。文字コード判定というかトライ＆エラー方式。
バイナリファイルは変換に失敗したらskipするという手法。画像ファイルなんかはまあ大丈夫だろうけど、誤変換しない保証はない。・・・怖。

.. code-block:: Python

    import os, sys
    
    def guess_charset(data):
        f = lambda d, enc: d.decode(enc) and enc
    
        try: return f(data, 'utf-8')
        except: pass
        try: return f(data, 'shift-jis')
        except: pass
        try: return f(data, 'euc-jp')
        except: pass
        try: return f(data, 'iso2022-jp')
        except: pass
        return None
    
    def conv(data):
        charset = guess_charset(data)
        u = data.decode(charset)
        return u.encode('utf-8')
    
    for dirpath, dirs, files in os.walk(os.getcwd()):
        for fn in files:
            path = os.path.join(dirpath, fn)
            fobj = file(path, 'rU')
            data = fobj.read()
            fobj.close()
            try:
                data = conv(data)
            except:
                print path, "-> skip"
                continue
            fobj = file(path, 'wU')
            fobj.write(data)
            fobj.close()
            print path, "-> converted"


:extend type: text/html
:extend:


:comments:
:comment id: 2008-05-20.8639529179
:title: Re:文字コード判定して一括でuft-8に変換するPythonスクリプト
:author: jack
:date: 2008-05-20 13:31:05
:email: 
:url: 
:body:
うぁ、.orig とか残さなくていいの？
まぁ、オリジナルのzip とかあるんでしょうけど。

:comments:
:comment id: 2008-05-20.6290743498
:title: Re:文字コード判定して一括でuft-8に変換するPythonスクリプト
:author: しみずかわ
:date: 2008-05-20 14:00:29
:email: 
:url: 
:body:
> うぁ、.orig とか残さなくていいの？

まあそれはフルコピーがある前提で。。

:trackbacks:
:trackback id: 2008-05-20.6678297840
:title: [Python][Mercurial]巡回
:blog name: 常山日記
:url: http://d.hatena.ne.jp/johzan/20080520/1211274627
:date: 2008-05-20 18:11:09
:body:
 GoogleのソースレビューシステムMondrianのオープンソース版「Rietveld」 CherryPy 3.1.0rc1 PyFileMaker 2.5 pyRuby-Python-Bridge 1.5 bzr 1.5 文字コード判定して一括でuft-8に変換するPythonスクリプト [python] sitecustomize.pyを設定しない運動その１(Pythonで日本語

%%%%%%%%%

:id: 572_ng
:date: 2008-05-20 13:59:16
:title: 兵庫に来ました
:categories: ['work', 'trip']
:body type: text/x-rst
:body:
仕事の打ち合わせで新神戸までやってきました。今日は暴風雨になるという予報だったので朝早くに出発したら早く着きすぎて東京駅で1時間以上ひまをつぶす事に(^^;;

今日は一日外出になるので、要所要所でノートPCの充電をする必要があったのですが、調べてみると色々と充電できる場所がありそうなことが判明。

1. 東京駅構内の CAFE CHEZ LA GARE（カフェ シェ・ラ・ガール） （新幹線改札内側）
2. N700系の新幹線の窓側席
3. 新神戸駅構内（新幹線改札内側）

しかし、事前に指定席を予約した時点ではN700系のことなんて知らなかったので、N700じゃない新幹線の予約を取っていました。N700系が走っている時刻表を見て、東京駅についてから1本前のN700系のやつに指定変更して無事電源確保。座席も広くていい感じです。帰りもN700にしよう。

新神戸駅で昼食。神戸と言えば神戸牛。牛と言えばステーキ。ということでステーキ丼980円。ステーキは美味しいんだけど、たれかけすぎ。ステーキソースが吉野家のツユダクなみにかかってます。これはだめだ（笑）


参考サイト
---------
- `「新幹線乗る前にパソコンの充電とパン食べとこ」CAFE CHEZ LA GARE（カフェ シェ・ラ・ガール）（JR東京駅東海道新幹線改札内）：出張先でこれ食べよう：So-net blog`_
- `新幹線N700系 | N700系の全体像を知る #09`_
- `新幹線N700系 | N700系運行ダイヤ`_

.. _`「新幹線乗る前にパソコンの充電とパン食べとこ」CAFE CHEZ LA GARE（カフェ シェ・ラ・ガール）（JR東京駅東海道新幹線改札内）：出張先でこれ食べよう：So-net blog`: http://debari-syoku.blog.so-net.ne.jp/2007-05-17-3
.. _`新幹線N700系 | N700系の全体像を知る #09`: http://n700.jp/know/09.html
.. _`新幹線N700系 | N700系運行ダイヤ`: http://n700.jp/diagram/index.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 572
:date: 2008-05-20 16:31:29
:title: 東海道新幹線N700はコンセント付き
:categories: ['work', 'trip']
:body type: text/x-rst
:body:
仕事の打ち合わせで久々に東海道新幹線に乗りました。今日は暴風雨になるという予報だったので朝早くに出発したら早く着きすぎて東京駅で1時間以上ひまをつぶす事に(^^;;

今日は一日外出になるので、要所要所でノートPCの充電をする必要があったのですが、調べてみると色々と充電できる場所がありそうなことが判明。

1. 東京駅構内の CAFE CHEZ LA GARE（カフェ シェ・ラ・ガール） （新幹線改札内側）
2. N700系の新幹線の窓側席
3. マクドナルド？店舗別にコンセント情報が欲しい。

しかし、事前に新幹線指定席を予約した時点ではN700系のことなんて知らなかったので、N700じゃない新幹線の予約を取っていました。N700系が走っている時刻表を見て、東京駅についてから1本前のN700系のやつに指定変更して無事電源確保。座席も広くていい感じです。帰りもN700にしよう。

そういえば以前東海道新幹線に乗ったときは、かならず京都に寄って第一旭のラーメンたべてたなあ。前回寄ったときは天一本店だったけど（ `神戸の帰りに京都に寄る - 清水川Web`_ ）‥‥って3年前か！3年早っ！

参考サイト
---------
- `「新幹線乗る前にパソコンの充電とパン食べとこ」CAFE CHEZ LA GARE（カフェ シェ・ラ・ガール）（JR東京駅東海道新幹線改札内）：出張先でこれ食べよう：So-net blog`_
- `新幹線N700系 | N700系の全体像を知る #09`_
- `新幹線N700系 | N700系運行ダイヤ`_

.. _`「新幹線乗る前にパソコンの充電とパン食べとこ」CAFE CHEZ LA GARE（カフェ シェ・ラ・ガール）（JR東京駅東海道新幹線改札内）：出張先でこれ食べよう：So-net blog`: http://debari-syoku.blog.so-net.ne.jp/2007-05-17-3
.. _`新幹線N700系 | N700系の全体像を知る #09`: http://n700.jp/know/09.html
.. _`新幹線N700系 | N700系運行ダイヤ`: http://n700.jp/diagram/index.html
.. _`神戸の帰りに京都に寄る - 清水川Web`: http://www.freia.jp/taka/blog/235



:extend type: text/html
:extend:
%%%%%%%%%

:id: 573
:date: 2008-05-21 12:04:49
:title: RapidSSLからDebianの例の件でメールが来た
:categories: ['security']
:body type: text/x-rst
:body:
``Urgent SSL security update from RapidSSL for Debian users`` というタイトルで例の件（何？）の脆弱性関連のメールがRapidSSLから届いた。内容は::

  Linux Operating System Security Flaws May Have Compromised Your Certificates.
  Replace Them Now at No Charge.

ということで、証明書を無料で再発行してくれる様だ。それにしても影響範囲の広い問題だなあ。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 574
:date: 2008-05-23 13:43:04
:title: 進数変換しても回文数
:categories: ['misc']
:body type: text/x-rst
:body:
33って2進数で書くと100001なんですね。

.. topic:: 問い

  "121" や "3333" のように右から読んでも左から読んでも同じ並びになる数値を回文数とよぶことにします。
  特定の値は10進数で書いても2進数で書いても回文数となります。このような値を探しなさい。


思いつきで書いてます。答えは知らない（笑）


:extend type: text/html
:extend:
%%%%%%%%%

:id: 575
:date: 2008-05-31 19:05:00
:title: 釜焼きパンケーキカーリング風
:categories: ['food']
:body type: text/x-rst
:body:
PS3の `まいにちいっしょ`_ で紹介されていた ``釜焼きパンケーキカーリング風`` を作ってみた。ホットケーキミックスを炊飯器に入れて牛乳と卵を炊飯釜でミックス。あとは炊飯ボタンを押すだけ。

時間になったので箸を刺してみたらまだ生っぽかったのでもう一度炊飯。２回炊飯しても焦げたりはしないらしい。

あらためて炊飯完了。皿に出してみたらホントにきれいに出来た！

でも、食べてみたら、２回炊飯したせいか、ちょっと水分が飛んでしまってパサパサしてる気が。。普通に焼いた方が美味しいっていう落ち？食べるときにはシロップが多めがいい気がする。


.. _`まいにちいっしょ`: http://www.dokodemoissyo.com/mainichi/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 576
:date: 2008-06-01 21:49:26
:title: 久々にルイガノ君で野川へ
:categories: ['bicycle']
:body type: text/x-rst
:body:
久々に自転車に乗って野川を通って野川公園へ。前回乗ったのは・・・ちょうど１年前？速いな１年・・・。

というわけで、今日乗った１時間で、乗車距離延べ1000km達成！

最初の半年で800kmくらいいってたんだけど、この2年で数回しかのってなかったからなあ。。ところで1000kmというと秋田から大阪くらいまでいける距離らしい。




:extend type: text/html
:extend:


:comments:
:comment id: 2008-06-04.3329771886
:title: Re:久々にルイガノ君で野川へ
:author: たはら
:date: 2008-06-04 07:48:54
:email: yusei@domen.cx
:url: 
:body:
1000kmおめでとうございます！
乗らなくなると、あっという間に1年くらい経っちゃいますね。
自転車を買っても乗る暇なくて単なるコレクションになりがち。
だけど新しい自転車が欲しくなる物欲だけはあるので困ったものです。。。


:comments:
:comment id: 2008-06-04.1471172189
:title: Re:久々にルイガノ君で野川へ
:author: しみずかわ
:date: 2008-06-04 23:52:27
:email: 
:url: 
:body:
> だけど新しい自転車が欲しくなる物欲だけはあるので困ったものです。。。

確かに(^^;;
うちのは内装8段オートマ機構のせいで12kgくらいあるので、こんどは超軽いのが欲しいなあ。置く場所無いけど。。

:trackbacks:
:trackback id: 2008-06-25.1940026706
:title: ルイガノ　一番人気　JEDI（ジェダイ）
:blog name: たーしメモ
:url: http://ta-shimemo.livedoor.biz/archives/164791.html
:date: 2008-06-25 16:49:55
:body:
ルイガノ（LOUIS GARNEAU）はルイガノ（LOUIS GARNEAU）は、メイドインカナダの自転車かと思われている人も多いかもしれませんが、実は、メイドイン台湾の自転車です。日本のアキコーポレーションという会社がライセンスを取得してデザインし、台湾で製造しています。...

%%%%%%%%%

:id: 577
:date: 2008-06-06 02:29:26
:title: IEで「操作は中断されました」の罠にはまる
:categories: ['Zope', 'web']
:body type: text/x-rst
:body:
JavaScriptで ``include('foo.js')`` とか書ける様になる include.js というのがあります。

- `JavaScriptMVC - Include`_

やってることは非同期に指定されたファイルを読み込んでHTMLにscriptエレメントを挿入しているだけなんで、単純な用途なら自分で作ってもいいかな、という感じですが、とりあえず使ってみました。

初めのうちは特に問題もなく、Zopeで表示するページに組み込んで使っていたのですが、IE6で動作確認したところ、思わぬ問題が。includeを使うとIE6で ``「操作は中断されました」`` というDLGが出てページが表示されません。色々コードをいじったりググったりして、あるていどの発生条件が分かった気がします。

1. HTMLのロードがまだ完了していないときに
2. 動的にHTMLを変更する（include.jsでincludeを実行する等)
3. <head>タグの最初にbaseタグがZopeによって挿入されている
4. baseタグの挿入により、meta contentTypeタグが<head>直後ではなくなる

Zopeでは例えばフォルダのURLで末尾に'/'を付けていない場合などにZope的に正しいURLをbaseタグとしてZPTのレンダリング結果に挿入します。Zope的に正しいURLにアクセスするとbaseタグは挿入されません。今回の現象はbaseタグが挿入されていない場合には発生しなかったので、(3)を条件に入れています。

.. code-block:: XML

  <head>
    <base href="http://www.example.com/index.html" />
    <meta http-equiv="Content-Type"
          content="text/html; charset=utf-8"/>
    <script type="text/javascript"
            src="/js/include.js"></script>
    ....
  </head>

(4)はどこかのサイトで見かけた情報なので条件に入れてますが、もしかしたら違うかも。

今回は、(1)の条件を無くすために、HTMLロード終了付近(</body>直前)でincludeすることにより回避。onloadハンドリングでなくてもいちおう大丈夫みたい。

.. code-block:: XML

    ....
    <script type="text/javascript">include('/js/foo.js');</script>
  </body>

もう深夜2:30か...。IE6はとっとと無くなってくれ。

.. _`JavaScriptMVC - Include`: http://javascriptmvc.com/learningcenter/include/index.html


:extend type: text/html
:extend:


:comments:
:comment id: 2011-01-19.8541924096
:title: Re:IEで「操作は中断されました」の罠にはまる
:author: Anonymous User
:date: 2011-01-19 16:57:35
:email: 
:url: 
:body:
この理由かも？
http://blogs.msdn.com/b/ie/archive/2008/04/23/what-happened-to-operation-aborted.aspx

include.jsを使ったら、JavascriptのロードはHTMLのパージングのあとなので、問題はなくなります。

%%%%%%%%%

:id: 578
:date: 2008-06-18 12:51:44
:title: Firefox3ダウンロードURLが間違っている件
:categories: ['misc']
:body type: text/x-rst
:body:
先日、Firefox3ダウンロードのお知らせメールに登録しておいたんだけど、今朝そのメールが届いた。しかしそこに記載されているURLは間違っていた...！

::

  http://www..mozilla.com/ja/firefox?p=downloadday


台無しやー！＞＜

*# ところでOpera9.5でダウンロードしようとしたらバイナリがページにレンダリングされた...*

:extend type: text/html
:extend:


:comments:
:comment id: 2008-06-18.1230162743
:title: Re:Firefox3ダウンロードURLが間違っている件
:author: jack
:date: 2008-06-18 23:58:44
:email: 
:url: 
:body:
最初、過負荷かと思ったよ(笑)

:comments:
:comment id: 2008-06-19.2756469895
:title: Re:Firefox3ダウンロードURLが間違っている件
:author: kojimax
:date: 2008-06-19 07:14:36
:email: 
:url: 
:body:
あー、あれはURL間違ってたんですか。
ダウンロードできなくて、/.に貼ってあったリンクから直接ダウンロードしました。。

:comments:
:comment id: 2008-06-19.2721851916
:title: Re:Firefox3ダウンロードURLが間違っている件
:author: しみずかわ
:date: 2008-06-19 13:21:13
:email: 
:url: 
:body:
一般の人は原因に至らず、ITスキルが高い人は深読みしすぎて解決できない罠。

%%%%%%%%%

:id: 579
:date: 2008-06-20 23:56:16
:title: VMWareのUbuntuは複製するとNetwork設定変更が必要
:categories: ['Unix']
:body type: text/x-rst
:body:
いろいろな人がはまっているようで、解決方法はいくつかネット上に転がっていますが、自分もはまって解決にちょっとてまどりました。

問題は、Ubuntuのネットワーク設定はMACアドレスをベースに設定されていて、VMWareのイメージを複製したり別のホストOSに持って行ったりすると（おそらくこのときにuuidを再生成すると）MACアドレスが変わってしまいeth0だったのがeth1やeth2とかになってしまうこと。これに気づかないと、/etc/network/interfaces の記述がeth1のままのために起動してもネットワークが見つからないことになってしまう。

というか。

``/sbin/ifconfig`` したら /etc/network/interfaces に記載のないethデバイスも表示して欲しいと思う。あるいは起動ログとかに表示して欲しい。気づかんて。

ということで、自分の場合の解決方法。

1. ethの番号がずれていることを疑う
2. ``lshw -C network`` で表示されるethの番号を確認する

.. Topic:: Ubuntu-7.1 Server
    :class: dos

    | root:/etc# lshw -C network
    |   \*-network
    |        description: Ethernet interface
    |        product: 79c970 [PCnet32 LANCE]
    |        logical name: eth3
    |        serial: 00:0c:29:48:d8:6e

上記は一部省略。なんかeth3になってました。3って。。

3. eth3をeth0に戻すために ``/etc/udev/rules.d/70-persistent-net.rules`` を編集

::

  # PCI device 0x1022:0x2000 (pcnet32)
  SUBSYSTEM=="net", DRIVERS=="?*", ATTRS{address}=="00:0c:29:48:d8:6e",NAME="eth3"

上記のeth3をeth0に修正。古い設定（eth0,eth1,eth2）は削除。

4. 再起動

これで完了。無事、/etc/network/interfacesに設定したとおりのネットワーク接続ができました。めでたしめでたし。

ところで、ググったときに /etc/iftabを修正する、という記載がいくつか見つかって、結局その方法ではうまくいかなかったんだけど、なんでだろう？そもそも/etc/iftab無いし・・・。Ubuntuはよくわからないです。最近VMイメージ作るたびにFreeBSD, CentOS, RedHat, Debian, Ubuntu, Windows2000, Windows2003, Windows2008, WindowsXP....と違うOS入れてるので、設定の書き方がよく分からなくなってきたよ。

参考
----

- `VMware ubuntu server ネットワークできない - 連絡拒否`_
- `別マシンにVMware仮想イメージを移した時のネットワーク設定 - Syo-Takasakiの日記`_


.. _`VMware ubuntu server ネットワークできない - 連絡拒否`: http://d.hatena.ne.jp/winty/20061112/1163358690
.. _`別マシンにVMware仮想イメージを移した時のネットワーク設定 - Syo-Takasakiの日記`: http://d.hatena.ne.jp/Syo-Takasaki/20070829/1188336460


:extend type: text/html
:extend:


:comments:
:comment id: 2008-10-29.2767632699
:title: Re:VMWareのUbuntuは複製するとNetwork設定変更が必要
:author: Anonymous User
:date: 2008-10-29 11:27:58
:email: jyo.rakuraku@gmail.com
:url: 
:body:
Ubuntu 8でも上記の方法で問題を解決してきた。
どうもありがとうございます。

:comments:
:comment id: 2008-10-29.5858170025
:title: Re:VMWareのUbuntuは複製するとNetwork設定変更が必要
:author: しみずかわ
:date: 2008-10-29 20:59:46
:email: 
:url: 
:body:
お役に立てたようで何よりです:-)

%%%%%%%%%

:id: 581
:date: 2008-06-22 00:56:26
:title: Zope-2.11.0 がリリースされました
:categories: ['Zope']
:body type: text/x-rst
:body:
zope-usersとplone-usersの日本のMLに流した文面をこちらにも掲載しておきます。

- http://ml.zope.jp/pipermail/zope-users/2008-June/006121.html
- http://ml.plone.jp/pipermail/plone-users/2008-June/001341.html

------------------------

6月21日にZope-2.11.0がリリースされました。
様々な機能追加・バグ修正などが行われていますが、同時に古い実装コードの
整理やzope3パッケージ化の進行などによるプロダクトや日本語まわりへの
影響も懸念されます。


目立つ変更点としては、

1. 最新のZopeコンポーネント(Zope-3.4.0)を組み込み
2. BLOB(binary large objects)に対応したZODB 3.8にアップデート
3. トランザクション対応のMailHost実装に対応し、非同期でメール送信
4. Windowsでzopectlを使えるようになった
5. Script(Python)でsetsモジュールを使えるようになった

個人的にはWindowsでzopectlを使えるのがうれしいですね。
あと、MailHostの実装変更でjaMailHostに影響がある気がします。


削除された機能として目立つのは、

1. ZGadflyDA が削除された (Productのコードは入手可能)
2. ``OFS.content_types``, ``__ac_permissions__``, ``meta_types`` を削除

このあたりを使っているプロダクトが起動しなくなるトラブルが起きそうです。


日本語周りで気になるのは、

1. ZopePageTemplate の内部実装にunicodeを使用するようになった
   (utf-8かISO-8859-15以外で使う場合は環境変数 ``ZPT_REFERRED_ENCODING`` の設定が必要)

これは環境変数設定が必要なので、起動スクリプトへの仕込みをしておく
のがよさそうです。(zope.confに入れて欲しかったところですが...)


CHANGESの翻訳を以下に掲載しています。

- http://zope.jp/download/zope/releases/2.11.0


:extend type: text/html
:extend:
%%%%%%%%%

:id: 580
:date: 2008-06-25 23:56:49
:title: 秘密の会合～akn家の食卓
:categories: ['Event', 'food']
:body type: text/x-rst
:body:
先日、android勉強会にもRuby会議にもいかず、秘密の会合に参加していました。というか開催場所は自宅。某Kの中の人とかKTの中の人とかが集まって某プラットフォームを良くするにはどうするかを検討していました。って伏せすぎて読んでも何のことだか全然わからないよ！

その後、参加者のひとりの家（調布）に移動して手作りの餃子とたこ焼きをごちそうになってきました。これはうまい。まじで。またごちそうになりに行きますo(_ _)o


:extend type: text/html
:extend:
%%%%%%%%%

:id: 582
:date: 2008-06-26 00:39:46
:title: PloneとIE7でMSXMLアドオンの実行警告メッセージが表示される
:categories: ['Plone']
:body type: text/x-rst
:body:
via `ngi644の日記 » Blog Archive » IE7でKupuによる画像がアップロードできない`_

Ploneの特定のバージョンのサイトを、特定の環境のIE7で閲覧すると、添付画像のようなMSXMLアドオンの実行警告メッセージが表示されます。この問題の原因については前述のサイトの、さらに引用元で語られていて、この情報を元に検証してみたところ以下の条件で発生する模様。

- Office2003,2007等をインストールするとMSXML5.0もインストールされる
- IE7はMSXML5.0を標準では許可しない
- sarissa.jsを使っているkupuとかPloneのLiveSearchで問題が発現する（KSSも?）

解決方法としては、 sarissa.js に以下の文字列::

  Msxml2.XMLHTTP.5.0
  MSXML2.FreeThreadedDOMDocument.5.0
  Msxml2.XSLTemplate.5.0

があったら、これらを削除すればOK（プログラム的に正しくね）。
ちなみに、MSXML5.0はOS標準ではない（Win95～Vista,Server全て！）ようです。Vistaでは3.0と6.0が標準で入っているらしい。


参考
-----
- `ngi644の日記 » Blog Archive » IE7でKupuによる画像がアップロードできない`_
- `IE7弹出MSXML 5.0支持的问题 — 中国Zope/Plone用户组`_
- `Microsoft XML パーサー (MSXML) のバージョン一覧`_
- `Microsoft XML Parser および Microsoft XML Core Services (MSXML) をインストールする方法`_
- `Windows Vista ベースのコンピュータで Microsoft XML Core Services 4.0 Service Pack 2 の互換性と信頼性を向上させる更新プログラムについて`_


.. _`ngi644の日記 » Blog Archive » IE7でKupuによる画像がアップロードできない`: http://ngi644.net/blog/archives/161

.. _`IE7弹出MSXML 5.0支持的问题 — 中国Zope/Plone用户组`: http://czug.org/blog/zhangbingkai/ie7danchumsxml-5-0zhichidewenti

.. _`Microsoft XML パーサー (MSXML) のバージョン一覧`: http://support.microsoft.com/kb/269238/ja

.. _`Microsoft XML Parser および Microsoft XML Core Services (MSXML) をインストールする方法`: http://support.microsoft.com/kb/324460/ja

.. _`Windows Vista ベースのコンピュータで Microsoft XML Core Services 4.0 Service Pack 2 の互換性と信頼性を向上させる更新プログラムについて`: http://support.microsoft.com/kb/941833/ja


:extend type: text/html
:extend:
%%%%%%%%%

:id: 583
:date: 2008-06-26 23:55:00
:title: 明日はPython温泉
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
行ってきます。

どうやら新宿から小田急線で小田原まで行くのが、リーズナブルかつ眠れそうな感じだ。

::

  調布 9:38発 － 来宮 12:35着
  
  乗り換え回数：2回
  所要時間：2時間57分
  料金：1,480円
  
  ●調布 
  ｜　　9:38発
  ｜　　　　京王線(特急)[新宿行]23分
  ｜　△10:01着
  ○新宿 
  ｜　　10:08発
  ｜　　　　小田急小田原線(急行)[小田原行]1時間35分
  ｜　△11:43着
  ○小田原 
  ｜　　11:56発
  ｜　　　　ＪＲ東海道本線(普通)[伊東行]29分
  ↓熱海 
  ｜　　　　ＪＲ伊東線(普通)[伊東行]2分
  ｜　　12:35着
  ■来宮
  


:extend type: text/html
:extend:
%%%%%%%%%

:id: 584
:date: 2008-06-27 00:29:40
:title: emobile D01NXのSIMにハサミを入れた！
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
先日、 `emobileのH11Tを1円で買ってきた`_ 。それ以来D01NXは念のために契約を残しておいたものの、全く使っていなかったので解約することに。解約届けを送ってもらって必要事項を記入して、最後に **USIMにハサミを入れて貼り付け** 。

とてもとても **やってはいけないことをやってしまった感** が....。なぜだろう？

.. _`emobileのH11Tを1円で買ってきた`: http://www.freia.jp/taka/blog/564


:extend type: text/html
:extend:
%%%%%%%%%

:id: 585
:date: 2008-06-27 16:22:01
:title: Python温泉3にやってきました
:categories: ['misc']
:body type: text/x-rst
:body:
目的地の来宮（きのみや）は熱海から1駅。なのに気づいたのは来宮を出てからでした。次の伊豆多賀で折り返したんだけど、電車の本数が1時間に2本。俺の実家最寄り駅よりは倍くらい多いな、うん。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 586
:date: 2008-06-27 23:50:00
:title: Python温泉3, 1日目夜
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
buildbot_ と trac_ を色々いじってます。buildbot-0.7.7のバグを見つけたかも...

.. _buildbot: http://buildbot.net/
.. _trac: http://trac.edgewall.org/

:extend type: text/html
:extend:
%%%%%%%%%

:id: 587
:date: 2008-06-28 01:25:54
:title: Python温泉3,  1日目深夜. buildbotのバグを報告してみる
:categories: ['python']
:body type: text/x-rst
:body:
`buildbot-0.7.7`_ のマイナーなバグを見つけたっぽいので、レポートを出してみました。
マイナーバグなので症状に遭遇する人は少ないかもしれません。

svn://.../ を使ってSubversionにcommitするとauthorが記録されません。このような使い方をしているSubversionリポジトリをbuildbotのSVNPollerでポーリングしているとauthorを取得しようとしてエラーになります。

といことで以下のレポートで超簡易なパッチを添付してみました。

- http://buildbot.net/trac/ticket/307

.. _`buildbot-0.7.7`: http://buildbot.net/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 588
:date: 2008-06-28 21:50:12
:title: Python温泉3, 2日目 翻訳Day
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
amachangキター！

ということで2日目。朝8時起床。大雨。土曜はいつも昼過ぎまで寝てるので果てしなく眠い。

今日やったこと。


tracをインストール
-------------------
easy_install trac でいけた。後は::

    trac-admin /path/to/instance initenv

して::

    vi /path/to/instance/conf/trac.ini

で設定。
initenvで対話形式で入力しただけで、tracからsvnを参照できるようになった。


tracの認証をapacheでやろうと思った
-----------------------------------
tracd --port 8000 /path/to/instance で起動はできるけど、通常運用を考えるとサーバーはapacheにやってもらうのがいいよね。認証もapacheにおまかせ。


ということでapache2をインストール::

    apt-get install apache2


apache2の認証をopenldapに持たせようと思った
---------------------------------------------
認証のためにldapを立てるのはめんどくさいなあ、と思いつつ、個別に用意するのはそれはそれで面倒そうだったので、設定することにした。


とりあえずopenldapを入れた::

    apt-get install slapd
    apt-get install ldap-utils


ldapaddで認証用ユーザーを追加
------------------------------
ldapaddコマンドで手入力::

    ldapadd -x -W -D cn=admin,dc=localdomain

    dn: ou=Users,dc=localdomain
    objectClass: organizationalUnit
    ou: Users

    dn: cn=taka,ou=Users,dc=localdomain
    objectClass: top
    objectClass: person
    cn: taka
    sn: Shimizukawa
    userPassword: dummy


パスワードを変えてみる::

    ldappasswd -x -W -S -D cn=taka,ou=Users,dc=localdomain


pam_ldapを入れた
-----------------
インストールして::

    apt-get install libpam-ldap

/etc/pam.d/apache2 に設定::

    auth       required   /lib/security/pam_ldap.so  no_warn try_first_pass
    account    required   /lib/security/pam_ldap.so  no_warn try_first_pass


mod_auth_pamを入れた
---------------------
インストールして::

    apt-get install libapache2-mod-auth-pam

/etc/apache2/sites-enabled 以下のファイルに::

    AuthName "LDAP ID / password for repos"
    AuthType Basic
    AuthPAM_Enabled on

等を記述してapacheを再起動。だがしかし、BASIC認証が通らない。/var/log/apache2/error.log を確認するとユーザーIDが無いと記録されている::

    PAM: user 'taka' - not authenticated: User not known to the underlying authentication module


apacheで認証できずにはまる
---------------------------
``/etc/ldap.conf`` の設定をほとんどデフォルトのままで使っていたので、 ``objectClass: person`` にはuidが無くてユーザーが見つかっていなかった。あとbind dnの設定を変えていなかったため、ou=Users以下を見る設定になっていなかった。

/etc/ldap.conf に以下を設定::

    base ou=Users,dc=localdomain
    scope sub
    pam_login_attribute cn


http経由でsvnを読み書きできるようにする
----------------------------------------
apt-get install libapache2-svn して

/etc/apache2/sites-enabled/002-svn::

    <Location /repos>
        DAV svn
        SVNPath /var/lib/svn/repos
    </Location>


svnのコミット時にldapで認証する
--------------------------------
svnリポジトリ ``/var/lib/svn/repos`` の所有者をwww-dataにして、グループをsvnusersに変更する。また/etc/groupのsvnusersにwww-dataとsvnプロトコルでアクセスするユーザーを所属させる。これでsvnプロトコルとhttpプロトコル両方でコミットできる。あとはldap認証するようにLocationを設定する。

/etc/apache2/sites-enabled/002-svn::

    <Location /repos>
        DAV svn
        SVNPath /var/lib/svn/repos

        AuthName "LDAP ID / password for repos"
        AuthType Basic
        AuthPAM_Enabled on

        <LimitExcept GET PROPFIND OPTIONS REPORT>
             Require valid-user
        </LimitExcept>
    </Location>


昼ご飯を食べる
-------------
麓まで下山すると再登山が大変なので、みんなで仕出し弁当を食べる。


tracをmod_wsgiで動かそうとしてはまる
-------------------------------------
apt-getにmod_wsgiが無い。unstableを使えるようにしてインストールしてみたけど、結局正しく動かなかった。 ``trac-admin /path/to/instance deploy /path/to/deploy`` で作成したtrac.wsgiの中で from trac.util import compat しているんだけど、compatが無いと言われる。原因不明。誰かがdelしてるに違いない。

しょうがないのでとりあえずcgiモードで動かす。


tracにbuildbotのwaterfallを表示しようとしてはまる
--------------------------------------------------
trac-0.11ではTracBB-0.1.2はうまく動かない？とりあえず保留。


buildbot-0.7.7のマニュアルを翻訳し始めてみる
---------------------------------------------
キーワードと各章のタイトルだけ翻訳した時点で3時間くらい経ってた。何回か眠気に負けそうになったので温泉に浸かってくる。晩ご飯まであと1時間頑張ろう。


晩ご飯を食べる
---------------
昨日より品数が増えた。普通にうまい。


iPhoneアプリ開発ハンズオンを見る
---------------------------------
いまここ。NDAとかなんか大変らしい。



:extend type: text/html
:extend:
%%%%%%%%%

:id: 589
:date: 2008-06-29 01:20:37
:title: Python温泉3, 2日目深夜, shared_ptr大会
:categories: ['Event', 'python', 'cpp']
:body type: text/x-rst
:body:
今、となりで西尾さん＆amachangさんペアが `C  のtemplateでBREW用にshared_ptrを書いてみた - 清水川Web`_ をアンチョコにしつつshared_ptrを実装しようとしている。バグが見つかるんじゃないかとドキドキ。

ところで、自分がコードの一部を説明出来ない。これはやばい。

.. _`C  のtemplateでBREW用にshared_ptrを書いてみた - 清水川Web`: http://www.freia.jp/taka/blog/536


:extend type: text/html
:extend:
%%%%%%%%%

:id: 590
:date: 2008-06-29 17:25:10
:title: Python温泉3, 3日目 帰路
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
朝8時30分起床。

昨日の夜のshared_ptrはやっぱりバグっていた。あと代入演算子オーバーロードが不可解な挙動をしていたのにはまって、気がつくと深夜3時。さすがに今朝は起きるのがつらかった。

8:30 朝食、美味しゅうございました。

9:30 集金、2泊＋おやつで17200円。交通費合わせてちょうど2万くらい。

10:00 撤収。タクシーに乗って熱海まで。4人同乗でひとり300円。電車賃程度。

11:14 東海道線に乗る。人身事故の影響で1時間に一本の運行。渋さんは用事に間に合っただろうか？

12:00 小田原で常山さんと別れ、カレーうどん食って小田急線へ。

14:00 帰宅。

15:00 自宅サーバーが今朝から落ちていることに気づく。新環境移行やらないとなあ。

17:00 `buildbotのマニュアル翻訳`_ (冒頭のみ)をUp.

17:20 日記を書くまでがPython温泉です！←いまここ


参加された皆さん、そして幹事さん、お疲れ様でした！また次回、10月のPython温泉4（多分台風）も参加しますので、よろしくおねがいします！

.. _`buildbotのマニュアル翻訳`: http://svn.freia.jp/open/buildbot/docs/buildbot.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 591
:date: 2008-07-01 02:37:00
:title: １日１翻訳 - The Buildbot
:categories: ['misc']
:body type: text/x-rst
:body:
１翻訳の単位は１時間。でも自分の今の英語能力だと目標の分量をこなすのに２時間かかる。長丁場になりそうな予感。。。今日の翻訳は推敲時間が足りてないので日本語がちょっと怪しい。

- `Buildbot-0.7.7のマニュアルの翻訳`_

.. _`Buildbot-0.7.7のマニュアルの翻訳`: http://svn.freia.jp/open/buildbot/docs/buildbot.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 592
:date: 2008-07-01 02:47:05
:title: 明日はObjectClub夏イベントに行ってきます
:categories: ['Agile(XP)', 'Event']
:body type: text/x-rst
:body:
http://www.objectclub.jp/event/2008summer/ 行ってきます。オブLove方面,XP方面の方々とお会いするのは２年ぶりくらいかも。よろしくお願いします。（先日のPython温泉で渋さんには会ったけど）

というかもうすぐ深夜３時。朝起きられない予感。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 593
:date: 2008-07-01 11:11:39
:title: オブジェクト倶楽部2008夏イベントに参加中
:categories: ['Event', 'OO']
:body type: text/x-rst
:body:
今日のポイント：オンライン拍手システム、というかtwitter?
http://www.yattom.jp/kpt/ やっとむ氏作のTurboGears製と見た。

今日のイベントの配布物はecoバッグに入っていた！ `渋さん`_ によると最近のイベントでecoバッグ配布が多いらしい。

システム思考と概念モデリング  児玉公信さん
---------------------------------------

- サルと原子の関連をモデル化しても意味がない
- 階層を合わせてモデル化しよう
- モデル、観測者、モデラー
- 離見の見: モデルを見る観測者、モデラーはその外から観測者も見る
- 用美強(Utilitas/Venustas/Firmitas)
- 使ってなんぼ: 早い・安い・使えない、では意味がない
- ユーザーにも要求を伝える義務がある
- 使って育てる
- ITSSの３つのアーキテクト：アプリケーション、ソフトウェア、インフラストラクチャ
- 原要求から要求への変換
- アレキザンダー: 校舎を造りたいんじゃない、学校を作りたいんだ
- 仕事で行わなければいけないのは「はじめの状態」を「終わりの状態」に変えること
- 「ジュースを注ぐ」ではなく「空のコップをジュースの入ったコップに変える」
- 要のもの: 真に得たいもの、余分なものを取り除いたもの
- 良いモデルは「最小、かつ完備」
- 状況を作って学ばせる
- OJTにはインストラクションとコンストラクションが必要
- ダブルバインド
- コペルニクス的転回

お話の導入のあたりは的が遠すぎてどうなるかと思ったけど、開始10分ほどでとても聞き応えのある内容になった！最近、階層間（粒度間、レイヤー間）の連続性についてわかりやすく表現できないかとモヤモヤ考えているんだけど、違う視点から学術的に語っている感じ。もっと広い視点。本買ってみようかな。

- `UMLモデリング入門 本質をとらえるシステム思考とモデリング心理学`_


お昼
-------

- 会社の連れを見失った！
- タイミングを逃してひとりで万豚記...
- 万豚記のチャーハン多すぎ
- 会社連れを発見！
- 渋さんと遭遇。栃木Rubyの方と。

議事録から広げようコミュニケーションの輪  川上文夫さん
------------------------------------------------

- テーブル6人単位でワークショップ
- 巨大模造紙
- 活用されない議事録
- 軽量議事録 => wiki
- 公開文書書く癖がつく++
- 全ての目的に合う議事録は無理じゃないかな？
- 未来議事録 => ToDoじゃん！
- なにもかもwikiに。電話メモも。ToDoも。議事録も。

このへんでノートPCの電池がなくなった。。。オンライン更新は難しいな。


議論を描く技術 ファシリテーショングラフィック  西河誠氏さん
----------------------------------------------------
- `システム開発現場のファシリテーション`_
- `ファシリテーション・グラフィック`_
- 自然に導入しないと周りがひく


その後
-------

- `渋さん`_ は10回中9回参加！残り1回も懇親会のみ出てる！すげえ！
- LTはおもしろかった。が人選に恣意的なものを感じる...
- オブラブのLTはネタに行き過ぎ？
- そして。懇親会。
- 新人研修で単身来ていた方がいた！上司来てない...おいおい
- 今回は新人さんが多かったかもしれないけど、
- 今回は全体的にテーマが難しかった気がする
- `平鍋さん`_ とのワールドカフェ
- エンジニアが幸せになるには
- 業務と違っても良いからやる気のある開発者がよいね
- やっとむさんと話し損ねた！
- 上田さんと話し損ねた！！
- ギリギリで本もらえた。 On Lisp.
- 解散 → 同僚の案内で初台まで20分歩いた...

実は、参加前はレイヤーが微妙かな－・・・と思っていましたが、とってもとってもおもしろかったです！
若干、前提知識が必要かもしれない感じでしたがそれでも、吸収できることがいっぱいありました。
また、参加したいと思います。みなさん、お疲れ様でした～！


.. _`平鍋さん`: http://blogs.itmedia.co.jp/hiranabe/
.. _`ファシリテーション・グラフィック`: http://www.amazon.co.jp/dp/4532312884
.. _`システム開発現場のファシリテーション`: http://www.amazon.co.jp/dp/4774133655
.. _`UMLモデリング入門 本質をとらえるシステム思考とモデリング心理学`: http://www.amazon.co.jp/dp/4822283585
.. _`渋さん`: http://sky.ap.teacup.com/shibu/



:extend type: text/html
:extend:
%%%%%%%%%

:id: 594
:date: 2008-07-04 01:14:55
:title: C++のtemplateでBREW用にshared_ptrを書いてみた（改）
:categories: ['cpp']
:body type: text/x-rst
:body:
`Python温泉3, 2日目深夜, shared_ptr大会`_ を経て、いくつかのバグが見つかったので、BREW用に作ったshared_ptrを修正してみる。修正にあたり、とやまに意見をもらったりした。ありがとう。実際問題、C++現役から離れて久しいのできっとまだバグがあるに違いない...。でも晒しておこう。

以下の点に注意。

- 簡単なテストしかしてません。流用は自己責任で。。
- 結局BREW用に書いたものの採用しませんでした（開発後期だったため）
- カウンタはLinkListで作った方が良いと思われる
- 大本のコードはboostのshared_ptrです
- `前作`_ から、shared_ptr同士の代入と、自己代入のバグを修正

ということで、以下コード。


.. _`Python温泉3, 2日目深夜, shared_ptr大会`: http://www.freia.jp/taka/blog/589
.. _`前作`: http://www.freia.jp/taka/blog/536/edit

:extend type: text/x-rst
:extend:
.. code-block:: CPP

    #ifndef __BREW_SHARED_PTR_H__
    #define __BREW_SHARED_PTR_H__
    #include ".\operators.h"
    
    class shared_counter {
    private:
    	int count;
    public:
    	shared_counter():count(1){}
    	~shared_counter(){}
    
    	int inc() {return ++count;}
    	int dec() {return --count;}
    };
    
    template<class T>
    class shared_ptr {
    private:
    	T* px;
    	shared_counter* pn;
    
    public:
    	shared_ptr()
    		:px(0),pn(0)
    	{}
    
    	template<class Y>
    	shared_ptr(Y* p)
    		:px(p),pn(0)
    	{
    		pn = new shared_counter()
    	}
    
    	template<class Y>
    	shared_ptr(shared_ptr<Y> r)
    		:px(r.px),pn(r.pn)
    	{
    		pn->inc();
    	}
    
    	~shared_ptr()
    	{
    		if(pn && pn->dec()==0)
    		{
    			delete pn;
    			delete px;
    		}
    	}
    
        shared_ptr & operator=(shared_ptr const & r)
        {
            if(*this == r) return *this;
            if(pn && pn->dec()==0)
            {
                    delete pn;
                    delete px;
            }
            px = r.px;
            pn = r.pn;
            pn->inc();
            return *this;
        }

        template<class Y>
        shared_ptr & operator=(shared_ptr<Y> const & r)
        {
            if(*this == r) return *this;
            if(pn && pn->dec()==0)
            {
                delete pn;
                delete px;
            }
            px = r.px;
            pn = r.pn;
            pn->inc();
            return *this;
        }

        template<class Y>
        shared_ptr& operator=(Y* const p)
        {
            if(px == p) return *this;
            if(pn && pn->dec()==0)
            {
                delete pn;
                delete px;
            }
            px = p;
            pn = new shared_counter();
            return *this;
        }
    
    	T& operator*() const
    	{
    		return *px;
    	}
    
    	T* operator->() const
    	{
    		return px;
    	}
    
    	operator T*() const
    	{
    		return px;
    	}
    };
    
    
    #endif // __BREW_SHARED_PTR_H__
%%%%%%%%%

:id: 595
:date: 2008-07-04 01:28:32
:title: VistaでVMWareが固まる件、とりあえずの回避策
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`VistaでVMWare Serverが固まる`_ で書いたように、うちのVista君でVMWwareを実行しようとすると3回くらいブルースクリーン→リセットを眺める必要があった。これに対してとりあえずの対策が出来たように思える。その対策とは....

1. メモリを4MB割り当てた最小限のVMを作成する
2. このVMをHost起動時に自動的に起動するよう設定する

以上。

運が良ければHostが起動する。運が悪ければHostが起動しない（涙

今のところ、うまくいっているっぽい。しかし、PC起動は遅くなった。抜本的な解決方法が欲しい今日この頃。 VirtualBox_ に移行するという手もあるな...。

.. _`VistaでVMWare Serverが固まる`: http://www.freia.jp/taka/blog/546
.. _VirtualBox: http://www.virtualbox.org/


:extend type: text/html
:extend:


:comments:
:comment id: 2008-07-04.2858251577
:title: Re:VistaでVMWareが固まる件、とりあえずの回避策
:author: nakai
:date: 2008-07-04 12:48:06
:email: 
:url: 
:body:
Virtual Boxええよ:_0

:comments:
:comment id: 2008-07-04.0347145845
:title: Re: Virtual Boxええよ:_0
:author: しみずかわ
:date: 2008-07-04 13:00:34
:email: 
:url: 
:body:
とりあえずインストールだけしてみた:)

%%%%%%%%%

:id: 596
:date: 2008-07-05 23:59:30
:title: 大学恩師の還暦のお祝い
:categories: ['Event', 'misc']
:body type: text/x-rst
:body:
大学の研究室時代に大変お世話になった恩師、安藤先生の還暦祝いのパーティーが行われたので行ってきました。会場はパルコの上のホテルでした。

パーティーには多くの有名な先生方や、OB、現役の研究生があつまり、大変楽しいお祝いでした。祝辞は専門用語とかそれの絡んだ冗談とかが多くてその部分はよくわからなかったけど（○×定数は1.6で、いやそれは大きすぎるだろ、わはは、みたいな）、それが分からなくてもおもしろいスピーチで、先生方は話すのがうまいなあ、と感心したり。

安藤先生の元を卒業してから、はや7年。まったくお変わりなく元気そうで、退官までのあと5年も変わらず元気に研究を続けてもらいたいと、、、、寄せ書きに書ければ良かったんだけど、その場では思いつかず。残念。残り5年も、その後も、ますますのご活躍をお祈りしております。研究者も技術者も、定年なんて無いのですよ！


:extend type: text/html
:extend:


:comments:
:comment id: 2008-07-06.6415186158
:title: Re:大学恩師の還暦のお祝い
:author: masaru
:date: 2008-07-06 00:10:41
:email: 
:url: 
:body:
最後の一文
いい言葉だな

%%%%%%%%%

:id: 597
:date: 2008-07-07 00:52:05
:title: Ruby on Rails 逆引きクイックリファレンス
:categories: ['misc', 'Programming']
:body type: text/x-rst
:body:
ずっとerattaだと思ってました。errataでした。エラッタじゃなくてイラータの方が発音近いですかね。

- `Ruby on Rails 逆引きクイックリファレンス Rails 2.0対応`_

6章の「ビルド・テスト・運用」から読み始めてとてもわくわくした本です。 `先日お会いした大場さん`_ も著者のお一人。

18ページめの「Ruby on Railsでの開発に必要となる背景技術」に40項目近い項目があるあたりに
「この本ではこのへんは説明しないぞ！」という主張がある感じ？Webアプリを正しく書くのってかなりの範囲の知識がいるんですね :-)

達人プログラマーを書いたDave ThomasとDHHの `RailsによるアジャイルWebアプリケーション開発 第2版`_ もそのうち読んでみたい。

.. _`Ruby on Rails 逆引きクイックリファレンス Rails 2.0対応`: http://www.amazon.co.jp/dp/4839928266/freiaweb-22
.. _`RailsによるアジャイルWebアプリケーション開発 第2版`: http://www.amazon.co.jp/dp/4274066967/freiaweb-22
.. _`先日お会いした大場さん`: http://www.freia.jp/taka/blog/569

::

    P148, Q052:
        4つめのサンプルコード,2行目:
            誤: article
            正: project

    P262, Q101:
        2つめのサンプルコード,5行目:
            誤: min
            正: average

    P263, Q101:
        1つめのサンプルコード,5行目:
            誤: min
            正: sum

    P300, Q118:
        1つめと2つめのサンプルコードが逆

    P322, Q127:
        P321までの関連名はemployeesだったが、P322の2つ目3つ目では
        work_place_costsという名前になっている。
        1つめのWorkPlaceモジュールではemployeesという名前で参照
        しようとしている。

    P325, Q128:
        5つめのサンプルコード,3行目,インデントがずれている

    P328, Q129:
        下から2行目:
            誤: has_and.belongs_to.many
            正: has_and_belongs_to_many

    P348, Q138:
        3つめのサンプルコード,行末のダブルクォートが抜けている

    P354, Q141:
        本文5行目:
            誤: --skip- migration
            正: --skip-migration

    P382, Q151:
        4つめのサンプルコード:
            誤: alert(page.....
            正: page.alert(page....

    P383, Q151:
        3つめのサンプルコードの前の行:
            誤: Form.Element.serializeは(element)次の...
            正: Form.Element.serialize(element)は次の...

    P402, Q161:
        最初の表題（画像の次）:
            誤: _place_editing
            正: in_place_editing

    P526, INDEX:
        executeは241ページを指しているが、241にexecute文が無い。
        正しくは348ページ?


:extend type: text/html
:extend:


:comments:
:comment id: 2008-07-09.3929346804
:title: Re:Ruby on Rails 逆引きクイックリファレンス
:author: koichiro
:date: 2008-07-09 11:43:14
:email: 
:url: http://ko.meadowy.net/~koichiro/diary/
:body:
正誤をまとめていただき感謝です。お陰でとても楽をさせてもらいました^^;
こちらの正誤表に反映して公開しました。ありがとうございます！
http://everyleaf.com/railsbook


:comments:
:comment id: 2008-07-21.5207947955
:title: Re:Ruby on Rails 逆引きクイックリファレンス
:author: しみずかわ
:date: 2008-07-21 04:35:21
:email: 
:url: 
:body:
P304, Q119:
    関連の図の中でDeliveryクラスにoffice_idがあるが、正しくはorder_id.
%%%%%%%%%

:id: 598
:date: 2008-07-13 17:48:58
:title: 今日のサイクリング at 野川 (total:1033km)
:categories: ['bicycle']
:body type: text/x-rst
:body:
1ヶ月ぶりのサイクリング。川沿いにひまわりが咲いていて、そろそろ夏だなあと思いつつ野川公園を一周して帰宅。野川沿いの道は狭くて、起伏があって、車道との交差が多くて、あまりスピードを出すのには向いていない。1カ所だけ、ギリギリで時速40kmに達することができる箇所があるけど、他はのんびり漕ぐ感じで。

帰りは遠くから雷鳴に追いかけられて帰宅。そういえば川の水量が梅雨前よりもけっこう多かった気がする。梅雨が明けたらきっと暑すぎて‥‥ダイエットに良いかも？要水分補給。直飲みできる水筒欲しい。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 599
:date: 2008-07-13 17:57:03
:title: 今日のbuildbotマニュアル翻訳
:categories: ['misc']
:body type: text/x-rst
:body:
毎日30分～1時間翻訳してるけど、まだ全体の2割に行かないくらい。7月中には終わらないな・・・。

http://svn.freia.jp/open/buildbot/docs/buildbot.html

英語の技術文書はポイントだけ斜め読みすることが多いんだけど、翻訳してると読み飛ばしていた箇所にノウハウやハマりポイントが書かれていたりして学ぶことが多い。英文を読む勉強にもなるよ！（英語を出力する足しには全くならないが...）

:extend type: text/html
:extend:


:comments:
:comment id: 2008-07-18.9764571993
:title: Re:今日のbuildbotマニュアル翻訳
:author: mshibata
:date: 2008-07-18 01:26:17
:email: mshibata@emptypage.jp
:url: 
:body:
読める力量の範囲内でしか書けないわけで、出力する足しにはなってると思いますよ。＜英語
あと翻訳は日本語の練習にもなります。

:comments:
:comment id: 2008-07-18.2413276054
:title: Re:今日のbuildbotマニュアル翻訳
:author: しみずかわ
:date: 2008-07-18 10:07:22
:email: 
:url: 
:body:
> あと翻訳は日本語の練習にもなります。

Exciteで機械翻訳した日本語を正しい日本語にする練習ですね、わかります。
言葉を足したり引いたりしないと読みやすくならないんですよね。

%%%%%%%%%

:id: 600
:date: 2008-07-17 23:57:21
:title: コンビニの佐世保バーガー
:categories: ['food']
:body type: text/x-rst
:body:
380円。チンして食べます。コンビニのバーガーとしては高すぎ。ネタとして買ってみたんだけど予想外にうまかった。熱々ジューシーでチーズも良い感じ。

でも高いよな。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 601
:date: 2008-07-20 22:02:21
:title: LUMIX FX9を修理に出した
:categories: ['IT-PC']
:body type: text/x-rst
:body:
金曜日に、故障したデジカメFX9を修理に出した。液晶画面が虹色になってしまって、撮影した画像も虹色になってしまって、まともに使える状態じゃなくなってしまったのだ。去年の9月に。ケータイで撮った画像は微妙な感じなので、そろそろ直しておくか、と思い立ってヨドバシに持って行ったんだけど、修理には平均的に12,000円～20,000円かかる、とのこと。最新機種のFX35がだいたい30,000円なことを考えると・・・どうするかなあ。広角になってたりAIが良くなってたりはするんだけど、本体サイズは変わらないしなあ。とりあえず、修理の見積もりが出てから考えよう。新機種の半額以下(15,000円)だったら修理しようかな。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 602
:date: 2008-07-20 22:03:17
:title: 今日の野川サイクル (total: 1044km)
:categories: ['food', 'bicycle']
:body type: text/x-rst
:body:
瞬間最大時速44km/hを記録！帰ってからのビールがうまい。

CMで田村さんが「私にはビールです」ってやってる、SAPPOROの「麦とホップ」を買ってみたんだけど、ビールと言うにはちょっと苦すぎないか？個人的には苦いのとか辛いのとか好きなので、まあこれはこれで。

:extend type: text/html
:extend:


:comments:
:comment id: 2008-07-20.2516380943
:title: Re:今日の野川サイクル 1044km
:author: Anonymous User
:date: 2008-07-20 23:14:12
:email: 
:url: 
:body:
1044にしかみえないけど、104.4でつか？

:comments:
:comment id: 2008-07-21.6264791016
:title: Re:今日の野川サイクル 1044km
:author: しみずかわ
:date: 2008-07-21 03:03:53
:email: 
:url: 
:body:
これまでの合計が1044でつ。紛らわしいんでタイトル修正。

%%%%%%%%%

:id: 603
:date: 2008-07-20 22:10:15
:title: サーバーを FreeBSD7.0 に移転中
:categories: ['Unix']
:body type: text/x-rst
:body:
移転元も移転先も自宅サーバー内なんだけど、移転先はML-115のDebianで動作しているVMWareの上のFreeBSD7.0。とりあえずWeb機能だけを移転してみた。とりあえずZopeだけ移転するつもりだったんだけど、色んなライブラリやProductに依存していて、インストールにかなりてまどってしまった。

特に、apache, subversion, openldap の依存関係が良くなくて、openldap-2.4を先にインストールしたら、あとでapache-2.2のldapサポートがopenldap-2.3に依存してることが分かったり。微妙に、なんだかなーな感じだった。あと、make.confにWITHOUT_X11=yesを入れ忘れてて、Xがビルドされちゃったりとか。途中で止めたけど。

1ヶ月前くらいにFreeBSD上でzfsを使うつもりで色々実験してたんだけど、仮想環境上にzfs構築してもあんまり意味がない気がしてきたのでやめ。今回は普通にufs2で領域確保して運用。個人環境では結局のところRAID1が一番良さそうな気がする。

とりあえず今の時点で手動で入れたportsを列挙してみる::

    apache-2.2.6_2
    jpeg-6b_4
    openldap-sasl-client-2.3.41
    openldap-sasl-server-2.3.41
    pam_ldap-1.8.4
    pamtester-0.1.2
    portupgrade-2.3.1,2
    py24-ldap2-2.3
    python-2.4,2
    python24-2.4.4_2
    ruby-1.8.6.111_1,1
    screen-4.0.3_1
    subversion-1.4.4_1
    subversion-python-1.4.4_1
    sudo-1.6.9.6
    vim-7.1.145
    wget-1.10.2_1
    zope29-2.9.7_1
    zsh-4.3.4_2

あと、pythonパッケージ::

    PIL (PythonImagingLibrary)
    SilverCity
    python-ldap
    setuptools (easy_install)
    pysvn


おまけ。/etc/make.conf::

    # PORTS MASTER SITE
    MASTER_SORT_REGEX?=     ^file: ^ftp://ftp\.FreeBSD\.org/pub/FreeBSD/ports/local-
    distfiles/ ://[^/]*\.jp/ ://[^/]*\.jp\.
        
    # Ports can place their working directories somewhere other than under
    # /usr/ports.
    WRKDIRPREFIX=   /var/tmp/ports
    
    # Where to get gzip'd, tarballed copies of original sources
    #
    DISTDIR=        /usr/ports/distfiles
    
    # FETCH_CMD     - Full path to ftp/http fetch command if not in $PATH
    #                       (default: &quot;/usr/bin/fetch -A&quot;).
    FETCH_CMD=      /usr/bin/fetch -A -p -r -T 30



:extend type: text/html
:extend:


:comments:
:comment id: 2008-07-21.5293297771
:title: Re:サーバーを FreeBSD7.0 に移転中
:author: koichiro
:date: 2008-07-21 05:08:49
:email: koichiro@meadowy.org
:url: http://ko.meadowy.net/~koichiro/diary/
:body:
portsも7.0-Releaseを入れたんだね。
ports-CURRENTだとちょっと前からSubversionまわりのパッケージ構成が激しく変わっていて
ウチも依存関係でハマったのでｗ注意。

subversion -> subversionとsubversion-develとsubversion-freebsdの派生パッケージができてる
subversion-python -> py-subversionに変更。同じルールでsubversion-perl -> p5-subversionとか。

portupgradeのpkgtools.confでALT_PKGDEPを設定しつつ調整するといいよ。
%%%%%%%%%

:id: 604
:date: 2008-07-27 01:15:14
:title: 今度は笠谷さんと飲んだ in うまいもの屋
:categories: ['Event', 'food']
:body type: text/x-rst
:body:
先日金曜日に夜のミーティング第二回に行ってきました。 `前回のミーティング`_ のメンバーであった大場(ko)さんとaihatenaに加え、今回はRails Awardの大場(nay)さんと、さらにSeleniumIDEの笠谷さんが参加されました！わーい、有名人だらけだ～。ところで○○の××さん、と書くとき自分は何の人なんだろう？

まずは、先日買った `Ruby on Rails 逆引きクイックリファレンス`_ 大場夫妻のサインをもらってとりあえず満足。

今回も色々と話をしたんだけど、日本酒飲みすぎて記憶が。。。じゃなくて、内容が濃すぎてここに全部は書ききれない。

テーマはやっぱり、日本で開発者として将来も仕事していくためにとかいうテーマ。先日の `オブジェクト倶楽部2008夏`_ の講演でもでてきた、 ``離見の見`` の話になって、「技術者としてちゃんとやっていこうとすると、ユーザー視点とかの、自分の枠の外からの視点もちゃんと持っていることが大事で、その視点を持って枠内の幸せを確保するには一旦枠の外に出る必要がある。だけど、枠の外から内側を幸せにしたとき、その枠の中には自分が居ないよね」、みたいな。nayさんの結論は「とりあえず自分だけ幸せになろう」、ってそれで良いのかな？先日平鍋さんとワールドパブで日本のSIerが幸せになるには、というテーマで話をしたときに「自分の幸せを確保して、その幸せの成功を周りに伝搬させることで最終的にみんな幸せになろう」という様なことを自分が言ったりしたので、なんだか符合するものがあるなあ。

あ、あと、八方美人になってるんじゃないかと指摘された。何でもかんでもやっちゃって自分の時間を失ってるというか、やりたいことがやれて無いんじゃないか、と。確かに！今の社内の体制だとやらざるを得ないというか、やらない、という方向で戦っても誰も幸せにならないというか。うーん、中間管理職的だなあ。確かにこれはいかんね。

笠谷さんにはBuildbotのすばらしさを語ってみたり。Buildbotは、とても良い自動テストフレームワークなんだけど、コンセプトとして持っている、オープンソースプロジェクトで「あ、これは自分が使っているプラットフォームでも動いて欲しいな」と思ったときに、自分の環境をBuildSlaveとしてProjectに提供してテストに使ってもらうための仕組みが素晴らしい。なんて語りつつノートPCで見せようとしたら5分しないうちに電池が切れたorz... ThinkPad X61s 電池の持ちが悪いぞ。Vistaのせいか？ （ `Buildbotのマニュアル`_ でコンセプトが語られています！大場さん曰く、SubversionBookみたいな構成。確かに。）

ということで、3時間では語り尽くせない、熱い夜でした。料理の味そっちのけでごめんなさい＞うまいもの屋さん。また飲みましょう！

.. _`Ruby on Rails 逆引きクイックリファレンス`: http://www.freia.jp/taka/blog/597
.. _`前回のミーティング`: http://www.freia.jp/taka/blog/569
.. _`オブジェクト倶楽部2008夏`: http://www.freia.jp/taka/blog/593
.. _`Buildbotのマニュアル`: http://svn.freia.jp/open/buildbot/docs/buildbot.html


:extend type: text/html
:extend:


:comments:
:comment id: 2008-07-27.8741877665
:title: Re:今度は笠谷さんと飲んだ in うまいもの屋
:author: voluntas
:date: 2008-07-27 12:37:55
:email: 
:url: 
:body:
buildbot の清水川さんでイイと思います:-)

%%%%%%%%%

:id: 605
:date: 2008-07-28 23:55:00
:title: Webキャリアさん主催のRuby on Rails セミナーに参加
:categories: ['Event', 'ruby-on-rails']
:body type: text/x-rst
:body:
* `随時開催!!Ruby on Railsセミナー | 株式会社ウェブキャリア`_

トーカーは、 `Ruby on Rails 逆引きクイックリファレンス Rails 2.0対応`_ 著者の大場寧子さん、大場光一郎さん、久保優子さん。今回は会社で一緒にRailsやってる同僚も一人連れて行ったんだけど、持ってきた名刺が2枚って‥‥。しかも1枚受付で渡しちゃうし。

資料は前述のサイトで後日公開されるらしい。

.. _`Ruby on Rails 逆引きクイックリファレンス Rails 2.0対応`: http://www.amazon.co.jp/dp/4839928266/freiaweb-22
.. _`随時開催!!Ruby on Railsセミナー | 株式会社ウェブキャリア`: http://www.web-career.com/seminar/entry.html


セミナー参加メモ
==================

RoRの価値は？
---------------------------------

* 生産性が高い
* RoRの感性にマッチしたエンジニアになる必要がある
   * 価値観・思想に染まる必要がある
* スクリプト言語は作り捨てに向いている？
   * RoRは構造化に向いている、本格的なフレームワーク
* 現状ではRoRエンジニアがキープできない
   * 現状の課題
   * これから育てていこう


RoRの開発チーム作り
---------------------------------

* 経験談
   * 最初はXP的にやった
   * 後半はコードが汚くなって生産性が落ちた
      * モチベーションが下がった

* ロケットスタートできるようにトレーニングした
   * Java開発者なら3日ほどで書けるようになる
   * エキスパートが参画する
   * ビギナーに任せっぱなしにしない
   * 作りっぱなしにしない
   * Try&Errorの後はレビューして学ぶ
   * いつでもディスカッション/レビューする文化を創る


開発をどう進める？
---------------------------------

* 最初のミーティングで一気に
   * Wikiに箇条書きにして書いていく
   * モデル、モジュール構成を決めていく

* 開始後は各自で開発を進めていく
   * 開発者同士でコミュニケーション
   * おおきな問題はミーティング招集

* ドキュメントは？
   * 納品ドキュメントは納品前にやっつける
   * チームに必要なドキュメントは随時Wikiに書いていく


RailsはAgileじゃないと使えない？
---------------------------------

* 大規模な会社ではAgileという言葉は出しにくい
   * 1ヶ月くらいの小さなウォーターフォール
   * 保守の中で新規開発してしまう

* ウォーターフォールだったらJavaで良いのでは？
   * Agile & Rails は画面を見せながら進められるのが良い

Rails開発を進めるときに大切なこと
---------------------------------

* 開発者は仕様にタッチしない
   * ・・・という雰囲気を打破することが重要
   * 大事なことは顧客を説得して仕様を変える
   * 開発者が「変だ」と思うことは意見する

* 名前付けが重要
   * 型付けが弱いので名前付けを誤ると訳分からなくなる
   * 名前付けがよいとコードがすんなり読める

* Rails経験者がDB設計に関わること
   * DBの構造や、テーブル設計がRails向きになってると楽

* 既存のDBを利用するのは難しい？
   * 複合キーの代わりにプライマリキーを作る
   * カラム名をちょっと変える
   * 既存DBをまったく変えられない場合は破綻する事例もある...

* 会議の議題を先にWikiに書いておく
   * 会議がスムーズに進む


バージョンアップの重荷
---------------------------------

* Railsはバージョンアップが大変
   * Railsはバージョンアップが頻繁にある
   * 自分のコードが動くかどうか確認するのが大変
   * プラグインがバージョンに追従してくれるか不明
      * 自分で面倒見る気で使おう

* バージョンアップすると
   * 処理スピードが改善される
   * 開発者のスキルが向上する
   * 新しいプラグインを使えるようになる

* Railsの仕組みを変えるようなコードは危険


何から始める？
---------------------------------

* Rails1.2のScaffoldでの生成コードを触ってみる
   * Rails2.0からのScaffoldは暗黙が多すぎて初心者には厳しい

* 基本編
   * コントローラを作る
   * モデルを作る
   * フォームを作る
   * POSTして保存するようにしてみる
   * ここまででMVCが出来るので、ここまでを1.x系でやってみるのが良いかも
   * 初心者の内こそペアプロとか良いよね
      * 複数人が悩んでる箇所なら質問しやすい！
   * コードレビューは必須でしょう

* 中級編以降
   * RESTful, Ajax など


開発環境は？
---------------------------------

* Aptanaを使っていますが(寧子)
   * 特段おすすめ、という訳でもないです
* NetBeansを勧めています(光一郎)
   * ウィザードで簡単に色々できます
   * ドキュメント生成などもサポートされているので良い
* MacはRakeが早い


バージョン管理？
---------------------------------

* CVS
* Subversion
   * 最近の主流
* Git
   * 今の流行
   * 2.0からのRailsでも対応している
      * pluginなど
   * GitHub
      * ソースコードSNS
      * gem の生成もやってくれる


プラグイン？
---------------------------------

* プラグインを主人にしない
   * 自分でメンテする気になって使おう
   * プラグインのコードは読んでおこう
      * 勉強になる
      * 何かあったときに対応できる

* おすすめPlugin
   * acts_as_list
   * will_paginate
   * restful_authentication
   * jpmobile
   * backgrounDRb
      * 長時間かかる処理をバックグラウンドで実行
   * gettext
      * エラーメッセージやカラム名を日本語にしてくれる
      * バージョンアップには弱い

* 時々使うプラグイン
   * active_scaffold
      * リッチなマスターメンテ機能をすぐに提供できる
      * 創意工夫を入れ込もうとするとハマる
      * Ajaxを多用してる
   * acts_as_taggable_on_steroids
      * タグ付けプラグイン
   * acts_as_state_machine
      * 状態遷移があるようなレコード
         * 処理中、処理受付中などをきれいに書ける
   * annotate_models
      * モデルの属性をrakeコマンドでコメント挿入してくれる
      * 便利

* 開発したプラグイン
   * image_update
      * 画像を保存前にプレビュー
      * 回転もできる
   * html5jp_graphs
      * jsでグラフを表示するプラグイン
      * 日本語凡例を入れられるのがGoogle版より良い


パフォーマンスを出すには
---------------------------------

* Railsは率直に言って重い
   * Rubyの問題か、作りの問題かを切り分けよう

* プロファイリング
   * 感で重い箇所を見つけるのは大抵間違っている
   * 重い箇所をしらべよう

* チューニング
   * joinで5テーブルとか重い -> join数を減らす設計にしよう
   * 外部キーにindexを張るのも重要

* キャッシュ
   * 重い箇所はキャッシュで。
   * Railsのキャッシュはとても柔軟
      * ログイン後用キャッシュ
      * ユーザー別キャッシュ

テスト？
---------------------------------

* Railsはテストの仕組みがデフォルト
   * UnitTest, FunctionalTest, IntegrationTest

* テストのこつ(寧子)
   * 目的の結果のみをテストする
      * 途中経過をテストしない
      * 変化に強くする
   * メソッドをまとめる？
      * (よく分からなかった...)

* RCov カバレッジツール
   * そのときのルールが、カバレッジ率100%だった
   * 意味があるのか？
      * あまり意味がないと思う(光一郎)

* Selenium on Rails
   * ブラウザ操作をシミュレートできる自動リグレッションテスト
   * 初期から入れておくと良いと思う
   * 回すのにパワーがいると思う

* フィクスチャ
   * ymlにid書かなくて良くなった

運用は？
---------------------------------

* 本番で動かなくなった、とかあるらしいけど、どうなの？
   * 本番と同じテストを使おう
   * Rubyは基本的に落ちますよ
   * 死活監視入れて、復帰するようにしよう
   * ミッションクリティカルな場所では使わないようにしようよ

* FastCGIを使ってると高負荷で落ちやすい
* 経験上、mongrelを使うようにしている


関連を使おう
---------------------------------

* コードがすっきりします
* Lazyな作りになっているのでパフォーマンスの問題もありません


Rails2.0以降のポイント
---------------------------------

* RESTful
* 組み替え (組み込み機能がplugin化)
* フィクスチャ
* NamedScope
* Rakeタスク
   * 色々Rakeから操作できるようになった
* パッケージ管理
* マイグレーション
   * 大きく変わった
   * マイグレーションバージョン番号が日付時刻になった
* git


RESTful
---------------------------------

* 美しいURLになる/しよう
* URL設計を起点に開発を進める
* 複雑なroutes.rbになってしまう
   * 初心者に難しい


NamedScope
---------------------------------

* 検索条件(Where句)個別に定義しておいて、利用時に任意の組み合わせ
   で利用することが出来る


まとめ
---------------------------------

* レールに乗ろう！
   * レールに乗って加速
* 80/20ルール
   * ビジネスに必要な80%で切ってしまうとおいしいと思う
   * 20%の労力で80%をカバーするフレームワーク
* 変更とつきあう


CTC Ruby 教育コース
---------------------------------

* Ruby技術者認定資格
   * 結構難しい
* Ruby/Railsトレーニングコース



参加した感想
============

感想としては、アンケートにも書いたんだけど、トークが速い！どのくらい速いかというと、前述の参加メモを書き取るので精一杯なくらいは速い。LTを60分聞いた感じ？でもとても参考になったし、大場夫妻の掛け合いっぽいところも面白かった。一部あきらかにアドリブでやってる部分とかあったし。実はあのトーク全部アドリブとか。

質疑応答しようとして時間が無くて聞けなかった事
------------------------------------------

* DBコネクションプールについて
* 名前付けについて、ハンガリアン記法とかどうですか？
* ヘルパーやプライベートをテストするには？

あきらかなネタが混じってますが(笑) いつか聞いてみよう。



:extend type: text/html
:extend:
%%%%%%%%%

:id: 606
:date: 2008-08-07 01:00:00
:title: 波状攻撃
:categories: ['misc']
:body type: text/x-rst
:body:
ここまでマルチタスクするのは初めて！ってくらい色々あった日であったことよ。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 607
:date: 2008-08-10 01:04:37
:title: ThinkVantage Access Connections がfopen failedとか言う
:categories: ['IT-PC']
:body type: text/x-rst
:body:
Thinkpad X61s を Windows Vista SP1 で使っていますが、いつの頃からか画面に ``fopen failed`` というダイアログが表示されるようになりました。しばらく原因が分からなかったのですが、レジュームから復帰した後や無線のAPが切り替わったときに発生することに気づき、最近になってようやくどのプロセスがそのダイアログを出しているのかを突き止めました。

最近、たまたまそのダイアログが出たときにProcessExplorerを使っていて、それでやっとAcSvc.exeというやつが出しているダイアログだと気づいた次第。Spy++とかで特定できるのは知ってたんだからもっと早く気づけよ俺、と。

で、AcSvc.exeはThinkpad付属のロケーションプロファイラ、AccessConnectionsというやつでした。そこまで分かれば、検索でたどり着くのも楽で、 `Re: printff - fopen failed error by AcSvc.exe on Vista - ThinkVantage Access Connections`_ というそのまんまな記事を発見。

**AccessConnectionsの4.52をVista SP1で使うとダイアログ出るから、4.42のインストーラ** `7rcn38ww.exe`_ **を使えばOKさ！**

という事らしいので早速インストールしたところ、無事ダイアログが出なくなりました。１ヶ月くらい我慢して使ってたのかな。Lenovoになってからなのか、Vistaになってからなのか、最近のThinkpadの付属ソフトウェアはあんまり安定していない気がしますな。最近、輝度コントロールの挙動も変だし。コンピュータをロックしたときにわざわざ暗くしなくても良いと思うんだけどなあ‥‥。

.. _`Re: printff - fopen failed error by AcSvc.exe on Vista - ThinkVantage Access Connections`: http://forums.lenovo.com/lnv/board/message?board.id=T_Series_Thinkpads&message.id=9207

.. _`7rcn38ww.exe`: ftp://ftp.software.ibm.com/pc/pccbbs/mobiles/7rcn38ww.exe


:extend type: text/html
:extend:
%%%%%%%%%

:id: 608
:date: 2008-10-26 16:26:11
:title: Zopeが4系列同時更新
:categories: ['Zope']
:body type: text/x-rst
:body:
ひさびさにBlogを書く時間が取れるようになり、第4回Python温泉ではずっとZopeをいじってました。
ということで、タイミング良く(?) Zopeの2.8～2.11の4系列のマイナーバージョンが同時に更新されました。さっそくリリースノートを更新して以下のURLに掲載しました。あと、途中まで和訳していた2.11.1のリリースノートも掲載しています。

* http://zope.jp/download/zope/releases/2.8.10
* http://zope.jp/download/zope/releases/2.9.10
* http://zope.jp/download/zope/releases/2.10.7
* http://zope.jp/download/zope/releases/2.11.1
* http://zope.jp/download/zope/releases/2.11.2

今回は `Hotfix-2008-08-12`_ があったためか、4つも同時にリリースされて翻訳が大変...じゃなくて、本家の方々もリリースが大変だったろうなぁと思います。（実際にはtrunkを開発しつつ、なので5系列、Zope3も含めると..）


.. _`Hotfix-2008-08-12`: http://www.zope.org/Products/Zope/Hotfix-2008-08-12/README.txt

:extend type: text/html
:extend:
%%%%%%%%%

:id: 609
:date: 2008-10-26 16:48:18
:title: 第4回Python温泉
:categories: ['pyspa']
:body type: text/x-rst
:body:
行ってきましたPython温泉。最終日2時間しか寝て無くて超眠くなってきたので、やったことだけ列挙してみる。

* バナナを3本食べた
* 温泉に4回入った
* RSSを3000件消化して、LDRでは各RSSが200件までしか保存されていない事実に愕然とした
* 自宅のPloneを2.5から3.1.6に上げる実験をした
* Plone-3.1.6でCMFContentPanelsを使えるようにした
* 自宅のFreeBSD7に移行したZopeがよく落ちるのはHUGE_STACKで解消される事に気づいた
* DropBoxを入れてみた。もうInternetDiskは要らないかも。
* Zopeの最新リリースの和訳をした
* 仕事もけっこうした
* 最中限のデッキルールが生まれた瞬間を目撃した
* 第5回(2009/6/26-28)のPython温泉の参加予約した

みなさん、お疲れ様でした。

とりあえず、寝る。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 610
:date: 2008-12-31 21:28:50
:title: 2008年末、秋田に帰ってきました
:categories: ['misc']
:body type: text/x-rst
:body:
気がつくと2008年ももう終わりです。早いなぁ。6月末くらいから忙しくなって土日が3ヶ月くらい無い感じだった訳ですが、10月以降はちょっとやる気が減少してしまっていました。やっぱり忙しすぎると反動があるなあ。

ということで、結局年内は面白いネタも特になく秋田の実家に帰ってきました。今回は小田急＆秋田交通の夜行バス増発版で帰ってきたんですが、増発は普通の環境バスなのでトイレが無くて深夜に2時間おきにトイレ休憩で停車＆明かりOn！寝れませんて・・。

普段2号車までしか無いのに今年末の夜行バスは9号車まで増発が。増発多すぎ。秋田まで往復16,000円だからしょうがないか。

結局最後の2時間くらいしか寝れずに秋田駅着5:50。おっかあ送迎車を待ちつつ秋田駅の交番でネイガーポスターを発見。



:extend type: text/html
:extend:


:comments:
:comment id: 2008-12-31.2318474154
:title: Re:2008年末、秋田に帰ってきました
:author: jack
:date: 2008-12-31 23:03:53
:email: 
:url: 
:body:
> やっぱり忙しすぎると反動があるなあ。

禿同。メンヘルクリニックいこうかと思ったほど。土日無しは2ヵ月半くらいだったけど
# 管理職なので残業しほうだい(;_;)

%%%%%%%%%

:id: 611
:date: 2008-12-31 23:09:06
:title: 2008年の年越しソバ
:categories: ['misc', 'food']
:body type: text/x-rst
:body:
自家製ツユがうまい。おっかあ、有難う。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 612
:date: 2009-01-01 00:00:00
:title: 明けましておめでとうございます。
:categories: ['misc']
:body type: text/x-rst
:body:
今年もよろしくお願いします。 o(_ _)o

:extend type: text/html
:extend:


:comments:
:comment id: 2009-01-01.0402831965
:title: Re:明けましておめでとうございます。
:author: koma2
:date: 2009-01-01 02:54:00
:email: koma2@lovepeers.org
:url: 
:body:
あけおめことよろw

某社は相変わらず大変そうだけど、まぁ死なない程度に頑張って下さいな…
%%%%%%%%%

:id: 613
:date: 2009-01-01 17:54:20
:title: 初詣＆初なまはげ
:categories: ['misc']
:body type: text/x-rst
:body:
毎年行ってる神社にお参りに。ちょうど正午くらいで混んでた。

そのまま車で男鹿の方の温泉へ。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 614
:date: 2009-01-22 01:25:18
:title: 和訳 [Zope-dev] Plans for Zope 2.12 
:categories: ['Zope']
:body type: text/x-rst
:body:
このエントリはZope-dev に流れた以下のメールの和訳です。

http://mail.zope.org/pipermail/zope-dev/2009-January/034150.html

------------

Hi there,

やあみんな。

based on an earlier Zope 2.12 thread

このメールは最近のZope 2.12についてのスレッドを元にしています。

http://mail.zope.org/pipermail/zope-dev/2008-October/033572.html

I propose that we get out an alpha version of Zope 2.12 by end
of February.

Zope 2.12 のαバージョンを2月末までにリリースする提案をしたいと思う。

http://mail.zope.org/pipermail/zope-dev/2008-October/033572.html

Major changes:

主な変更点:


- dropping Python 2.4 support officially (Python 2.4 is no longer officially supported by the Python developers so we can not safely support it)

- Python 2.4 の公式サポートを終了。(Python 2.4 は既にPython開発者たちの公式サポートが行われていないので我々もちゃんとサポート出来ない)



- focus on Python 2.6 support for the final release (although there are  still some tests failing - more than with Python 2.5). Possibly  focus on Python 2.5 support for the alpha phase. Not sure if we want to support Python 2.5 and 2.6 officially at the same time.  With the current classification of Python versions within the  configure script I would suggest::

    TARGET=Python 2.6.X
    ACCEPTABLE=Python 2.5

  Python 2.4.X would be basically not acceptable but could be used  at your own risk using the --with-python option.

- 最終リリースでは Python 2.6 のサポートにフォーカスする。  (とは言えまだ多くのテストが失敗している - Python 2.5 よりも)  出来るならα版ではPython 2.5 のサポートにフォーカスしよう。  Python 2.5 と 2.6 を同時に公式サポート出来るかどうかは今のところ分からない。  今のところ configure スクリプトの Pythonバージョンについての設定は以下のようにしたいと思っている::

    TARGET=Python 2.6.X
    ACCEPTABLE=Python 2.5

  Python 2.4.X は基本的に許容外だけど、 --with-python オプションで指定は出来る。ただし、自己責任で。



- complete eggification (apparently pretty much done)

- 完全にegg化 (見たところ大体出来てる)


- reducing Zope 3 dependencies (apparently pretty much done)

- Zope 3 への依存を削減 (見たところ大体出来てる)


- removing  ZClasses completely

- ZClass関連の完全削除


- ship with ZODB 3.9 (currently in alpha stage)

- ZODB 3.9 を同梱 (現在はα版)


Rough edges/open points I encountered so far:

今のところ遭遇している問題(Rough edges/open ponts)

- RestrictedPython security audit: such an audit has been made  by Stefan and Sidnei. I am not qualified to speak about the  correctness of the audit. I assume they know what they were  doing. Unless objections one might consider this issue as  resolved - if not, please speak up.

- RestrictedPython セキュリティー監査: これは Stefan と Sidnei  によって作られています。私はこの話題について口を挟めるほどの適任ではありません。私は彼らが何をしていたかを多分知っています。  その問題に反論がないのであれば解決と見なしたい。そうでないなら、議論を再開して。


- creation of some skripts e.g. "mkzeoinstance" when easy_install-ing the Zope 2 source distro does not seem to work or it is still  missing

- "mkzeoinstance" などの幾つかのスクリプトはeasy_installでZope2をインストールしたときに正しく動作しない、あるいはインストールされないように見える。


- how do to a "traditional" SVN checkout of the Zope 2 and the related Zope 3 modules? The Zope2.buildout maintains its dependencies through  a KGS - the old-style SVN checkout uses svn:external. I think there  is a need for having both and don't know of a save way for keeping  the svn:externals and the KGS in sync (without additional manual  effort).

- どうやってZope2と、関連するZope3のモジュールを "従来の" SVN チェックアウトで出来るようにするか？ Zope2.buildout はKGS(Known Good Set)を通じて関連づけられているし、従来のSVNチェックアウトは svn:external によって、関連づけられている。両方とも維持する必要があると考えているが、 svn:externals と KGS を同期しつつ保持しておく(追加の努力無しでの)方法が分からない。

Andreas


:extend type: text/html
:extend:
%%%%%%%%%

:id: 615
:date: 2009-01-22 02:16:01
:title: ATExtFlashをPlone3対応にする(1)
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
試行錯誤メモです。

技術のノウハウって試行錯誤で得られた結果も大事だけど、課程も大事だよね、というもっともらしい理屈をつけてblogのエントリを水増しする計画。

:元ソースコード: http://svn.freia.jp/open/ATExtFlash/branches/plone2.1.x
:Python: 2.4.4
:Zope: 2.10.7
:Plone: 3.1.6
:OS: Windows Vista


CMFCorePermissionsが無い
-------------------------

permissions.py で::

  from Products.CMFCore.CMFCorePermissions import setDefaultRoles

がエラーになってZopeを起動できなかった。
以下のようにして修正。(code from Products/kupu)::

  try:
      from Products.CMFCore.permissions import setDefaultRoles
  except ImportError:
      # for CMF 1.4
      from Products.CMFCore.CMFCorePermissions import setDefaultRoles


CMFQuickInstallerTool のエラー
------------------------------

Ploneインスタンス追加時にGenericSetupのログに混じって以下のエラーが表示された::

  2009-01-22 01:53:44 ERROR CMFQuickInstallerTool ATExtFlash, ImportError: No module named migrate

何だろう。GenericSetupじゃなくて従来のCMFQuickInstallerでうまくやってくれようとしたけど、何かmigrateという名前のモジュールがないというエラーが出ている。エラーは出ているもののplone siteオブジェクトの追加は出来たので、Ploneの画面でアドオンプロダクトの追加画面で追加しようと思ったけど、追加Productの一覧にATExtFlashが表示されていなかった。やっぱり直さないとだめか。

調べてみたら、 ATExtFlash/Extensions/Install.py の中で::

  from Products.CMFDynamicViewFTI.migrate import migrateFTIs

という記載があり、Products.CMFDynamicViewFTIにmigrateというモジュールが無くなっていた。そしてmigrateFTIsというモジュール?/関数? も見あたらなかった。これを追っかけるのが早いか、GenericSetup対応に書き換えるのが早いか...。多分Ploneの開発者向けドキュメントを見ながらGenericSetup対応したほうが早そうだ。


今日はここまで。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 616
:date: 2009-01-22 02:37:12
:title: VistaでVMWare Serverが固まる件はVMWare Server 2.0 にして解決
:categories: ['IT-PC']
:body type: text/x-rst
:body:
* `VistaでVMWare Serverが固まる`_
* `VistaでVMWareが固まる件、とりあえずの回避策`_

上記のときの VMWare Server のバージョンは1.0.4～1.0.8のどれでも発生していて、結局のところちゃんと解決する方法が見つかっていなかった。

昨日、ふと思い立って再度Googleで検索してみたら以下の記事が見つかった。

.. Highlights::
  VMWare 2.0 Beta 2 にすればこのバグによってVM起動時に発生するシステムの無応答状態は解消されるようだ。

  -- `VMWare Server Causes System Frozen, Hang and Unresponsive When Power/Start Up in Vista`_

ということで、VMWare1.0.5をアンインストールして2.0を入れ直したらすんなり起動するようになった。解決。

でも VMWare Server 2.0 は VMWare Server Console が JavaApplet になってしまったので使いづらい気がする。慣れの問題かもしれんけど。他にもWindows Guest用のVMWareToolsが用意されていないように見えるとか、UIが英語になってしまったとか、色々気になるところがあるなあ。Windows VistaがHostの環境で準仮想化(paravirtualization)が使えれば良いんだけどな。XenとかVMWareのそのへんの最新動向はどうなってるのかな？


.. _`VistaでVMWare Serverが固まる`: http://www.freia.jp/taka/blog/546
.. _`VistaでVMWareが固まる件、とりあえずの回避策`: http://www.freia.jp/taka/blog/595
.. _`VMWare Server Causes System Frozen, Hang and Unresponsive When Power/Start Up in Vista`: http://www.tipandtrick.net/2008/vmware-server-causes-system-frozen-hang-and-unresponsive-when-powerstart-up-in-vista/


:extend type: text/html
:extend:


:comments:
:comment id: 2009-01-23.6870163907
:title: Re:VistaでVMWare Serverが固まる件はVMWare Server 2.0 にして解決
:author: jack
:date: 2009-01-23 11:28:08
:email: 
:url: 
:body:
いいこときいた。やってみようかな。でもメモリがあまり載ってないのが・・・

:comments:
:comment id: 2009-01-23.9526548440
:title: Re:VistaでVMWare Serverが固まる件はVMWare Server 2.0 にして解決
:author: しみずかわ
:date: 2009-01-23 12:39:13
:email: 
:url: 
:body:
> いいこときいた。やってみようかな。でもメモリがあまり載ってないのが・・・

2.0 になって管理画面がJavaAppletになったりJava環境が専用でインストールされたりtomcatが稼働していたり、と、DISKもMEMも使用量が増えた感じがしますね。

Guest起動してない状態で調べてみた:
 * VMWare Server 1.0 DISK: 106MB, MEM: 30MBくらい。
 * VMWare Server 2.0 DISK: 650MB, MEM: 260MBくらい。

増えた感じ、どころじゃないな...

%%%%%%%%%

:id: 617
:date: 2009-01-23 00:29:08
:title: 今年の目標
:categories: ['misc']
:body type: text/x-rst
:body:
今更ながら、今年の目標を晒しておこうと思います。

* 社内勉強会する
* いろんなフレームワークでBattleLineを実装する
* 松島かき祭りに行く

こんなところか。もう少し掘り下げて..

社内勉強会する
--------------
去年も発表形式のはやったけど、なんか手応えがなかったので、参加型の勉強会にしてみようと思う。読書会？開発？まあやりながら数回毎にテーマを切り替えて行っても良いかな。

キーワード: 朝。参加型。勉強。


いろんなフレームワークでBattleLineを実装する
-----------------------------------------
バトルラインは簡単なルールのカードゲームで、2人プレーで割り込みが無いのでWebでやるにはやりやすいので選んでみた。元々、同じものを違うフレームワークで実装したら勉強になるかな、と思っていたんだけど、去年のクリスマス会でaihatenaとバトルラインをやって、これだ！と。

正月に早速aihatena宅に一泊して開発合宿して、1/19あたりで一応遊べるところまでは持ってきた。最初のフレームワークはRuby on Rails + Pure HTML.

キーワード: 同じものを別フレームワークで実装。Pure HTML, AJAX, Flex, AIR, Rails, Zope ,Django, Google App Engine.


松島かき祭りに行く
-----------------
毎年2月第1週の土日に行われる、ひたすら牡蠣を焼いて食べる祭り。仙台松島で行われる。十数個の殻付き牡蠣が500円で売られていて、その場で焼いて食うらしい。これに参加してたくさん牡蠣を食べてこようと思う。

`そろそろ松島かき祭りについてひとこと言っておくか`_ によると、かなりの激戦が予想される。とりあえず交通手段は手配済み。

.. _`そろそろ松島かき祭りについてひとこと言っておくか`: http://ko.meadowy.net/~koichiro/diary/20090122.html#p01


:extend type: text/html
:extend:
%%%%%%%%%

:id: 618
:date: 2009-01-23 01:24:07
:title: BattleLine RoR (1)
:categories: ['ruby-on-rails']
:body type: text/x-rst
:body:
`今年の目標`_ のエントリに書いたように、いろんなフレームワークでBattleLineを実装しようというやつの第一弾。

Pure HTML から始めて、AJAXでの操作の辺りでRESTfulとかWebAPIとか整備して、UIをFlexとかで置き換えて、どっかのタイミングでWebサーバー側を別フレームワークに切り替えて...みたいな感じで色々なフレームワークを勉強していきたい。

まずは Ruby on Rails 2.1 + Pure HTML で実装してみる。

正月の開発合宿から作り始めて、先週末後、1/18にやっと遊べるようになった。そのときの画面のスナップショットを貼っておく。

このときはまだ情報が並んでいるだけでとても遊びづらかった。TROOPカードはほんとは6色あるのに、A～Fの記号で表示されてたり、手札がソートされてなかったり、最後に指した手がなんだったか分からなくなったり、部隊カード山と戦術カード山を間違えたり...。

**そうか、機能要件だけは満たしてるけど使えないシステムって、こういう感じだよね。**

勉強したこと
------------

RoR: Modelにserialize指定でオブジェクトをRDBに保存出来る
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

あるターンでの山札の並びはRDBにどうやって格納するべきか。山札配列にカード名の文字列を入れておいて、プレイ時に先頭から取り出していきたい。ZopeならListに入れておけばそのままZODBに保存してくれるけど、RoRの場合は...?

解: serialize を使う

.. code-block:: Ruby

  class Round < ActiveRecord::Base
    serialize :troops, Array
    ...
  end

DB保存時にto_yamlでyaml化したものが保存されるので、上記のように書いておくことでDBからのロード時にArrayとして復元してくれるようになる。ArrayとかHashとか独自クラスとかイケル。

でも、以下のようにしたらはまった。

.. code-block:: Ruby

  round = Round.last
  card = round.troops.shift
  round.save

上記だとtroopsの中身が変わっている事をRailsが見逃してしまう(2.1からpartial updates対応になったため?)ので、 ``round.troops_will_change!`` を呼んであげてからsaveすることにした。

一応ODBっぽい感じに使えるけど、バグの原因になりそうだな。


.. _`今年の目標`: http://www.freia.jp/taka/blog/617



:extend type: text/html
:extend:
%%%%%%%%%

:id: 619
:date: 2009-01-23 01:43:02
:title: 松島かき祭りに行く準備
:categories: ['Event', 'food']
:body type: text/x-rst
:body:
`今年の目標`_ の3つめ。2月第一週土日に、仙台松島に行って、松島かき祭りに参加する。

そのための準備をしておく。

1. 朝8時～9時に現地入り出来るように夜行バスを予約する
2. 防寒具をしっかり用意する
3. 日曜(2/8)に行くつもりなので、月曜は休みを申請しておく
4. ノロに負けない胃にしておく
5. `そろそろ松島かき祭りについてひとこと言っておくか : 暮らしの業(2009-01-22)`_ を読んで覚悟を決める

.. Highlights::
  仙台Ruby会議01の `東北で一言`_ で、 `松島かき祭り`_ について言及したところ『せっかくだから俺はこの「松島かき祭り」に行くぜ』などと突き動かされるものを感じてしまった勇者が現れたので松島かき祭り参加にあたっての諸注意をまとめておきます。

  -- `そろそろ松島かき祭りについてひとこと言っておくか : 暮らしの業(2009-01-22)`_

はい。勇者です（笑） まとめてもらった情報を役立てたいと思います。


.. Highlights::
  座れる場所が無いに等しいので簡易の折りたたみ椅子があるとグッと楽になります。 `一昨年いったとき`_ は、だいぶ役に立ちました。間違ってもレジャーシートを敷こうとはおもわないこと。寒くて死にます。プロはキャンプ用のバーベキューセットとイスを持ち込んだりしてます。

  -- `そろそろ松島かき祭りについてひとこと言っておくか : 暮らしの業(2009-01-22)`_


折りたたみイスかぁ... それは持ってないなぁ。

.. _`今年の目標`: http://www.freia.jp/taka/blog/617
.. _`そろそろ松島かき祭りについてひとこと言っておくか : 暮らしの業(2009-01-22)`: http://ko.meadowy.net/~koichiro/diary/20090122.html#p01
.. _`東北で一言`: http://regional.rubykaigi.org/sendai01
.. _`松島かき祭り`: http://www.matsushima-kanko.com/midokoro/siki/oyster.html
.. _`一昨年いったとき`: http://www.flickr.com/photos/13102118@N05/sets/72157612783977949/



:extend type: text/html
:extend:


:comments:
:comment id: 2009-01-25.6251206348
:title: Re:松島かき祭りに行く準備
:author: とやま
:date: 2009-01-25 22:53:45
:email: 
:url: 
:body:
福岡の海沿い（佐賀寄り）には冬に「かき小屋」っつーのがあって、同じように牡蠣いっぱい食えるよ。蛤とかもうまかったー。この年末年始にかみさんの実家に帰ったときに行って食いまくったのだ。
あーあとタイムリーなことに俺も社内勉強会するよ。C++で本一冊、俺講師。結局PukiWiki使うことにした。

:comments:
:comment id: 2009-01-25.8967128576
:title: Re:松島かき祭りに行く準備
:author: しみずかわ
:date: 2009-01-25 23:14:56
:email: 
:url: 
:body:
福岡まで牡蛎食いに行くのは無理だなぁ...。しかし日本人は牡蠣好きだね！

%%%%%%%%%

:id: 620
:date: 2009-01-24 20:41:53
:title: BattleLine RoR (2)
:categories: ['Programming', 'boadgame', 'ruby-on-rails']
:body type: text/x-rst
:body:
1/19日時点でカードに色を付けて手札をソートするようにしたら、格段に見やすくなってゲームに集中できるようになった。やっぱり見た目のわかりやすさは重要。あと人間がものを判別するときってかなり色に頼ってるんだなぁと思った。識別のための配色は重要。

スナップショットでは左の手札のところがラジオボタンとカードの位置がずれていて縦に伸びてしまっている。カードに画像を使えば簡単に直せそうなんだけど、とりあえずは画像は無しで。

次の目標は、実際のカードを使ったプレート同じように、場のカードの並べ方を右に90度回転させて、自分の置いたカードが手前側に表示されるようにして、より分かりやすくすることかな！


勉強したこと
------------

RoR: 命名規約に沿っていないクラスをserializeすると復元出来ない
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
`BattleLine RoR (1)`_ では部隊カードの山札を格納する変数 troops や戦術カード山札の tactics を以下のように実装していた。

app/models/round.rb:

.. code-block:: Ruby

  class Round < ActiveRecord::Base
    serialize :troops, Array
    ...

    def setup
      self.troops = ['A1','A2','A3',...,'B1','B2',...].sort_by{rand}
      self.tactics = ['ALEXANDER','DARIUS',...,'REDEPLOY',...].sort_by{rand}
      ...
    end
  end

このままだと色づけのためのスタイルシートclassの設定とか諸々がif文の嵐になってしまうので、Cardクラスを作ってゲームに使用するカードは全てCardクラスの派生クラスとして再実装した。

lib/card.rb:

.. code-block:: Ruby

  class Card
    ...
    def self.new_troops
      TROOP_NAMES.collect{|name| TroopCard.new name}
    end
    def self.new_tactics
      TACTICS_NAMES.collect{|name| TacticsCard.new name}
    end 
  end

  class TroopCard < Card
    ...
  end

  class TacticsCard < Card
    ...
  end

で、改めてround.rbの実装を以下のように書き直した。

app/models/round.rb:

.. code-block:: Ruby

  class Round < ActiveRecord::Base
    serialize :troops, Array
    ...

    def setup
      self.troops = Card.new_troops.sort_by{rand}
      self.tactics = ...
      ...
    end
  end

そうしたところ、画面表示にエラーが出るようになってしまったので、script/console で原因を確認したところ、保存してあったRoundレコードを読み込んだときにtroopsが正しくロードされなくなってしまっていた！


.. code-block:: Ruby

  $ ruby script/console
  >> round = Round.last
  >> round.troops[0]
  => #<YAML::Object:0x5832ad4 @ivars={"name"=>"A1"}, @class="Card">

なんじゃこりゃ。#<YAML::Object .. ってYAMLのクラス？なんでTroopCardじゃないんだろう？

（...試行錯誤1時間くらい...）

round.rb で require 'card' してあげたらちゃんとロード出来るようになった。

.. code-block:: Ruby

  $ ruby script/console
  >> round = Round.last
  >> round.troops[0]
  => #<TroopCard:0x4f12a1c @name="A1">

Rails の仕組みで、正しい名前のクラスなんかは自動的にファイルから読み込んでロードしてくれるようになっているけど、lib/card.rb ファイルに実装したTroopCardクラスはシリアライズした文字列からオブジェクトに戻す時に不明なクラス扱いされてしまっていたらしい。とりあえずrequire 'card'ってしておいたら、ちゃんと TroopCardクラスのインスタンスに戻してくれるようになった。

でも、そんな細かいクラス一つ一つのために命名規約に沿ってファイルを分けるの面倒くさいよ？


RoR: lib以下のファイルは自動再読み込みしてくれない
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

lib以下のファイル、というよりは特定のクラスの派生クラスしか自動再読込してくれないっぽい。コントローラやモデルなんかは自動再読込してくれるけど、独自に作ったクラスはだめだった。試しにlib以下じゃなくてmodels以下に置いてみたけどやっぱり駄目だった。

で、色々調べていったところ、Railsで行われている自動リロードは以下のような手順で実現しているっぽい。

 1. active_support/dependencies.rbでModelとClassに ``const_missing`` メソッドが定義されていて、定数(クラスとか)が無い場合に自動ロードする仕組みになっている
 2. Rails(というか今回調べたのはMongrel)はRequest処理が終わる毎にリロード可能なクラスとかを無効化(unload)している
 3. 無効化のためにactive_support/dependencies.rbの ``Dependencies.clear`` が呼び出されている
 4. 次のRequest時にはunloadされた定数が見つからないので ``const_missing`` でリロードされる

このとき無効化されるクラスはActiveRecord::Baseの継承クラスとか特定のクラスに限られるっぽい。

じゃあ、無効化される対象クラスにするにはどうすれば良いのか...と思ってさらに active_support/dependencies.rb を読んだところ、 Model, Class, Object に ``unloadable`` というメソッドが追加されていて、これ呼び出すと Dependencies.clear でunloadされるようになるらしい。

実際ちゃんと動くかどうか以下のようにして試してみた。

lib/foo.rb:

.. code-block:: Ruby

  class Foo
    puts 'class Foo loaded!'
  end
  Foo.unloadable

.. code-block:: Ruby

  $ ruby script\console
  Loading development environment (Rails 2.1.0)
  >> Foo
  class Foo loaded!
  => Foo
  >> Foo
  => Foo
  >> Dependencies.clear
  => ["Foo"]
  >> Foo
  class Foo loaded!
  => Foo

  /* modify puts line in foo.rb */

  >> Dependencies.clear
  => ["Foo"]
  >> Foo
  class Foo loaded! loaded! yahoo!!
  => Foo

うまくいったっぽい！


しかし、Railsで使う用の独自クラス(Card)に上記を適用してみたところ、serializeで独自クラスを含むArray, Hashの復元がうまくいかなくなってしまった‥‥。あちらを立てればこちらが立たず。あと一歩というところなんだけどなぁ。


.. _`BattleLine RoR (1)`: http://www.freia.jp/taka/blog/618



:extend type: text/html
:extend:
%%%%%%%%%

:id: 621
:date: 2009-01-25 16:36:44
:title: cmd.exe代替アプリckwの改造版をさらに改造してconfig切り替え機能を付けたい
:categories: ['Programming', 'Windows']
:body type: text/x-rst
:body:
ckwはputtyライクなwindowでdos窓操作ができるアプリです。nyacusと組み合わせるとかなりunixっぽくなります。ckw について詳しくは `ckwとnyacusとztop`_ とか `cmd.exeを超便利にする ckw 0.8.10 を改造した。`_ を参照ください。

で。

ckw ではAllocConsoleを使ってコンソールWindowを作成しつつ、非表示にしている処理があって、これが元ソースやmod2ではVistaでうまく働かずDOS窓とckw窓が両方起動するという問題があった。これをﾅﾝﾄｶしようと思って色々みていたら既に解決されている方がいて、その修正を取り込んだ版がうまく動作した。

* `ckw 0.8.10 改造版を更に改造した（修正しただけ）`_

でもって、先日Plone研究会でsvnコマンドの使い方をプロジェクタしたときに、動的に画面表示のフォントサイズなどを切り替えられたら便利だろうなと思って、今朝の３時から明け方７時過ぎまでコードを改造して、とりあえずタイトルバーの右クリックに切り替えメニューを追加するところまで実装した。内部的には指定された*.cfgを読み込むところまで作ったので、あとはサイズなどをWindowに適用すれば動く・・・かな？

*# exeと同じファイル名のcfgを用意しておけばそれを読み込んでくれるので、そっちを起動すればいいんだけどね・・・。*


さて、複数人の人たちが独自に修正を入れているckw, そろそろCodeReposとかGoogleCodeとかにコードを置くべきだろうか...。


.. _`ckwとnyacusとztop`: http://www.freia.jp/taka/blog/526
.. _`cmd.exeを超便利にする ckw 0.8.10 を改造した。`: http://d.hatena.ne.jp/hideden/20071115/1195229532
.. _`ckw 0.8.10 改造版を更に改造した（修正しただけ）`: http://blogs.wankuma.com/shuujin/archive/2008/10/15/158825.aspx



:extend type: text/html
:extend:


:trackbacks:
:trackback id: 2009-07-12.4853193075
:title: Tools@System
:blog name: @note (PukiWiki/TrackBack 0.4)
:url: http://redpanda.sakura.ne.jp/wiki/note/index.php?Tools%40System
:date: 2009-07-12 13:54:46
:body:
CommandPrompt    cmd.exe代替アプリckwの改造版をさらに改造してconfig切り替え機能を付けたい - 清水川Web    Bookmarks    cmd.exe代替アプリckwの改造版をさらに改造してconfig切り替え機能を付けたい - 清水川Web Mobile Orz: フォルダの使用量を可視化するソフトを...

%%%%%%%%%

:id: 622
:date: 2009-01-25 19:11:03
:title: BattleLine RoR (3) serializeした独自クラスをYAMLからロード時に再読込
:categories: ['Programming', 'boadgame', 'ruby-on-rails']
:body type: text/x-rst
:body:
注）ここで記載しているBattleLineは、GoogleでたくさんヒットするBattleLine Onlineとは別物です。


1/20, 1/21 と、場のカードを90度回転させて、配色をより分かりやすくしてみた。このへんの実装そのものは殆どCSSの設定とテンプレートの変更だったのであんまり勉強ってことはなかったんだけど、カードの表示をする部分を部分テンプレートにして呼び出すようにしたのがせめてもの工夫と言えば工夫か。なんかdevelopment.logにテンプレートレンダリングのログがたくさん出てしまって邪魔だけど。

勝利ラインに色を付けて、だいぶそれっぽくなってきたので、次はそろそろゲームの勝敗の確定部分を実装する頃か‥‥と思ってたらaihatenaからリプレイ閲覧機能が欲しいとメッセージが来た。リプレイ見るためにはまず勝敗を確定させないとね‥‥。


勉強したこと
------------

RoR: 命名規則に沿っていないファイル名/クラスを自動ロードする
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

独自クラスが自動リロードされない問題を色々調べていたら、ApplicationControllerもapplication_controller.rbではなくapplication.rbという名前のファイルで定義されているのになぜかちゃんと自動読み込みされていたので、どこかで特別な処理をしているはずだ！と思って調べてみた。

まずは自動ロード関連ということで active_support/dependencies.rb でapplication.rbを検索。発見っ。Dependencies#loadable_constants_for_path でなんかやってるらしい事が分かったので周辺の実装を読んでいったところ、Dependencies#depend_onでconst_missing時にたどるファイルを追加できる事が分かった。さらにObjectクラスへの追加メソッド Object#require_dependency でdepend_onが呼び出されるようになっている。何という迷路。

active_support/dependencies.rb:

.. code-block:: Ruby

  Object.instance_eval do
    define_method(:require_or_load)     { |file_name| Dependencies.require_or_load(file_name) } unless Object.respond_to?(:require_or_load)
    define_method(:require_dependency)  { |file_name| Dependencies.depend_on(file_name) }       unless Object.respond_to?(:require_dependency)
    define_method(:require_association) { |file_name| Dependencies.associate_with(file_name) }  unless Object.respond_to?(:require_association)
  end


Rubyのモンキーパッチ的なこういう実装って分かりやすいんだか分かりにくいんだかよく分からない...。Pythonだとこういう書き方はしないなぁ。

ということで、このrequire_dependencyを使うことで、自動ロードされない名前を探しに行ってくれるようになった。

lib/foo.rb:

.. code-block:: Ruby

  class Foo
    puts 'class Foo loaded!'
  end
    
  class Bar
    puts 'class Bar loaded!'
  end


.. code-block:: Ruby

  $ ruby script\console
  Loading development environment (Rails 2.1.0)
  >> Bar
  NameError: uninitialized constant Bar
          from activesupport-2.1.0/lib/active_support/dependencies.rb:278:in `load_missing_constant'
          from activesupport-2.1.0/lib/active_support/dependencies.rb:467:in `const_missing'
          from activesupport-2.1.0/lib/active_support/dependencies.rb:479:in `const_missing'
          from (irb):1
  >> require_dependency 'foo'
  class Foo loaded!
  class Bar loaded!
  => true
  >> Bar
  => Bar

ところで、 ``require 'foo'`` や ``load 'foo'`` するのと ``require_dependency 'foo'`` するのとでは何が違うのか？よくわからなかったので調べてみると、requireやloadはそれを実行したファイル内などでしか有効じゃないけど、require_dependencyはシステム全体に影響するらしい事が分かった。で、それを消すのがDependencies.clearらしい。なるほど。

さらに grepしてみると action_controller/dispatcher.rb で以下のように使っているのを見つけた。

action_controller/dispatcher.rb:

.. code-block:: Ruby

  require_dependency 'application' unless defined?(::ApplicationController)

Request処理するときに最初に関連づけ設定してるのね。


RoR: serializeした独自クラスをYAMLからロード時に再読込
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

独自クラスはソースコード更新しても自動再読込されない問題に対して、昨日書いた ``unloadable`` を使う方法ではない方法で解決してみた。serializeしたインスタンスはYAMLでDBに保存されるので、これをde-serializeする時にYAMLの処理をhookしてリロードできないか試してみたらうまくいった。

まず、独自のクラスをYAML化する機能は、以下のように特に何もしなくても提供される。

.. code-block:: Ruby

  $ ruby script/console
  >> class MyClass
  >>   def initialize(name=nil)
  >>     @name = name
  >>   end
  >> end
  => nil

  >> o1 = MyClass.new 10
  => #<MyClass:0x4f0a420 @name=10>

  >> o1.to_yaml
  => "--- !ruby/object:MyClass \na: 10\n"

  >> o2 = YAML::load(o1.to_yaml)
  => #<MyClass:0x4efc44c @name=10>

で、これをload時にhook出来るようにするにはYAMLモジュールにtypeを追加定義してあげる。

ruby script/console:

.. code-block:: Ruby

  >> class MyClass
  >>   yaml_as "tag:freia.jp,2009:console"
  >> end
  => MyClass

  >> o1.to_yaml
  => "--- !freia.jp,2009/console \na: 10\n"

最後に、YAMLのloading機構に登録する。 ``add_domain_type`` の使い方は `YAML::add_domain_type Method`_ を参照。

.. code-block:: Ruby

  $ ruby script/console
  >> YAML::add_domain_type( "freia.jp,2009", "console" ) do |type, val|
  ?>   puts type
  >>   puts val.inspect
  >>   MyClass.new val['name']
  >> end
  => nil

  >> o3 = YAML::load(o1.to_yaml)
  tag:freia.jp,2009:console:MyClass
  {"name"=>10}
  => #<MyClass:0x44e3064 @name=10>

これでシリアライズされたインスタンスをYAMLから戻すときに任意の処理が出来るようになった。さらに継承したクラスについても一括で処理出来るようにもう一工夫。

.. code-block:: Ruby

  $ ruby script/console
  >> YAML::add_domain_type( "freia.jp,2009", "console" ) do |type, val|
  ?>   puts type
  >>   puts val.inspect
  >>   klass = type.split(':')[-1].constantize
  >>   klass.new val['name']
  >> end
  => nil

最後に、上記のconstantizeの行の前にrequire_dependencyを記述しておけば、YAML::load時に、require_dependencyしたファイルをリロードしてくれて、命名規則違反のクラスもちゃんとロード出来るよになった。

対象ファイルに定数定義があると問題になるけどな！（対策はまたいつか考えよう・・・）

以下が完成したmy_class.rbと実行結果。

my_class.rb:

.. code-block:: Ruby

  class MyClass
    yaml_as "tag:freia.jp,2009:my_class"

    def initialize(name=nil)
      @name = name
    end
  end

  class MySecondClass < MyClass
  end

  YAML::add_domain_type( "freia.jp,2009", "my_class" ) do |type, val|
    require_dependency 'my_class'
    klass = type.split(':')[-1].constantize
    klass.new val['name']
  end

.. code-block:: Ruby

  $ ruby script/console
  >> o1 = MyClass.new 'abc'
  => #<MyClass:0x4ed4190 @name="abc">

  >> y1 = o1.to_yaml
  => "--- !freia.jp,2009/my_class \nname: abc\n"

  >> YAML::load(y1)
  => #<MyClass:0x4ecded0 @name="abc">


  >> o2 = MySecondClass.new 'def'
  => #<MySecondClass:0x4567e04 @name="def">

  >> y2 = o2.to_yaml
  => "--- !freia.jp,2009/my_class:MySecondClass \nname: def\n"

  >> YAML::load(y2)
  => #<MySecondClass:0x4561d74 @name="def">

  >> Dependencies.clear
  => []
  >> MySecondClass
  NameError: uninitialized constant MySecondClass
  ...

  >> YAML::load(y2)
  => #<MySecondClass:0x5219c60 @name="def">

.. _`YAML::add_domain_type Method`: http://yaml4r.sourceforge.net/doc/class/yaml_add_domain_type_method.htm



:extend type: text/html
:extend:


:comments:
:comment id: 2009-01-31.1873859753
:title: Re:BattleLine RoR (3) serializeした独自クラスをYAMLからロード時に再読込
:author: aihatena
:date: 2009-01-31 10:59:48
:email: 
:url: 
:body:
本日のdebug結果
* 先攻1ターン目に手札がソートされていない
* IEで表示すると青の背景色が無い/赤が原色
* AとE、BとFの色が同じに見えるので差が欲しい
* 後攻の見た目が先攻の鏡面表示。本来は9->1列の順
　これはまあシステム上仕方がないかも
* SCOUT,DESERTER使用時にもライン選択が必須。
　平常時はかまわないけど、置けないときに困る。
　戦術カード引ききって邪魔するような場合もあるので
* 3枚置いた列にラジオボタンでないので MUD,FOG置けない
　置ける列だけラジオボタン、という前提が間違ってた。
　もしくはMUD,FOG持ってるときだけラジオボタン出すなど
* 勝利判定が動いてない。SKIPしまくりで終わらない

:comments:
:comment id: 2009-01-31.1612190362
:title: Re: バグ報告
:author: しみずかわ
:date: 2009-01-31 13:29:23
:email: 
:url: 
:body:
報告感謝！

けっこうバグってるな－・・・。やっぱりテスト書かないと駄目だね。

%%%%%%%%%

:id: 624
:date: 2009-02-03 02:26:35
:title: 松島かき祭りに行く準備で買った携帯イス
:categories: ['misc', 'food', 'trip']
:body type: text/x-rst
:body:
* `松島かき祭に行く準備`_ 

注文していた折りたたみ携帯イスが届いた。買ってから気づいたんだけど、耐荷重60kgとか書かれている。あと5日でそこまで痩せろということか。座って壊したら週末使えなくなるので怖くてまだ座ってない...と言うか袋の留め具は最初からバネが飛び出していた...。


.. _`松島かき祭に行く準備`: http://www.freia.jp/taka/blog/619


:extend type: text/html
:extend:
%%%%%%%%%

:id: 623
:date: 2009-02-03 02:29:21
:title: BattleLine RoR (4)
:categories: ['Programming', 'boadgame', 'ruby-on-rails']
:body type: text/x-rst
:body:
*注）ここで記載しているBattleLineは、GoogleでたくさんヒットするBattleLine Onlineとは別物です。*

---------------

最後にプレイしたカードの外枠に色を付けて、いちいち手順履歴を見なくても分かるようにしてみた。
あと、アレキサンダー vs ダリウス なゲームなので、ALEXANDERを使ったプレーヤーはDARIUSを使えないように判定を入れようと思ったけど、このために ``リーダー使ったflag`` を持たせるのはイヤだなぁ。でもflag持たせないと全履歴サーチしないといけないのでやっぱりroundテーブルにflagを持たせるべきか...。

そろそろDBの設計は再検討したほうが良いかもしれない。再設計するならテストを書かないといかんなぁ。

とりあえずゲームの勝敗の確定部分を実装して、公開可能にするか。


勉強したこと
-----------
ここまで実装が進むと、特に新しいネタは無し。helperに関数を色々つけていたら無法地帯になったので、モデルに移植しつつテストを書きたくてしょうがない感じになってきた。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 625
:date: 2009-02-03 03:03:02
:title: 鶏ひき肉と豆の薬膳カレー
:categories: ['food']
:body type: text/x-rst
:body:
調布東急の `KALDI`_ で売っているカレーはどれもおいしいので、紹介したいと思う。今日は、MCCの鶏ひき肉と豆の薬膳カレー。本場カレーの香辛料の感じは良く出てると思う。豆も日本のカレーっぽくない感じだ。一般的な中辛よりもちょっと甘め？辛さの基準が人と違うので、わかりやすく神田のエチオピア基準で言うと、1辛くらい。

* 楽天で売ってた `MCC 鶏ひき肉と豆の薬膳カレー`_

写真を撮ってみたけど、あんまり美味しそうには見えない...。料理写真とかってすごい美味しそうに見えるんだけどね。

.. _`KALDI`: http://www.kaldi.co.jp/
.. _`MCC 鶏ひき肉と豆の薬膳カレー`: http://www.rakuten.co.jp/seikatsu/1235158/1235163/1571192/


:extend type: text/html
:extend:


:comments:
:comment id: 2009-02-03.9704498538
:title: Re:鶏ひき肉と豆の薬膳カレー
:author: jack
:date: 2009-02-03 23:39:31
:email: 
:url: 
:body:
> 神田のエチオピア基準
それがまずわからない(笑)。

最近外でカレーたべてないし。かといって別にすげーのつくってるわけでもないしなー。
ぷーさんも最近行ってないけど、あそこでいうとどれくらい？まぁ、あそこの「極甘」でも一般の「辛口」より辛いと思いますが。

・・・ここ数ヶ月、外で食べるカレーって、時間なくて新宿のC&Cで食べるくらいかな・・・(;_;)
# ややしょっぱいが、まぁ、値段も安いし(たいがいイブニング時間帯になるし)

:comments:
:comment id: 2009-02-04.1693063744
:title: Re:鶏ひき肉と豆の薬膳カレー
:author: しみずかわ
:date: 2009-02-04 01:06:09
:email: 
:url: 
:body:
> > 神田のエチオピア基準
> それがまずわからない(笑)。

そんな馬鹿な！ｗ

> ぷーさんも最近行ってないけど、あそこでいうとどれくらい？

ぷーさんの辛さはエチオピア換算で６～７くらい。
アジャンタのキーマカレーがエチオピアの５くらいかな。。
やばい。アジャンタ行きたくなってきた。

C&Cは...。調布駅前に出来て記念に行った他は...。カツカレー安くて新宿でいっつも惹かれるんですけどねｗ
%%%%%%%%%

:id: 626
:date: 2009-02-04 00:14:10
:title: THAI FRIED BASIL CHIKIN
:categories: ['food']
:body type: text/x-rst
:body:
パケの写真にはフライドエッグとご飯が写ってますが、米を炊くのが面倒だったのでパンで。前に米で食べたときは結構辛かった（エチオピア換算で２～３くらい）覚えがあるんだけど、パンで食べるとそれほどでも無いような..。バジルチキンは米で食べた方がウマ辛いと思う。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 627
:date: 2009-02-04 01:06:19
:title: RailsとCSVとストリーミングと。
:categories: ['Programming', 'ruby-on-rails']
:body type: text/x-rst
:body:
とある処理のためにRailsアプリにCSVを食わせたり、CSVを出力したりという事をしました。で、このCSVというやつがけっこうデカイので、余計なDISKとかメモリとかを食わなくて良いように、ストリーミング入力、ストリーミング出力できるように実装してみました。

ストリーミング出力
-----------------

ストリーミング出力するための仕組みはRailsに備わっていて（少なくとも2.1には）、 ``render :text`` で実現できるようになっています。

log_controller:

.. code-block:: Ruby

    render :text => proc { |response, out|
      column_names = ['date','hour','url','status','agent']
      CSV.generate_row(column_names, column_names.size, out)

      AccessLog.query(date) do |row|
        data = column_names.collect{|name| row[name.to_sym]}
        CSV.generate_row(data, data.size, out)
      end
    }

要は、renderの:textにはprocを渡せるようになってるので、procを渡せば実際にデータを送る段階でprocを実行してくれるので、その中でoutストリームに書き込んでいけばストリーミングが出来るようになっているわけです。（素のmongrelではこれは動きませんが、動くようにも出来ます。それはまた別の機会に...）


ストリーミング入力？
-------------------

次に、調子に乗ってCSVファイルのアップロードをストリーミングで処理しようと思い、次のようなコードを書いてみました。

log_controller:

.. code-block:: Ruby

    upload_io = params[:file_data]
    CSV.parse(upload_io) do |row|
      r = AccessLog.new
      r.date = row[0]
      r.hour = row[1]
      ...
      r.save
    end

これがうまく動きません。CSV.parseのリファレンスには、第一引数に ``str_or_readable`` を受け取ると書いてあって、上記のupload_ioはStringIOなので受け取ってくれそうなのに、StringIOをStringに変換しようとして失敗したとか言って落ちやがります（Rubyは1.8.6です）。

調べてみると、CSV#parseの実装が以下のようになっていて、互換性のために第一引数が実ファイルへのパスが渡ってくることを想定している処理が入っていました（最初の5行）。

ruby/1.8/csv.rb:

.. code-block:: Ruby

  def CSV.parse(str_or_readable, fs = nil, rs = nil, &block)
    if File.exist?(str_or_readable)
      STDERR.puts("CSV.parse(filename) is deprecated." +
        "  Use CSV.open(filename, 'r') instead.")
      return open_reader(str_or_readable, 'r', fs, rs, &block)
    end
    if block
      CSV::Reader.parse(str_or_readable, fs, rs) do |row|
        yield(row)
      end
      nil
    else
      CSV::Reader.create(str_or_readable, fs, rs).collect { |row| row }
    end
  end

今回はそんな想定は要らないので、CSV.parseを使う代わりに、CSV::Reader.parseを呼び出すようにしたらうまく動作するようになりました。

log_controller:

.. code-block:: Ruby

    upload_io = params[:file_data]
    CSV::Reader.parse(upload_io) do |row|
      r = AccessLog.new
      r.date = row[0]
      r.hour = row[1]
      ...
      r.save
    end


動くようにはなりましたが、upload_ioはStringIOのインスタンスだったので、それってストリーミング受信してる訳では無いような気がします。全部readしてしまうよりはメモリ効率は良さそうだけど...。非mongrelならsocketが渡されて来たり.....はしないですね。複数ファイルuploadを考慮できなくなっちゃうし。残念。



:extend type: text/html
:extend:
%%%%%%%%%

:id: 628
:date: 2009-02-05 23:59:39
:title: STARTREK VOYAGER 4週目終了
:categories: ['misc']
:body type: text/x-rst
:body:
4週目を見終わりました。全177話くらいを1年くらいかけて見たかな。45分 x 177話 = 132時間。 

ちょっと数えてみたら、STARTREKのDVDが枚数だけで200枚以上ある。blu-rayで出たら泣くね。

:extend type: text/html
:extend:
%%%%%%%%%

:id: 629
:date: 2009-02-07 17:49:48
:title: 松島かき祭りに行く準備：持って行くもの
:categories: ['misc', 'food', 'trip']
:body type: text/x-rst
:body:
松島かき祭りに持って行くもの

* 耳当て
* 手袋
* 貼るホッカイロ
* 替えの靴下
* `折りたたみ携帯イス`_
* 熱燗用日本酒
* ニンニク醤油
* シャウエッセン
* たい焼き
* デジカメ
* 耳栓
* アイマスク
* コップ
* `USB給電HUB`_
* 巻き取り式LANケーブル

今夜の夜行バスで、i?と二人で行ってきます。仙台着が6時頃。早すぎ。HUBとLANケーブルは時間つぶしのためにバトルラインする用。PCのLANポートクロスで繋いで動かなかったときのために念のため。


.. _`折りたたみ携帯イス`: http://www.freia.jp/taka/blog/624
.. _`USB給電HUB`: http://www.iodata.jp/prod/network/lanadapter/2004/etx-sh5s/



:extend type: text/html
:extend:
%%%%%%%%%

:id: 630
:date: 2009-02-08 06:35:43
:title: 松島かき祭り 2009 に来た
:categories: ['misc', 'food', 'trip']
:body type: text/x-rst
:body:
松島かき祭りで撮った写真はこちら！ -> `Dropbox photo gallery`_


2/7 23:30.
-----------
新宿西口23:30発の夜行バスで、i?と2人で仙台に出発。バス料金は5500円。

2/8 5:40.
-----------
仙台着。気温2度。微妙に雪が降っていて横風がさぶいです。とりあえず8時頃に松島海岸駅に到着すれば良いので、2時間ほど仙台駅近くのインターネットカフェ(`アイ・カフェ`_)でバトルラインしながら時間をつぶします。1戦目は勝利。

6:45.
-----------
おなかがすいてきましたが牡蠣まで我慢。後ろの席のやつがカレーうどん食ってます。悔しいので過去に松島かき
祭りに行った人たちのblogの写真を眺めることに。

* `松島かき祭り│松島のみどころ：四季の彩り | 電脳松島絵巻 - 松島観光協会`_ (公式ページ)
* `そろそろ松島かき祭りについてひとこと言っておくか`_ 2009年?
* `松島牡蠣祭り`_ 2001年
* `仙台人 が仙台観光をしてる ブログ: 松島「かき祭り」へ行ってきました`_ 2007年
* `松島かき祭り`_ 2004年
* `松島かき祭り（宮城県宮城郡松島町）の情報 - MAPPLE 観光ガイド`_ 2008年?

7:34.
-----------
仙台駅を出発、松島海岸駅到着は8:14。40分って結構遠いな。現地まではそこから歩いて15分くらいらしい。

8:15.
------
松島海岸駅到着。そこでタイミング良く大場さん夫妻と合流。今回、松島かき祭りに行くという話をi?から聞いて `そろそろ松島かき祭りについてひとこと言っておくか`_ を書いてくれたおかげで色々と準備が出来ました。本当にありがとうございます。

駅から会場となる松島公園はすぐ目の前だったので、5分くらいで到着。8:30の時点でかなりの人が無料炉端コーナーにいた。この無料炉端コーナーは、道路の脇のU自の側溝に炭を入れて網を載せただけの簡単なものだけど、これが会場内に50以上設置されていた。これは準備大変だったろうなぁ..。

で、その炉端を１つ無事に確保して、牡蠣を買い出しに。牡蠣はスーパーの買い物袋っぽいビニール袋１つに、20個以上入っていて500円。ていうか安すぎです。なんか殻の表面に海藻とか変な虫とかが付いてるけど、どうせ焼くので気にしないことに。

天候は残念なことにちょっと吹雪っぽい感じで雪が横から吹いてきます。海岸が目の前だし、炉端にはまだ火が入っていないので、ちゃんと防寒しておかないとかなり寒い。それでも氷点下じゃなかったのでまだましな方だとか・・・。


8:40
------
2日目の開場は9時なので、9時になって炉端に火が入るまでは焼けないので周囲を散策。屋台でけっこう色々な串とか鍋とか売られていて、でも串ちょっと高すぎだろうと思った。売ってたのは、かきソバ、かき汁、アンコウ肝鍋、たこやき、いかぽぽ、ほたて串、くじら串、はや串、牛タン串、牛カルビ串、とり皮串、やきとり、フレンチドック、フランクフルト、牡蠣フライ、中華まん、牛タン、牛ステーキ、玉こん、つぶ串、ホタテ、殻付き牡蠣、たこ串、缶ビール、日本酒、甘酒、きりたんぽ、だまこ餅、クレープ、チョコバナナ、ジャガバター、芋煮会、etc. etc...  後半だんだん違う感じだけど、きりたんぽ買いましたよ、最初に。ゆず味噌たんぽだった。

8:50
-------
炉端に戻ったらすでに炭に火が入っていて、牡蠣を焼き始めていました。牡蠣は食べ頃になると「食べて～」って感じに殻が開くので、すかさず牡蠣むきナイフで貝柱を切断して空ける！そして食う！うまい！牡蠣の身から出た汁がちょうど良い塩分を持っていてそのままなにも付けずにお召し上がり下さい、的な。やるな牡蠣。せっかく持ってきた生醤油とぽんずが要らないじゃないか。

ちなみに牡蠣むきナイフは300円で売ってました。普通のお店で買うと100円だけどね。

あと半生で食べると危ない。生食用じゃないのでよく加熱して食べましょう。


10:30
------
ひたすら牡蠣を食べ続け、4袋目を購入。一人25個くらいずつ食べる計算に。さすがに牡蠣だけだと飽きるので、つぶ串・牛カルビ串・サザエ壺焼きを買ったり、持ち込んだ豆餅や椎茸・エリンギのホイル焼きを間に入れて、浦霞や甘酒を飲んで、また牡蠣を食べる。持ち込んだのは全部俺じゃないけど。ごちそうさまでした＞i?,大場夫妻

10時も過ぎると雪もやんで気温も上昇。そして会場の人数は結構な数になっていて、開いている炉端を探してうろうろしている人多数。この頃にやってきた現地のご夫婦？に炉端を半分譲りました。

11:00
--------
牡蠣4袋、合計100個前後を食べ終え、撤収。結局、朝9時から2時間食べ続け、飲み続けで、松島の海とか見てません（笑） いやしかしすごい楽しい経験でした。当初1人で来ようかと思ってたんだけど、これは多人数の方が絶対面白い！

13:00
------
仙台の締めとして、4人で牛タン屋さんで牛タン定食を....食べるのがつらかったです。おなかが苦しくて、牛タンを口に入れるのがツライ。さすがにあれだけ食べた後に牛タン定食とか無理でしたよ..。大場koさんはフツーに食べて、さらに僕の牛タンと麦飯も食べたけど。すごいな。

14:10
-------
大急ぎでお土産を買って14:10発東京行き高速バス3000円に乗って東京へ。到着は19:40。安いけど5時間半かかるのはちょっと長い...と思いきや、昨夜の夜行バスで眠れなかったり、かなり呑んでいたり、かなり満腹だったので、i?とのバトルライン対戦を始めたものの二人とも相手のターン中に寝てました（笑）

19:40
-------
新宿駅新南口着。そして帰宅。もう何も食べられない...。

バス切符手配してくれたi?, 現地で色々と教えてくれた大場夫妻、どうもありがとうございました。また行きましょう。


松島かき祭りで撮った写真はこちら！ -> `Dropbox photo gallery`_

.. _`Dropbox photo gallery`: http://www.getdropbox.com/gallery/284189/1/2009_02_kakimaturi?h=fc59b7

.. _`アイ・カフェ`: http://www.i-cafe.ne.jp/bivisendai/static/access.php
.. _`松島牡蠣祭り`: http://www.youyou.shadow.ne.jp/sonota/kakimaturi/kakimaturi.html
.. _`仙台人 が仙台観光をしてる ブログ: 松島「かき祭り」へ行ってきました`: http://senndai-tabi.seesaa.net/article/33743985.html
.. _`松島かき祭り`: http://www.oiranotanbo.com/page041.html
.. _`松島かき祭り│松島のみどころ：四季の彩り | 電脳松島絵巻 - 松島観光協会`: http://www.matsushima-kanko.com/midokoro/siki/oyster.html
.. _`松島かき祭り（宮城県宮城郡松島町）の情報 - MAPPLE 観光ガイド`: http://www.mapple.net/spots/G00400115907.htm
.. _`そろそろ松島かき祭りについてひとこと言っておくか`: http://ko.meadowy.net/~koichiro/diary/20090122.html



:extend type: text/html
:extend:


:comments:
:comment id: 2009-02-08.9199193179
:title: お疲れ様
:author: aihatena
:date: 2009-02-08 23:38:40
:email: 
:url: 
:body:
さすがに1人1袋は多すぎた(笑)
少し物足りないくらいにして、あとはうまいもんやの七輪みたいに
乾物とか持ち込んだものをじわじわ焼くとよさそうね。
あとは売ってた「かき○○」みたいな料理をその場で作るとか。
酒はコップ6杯,2合ビン5本で2升弱くらいでした。飲んだもんだ。。

:comments:
:comment id: 2009-02-14.7273180582
:title: Re:松島かき祭り 2009 に来た
:author: つかぽん
:date: 2009-02-14 13:45:28
:email: 
:url: http://twitter.com/plus9
:body:
うまそうだのー。
うまやらしい。

%%%%%%%%%

:id: 631
:date: 2009-03-09 06:49:09
:title: 朝5時前に起きる生活
:categories: ['misc', 'work']
:body type: text/x-rst
:body:
先々週、仕事で8時頃に会社に出ることがあって、そのときに「あ、意外と早起きできるな俺」とか思ったり、その日8時に出社したらGeorgeが既に出社してて「1番だと思ったのに負けた..」とか思ったりした。くやしかったので(笑)、翌日からさらに早い時間に出社してやるぜ！ということで、気がつくと朝6時台に会社に到着する生活にシフトしました。5時前に起きて6時前には電車に乗る感じ。6時台の電車は座れないので、早起きするなら5時台の電車が良い感じ。

難点は、夜10時頃には寝ないといけない事か。というか夜7時頃にはもう眠いし。あと飲み会とかツライかもな。

ところで、朝7時から夜8時くらいまで働くと12時間労働だよなぁ。もしかして俺忙しいんじゃないかな？



:extend type: text/html
:extend:
%%%%%%%%%

:id: 632
:date: 2009-03-10 06:30:00
:title: ホームベーカリー買った
:categories: ['food']
:body type: text/x-rst
:body:
日曜にホームベーカリー買ってきた。ヨドバシで12,000円くらいのSANYOのやつ。

* `SANYO ホームベーカリー (ホワイト) SPM-KP1(W)`_

本当はナンを作るための生地捏ねマシーンが欲しかったんだけど、捏ねるだけの機械は売って無さそうだったんでしょうがなくパンも焼けるヤツを買ってきた。で、機能があるならついでにパンでも焼いてみるか、と思って焼いてみた。

....

...美味い。

焼きたてパンやばいくらい美味い。
材料の99%は小麦粉なのになんでこんなに美味いんだろ？

最初は小麦粉とか目分量で入れたら必要量の半分くらいしか入って無くて、パンというより蒸しパンの出来損ないのようなよく分からない食べ物が出来たけど、計量スケール買ってきてちゃんとした分量で作ったらおいしいパンが出来た。これは簡単すぎてやばい。じょうずに焼けるまでもっと困難な試行錯誤が必要かと思ってたんだけど、簡単すぎる。

あと、焼きたてパンはナイフで切れないくらい柔らかくて、切るのがめんどくさいから高周波ナイフでも買おうかな‥‥。でも1万とか高いよな‥‥。

* `家電製品ミニレビュー デロンギ「電動フードナイフ KN500P」`_

.. _`SANYO ホームベーカリー (ホワイト) SPM-KP1(W)`: http://www.amazon.co.jp/dp/B000N4SLTA/freiaweb-22/

.. _`家電製品ミニレビュー デロンギ「電動フードナイフ KN500P」`: http://kaden.watch.impress.co.jp/cda/column/2007/06/14/916.html


:extend type: text/html
:extend:


:comments:
:comment id: 2009-03-10.3417783350
:title: Re:ホームベーカリー買った
:author: koichiro
:date: 2009-03-10 07:55:43
:email: koichiro@meadowy.org
:url: 
:body:
高周波いらないよ！
ウチは富澤で買ったウェンガーのベーカリーナイフ使ってます。波がギザギザで切れるよ。
http://shop.tomizawa.co.jp/category/data_detail.php?fCategory=35&sCategory=04&pg=&ID=5123

おすすめレシピも貼っときますね。
http://ko.meadowy.net/~nay/?%A5%DB%A1%BC%A5%E0%A5%D9%A1%BC%A5%AB%A5%EA%A1%BC%A4%C7%B9%D4%A4%B3%A4%A6%A1%AA


:comments:
:comment id: 2009-03-12.3339945454
:title: 春豊＆春よ恋
:author: しみずかわ
:date: 2009-03-12 08:15:35
:email: 
:url: 
:body:
富澤のナイフいいな。欲しいな。ぽちっ。あっ。

富澤商店、商品到着後の後払いで良いんだ。すごいな。

%%%%%%%%%

:id: 633
:date: 2009-03-13 09:08:55
:title: タイマーで朝パンを焼く
:categories: ['food']
:body type: text/x-rst
:body:
ホームベーカリーのタイマー機能で朝5時に焼けるようにセットしてみました。捏ね始めるのが午前3時頃だったらしく、夜中にウィンウィン、ペッタンペッタン言ってるのが聞こえた気が。しかも焼き上がったらすぐ取り出さないといけないので寝坊出来ないな。

焼きたてうまいよ。

ついでに会社に1切れ持って行きました。が...、侘びしい弁当にしか見えん...。


:extend type: text/html
:extend:


:comments:
:comment id: 2009-03-13.7937192704
:title: Re:タイマーで朝パンを焼く
:author: jack
:date: 2009-03-13 10:46:34
:email: 
:url: 
:body:
仮にネタだとしてもヒドく侘しいwwww

:comments:
:comment id: 2009-03-13.3722235127
:title: 彼のことですからおそらく
:author: aihatena
:date: 2009-03-13 11:29:32
:email: 
:url: 
:body:
中にカレーかタンドリーチキンが挟まってるはず。

:comments:
:comment id: 2009-03-13.3889548523
:title: Re: 中にカレーかタンドリーチキンが
:author: しみずかわ
:date: 2009-03-13 23:09:49
:email: 
:url: 
:body:
> 中にカレーかタンドリーチキンが

気がつくといつのまにか入ってないか、と思ったけどやっぱり入ってなかった。
%%%%%%%%%

:id: 634
:date: 2009-04-07 07:04:57
:title: ケータイを機種変: INFOBAR2 -> INFOBAR2
:categories: ['misc']
:body type: text/x-rst
:body:
ケータイ、機種変しました！

* INFOBAR2 グレー → INFOBAR2 シルバー

機種変というより買い増し。ヤフオクで3000円でGETして、auショップに持って行って2100円払って使えるようにしてもらいました。ICチップを入れ替えればすきな方を使えます！

アドレスの同期はMySyncを使えば良いんだけど(いや、めんどくさいけど)、Felicaのお金は毎回引っ越すのめんどくさい。いくつ使ってるんだ？

Suica
Edy
nanaco
コカコーラ

‥‥両方にチャージしておけばいいんじゃね？‥‥だめだった。

Suicaの登録に使ってるケータイメールアドレスは1台にしか使えないっぽい。新しいアドレスを登録しろと言うことか‥‥。Edyとnanacoは問題無さそうね。チャージがダブるけど。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 635
:date: 2009-05-21 22:06:30
:title: アスキーメディアワークスさんにお邪魔してきました
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
昨日5/20に、Plone研究会の集まりでアスキーメディアワークスさんにお邪魔してきました。新築のビルに引っ越したらしく、とっても綺麗なオフィスで入り口にダンボー君までいたんですが、初台からも西新宿からも新宿からも同じくらい遠い場所でした‥‥。

研究会の後は西新宿で終電まで飲んでて、帰ってからPlone3.3rc2をbuildoutでWindows7で動かそうと色々やっていたら朝4時になってました。ここ数ヶ月は朝5時に起きて朝7時には会社に着いてたんですが、今日は始業時間10時ちょっと前に出社しました。ねむー。

ところで、飲み会とかでPloneやZope本体のソースコードを読んで勉強したいねーとかの話になって、近いうちに集まって勉強するかーということになりました。いつやるかとかまだ未定ですが、まあ近いうちに。


:extend type: text/html
:extend:


:trackbacks:
:trackback id: 2009-05-22.3600781470
:title: plone研究会(2009-05)
:blog name: takalog
:url: http://takanory.net/takalog/1083
:date: 2009-05-22 23:42:40
:body:
 5月20日(水)に plone研究会 にいってきました。  場所ははじめて?の アスキー・メディアワークス 会議室です。  私の会社から近いので、歩いていけていい感じです。新宿駅からは遠いけど。。。  途中で 新宿の納豆 を...

%%%%%%%%%

:id: 636
:date: 2009-05-26 07:21:16
:title: 「(第0回)Zope/Plone開発勉強会」開催します
:categories: ['Event', 'Zope', 'Plone']
:body type: text/x-rst
:body:
(第0回)Zope/Plone開発勉強会開催、って事でZope/Plone それぞれのMLで告知を出しました。有志で集まってZope/Ploneの開発についてディスカッションや情報交換しよう、っていう趣旨の集まりです。（SprintとかHack-a-thonとか名乗れば良かったかな？）

* 告知ページ: `(第0回)Zope/Plone開発勉強会 - JZUG`_
* 申し込み: `(第0回)Zope/Plone開発勉強会 : ATND`_ 

.. _`(第0回)Zope/Plone開発勉強会 - JZUG`: http://zope.jp/events/zope-plone-sprint-tokyo-0
.. _`(第0回)Zope/Plone開発勉強会 : ATND`: http://atnd.org/events/709

最近Zopeはいろいろな事情で新規案件に採用する事が少なくなってしまったけど、Zope2.12(まだbeta)はPython2.5/2.6対応でeasy_install化されていたり、Plone3.3(まだrc)も高速化されてどんどんzope3アーキテクチャに移行していたりと動きが激しいのでそういった情報も共有したいと思います。個人的にはDjangoとかRailsのような使い勝手だと今の仕事に使いやすいかも。

ところで、初めてatnd.orgを使ったけど、便利ねこれ。他の参加者がどんなイベントに興味を持ってるかとかもみれるところがまたおもしろい。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 637
:date: 2009-05-27 06:59:11
:title: Re: pythonで毎回使いたいloggingモジュールのテンプレート
:categories: ['python']
:body type: text/x-rst
:body:
`pythonで毎回使いたいloggingモジュールのテンプレート - a2c.get.diary`_ への時間差反応です。2ヶ月差？
自分が普段使っているloggingのテンプレを貼っておきます。複数のloggerオブジェクトを作れるとか色々やった痕跡があったりして、元記事よりもコードがでかいなぁ...。

.. code-block:: Python

  import sys, logging
  logger = logging.getLogger('foologger')
  
  def setup_logger(opts):
      # setup output
      if opts.log:
          hdlr = logging.FileHandler(opts.log, 'a')
      else:
          hdlr = logging.StreamHandler(sys.stdout)
      formatter = logging.Formatter('%(asctime)s %(name)-12s %(levelname)-8s %(message)s')
      hdlr.setFormatter(formatter)
      logger.addHandler(hdlr)
      if opts.debug:
          logger.setLevel(logging.DEBUG)
      else:
          logger.setLevel(logging.INFO)
  
      # setup error output
      hdlr = logging.StreamHandler()
      hdlr.setLevel(logging.ERROR)
      hdlr.setFormatter(formatter)
      logger.addHandler(hdlr)
  
  
  def setup_optparser():
      from optparse import OptionParser, OptionGroup
      usage = 'usage: %prog [options] command'
      parser = OptionParser(usage=usage)
      parser.add_option('-l', '--log',
                        dest='log',
                        default='',
                        help="Filename for log output",
                        )
      parser.add_option('-d', '--debug',
                        dest='debug',
                        action='store_true',
                        default=False,
                        help="Enable debug output",
                        )
      group = OptionGroup(parser, "command",
                          "something else..."
                          )
      parser.add_option_group(group)
      return parser
  
  
  if __name__ == '__main__':
      parser = setup_optparser()
      options, args = parser.parse_args(sys.argv)
      setup_logger(options)
  
      if len(args)<2:
          parser.print_help()
          sys.exit(1)
  
      # do something...


.. _`pythonで毎回使いたいloggingモジュールのテンプレート - a2c.get.diary`: http://d.hatena.ne.jp/a2c/20090305/1236241477


:extend type: text/html
:extend:
%%%%%%%%%

:id: 638
:date: 2009-05-27 10:00:08
:title: Zope-2.12.0b2 がWindowsでは壊れたrunzope.batを生成する問題
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope-2.12.0b2 のバグレポを出してみました。

 * `Bug #380780 in Zope 2: “Zope2.12.0b2 generate broken runzope.bat on Windows.”`_

問題の詳細はさておき、原因はWindowsのcmd.exeが以下の書式でエラーになってしまうところにあります。

.. topic:: 失敗する
  :class: dos

  | C:\> cmd.exe /C "python" -c "print 'foo'"

``os.popen`` とか ``os.system`` とかで os.system('''"python" -c "print 'foo'"''') としたときに上記の失敗パターンになってしまうようで、cmd.exeで直接以下のように実行しても再現しません。

.. topic:: 成功する
  :class: dos

  | C:\> "python" -c "print 'foo'"
  | foo

この問題、1ヶ月くらい前から気づいていたんですが再現方法が分からなくて、今日ようやくレポートできました（変な英語書いてないか、いっつも心配ですが...）。

で、肝心の解決方法が思いつかない訳ですが‥‥。cmd.exeに渡す文字列に""が複数セット出てくるのが問題なんだろうとは想像してますが、どうすればいいんだろ？出来ればunix上のpopenと互換性のある修正方法があるといいなぁ。

.. _`Bug #380780 in Zope 2: “Zope2.12.0b2 generate broken runzope.bat on Windows.”`: https://bugs.launchpad.net/zope2/+bug/380780

追記
----

``cmd.exe /?`` に書いてあった。

::
    1.  次のすべての条件に一致する場合、コマンド ラインの引用符が有効になり
        ます:

        - /S スイッチがない
        - 引用符が 1 組ある
        - 引用符の中に特殊文字がない
          (特殊文字は &<>()@^| です)
        - 引用符の中に 1 つ以上のスペースがある
        - 引用符の中の文字列が、実行可能ファイルの名前である

    2.  最初の文字が引用符であるにも関わらず上の条件に一致しない場合は、最初
        の引用符とコマンド ラインの最後の引用符が削除され、最後の引用符の後
        のテキストが有効になります。


やってみた。

.. topic:: 成功しちゃった
  :class: dos

  | C:\> cmd.exe /C ""python" -c "print 'foo'""
  | foo

えぇー？


:extend type: text/html
:extend:
%%%%%%%%%

:id: 639
:date: 2009-05-30 23:54:21
:title: 映画 STARTREK みてきました
:categories: ['misc', 'startrek']
:body type: text/x-rst
:body:
今回の `スタートレック映画`_ はオリジナルシリーズのカーク船長やスポックの出てくるストーリー、って事くらいしか知らずに行ったのと、今回はシナリオ構成やセット、配役など全体的にテレビシリーズの延長ではないという事がとても新鮮で、とっても楽しめました。2作前の「反乱」の時はかなりテレビシリーズをスクリーンに持って行っただけ感があったので、今回は良いですね。ただちょっとアクション多すぎたかも。

どうやらこの映画シナリオの続きで2作目もやるようで。。それもまた楽しみ。

さて、そろそろ先日届いた初期STARTREK映画のBD版( `スター・トレック-オリジナル・クルー劇場版BOX-7枚組-Blu-ray`_ 観るかな。


.. _`スタートレック映画`: http://www.startrekmovie.com/intl/jp/
.. _`スター・トレック-オリジナル・クルー劇場版BOX-7枚組-Blu-ray`: http://www.amazon.co.jp/dp/B001VCBZOQ/freiaweb-22


:extend type: text/html
:extend:
%%%%%%%%%

:id: 640
:date: 2009-06-02 07:58:20
:title: 献本頂きました: 10日でおぼえるPython入門教室
:categories: ['python']
:body type: text/x-rst
:body:
生まれて初めて献本頂きましたが、今週末の `(第0回)Zope/Plone開発勉強会`_ に向けてプチ立て込んでいるのでレビューはその後で‥‥。というか2週間短納期なプロジェクト(またRails)が発生してワタワタしてる所だったりします。

* `10日でおぼえるPython入門教室`_

.. image:: http://ec2.images-amazon.com/images/I/51iy-nMV8aL._SS500_.jpg
  :width: 500
  :height: 500
  :scale: 30
  :alt: 10日でおぼえるPython入門教室
  :target: http://www.amazon.co.jp/dp/4798118753/freiaweb-22


.. _`(第0回)Zope/Plone開発勉強会`: http://atnd.org/events/709
.. _`10日でおぼえるPython入門教室`: http://www.amazon.co.jp/dp/4798118753/freiaweb-22


:extend type: text/html
:extend:
%%%%%%%%%

:id: 641
:date: 2009-06-03 23:12:59
:title: RapidSSLで購入したSSL証明書がケータイから閲覧可能なルート認証局になってる件
:categories: ['web', 'security']
:body type: text/x-rst
:body:
なんかもう言いたいことは全てタイトルで伝えた感じですが。

某サイトのSSLの期限が近づいたので更新したところ、以下のように変化がありました

* 発行者: "Equifax Secure Global eBusiness CA-1" -> "Equifax Secure Certificate Authority"
* 署名アルゴリズム: md5RSA -> sha1RSA
* 署名ハッシュアルゴリズム: md5 -> sha1

で、発行者が変わってたのでもしやと思ってケータイでアクセスしてみたら、警告もなく（auなので警告が出ると先に進めず見れない）表示されました！やった。これでVeriSi...とかの高い証明書でなくてもケータイ用に使える！使う予定無いけど！



:extend type: text/html
:extend:


:comments:
:comment id: 2009-06-04.9880916202
:title: Re:RapidSSLで購入したSSL証明書がケータイから閲覧可能なルート認証局になってる件
:author: koma2
:date: 2009-06-04 01:19:48
:email: 
:url: 
:body:
いつの間にかモバイル対応とかしてるし… >某ソフト

%%%%%%%%%

:id: 642
:date: 2009-06-06 23:57:25
:title: (第0回)Zope/Plone開発勉強会は大盛況でした
:categories: ['Event', 'Zope', 'python', 'Programming', 'Plone']
:body type: text/x-rst
:body:
（追記: 関連blogエントリ）

当日中POSTの原則に則り、とりあえず写真を貼っておきます。

http://www.getdropbox.com/gallery/284189/1/2009_06_zopeplonedev?h=95d3a4

↓自己紹介が終わったあたり

.. image:: http://photos-1.getdropbox.com/i/l/p0qN3yFqHycYh47UrmFiW6bmWimaGy3uY6GCd4OVOwE#1
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_zopeplonedev?h=95d3a4
  :scale: 50
  :width: 640
  :height: 480
  :alt: 自己紹介が終わったあたり

↓お昼に食べたハンバーガー `曙橋 faith`_

.. image:: http://photos-2.getdropbox.com/i/l/ZFXyMyYGOCw87h3axTfqaBVo9tZvmdP0LtzPegYC4XE#2
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_zopeplonedev?h=95d3a4
  :scale: 50
  :width: 640
  :height: 480
  :alt: お昼に食べたハンバーガー "曙橋 faith"

↓カリフォルニアバーガー1200円。ビックマックよりでかい。

.. image:: http://photos-3.getdropbox.com/i/l/900jKR368tgQ7nBmyrkRF2tXjK8izMalGthC_V_1z3E#3
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_zopeplonedev?h=95d3a4
  :scale: 50
  :width: 640
  :height: 480
  :alt: カリフォルニアバーガー1200円。ビックマックよりでかい。

↓夕方くらい。20人くらいまでいけるかと思った会議室が手狭に...

.. image:: http://photos-4.getdropbox.com/i/l/pjbBlXSxctqL0vd2V4SNM5fFNU7TZTu3rWfe5fRiF5A#4
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_zopeplonedev?h=95d3a4
  :scale: 50
  :width: 640
  :height: 480
  :alt: 夕方くらい。20人くらいまでいけるかと思った会議室が手狭に...

↓みんながやろうと思ったこと

.. image:: http://photos-1.getdropbox.com/i/l/tw4IHniQOFAtikMynEGEELkZKpDUTiw5X99GDeVicSc#5
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_zopeplonedev?h=95d3a4
  :scale: 50
  :width: 640
  :height: 480
  :alt: みんながやろうと思ったこと



.. _`曙橋 faith`: http://www.hamburger-faith.com/


プログラム
------------
* 11:00-11:30 自己紹介とか
* 11:30-12:00 やること決めたり準備とか
* 12:00-13:00 昼食
* 13:00-17:00 もくもくと開発
* 17:00-18:00 成果発表(できたとこまで)
* 18:00- 打ち上げ(いける人で)

とりあえず皆さんの発表の詳細は皆さんが書かれるんじゃないかと。自分は `Zopeのリリースノート翻訳`_ をやりつついろんな所に口を出してました。翻訳とか先にやっておけば良かった‥‥。

.. _`Zopeのリリースノート翻訳`: http://zope.jp/download/zope/releases/2.10.8


よかったこと
--------------
* 自ら解決・開拓する系の人たちが集まったので、進行緩かったわりにかなり成果発表は濃かったと思います。
* 突発的に巻き込んだ同僚が初Pythonで電車時刻表スクレイピングしてウケてた。すばらしい。
* これは個人的な事ですが、okujiさんと色々話せたのが良かった。
* これも個人的なことですが、開発モチベーションがかなり上がった。なんか、居ても立っても居られねぇ！

POKEN
--------
* 今日のイベントで一人くらい持ってくる人がいるんじゃないかなぁと思って水曜に `AmazonでPOKEN`_ を買った。14人中7人が持って来たというすごいヒット率！ありえない！
* ytakeuchiさんは転売用（かどうかは知らない）に4つくらい持ってきてて、それを買った人もいるし！
* というわけで、絶対はやらないだろうと思ったデバイスが良いネタになった。Zope全然関係ないけどっ！

わるかったこと
---------------
* 弊社のゲスト用無線LANが実は使えないことに当日気づいた。
* 有線LANケーブルが這い回っていてウザス
* ゲスト用有線LAN-IP配布数が参加人数より少なかった！それは無いわ～


というわけで、次回はFONとか無線APとか用意するか、社内環境を改善したいと思います。

.. _`AmazonでPOKEN`: http://www.amazon.co.jp/dp/B001UWX87O/freiaweb-22

追記
---------
参加された方、参加出来なかった方のエントリリンクです。

* `(第0回)Zope/Plone開発勉強会が無事終了 - takanory.net`_
* `Zope/Plone開発勉強会に行ってきた - enbug diary(2009-06-07)`_
* `【終了】Zope/Plone開発勉強会 #0 - CMSコミュニケーションズ[Zope/Plone]`_
* `[Zope](第0回)Zope/Plone開発勉強会 田原悠西の日記(2009-05-30)`_
* `(第0回)Zope/Plone開発勉強会 - 人は歴史を創り出し、人は歴史を語り継ぐ`_
* `Zope/Plone勉強会、他のとかぶったorz - jbking`_

.. _`【終了】Zope/Plone開発勉強会 #0 - CMSコミュニケーションズ[Zope/Plone]`: http://www.cmscom.jp/blog/218
.. _`Zope/Plone開発勉強会に行ってきた - enbug diary(2009-06-07)`: http://enbug.tdiary.net/20090607.html#p01
.. _`Zope/Plone勉強会、他のとかぶったorz - jbking`: http://twitter.com/jbking/statuses/1910709627
.. _`[Zope](第0回)Zope/Plone開発勉強会 田原悠西の日記(2009-05-30)`: http://yusei.tdiary.net/20090530.html
.. _`(第0回)Zope/Plone開発勉強会が無事終了 - takanory.net`: http://takanory.net/takalog/1099
.. _`(第0回)Zope/Plone開発勉強会 - 人は歴史を創り出し、人は歴史を語り継ぐ`: http://d.hatena.ne.jp/ytakeuch/20090606


:extend type: text/html
:extend:


:comments:
:comment id: 2009-06-08.8302502082
:title: Re:(第0回)Zope/Plone開発勉強会は大盛況でした
:author: ytakeuch
:date: 2009-06-08 07:30:31
:email: 
:url: http://logicdesign.jp/
:body:
先日はお世話になりました。Pokenの件ですが、転売用で間違いありません。連休前までは秋葉原のレンタルショーケースで委託販売をしておりました。また私のハンドルの最後の「i」は不要です。今後ともよろしくお願いいたします。

%%%%%%%%%

:id: 643
:date: 2009-06-13 23:56:47
:title: 都道４３１号の幡ヶ谷付近に自転車専用レーンがあった
:categories: ['bicycle']
:body type: text/x-rst
:body:
今日は土曜日出勤でございます。

ひさびさに自転車で会社まで行ったんだけど、新宿の手前、幡ヶ谷のあたりの道路に自転車専用レーンを発見！おお、いつのまにこんなものが！

調べてみたら、平成20年3月からあったらしい。去年の3月？どんだけ自転車乗ってなかったんだ？俺。

`旧玉川水道道路における自転車レーンの整備効果について`_ という東京都建設局のサイトを見ると、モデルケースとして作って、アンケートを採ったらしい。結果としてはおおむね賛成（バス業者以外）らしい。この勢いで甲州街道にも敷設して欲しいもんだ。明るいときはともかく、夜10時過ぎの暗い帰り道にはかなり安全に走れるので、東京都建設局のひと、見てたらぜひ。

とりあえず、車の路駐やめれ。

.. _`旧玉川水道道路における自転車レーンの整備効果について`: http://www.kensetsu.metro.tokyo.jp/jitensya/jitensya-top.htm


:extend type: text/html
:extend:


:comments:
:comment id: 2009-06-14.5229520262
:title: Re:都道４３１号の幡ヶ谷付近に自転車専用レーンがあった
:author: weboo
:date: 2009-06-14 02:02:03
:email: 
:url: 
:body:
４月から自転車通勤していて、ここを毎日通っています。
こういう道路がもっと増えて欲しいですよね。

そして、ここに路駐されているとかなり腹が立ちます！

:comments:
:comment id: 2009-06-24.9545131912
:title: Re:都道４３１号の幡ヶ谷付近に自転車専用レーンがあった
:author: しみずかわ
:date: 2009-06-24 13:15:54
:email: 
:url: 
:body:
> そして、ここに路駐されているとかなり腹が立ちます！

ホントに！路駐調査員を呼びつけたい！
%%%%%%%%%

:id: 644
:date: 2009-06-19 23:55:00
:title: 今日のPAUKE
:categories: ['food']
:body type: text/x-rst
:body:
PAUKEは肉が旨い。ほんとにうまい。

ドイツビールも旨い。今日のドイツビールはポーラナー（生デュンケル）。この白ビールはうますぎる。

アイスヴァインと辛口ソーセージは外せない。

満足満足。


:extend type: text/html
:extend:


:comments:
:comment id: 2009-06-20.8026271720
:title: Re:今日のPAUKE
:author: jack
:date: 2009-06-20 12:00:03
:email: 
:url: 
:body:
アイスヴァインはうまいけど、1～2人だともてあますのが難点。


:comments:
:comment id: 2009-06-20.5898086695
:title: Re:今日のPAUKE
:author: bgnori
:date: 2009-06-20 23:19:50
:email: bgnori@gmail.com
:url: 
:body:
次回のzope/ploneの夜の部でお願いします。

:comments:
:comment id: 2009-06-24.9411566191
:title: Re:今日のPAUKE
:author: しみずかわ
:date: 2009-06-24 13:15:41
:email: 
:url: 
:body:
> アイスヴァインはうまいけど、1～2人だともてあますのが難点。

6人では一瞬で無くなりました...。一口しか...(;o;

> 次回のzope/ploneの夜の部でお願いします。

高いのよ。あと、演奏中は会話が隣の人までしか届かないので、選択出来ないっす。
%%%%%%%%%

:id: 645
:date: 2009-06-20 00:48:32
:title: 給付金来たぽい
:categories: ['misc']
:body type: text/x-rst
:body:
忘れた頃にやってくる。しかも振り込みだから実感わかないな～。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 646
:date: 2009-06-23 12:59:35
:title: ル スコーアル管弦楽団の演奏会チケットもらった
:categories: ['Event']
:body type: text/x-rst
:body:
`ル スコアール管弦楽団`_ (Le Square Orchestra) の演奏会チケットを会社の同僚からもらった。今週末6/28の13:30～ らしい。午前中は熱海にいるんだけど、2時間前の熱海発に乗ればなんとかなりそう。新幹線なら1時間ちょっとか...。どうすっかな。

オケや演奏会に最後に行ったのは、 ``秋田高校吹奏楽部OB演奏会`` (1996年頃?)で演奏して以来なので、13年ぶり....って、13年！？すごいな。

今週末の演奏会では、アルプス交響曲とスキタイ組曲をやるそうで、ウィンドマシーンとか、サンダーマシーンとか使うらしい。楽しみ。


.. _`ル スコアール管弦楽団`: http://lesquare.oops.jp/

:extend type: text/html
:extend:


:comments:
:comment id: 2009-06-24.4297602828
:title: Re:ル スコーアル管弦楽団の演奏会チケットもらった
:author: takanori
:date: 2009-06-24 12:17:11
:email: 
:url: http://takanory.net
:body:
なかなか意欲的なプログラムですね。
アルプス交響曲はこないだ日本フィルのを聴きに行きましたが、バンダ多いしマシーンも楽しいですね。

スキタイ組曲も好きな曲です。プロコフィエフのこの曲もだいぶハデハデで楽しいですよ。
オケの方たちの体力が最後まで持つのか心配ですが。。。

:comments:
:comment id: 2009-06-24.9076890572
:title: Re:ル スコーアル管弦楽団の演奏会チケットもらった
:author: しみずかわ
:date: 2009-06-24 13:15:08
:email: 
:url: 
:body:
> オケの方たちの体力が最後まで持つのか心配ですが。。。

そんななんだ！激しそうだな..

%%%%%%%%%

:id: 647
:date: 2009-06-25 23:47:13
:title: Windows7 + SSD
:categories: ['Windows']
:body type: text/x-rst
:body:
ゴールデンウィークあたりから Windows7 + SSD で常用してます。色々あったんだけどとりあえず、

* PhotoFastのV2(SSD)はプチフリが少々。たまに連続で襲ってきてつらい
* Windows7 は文句の付け所がない
* Windows7: VHDをディスクとしてマウント出来る。パフォーマンスかなり高い。
* Windows7: VHDをディスク管理で作成する機能と、VMの生DISK接続を組み合わせるとかなり速い
* Windows7: 問題ステップ記録ツール(Problem Steps Recorder)はXP,Vista版も作るべき
* Windows7: Win+P でプロジェクタ切り替えが便利だ
* Windows7: Win+方向キー でウインドウの最大化とか便利だ
* Windows7: タスクバーのアイコンの見せ方はかなり使いやすい

ということで、Windows7 + SSD はかなり素敵。

あ、本体はThinkPad X61sです。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 648
:date: 2009-06-26 18:19:08
:title: [pyspa5] 渋カーに乗って熱海へ移動
:categories: ['Event', 'food']
:body type: text/x-rst
:body:
今日は pyspa5_ の日です。前回までは電車で移動してたんだけど、今回は `渋川`_ カーに八幡山で拾ってもらって、乗ってきました。らくちん。

途中で見つけた plouf_ というレストランで食事。女性しかいないなと思ってよく考えたら今日は金曜日だった。レストランが入ってる建物が、カルチャーセンターっぽい感じで、なんとなくハズレかなー、と思ったんだけどパスタもパンもうまくて満足。

というわけで、今回も `芳泉閣`_ にやってきました。運転お疲れ様でした > 渋川さん

.. _`渋川`: http://blog.shibu.jp/
.. _plouf: http://www.ecomo-lohas.com/floorguide/plouf/
.. _pyspa5: http://sites.google.com/site/pyspa/Home/pyspa-5
.. _`芳泉閣`: http://www.hosen.co.jp/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 649
:date: 2009-06-26 19:05:58
:title: Windows7 本数限定優待価格版をAmazonで予約してみた
:categories: ['Windows']
:body type: text/x-rst
:body:
`マイクロソフト Windows7 Professional アップグレード版 （本数限定優待価格）`_ をAmazonで予約してみました。なんか10日間限定でアップグレード版が優待価格だったので、思わずポチっと。Home版は7777円、Professionalが14777円。XP Modeが欲しかったのでProfessional版を選択。Amazonでさらに1割引ってすごいなー。

って、 `渋川さん`_ に言ったら、速攻でHomeを2本予約してたｗ


ということで、このリンクから買うと良いと思うよ！ → `マイクロソフト Windows7 Professional アップグレード版 （本数限定優待価格）`_ （罠）


--

追記. 6/26 20:30 時点で既に売り切れたようです。他のオンライン店舗へどうぞ -> `マイクロソフトのキャンペーンページ`_

.. _`マイクロソフトのキャンペーンページ`: http://www.microsoft.com/japan/windows/possibilities/buynow/pre-order.aspx

.. _`渋川さん`: http://blog.shibu.jp/

.. _`マイクロソフト Windows7 Professional アップグレード版 （本数限定優待価格）`: http://www.amazon.co.jp/dp/B002BWPTXS/freiaweb-22


:extend type: text/html
:extend:
%%%%%%%%%

:id: 650
:date: 2009-06-27 19:49:21
:title: [pyspa5] Python温泉 旅館とかおやつとか食事とか
:categories: ['Event', 'pyspa']
:body type: text/x-rst
:body:
`DropBoxに写真あげた`_

.. _`DropBoxに写真あげた`: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252

↓おやつのバナナ

.. image:: http://photos-1.getdropbox.com/i/o/ZKOoB9AlQEVvub9yc7LgjhaCGxASJVWNYb5dvdpMPuc
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: おやつのバナナ

↓おやつのペプシNEX

.. image:: http://photos-1.getdropbox.com/i/o/ZQ8tgJ_HwupvsYYw_DfFeyVp8kmTFsj11Y7Ze8qKPtQ
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: おやつのペプシNEX


↓芳泉閣１日目の晩ご飯

.. image:: http://photos-1.getdropbox.com/i/o/VKFpiGmuy7Iz-ZuKHX_F1m323yPoIMFOtdngd5BekfY
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: 芳泉閣１日目の晩ご飯


↓へび皮（ほんとは鮭トバの皮

.. image:: http://photos-1.getdropbox.com/i/o/p5X9W8TR277jsdteSz_pmGUthyL-hppU2Q0npp5DLuQ
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: へび皮（ほんとは鮭トバの皮

↓芳泉閣２日目の晩ご飯（唐揚げ、鯖味噌、カニ、青椒肉絲、刺身、和中折衷ｗ

.. image:: http://photos-1.getdropbox.com/i/o/imSw4mkjwYRd9vzRwVrYmD2g-r8e9XCGAPjGwQPY0FQ
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: 芳泉閣２日目の晩ご飯（唐揚げ、鯖味噌、カニ、青椒肉絲、刺身、和中折衷ｗ


↓PFSチャリティーオークション Python温泉Tシャツ2500円

.. image:: http://photos-1.getdropbox.com/i/o/sloZ7yYAkCZ_Rs_b46-n1JfAn_0VqnRGDmgdUtvEbU0
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: PFSチャリティーオークション Python温泉Tシャツ2500円

↓ACCENSEのノベルティーもらった

.. image:: http://photos-1.getdropbox.com/i/o/pPhBDZ5xGR5Rk1CG6qU9jeDuciTb7D4FQNp8Ak6C85o
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: ACCENSEのノベルティーもらった


↓食後のカードゲーム (San Juan - サンファン)

.. image:: http://photos-1.getdropbox.com/i/o/iT2YgifxiiMaH1h5I3ui-ykpBkqbcrP5b7hwWu4HyUA
  :target: http://www.getdropbox.com/gallery/284189/1/2009_06_pyspa5?h=bf5252
  :scale: 50
  :width: 640
  :height: 480
  :alt: 食後のカードゲーム (San Juan - サンファン)



:extend type: text/html
:extend:
%%%%%%%%%

:id: 651
:date: 2009-06-28 21:32:31
:title: [pyspa5] Zope2でformlibベースのフォーム
:categories: ['Zope', 'pyspa']
:body type: text/x-rst
:body:
pyspa5の成果１。

:やりたいこと: Zope2で簡単にフォームを作る
:前提条件1: フォームの定義は自由に決められる
:前提条件2: Zope3のformlibのようにSchemaを決めるだけでUIの生成からチェックまでやってくれる
:前提条件3: 設定UIは無くても良いがtextで保存出来るようにする

以前から、お問い合わせフォーム１つ作るのに毎回毎回プログラムを書いてデバッグしてテストして‥‥というのを考えるのが面倒だと思っていたけど、一般解も無いし、どの言語の既存コードもしっくりこない、と思っていたので作ってみた。zope.formlib は良くできていて、zope.interface を使ってSchemaを定義するだけである程度の事はやってくれるし、Widgetの切り替えもzcmlでDIの定義を返れば良いので、結果的にDRYで手軽だと感じていて、Zope2のダイナミックな変更が効くとさらに良いなあと。

実際の所Zope2からformlibを使うのはそんなに難しくなくて、SchemaとなるInterfaceクラスを動的に生成することさえ出来れば、同じ感じでcontenttypeやviewのためのクラスも生成すればよい。ということで、コード。

スキーマ定義::

      from zope.schema import TextLine, Text, Choice, Set
      from Products.SimpleForm2 import FieldArgsWrapper as aw
  
      fields = [
          TextLine(**aw("name", "名前", required=True)),
          TextLine(**aw("email", "メールアドレス", required=True)),
          TextLine(**aw("addr", "住所", required=True)),
          TextLine(**aw("tel", "電話番号", required=False)),
          Text(**aw("message", "ご質問内容等", required=False)),
      ]


他に、複数選択のチェックボックスや単一選択のChoiceなどを定義する。定義したfieldsを使ってIntefaceを自動生成したり、Viewを自動生成して、問い合わせ画面表示や, バリデーションを行う。デザインはPageTemplateをいじる必要があるけど、上記のschema定義とデザイン設定だけZMIで設定すればOK、な作りに最終的にはしたいなあ。正直、Formとかコンテンツタイプなんて、いちいち開発なんてしてられないよね。

まあ、設定を動的に変えたいシーンというのは実際はほとんど無くて、最初の作成時と、あと運用中に1,2回あるかどうかなんで、そんなに力を入れるところかと言われると....やっぱり「うん」と答えるな。使うのが自分だけだとしてもあった方が便利だ。

もうちょっと整理したらSVNに入れよう。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 652
:date: 2009-06-28 21:38:09
:title: [pyspa5] Zope3を最小構成でmod_wsgi動作させる
:categories: ['Zope', 'python', 'pyspa']
:body type: text/x-rst
:body:
pyspa5の成果２。

:やりたいこと: Zope3を軽い構成でmod_wsgiで起動できるようになると小規模なシーンで使いやすい
:前提条件1: mod_wsgi で起動する(Zope3をServer起動しない)
:前提条件2: zopeパッケージは出来るだけ削減する
:前提条件3: 軽く動作する

最近はZope3もegg化が進んでいて、Zope2/Ploneユーザーとしてはとってもわかりにくくなってしまったんだけど、mod_wsgiで接続して出来るだけ軽く動作するツールを作りたいというシーンではとてもやりやすくなってきている。ということで、問い合わせフォームを動作させるだけの軽いzope3 wsgi環境を作ろうと思ったんだけど、情報があちこちに分散していてまとまっていない、ということが分かった。

曰く:
* WSGIで動作させるためにPasteScript, PasteDeployを使う
* Zope3 は mod_wsgi で呼び出せるようになっている
* mod_wsgi アプリケーションの作り方
* paster serve paste.ini でサーバー起動出来る

じゃあ、Zope3をmod_wsgiに接続して、非サーバー起動で動作させるにはどうすれば良いのか？（どこかに書いてたら誰か教えてください）

とりあえず zope.paste をeasy_installして、mod_wsgiの設定で接続先となるapplication関数を自分でzope.pasteのコードを読んで用意すれば起動できた。以下がapplication関数の実装:

.. code-block:: Python

  from paste.deploy import loadapp
  from zope.interface import implements
  from zope.app.wsgi import interfaces
  
  class PasteApplication(object):
      implements(interfaces.IWSGIApplication)
  
      def __init__(self, name):
          # `name` that gets passed here is something like:
          # <utility_name>:<host>:<port> for zope.app.twisted, and just
          # <utility_name> for zope.app.server. Extract just the utility
          # name.
          name = name.rsplit(':', 2)[0]
          # XXX There's no way currently to find out where our
          # INSTANCE_HOME is, so assume the cwd is the INSTANCE_HOME.
          path = r'C:\Project\zope2instances\wsgi\zope-paste'
          self.wsgi_app = loadapp('config:etc/paste.ini',
                                  name, relative_to=path)
  
      def __call__(self, environ, start_response):
          """See zope.app.wsgi.interfaces.IWSGIApplication"""
          return self.wsgi_app(environ, start_response)
  
  application = PasteApplication('main')

  
paste.iniとかData.fsの場所とかはとりあえず適当だけど、これでWindows7上で、apache2->mod_wsgi->zope3がちゃんと動作した。あとでabでベンチマーク取ってみよう。

（あとでまとめる：zope3をwsgiで動作させる一連の手順）

:extend type: text/html
:extend:
%%%%%%%%%

:id: 653
:date: 2009-06-28 21:59:20
:title: スキタイ組曲とアルプス交響曲聞いてきた (after pyspa5
:categories: ['Event']
:body type: text/x-rst
:body:
最終日にやっぱり雨が降ったpyspa5 を10時に熱海現地解散して、速攻で東京錦糸町に戻って14:00から `すみだトリフォニーホール`_ で行われた `ル スコアール管弦楽団`_ (Le Square Orchestra) の演奏会に行ってきました。一人だとつまらんので、熱海からの戻りの電車の中でGo君にメールして男2人で。

曲の感想:

とりあえず、「スキタイ組曲」は曲の出だしを聞いてどうしようかと思った（笑）。やかましすぎるわ。20分の曲のうち、後半は半徹夜の身としてはつらかった。。。全体的にどこをどう聞いて良いか困るこの曲、演奏する方も色々大変そうだけど、聞く方も大変じゃないかな？

で、次がアルプス交響曲50分。1曲で50分って長いな－。曲自体はスキタイ組曲より安心して聞けたし、ウィンドマシーンが一生懸命回されてたり、サンダーマシーンの出番が1小節だけだったり、パイプオルガンが鳴ったり、カウベルがなったり、総評としてはおもしろかったかな。

おまけ:

アンコールが無かったのが残念。

.. _`すみだトリフォニーホール`: http://www.triphony.com/
.. _`ル スコアール管弦楽団`: http://lesquare.oops.jp/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 654
:date: 2009-07-02 02:26:29
:title: pyspa5で定番になった徹夜のお供
:categories: ['misc', 'work', 'pyspa']
:body type: text/x-rst
:body:
今日は急ぎの仕事で朝まで提案書を作り続けることになったので、コンビニで PEPSI NEX, Red Bull, じゃがりこ を買ってきた。この組み合わせはpyspa5で定番となった徹夜のお供である。と、Wikipediaに書いてみたい。

つーか、 **Red Bull 初めて飲んだ** 。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 655
:date: 2009-07-06 12:54:14
:title: eggの作り方が分からない
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
``eggの作り方`` で検索したら、イースターエッグとスクランブルエッグの作り方が分かりました。本当に(略

目的はbuildoutに対応したパッケージを作ることなんだけど、覚える順番があって、先が長い。

* distutilsを知る
* setuptoolsを知る
* buildoutを知る
* recipeを知る
* Pasteを知る

しかも、それぞれの段階の中に、「使える」「作れる」「開発を回せる」の3カテゴリがある気がする。つまり、easy_installコマンドは使えても、easy_install対応したパッケージを作ったり、そのパッケージをソースリポジトリからチェックアウトした状態を維持して開発を回したりテストしたり、ということをするにはどういう手順でやればいいのかが分からない。これら全体を網羅したドキュメントって英語でも見つからないんだよね...。

とりあえず、distutilsの段階については、py2exeとかいじってた時期に理解しているので、setuptools関連のドキュメントを読みまくることにする。


* `EasyInstall - The PEAK Developers' Center`_
* `setuptools - The PEAK Developers' Center`_
* `[Python] setuptools - SumiTomohikoの日記 (2007-06-09)`_
* `[Python] setuptools - SumiTomohikoの日記 (2007-06-22)`_
* `[Python] setuptools - SumiTomohikoの日記 (2007-06-23)`_
* `[Python] setuptools - SumiTomohikoの日記 (2007-06-24)`_

SumiTomohikoさん、和訳ありがとう！

.. _`EasyInstall - The PEAK Developers' Center`: http://peak.telecommunity.com/DevCenter/EasyInstall
.. _`setuptools - The PEAK Developers' Center`: http://peak.telecommunity.com/DevCenter/setuptools
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-09)`: http://d.hatena.ne.jp/SumiTomohiko/20070609/1181406701
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-22)`: http://d.hatena.ne.jp/SumiTomohiko/20070622/1182537643
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-23)`: http://d.hatena.ne.jp/SumiTomohiko/20070623/1182602060
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-24)`: http://d.hatena.ne.jp/SumiTomohiko/20070624/1182665330


:extend type: text/html
:extend:
%%%%%%%%%

:id: 656
:date: 2009-07-14 00:59:00
:title: (第1回)Zope/Plone開発勉強会 まとめ
:categories: ['Event', 'Zope', 'Plone']
:body type: text/x-rst
:body:
先日 2009/7/11 にZope/Plone開発勉強会を行いました。申し込み20名、参加17名ということで、開発の集まりとしては成功だったのかなと思います。けっこうみんな黙々と開発していたのでもうちょっと情報の流通があっても良いのかなと思いつつも、正味5時間なので、まあいまのところはこのくらいかな、と。でも懇親会も5時間くらいやってるので、次回第２回は、終了時刻を1時間後ろにずらすことにしました。

この開発イベントは空気的には、ミニpyspa って感じ。きっとそのうち芳泉閣に行って泊まり込むに違いない。


`Expert Python Programming`_
------------------------------

今回、自分は延々とbuildout周りの理解に費やしていたんですが、端的に理解できるドキュメントが無くて、あっちこっちのドキュメントを読みつつ理解しようとしていました。そんなときに寺田さんに `Expert Python Programming`_ を紹介してもらって読んでみたら、そのまんま欲しい情報がまとまってて、非常に助かりました。Pythonで開発するということについて深く学びたい人にはぴったりの本です。PDF版が10ドルくらいだったけど、お布施もかねて、本+PDFで購入しました。45ドル。

「Chapter 4, Choosing Good Names」これは1章使って説明することですよね。良い本です。 `Expert Python Programming`_


mr.developer
-------------

buildoutコマンドを使うだけでなく、buildoutで開発サイクルも回すためにはSVN等のソースコード管理とどうやって連携していくかが重要な課題になるんですが、正直、buildoutだけではうまくいかないので、z3c.recipe.egg を使うとsvnリポジトリからチェックアウトして、このファイルを実行環境用のモジュールにとして使ってくれるようになります。でもSVNのリポジトリパスではなくfind-linksを指定してindexページを経由する必要があったり、buildoutのコマンド次第ではいきなりチェックアウトしたコードが消されたりと色々問題がありました。で、これも寺田さんから教えてもらった mr.developer を使うと、複数のパッケージを１つの開発サイクルの中で修正していくシーンではとても合理的に設定・運用できるようになって、とても満足です。仕事でいま扱っている開発対象パッケージが150超とかなので、mr.developerが無いととても大変です。（あとz3c.recipe.eggsはWindowsでは動作がバグってるし...）

とりあえず、開発対象モジュールが１つでもmr.develperは使うべきだと思った。


Zope2+formlib
---------------
これはpyspa5の成果ですが、Zope2でformlibベースのフォーム生成をするデモをしました。フォームのスキーマが動的に変更出来るようになってるあたりがZopeならではです。発表内容は、まんま `[pyspa5] Zope2でformlibベースのフォーム`_ でした。次はこれにDeliveranceをつなげてデザインを付けたい。


成果発表
--------

この勉強会で自己主張できるシーンは成果発表だけなんじゃないかと思いました。最初の自己紹介で主張するのはなかなか難易度が高い。さすがに20人も居ると、1時間じゃ発表おわらないですね。

自分は、 `Expert Python Programming`_ の紹介と、Zope2+formlibのネタを準備なしで勢いだけでしゃべりました。ところでしつこいですが `Expert Python Programming`_ は読むべき。


.. _`[pyspa5] Zope2でformlibベースのフォーム`: http://www.freia.jp/taka/blog/651


次回
-----

次回は8/8(土)の開催予定です。 http://atnd.org/events/1062 で申し込むべし！

次回は、Deliverance+WSGI+zope.formlib で作るフォーム生成ツールを作れるようになって、完成したらeasy_installとかzc.buildoutとかに対応させて簡単に使えるようにしたい。

.. _`Expert Python Programming`: http://www.packtpub.com/expert-python-programming/book


:extend type: text/html
:extend:
%%%%%%%%%

:id: 657
:date: 2009-07-14 01:25:55
:title: DQ9 と AspireRevo液晶付きを買った
:categories: ['misc']
:body type: text/x-rst
:body:
日曜日にヨドバシに買いに行ったら、色々あって16%還元で、ラッキー。


DQ9: 今やらないと多人数プレー関係（すれちがい通信含む）が楽しめないよね。

AspireRevo: 我が家初のフルHD液晶は23インチのPC用でした。それでも発色は8年前のプラズマの方がいいなぁ。HDMIでREGZAに繋いで比較してみたい...。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 658
:date: 2009-07-14 01:29:33
:title: AspireRevo 雑感。 WindowsUpdateしたら無限再起動した...
:categories: ['IT-PC']
:body type: text/x-rst
:body:
`AspireRevo`_ について雑感。

* CPUはNetbookだと思えばまあ。OSのGUIも重いけど。
* 動画再生はnVidiaがサポートしてくれるので、重くない。DVDくらいなら楽々再生。BDもいけるらしい？
* Ys6を動かしてみたら高品位設定でストレス無く動いた。
* FFXIベンチはHighモードの2週目でOSがハングアップした。もしかして熱暴走？Loモードのスコアは2494。すごいのかどうかはよく分からない。
* WindowsUpdateせずに、手動でVista SP2にあげた方が良い。うかつにも無限再起動問題を踏んでしまったので、 `KB949358`_ に書いてある対処方法でなんとか復旧した。
* 液晶セットの方を選ぶと、PC本体用のVESAマウンタとHDMIケーブルが付いてくる。実質2万未満で液晶本体が手に入るのはすごいな。
* と思ったけどAcerの同格の液晶の価格帯が1万7千くらいだった。それもすごい話だけど..。
* 液晶の背面に本体をVESAマウントしておくと取り回しやすい。
* 802.11nに対応している。そろそろn対応のAPを用意するしかないのか..。


.. _`AspireRevo`: http://www.yodobashi.com/ec/product/100000001001122077/index.html

.. _`KB949358`: http://support.microsoft.com/kb/949358/ja

:extend type: text/html
:extend:
%%%%%%%%%

:id: 659
:date: 2009-07-15 13:14:09
:title: buildoutで開発1: WSGIアプリをeggで作る
:categories: ['python', 'web']
:body type: text/x-rst
:body:
`eggの作り方が分からない`_ のエントリで書いたように、egg対応アプリの作成手順についてまとまった情報が見つからなかったので、自分でやってみた手順をメモしていきます。
egg recipeの作り方 で検索しても、ハムエッグの調理法ばっかりひっかかる。

まずはegg対応のパッケージを作ってみる。せっかくなので、中身を超簡単なWSGIアプリにしてPasterで起動できるようにしてみる。
下準備として、virtualenvで独立した環境を用意。virtualenvはeasy_installでインストールしてある前提。

.. topic:: 下準備
  :class: dos

  | > cd c:\\project\\buildout
  | > virtualenv env1
  | > cd env1
  | > Scripts/activate
  | > easy_install pastescript

これでpasterコマンドでスケルトンを作ったり色々できるようになったので、どんなテンプレートがあるのかを眺めつつ、スケルトンを作成。

.. topic:: eggパッケージのスケルトンを作る
  :class: dos

  | > paster create --list-templates
  | Available templates:
  |   basic_package:  A basic setuptools-enabled package
  |   paste_deploy:   A web application deployed through paste.deploy
  | > paster create -t basic_package wsgiapp
  | Selected and implied templates:
  |   pastescript#basic_package  A basic setuptools-enabled package
  | 
  | Variables:
  |   egg:      wsgiapp
  |   package:  wsgiapp
  |   project:  wsgiapp
  | Enter version (Version (like 0.1)) ['']: 0.1
  | Enter description (One-line description of the package) ['']: wsgi test application
  | Enter long_description (Multi-line description (in reST)) ['']:
  | Enter keywords (Space-separated keywords/tags) ['']: wsgi
  | Enter author (Author name) ['']: foo
  | Enter author_email (Author email) ['']: foo@example.com
  | Enter url (URL of homepage) ['']: www.example.com
  | Enter license_name (License name) ['']: ZPL
  | Enter zip_safe (True/False: if the package can be distributed as a .zip file) [False]:
  | Creating template basic_package
  | Creating directory .\\wsgiapp
  |   Recursing into +package+
  |     Creating .\\wsgiapp\\wsgiapp/
  |     Copying __init__.py to .\\wsgiapp\\wsgiapp\\__init__.py
  |   Copying setup.cfg to .\\wsgiapp\\setup.cfg
  |   Copying setup.py_tmpl to .\\wsgiapp\\setup.py
  | Running c:\\Project\\buildout\\env1\\Scripts\\python.exe setup.py egg_info

項目の内容は適当に入れたけど、将来的にpypiに登録するつもりならちゃんと入れたいところ。
コマンド一発でpypiに登録できるらしいけど、上記のような適当な内容で登録しちゃわないように気をつけること＞俺。

次に、pasterでWeb起動できるようにエントリポイントを登録する。使えるエントリポイント一覧は ``paster points --list`` で表示出来るっぽい。

.. topic:: エントリポイント一覧
  :class: dos

  | > paster points --list
  | 14 entry point groups found:
  | ...
  | [paste.app_factory]
  |   This gives a factory/function that can create WSGI apps
  | ...


wsgi.ini, startup.py を作成して、setup.pyにエントリポイントとして登録する。この3つの更新と各種の名前（モジュール名・関数名等）が関連しあっているようだ。エントリポイントについてはまだちゃんと理解しきれていないのであとでもうちょっと調べる。

wsgi.ini::

  [app:main]
  use = egg:wsgiapp

wsgiapp/startup.py:

.. code-block:: Python

    # -*- coding: utf-8 -*-
  
    def application(environ, start_response):
        status = '200 OK'
        response_headers = [('Content-type', 'text/plain')]
        start_response(status, response_headers)
        return ["It's Python!\\n"]
  
    def application_factory(global_conf):
        return application

setup.py (変更点のみ):

.. code-block:: Python

    entry_points="""
    [paste.app_factory]
    main = wsgiapp.startup:application_factory
    """,
  
setup.py を変更したので、eggとしての情報を更新するために ``python setup.py develop`` する。これで \*.egg-info が更新される。
ところで、この \*.egg-info はソースコード管理に入れない方が良いんだと思うけど、どうなんだろうか？


.. topic:: setup.pyの更新をeggに反映する
  :class: dos

  | > python setup.py develop
  | running develop
  | running egg_info
  | writing wsgiapp.egg-info\\PKG-INFO
  | writing top-level names to wsgiapp.egg-info\\top_level.txt
  | writing dependency_links to wsgiapp.egg-info\\dependency_links.txt
  | writing entry points to wsgiapp.egg-info\\entry_points.txt
  | reading manifest file 'wsgiapp.egg-info\\SOURCES.txt'
  | writing manifest file 'wsgiapp.egg-info\\SOURCES.txt'
  | running build_ext
  | Creating c:\\project\\buildout\\env1\\lib\\site-packages\\wsgiapp.egg-link (link to .)
  | 
  | Adding wsgiapp 0.1dev to easy-install.pth file
  | 
  | Installed c:\\project\\buildout\\env1\\wsgiapp
  | Processing dependencies for wsgiapp==0.1dev
  | Finished processing dependencies for wsgiapp==0.1dev


これでpasterから実行出来るようになった。
作ったアプリにrequestを投げてみる。

.. topic:: PasterでWSGIアプリにRequestを送る
  :class: dos

  | > paster request wsgi.ini /
  | It's Python!


It's Work!

アプリに渡ってきている環境変数とかを表示するように、改造してみる。

wsgiapp/startup.py:

.. code-block:: Python

    # -*- coding: utf-8 -*-
    from StringIO import StringIO
    from pprint import pprint

    def application(environ, start_response):
        status = '200 OK'
        response_headers = [('Content-type', 'text/plain')]
        start_response(status, response_headers)
        buf = StringIO()
        pprint(environ, buf)
        return ["It's Python!\\n" + buf.getvalue()]

    def application_factory(global_conf):
        return application


今回はsetup.pyを(egg的な情報を)変更していないので、setup.py develop はしなくてもOK。
さっそくRequestにQueryを付けて投げてみる。

.. topic:: RequestにQueryを付ける
  :class: dos

  | > paster request wsgi.ini /url/here key=value key2=value2
  | It's Python!
  | {'CONTENT_TYPE': 'text/plain',
  |  'HTTP_ACCEPT': 'text/plain;q=1.0, */*;q=0.1',
  |  'HTTP_HOST': 'localhost',
  |  'PATH_INFO': '/url/here',
  |  'QUERY_STRING': 'key=value&key2=value2',
  |  'REQUEST_METHOD': 'GET',
  |  'SCRIPT_NAME': '',
  |  'SERVER_NAME': 'localhost',
  |  'SERVER_PORT': '80',
  |  'SERVER_PROTOCOL': 'HTTP/1.0',
  |  'paste.command_request': True,
  |  'wsgi.errors': <open file '<stderr>', mode 'w' at 0x0181E0B0>,
  |  'wsgi.input': <cStringIO.StringI object at 0x0181A698>,
  |  'wsgi.multiprocess': False,
  |  'wsgi.multithread': False,
  |  'wsgi.run_once': True,
  |  'wsgi.url_scheme': 'http',
  |  'wsgi.version': (1, 0)}


ちゃんと受け取れているっぽい。

ちょっといじれば、Webサーバーとして起動して、ブラウザでアクセスすることも出来るよ！

wsgi.ini::

  [app:main]
  use = egg:wsgiapp
  
  [server:main]
  use = egg:Paste#http
  host = 127.0.0.1
  port = 8080


.. topic:: サーバーとして起動する
  :class: dos

  | > paster serve wsgi.ini
  | Starting server in PID 3976.
  | serving on http://127.0.0.1:8080

これで、ブラウザで http://localhost:8080/hoge?foo=bar&baz=2 にアクセスすると以下のように表示される::

  It's Python!
  {'CONTENT_LENGTH': '0',
   'CONTENT_TYPE': '',
   'HTTP_ACCEPT': 'application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5',
   'HTTP_ACCEPT_CHARSET': 'Shift_JIS,utf-8;q=0.7,*;q=0.3',
   'HTTP_ACCEPT_ENCODING': 'gzip,deflate,bzip2,sdch',
   'HTTP_ACCEPT_LANGUAGE': 'ja,en-US;q=0.8,en;q=0.6',
   'HTTP_CONNECTION': 'keep-alive',
   'HTTP_HOST': 'localhost:8080',
   'HTTP_USER_AGENT': 'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/530.5 (KHTML, like Gecko) Chrome/2.0.172.33 Safari/530.5',
   'PATH_INFO': '/hoge'
   'QUERY_STRING': 'foo=bar&baz=2',,
   'REMOTE_ADDR': '127.0.0.1',
   'REQUEST_METHOD': 'GET',
   'SCRIPT_NAME': '',
   'SERVER_NAME': '127.0.0.1',
   'SERVER_PORT': '8080',
   'SERVER_PROTOCOL': 'HTTP/1.1',
   'paste.httpserver.thread_pool': <paste.httpserver.ThreadPool object at 0x01889F90>,
   'wsgi.errors': <open file '<stderr>', mode 'w' at 0x012EE0B0>,
   'wsgi.input': <socket._fileobject object at 0x019E80A0 length=0>,
   'wsgi.multiprocess': False,
   'wsgi.multithread': True,
   'wsgi.run_once': False,
   'wsgi.url_scheme': 'http',
   'wsgi.version': (1, 0)}

最後にApacheにmod_wsgiを設定して表示する。 `mod_wsgiはGoogleCode`_ から取得。自分の環境はWindowsなので自前でビルドしました。

httpd-wsgi.conf::

  LoadModule wsgi_module modules/mod_wsgi.so
  WSGIPythonPath c:/project/buildout/env1/lib
  WSGIPythonEggs c:/project/buildout/env1/wsgiapp
  WSGIScriptAlias /test c:/project/buildout/env1/wsgiapp/wsgiapp/startup.py

  <Directory c:/project/buildout/env1/wsgiapp/wsgiapp/>
      Order allow,deny
      Allow from all
  </Directory>


これでとりあえず http://localhost/test にブラウザでアクセスすると表示出来た！
けど、mod_wsgiとの繋ぎ込み部分(startup.py直接指定)が納得いかない。納得いかないけど、とりあえず放置。

最後に、egg化する。

.. topic:: サーバーとして起動する
  :class: dos

  | > python setup.py bdist_egg
  | running bdist_egg
  | ...
  | creating 'dist\wsgiapp-0.1dev-py2.4.egg' and adding 'build\bdist.win32\egg' to it
  | removing 'build\bdist.win32\egg' (and everything under it)

ということで、wsgiapp-0.1dev-py2.4.egg が作れました。今日はここまで。

次はこのeggを使ってApacheと繋げられるようになれば良いのかな。


.. _`eggの作り方が分からない`: http://www.freia.jp/taka/blog/655

.. _`zc.buildoutを使ったプロジェクト管理`: http://nagosui.org/Nagosui/Docs/tutorial/managing-projects-with-zcbuildout/tutorial-all-pages
.. _`Managing projects with Buildout`: http://plone.org/documentation/tutorial/buildout/tutorial-all-pages
.. _`Using z3c packages,...`: http://www.ibiblio.org/paulcarduner/z3ctutorial/introduction.html
.. _`Zope 3の入門にはz3cのチュートリアルがおすすめ`: http://blog.livedoor.jp/matssaku/archives/50500810.html

.. _`http://svn.zope.org/repos/main/`: http://svn.zope.org/repos/main/
.. _`zc.buildout`: http://pypi.python.org/pypi/zc.buildout
.. _`zc.recipe.egg`: http://pypi.python.org/pypi/zc.recipe.egg
.. _`z3c.recipe.egg`: http://pypi.python.org/pypi/z3c.recipe.egg
.. _`Zope 3 Package Guide`: http://wiki.zope.org/zope3/Zope3PackageGuide
.. _`mr.developer`: http://pypi.python.org/pypi/mr.developer
.. _`mod_wsgiはGoogleCode`: http://code.google.com/p/modwsgi/


:extend type: text/html
:extend:


:comments:
:comment id: 2009-07-15.8718028351
:title: そりゃそうだ(笑)
:author: jack
:date: 2009-07-15 18:24:33
:email: 
:url: 
:body:
> egg recipeの作り方 で検索しても、ハムエッグの調理法ばっかりひっかかる。

けっこう嬉しいエントリかもしれない


:comments:
:comment id: 2009-07-17.5513430075
:title: Re:buildoutで開発1: WSGIアプリをeggで作る
:author: しみずかわ
:date: 2009-07-17 00:35:51
:email: 
:url: 
:body:
> けっこう嬉しいエントリかもしれない

ハムエッグ人気あるなあ（違
"egg recipeの作り方" で、この記事がGoogle6位になりました。"egg 作り方" では2位です（笑


:comments:
:comment id: 2009-07-17.6857374550
:title: みんなぐぐっても
:author: jack
:date: 2009-07-17 11:44:46
:email: 
:url: 
:body:
違うレシピばかりでうんざりしていたんでしょう。
わたしもやってみます。

%%%%%%%%%

:id: 660
:date: 2009-07-16 23:45:00
:title: buildoutで開発2: buildoutで環境を整える
:categories: ['python', 'Programming', 'web']
:body type: text/x-rst
:body:
`eggの作り方が分からない`_, `buildoutで開発1: WSGIアプリをeggで作る`_ の続き。buildoutでテストまで。

現時点のファイル構成::

  c:\Project\buildout\env1\
   +-- wsgiapp
       +-- setup.cfg
       +-- setup.py
       +-- wsgi.ini
       +-- wsgiapp.egg-info
       |   +-- *.*
       +-- wsgiapp
           +-- __init__.py
           +-- __init__.pyc
           +-- startup.py
           +-- startup.pyc


とりあえずコミットしておく。
\*.pycと\*.egg-info は自動生成されるファイルなのでコミットしない。
Subversion上に以下のようになるようにコミットして、trunkをチェックアウト。

リポジトリの内容はこんな感じ::

  svn://
   +-- wsgiapp
       +-- trunk
           +-- setup.cfg
           +-- setup.py
           +-- wsgi.ini
           +-- wsgiapp
               +-- __init__.py
               +-- startup.py

以降、ソースコード管理に登録する手順を何度か書いてますが、以降の作業では、登録するべきファイルとそうでないファイルが混在し始めるため、必要なファイルを分かりやすくするためにコミットしてます。

.. topic:: SVNに登録
  :class: dos

  | > cd c:\Project\buildout\env1\wsgiapp
  | > svn mkdir file:///svnpath/wsgiapp -m "mkdir"
  | > svn mkdir file:///svnpath/wsgiapp/trunk -m "mkdir"
  | > svn import . file:///svnpath/wsgiapp/trunk -m "import"
  | > svn co file:///svnpath/wsgiapp/trunk . --force


閑話休題。buildoutを使うための環境を整える。

.. topic:: bootstrap.py を取得
  :class: dos

  | > cd c:\Project\buildout\env1\wsgiapp
  | > wget http://svn.zope.org/repos/main/zc.buildout/trunk/bootstrap/bootstrap.py
  | > dir /b
  | bootstrap.py
  | setup.cfg
  | setup.py
  | wsgi.ini
  | wsgiapp


buildout.cfg::

    [buildout]
    develop = .
    parts = wsgiapp
    newest = true
    
    [wsgiapp]
    recipe = zc.recipe.egg
    eggs =
        wsgiapp
        Paste
        PasteDeploy
        PasteScript


ここまでで一度コミット。

.. topic:: buildoutの初期ファイルをsvnに登録
  :class: dos

  | > svn add buildout.cfg bootstrap.py
  | > svn ci -m "initial buildout files"


おもむろに違う環境を作ってみる。別のコンソールを開くと良いと思う。

.. topic:: 新しい環境で動作確認
  :class: dos

  | > cd c:\Project\buildout
  | > virtualenv env2
  | > cd env2
  | > Scripts/activate
  | > svn co file:///svnpath/wsgiapp/trunk wsgiapp
  | > cd wsgiapp
  | > python bootstrap.py
  | > bin/buildout
  | ...
  | > bin/paster request wsgi.ini /
  | It's Python!
  | ...


この環境ではvirtualenv と setuptoolsが使える以外は何も入っていない。
bootstrap.py -> buildout -> setuptools... と関連して色々ダウンロードされて、環境が構築される。

ここで、元の環境にもどって、wsgiappに関連パッケージを定義する。
パッケージの関連づけはbuildoutとしてではなく、eggとして対応する。
このため setup.py を以下のように更新する。

setup.py:

.. code-block:: Python

  install_requires=[
    'BeautifulSoup',
  ],


.. topic:: buildoutで環境を更新する（依存パッケージを取得する）。
  :class: dos

  | > buildout
  | ...
  | Updating wsgiapp.
  | Getting distribution for 'BeautifulSoup'.
  | ...


ここで、wsgiapp.egg-info/requires.txt を見ると、ちゃんとBeautifulSoupに依存しているという定義にUpdateされている。


これからBeautifulSoupを使うような実装を追加したいが、eggで追加されたパッケージの動作を確認したり、ヘルプを見たりするのにインタラクティブシェルからBeautifulSoupを呼び出したい。
でも、buildoutで関連づけられたeggパッケージはPythonにインストールされているわけではないので、そのままでは呼び出せない。


.. topic:: eggパッケージをimport出来ない
  :class: dos

  | > python
  | Python 2.4.4 (#71, Oct 18 2006, 08:34:43) [MSC v.1310 32 bit (Intel)] on win32
  | Type "help", "copyright", "credits" or "license" for more information.
  | >>>
  | >>> import BeautifulSoup
  | Traceback (most recent call last):
  |   File "<stdin>", line 1, in ?
  | ImportError: No module named BeautifulSoup
  | >>>


そこで、関連するeggを使える状態でPythonを起動するスクリプトを作成する。スクリプトの名前は適当にpyとしておきます。
スクリプトの用意は、以下のようにbuildout.cfgを書き換えれば、
あとはbuildoutがやってくれる。

buildout.cfg::

    [buildout]
    develop = .
    parts = wsgiapp eggpy
    newest = true

    [wsgiapp]
    recipe = zc.recipe.egg
    eggs =
        wsgiapp
        Paste
        PasteDeploy
        PasteScript

    [eggpy]
    recipe = zc.recipe.egg
    eggs = ${wsgiapp:eggs}
    interpreter = py
    scripts = py

``[eggpy]`` セクションを追加して、そのセクションがbuild対象であることをbuildoutに伝えるために、 ``parts =`` にeggpyを追加。
eggpyの中で、利用したいeggの指定はwsgiappと同じ内容で良いけど、それをまた書くのは面倒なので、 ``${wsgiapp:eggs}`` という感じで変数で指定。

この内容で環境を更新するために、buildoutコマンドを実行。

.. topic:: buildoutで環境を更新
  :class: dos

  | > bin/buildout
  | Develop: 'c:\\Project\\buildout\\env1\\wsgiapp\\.'
  | unrecognized .svn/entries format; skipping .
  | unrecognized .svn/entries format in
  | Updating wsgiapp.
  | Installing eggpy.
  | Generated interpreter 'c:\\Project\\buildout\\env1\\wsgiapp\\bin\\py'.


作られたpyコマンドでインタラクティブシェルを起動して、eggパッケージを呼び出せることを確認。

.. topic:: eggパッケージをimport出来る
  :class: dos

  | > bin/py
  | 
  | >>> import BeautifulSoup
  | >>> help(BeautifulSoup)
  | Help on module BeautifulSoup:
  | 
  | NAME
  |     BeautifulSoup
  | ...


OK.

BeautifulSoupを使ったWSGIアプリの実装部分関数を作る。とりあえずWSGIとか関係なく、与えられたURLをGETして、hrefの値を書き換えて返す関数を実装。動作確認用に、コンソールから実行された場合の動作も実装しておく。

wsgiapp/scraper.py:

.. code-block:: Python

    # -*- coding: utf-8 -*-
    import urllib2
    from BeautifulSoup import BeautifulSoup
    
    def modifyLinks(url):
        bs = BeautifulSoup(urllib2.urlopen(url))
        for elem in bs.findAll('a'):
            if elem.has_key('href'):
                elem['href'] += "#foobar"
    
        return bs.prettify()
    
    
    if __name__ == '__main__':
        import sys
        if len(sys.argv) > 1:
            url = sys.argv[1]
        else:
            url = "http://pypi.python.org/simple/BeautifulSoup/"
        print modifyLinks(url)


で、動作確認。

.. topic:: コンソールで実行
  :class: dos

  | > bin/py wsgiapp/scraper.py
  | <html>
  | ...
  |   <a href="http://www.crummy.com/software/BeautifulSoup/#foobar" rel="homepage">
  | ...
  | </html>

OK. ちゃんと#foobarが追加されてた。
これをwsgiappとして組み込む。

wsgiapp/startup.py:

.. code-block:: Python

    # -*- coding: utf-8 -*-
    import scraper
    
    def application(environ, start_response):
        status = '200 OK'
        response_headers = [('Content-type', 'text/html')]
        start_response(status, response_headers)
        return [scraper.modifyLinks(
            "http://pypi.python.org/simple/BeautifulSoup/"
        )]
    
    def application_factory(global_conf):
        return application


うまく動くか、pasterコマンドでrequestして確認したり、paster serve してブラウザで確認したり。

.. topic:: pasterで動作確認
  :class: dos

  | > bin/paster request wsgi.ini /
  | ...
  | > bin/paster serve wsgi.ini
  | ...


ここまでをとりあえず、コミット。


.. topic:: scraperをコミット
  :class: dos

  | > svn add wsgiapp\scraper.py
  | > svn ci -m "add and use scraper"


ここで、さっき作ったscraperのテスト方法が気に入らないので、書き換えてみる。


wsgiapp/scraper.py:

.. code-block:: Python

    # -*- coding: utf-8 -*-
    import urllib2
    from BeautifulSoup import BeautifulSoup
    
    def modifyLinks(url):
        """modifyLinks get content from given url and modify href attributes.
    
           >>> content = modifyLinks("http://pypi.python.org/simple/BeautifulSoup/")
           >>> '#foobar"' in content
           True
        """
        bs = BeautifulSoup(urllib2.urlopen(url))
        for elem in bs.findAll('a'):
            if elem.has_key('href'):
                elem['href'] += "#foobar"
    
        return bs.prettify()
    
    
    if __name__ == '__main__':
        import doctest
        doctest.testmod()


で、改めてテスト。エラー無くテストが成功した場合は、 ``-v`` オプション無しだと何も表示されないので、心配なら-vを付けて動かしてみよう。


.. topic:: テストする
  :class: dos

  | > bin/py wsgiapp/scraper.py
  | > bin/py wsgiapp/scraper.py -v
  | ...
  | Test passed.


テストが通ったので、コミット。

最後に、buildoutで全モジュールを自動的にテストするためのスクリプトを用意する。まず、DocTestを外から呼び出すためにtests.pyを用意。

wsgiapp/tests.py:

.. code-block:: Python

    # -*- coding: utf-8 -*-
    
    import unittest
    from doctest import DocTestSuite
    
    def test_suite():
        return unittest.TestSuite((
            DocTestSuite('wsgiapp.scraper'),
        ))
    
    if __name__ == '__main__':
        unittest.main()

次に、biuldout.cfgでテスト実行スクリプトを生成。
``[test]`` セクションを追加して、partsにtestセクションの呼び出しを追加。使っているレシピが今までと違ってzc.recipe.testrunnerであることと、テスト対象にPaste等を含めたくなかったので、${wsgiapp:eggs}は使わなかったところがポイント。

buildout.cfg::

  ...
  parts = wsgiapp eggpy test
  ...

  [test]
  recipe = zc.recipe.testrunner
  eggs = wsgiapp
  relative-paths = true


buildoutで環境を更新してテストする。


.. topic:: buildoutで環境を更新してテストする
  :class: dos

  | > bin/buildout 
  | ...
  | Installing test.
  | Generated script 'c:\\Project\\buildout\\env1\\wsgiapp\\bin\\test'.
  | 
  | > bin/test
  | Running zope.testing.testrunner.layer.UnitTests tests:
  |   Set up zope.testing.testrunner.layer.UnitTests in 0.000 seconds.
  |   Ran 1 tests with 0 failures and 0 errors in 0.757 seconds.
  | Tearing down left over layers:
  |   Tear down zope.testing.testrunner.layer.UnitTests in 0.000 seconds.


ZopeのTestRunnerが使われるけど、気にしない方向で。 ``bin/test -h`` でコマンドラインオプションもみれるよ。

今日はここまで。

.. topic:: コミット
  :class: dos

  | > svn add wsgiapp\tests.py
  | > svn ci -m "add test framework"


参考
------
* `zc.buildout`_
* `zc.recipe.egg`_
* `zc.recipe.testrunner`_


.. _`eggの作り方が分からない`: http://www.freia.jp/taka/blog/655
.. _`buildoutで開発1: WSGIアプリをeggで作る`: http://www.freia.jp/taka/blog/659

.. _`zc.buildoutを使ったプロジェクト管理`: http://nagosui.org/Nagosui/Docs/tutorial/managing-projects-with-zcbuildout/tutorial-all-pages
.. _`Managing projects with Buildout`: http://plone.org/documentation/tutorial/buildout/tutorial-all-pages
.. _`Using z3c packages,...`: http://www.ibiblio.org/paulcarduner/z3ctutorial/introduction.html
.. _`Zope 3の入門にはz3cのチュートリアルがおすすめ`: http://blog.livedoor.jp/matssaku/archives/50500810.html

.. _`http://svn.zope.org/repos/main/`: http://svn.zope.org/repos/main/
.. _`zc.buildout`: http://pypi.python.org/pypi/zc.buildout
.. _`zc.recipe.egg`: http://pypi.python.org/pypi/zc.recipe.egg
.. _`zc.recipe.testrunner`: http://pypi.python.org/pypi/zc.recipe.testrunner
.. _`z3c.recipe.egg`: http://pypi.python.org/pypi/z3c.recipe.egg
.. _`Zope 3 Package Guide`: http://wiki.zope.org/zope3/Zope3PackageGuide
.. _`mr.developer`: http://pypi.python.org/pypi/mr.developer
.. _`mod_wsgiはGoogleCode`: http://code.google.com/p/modwsgi/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 661
:date: 2009-07-30 17:29:57
:title: buildoutで開発3: easy_install できるように公開する
:categories: ['python', 'Programming', 'web']
:body type: text/x-rst
:body:
`eggの作り方が分からない`_, `buildoutで開発1: WSGIアプリをeggで作る`_, `buildoutで開発2: buildoutで環境を整える`_ の続き。buildoutというよりsetuptoolsネタ。

buildoutで自動的にパッケージを取ってくる仕組みは内部的にsetuptools/easy_install.pyを使用していて、setuptoolsはデフォルトでは対象パッケージ名を pypi_ (Python Package Index) に探しに行く。pypiへの登録は ``python setup.py register`` で出来るんだけど、前回作ったようなwsgiappは実験用なので登録したくないし、仕事で作っているパッケージ類は世界に公開してはまずい。ということで、easy_installの ``--find-links (-f)`` オプションでpypi以外のページを指定する方法でpypiに公開しなくても自動インストール出来るようにする。

(setuptoolsのマニュアルを読むと、そのまんまな記載がある: `Making your package available for EasyInstall`_, `Sumiさんの日本語訳`_)

前提
-----
* pypiに登録しない
* wsgiappをSubversionから取ってくる

Subversionリポジトリをhttpで公開する
-------------------------------------
SVNの公開方法は ``file:``, ``svn:``, ``http:`` とあるけど、easy_installの-fオプションではページ内のリンクにfile:と書いてあってもSVNとして認識されないので、素直にhttp:を使うことにする。あと、SVN以外のリポジトリも使えないっぽい。

ということで、httpdにmod_dav_svnで設定して公開する。URLは ``http://localhost:8080/repos`` でSVNのルートが見えるようにしておく。


easy_install用のindexページを用意する
---------------------------------------
easy_installの-fオプションは指定したページのリンクをチェックして、リンクURLがegg用リンクであれば使ってくれる。eggとして認識されるリンクは、URL末尾に ``#egg=projectname-version`` という記載があればよいので、開発版wsgiappの場合は ``http://localhost:8080/repos/wsgiapp/trunk#egg=wsgiapp-dev`` となっていればeasy_installで認識してくれるようになる。

ということで、http://localhost:8080/index.htmlというページを作って上記URLをaタグで書いておく。


easy_installでインストールしてみる
------------------------------------
実際に認識されるかどうか確認する。確認したいだけなので、 ``--dry-run`` オプションを付けて実行。dry-runのせいで最後はエラーになるけど、途中までは以下のようにsubversionからcheckoutしてくれて、index.htmlがうまく働いている事が確認出来た。

.. topic:: easy_install --dry-run
  :class: dos

  | > easy_install --dry-run -f http://localhost:8080/ wsgiapp
  | Searching for wsgiapp
  | Reading http://localhost:8080/
  | Best match: wsgiapp dev
  | Downloading http://localhost:8080/repos/wsgiapp/trunk#egg=wsgiapp-dev
  | Doing subversion checkout from http://localhost:8080/repos/wsgiapp/trunk to \\temp\\easy_install-tlvn6p\trunk
  | Processing trunk
  | Running setup.py ....


ここまでくれば、index.htmlを自動生成するようにwsgiappを改造すれば後々楽になりそう。

wsgiappで動的にPackageIndexページを生成する
------------------------------------------
とりあえずてきとーに、'指定PATH/package名/trunk'を'package名#egg=package名-dev'としてリンクするように、 `buildoutで開発2: buildoutで環境を整える`_ で作成したwsgiapp.scraperに新しい関数を追加する。


wsgiapp/scraper.py の追加関数部分:

.. code-block:: Python

    import urlparse
    import string

    def eggifyLinks(fileobj, basepath=''):
        """\
        eggifyLinks read html data from given fileobj and modify href
        attributes.
    
            >>> from StringIO import StringIO
            >>> fileobj = StringIO('''\
            ... <html><body><a href="wsgiapp">wsgiapp</a></body></html>
            ... ''')
            >>> content = eggifyLinks(fileobj)
            >>> 'href="wsgiapp/trunk#egg=wsgiapp-dev"' in content
            True
    
        ``basepath`` param effect for relative url.
    
            >>> fileobj = StringIO('''\
            ... <html><body><a href="wsgiapp">wsgiapp</a></body></html>
            ... ''')
            >>> content = eggifyLinks(fileobj, 'http://domain/sub/')
            >>> 'href="http://domain/sub/wsgiapp/trunk#egg=wsgiapp-dev"' in content
            True
    
        if href ends with '/', eggifyLinks return same result.
    
            >>> fileobj = StringIO('''\
            ... <html><body><a href="wsgiapp/">wsgiapp</a></body></html>
            ... ''')
            >>> content = eggifyLinks(fileobj)
            >>> 'href="wsgiapp/trunk#egg=wsgiapp-dev"' in content
            True
    
        work with full url.
    
            >>> fileobj = StringIO('''\
            ... <html><body><a href="http://localhost:8080/repos/wsgiapp/">wsgiapp</a></body></html>
            ... ''')
            >>> content = eggifyLinks(fileobj)
            >>> 'href="http://localhost:8080/repos/wsgiapp/trunk#egg=wsgiapp-dev"' in content
            True
    
        if url have #id, href is not modified.
    
            >>> fileobj = StringIO('''\
            ... <html><body><a href="wsgiapp#foo">wsgiapp</a></body></html>
            ... ''')
            >>> content = eggifyLinks(fileobj)
            >>> 'href="wsgiapp#foo"' in content
            True
            >>> '#egg' not in content
            True
    
        if url have no package name, href is not modified.
    
            >>> fileobj = StringIO('''\
            ... <html><body>
            ... <a href="..">Parent</a>
            ... <a href="http://domainonly/">domain</a>
            ... </body></html>
            ... ''')
            >>> content = eggifyLinks(fileobj)
            >>> 'href=".."' in content
            True
            >>> 'href="http://domainonly/"' in content
            True
            >>> '#egg' not in content
            True
    
        """
        baseparts = urlparse.urlparse(basepath)
    
        bs = BeautifulSoup(fileobj)
        for elem in bs.findAll('a'):
            if elem.has_key('href'):
                href = elem['href']
                parts = list(urlparse.urlparse(href))
    
                # #id check
                if parts[5]:
                    continue # #id already exist
    
                # modify path
                path = parts[2]
                if path.endswith('/'):
                    path = path[:-1]
                pkgname = path.split('/')[-1]
                if not pkgname or pkgname[0] not in string.letters:
                    continue # pkgname does not seem package name
                parts[2] = '%(path)s/trunk#egg=%(pkgname)s-dev' % locals()
    
                # modify domain
                if basepath and not parts[1]:
                    parts[0] = baseparts[0]
                    parts[1] = baseparts[1]
                    if parts[2][0] != '/':
                        p = baseparts[2]
                        if p.endswith('/'):
                            p = p[:-1]
                        parts[2] = p + '/' + parts[2]
    
                # update href
                elem['href'] = urlparse.urlunparse(parts)
    
        return bs.prettify()

テストする。

.. topic:: テスト
  :class: dos

  | > bin/test.exe
  | Running zope.testing.testrunner.layer.UnitTests tests:
  |   Set up zope.testing.testrunner.layer.UnitTests in 0.000 seconds.
  |   Ran 2 tests with 0 failures and 0 errors in 0.887 seconds.
  | Tearing down left over layers:
  |   Tear down zope.testing.testrunner.layer.UnitTests in 0.000 seconds.


呼出元を新しい関数に変更。

wsgiapp/startup.py の変更部分:

.. code-block:: Python

    import urllib2

    def application(environ, start_response):
        status = '200 OK'
        response_headers = [('Content-type', 'text/html')]
        start_response(status, response_headers)
        return [scraper.eggifyLinks(
            urllib2.urlopen("http://localhost:8080/repos/"),
            "http://localhost:8080/repos/",
        )]


実際に動作させた時の出力を ``bin/paster request wsgi.ini /`` で確認。

.. topic:: paster request
  :class: dos

  | > bin/paster request wsgi.ini /
  | <html>
  |  <head>
  |   <title>
  |    repos - Revision 9: /
  |   </title>
  |  </head>
  |  <body>
  |   <h2>
  |    repos - Revision 9: /
  |   </h2>
  |   <ul>
  |    <li>
  |     <a href="http://localhost:8080/repos/wsgiapp/trunk#egg=wsgiapp-dev">
  |      wsgiapp/
  |     </a>
  |    </li>
  |   </ul>
  |   <hr noshade />
  |   <em>
  |    Powered by
  |    <a href="http://subversion.tigris.org/">
  |     Subversion
  |    </a>
  |    version 1.6.3 (r38063).
  |   </em>
  |  </body>
  | </html>


easy_installでうまく動くか確認するため、wsgiappをサーバー動作させてから、別コンソールでeasy_installを-fオプション付きで動かしてみてwsgiappパッケージを見つけられれば成功。8080ポートはapacheで使ってるので8180で起動するようにwsgi.iniを変更しておく。

.. topic:: paster serve
  :class: dos

  | > bin/paster serve wsgi.ini
  | Starting server in PID 6460.
  | serving on http://127.0.0.1:8180


.. topic:: easy_install --find-links
  :class: dos

  | > easy_install -n -f http://localhost:8180/ wsgiapp
  | Searching for wsgiapp
  | Reading http://localhost:8180/
  | Best match: wsgiapp dev
  | Downloading http://localhost:8080/repos/wsgiapp/trunk#egg=wsgiapp-dev
  | Doing subversion checkout from http://localhost:8080/repos/wsgiapp/trunk to \\temp\\easy_install-_oovzq\trunk
  | Processing trunk
  | Running setup.py ....

dry run なのでsetup.pyの実行には失敗する。実際にインストールする場合は-nを外して実行してみよう。

あとは、このwsgiappをmod_wsgiで動作するようにしておけば、超簡易版のローカル用パッケージ一覧生成ツールとして使える。使えるといいなぁ。

もっとちゃんとやろうと思ったら、pysvn等でパッケージの一覧を取ってきて、各パッケージのtrunkのURLに、 #egg=パッケージ名-dev と付けたり、tagsから自動で #egg=パッケージ名-tag名 としてみたりすればいいんだけど、毎回動的にやってると重いし、そこまでやるんだったらローカルにPyPIを立ち上げた方が良いと思う。作り方は `EggBasket`_ や `how to run your own private PyPI (Cheeseshop) server << Fetchez le Python`_ を参考すればよさそう。



.. _`eggの作り方が分からない`: http://www.freia.jp/taka/blog/655
.. _`buildoutで開発1: WSGIアプリをeggで作る`: http://www.freia.jp/taka/blog/659
.. _`buildoutで開発2: buildoutで環境を整える`: http://www.freia.jp/taka/blog/660

.. _`zc.buildoutを使ったプロジェクト管理`: http://nagosui.org/Nagosui/Docs/tutorial/managing-projects-with-zcbuildout/tutorial-all-pages
.. _`Managing projects with Buildout`: http://plone.org/documentation/tutorial/buildout/tutorial-all-pages
.. _`Using z3c packages,...`: http://www.ibiblio.org/paulcarduner/z3ctutorial/introduction.html
.. _`Zope 3の入門にはz3cのチュートリアルがおすすめ`: http://blog.livedoor.jp/matssaku/archives/50500810.html

.. _`pypi`: http://pypi.python.org/simple/
.. _`http://svn.zope.org/repos/main/`: http://svn.zope.org/repos/main/
.. _`zc.buildout`: http://pypi.python.org/pypi/zc.buildout
.. _`zc.recipe.egg`: http://pypi.python.org/pypi/zc.recipe.egg
.. _`zc.recipe.testrunner`: http://pypi.python.org/pypi/zc.recipe.testrunner
.. _`z3c.recipe.egg`: http://pypi.python.org/pypi/z3c.recipe.egg
.. _`Zope 3 Package Guide`: http://wiki.zope.org/zope3/Zope3PackageGuide
.. _`mr.developer`: http://pypi.python.org/pypi/mr.developer
.. _`mod_wsgiはGoogleCode`: http://code.google.com/p/modwsgi/

.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-09)`: http://d.hatena.ne.jp/SumiTomohiko/20070609/1181406701
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-22)`: http://d.hatena.ne.jp/SumiTomohiko/20070622/1182537643
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-23)`: http://d.hatena.ne.jp/SumiTomohiko/20070623/1182602060
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-24)`: http://d.hatena.ne.jp/SumiTomohiko/20070624/1182665330

.. _`Making your package available for EasyInstall`: http://peak.telecommunity.com/DevCenter/setuptools#making-your-package-available-for-easyinstall
.. _`Sumiさんの日本語訳`: http://d.hatena.ne.jp/SumiTomohiko/20070623/1182602060

.. _`how to run your own private PyPI (Cheeseshop) server << Fetchez le Python`: http://tarekziade.wordpress.com/2008/03/20/how-to-run-your-own-private-pypi-cheeseshop-server/
.. _`EggBasket`: http://www.chrisarndt.de/projects/eggbasket/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 662
:date: 2009-07-30 23:16:59
:title: buildoutで開発 番外編: eggにrevision番号が付かない
:categories: ['python', 'Programming']
:body type: text/x-rst
:body:
eggのファイル名は例えば wsgiapp-0.1dev_r10-py24.egg となっていて、各種設定から自動的に適切な名前が付けられるようになっている。簡単にまとめると以下のような感じ:

:wsgiapp: パッケージ名。setup.pyのname引数
:0.1: バージョン番号。setup.pyのversion引数
:dev: タグ。setup.cfgのegg_infoセクションのtag_buildの値
:r10: リビジョン。setup.cfgのegg_infoセクションのtag_svn_revisionがtrueの場合に自動設定
:py24: Pythonのバージョン。インタプリタバージョンが自動取得される

これらのうち、リビジョン番号は ``setup.cfgでtag_svn_revisionがtrue`` でかつ、 ``svnクライアントのversion <= 1.5`` でないと正しく設定されない。

前者は仕様なので、setup.cfgが無かったら作成して、[egg_info]セクションにtag_svn_revision = true と書いておけば良い。ちなみにsetup.cfgはsetup.pyのデフォルト引数を定義しておけるファイル。egg_infoセクションに何が書けるかは、 ``python setup.py egg_info --help`` で表示されるOptions項を見よう。

後者はsetuptools-0.6c9がsvn-1.6系の新しいクライアントに対応出来てないため。svnコマンドが1.6系の状態で 'easy_install' や 'setup.py bdist_egg' を実行すると以下のようにエラーが表示される（がr0として処理が継続する）。

.. topic:: easy_install
  :class: dos

  | > easy_install ....
  | ...
  | unrecognized .svn/entries format; skipping .
  | unrecognized .svn/entries format in
  | ...

.. topic:: setup.py bdist_egg
  :class: dos

  | > python setup.py bdist_egg
  | ...
  | unrecognized .svn/entries format; skipping .
  | ...
  | unrecognized .svn/entries format in
  | ...


今は.svn/entriesを解析して取得していて、上記のようになってしまうのは.svn/entriesのフォーマット解析に失敗しているため。同じ理由で、.svnじゃなくて_svnに管理情報を格納するように設定している場合(TortoiseSVN等)にもr0になってしまう。今後はどのバージョンのsvnクライアントでも動作するように ``svn info --xml`` で情報を取得するようになるらしい(Issue64_, Issue79_)。

とりあえずsetuptools-0.6c9を使ってeggを作ったり、リポジトリから直接easy_installする場合はsvnクライアントを1.5系にして.svnに管理情報を保存する設定になっていればOK。


参考
------
- Issue64_ (Subversion 1.6 entries format 'unrecognized')
- Issue79_ (SVN Entries parsing should use local svn command for implementation)


.. _`eggの作り方が分からない`: http://www.freia.jp/taka/blog/655
.. _`buildoutで開発1: WSGIアプリをeggで作る`: http://www.freia.jp/taka/blog/659
.. _`buildoutで開発2: buildoutで環境を整える`: http://www.freia.jp/taka/blog/660
.. _`buildoutで開発3: easy_install できるように公開する`: http://www.freia.jp/taka/blog/661

.. _Issue64: http://bugs.python.org/setuptools/issue64
.. _Issue79: http://bugs.python.org/setuptools/issue79


.. _`zc.buildoutを使ったプロジェクト管理`: http://nagosui.org/Nagosui/Docs/tutorial/managing-projects-with-zcbuildout/tutorial-all-pages
.. _`Managing projects with Buildout`: http://plone.org/documentation/tutorial/buildout/tutorial-all-pages
.. _`Using z3c packages,...`: http://www.ibiblio.org/paulcarduner/z3ctutorial/introduction.html
.. _`Zope 3の入門にはz3cのチュートリアルがおすすめ`: http://blog.livedoor.jp/matssaku/archives/50500810.html

.. _`pypi`: http://pypi.python.org/simple/
.. _`http://svn.zope.org/repos/main/`: http://svn.zope.org/repos/main/
.. _`zc.buildout`: http://pypi.python.org/pypi/zc.buildout
.. _`zc.recipe.egg`: http://pypi.python.org/pypi/zc.recipe.egg
.. _`zc.recipe.testrunner`: http://pypi.python.org/pypi/zc.recipe.testrunner
.. _`z3c.recipe.egg`: http://pypi.python.org/pypi/z3c.recipe.egg
.. _`Zope 3 Package Guide`: http://wiki.zope.org/zope3/Zope3PackageGuide
.. _`mr.developer`: http://pypi.python.org/pypi/mr.developer
.. _`mod_wsgiはGoogleCode`: http://code.google.com/p/modwsgi/

.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-09)`: http://d.hatena.ne.jp/SumiTomohiko/20070609/1181406701
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-22)`: http://d.hatena.ne.jp/SumiTomohiko/20070622/1182537643
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-23)`: http://d.hatena.ne.jp/SumiTomohiko/20070623/1182602060
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-24)`: http://d.hatena.ne.jp/SumiTomohiko/20070624/1182665330

.. _`Making your package available for EasyInstall`: http://peak.telecommunity.com/DevCenter/setuptools#making-your-package-available-for-easyinstall
.. _`Sumiさんの日本語訳`: http://d.hatena.ne.jp/SumiTomohiko/20070623/1182602060

.. _`how to run your own private PyPI (Cheeseshop) server << Fetchez le Python`: http://tarekziade.wordpress.com/2008/03/20/how-to-run-your-own-private-pypi-cheeseshop-server/
.. _`EggBasket`: http://www.chrisarndt.de/projects/eggbasket/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 663
:date: 2009-08-07 23:08:52
:title: Zope Essentials 7 で Deliverance の紹介を聞いてきた
:categories: ['Event', 'Zope', 'Plone', 'web']
:body type: text/x-rst
:body:
昨日8/6に、 `Zope Essentials 7を開催します`_ 、に、行ってきました。ニュージーランドでPloneで仕事をしているTim Knappさんがメイントーカーで、 Deliverance_ について話してくれました。余談ですが、Timさんは `Buildout and Plone`_ というプレゼンも書いていたりします(buildout.orgに載ってます)。

Deliveranceとは:

  Deliverance は、デザイン用にHTMLを準備し、バックエンドにおいたPloneなどの動的サーバから、XML定義を元にページを生成する仕組みです。 Ploneへの標準導入が進められており、既にplone.orgサイトでは使われています。 とかく、PloneのSkin(テーマ)開発には学習コストがかかると言われています。それの軽減のためにも、Deliveranceが注目を集めています。

自分の理解は、XPathで位置指定するHTML変換Proxy。で、２つのHTML（変換もとページと、テーマ用HTML）を用意して変換ルールを書けば、変換された結果がブラウザに届きます。この技術はWebデザイナーさんが（Ploneのような）WebサーバーへのHTML組み込み方法を知らなくてもデザイン適用出来るところがミソかなとおもいます。 OSWD_ で配布されているデザインテンプレートも簡単にPloneに適用出来たらしい。

以下、当日のTwitterメモ(`#ze7`_ 一部加筆修正)。

- DeliveranceはXPathでルール書いておいてコンテンツ変換するProxy/WSGI 
- 指定XPathの前追加(prepend), 後追加(append), 削除(drop), 差し替え(replace)が出来る 
- XPath指定したエレメントの属性にだけ作用させることも可能 
- Deliveranceを紹介してるTimはまだDeliveranceを仕事で使ってない。たまたま機会がなかった 
- Deliveranceプレゼン資料 http://tinyurl.com/deliverance-preso-jp 
- Plone&Deliverance using Repoze http://www.sixfeetup.com/blog/2009/4/27/deploying-plone-and-zine-together-with-deliverance-using-repoze 
- Buildout for Plone 3 with deliverance on WSGI http://lichota.pl/blog/buildout-for-plone-3-with-deliverance-on-wsgi 
- A jquery-like library for python http://pypi.python.org/pypi/pyquery 
- zenich: deliveranceうまく使えば html/css とアプリケーション開発とコンテンツ作成をうまく切り分けて開発効率を上げられるのでは。
- 回答: Open Source Web Design (OSWD) のデザインをDeliveranceの勉強しながら数時間でPloneサイトに適用出来た 
- takanory: Deliverance 使うんだったら proxy でやったほうがいいらしい 
- @takanory PloneをWSGIで動くようにセットアップしたり,buildoutに設定するより分かりやすいかと思って言ってみました >最初はproxyがよい 
- Delivarance を単体のProxyとしてセットアップする方法 http://deliverance.openplans.org/quickstart.html


実際の使い方とかは、そのうちbuildoutで開発するネタの一部で書こうと思います。


.. _`Buildout and Plone`: http://www.buildout.org/screencasts.html
.. _`Zope Essentials 7を開催します`: http://zope.jp/events/zopeessentials/7/zope-essentials-7
.. _Deliverance: http://deliverance.openplans.org/index.html
.. _OSWD: http://www.oswd.org/
.. _`#ze7`: http://twitter.com/#search?q=%23ze7


:extend type: text/html
:extend:
%%%%%%%%%

:id: 664
:date: 2009-08-07 23:08:57
:title: Zope-2.12.0b4リリースをeasy_installする
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope-2.12.0b4 が昨日8/6にリリースされました。 `アナウンスはこちら`_ 。 `Zope2.12はPyPIにも登録されている`_ ので、easy_installでインストールすることが出来るようになっています。ということで、さっそくやってみます。

.. topic:: Zope2をeasy_installする
  :class: dos

  | $ wget http://peak.telecommunity.com/dist/ez_setup.py
  | $ python ez_setup.py
  | $ easy_install virtualenv
  | $ virtualenv zope2120
  | $ cd zope2120
  | $ bin/activate
  | 
  | $ easy_install Zope2 
  | $ bin/mkzopeinstance -d inst1 -u admin:admin
  | 
  | $ cd inst1
  | $ bin/runzope

やりました。とっても簡単ですね。

`Zope-2.12.0b2 がWindowsでは壊れたrunzope.batを生成する問題`_ で書いた問題も解消されていて、zopectlも使えるようになり、Python2.4/.5/.6 で動作します。すばらしい！ Awesome!

.. _`アナウンスはこちら`: http://mail.zope.org/pipermail/zope-dev/2009-August/037373.html
.. _`Zope2.12はPyPIにも登録されている`: http://pypi.python.org/pypi/Zope2
.. _`Zope-2.12.0b2 がWindowsでは壊れたrunzope.batを生成する問題`: http://www.freia.jp/taka/blog/638


:extend type: text/html
:extend:


:comments:
:comment id: 2009-10-02.8594846045
:title: virtualenv の activate
:author: しみずかわ
:date: 2009-10-02 10:44:24
:email: 
:url: 
:body:
$ bin/activate

の部分はbash系の場合

$ source bin/activate

にする必要があります。
Windowsでnyacus使ってる場合は直実行でもsourceでもだめです。残念。
%%%%%%%%%

:id: 665
:date: 2009-08-08 00:17:21
:title: DeliveranceがWindows上で正しく動作しない
:categories: ['python']
:body type: text/x-rst
:body:
`Zope Essentials 7 で Deliverance の紹介を聞いてきた`_ に関連して。

Deliveranceの紹介を聞きながら自分の環境で動かそうとしてたんだけど、どうにも動かなくて色々調べてみたらそもそも起動時に設定ファイルを読んでくれてなかった。で、さらに調べたらWindowsで再現するファイルパス変換のバグがあったので、超つたない英語で報告してみた、というかDocTest的にインタラクティブシェルの内容と修正パッチを貼っておいたので、分かってくれるんじゃないかな－。

 報告 -> http://projects.openplans.org/deliverance/ticket/13


Windowsなんかで開発しなければいいのに、という声が聞こえてくる気がする。

.. _`Zope Essentials 7 で Deliverance の紹介を聞いてきた`: http://www.freia.jp/taka/blog/663


:extend type: text/html
:extend:
%%%%%%%%%

:id: 666
:date: 2009-08-08 16:45:24
:title: buildoutで開発 4: mod_wsgiからegg指定でアプリ起動する
:categories: ['Event', 'Zope', 'python']
:body type: text/x-rst
:body:
`buildoutで開発1: WSGIアプリをeggで作る`_ では、以下のようにwsgiappパッケージの中のstartup.pyを直接指定して起動していましたが、もっと取り回しやすくします。（今回はbuildout出てきません）

httpd-wsgi.conf::

  LoadModule wsgi_module modules/mod_wsgi.so
  WSGIPythonPath c:/project/buildout/env1/lib
  WSGIPythonEggs c:/project/buildout/env1/wsgiapp
  WSGIScriptAlias /test c:/project/buildout/env1/wsgiapp/wsgiapp/startup.py

上記を以下のように書けるようにします（違うのは最後の行だけ）。

httpd-wsgi.conf::

  LoadModule wsgi_module modules/mod_wsgi.so
  WSGIPythonPath c:/project/buildout/env1/lib
  WSGIPythonEggs c:/project/buildout/env1/wsgiapp
  WSGIScriptAlias /test c:/wsgi.py

このwsgi.pyはどこにあってもOK。中身は以下のようにpasteの仕組みを使っています。

wsgi.py:

.. code-block:: Python

    import os
    from paste.deploy import loadapp

    ini = os.path.join(os.path.dirname(__file__), 'wsgi.ini')
    application = loadapp('config:%s' % ini)


wsgi.ini はwsgi.pyと同じ所に置いてください。別の所に起きたければini変数においたパスを入れてください。
こう書くことで、実際にapplicationに格納される関数は、wsgi.iniの[server:main]に記載されているものになるので、このラッパー(wsgi.py)があればpasterで起動するときもmod_wsgiで動かすときも、同じエントリーポイントが使用されます。

これで、pasterコマンドでテストしてるときと、mod_wsgiから呼び出されるときとでほぼ同じ挙動になるはず。あと、wsgiappがegg化されていて、eggファイル名にバージョン番号やpy24とかpy25とか付いていても大丈夫。


mod_wsgiで使えるディレクティブは
`ConfigurationDirectives - modwsgi - The mod_wsgi configuration directives. - Project Hosting on Google Code`_
を参照して設定する。


ということで改めて新しい環境にインストールから。
-------------------------------------------------

.. topic:: virtualenv & install
  :class: dos

  | > cd c:/project/buildout
  | > virtualenv env3
  | > cd env3
  | > bin/activate
  | > easy_install http://localhost:8080/repos/wsgiapp/trunk
  | > easy_install PasteDeploy


iniとpyファイルをenv3ディレクトリ直下に作る.

wsgi.ini::

  [app:main]
  use = egg:wsgiapp
  
  [server:main]
  use = egg:Paste#http
  host = 127.0.0.1
  port = 8180


wsgi.py:

.. code-block:: Python

    import os
    from paste.deploy import loadapp

    ini = os.path.join(os.path.dirname(__file__), 'wsgi.ini')
    application = loadapp('config:%s' % ini)


httpd-wsgi.conf(env1->env3 に注意)::

    LoadModule wsgi_module modules/mod_wsgi.so
    WSGIPythonPath c:/project/buildout/env3/lib;c:/project/buildout/env3/lib/site-packages
    WSGIScriptAlias /test c:/project/buildout/env3/wsgi.py

    <Directory c:/project/buildout/env3/>
        Order allow,deny
        Allow from all
    </Directory>


動いた！
動いたけど、WSGIPythonPathの指定にsite-packagesも指定するなんて事かかずに、
WSGIPythonHomeを定義したい。
でもWindowsのmod_wsgiではWSGIPythonHomeを指定するとApacheが「そんなディレクティブないよ」とエラーになる！なんで？

とりあえずLinuxの人はWSGIPythonHomeを使いましょう。

なお、mod_wsgiで使えるディレクティブは
`ConfigurationDirectives - modwsgi - The mod_wsgi configuration directives. - Project Hosting on Google Code`_
を参照して設定する。


次は
-------

* easy_install PasteDeploy せずにwsgiappインストールだけですむようにする
* wsgi.ini と wsgi.py が自動的に作られるようにする（ドコに？）


.. _`ConfigurationDirectives - modwsgi - The mod_wsgi configuration directives. - Project Hosting on Google Code`: http://code.google.com/p/modwsgi/wiki/ConfigurationDirectives#WSGIScriptReloading

.. _`buildoutで開発1: WSGIアプリをeggで作る`: http://www.freia.jp/taka/blog/659


:extend type: text/html
:extend:
%%%%%%%%%

:id: 667
:date: 2009-08-09 19:20:47
:title: buildoutで開発5: ファイル構成の整理とpaster-template対応
:categories: ['python', 'Programming', 'web']
:body type: text/x-rst
:body:
`buildoutで開発4: mod_wsgiからegg指定でアプリ起動する`_ 、というところまで開発してくると、開発に使っていたディレクトリの直下が、buildoutで自動生成されるDIRや、egg-infoなどでごちゃごちゃしてきたので、整理する。

ファイル・ディレクトリの再配置
---------------------------------

現状のファイル構成(コミット分のみ)::

  c:\Project\buildout\env1\
   +-- wsgiapp
       +-- bootstrap.py
       +-- buildout.cfg
       +-- setup.cfg
       +-- setup.py
       +-- wsgi.ini
       +-- wsgiapp/
           +-- __init__.py
           +-- scraper.py
           +-- startup.py
           +-- tests.py


これを以下のようにしたい。

新しいファイル構成(コミット分のみ)::

  c:\Project\buildout\env1\
   +-- wsgiapp
       +-- bootstrap.py
       +-- buildout.cfg
       +-- setup.cfg
       +-- setup.py
       +-- src/
           +-- wsgi.ini
           +-- wsgiapp/
               +-- __init__.py
               +-- scraper.py
               +-- startup.py
               +-- tests.py


`buildoutで開発4: mod_wsgiからegg指定でアプリ起動する`_ でインストールして使った部分は上記のsrcディレクトリに移動した部分だけなので、実際に配布するものだけを切り分けた感じ。実際に配布するもの、というのは ``python setup.py bdist_egg`` で作られるeggの中身に相当する。

ソースコードの配置に合わせてsetup.pyを書き換える。

setup.py(diff差分):

.. code-block:: Python

  @@ -16,3 +16,4 @@
         license='ZPL',
  -      packages=find_packages(exclude=['ez_setup', 'examples', 'tests']),
  +      packages=find_packages('src'),
  +      package_dir={'': 'src'},
         include_package_data=True,


packagesの検索位置をsrcディレクトリにして、src以下には配布に必要なものしか置かないことにするので、find_packages()のexclude指定は不要になった。また、distutilsにパッケージ位置を教えるためpackage_dirの指定も追加。（find_packages()とpackage_dirについて、詳しくは `[Python] setuptools - SumiTomohikoの日記 (2007-06-22)`_ または原文 `Building and Distributing Packages with setuptools`_ を参照）

eggを作成して中身を確認。

.. topic:: bdist_egg
  :class: dos

  | > python setup.py bdist_egg
  | > ls dist
  | wsgiapp-0.1dev_r10-py2.4.egg

distディレクトリに wsgiapp-0.1dev_r10-py2.4.egg が出来ている。拡張子eggのファイルは実はzipファイルなので、拡張子をzipに変える等で中身を見ることが出来る。中身に問題がなければOK。


wsgi.ini, wsgi.py をPasteで作成する
------------------------------------

既にコミットしているwsgi.iniやwsgi.pyを配布物に含めたい。含めたいけど、 `前回(buildoutで開発4)`_ のようにeasy_installでパッケージとしてインストールする事を考えると、iniのような設定ファイルをwsgiappのパッケージ本体のフォルダに入れて配布するのは微妙。

今回はpasterコマンドで設定ファイルを作れるようにしてみる。参照: `Paste Script: Development &mdash; Paste Script v1.7 documentation`_

まず、setup.pyにtemplate対応を書く。

setup.py(diff差分):

.. code-block:: Python

  @@ -20,9 +20,14 @@
         zip_safe=False,
         install_requires=[
             'BeautifulSoup',
  +          'PasteDeploy',
  +          'PasteScript',
         ],
         entry_points="""
         [paste.app_factory]
         main = wsgiapp.startup:application_factory
  +
  +      [paste.paster_create_template]
  +      wsgiapp_ini = wsgiapp.paster_templates:WSGIAppTemplate
         """,
         )


まずはinstall_requiresを更新。 `前回(buildoutで開発4)`_ で手動で入れたPasteDeployと、今回template生成に使用することになるPasteScriptを追加する。

次にpaste用のtemplate登録コマンドをentry_pointsに追加する。 ``wsgiapp_ini`` はテンプレート名で、 ``wsgiapp.paster_templates:WSGIAppTemplate`` は今から作成するパッケージ名。

テンプレート作成方法を実装するプログラム src/wsgiapp/paster_templates.py を以下のように作成する。

src/wsgiapp/paster_templates.py:

.. code-block:: Python

    from paste.script.templates import Template, var
    
    class WSGIAppTemplate(Template):
        summary = 'Template for creating a deploy setting files (include wsgi.ini).'
        _template_dir = 'paster-template'
        vars = [
            var('host', 'The host to serve on', '127.0.0.1'),
            var('port', 'The port to serve on', '8080'),
        ]


最後に、上記で ``_template_dir`` に指定したディレクトリを作成し、テンプレートファイルを追加する。ということで、src/wsgiapp/paster-templateディレクトリにwsgi.ini_tmplとwsgi.pyを置いた。ここで、wsgi.iniの後ろに ``_tmpl`` と付けているが、こうすると上記のプログラムで定義した変数(host, port)で文字列を置き換えて、ファイルを配置してくれる。

wsgi.ini_tmpl::

    [app:main]
    use = egg:wsgiapp
    
    [server:main]
    use = egg:Paste#http
    host = ${host}
    port = ${port}


最後に動作確認。

.. topic:: paster create
  :class: dos

  | > cd c:\Project\buildout\env1\wsgiapp
  | > buildout
  | ...
  |
  | > cd /tmp
  | > paster create --list-templates
  | Available templates:
  |   basic_package:  A basic setuptools-enabled package
  |   paste_deploy:   A web application deployed through paste.deploy
  |   wsgiapp_ini:    Template for creating a deploy setting files (include wsgi.ini).
  |
  | > paster create -t wsgiapp_ini deploy
  | Selected and implied templates:
  |   wsgiapp#wsgiapp_ini  Template for creating a deploy setting files (include wsgi.ini).
  | 
  | Variables:
  |   egg:      deploy
  |   package:  deploy
  |   project:  deploy
  | Enter host (The host to serve on) ['127.0.0.1']:
  | Enter port (The port to serve on) ['8080']: 8180
  | Creating template wsgiapp_ini
  | Creating directory .\deploy
  |   Copying wsgi.ini_tmpl to .\deploy\wsgi.ini
  |   Copying wsgi.py to .\deploy\wsgi.py


これでdeployというディレクトリが出来ていて、中にwsgi.iniとwsgi.pyがあればOK。今までのように起動もOKだし、mod_wsgiからの起動スクリプトにも指定可能になった。

.. topic:: paster serve
  :class: dos

  | > paster serve deploy/wsgi.ini
  | Starting server in PID 9140.
  | serving on http://127.0.0.1:8180



paster-template をeggに含める
---------------------------------

ところで、今の状態で ``python setup.py bdist_egg`` しても、pythonパッケージとして認識されないpaster-templateディレクトリはeggに含まれない。これが含まれるようにするため、setup.pyを以下のように修正する。

.. code-block:: Python

  @@ -18,2 +18,3 @@
         package_dir={'': 'src'},
  +      package_data = {'': ['paster-template/*.*']},
         include_package_data=True,


これでeggにpaster-template以下も含まれるようになった。他にも.txtとか.gifとか含めたかったら、package_dataの[]部分に追加すればよい。

（じゃあinclude_package_data=Trueって何なの？ディレクトリが増えたらsetup.pyを書き換えなきゃいけないの？と、疑問は残る...）


まとめ
--------

最終的なファイル構成(コミット分のみ)::

  c:\Project\buildout\env1\
   +-- wsgiapp
       +-- bootstrap.py
       +-- buildout.cfg
       +-- setup.cfg
       +-- setup.py
       +-- src/
           +-- wsgiapp/
               +-- __init__.py
               +-- paster_template.py
               +-- scraper.py
               +-- startup.py
               +-- tests.py
               +-- paster-template
                   +-- wsgi.ini_tmpl
                   +-- wsgi.py


そういえば今までソースコードを付けてなかった。添付します。


.. _`eggの作り方が分からない`: http://www.freia.jp/taka/blog/655
.. _`buildoutで開発1: WSGIアプリをeggで作る`: http://www.freia.jp/taka/blog/659
.. _`buildoutで開発2: buildoutで環境を整える`: http://www.freia.jp/taka/blog/660
.. _`buildoutで開発4: mod_wsgiからegg指定でアプリ起動する`: http://www.freia.jp/taka/blog/666
.. _`前回(buildoutで開発4)`: http://www.freia.jp/taka/blog/666

.. _`zc.buildoutを使ったプロジェクト管理`: http://nagosui.org/Nagosui/Docs/tutorial/managing-projects-with-zcbuildout/tutorial-all-pages
.. _`Managing projects with Buildout`: http://plone.org/documentation/tutorial/buildout/tutorial-all-pages
.. _`Using z3c packages,...`: http://www.ibiblio.org/paulcarduner/z3ctutorial/introduction.html
.. _`Zope 3の入門にはz3cのチュートリアルがおすすめ`: http://blog.livedoor.jp/matssaku/archives/50500810.html

.. _`pypi`: http://pypi.python.org/simple/
.. _`http://svn.zope.org/repos/main/`: http://svn.zope.org/repos/main/
.. _`zc.buildout`: http://pypi.python.org/pypi/zc.buildout
.. _`zc.recipe.egg`: http://pypi.python.org/pypi/zc.recipe.egg
.. _`zc.recipe.testrunner`: http://pypi.python.org/pypi/zc.recipe.testrunner
.. _`z3c.recipe.egg`: http://pypi.python.org/pypi/z3c.recipe.egg
.. _`Zope 3 Package Guide`: http://wiki.zope.org/zope3/Zope3PackageGuide
.. _`mr.developer`: http://pypi.python.org/pypi/mr.developer
.. _`mod_wsgiはGoogleCode`: http://code.google.com/p/modwsgi/

.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-09)`: http://d.hatena.ne.jp/SumiTomohiko/20070609/1181406701
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-22)`: http://d.hatena.ne.jp/SumiTomohiko/20070622/1182537643
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-23)`: http://d.hatena.ne.jp/SumiTomohiko/20070623/1182602060
.. _`[Python] setuptools - SumiTomohikoの日記 (2007-06-24)`: http://d.hatena.ne.jp/SumiTomohiko/20070624/1182665330

.. _`Making your package available for EasyInstall`: http://peak.telecommunity.com/DevCenter/setuptools#making-your-package-available-for-easyinstall
.. _`Building and Distributing Packages with setuptools`: http://peak.telecommunity.com/DevCenter/setuptools
.. _`Paste Script: Development &mdash; Paste Script v1.7 documentation`: http://pythonpaste.org/script/developer.html#templates

.. _`how to run your own private PyPI (Cheeseshop) server << Fetchez le Python`: http://tarekziade.wordpress.com/2008/03/20/how-to-run-your-own-private-pypi-cheeseshop-server/
.. _`EggBasket`: http://www.chrisarndt.de/projects/eggbasket/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 668
:date: 2009-09-05 15:19:55
:title: buildoutで開発 番外編2: buildoutでDeliverance環境を作る
:categories: ['python']
:body type: text/x-rst
:body:
`Zope/Plone勉強会3`_ でDeliverance環境を作った手順をまとめてみました。
とりあえず環境を作りたい！という人向け。

ちなみにDeliveranceについては以下を参照ください。

- `Deliveranceとは - CMSコミュニケーションズ[Zope/Plone]`_
- `Getting All Your Web Apps To Wear The Company Brand (JP)`_ (日本語)
- `Deliverance v0.3 documentation`_

環境を作る
------------

とりあえずVirtualEnv環境を作ります。PythonとVirtualEnvは入っている前提で。

.. topic:: virtualenv & install
  :class: dos

  | > cd c:/project/buildout
  | > virtualenv deliv
  | > cd deliv
  | > bin/activate
  | > easy_install zc.buildout
  | > mkdir deliv1
  | > cd deliv1



deliv1フォルダにbuildout.cfgを書きます::

    [buildout]
    parts = deliverance

    # mr.developer
    extensions = mr.developer
    sources = sources
    auto-checkout = deliverance

    [deliverance]
    recipe = zc.recipe.egg
    eggs =
        deliverance
        PasteScript
        PasteDeploy

    [sources]
    deliverance = svn http://codespeak.net/svn/z3/deliverance/trunk


buildoutを実行します。

.. topic:: buildout
    :class: dos

    | > buildout
    | ...
    | Installing deliverance.
    | Generated script '..deliv1\\bin\\deliverance-proxy'.
    | Generated script '..deliv1\\bin\\deliverance-speed'.
    | Generated script '..deliv1\\bin\\deliverance-static'.
    | Generated script '..deliv1\\bin\\deliverance-handtransform'.
    | Generated script '..deliv1\\bin\\deliverance-tests'.
    | Generated script '..deliv1\\bin\\paster'.


Deliveranceの設定ファイル等をPasterで自動生成します。

.. topic:: paster crate --list-templates
    :class: dos

    | > bin/paster.exe create --list-templates
    | Available templates:
    |   basic_package:      A basic setuptools-enabled package
    |   deliverance:        Basic template for a deliverance-proxy setup
    |   deliverance_plone:  Plone-specific template for deliverance-proxy
    |   paste_deploy:       A web application deployed through paste.deploy

.. topic:: paster create -t deliverance
    :class: dos

    | > bin/paster.exe create -t deliverance
    | Selected and implied templates:
    |   deliverance#deliverance  Basic template for a deliverance-proxy setup
    |
    | Enter project name: DelivTest
    | Variables:
    |   egg:      DelivTest
    |   package:  delivtest
    |   project:  DelivTest
    | Enter host (The host/port to serve on) ['localhost:8000']:
    | Enter proxy_url (The main site to connect/proxy to) ['http://localhost:8080']:
    | Enter proxy_rewrite_links (Rewrite links from sub_host?) ['n']:
    | Enter password (The password for the deliverance admin console) ['']: admin
    | Enter theme_url (A URL to pull the initial theme from (optional)) ['']: theme
    | Creating template deliverance
    | Creating directory .\\DelivTest
    | ...


できました。現時点のファイル構成::

  c:\\Project\\buildout\\deliv\
    +--bin
    |  +-- deliverance-handtransform-script.py
    |  +-- deliverance-handtransform.exe
    |  +-- deliverance-proxy-script.py
    |  +-- deliverance-proxy.exe
    |  +-- deliverance-speed-script.py
    |  +-- deliverance-speed.exe
    |  +-- deliverance-static-script.py
    |  +-- deliverance-static.exe
    |  +-- deliverance-tests-script.py
    |  +-- deliverance-tests.exe
    |  +-- develop-script.py
    |  +-- develop.exe
    |  +-- paster-script.py
    |  +-- paster.exe
    |
    +--DelivTest
    |  +--etc
    |  |  +-- deliv-users.htpasswd
    |  |  +-- deliverance.xml
    |  |  +-- supervisor.d
    |  |  +-- supervisord.conf
    |  +--logs
    |  +--theme
    |  |  +-- style.css
    |  |  +-- theme.html
    |  +--var
    |
    +--develop-eggs
    +--parts
    +--src
        +--deliverance
            + deliveranceのソースコード


**【注意】ここで、Windowsの人はDeliveranceの不具合修正が必要かも.** `ここからパッチを取得してください`_


Deliveranceを設定する
-----------------------

Deliveranceのコンフィグファイル ``DelivTest/etc/deliverance.xml``
をちょっと書き換えます。

1. htpasswd形式のファイルがめんどくさいので、管理画面のID/PWを直接指定します
2. proxy先をgoogleにしてみます
3. rule設定として、styleを全部削除してみます

deliverance.xml::

  <ruleset>
    <server-settings>
      <server>localhost:8000</server>
      <execute-pyref>true</execute-pyref>
      <dev-allow>127.0.0.1</dev-allow>
      <dev-user username="admin" password="admin" />
    </server-settings>
  
    <proxy path="/_theme">
      <dest href="{here}/../theme" />
    </proxy>
  
    <proxy path="/">
      <dest href="http://www.google.co.jp" />
    </proxy>
  
    <theme href="/_theme/theme.html" />
  
    <rule>
      <drop content="//head/style" />
      <replace content="children:body" theme="children:#content" nocontent="abort" />
    </rule>
  </ruleset>


実行
------

起動します。

.. topic:: deliverance-proxy.exe etc/deliverance.xml
    :class: dos

    | > pwd
    | c:\Project\buildout\deliv\deliv1\DelivTest
    |
    | > ../bin/deliverance-proxy.exe etc/deliverance.xml
    | To see logging, visit http://localhost:8000/.deliverance/login
    |     after login go to http://localhost:8000/?deliv_log
    | serving on http://localhost:8000


ブラウザで ``http://localhost:8000/`` にアクセスすると、
へんなGoogleの画面になるはず。

あとはtheme.htmlの書き方とか、ruleの書き方を勉強してカスタマイズするべし。

- `Deliverance v0.3 documentation`_
- `Deliverance Configuration`_

.. _`Deliverance v0.3 documentation`: http://deliverance.openplans.org/index.html
.. _`Deliverance Configuration`: http://deliverance.openplans.org/configuration.html
.. _`Zope/Plone勉強会3`: http://zope.jp/events/zope-plone-sprint-tokyo-3/
.. _`Deliveranceとは - CMSコミュニケーションズ[Zope/Plone]`: http://www.cmscom.jp/blog/232
.. _`Getting All Your Web Apps To Wear The Company Brand (JP)`: http://www.slideshare.net/knappt/getting-all-your-web-apps-to-wear-the-company-brand-jp
.. _`ここからパッチを取得してください`: https://projects.openplans.org/deliverance/ticket/13 


:extend type: text/html
:extend:
%%%%%%%%%

:id: 669
:date: 2009-09-05 17:47:22
:title: DeliveranceでOSWDのデザインをTwitter.comに適用してみた
:categories: ['web']
:body type: text/x-rst
:body:
`Zope/Plone勉強会3`_ でDeliveranceを使ってデザイン適用をちょっと練習してみた。

デザインは `Open Source Web Design`_ から取得した `SilverGlow`_ 。適用サイトは今回はTwitterにしてみました。
ルールファイルとなるdeliverance.xmlに書いたルール部分は6行です。

deliverance.xml::

  <ruleset>
  
    <server-settings>
      <server>localhost:8000</server>
      <execute-pyref>true</execute-pyref>
      <dev-allow>127.0.0.1</dev-allow>
      <dev-user username="admin" password="admin" />
    </server-settings>
  
    <proxy path="/_theme">
      <dest href="{here}/../theme" />
    </proxy>
  
    <proxy path="/" >
      <response rewrite-links="1" />
      <dest href="http://twitter.com" />
    </proxy>
  
    <theme href="/_theme/theme.html" />
  
    <rule>
      <append content="ul.about" theme="children:#about" />
      <append content="div.stats" theme="children:#stats" />
      <append content="#following" theme="children:#following" />
      <replace content="div.section || div#content" theme=".right_content" />
      <append content="h2.thumb img" theme="#about h4" />
      <replace content="children:h2.thumb" theme="children:.block_right" />
    </rule>
  
  </ruleset>


あとはthemeのcss/htmlを数行書き換えて完成。1ページくらいなら簡単にできました。

DeliveranceとSphinx生成ドキュメントってとっても親和性が高い気がする。SphinxやPloneに独自Skinを適用しようとがんばるよりもDeliveranceのルールを覚える方が楽ではある。実際の運用まで考えるとまだ色々ひっかかるケドね。


- `Deliverance v0.3 documentation`_
- `Deliverance Configuration`_

.. _`Deliverance v0.3 documentation`: http://deliverance.openplans.org/index.html
.. _`Deliverance Configuration`: http://deliverance.openplans.org/configuration.html
.. _`Zope/Plone勉強会3`: http://zope.jp/events/zope-plone-sprint-tokyo-3/
.. _`Open Source Web Design`: http://www.oswd.org/
.. _`SilverGlow`: http://www.oswd.org/design/preview/id/3194


:extend type: text/html
:extend:
%%%%%%%%%

:id: 670
:date: 2009-09-14 02:06:59
:title: Railsのbefore_filterっぽい仕組みをPythonのデコレータで実装
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
以前Railsで作った某アプリをPythonに移植中です。出来るだけPythonの流儀に組み直してるんですが、Railsのbefore_filterを分かりやすく組み替えるのが思いつかなかったので、Pythonで同じようなことをする仕組みを作ってみました。と言ってもzope.formlibのActionsから8割くらいコードをパクってきてます。

目的は以下のようなにコードを用意すれば、indexアクションやcreateアクションが呼ばれる前に２つの事前処理関数が実行されるようにすること。

Rubyだとこう。

.. code-block:: Ruby

  class FooController < ApplicatoinController
    before_filter :setup1, :setup2

    def index
      render ...
    end

    def create
      user = User.new(params[:user])
      user.save()
      render ...
    end

    def setup1
      ...
    end

    def setup2
      ...
    end
  end

Pythonでこうしたい。

.. code-block:: Python

  class FooController(ApplicationController):
      def index(self):
          self.render(...)

      def create(self)
          user = User(self.request.get(user))
          user.put()
          render ...
      end

      @hook('before')
      def setup1(self):
          ...

      @hook('before')
      def setup2(self):
          ...

これで、呼び出したい関数にhookデコレータでマーキング出来たので、親クラスApplicationControllerに、@hook('before')で登録した関数を呼び出すための仕組みを仕込めば完成！

ってことで、hookデコレータを実装している ``hooks.py`` のソースコード。


.. code-block:: Python

    import sys

    __all__ = ['hook', 'Hooks']

    class Hook(object):
        def __init__(self, timing, func):
            self.timing = timing
            self.func = func

        def __call__(self, *args, **kw):
            return self.func(self.inst, *args, **kw)

        def __get__(self, inst, class_=None):
            if inst is None:
                return self
            result = self.__class__.__new__(self.__class__)
            result.__dict__.update(self.__dict__)
            result.inst = inst
            return result


    class hook:
        def __init__(self, timing=None, hooks=None):
            caller_locals = sys._getframe(1).f_locals
            if hooks is None:
                hooks = caller_locals.get('hooks')
            if hooks is None:
                hooks = caller_locals['hooks'] = Hooks()
            self.hooks = hooks
            self.timing = timing

        def __call__(self, func):
            hook = Hook(self.timing, func)
            self.hooks.append(hook)
            return hook


    class Hooks(object):
        def __init__(self, *hooks):
            self._hooks = hooks

        def __iter__(self):
            return iter(self._hooks)

        def __len__(self):
            return len(self._hooks)

        def append(self, hook):
            self._hooks += (hook,)

        @classmethod
        def exec_hooks(klass, obj, timing=None):
            [x() for x in obj.hooks if timing in [None, x.timing]]

        # TODO need test
        def __add__(self, other):
            return self.__class__(*(self._hooks + other._hooks))

        def copy(self):
            return self.__class__(*self._hooks)

        def __get__(self, inst, class_):
            if inst is None:
                return self
            return self.__class__(*[a.__get__(inst) for a in self._hooks])



使い方、兼、テストコード。

.. code-block:: Python

    import unittest
    from hooks import hook, Hooks

    class HooksTest(unittest.TestCase):
        def test_register_hook(self):
            class Base(object):
                @hook()
                def func1(self):
                    pass
            obj = Base()
            self.assertEqual(1, len(obj.hooks))

        def test_call_func(self):
            class Base(object):
                value = 0
                @hook()
                def func1(self):
                    self.value = 1
            obj = Base()
            Hooks.exec_hooks(obj)
            self.assertEqual(1, obj.value)

        def test_hooks_does_not_inherit(self):
            class Base(object):
                value1 = 0
                @hook()
                def func1(self):
                    self.value1 = 1
            class Derive(Base):
                value2 = 0
                @hook()
                def func2(self):
                    self.value2 = 2
            obj = Derive()
            Hooks.exec_hooks(obj)
            self.assertEqual(0, obj.value1) # value1 was inherited, but not hooked
            self.assertEqual(2, obj.value2)

        def test_hooks_can_inherit(self):
            class Base(object):
                value1 = 0
                @hook()
                def func1(self):
                    self.value1 = 1
            class Derive(Base):
                hooks = Base.hooks.copy()
                value2 = 0
                @hook()
                def func2(self):
                    self.value2 = 2
            obj = Derive()
            Hooks.exec_hooks(obj)
            self.assertEqual(1, obj.value1)
            self.assertEqual(2, obj.value2)

            obj = Base()
            Hooks.exec_hooks(obj)
            self.assertEqual(1, obj.value1)
            self.assert_(not hasattr(obj, 'value2'))


        def test_inherited_brother_hooks_must_not_pollution(self):
            class Base(object):
                value1 = 0
                @hook()
                def func1(self):
                    self.value1 = 1
            class DeriveA(Base):
                value2 = 0
                @hook()
                def func2(self):
                    self.value2 = 2
            class DeriveB(Base):
                value3 = 0
                @hook()
                def func3(self):
                    self.value3 = 3
        
            obj = Base()
            Hooks.exec_hooks(obj)
            self.assertEqual(1, obj.value1)
            self.assert_(not hasattr(obj, 'value2'))
            self.assert_(not hasattr(obj, 'value3'))

            obj = DeriveA()
            Hooks.exec_hooks(obj)
            self.assertEqual(0, obj.value1) # value1 was inherited, but not hooked
            self.assertEqual(2, obj.value2)
            self.assert_(not hasattr(obj, 'value3'))

            obj = DeriveB()
            Hooks.exec_hooks(obj)
            self.assertEqual(0, obj.value1) # value1 was inherited, but not hooked
            self.assert_(not hasattr(obj, 'value2'))
            self.assertEqual(3, obj.value3)

        def test_inherit_hooks_must_not_pollution(self):
            class Base(object):
                value1 = 0
                @hook()
                def func1(self):
                    self.value1 = 1
            class DeriveA(Base):
                hooks = Base.hooks.copy()
                value2 = 0
                @hook()
                def func2(self):
                    self.value2 = 2
            class DeriveB(Base):
                value3 = 0
                @hook()
                def func3(self):
                    self.value3 = 3
        
            obj = DeriveB()
            Hooks.exec_hooks(obj)
            self.assertEqual(0, obj.value1) # value1 was inherited, but not hooked
            self.assertEqual(3, obj.value3)
            self.assert_(not hasattr(obj, 'value2'))

        def test_register_named_hooks(self):
            class Base(object):
                value1 = 0
                value2 = 0
                value3 = 0
                @hook()
                def func1(self):
                    self.value1 = 1
                @hook('foo')
                def func2(self):
                    self.value2 = 2
                @hook('bar')
                def func3(self):
                    self.value3 = 3
        
            obj = Base()
            Hooks.exec_hooks(obj)
            self.assertEqual(1, obj.value1)
            self.assertEqual(2, obj.value2)
            self.assertEqual(3, obj.value3)

            obj = Base()
            Hooks.exec_hooks(obj, 'foo')
            self.assertEqual(0, obj.value1)
            self.assertEqual(2, obj.value2)
            self.assertEqual(0, obj.value3)

            obj = Base()
            Hooks.exec_hooks(obj, 'bar')
            self.assertEqual(0, obj.value1)
            self.assertEqual(0, obj.value2)
            self.assertEqual(3, obj.value3)

            obj = Base()
            Hooks.exec_hooks(obj, 'baz')
            self.assertEqual(0, obj.value1)
            self.assertEqual(0, obj.value2)
            self.assertEqual(0, obj.value3)


    def test_suite():
        return unittest.TestSuite((
            TestSuite(HooksTest),
        ))

    if __name__ == '__main__':
        unittest.main()

``@hook`` デコレータを使うと、使ったクラスのクラス変数に勝手にhooksを追加します。あしからず。

今回、このコードを理解するために、frameと__get__の仕組みを勉強しました。先人のコード(今回はzope.formlib)は勉強になるね。


:extend type: text/html
:extend:
%%%%%%%%%

:id: 671
:date: 2009-09-22 00:08:08
:title: PILで画像をタイル表示しEXIFの日本語タイトルを埋め込む by 串かつ専門店 でめ金
:categories: ['Event', 'food', 'python']
:body type: text/x-rst
:body:
色々詰め込んだら意味が分からないタイトルになりましたが、 http://atnd.org/events/1468 の 唐揚げの会 #1 に参加して、串かつを山のように食べてきたのですが、それをそのままBlogに載せてもつまらないので、そのときの写真をタイル状に並べて1枚の画像にしつつ、各画像のEXIFのタイトルに設定してある日本語文字列を各画像に埋め込む、というPythonスクリプトをビールを飲みながら書いてみようというエントリです。

用意するもの

* ビール（ウルケル、セントセバスチャンダーク、ベルビュークリーク）
* `串かつ専門店 でめ金`_ の写真多数
* でめ金のご予算 7500円くらい
* Python 2.4以降
* PIL (Python Imaging Library) 1.6
* TrueType Font (IPA-Fontとか,MSゴシックとか)
* EXIFの読み出し方の参考: `Reading out EXIF data via Python`_
* PILで日本語文字列をprintする参考: `PILでTrueType日本語フォントを使う`_
* ImagePack.py (以下のコード)


.. code-block:: Python

    import os,sys,math
    from PIL import Image, ImageDraw, ImageFont
    font = ImageFont.truetype('c:/windows/fonts/msmincho.ttf', 11)

    WIDTH = 640
    HEIGHT = 480

    def imaged_text(text, fontfile, fontsize, color, bgcolor=None, scale_bias=4):
        font = ImageFont.truetype(fontfile, fontsize * scale_bias)
        image = Image.new('RGBA', (1, 1))
        draw = ImageDraw.Draw(image)
        w,h = draw.textsize(text, font=font)
        del draw
        kw = {}
        if bgcolor:
            kw['color'] = bgcolor
        image = Image.new('RGBA', (w, h), **kw)
        draw = ImageDraw.Draw(image)
        draw.text((0, 0), text, font=font, fill=color)
        del draw
        return image.resize((w / scale_bias, h / scale_bias), Image.ANTIALIAS)

    def draw_text_to(target, position, text, fontfile, fontsize, color, bgcolor):
        image = imaged_text(text, fontfile, fontsize, color, bgcolor)
        target.paste(image , position, image)

    def guess_charset(data):
        f = lambda d, enc: d.decode(enc) and enc

        try: return f(data, 'utf-8')
        except: pass
        try: return f(data, 'shift-jis')
        except: pass
        try: return f(data, 'euc-jp')
        except: pass
        try: return f(data, 'iso2022-jp')
        except: pass
        return None

    def safe_decode(data):
        charset = guess_charset(data)
        if charset:
            return data.decode(charset,'replace')
        return data

    def get_files(target_path):
        files = os.listdir(target_path)
        filtered_files = []
        for f in files:
            try:
                img = Image.open(os.path.join(target_path, f))
                del img
                filtered_files.append(f)
            except:
                pass
        return filtered_files


    def main(target_path='.', width=640, cols=5):
        files = get_files(target_path)
        rows = int(math.ceil(1.0 * len(files) / cols))
        height = int(math.ceil((1.0 * HEIGHT / WIDTH) * width / cols * rows))
        w = width / cols # unit
        h = height / rows # unit
        x, y = 0, 0 # paste coord
        print '%dx%d (%d,%d)' % (width,height,cols,rows)
        canvas = Image.new('RGB',(width, height))
        for f in files:
            fpath = os.path.join(target_path, f)
            img = Image.open(fpath)
            r = img.size[0] / w # scale rate
            rh = img.size[1] / r # resize height
            img2 = img.resize((w,rh))

            # draw text
            exif = img._getexif()
            text = ''
            if exif:
                text = exif.get(270, f) # EXIF title
            if not text:
                text = f # filename
            text = safe_decode(text)
            draw_text_to(img2, (5, 5), text, 'msgothic.ttc', 10, '#FFF', (0,0,0))
            # paste to canvas
            canvas.paste(img2, (w*x,h*y))

            #print f, x, y, w*x, h*y
            #sys.stdout.write('.')

            x += 1
            if (x/cols) >= 1:
                x = 0
                y += 1

        print ''
        #canvas.show()
        canvas.save('packed.jpg', 'JPEG')


    if __name__ == '__main__':
        if len(sys.argv) >= 2:
            path = sys.argv[1]
        else:
            path = os.getcwd()

        if len(sys.argv) >= 3:
            width = int(sys.argv[2])
        else:
            width = 640

        if len(sys.argv) >= 4:
            cols = int(sys.argv[3])
        else:
            cols = 5

        main(path, width, cols)


ビール飲みながら書いたので、動きゃいいや的なコードになってます。いちおう途中までは色々できるようには作ってたんですが...動くかどうかは知らない。いちおう仕様はこんなかんじ。

:画像収集対象Dir: カレントDir or 第一引数のパス
:対象となるファイルの種類: Image.openで開けるやつ
:保存ファイル名: カレントのpacked.jpg固定
:出力する画像の幅: 640 or 第二引数
:横の列数: 5 or 第三引数
:実行例: python ImagePack.py photos 640 7


というわけで、 `唐揚げの会 #1`_ に参加した皆さん、途中合流したV嫁様、お疲れ様でした。


.. _`唐揚げの会 #1`: http://atnd.org/events/1468
.. _`串かつ専門店 でめ金`: http://r.gnavi.co.jp/p583000/
.. _`Reading out EXIF data via Python`: http://wolfram.kriesing.de/blog/index.php/2006/reading-out-exif-data-via-python
.. _`PILでTrueType日本語フォントを使う`: http://d.hatena.ne.jp/tanakahisateru/20081008/1223450159


:extend type: text/html
:extend:
%%%%%%%%%

:id: 672
:date: 2009-09-23 18:16:17
:title: reSTで書いたページをPlone3のPresentationモードで表示する
:categories: ['Plone']
:body type: text/x-rst
:body:
reStructuredText(reST)で書いたページを、 `Plone3に標準で組み込まれているPresentationモード`_ (Plone S5)で表示するのに色々はまったので、設定のポイントメモを書いておこうと思います。

# PloneS5って何？ -> see `Plone S5 - takanory.net`_

前提
-----

実行環境

:Plone: 3.3.1
:Zope: 2.10.8
:Python: 2.4.4
:OS: Windows7 32bit


reStructuredTextの設定値

:入力エンコード: utf-8
:出力エンコード: utf-8
:言語: ja (日本語)
:ヘッダーレベル: 1

reStructuredTextの設定値については、PloneS5で使われる値の設定場所があちこちに分散していてちょっと困りました。とりあえず怪しい箇所全部を書き換える前提でやってしまうのが無難。厳密には(★)を付けてるところが必須で、後はPlone3.3.1のPloneS5では使われていないはず...です。

zope.conf
----------
関連する設定のみ抜粋::

    default-zpublisher-encoding utf-8   (★)
    locale ja
    rest-header-level 1
    rest-input-encoding utf-8
    rest-output-encoding utf-8


buildoutでやってる場合は以下のように記載してbuildoutを再実行::

    zope-conf-additional =
        locale ja
        rest-header-level 1
        rest-input-encoding utf-8
        rest-output-encoding utf-8

localeをjaに設定すると色々影響するので、設定しない方が良い気がします。必須は★だけです。


Ploneの site_properties
------------------------
Ploneインスタンスの ``portal_properties/site_properties`` の項目から関連する設定のみ抜粋::

    default_language ja
    default_charset utf-8    (★)


default_charset はZMIでしか設定出来ないっぽいので、ZMI画面から設定してください。

なお、Plone3.3.1では ``CMFPlone/properties/default/propertiestool.xml`` でデフォルトがutf-8で定義されていて、zope.confの設定とかは見ていないようです。この値がPortalTransform等で使用されるrest_to_html変換時のinput/outputのエンコーディングとなります(多分)。

そしてzope.confのrest-input-encodingとrest-output-encodingは実行時も見ていません。完全に無視されるみたいです。


Ploneの portal_transforms
---------------------------
Ploneインスタンスの ``portal_transforms/rest_to_html`` の項目から関連する項目のみ抜粋::

    Initial Header Level: 1   (★)

これもZMIで設定します。デフォルトの2という値は、 ``PortalTransforms/transforms/rest.py`` で固定値で定義されていて、zope.confとかの設定は関係ないようです。

そしてzope.confのrest-header-levelは実行時も無視されるみたいです。だめじゃん。


reStructuredText文面の書き方
-------------------------------

後はreSTで文章を書けば良い、となれば苦労が無くて良いんですが、S5が以下のように認識するので、そのように出力される書き方をしないといけません。

:ページ区切り: h1かh2で認識する。h3はだめ。
:pタグは無視される: 表示したい文面は<li>か<dl>で表現する


reSTで、h2で節を区切る書き方
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
reSTはヘッダーレベルを自動的に調整して、最上位レベルが1つになるようにします沓そして最上位レベルが複数になると自動的に全てのレベルを1段落とすようになっています。つまり、::

    ==================
    1ページ目タイトル
    ==================

    文面......

    ==================
    2ページ目タイトル
    ==================

    文面......

と書くと、両方ともレベル2扱いになってしまい、レベル1が無いHTMLが出力される訳です。しかし都合の良いことに、Ploneのページタイトルがh1なので、結果的にはh1が1つ、レベル2(h2)が複数、という真っ当な出力ができあがります。

ちなみにレベル1を1つreST的に用意すると、ページタイトルの方のh1と合わせて２つになってしまい、スライド表示がおかしくなってしまう場合があります。さらにreSTでレベル1を用意すると(S5じゃない普通の)ページで表示したときにもh1が複数になってしまうので、レベル1は書かないのが無難でしょう。

ところでレベル2がh2になるのは、 `Ploneの portal_transforms`_ で初期レベルを1に設定しているからです。これがPloneの初期値だとレベル2=h3になってしまい、S5ではページ区切りとは見なされなくなってしまいます。


まとめ：初期レベルは1に設定し、reSTではレベル2で出力されるように書く


pタグは無視される
~~~~~~~~~~~~~~~~~~~

pタグは無視されます。以下のように書くと箇条書き部分しか表示されません::

    ページタイトル
    ---------------

    このページで説明したい概要文.....

    * 箇条書き１
    * 箇条書き２

    まとめの文章.......

プレゼンテーションモードのページには、HTML的には箇条書きの前後もpタグで出力されているのですが、JavaScriptの処理で無視されているようです。s5_slides.jsをざっと眺めただけではよく分からなかったので、そういうものだと思うことにします。とりあえずスライドのタイトル以外ではul,ol,imgは使えてる感じ。


ページの設定でプレゼンテーションモードをOnにする
---------------------------------------------------

ページの、編集タブ内にある設定タブで、プレゼンテーションモードをOnにします。これをOnにすると、ページを表示したときに ``プレゼンテーションモードでも利用可能`` というリンクが表示されるようになります。


以上でプレゼンモードが使えるようになったはず。 `プレゼンテーションモードがPlone3.0から標準になった`_ ため、PloneS5をインストールしなくても使えて楽なのですが、そもそも使いこなすのが微妙に難しい気がします。みんなreSTで書かずにWYSIWYGで書いてるんでしょうか...?


参考文献
-----------

最後に参考文献です。

* `Zope/Plone勉強会#3 - int neko`_ reSTのレベル設定
* `How can I change reStructuredText header levels? - Plone CMS: Open Source Content Management`_
* `S5 での文字化け解消 - Plone で文字化けした時は - - すちゃらか社員日記`_ 多分Plone2系
* `plone で shift_jis のサイトを作る(その2) - takanory.net`_ default_charset の説明の参考に
* `Plone S5 - Plone CMS: Open Source Content Management`_ Plone S5 配布(Plone2.x用)
* `Enfold Systems: Plone S5`_ Plone S5の本家(Plone2.x用)
* `S5: A Simple Standards-Based Slide Show System`_ S5の本家meyerwebのサイト. リファレンスとか


.. _`Plone S5 - takanory.net`: http://takanory.net/plone/products/plones5
.. _`S5: A Simple Standards-Based Slide Show System`: http://meyerweb.com/eric/tools/s5/
.. _`S5 での文字化け解消 - Plone で文字化けした時は - - すちゃらか社員日記`: http://d.hatena.ne.jp/claddvd/20061127/p1
.. _`Enfold Systems: Plone S5`: http://www.enfoldsystems.com/developer/software/plones5
.. _`plone で shift_jis のサイトを作る(その2) - takanory.net`: http://takanory.net/Zope/takanory/takalog/759/
.. _`How can I change reStructuredText header levels? - Plone CMS: Open Source Content Management`: http://plone.org/documentation/faq/how-can-i-change-restructuredtext-header-levels
.. _`Zope/Plone勉強会#3 - int neko`: http://intneko.net/page/20090905
.. _`プレゼンテーションモードがPlone3.0から標準になった`: http://plone.org/products/plone/features/3.0/new/presentation-mode-for-content
.. _`Plone3に標準で組み込まれているPresentationモード`: http://plone.org/products/plone/features/3.0/new/presentation-mode-for-content
.. _`Plone S5 - Plone CMS: Open Source Content Management`: http://plone.org/products/s5


:extend type: text/html
:extend:
%%%%%%%%%

:id: 673
:date: 2009-10-01 01:45:54
:title: Plone-3.3.1をWSGIで稼働させるための設定テンプレ
:categories: ['Zope', 'python', 'Plone']
:body type: text/x-rst
:body:
Zope3はTwisted,WSGI,など複数の稼働方法を提供していますが、Zope2では基本的にZServerでの起動しかありません。以前はFastCGIでの起動も提供されていましたが現在はサポート外です。しかし Repoze_ 開発チームが提供しているパッケージを使用すればZope2をWSGI起動させることが出来ます（標準外なので自己責任になりますが）。まあZope/Ploneは起動が遅いので初回アクセス時に重いのをナントカするとか、色々新しいノウハウが必要になるわけですが、WSGIのmiddlewareを使えるようになるというメリットもあります。

Apache/mod_wsgiの下にどのような構成でZopeに繋がるのか、という話は Repoze の `Developing and Deploying`_ ページに構成図付きで詳しく載っているのでそちらを参照してください。

buildoutで環境構築
--------------------

で、plone3-wsgi環境を作るためのbuildout.cfgを書いたんですが、どうせならpasterでテンプレート生成できると便利だよね、っていうことで作ってみました。以下のコマンドで環境を構築出来ます（easy_installしたくない人はvirtualenvしてください）。あ、Pythonは2.4です。

.. topic:: Zope2-WSGI 構築手順
  :class: dos

  | > easy_install elementtree
  | > easy_install http://svn.freia.jp/open/ZopeWsgiSkel
  | > paster create -t plone3_wsgi plone3
  |
  | (色々聞かれます. ドメインを plone3.freia.jp にしてみます)
  |
  | > cd plone3
  | > python bootstrap.py
  | > bin/buildout -c buildout-devel.cfg

これで開発用の環境が出来ました。ploneのインスタンスもZope内に自動生成しています。ドメイン名は当たり前ですが、DNS設定するなりhosts設定するなりが必要です。

ということで、bin/pasterで起動してみます。ここでbinを付け忘れると ``repoze.obob.publisherが見つからない`` 的なエラーになりますので注意してください。

.. topic:: Zope2-WSGI 開発環境起動
  :class: dos

  | > bin/paster serve etc/development.ini
  | Starting server in PID 35616.
  | 2009-09-30 23:51:11 INFO paste.httpserver.ThreadPool Cannot use kill_thread_limit as ctypes/killthread is not available
  | serving on 0.0.0.0:8080 view at http://127.0.0.1:8080


起動しました（本当はもうちょっとwarningが出ます）。標準では8080ポートで開発環境は起動します。本番はWSGIなのでZope自体はportを使用しません（代わりにZEOが別のportで起動します）。8080ポートにブラウザでアクセスしてみて、正しく表示されれば成功です。
なお、etcディレクトリにapache用の設定ファイル plone3.freia.jp.conf も生成されているので、このファイルをconf.d等に置けばドメイン名でアクセスすることも出来ます。


本番環境作成
----------------

次に本番用の環境を生成します。今のbuildout設定では開発用と本番用を両立できないので、改良の余地があります。普通は両立要らないと思いますが。

.. topic:: Zope2-WSGI 本番環境構築手順
  :class: dos

  | > bin/buildout -c buildout-production.cfg

これで本番用のWSGI環境が出来ました。本番環境はコマンドでの起動ではなくApacheのmod_wsgi経由での起動になります。mod_wsgiは使える状態にしておいてください。また、Data.fsに複数のWSGIプロセスからアクセスする事になるので、ZEOサーバーを起動しておく必要があります。

.. topic:: Zope2-WSGI ZEO起動
  :class: dos

  | > bin/zeoserver start
  | . daemon process started, pid=35700

ZEOが起動しました。次にapacheの本番用の設定 etc/plone3.freia.jp.conf をapacheに反映してください。このファイルはbuildoutで本番環境を生成したときに上書きされています。微妙？ conf.dから ln -s しておけば便利かも。

あとはブラウザで設定したドメイン（今回は http://plone3.freia.jp/ ）にアクセスすればPloneサイトが表示されるはずです。


参考文献
-----------

今回のbuildout設定などは、かなりの部分を Repoze_ と、そこからリンクされていた `Revotera Voja?o: Repoze, Zope, Plone, URISpace, and Deliverance`_ の記事を参考に作成しました。


.. _Repoze: http://repoze.org/
.. _`Developing and Deploying`: http://repoze.org/devdep.html
.. _`Revotera Voja?o: Repoze, Zope, Plone, URISpace, and Deliverance`: http://feneric.blogspot.com/2009/07/repoze-zope-plone-urispace-and.html


:extend type: text/html
:extend:
%%%%%%%%%

:id: 674
:date: 2009-10-10 19:52:52
:title: 最近の清水川
:categories: ['misc']
:body type: text/x-rst
:body:
最近、難しいことばっかり書いてあって何やってるかよく分からない、と複数方面から言われたので、近況を書いてみます。

最近の自転車
------------
* Louis Garneau のオートマです。
* ここ1年で10回くらいしか乗ってないなぁ...。
* 会社まで片道20kmを数回と、近くの野川公園までを数回。
* 総走行距離1000kmを超えたのは既に一昨年の話か...。
* 9月頃に @zenich の自転車と30分くらい交換して乗ってみたり
* 手動で変速変えるのは苦手だ。

.. image:: images/20061112_tamagawa_susuki.jpg/image_thumb
  :target: images/20061112_tamagawa_susuki.jpg
  :class: lightbox

最近の旅行
-----------
* Python温泉で熱海へ(6月)
* Python温泉で熱海へ(10月)

Python温泉は技術修練の場です！

元々旅行とかあんまりしないからなー...。

最近の料理
-----------
* ラタトゥーユを大皿３つくらい作って1週間延々とそればっかり食べてた

.. image:: images/20090818_rata.jpg/image_thumb
  :target: images/20090818_rata.jpg
  :class: lightbox

* それ以来、毎日トマトを食べないと生きていけないカラダに。
* 毎日1本 やさいしぼり。
* ホームベーカリーで月に何回かパン焼いてる。焼きたてパンならバターだけで1斤いける！

.. image:: images/20090308_bakery.jpg/image_thumb
  :target: images/20090308_bakery.jpg
  :class: lightbox


ここ１年のお仕事
----------------
* Ruby on Rails を使って既存Oracleと格闘したり
* Ruby on Rails を WindowsServer, IIS, SQLServer と繋いでみたり
* Ruby on Rails を使ってアクセスログ解析して集計するツールを作ったり
* Ruby on Rails とmongrelで非同期データストリーミングしたり
* Ruby on Rails でExcelファイルを出力したり
* Zope2.6で作られたサイトの改修をしたり
* CakePHPでの開発にヘルプで入ったらPerlのCGIを渡されたり
* Selenium を使ってOpenPNEサイトのテストを書いたり

なぜかPythonが少ないな。

最近の映画
-----------
* スタートレックおもしろかった！DVDはほぼ全部(200枚以上)持ってるぜ。
* エヴァ 破 を最前列端っこで見たら、目と首が疲れた。
* サマーウォーズ を２回観に行った！花札買うかな！

.. image:: images/20090925_summerwars.jpg/image_thumb
  :target: images/20090925_summerwars.jpg
  :class: lightbox


最近のコミュ活動
-----------------
* Twitterを始めてみた。うまく使わないと仕事に影響が出るねこれは。
* Plone研究会によく顔を出している。飲み会目当て。
* `Zope/Plone勉強会`_ を毎月、土曜日にやってる。毎回成果発表が楽しみ。
* http://docs.zope.jp/ を公開した。先週土日は2日間英訳ばっかりだったなー。
* @koichiroo に誘われて `Tokyu.rb`_ に参加してきた。すき焼き食べ放題だった。

.. image:: images/20091002_tokyurb.jpg/image_thumb
  :target: images/20091002_tokyurb.jpg
  :class: lightbox

* 10月末にOSCでプレゼン予定。用意しなきゃ－。

.. _`Zope/Plone勉強会`: http://atnd.org/events/1474
.. _`Tokyu.rb`: http://qwik.jp/tokyurb/

最近のテレビ
-------------
* テレビタックル
* 本当は怖い家庭の医学
* けいおん！
* エンドレスエイト
* とらドラ, @shibukawa に勧められて！
* ターミネーター サラコナークロニクル
* スタートレック
* スタートレック
* スタートレック

.. image:: images/20091010_startrek_boxes.jpg/image_thumb
  :target: images/20091010_startrek_boxes.jpg
  :class: lightbox

その他、色々。


最近のゲーム
-------------
* デモンズソウル。初心者お断り的な難易度。
* 戦場のヴァルキュリア。2やりたいけどPSP持ってないしなあ。
* ドラクエ９。クリアしたら熱が冷めたヨ。

.. image:: images/20091010_dq9.jpg/image_thumb
  :target: images/20091010_dq9.jpg
  :class: lightbox

* メタルギアソリッド3が途中で止まってる。4はクリアした。
* うみねこのなくころに。
* トロステーション。10月末で終了のお知らせ。5000みゃいるが...。

最近理不尽に思ったこと
-----------------------
* Webに○○買った、とか書くと誰かに妬まれるから止めろと母に言われた
* Webに○○に旅行に行くとか書くと空き巣に入られるから止めろと母に言われた
* Webに個人的な事を書くとどこで誰が見てるか分からないから止めろと母に(ry
* 最近Webに難しいことばかり書いててつまらないから近況を書けと母に(ry


まー、こんなかんじ。


:extend type: text/html
:extend:


:comments:
:comment id: 2009-10-10.2084776905
:title: Re:最近の清水川
:author: hiroshi
:date: 2009-10-10 22:10:19
:email: 
:url: http://blog.yakitara.com/
:body:
「個人的な事を書くな」と「近況を書け」と矛盾している気がしますが、心配してくださる良いお母様じゃないですか。


:comments:
:comment id: 2009-10-11.5188048308
:title: Re:最近の清水川
:author: t2y
:date: 2009-10-11 22:42:02
:email: 
:url: http://d.hatena.ne.jp/t2y-1979/
:body:
私も昨日、サマーウォーズを見てきました。小学生ぐらいの頃に花札をやった記憶があるんですけど、今はもうルールを覚えてないですね。私も花札をやりたくなりました(^ ^;;

%%%%%%%%%

:id: 675
:date: 2009-10-11 00:04:25
:title: Zope2 ドキュメントを Sphinx でビルドする手順
:categories: ['Zope', 'python']
:body type: text/x-rst
:body:
先週の日曜日に http://docs.zope.jp/ を公開しましたが、このサイトは http://docs.zope.org/ のソースコードを取得して翻訳したものを Sphinx でビルドして作っています。 Sphinx は reStructuredText で書かれたドキュメントをビルドして html や pdf, chm などを出力する仕組みで、詳しくは渋川さんが翻訳してくれた `Sphinxドキュメントの日本語訳`_ や `渋日記: Pythonって何？という人のためのSphinxチュートリアル`_ を参照してください。

.. _`Sphinxドキュメントの日本語訳`: http://sphinx.shibu.jp/
.. _`渋日記: Pythonって何？という人のためのSphinxチュートリアル`: http://blog.shibu.jp/article/32098239.html


以下、 http://docs.zope.jp/zope2/ を出力するための手順です。

.. topic:: docs.zope.jp ビルド
  :class: dos

  | $ svn co http://svn.freia.jp/open/zope2docs/branches/ja/zope2docs
  | $ cd zope2docs
  | $ python bootstrap.py
  | $ bin/buildout -v
  | $ bin/sphinx-build . html

上記の手順で、既存のPython環境に手を加えずにSphinxのインストールを行い、htmlのビルドが出来ました。出来上がったhtmlファイル群はhtmlというディレクトリ以下に作成されています。上記の例ではWindowsでも動作するように書きましたが、チェックアウトするとMakefileも付いてくるので、 ``make html`` としてもOKです。

また、英語版のビルドを行う場合は、一番最初のチェックアウトするソースコードの場所を http://svn.zope.org/repos/main/zope2docs/trunk/ にすれば良いはずです(2009/10/10時点)。

Sphinxのテンプレートカスタマイズ
--------------------------------

docs.zope.jp では、ちょっとだけテンプレートをカスタマイズしていて、本家と違うところがあります。ファイル的には `layout.html`_ を追加していて、Sphinxで生成したhtmlファイルにGoogleAnalyticsのトラッカーを埋め込んだり、問い合わせ先についてのリンクを設置したりしています。こんな感じです::

    {% extends "!layout.html" %}

    {%- block rootrellink %}
    <li><a target="_blank" href="http://docs.zope.org/zope2/" title="English(Original)">English(Original)</a></li>
    {{ reldelim2 }}
    <li><a target="_blank" href="http://zope.jp/" title="日本Zopeユーザー会 - JZUG">JZUG</a></li>
    {{ reldelim2 }}
    {{ super() }}
    {%- endblock %}


    {%- block sidebarsearch %}
    {{ super() }}
    <h3>お問い合わせ</h3>
    <div>
      <p>
        日本語訳についてのご意見などは
        <a target="_blank" href="http://zope.jp/contact-info">zope.jp の連絡フォーム</a>
        からお願いします。
      </p>
    </div>
    {%- endblock %}

    {% block footer %}
    {{ super() }}
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-xxxxxxx-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
    {% endblock %}



GoogleAnalyticsの埋め込み部分については `Adding Google Analytics to Sphinx Docs | Surfing in Kansas`_ を参考にし、その他のカスタマイズについては `テンプレート - Sphinx v1.0 (hg) documentation`_ を読みながら作成しています。

.. _`Adding Google Analytics to Sphinx Docs | Surfing in Kansas`: http://ericholscher.com/blog/2009/apr/5/adding-google-analytics-sphinx-docs/

.. _`テンプレート - Sphinx v1.0 (hg) documentation`: http://sphinx.shibu.jp/templating.html

.. _`layout.html`: http://svn.freia.jp/open/zope2docs/branches/ja/zope2docs/.templates/layout.html 



:extend type: text/html
:extend:


:comments:
:comment id: 2010-09-03.0657923134
:title: Re:Zope2 ドキュメントを Sphinx でビルドする手順
:author: xiangxiang
:date: 2010-09-03 17:04:26
:email: xiangxiangputou@sina.com
:url: http://www.oxpdf.jp/ 
:body:
OX CHM PDF変換は仮プリンタを利用してCHMをPDFファイルに変換するソフトです。作成したPDFファイルはPDF1.2、PDF1.3やPDF1.4をサ ポートしCHMをPDFファイルに変換できて、任意な印刷できるファイルも変換できます。具体的に言えば、Txt、Word、Excel、 Powerpointや画像形式などです。そしてPDFファイルに作成するほかに、「Option]において画像形式（例えばPNG、JPEG、BMP、 PCX、TIFF)や言語編集形式（PS、EPS)などとしても保存できます。
安全なシステムとしてOX CHM PDF変換 フリーはパスウードをつけることができます。またフリーダウンロードをサポートします。
http://www.oxpdf.jp/chm-to-pdf-converter.html
%%%%%%%%%

:id: 676
:date: 2009-10-17 14:21:05
:title: emailモジュールの使い方サンプル #zopeplonedev
:categories: ['python']
:body type: text/x-rst
:body:
第4回 Zope/Plone開発勉強会で、emailモジュールの話になったので、実験コードを書いてみた。

.. code-block:: Python

  >>> from email.MIMEText import MIMEText
  >>> from email.Header import Header
  >>> def buildmail(charset, toaddrs, subject, message):
  ...   m_body = message.encode(charset, 'replace')
  ...   m_subject = subject
  ...   m_subject = Header(m_subject.encode(charset, 'replace'), charset)
  ...   m_from = 'foo@example.com'
  ...   m_to = ', '.join(toaddrs)
  ...   message = MIMEText(m_body, 'plain', charset)
  ...   message['Subject'] = m_subject
  ...   message['From'] = m_from
  ...   message['To'] = m_to
  ...   return message
  ...

上記の関数に渡すデータを用意。

::

  >>> text = u'にほんごにほんご'

iso-2022-jp でエンコードする例::

  >>> e = buildmail('iso-2022-jp', ['bar@example.com'], text, text)
  >>> print e.as_string()
  Content-Type: text/plain; charset="iso-2022-jp"
  MIME-Version: 1.0
  Content-Transfer-Encoding: 7bit
  Subject: =?iso-2022-jp?b?GyRCJEskWyRzJDQkSyRbJHMkNBsoQg==?=
  From: foo@example.co.jp
  To: bar@example.com
  
  $B$K$[$s$4$K$[$s$4(B

utf-8 でエンコードする例::

  >>> e = buildmail('utf-8', ['bar@example.com'], text, text)
  >>> print e.as_string()
  Content-Type: text/plain; charset="utf-8"
  MIME-Version: 1.0
  Content-Transfer-Encoding: 8bit
  Subject: =?utf-8?b?44Gr44G744KT44GU44Gr44G744KT44GU?=
  From: foo@example.co.jp
  To: bar@example.com

  にほんごにほんご

Subjectはbase64になってました。本文は指定した文字エンコードの生データですね。

ちなみに、上記コードは2006年にpython-mlに質問したときのコードです。懐かしい。
`[Python-ml-jp 3602] 2.4.3のMIMETextクラスのpayloadの持ち方 <http://www.python.jp/pipermail/python-ml-jp/2006-July/003595.html>`_


:extend type: text/html
:extend:
%%%%%%%%%

:id: 67x
:date: 2009-10-24 14:05:58
:title: (第4回)Zope/Plone勉強会参加の記録
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
* 写真サムネイル載せる

* 発表のサマリを載せる

* 飲み会ネタを載せる


:extend type: text/html
:extend:
%%%%%%%%%

:id: 677
:date: 2009-10-24 14:06:37
:title: buildoutで開発0: zc.buildout で環境を作る
:categories: ['python']
:body type: text/x-rst
:body:
.. highlights::

  buildout_ はPythonベースのビルドシステムです。パーツという単位でアプリケーションを
  作成、組み立て、配置などを行い、非Pythonベースのものも構築は可能です。

  -- http://www.buildout.org/

ということで、これまでbuildoutに関するいくつかのエントリを書いて来ましたが、そもそもbuildoutって何？ということについて書きます。

仮想環境、またはサンドボックス(SandBox)としては VirtualEnv_ が有名ですが、 buildout (正式には zc.buildout)は冒頭に書いたように、ビルドシステムと言う方が適切です。buildoutはVirtualEnvと組み合わせて使うことも出来ますが、buildout単体で使用しても、既存のPython環境を汚さずにegg類をインストールして使うことが出来ます。

はじめよう
----------

まずは仮想環境的に使う例です。bootstrap.pyというのを取ってきて、init引数を付けて実行しています。このとき使用したpythonがこれ以降使用されるpythonのインタプリタになります::

  $ mkdir testdir
  $ cd testdir
  $ wget "http://svn.zope.org/*checkout*/zc.buildout/trunk/bootstrap/bootstrap.py"
  $ python-2.6 bootstrap.py init

この時点でディレクトリ構成が以下のようになります::

  /tmp
   +-- testdir
       +-- bootstrap.py
       +-- buildout.cfg
       +-- bin/
       +-- develop-eggs/
       +-- eggs/
       +-- parts/


同じディレクトリに buildout.cfg ファイルが出来ているので以下の内容で更新します::

  [buildout]
  parts = env
  
  [env]
  recipe = zc.recipe.egg
  eggs =
      docutils  
      sphinx
      PIL
  interpreter = python

最後に環境をビルドします::

  $ bin/buildout

この時点でディレクトリ構成が以下のようになりました::

  r:/
   +-- testdir
       +-- .installed.cfg
       +-- bootstrap.py
       +-- buildout.cfg
       +-- bin
       |   +-- buildout
       |   +-- python
       |   +-- sphinx-autogen
       |   +-- sphinx-build
       |   +-- sphinx-quickstart
       +-- develop-eggs/
       +-- eggs/
       |   +-- docutils-0.6-py2.6.egg/
       |   +-- jinja2-2.2.1-py2.6.egg/
       |   +-- pil-1.1.7b1-py2.6-win32.egg/
       |   +-- Pygments-1.1.1-py2.6.egg/
       |   +-- Sphinx-0.6.3-py2.6.egg/
       |   +-- zc.buildout-1.4.1-py2.6.egg/
       |   +-- zc.recipe.egg-1.2.2-py2.6.egg/
       |   +-- setuptools-0.6c11-py2.6.egg
       +-- parts/

これでdocutils,sphinx,PILがインストールされたPyhton環境が出来ました。 ``bin/python`` を使えば、docutils,sphinx,PIL,その他これらが依存しているパッケージが使用できる環境で起動します。

ということで、 ``bin/python`` でインタプリタを起動すると以下のようになります::

  $ bin/python.exe
  
  >>> import sys
  >>> from pprint import pprint
  >>> pprint(sys.path)
  ['r:\\testdir\\eggs\\docutils-0.6-py2.6.egg',
   'r:\\testdir\\eggs\\sphinx-0.6.3-py2.6.egg',
   'r:\\testdir\\eggs\\pil-1.1.7b1-py2.6-win32.egg',
   'r:\\testdir\\eggs\\jinja2-2.2.1-py2.6.egg',
   'r:\\testdir\\eggs\\pygments-1.1.1-py2.6.egg',
   'R:\\testdir\\bin',
   'c:\\Develop\\Python26\\lib\\site-packages\\virtualenv-1.3.3-py2.6.egg',
   'c:\\Develop\\Python26\\lib\\site-packages\\setuptools-0.6c9-py2.6.egg',
   'c:\\Develop\\Python26\\lib\\site-packages\\ipython-0.10-py2.6.egg',
   'c:\\Develop\\Python26\\python26.zip',
   'c:\\Develop\\Python26\\DLLs',
   'c:\\Develop\\Python26\\lib',
   'c:\\Develop\\Python26\\lib\\plat-win',
   'c:\\Develop\\Python26\\lib\\lib-tk',
   'c:\\Develop\\Python26',
   'c:\\Develop\\Python26\\lib\\site-packages',
   'c:\\Develop\\Python26\\lib\\site-packages\\win32',
   'c:\\Develop\\Python26\\lib\\site-packages\\win32\\lib',
   'c:\\Develop\\Python26\\lib\\site-packages\\Pythonwin']
  >>>


VirtualEnvとの比較
-------------------

VirtualEnvは基本環境の複製を作って、そこにpythonインタプリタやsite-packageなどを複製します。VirtualEnvで環境を作る時に、元のsite-packagesを含めないように出来ます。buildoutでは元の環境を含めない仮想環境を作ることは(多分)出来ません。あくまで基本環境への追加という形式になります(多分)。

以下のように言いたいところですが言い過ぎ？

  buildout = VirtualEnv + easy_install + その他手作業 - 仮想環境化

自分は構築手順を覚えておくのが苦手だし、手順に従って１ステップずつ環境を作るのも面倒なタチなのでbuildoutは非常に便利だと思っています。

しかし、VirtualEnvのactivate等で環境を切り替える概念はbuildoutには無いので、その機能が欲しい場合にはVirtualEnv環境上でbuildoutを使えば良いと思います。


その他
------

buildoutは内部的にeasy_installを使用しますが、代わりに `pip` や `distribute` を使うことも出来ます。また、簡単なrecipeを作ればその他のパッケージングシステムを使うことも出来ると思います。


.. _buildout: http://www.buildout.org/
.. _VirtualEnv: http://pypi.python.org/pypi/virtualenv


:extend type: text/html
:extend:


:comments:
:comment id: 2009-10-25.3955164934
:title: Re:buildoutで開発0: zc.buildout で環境を作る
:author: okuji
:date: 2009-10-25 11:23:20
:email: 
:url: 
:body:
python -Sすれば含めないように作ることはできます。
但し、-Sは生成されるスクリプトには引き継がれないので、毎回指定しないといけなくなり、実用上とっても不便です。
ですから、virtualenvは必須だと考えておいた方が楽です。
buildoutはパッケージの追加のために別環境を作る程度には分離できるので、複数のbuildoutで同じvirtualenv環境を使い回すのは構わないです。

:comments:
:comment id: 2009-10-25.8352983829
:title: Re:buildoutで開発0: zc.buildout で環境を作る
:author: しみずかわ
:date: 2009-10-25 11:30:38
:email: 
:url: 
:body:
おお、補足ありがとうございます。-S なんてあったんですね。
結果的には、VirtualEnv使っとけ、と。VirtualEnvは色々考えなくて良くなるので楽ですよね。

%%%%%%%%%

:id: 678
:date: 2009-10-24 14:29:33
:title: ckw のテキスト貼り付けをPythonのInteractiveShellでも正しく動作するように改造してみた
:categories: ['python', 'Windows']
:body type: text/x-rst
:body:
ckw + nyacus はとても便利なんですが、ckw上でpythonのインタラクティブシェルを使用していると、右クリックでのテキスト貼り付け時に `\\r\\n` をEnterキー押下と同等では認識せずに文字コードとして\\rと\\nを貼り付けてしまいます。

例えば以下を貼り付けるとPythonのインタラクティブシェルは１行として受け取ってしまい、変なことになります。::

  def foo():
    return 'bar'

シェル(cmd.exeやnyacus)は `\\r\\n` を改行として処理してくれるのでPythonの問題のような気はしますが、このままだと不便なので、 `\\r` を受け取ったら破棄して、 `\\n` を受け取ったら ``VK_RETURN`` として処理するように改造してみました。

改造したexeを以下に置いておきます。

* http://svn.freia.jp/open/ckw/branches/ckw-0.8.10-mod2-smzkw1/bin/


:extend type: text/html
:extend:
%%%%%%%%%

:id: 679
:date: 2009-10-24 15:10:00
:title: 第6回 Python温泉 に参加中. buildbot と buildout のはなし
:categories: ['Zope', 'python', 'Plone', 'pyspa']
:body type: text/x-rst
:body:
第６回 Python温泉 に参加しています。

buildbot
---------
@aohta からbuildbotについて聞かれたので、参考文献へのリンクを張っておきます。

* http://www.freia.jp/taka/blog/549 PyDevCamp2008での発表資料
* http://sky.ap.teacup.com/shibu/28.html 渋川さんの感想
* http://svn.freia.jp/open/buildbot/docs/buildbot.html 日本語マニュアル(ちょい古い)


buildout
---------
ビルドシステムです。 @aodag と話していて、Python製のMavenだよねー、ということになった。そうかも。ということで、 Getting Start 的なブログエントリを書いてみました。

* http://www.freia.jp/taka/blog/677 buildoutで開発0: zc.buildout で環境を作る


このWebのバージョンアップ
---------------------------
現状の Plone-2.5.2-1 を Plone-3.3.1 まで上げようと１日目ずっと格闘してましたが、夜中３時に断念。どういう順番でやっても、2.x系 -> 3.x系 へのマイグレーションパスが無いというエラーに。なんでだろうなぁ。


次は...
--------
何しようかな

* buldbot環境をbuildoutで構築する
* zope2のドキュメント翻訳
* OSC2009秋の資料作る

写真
----

`Python温泉6の写真 <http://www.getdropbox.com/gallery/284189/1/2009_10_pyspa?h=6df75b>`_ はdropboxにアップロードしておきました。



:extend type: text/html
:extend:
%%%%%%%%%

:id: 680
:date: 2009-10-25 04:47:47
:title: Expert Python Programming の目次の和訳
:categories: ['python', 'pyspa']
:body type: text/x-rst
:body:
Tarek Ziadé 著の Expert Python Programming の目次を和訳しました。Pythonの初心者向けではなく、何かの言語(Python, Ruby, Perl, ...)を理解している人がPythonを取り巻く開発環境、作法などを理解するのにとても良い本だと思います。

本は以下から購入できます。PACKTのサイトからは `10章: プロジェクトの文書化`_ が丸々1章分DL出来ます。

* `PACKT <http://www.packtpub.com/expert-python-programming/book>`_
* `Amazon(米) <http://www.amazon.com/dp/184719494X/freiaweb-22/>`_
* `Amazon(日本) <http://www.amazon.co.jp/dp/184719494X/freiaweb-22/>`_

自分はPACKTで購入して、紙の本とPDFとセット購入で45$でした。PDFには注文者の住所と名前が全ページに印字されます。紙の本はシンガポールでオンデマンド印刷されて1ヶ月くらいで手元に届きました。


Tarek自身による紹介文

* `Expert Python Programming book, more details + sample chapter <http://tarekziade.wordpress.com/2008/09/24/expert-python-programming-book-more-details-sample-chapter/>`_

`目次(英語) <http://www.packtpub.com/view_popup/page/expert-python-programming-table-of-contents>`_ の内容を和訳しました。1時間ちょっとで訳したので間違い等あると思います。指摘歓迎。


エキスパートPythonプログラミング
=================================

目次
-----

* `序文`_
* `1章: 始めよう`_
* `2章: 構文ベストプラクティス - クラスの世界`_
* `3章: 構文ベストプラクティス - クラスを超えて`_
* `4章: 良い名前の選択`_
* `5章: パッケージを作る`_
* `6章: アプリケーションを作る`_
* `7章: zc.buildoutを使う`_
* `8章: コードの管理`_
* `9章: ライフサイクルの管理`_
* `10章: プロジェクトの文書化`_
* `11章: テスト駆動開発`_
* `12章: 最適化: 一般原則とプロファイリングテクニック`_
* `13章: 最適化: 解法`_
* `14章: 有用なデザインパターン`_
* `索引`_

序文
-----

1章: 始めよう
--------------

* Pythonのインストール
      * Pythonの実装系
            * Jython
            * IronPython
            * PyPy
            * その他の実装
      * Linux へのインストール
            * パッケージインストール
            * ソースコンパイル
      * Windows へのインストール
            * Python のインストール
            * MinGW のインストール
            * MSYS のインストール
      * Mac OS X へのインストール
            * パッケージインストール
            * ソースコンパイル
* Python プロンプト
      * インタラクティブプロンプトのカスタマイズ
            * iPython: より良いプロンプト
* setuptools のインストール
      * 動作原理を理解する
      * EasyInstallを使ったsetuptoolsのインストール
      * distutilsにMinGWのフックを入れる
* 作業環境
      * エディターと補助ツールを使う
            * コードエディター
            * Vimのインストールと設定
            * その他のエディタを使う
            * その他のバイナリ
      * 統合開発環境を使う
            * PyDev と Eclipse を使う
* 要約


2章: 構文ベストプラクティス - クラスの世界
-------------------------------------------
* リスト内包表記
* イテレータとジェネレータ
      * ジェネレータ
      * コルーチン
      * ジェネレータ表現
      * itertools モジュール
            * islice: The Window Iterator
            * tee: The Back and Forth Iterator
            * groupby: The uniq Iterator
            * その他の関数
* デコレータ
      * デコレータの書き方
      * 引数チェック
      * キャッシュ
      * プロキシ
      * コンテキストプロバイダ
* with と contextlib
      * contextlib モジュール
      * Context Example
* 要約


3章: 構文ベストプラクティス - クラスを超えて
---------------------------------------------
* 組み込み型のサブクラス化
* super クラスを使ってメソッドにアクセスする
      * Pythonのメソッド解決順序(MRO)を理解する
      * super の落とし穴
            * super と従来型の呼び出しを混在させる
            * 親クラスと異なる引数定義の混在
* ベストプラクティス
* Descriptors と Properties
      * Descriptors
            * イントロスペクション Descriptor
            * メタ descriptor
      * Properties
* スロット
* メタプログラミング
      * __new__ メソッド
      * __metaclass__ メソッド
* 要約


4章: 良い名前の選択
--------------------
* PEP 8 と名前付けのベストプラクティス
* 名前付けのスタイル
      * 変数
            * 定数
            * パブリックとプライベートの変数
      * 関数とメソッド
            * プライベートの論争
            * 特殊メソッド
            * 引数
      * プロパティー
      * クラス
      * モジュールとパッケージ
* 名前付けガイド
      * "has" か "is" を二値型に前置する
      * シーケンス型は複数形にする
      * 辞書に明示的な名前を付ける
      * 一般的な名前を避ける
      * 既存の名前を避ける
* 引数のベストプラクティス
      * イテレーティブなデザインのための引数構築
      * 引数とテストを信じる
      * `*args` 引数と `**kw` 引数は気をつけて使おう
* クラスの名前
* モジュールとパッケージの名前
* Working on APIs
      * Tracking Verbosity
      * 名前空間木の構築
      * コードの分割
      * Eggを使う
      * Deprecation 手順を使う
* 役に立つツール
      * Pylint
      * CloneDigger
* 要約


5章: パッケージを作る
------------------------
* 全てのパッケージで共通のパターン
      * setup.py: 全てをコントロールするスクリプト
            * sdist
            * build と bdist
            * bdist_egg
            * install
            * パッケージのアンインストール
            * develop
            * test
            * register と upload
            * 新しいコマンドを作る
            * setup.py の役に立つ要約
            * その他の重要なメタデータ
* テンプレートベースのアプローチ
      * Python Paste
      * テンプレートを作る
* パッケージのテンプレートを作る
* 開発サイクル
* 要約


6章: アプリケーションを作る
----------------------------
* Atomisator: 導入
* 全体像
* 開発環境
      * テストランナーを追加する
      * パッケージ構造を追加する
* パッケージを書く
      * atomisator.parser
            * 最初のパッケージを作る
            * 最初のdoctestを作る
            * テスト環境を構築する
            * コードを書く
      * atomisator.db
            * SQLAlchemy
            * APIを提供する
      * atomisator.feed
      * atomisator.main
* Atomisator を配布する
* パッケージの依存関係
* 要約


7章: zc.buildoutを使う
-----------------------
* zc.buildout の哲学
      * ファイル構造を調整する
            * 最小の設定ファイル
            * [buildout] セクションのオプション
      * buildout コマンド
      * レシピ
            * 重要なレシピ
            * レシピを作る
      * Atomisator buildout 環境
            * buildout フォルダ構造
      * さらに先へ
* リリースとと配布
      * パッケージをリリースする
      * リリース設定ファイルを追加する
      * アプリケーションのビルドとリリース
* 要約


8章: コードの管理
------------------
* バージョン管理システム
      * 中央集中型システム
      * 分散システム
            * 分散の戦略
      * 中央集中か、分散か?
      * Mercurial
      * Mercurial でプロジェクトを管理する
            * 専用フォルダのセットアップ
            * hgwebdir の設定
            * Apache の設定
            * 認証の設定
            * クライアントの設定
* 常時結合
      * Buildbot
            * Buildbotのインストール
            * Buildbot と Mercurial のフック
            * Apache と Buildbot のフック
* 要約


9章: ライフサイクルの管理
--------------------------
* 異なるアプローチ
      * ウォーターフォール開発モデル
      * スパイラル開発モデル
      * 漸進型開発モデル
* ライフサイクルの定義
      * プランニング
      * 開発
      * 総合デバッグ
      * リリース
* トラッキングシステム設定
      * Trac
            * インストール
            * Apache 設定
            * アクセス許可設定
      * Trac でのプロジェクトライフサイクル
            * プランニング
            * 開発
            * クリーニング
            * リリース
* 要約


10章: プロジェクトの文書化
---------------------------
* テクニカルライティングの7つのルール
      * 2ステップで書く
      * Target the Readership
      * シンプルなスタイルを使う
      * 情報の範囲を制限する
      * 現実的なコード例を使う
      * 必要十分なアプローチを使う
      * テンプレートを使う
* reStructuredText 入門
      * セクション構造
      * リスト
      * インラインマークアップ
      * リテラルブロック
      * リンク
* ドキュメントをビルドする
      * 書類をビルドする
            * デザイン
            * 使い方
            * 手順
* 書類を作成する
      * Building the Landscape
            * プロデューサーのレイアウト
            * カスタマーのレイアウト
* 要約


11章: テスト駆動開発
---------------------
* テストをしていない人へ
      * テスト駆動開発の原則
            * ソフトウェアの退行を防ぐ
            * コードの品質を上げる
            * 最良の開発者ドキュメントを提供する
            * 強健なコードを素早く生産する
      * どんなテストがありますか?
            * 受け入れテスト
            * ユニットテスト
            * Python の標準テストツール
* テストをしている人へ
      * ユニットテストの落とし穴
      * ユニットテストの置き換え
            * nose
            * py.test
      * フェイクとモック
            * フェイクを構築する
            * モックを使う
      * ドキュメント駆動開発
            * ストーリーを書く
* 要約


12章: 最適化: 一般原則とプロファイリングテクニック
---------------------------------------------------
* 最適化の3つのルール
      * まず動くように作る
      * ユーザー視点で動くようにする
      * コードの可読性(とメンテナンス性)を維持する
* 最適化戦略
      * 他の原因を見つける
      * ハードウェアをスケールする
      * 速度テストを書く
* ボトルネックを見つける
      * CPU使用率のプロファイルを取る
            * Macro-Profiling
            * Micro-Profiling
            * Pystoneで計測する
      * メモリ使用率のプロファイルを取る
            * Pythonがメモリをどのように使うか
            * メモリのプロファイルを取る
      * ネットワーク使用率のプロファイルを取る
* 要約


13章: 最適化: 解法
-------------------
* 複雑さを縮小する
      * Measuring Cyclomatic Complexity
      * Big-O 表記を計測する
      * シンプルにする
            * リストの探索
            * Listの代わりにSetを使う
            * 外部呼び出しをやめ、仕事量を減らす
            * コレクション型を使う
* マルチスレッドを使う
      * マルチスレッディングとは?
      * Pythonはスレッドをどのように使うか
      * スレッドをいつ使うべきか?
            * Building Responsive Interfaces
            * Delegating Work
            * マルチユーザーアプリケーション
            * シンプルな例
* マルチプロセスを使う
      * Pyprocessing
* キャッシュを使う
      * Deterministic Caching
      * Non-Deterministic Caching
      * Pro-Active Caching
      * Memcached
* 要約


14章: 有用なデザインパターン
-----------------------------
* 生成パターン
      * Singleton
* 構造パターン
      * Adapter
            * Interfaces
      * Proxy
      * Facade
* 振る舞いパターン
      * Observer
      * Visitor
      * Template
* 要約


索引
-----


:extend type: text/html
:extend:


:comments:
:comment id: 2009-10-26.2634175742
:title: Re:Expert Python Programming の目次の和訳
:author: methane
:date: 2009-10-26 21:14:30
:email: 
:url: 
:body:
「テストする、テストしない」は、「テストをしていない人へ、テストをしている人へ」が良いかなーと思いました。

:comments:
:comment id: 2009-10-27.4387341573
:title: Re:Expert Python Programming の目次の和訳
:author: t2y
:date: 2009-10-27 01:44:05
:email: 
:url: http://d.hatena.ne.jp/t2y-1979/
:body:
Tarek さんに和訳したいと交渉していたのですが、出版社の編集者さんの同意が得られずに断念しました。残念です。

:comments:
:comment id: 2009-10-27.0969909552
:title: Re:Expert Python Programming の目次の和訳
:author: しみずかわ
:date: 2009-10-27 10:14:59
:email: 
:url: 
:body:
> methane

ありがとうございます。修正しました。他にもいくつか和訳化しました(3章とか)。

> t2y

な、なんだってー！


:comments:
:comment id: 2009-11-05.7267967702
:title: Re:Expert Python Programming の目次の和訳
:author: しみずかわ
:date: 2009-11-05 12:45:34
:email: 
:url: 
:body:
>> Tarek さんに和訳したいと交渉していたのですが、出版社の編集者さんの同意が得られずに断念しました。
>な、なんだってー！

上記の続報。
・t2yに聞いたところ、同意が得られないというか、返事がなかったそうです。
・別口で、日本の某編集者さんがPACKTの編集者さんと話をしていて、微妙に前進中。


:comments:
:comment id: 2010-01-23.2593967830
:title: 現在翻訳中！
:author: しみずかわ
:date: 2010-01-23 11:37:39
:email: 
:url: 
:body:
現在、「エキスパートPythonプログラミン（仮）」として出版に向けて数名で翻訳中です！

:comments:
:comment id: 2010-05-22.0013879531
:title: 2010/5/31発売！
:author: しみずかわ
:date: 2010-05-22 13:20:01
:email: 
:url: 
:body:
「エキスパートPythonプログラミング」2010/5/31発売です！ http://www.freia.jp/taka/blog/717

%%%%%%%%%

:id: 681
:date: 2009-11-01 01:30:00
:title: Deliverance - オープンソースカンファレンス2009 Tokyo/Fall
:categories: ['Event', 'Zope', 'python', 'Plone']
:body type: text/x-rst
:body:
オープンソースカンファレンス2009 Tokyo/Fall にて、 `Japan Zope Users Group`_ と `Plone User's Groups Japan`_ の連名で45分1コマをいただき、Deliveranceのプレゼンを行ってきました。申込みは100名Maxまで行ったのですが、実質は50人くらいだったようです。

資料の大枠とデモ環境はだいぶ事前に出来ていたものの、プレゼン資料としては前日の夜20時ころから作り始めて、当日の朝11時に完成したような感じで、徹夜で協力してくれた友人とみたに心から感謝します。

プレゼン資料公開
----------------

プレゼン資料ですが、以下のURLで公開しています。

* `Deliveranceによるデザインカスタマイズ - プログラム不要・Ploneのサイトデザインの新潮流`_

プレゼン補足
------------

ここで、プレゼンについていくつか補足しておきます。

* ユーザー会の都合上Plone関連技術っぽいタイトルですが、Ploneあんまり関係ないです。
* WSGIとの親和性が高く、Proxyモードなら他のアプリにも適用出来ます。
* 実際、Drupal の方が非常に興味を持ってくれたりしたので、他言語への適用事例になるかも知れず（言い過ぎ？

また、DeliveranceをProxyモードで動作させる方法など、環境構築方法については資料では全く触れていません。プログラマーの人がセットアップしてくれるよ！という前提でした。その方法については以下のページを参照してみてください。

* `buildoutで開発 番外編2: buildoutでDeliverance環境を作る`_ 
* `DeliveranceでOSWDのデザインをTwitter.comに適用してみた`_


技術的な側面
------------

また、技術的な面についての補足です。

* デモスライド自体がDelivaranceでデザイン適用されたPloneS5です。
* 適用前後は http://admin.plone3d.freia.jp/, http://plone3d.freia.jp/ で見比べられます
* デモサイトは以下の技術で構成されています

  * ZEO
  * Zope2 (2.10.9)
  * Plone
  * repoze.zope2 (2.10.7)
  * Deliverance (0.3 middleware mode)
  * Paster
  * WSGI
  * Apache2.2
  * reStructuredText (元テキスト作成に使用)
  * PloneS5 (プレゼンモードに使用)
  * PloneSWFUpload (プレゼンの画像一括Uploadに使用)
  * Slimbox2 (Deliverance適用版プレゼンモードの画像拡大に使用)

この構成とほぼ同じ構成を作るためのbuildoutスケルトンを公開してるので、興味のある方は `Plone-3.3.1をWSGIで稼働させるための設定テンプレ`_ を参照してください。

おまけ
------

Deliveranceとcollective.xdvを比較している英語ドキュメントがあったので和訳してみました。プレゼンに組み込もうかと思って用意したのですが使われなかったやつです。参考まで。

* `テーマ適用アプローチの選択肢`_

さいごに
--------

皆さんお疲れ様でした！ 打ち上げで `渋川師匠`_ から色々とプレゼンの極意を聞いたので、少しずつプレゼンに生かしていきたいと思います！


.. _`Japan Zope Users Group`: http://zope.jp/
.. _`Plone User's Groups Japan`: http://plone.jp/
.. _`Deliveranceによるデザインカスタマイズ - プログラム不要・Ploneのサイトデザインの新潮流`: http://plone3d.freia.jp/deliverance/deliverance-presentation/presentation_view
.. _`Plone-3.3.1をWSGIで稼働させるための設定テンプレ`: http://www.freia.jp/taka/blog/673
.. _`buildoutで開発 番外編2: buildoutでDeliverance環境を作る`: http://www.freia.jp/taka/blog/668
.. _`DeliveranceでOSWDのデザインをTwitter.comに適用してみた`: http://www.freia.jp/taka/blog/669
.. _`テーマ適用アプローチの選択肢`: http://admin.plone3d.freia.jp/deliverance/choosing-the-appropriate-theming-approach
.. _`渋川師匠`: http://shibu.jp


:extend type: text/html
:extend:


:comments:
:comment id: 2009-11-01.7023097508
:title: バックアップスライドのところで
:author: jack
:date: 2009-11-01 15:25:09
:email: 
:url: 
:body:
Varnish とかリバースプロクシがある場合どこに置くかみたいなスライドで Load Balancer が Load Barancerになっていた気がします。勘違いだったらシツレイしました

:comments:
:comment id: 2009-11-01.0061196945
:title: バランサー
:author: しみずかわ
:date: 2009-11-01 15:30:06
:email: 
:url: 
:body:
ほんとうだ！某所からコピペしたときに気づかなかった.... とりあえず放置しますｗ

%%%%%%%%%

:id: 682
:date: 2009-11-08 18:55:17
:title: 多摩ウィンドフィルのファミリーコンサートに行ってきました
:categories: ['misc']
:body type: text/x-rst
:body:
今日は `多摩ウィンドフィルハーモニーオーケストラ`_ のファミリーコンサートに行ってきました。前回の `(第4回)Zope/Plone開発勉強会`_ で takanory.net の、たかのりさんがみんなにパンフを配ってたので、吹奏楽経験者としては行くしかない、と。

ファミリーコンサートと言うだけあって、曲目も後半がディズニー特集というファミリーを意識した内容。でも前半より演奏に力が入っていたような気がする。あるいは単にノリの問題かも？格好も前半は蝶ネクタイな感じだったけど、後半はディズニーの帽子とか、しっぽとか生えてた。

演奏も良かったと思う。吹奏楽離れて13年も経ってるので、どこがどう、とは言えんけど。そよ風のマーチは、記憶に残ってない、と思ったら高校前に1年浪人してた年の課題曲だった。縁がなかったなー。一番よかったのはセドナとスーパーカリフラジリスティックエクスピアリドーシャスかな。

パンフに団員募集中！って書いてあるけど、コントラバスは貸してもらえますか？持ち込み？中古で40万、ヤフオクで10万ですか‥‥。

----

ところで今見て気づいたんですが、 `多摩ウィンドフィルハーモニーオーケストラ`_ のサイトがPloneで出来ててびっくりした。誰が作ったんだろう（いや分かるけど）

.. _`多摩ウィンドフィルハーモニーオーケストラ`: http://twpo.org/
.. _`(第4回)Zope/Plone開発勉強会`: http://zope.jp/events/zope-plone-sprint-tokyo-4

:extend type: text/html
:extend:


:trackbacks:
:trackback id: 2009-11-10.2494892459
:title: ファミリーコンサート 2009 終了
:blog name: takalog
:url: http://takanory.net/takalog/1176
:date: 2009-11-10 23:44:15
:body:
 11月8日(日)は私が所属する楽団、 多摩ウィンドフィルハーモニーオーケストラ のファミリーコンサート2009でした。  私は10月27日から11月4日までPlone ConferenceとLEGOLANDに行っていて、帰ってきたら仕事を片付けて7...

%%%%%%%%%

:id: 683
:date: 2009-11-14 17:00:00
:title: Deliveranceをインストールする手順  in Python Hack-a-thon #2
:categories: ['python']
:body type: text/x-rst
:body:
今日は `Python Hack-a-thon #2`_ and `Sphinx Hack-a-thon #1`_ (偶然同時開催)で青山のOracleに来ています。会場を提供してくれたOracleさん、ありがとうございます。

とりあえず自分もちょっとだけしゃべる時間をもらったので、Deliveranceの紹介をすることにしました。
詳しくは http://plone3d.freia.jp/deliverance のドキュメントを見てみてください。
以下のようなものを置いてあります。

* `Deliverance 環境構築 easy_install編`_ (今日書いたやつ)
* `Deliverance 環境構築 buildout編`_ (今日書いたやつ)
* `Deliveranceによるデザインカスタマイズ`_ (OSC2009で使ったやつ)

デザイン変更の例
----------------

３つの例を以下のようにやってみました。デザインはすべて http://oswd.org/ から持ってきました。

* Twitterのデザインを変更
* Sphinxのデザインを変更
* Ploneのデザインを変更

.. _`Python Hack-a-thon #2`: http://atnd.org/events/1288
.. _`Sphinx Hack-a-thon #1`: http://atnd.org/events/1288
.. _`Deliverance 環境構築 easy_install編`: http://plone3d.freia.jp/deliverance/deliverance-setup-for-easyinstall
.. _`Deliverance 環境構築 buildout編`: http://plone3d.freia.jp/deliverance/deliverance-setup-for-buildout
.. _`Deliveranceによるデザインカスタマイズ`: http://plone3d.freia.jp/deliverance/deliverance-presentation/presentation_view


:extend type: text/html
:extend:
%%%%%%%%%

:id: 684
:date: 2009-11-22 19:35:00
:title: 第5回 Zope/Plone開発勉強会に参加しました
:categories: ['Event', 'Zope', 'Plone']
:body type: text/x-rst
:body:
今回も開場が開始5分前になってしまい、一人待たせてしまったり。もうしわけない。
そんな開発勉強会ですが今回で通算6回目となりました。ここ最近の参加人数は10人前後に落ち着いています。

http://atnd.org/events/1855


自分が今回さわったのは、前回第4回で成果を出すところまで行かなかった z3c.form を使用したフォーム作成、です。最小のパッケージ構成で WSGI サーバーを起動してフォーム登録、一覧表示などをおこなうやつです。いちおう動作するところまでは出来たので、のちほどまとめて次のblogエントリに投稿しようとおもいます。

次回はこれにDeliveranceでデザインを適用するなどをしてみようかと思っています。あるいはフォームそのものを編集出来るようにしてみようかな。

会場の様子
----------

.. figure:: images/20091121_zopeplonedev5_1.jpg/image_preview

  会場の様子

.. figure:: images/20091121_zopeplonedev5_2.jpg/image_preview

  成果発表の様子

.. figure:: images/20091121_zopeplonedev5_3.jpg/image_preview

  会場の様子を撮る人の様子


`他の写真はDropboxで公開しました`_ 。

.. _`他の写真はDropboxで公開しました`: http://www.dropbox.com/gallery/284189/1/2009_11_zopeplonedev?h=25ebd2

他の参加者の報告
----------------

* `plone 4.0 alpha 1 を buildout でインストール - takanory.net`_
* `第5回Zope/Plone開発勉強会の報告 - enbug diary(2009-11-21)`_
* `Plone3のメールバグ解消プロダクト公開 — CMSコミュニケーションズ`_
* `(第5回)Zope/Plone 開発勉強会が終了 — takanory.net`_

.. _`plone 4.0 alpha 1 を buildout でインストール - takanory.net`: http://takanory.net/takalog/1182
.. _`第5回Zope/Plone開発勉強会の報告 - enbug diary(2009-11-21)`: http://enbug.tdiary.net/20091121.html#p01
.. _`Plone3のメールバグ解消プロダクト公開 — CMSコミュニケーションズ`: http://www.cmscom.jp/blog/259
.. _`(第5回)Zope/Plone 開発勉強会が終了 — takanory.net`: http://takanory.net/takalog/1183


前日・当日の #zopeplonedev の発言
----------------------------------

:Terapyon: 明日開催のZope/Plone開発勉強会ですが、まだ枠があるようです。お時間のある方は参加されてみては・・。 http://bit.ly/4sfRPM (expand) #zopeplonedev 今回の個人的な目標は、Plone3のメール関連パッチを作りPyPIに登録と、飲み過ぎないことです。
:ytakeuch: Zope/Plone開発勉強会ですが、家族が発熱でインフルエンザの可能性があります。正午頃には判定が出る予定です。 #zopeplonedev
:takanory: 二日酔いで遅刻します。すいません #zopeplonedev
:jbking: 12時前には着きたいです。 #zopeplonedev
:t2y: 会場に着いたけど、エレベータが動かない？ #zopeplonedev
:t2y: pylucene に付属しているサンプルプログラムを実行して遊んでる、初めて触ってみると動いただけでおもしろい #zopeplonedev
:takanory: 1時くらいに到着します #zopeplonedev
:okuji: やっぱり現実逃避に行こうかと #zopeplonedev
:shimizukawa: @okuji 会場にはまだまだ余裕があります＞＜ #zopeplonedev
:takanory: @okuji 待ってま～す #zopeplonedev
:takanory: いま頃やること発表中。ゆるさが上がってます #zopeplonedev
:jbking: 弊社過半数の社員が参加する勉強会 #zopeplonedev
:takanory: そして @okuji さんがきた #zopeplonedev
:ytakeuch: インフルエンザ確定です＞＜。不参加とさせていただきます。 #zopeplonedev
:shimizukawa: @ytakeuch ＞＜ おだいじに！ #zopeplonedev
:takanory: plone 4.0a1 を buildout でインストールした http://takanory.net/takalog/1182 #zopeplonedev
:Terapyon: 会場入りして、テストを実行中。どうも変なエラーがでる。なぜだろう？？ #zopeplonedev
:takanory: 成果発表の時間だが誰も手を上げない的な。。。 #zopeplonedev
:takanory: もりの: ArchExample を元にカスタマイズしたコンテントタイプ作ったよ #zopeplonedev
:shimizukawa: 今日も7時間黙々と開発していた会だった。もうちょっと質問とか飛び交っても良いと思うよ！ #zopeplonedev
:takanory: @shimizukawa z3c.form で動くテストツールと、そのツール作るためのレシピ書いたりとかした #zopeplonedev
:shimizukawa: @takanory Plone4.0a1 をゼロ環境からインストールする手順をまとめました http://bit.ly/6C5AR2 (expand) #zopeplonedev
:shimizukawa: @ yusei zope3 のzmiを分離するプロジェクト zmi.core 開発を進めていました。そろそろ完了が近いかな。 http://bit.ly/iK7Im (expand) #zopeplonedev
:takanory: 今日わかったこと、家でもやらないとダメ #zopeplonedev
:takanory: @t2y pylucene を Plone に組み込むためにいろいろ準備してる #zopeplonedev
:takanory: collective.solr http://plone.org/products/collective.solr/ あるから参考になるかも #zopeplonedev
:takanory: こみや ruby でデータベース仕様書を作成するツールをメンテナンスしてた #zopeplonedev
:takanory: データベースのカラムとテーブルにコメントをつけて、そのコメントからExcelで仕様書を作成してる #zopeplonedev
:takanory: @okuji python 2.6 のメソッドキャッシュによる最適化をZopeで使えるようにするパッチ作成 #zopeplonedev
:takanory: @terapyon メールのバグがまだ残ってて、解消しようといろいろやってた #zopeplonedev
:takanory: @@manage-viewlets ってなんで知ったんだろう、なぞだ #zopeplonedev
:takanory: 次回のzope/plone開発勉強会は12月5日に開催します #zopeplonedev
:takanory: @shimizukawa お疲れ様でした。二次会の場所はなんか聴いたことあるような? #zopeplonedev
:zenich: 今日は #zopeplonedev を欠席して iPhoneアプリのプロモ／サポートサイトをつくってました


これは search.twitter.com からコピーして逆順にソートして...とやったんですが、もうちょっと簡単に加工したい。時刻表示したいし、twitterの発言にリンクしたいし... どうすれば？API叩くしかないかな..

次回 第6回
-----------

次回は 12/5(土) 開催。 2週間後です、って近いなあ...。

登録はこちら！ http://atnd.org/events/2258


:extend type: text/html
:extend:
%%%%%%%%%

:id: 685
:date: 2009-11-23 02:10:30
:title: 清水川Webを Plone-2.5.2-1 から Plone-3.3.2 にアップグレード
:categories: ['Plone']
:body type: text/x-rst
:body:
このサイトの Plone を `Plone 2.5.2-1` から `Plone 3.3` にアップグレードしようと先月からチャレンジしていましたが、ついに成功したのでその手順を深い考察などせずにそのまんま公開します。「すくなくともうちのサイトはこれでうまくいきました」的な内容なので、もしかしたら、あんまり役に立たないかも知れません。

なお、まだ「試行錯誤した結果うまくいった」状態で、デザインなどもリセットしてしまったので、本インスタンスにアップグレードを適用してサイト公開するのはもうちょっと先になりそうです。

詳細は以下の通り。


:extend type: text/x-rst
:extend:
Zope 2.9.7 -> 2.10.9
---------------------
Plone3系にするにはZope-2.10.xが必要なので、先にZope本体のバージョンを上げておく。

from::

        Plone 2.5.2,
        CMF-1.6.2,
        Zope (Zope 2.9.7-final, python 2.4.4, freebsd7),
        Five 1.3.8,
        Python 2.4.4 (#2, Oct 26 2008, 05:45:29) [GCC 4.2.1 20070719 [FreeBSD]],
        PIL 1.1.6

to::

        Plone 2.5.2,
        CMF-1.6.2,
        Zope (Zope 2.10.9-final, python 2.4.4, freebsd7),
        Five 1.5.6,
        Python 2.4.4 (#2, Oct 26 2008, 05:45:29) [GCC 4.2.1 20070719 [FreeBSD]],
        PIL 1.1.6


Plone 2.5.2-1 -> 2.5.5
-----------------------

なんにも問題無かったはず。省略して 2.5.2 -> 3.1.7 にしても良いかも。


Plone 2.5.5 -> 3.1.7
---------------------

Plone3系にアップグレード。Plone-3.2系はtgzパッケージ配布からbuildoutに切り替わっているので、tgzパッケージでアップグレードできるのは3.1.7まで。とりあえずここまでは従来のアップグレード手順で上げてしまうことにする。

ProductsをPlone-3.1.7に更新して起動すると、importエラーがたくさん発生する。
ここでこのエラーに対応するため、Plone以外に入れているプロダクトのソースコード改造を実施。

* 複数のプロダクトで、 ``Products.CMFCore.CMFCorePermissions`` が見つからないエラーがボロボロと出てきたので、 Products.CMFCore.permissions に置き換えた。こんなかんじ::

   -from Products.CMFCore.CMFCorePermissions import View,ListFolderContents,\
   +from Products.CMFCore.permissions import View,ListFolderContents,\


* ``Products.CMFCore.WorkflowCore.WorkflowAction`` が見つからない。使わないように改造してみた::

   -from TAL.TALDefs import TALESError
   +#from TAL.TALDefs import TALESError
   +from zope.tal.taldefs import TALExpressionError as TALESError
    from Products.CMFDefault.DublinCore import DefaultDublinCoreImpl
    from Products.CMFCore.PortalContent import PortalContent
   -from Products.CMFCore.PortalContent import NoWL, ResourceLockedError
   -from Products.CMFCore.WorkflowCore import WorkflowAction
   +from Products.CMFCore.PortalContent import ResourceLockedError
   +NoWL = 0

   そして実際にWorkflowActionを使ってる行で...

   -    setFormat = WorkflowAction(setFormat)
   +    #setFormat = WorkflowAction(setFormat)

   これは移行後にどうするか考えよう...


* Products.PluggableAuthService.utils.implementedBy が無い::

   -from Products.PluggableAuthService.utils import implementedBy
   +from zope.interface import implementedBy   


起動できるようになったので portal_migration をdry-runすると、なんか `PT:Document` がアップグレード出来ないと言われる::

   2009-11-22 21:24:50 INFO Plone
   Attempting to upgrade from: 2.5.5
   2009-11-22 21:24:50 ERROR Plone
   Upgrade aborted
   2009-11-22 21:24:50 ERROR Plone
   Error type: zExceptions.BadRequest
   2009-11-22 21:24:50 ERROR Plone
   Error value: The id "PT:Document" contains characters illegal in URLs.
   2009-11-22 21:24:50 ERROR Plone
     File "/usr/local/www/ZFreia_taka/Plone-3.1.7/Products/CMFPlone/MigrationTool.py", line 210, in upgrade
       newv, msgs = self._upgrade(newv)

   2009-11-22 21:24:50 ERROR Plone
     File "/usr/local/www/ZFreia_taka/Plone-3.1.7/Products/CMFPlone/MigrationTool.py", line 321, in _upgrade
       res = function(self.aq_parent)

   2009-11-22 21:24:50 ERROR Plone
     File "/usr/local/www/ZFreia_taka/Plone-3.1.7/Products/CMFPlone/migrations/v3_0/alphas.py", line 100, in three0_alpha1
       migrateOldActions(portal, out)

   2009-11-22 21:24:50 ERROR Plone
     File "/usr/local/www/ZFreia_taka/Plone-3.1.7/Products/CMFPlone/migrations/v3_0/alphas.py", line 425, in migrateOldActions
       portal.portal_actions._setObject(category, ActionCategory(id=category))

   2009-11-22 21:24:50 ERROR Plone
     File "/usr/local/www/Zope210/lib/python/OFS/ObjectManager.py", line 315, in _setObject
       v = self._checkId(id)

   2009-11-22 21:24:50 ERROR Plone
     File "/usr/local/www/Zope210/lib/python/OFS/ObjectManager.py", line 83, in checkValidId
       raise BadRequest, (

   2009-11-22 21:24:50 INFO Plone
   End of upgrade path, migration has finished
   2009-11-22 21:24:50 ERROR Plone
   The upgrade path did NOT reach current version
   2009-11-22 21:24:50 ERROR Plone
   Migration has failed
   2009-11-22 21:24:50 INFO Plone
   Dry run selected, transaction aborted

そこで、portal_contentpanelsをuninstallしようとしたらそれもエラーになったので、まあいいや、と思ってportal/portal_contentpanelsを削除。本番では事前にCMFContentPanelsをアンインストールしておきたい。改めてdry-runを実行したところうまくいったっぽい::

   Plone Migration Tool at  /freia/taka/portal_migration
   Result of the attempt...

   Dry run selected.
   Starting the migration from version: 2.5.5
   Attempting to upgrade from: 2.5.5
   Registered tools as utilities.
   Migrated old actions to new actions stored in portal_actions.
   Added navtree.css to the registry
   Added invisibles.css to the registry
   Added forms.css to the registry
   Added 'default_contenttype' property to site_properties.
   Added 'forbidden_contenttypes' property to site_properties.
   Added Markup Settings to the control panel
   Added markup configlet icon to actionicons tool.
   Updated actions i18n domain attribute.
   Updated type informations i18n domain attribute.
   Upgraded the ATContentTypes tool.
   Installed CMFDiffTool.
   Installed CMFEditions.
   Converted legacy portlets at the portal root
   NOTE: You may need to convert other portlets manually.
   - to do so, click "manage portlets" in the relevant folder.
   Added 'calendar' icon to actionicons tool.
   Added calendar settings to the control panel
   Removed the Plone Tableless skin
   Upgrade to: 3.0-alpha1, completed
   Attempting to upgrade from: 3.0-alpha1
   Registered tools as utilities.
   Removed generated.css from the registry
   Added form_tabbing.js to portal_javascipt
   Registered kss mimetype
   Registered kss resources
   Added missing skins to Plone Default
   Succesfully migrated portal to KSS
   Registered redirector utility
   Added content rules action to object category
   Added reader and editor roles
   Ensured references to folder_localrole_form point to @@sharing now
   Updated RTL.css expression.
   Upgrade to: 3.0-alpha2, completed
   Attempting to upgrade from: 3.0-alpha2
   Registered tools as utilities.
   Added 'Maintenance' to the control panel
   Added 'maintenance' icon to actionicons tool.
   Added 'number_of_days_to_keep' property to site properties
   Added 's5_presentation' action to actions tool.
   Added 's5_presentation' icon to actionicons tool.
   Added in css and js for table of contents
   Added input-label.js to portal_javascipt
   Updated member management security
   Added Plone Session Plugin.
   Added 'filter' icon to actionicons tool.
   Added 'security' icon to actionicons tool.
   Registered content rules storage utility
   Added 'Content Rules Settings' to the control panel
   Added 'Content Rules Settings' icon to actionicons tool.
   Added html filter settings to the control panel
   Added security settings to the control panel
   Added 'enable_sitemap' property to site properties
   Use ++resource++kukit-src.js instead of ++resource++kukit.js
   Set 'full' compression on ++resource++kukit-src.js
   Created RAMCache ResourceRegistryCache for ResourceRegistry output
   Associated portal_css with ResourceRegistryCache
   Associated portal_javascripts with ResourceRegistryCache
   Set 'full-encode' compression on cssQuery.js
   Removed folder_contents_hideAddItems.js from portal_javascripts.
   Added webstats.js to portal_javascipts
   Added 'webstats_js' property to site properties
   Added object_provides index to portal_catalog
   Removed the mystuff user action
   Added 'external_links_open_new_window' property to site properties
   Added Types Settings to the control panel
   Added types configlet icon to actionicons tool.
   Added workflow intranet_workflow
   Added workflow intranet_folder_workflow
   Added workflow one_state_workflow
   Added workflow simple_publication_workflow
   Added 'many_groups' property to site properties
   Replaced obsolete PlonePAS version of plone tool with the normal one.
   Registered plone.app.i18n utilities.
   Installed PloneLanguageTool.
   Added 'email_charset' property to the portal.
   Upgrade to: 3.0-beta1, completed
   Attempting to upgrade from: 3.0-beta1
   Registered tools as utilities.
   Changed the order of action providers.
   Added unlockOnFormUnload.js to portal_javascripts
   Removed object_tabs action category.
   Removed global action category.
   Removed empty default_charset portal property
   Added automatic group PAS plugin
   Removed 's5_presentation' action from actions tool.
   Removed 's5_presentation' icon from actionicons tool.
   Associated portal_kss with ResourceRegistryCache
   Updated kss javascript resource ++resource++kukit-src.js, to disable kss for anonymous.
   Added kss resource at_experimental.kss, disabled by default.
   Added kss resource plone_experimental.kss, disabled by default.
   Removed properties action from type CMF Image
   Removed properties action from type CMF Document
   Removed properties action from type CMF Favorite
   Removed properties action from type CMF Link
   Removed properties action from type CMF News Item
   Removed properties action from type CMF File
   Removed properties action from type Wiki Page
   Removed properties action from type SilverCityDocument
   Removed properties action from type ATBookshelfItem
   Removed properties action from type ATBookshelf
   Removed properties action from type DynamicDocument
   Removed properties action from type ContentPanels
   Removed properties action from type ATExtFlash
   Removed properties action from type COREBlog2
   Removed properties action from type COREBlogComment
   Removed properties action from type COREBlogTrackback
   Removed properties action from type COREBlogCommentFolder
   Removed properties action from type COREBlogCategory
   Removed properties action from type COREBlogCategoryFolder
   Removed properties action from type COREBlogEntry
   Removed properties action from type ATPathCriterion
   Removed properties action from type ATBooleanCriterion
   Removed properties action from type Image
   Removed properties action from type Topic
   Removed properties action from type ATSelectionCriterion
   Removed properties action from type Large Plone Folder
   Removed properties action from type Document
   Removed properties action from type ATSimpleStringCriterion
   Removed properties action from type ATCurrentAuthorCriterion
   Removed properties action from type ATDateCriteria
   Removed properties action from type Favorite
   Removed properties action from type Event
   Removed properties action from type ATReferenceCriterion
   Removed properties action from type ATSimpleIntCriterion
   Removed properties action from type ATListCriterion
   Removed properties action from type Folder
   Removed properties action from type Link
   Removed properties action from type News Item
   Removed properties action from type File
   Removed properties action from type ATDateRangeCriterion
   Removed properties action from type ATSortCriterion
   Removed properties action from type ATRelativePathCriterion
   Removed properties action from type ATPortalTypeCriterion
   Upgrade to: 3.0-beta2, completed
   Attempting to upgrade from: 3.0-beta2
   Registered tools as utilities.
   Removed explicit references to sharing action
   Upgrade to: 3.0-beta3, completed
   Attempting to upgrade from: 3.0-beta3
   Registered tools as utilities.
   Updated kss javascript resources, to enable the use of production and development versions.
   Upgrade to: 3.0-rc1, completed
   Attempting to upgrade from: 3.0-rc1
   Added text_web_intelligent mime type to registry
   Added intelligenttext to html transform to registry
   Added html to intelligenttext transform to registry
   Upgrade to: 3.0-rc2, completed
   Attempting to upgrade from: 3.0-rc2
   Upgrade to: 3.0, completed
   Attempting to upgrade from: 3.0
   Upgrade to: 3.0.1, completed
   Attempting to upgrade from: 3.0.1
   Upgrade to: 3.0.2, completed
   Attempting to upgrade from: 3.0.2
   Upgrade to: 3.0.3, completed
   Attempting to upgrade from: 3.0.3
   Added new CMFEditions modifiers
   Upgrade to: 3.0.4, completed
   Attempting to upgrade from: 3.0.4
   Registered tools as utilities.
   Upgrade to: 3.0.5, completed
   Attempting to upgrade from: 3.0.5
   Upgrade to: 3.0.6, completed
   Attempting to upgrade from: 3.0.6
   Installed plone.browserlayer
   Installed plone.portlet.static
   Installed plone.portlet.collection
   Migrated portlet types to support multiple portlet manager interfaces.
   Removed doubly registered GenericSetup import steps: toolset rolemap componentregistry
   Removed doubly registered GenericSetup export steps: componentregistry step_registries rolemap toolset
   Reinstalled CMFPlacefulWorkflow
   Deactivated original 'local_roles' plugin
   - Activating: local_roles borg_localroles activated.
   Upgrade to: 3.1-beta1, completed
   Attempting to upgrade from: 3.1-beta1
   Upgrade to: 3.1-rc1, completed
   Attempting to upgrade from: 3.1-rc1
   Upgrade to: 3.1, completed
   Attempting to upgrade from: 3.1
   Upgrade to: 3.1.1, completed
   Attempting to upgrade from: 3.1.1
   Upgrade to: 3.1.2, completed
   Attempting to upgrade from: 3.1.2
   Upgrade to: 3.1.3, completed
   Attempting to upgrade from: 3.1.3
   Upgrade to: 3.1.4, completed
   Attempting to upgrade from: 3.1.4
   Upgrade to: 3.1.5, completed
   Attempting to upgrade from: 3.1.5
   Upgrade to: 3.1.5.1, completed
   Attempting to upgrade from: 3.1.5.1
   Upgrade to: 3.1.6, completed
   Attempting to upgrade from: 3.1.6
   Upgrade to: 3.1.7, completed
   Attempting to upgrade from: 3.1.7
   Migration completed at version 3.1.7.
   End of upgrade path, migration has finished
   Your ZODB and Filesystem Plone instances are now up-to-date.
   Dry run selected, transaction aborted
   Return

最後に aborted になっているのはdry-runをしたため。それでは改めて本実行::


   Plone Migration Tool at  /freia/taka/portal_migration
   Result of the attempt...

   Starting the migration from version: 2.5.5
   Attempting to upgrade from: 2.5.5
   Registered tools as utilities.
   Migrated old actions to new actions stored in portal_actions.
   Added navtree.css to the registry
   Added invisibles.css to the registry
   Added forms.css to the registry
   Added 'default_contenttype' property to site_properties.
   Added 'forbidden_contenttypes' property to site_properties.
   Added Markup Settings to the control panel
   Added markup configlet icon to actionicons tool.
   Updated actions i18n domain attribute.
   Updated type informations i18n domain attribute.
   Upgraded the ATContentTypes tool.
   Installed CMFDiffTool.
   Installed CMFEditions.
   Converted legacy portlets at the portal root
   NOTE: You may need to convert other portlets manually.
   - to do so, click "manage portlets" in the relevant folder.
   Added 'calendar' icon to actionicons tool.
   Added calendar settings to the control panel
   Removed the Plone Tableless skin
   Upgrade to: 3.0-alpha1, completed
   Attempting to upgrade from: 3.0-alpha1
   Registered tools as utilities.
   Removed generated.css from the registry
   Added form_tabbing.js to portal_javascipt
   Registered kss mimetype
   Registered kss resources
   Added missing skins to Plone Default
   Succesfully migrated portal to KSS
   Registered redirector utility
   Added content rules action to object category
   Added reader and editor roles
   Ensured references to folder_localrole_form point to @@sharing now
   Updated RTL.css expression.
   Upgrade to: 3.0-alpha2, completed
   Attempting to upgrade from: 3.0-alpha2
   Registered tools as utilities.
   Added 'Maintenance' to the control panel
   Added 'maintenance' icon to actionicons tool.
   Added 'number_of_days_to_keep' property to site properties
   Added 's5_presentation' action to actions tool.
   Added 's5_presentation' icon to actionicons tool.
   Added in css and js for table of contents
   Added input-label.js to portal_javascipt
   Updated member management security
   Added Plone Session Plugin.
   Added 'filter' icon to actionicons tool.
   Added 'security' icon to actionicons tool.
   Registered content rules storage utility
   Added 'Content Rules Settings' to the control panel
   Added 'Content Rules Settings' icon to actionicons tool.
   Added html filter settings to the control panel
   Added security settings to the control panel
   Added 'enable_sitemap' property to site properties
   Use ++resource++kukit-src.js instead of ++resource++kukit.js
   Set 'full' compression on ++resource++kukit-src.js
   Created RAMCache ResourceRegistryCache for ResourceRegistry output
   Associated portal_css with ResourceRegistryCache
   Associated portal_javascripts with ResourceRegistryCache
   Set 'full-encode' compression on cssQuery.js
   Removed folder_contents_hideAddItems.js from portal_javascripts.
   Added webstats.js to portal_javascipts
   Added 'webstats_js' property to site properties
   Added object_provides index to portal_catalog
   Removed the mystuff user action
   Added 'external_links_open_new_window' property to site properties
   Added Types Settings to the control panel
   Added types configlet icon to actionicons tool.
   Added workflow intranet_workflow
   Added workflow intranet_folder_workflow
   Added workflow one_state_workflow
   Added workflow simple_publication_workflow
   Added 'many_groups' property to site properties
   Replaced obsolete PlonePAS version of plone tool with the normal one.
   Registered plone.app.i18n utilities.
   Installed PloneLanguageTool.
   Added 'email_charset' property to the portal.
   Upgrade to: 3.0-beta1, completed
   Attempting to upgrade from: 3.0-beta1
   Registered tools as utilities.
   Changed the order of action providers.
   Added unlockOnFormUnload.js to portal_javascripts
   Removed object_tabs action category.
   Removed global action category.
   Removed empty default_charset portal property
   Added automatic group PAS plugin
   Removed 's5_presentation' action from actions tool.
   Removed 's5_presentation' icon from actionicons tool.
   Associated portal_kss with ResourceRegistryCache
   Updated kss javascript resource ++resource++kukit-src.js, to disable kss for anonymous.
   Added kss resource at_experimental.kss, disabled by default.
   Added kss resource plone_experimental.kss, disabled by default.
   Removed properties action from type CMF Image
   Removed properties action from type CMF Document
   Removed properties action from type CMF Favorite
   Removed properties action from type CMF Link
   Removed properties action from type CMF News Item
   Removed properties action from type CMF File
   Removed properties action from type Wiki Page
   Removed properties action from type SilverCityDocument
   Removed properties action from type ATBookshelfItem
   Removed properties action from type ATBookshelf
   Removed properties action from type DynamicDocument
   Removed properties action from type ContentPanels
   Removed properties action from type ATExtFlash
   Removed properties action from type COREBlog2
   Removed properties action from type COREBlogComment
   Removed properties action from type COREBlogTrackback
   Removed properties action from type COREBlogCommentFolder
   Removed properties action from type COREBlogCategory
   Removed properties action from type COREBlogCategoryFolder
   Removed properties action from type COREBlogEntry
   Removed properties action from type ATPathCriterion
   Removed properties action from type ATBooleanCriterion
   Removed properties action from type Image
   Removed properties action from type Topic
   Removed properties action from type ATSelectionCriterion
   Removed properties action from type Large Plone Folder
   Removed properties action from type Document
   Removed properties action from type ATSimpleStringCriterion
   Removed properties action from type ATCurrentAuthorCriterion
   Removed properties action from type ATDateCriteria
   Removed properties action from type Favorite
   Removed properties action from type Event
   Removed properties action from type ATReferenceCriterion
   Removed properties action from type ATSimpleIntCriterion
   Removed properties action from type ATListCriterion
   Removed properties action from type Folder
   Removed properties action from type Link
   Removed properties action from type News Item
   Removed properties action from type File
   Removed properties action from type ATDateRangeCriterion
   Removed properties action from type ATSortCriterion
   Removed properties action from type ATRelativePathCriterion
   Removed properties action from type ATPortalTypeCriterion
   Upgrade to: 3.0-beta2, completed
   Attempting to upgrade from: 3.0-beta2
   Registered tools as utilities.
   Removed explicit references to sharing action
   Upgrade to: 3.0-beta3, completed
   Attempting to upgrade from: 3.0-beta3
   Registered tools as utilities.
   Updated kss javascript resources, to enable the use of production and development versions.
   Upgrade to: 3.0-rc1, completed
   Attempting to upgrade from: 3.0-rc1
   Added text_web_intelligent mime type to registry
   Added intelligenttext to html transform to registry
   Added html to intelligenttext transform to registry
   Upgrade to: 3.0-rc2, completed
   Attempting to upgrade from: 3.0-rc2
   Upgrade to: 3.0, completed
   Attempting to upgrade from: 3.0
   Upgrade to: 3.0.1, completed
   Attempting to upgrade from: 3.0.1
   Upgrade to: 3.0.2, completed
   Attempting to upgrade from: 3.0.2
   Upgrade to: 3.0.3, completed
   Attempting to upgrade from: 3.0.3
   Added new CMFEditions modifiers
   Upgrade to: 3.0.4, completed
   Attempting to upgrade from: 3.0.4
   Registered tools as utilities.
   Upgrade to: 3.0.5, completed
   Attempting to upgrade from: 3.0.5
   Upgrade to: 3.0.6, completed
   Attempting to upgrade from: 3.0.6
   Installed plone.browserlayer
   Installed plone.portlet.static
   Installed plone.portlet.collection
   Migrated portlet types to support multiple portlet manager interfaces.
   Removed doubly registered GenericSetup import steps: toolset rolemap componentregistry
   Removed doubly registered GenericSetup export steps: componentregistry step_registries rolemap toolset
   Reinstalled CMFPlacefulWorkflow
   Deactivated original 'local_roles' plugin
   - Activating: local_roles borg_localroles activated.
   Upgrade to: 3.1-beta1, completed
   Attempting to upgrade from: 3.1-beta1
   Upgrade to: 3.1-rc1, completed
   Attempting to upgrade from: 3.1-rc1
   Upgrade to: 3.1, completed
   Attempting to upgrade from: 3.1
   Upgrade to: 3.1.1, completed
   Attempting to upgrade from: 3.1.1
   Upgrade to: 3.1.2, completed
   Attempting to upgrade from: 3.1.2
   Upgrade to: 3.1.3, completed
   Attempting to upgrade from: 3.1.3
   Upgrade to: 3.1.4, completed
   Attempting to upgrade from: 3.1.4
   Upgrade to: 3.1.5, completed
   Attempting to upgrade from: 3.1.5
   Upgrade to: 3.1.5.1, completed
   Attempting to upgrade from: 3.1.5.1
   Upgrade to: 3.1.6, completed
   Attempting to upgrade from: 3.1.6
   Upgrade to: 3.1.7, completed
   Attempting to upgrade from: 3.1.7
   Migration completed at version 3.1.7.
   End of upgrade path, migration has finished
   Your ZODB and Filesystem Plone instances are now up-to-date.

うぉ、成功した！
しかしPloneのViewで表示しようとしたらエラー::

   2009-11-22 21:38:13 ERROR Zope.SiteErrorLog 1258893493.510.109067702822 http://192.168.1.2:8980/freia/taka/folder_listing
   Traceback (innermost last):
     Module ZPublisher.Publish, line 119, in publish
     Module ZPublisher.mapply, line 88, in mapply
     Module ZPublisher.Publish, line 42, in call_object
     Module Shared.DC.Scripts.Bindings, line 313, in __call__
     Module Shared.DC.Scripts.Bindings, line 350, in _bindAndExec
     Module Products.CMFCore.FSPageTemplate, line 216, in _exec
     Module Products.CMFCore.FSPageTemplate, line 155, in pt_render
     Module Products.PageTemplates.PageTemplate, line 98, in pt_render
     Module zope.pagetemplate.pagetemplate, line 117, in pt_render
      - Warning: Macro expansion failed
      - Warning: exceptions.KeyError: 'kss_generic_macros'
     Module zope.tal.talinterpreter, line 271, in __call__
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 891, in do_useMacro
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 536, in do_optTag_tal
     Module zope.tal.talinterpreter, line 521, in do_optTag
     Module zope.tal.talinterpreter, line 516, in no_tag
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 957, in do_defineSlot
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 536, in do_optTag_tal
     Module zope.tal.talinterpreter, line 521, in do_optTag
     Module zope.tal.talinterpreter, line 516, in no_tag
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 861, in do_defineMacro
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 957, in do_defineSlot
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 536, in do_optTag_tal
     Module zope.tal.talinterpreter, line 521, in do_optTag
     Module zope.tal.talinterpreter, line 516, in no_tag
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 536, in do_optTag_tal
     Module zope.tal.talinterpreter, line 525, in do_optTag
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 949, in do_defineSlot
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 861, in do_defineMacro
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 536, in do_optTag_tal
     Module zope.tal.talinterpreter, line 521, in do_optTag
     Module zope.tal.talinterpreter, line 516, in no_tag
     Module zope.tal.talinterpreter, line 346, in interpret
     Module zope.tal.talinterpreter, line 870, in do_useMacro
     Module zope.tales.tales, line 696, in evaluate
      - URL: file:/usr/local/www/ZFreia_taka/Plone-3.1.7/Products/CMFPlone/skins/plone_content/folder_listing.pt
      - Line 19, Column 8
      - Expression: <PathExpr standard:u'here/kss_generic_macros/macros/generic_title_view'>
      - Names:
         {'container': <PloneSite at /freia/taka>,
          'context': <PloneSite at /freia/taka>,
          'default': <object object at 0x80110f200>,
          'here': <PloneSite at /freia/taka>,
          'loop': {},
          'nothing': None,
          'options': {'args': ()},
          'repeat': <Products.PageTemplates.Expressions.SafeMapping object at 0x81433eea8>,
          'request': <HTTPRequest, URL=http://192.168.1.2:8980/freia/taka/folder_listing>,
          'root': <Application at >,
          'template': <FSPageTemplate at /freia/taka/folder_listing>,
          'traverse_subpath': [],
          'user': <PloneUser 'taka'>}
     Module zope.tales.expressions, line 217, in __call__
     Module Products.PageTemplates.Expressions, line 155, in _eval
     Module zope.tales.expressions, line 124, in _eval
     Module Products.PageTemplates.Expressions, line 82, in boboAwareZopeTraverse
     Module OFS.Traversable, line 301, in restrictedTraverse
     Module OFS.Traversable, line 284, in unrestrictedTraverse
      - __traceback_info__: ([], 'kss_generic_macros')
   KeyError: 'kss_generic_macros'

kss_generic_macros が無いというようなエラーが出ているけど、まじめに追いかけると時間がかかりそう。多分デザインカスタマイズしてるどこかがまずいんだろうと当たりを付けて、portal_skinsのプロパティーでPloneDefaultにskinを切り替え。これでPloneサイトを表示出来るようになった。デザインカスタマイズを別名で作っておいてよかったー。

Plone-3.1.7 -> 3.3.1
---------------------

3.1.7がとりあえず動いてるっぽいので、そのまま3.3.1へUpgradeを進める。Plone-3.2以降にするにはbuildout化したほうが今後のためにも良いので、 plone.jp や takanory.net などを参考に、buildoutでのインストール、ZopeSkelを使ったPlone3をセットアップする方法などを練習しておく。十分理解できたので本番更新に着手。

まず3.3.1用に新しいディレクトリを作成。そこにZopeSkelで作っておいたbuildout.cfgとbootstrap.pyを持って行く。

buildout.cfg::

   [buildout]
   parts =
       zope2
       productdistros
       instance
       zopepy

   # Change the number here to change the version of Plone being used
   extends = http://dist.plone.org/release/3.3.2/versions.cfg
   versions = versions

   # Add additional egg download sources here. dist.plone.org contains archives
   # of Plone packages.
   find-links =
       http://dist.plone.org/release/3.3.2
       http://download.zope.org/ppix/
       http://download.zope.org/distribution/
       http://effbot.org/downloads

   # Add additional eggs here
   eggs =

   # Reference any eggs you are developing here, one per line
   # e.g.: develop = src/my.package
   develop =


   [zope2]
   # For more information on this step and configuration options see:
   # http://pypi.python.org/pypi/plone.recipe.zope2install
   recipe = plone.recipe.zope2install
   fake-zope-eggs = true
   additional-fake-eggs =
       ZODB3
   url = ${versions:zope2-url}
   location = /usr/local/www/Zope210


   # Use this section to download additional old-style products.
   # List any number of URLs for product tarballs under URLs (separate
   # with whitespace, or break over several lines, with subsequent lines
   # indented). If any archives contain several products inside a top-level
   # directory, list the archive file name (i.e. the last part of the URL,
   # normally with a .tar.gz suffix or similar) under 'nested-packages'.
   # If any archives extract to a product directory with a version suffix, list
   # the archive name under 'version-suffix-packages'.
   [productdistros]
   # For more information on this step and configuration options see:
   # http://pypi.python.org/pypi/plone.recipe.distros
   recipe = plone.recipe.distros
   urls =
   nested-packages =
   version-suffix-packages =

   [instance]
   # For more information on this step and configuration options see:
   # http://pypi.python.org/pypi/plone.recipe.zope2instance
   recipe = plone.recipe.zope2instance
   zope2-location = ${zope2:location}
   user = admin:admin
   http-address = 8980

   # If you want Zope to know about any additional eggs, list them here.
   # This should include any development eggs you listed in develop-eggs above,
   # e.g. eggs = Plone my.package
   eggs =
       Plone
       ${buildout:eggs}


   # If you want to register ZCML slugs for any packages, list them here.
   # e.g. zcml = my.package my.other.package
   zcml =

   products =
       ${buildout:directory}/products
       ${productdistros:location}

   [zopepy]
   # For more information on this step and configuration options see:
   # http://pypi.python.org/pypi/zc.recipe.egg
   recipe = zc.recipe.egg
   eggs = ${instance:eggs}
   interpreter = zopepy
   extra-paths = ${zope2:location}/lib/python
   scripts = zopepy

書き換えた箇所は、ploneのバージョン値を3.3.1から3.3.2にしたくらい。

buildout実行::

   $ sudo -u www -H python bootstrap.py
   $ sudo -u www -H bin/buildout -v

既存のProductsを移行::

   $ sudo -u www mkdir products
   $ sudo -u www cp -R ../old/Products/* products

移行しなくて良さそうなプロダクトを削除::

   $ sudo -u www rm -Rf products/AdvancedQuery
   $ sudo -u www rm -Rf products/CallProfiler
   $ sudo -u www rm -Rf products/Hotfix_20070320
   $ sudo -u www rm -Rf products/WingDBG

既存のvarを移行::

   $ sudo -u www cp ../old/var/Data.fs var/filestorage/
   $ sudo -u www cp ../old/var/counter* var/filestorage/

起動::

   $ sudo -u www -H bin/instance fg


ここでエラーが発生。

エラー１: pymeterが無い -> 呼出元を削除::

   $ sudo -u www rm -Rf Products/ZWeatherApplet

エラー２: .python-egg/ を作れない::

   The following error occurred while trying to extract file(s) to the Python egg
   cache:

     [Errno 13] Permission denied: '/nonexistent'

   The Python egg cache directory is currently set to:

     /nonexistent/.python-eggs

   Perhaps your account does not have write access to this directory?  You can
   change the cache directory by setting the PYTHON_EGG_CACHE environment
   variable to point to an accessible directory.

自分の環境(FreeBSD)のwwwはHOMEが/nonexistentだったので、これをvipwコマンドで/usr/local/wwwに変更。対応方法としてPYTHON_EGG_CACHE環境変数を使う方法もあるけど、rc.dで起動する時のことを考えて...いやrc.dでの起動スクリプトに環境変数設定すればいいのか？まあいいや。

HOME=/usr/local/www/ でここにwwwが書き込み権限のある状態にして再度起動::

   $ sudo -u www -H bin/instance fg


起動したのでmigration実行. 3.1.7 -> 3.3.2 ::

   Plone Migration Tool at  /freia/taka/portal_migration
   Result of the attempt...

   Dry run selected.
   Starting the migration from version: 3.1.7
   Attempting to upgrade from: 3.1.7
   Upgrade to: 3.2a1, completed
   Attempting to upgrade from: 3.2a1
   Upgrade to: 3.2rc1, completed
   Attempting to upgrade from: 3.2rc1
   Upgrade to: 3.2, completed
   Attempting to upgrade from: 3.2
   Upgrade to: 3.2.1, completed
   Attempting to upgrade from: 3.2.1
   Upgrade to: 3.2.2, completed
   Attempting to upgrade from: 3.2.2
   Upgrade to: 3.2.3, completed
   Attempting to upgrade from: 3.2.3
   Upgrade to: 3.3b1, completed
   Attempting to upgrade from: 3.3b1
   Upgrade to: 3.3rc1, completed
   Attempting to upgrade from: 3.3rc1
   Upgrade to: 3.3rc2, completed
   Attempting to upgrade from: 3.3rc2
   Upgrade to: 3.3rc3, completed
   Attempting to upgrade from: 3.3rc3
   Upgrade aborted
   Error type: exceptions.AttributeError
   Error value: 'NoneType' object has no attribute 'strip'
   File "/var2/www/ZFreia_taka/eggs/Plone-3.3.2-py2.4.egg/Products/CMFPlone/MigrationTool.py", line 210, in upgrade newv, msgs = self._upgrade(newv)
   File "/var2/www/ZFreia_taka/eggs/Plone-3.3.2-py2.4.egg/Products/CMFPlone/MigrationTool.py", line 321, in _upgrade res = function(self.aq_parent)
   File "/var2/www/ZFreia_taka/eggs/Plone-3.3.2-py2.4.egg/Products/CMFPlone/migrations/v3_3/__init__.py", line 12, in three3_rc3_three3_rc4 cookCSSRegistries(portal)
   File "/var2/www/ZFreia_taka/eggs/Plone-3.3.2-py2.4.egg/Products/CMFPlone/migrations/v3_3/__init__.py", line 25, in cookCSSRegistries resource.getCookedExpression()
   File "/var2/www/ZFreia_taka/eggs/Products.ResourceRegistries-1.5.3-py2.4.egg/Products/ResourceRegistries/tools/BaseRegistry.py", line 115, in getCookedExpression expr = Expression(self._data['expression'])
   File "/var2/www/ZFreia_taka/eggs/Products.CMFCore-2.1.2-py2.4.egg/Products/CMFCore/Expression.py", line 37, in __init__ if text.strip():
   End of upgrade path, migration has finished
   The upgrade path did NOT reach current version
   Migration has failed
   Dry run selected, transaction aborted

またエラー！

今度のエラーはResourceRegistries関連らしい。これはResourceRegistries/tools/BaseRegistryのgetCookedExpressionメソッド実装を見ないと分からない。

BaseRegistry.py の getCookedExpression::

    security.declarePublic('getCookedExpression')
    def getCookedExpression(self):
        # Automatic inline migration of expressions
        if 'cooked_expression' not in self._data:
            expr = Expression(self._data['expression'])
            self._data['cooked_expression'] = expr
        return self._data['cooked_expression']

これを見ると self._data['expression'] が None を返しているために Expression クラスインスタンスの作成で失敗しているようだ。じゃあ self._data['expression'] のデフォルト値は何が適切かというと、 BaseRegistry.py の __init__ を見る限り、以下のように''で良いらしい::

    def __init__(self, id, **kwargs):
        self._data = PersistentMapping()
        ...
        expression = kwargs.get('expression', '')
        self.setExpression(expression)

ということで、115行目を以下のように書き換えてマイグレーションすることにした::

    def getCookedExpression(self):
        # Automatic inline migration of expressions
        if 'cooked_expression' not in self._data:
            self.setExpression(self._data['expression'] or '')
        return self._data['cooked_expression']


再起動してもっかいマイグレーション(dry-run)::


   Plone Migration Tool at  /freia/taka/portal_migration
   Result of the attempt...

   Dry run selected.
   Starting the migration from version: 3.1.7
   Attempting to upgrade from: 3.1.7
   Upgrade to: 3.2a1, completed
   Attempting to upgrade from: 3.2a1
   Upgrade to: 3.2rc1, completed
   Attempting to upgrade from: 3.2rc1
   Upgrade to: 3.2, completed
   Attempting to upgrade from: 3.2
   Upgrade to: 3.2.1, completed
   Attempting to upgrade from: 3.2.1
   Upgrade to: 3.2.2, completed
   Attempting to upgrade from: 3.2.2
   Upgrade to: 3.2.3, completed
   Attempting to upgrade from: 3.2.3
   Upgrade to: 3.3b1, completed
   Attempting to upgrade from: 3.3b1
   Upgrade to: 3.3rc1, completed
   Attempting to upgrade from: 3.3rc1
   Upgrade to: 3.3rc2, completed
   Attempting to upgrade from: 3.3rc2
   Upgrade to: 3.3rc3, completed
   Attempting to upgrade from: 3.3rc3
   Upgrade to: 3.3rc4, completed
   Attempting to upgrade from: 3.3rc4
   Upgrade to: 3.3rc5, completed
   Attempting to upgrade from: 3.3rc5
   Upgrade to: 3.3, completed
   Attempting to upgrade from: 3.3
   Upgrade to: 3.3.1, completed
   Attempting to upgrade from: 3.3.1
   Upgrade to: 3.3.2, completed
   Attempting to upgrade from: 3.3.2
   Migration completed at version 3.3.2.
   End of upgrade path, migration has finished
   Your ZODB and Filesystem Plone instances are now up-to-date.
   Dry run selected, transaction aborted


成功した！本実行::

   Plone Migration Tool at  /freia/taka/portal_migration
   Result of the attempt...

   Starting the migration from version: 3.1.7
   Attempting to upgrade from: 3.1.7
   Upgrade to: 3.2a1, completed
   Attempting to upgrade from: 3.2a1
   Upgrade to: 3.2rc1, completed
   Attempting to upgrade from: 3.2rc1
   Upgrade to: 3.2, completed
   Attempting to upgrade from: 3.2
   Upgrade to: 3.2.1, completed
   Attempting to upgrade from: 3.2.1
   Upgrade to: 3.2.2, completed
   Attempting to upgrade from: 3.2.2
   Upgrade to: 3.2.3, completed
   Attempting to upgrade from: 3.2.3
   Upgrade to: 3.3b1, completed
   Attempting to upgrade from: 3.3b1
   Upgrade to: 3.3rc1, completed
   Attempting to upgrade from: 3.3rc1
   Upgrade to: 3.3rc2, completed
   Attempting to upgrade from: 3.3rc2
   Upgrade to: 3.3rc3, completed
   Attempting to upgrade from: 3.3rc3
   Upgrade to: 3.3rc4, completed
   Attempting to upgrade from: 3.3rc4
   Upgrade to: 3.3rc5, completed
   Attempting to upgrade from: 3.3rc5
   Upgrade to: 3.3, completed
   Attempting to upgrade from: 3.3
   Upgrade to: 3.3.1, completed
   Attempting to upgrade from: 3.3.1
   Upgrade to: 3.3.2, completed
   Attempting to upgrade from: 3.3.2
   Migration completed at version 3.3.2.
   End of upgrade path, migration has finished
   Your ZODB and Filesystem Plone instances are now up-to-date.

成功！

サイト設定画面の表示::

   Plone 3.3.2
   CMF 2.1.2
   Zope (Zope 2.10.9-final, python 2.4.4, freebsd7)
   Python 2.4.4 (#2, Oct 26 2008, 05:45:29) [GCC 4.2.1 20070719 [FreeBSD]]
   PIL 1.1.6



まとめ
--------

* 使っていないプロダクトはアップグレード前に外しておく
   * CMFContentPanels (Plone3系で非対応? 要アップグレード前アンインストール)
   * AdvancedQuery (Plone本体に入ってた)
   * CallProfiler (本番環境にはいらない)
   * WingDBG (本番環境にはいらない)
   * ZWeatherApplet (以前 COREBlog1と連携して使っていた)
* 残すプロダクトは必要に応じてソース改造が必要(import元の変更など)
* カスタマイズしたskinは一度捨てる方向で(楽なので).
* Products.ResourceRegistries/tools/BaseRegistryの改造が必要.

* 残件、次の作業
   * productsにコピーした古いプロダクトをbuildoutへの記載に移行してupgradeする
   * 不要になったProductsを削除して/Control_Panel/Productsから削除する



:comments:
:comment id: 2010-03-23.4837853974
:title: Re:清水川Webを Plone-2.5.2-1 から Plone-3.3.2 にアップグレード
:author: marcellobs
:date: 2010-03-23 23:28:04
:email: mbsalgueiro@linuxmail.org
:url: www.tranqueira.net/weblog
:body:
Hi, thanks for the post, this post help me with migration from plone 3.0.6 to 3.3.4 and work fine
for me this tick! =)
This is a bug from portal_migration!? Did you ask this for plone developer community??

thanks,

Marcello.

:comments:
:comment id: 2010-03-24.6510330749
:title: Re:清水川Webを Plone-2.5.2-1 から Plone-3.3.2 にアップグレード
:author: shimizukawa
:date: 2010-03-24 02:00:51
:email: 
:url: 
:body:
It's happy that my article was helpful for you :-)

> This is a bug from portal_migration!?

Probably, Expression class doesn't assume None value.
(not a portal_migration's bug)

> Did you ask this for plone developer community??

No, I didn't do it.


報告する時間が欲しい...
%%%%%%%%%

:id: 686
:date: 2009-11-24 21:35:00
:title: Plone-3.3.2 にアップグレードして公開
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
一つ前のエントリ `清水川Webを Plone-2.5.2-1 から Plone-3.3.2 にアップグレード`_ の手順ほぼそのままでアップグレードがうまくいったので、今朝方切り替えました。とりあえず見た目はなんにも変わりませんが、そのへんはそのうち。

.. _`清水川Webを Plone-2.5.2-1 から Plone-3.3.2 にアップグレード`: 685


続きは以下から。


:extend type: text/x-rst
:extend:
移行後の後始末
----------------------

起動中に PlacelessTranslationService が以下のようなメッセージを表示する::

   2009-11-23 13:39:23 INFO PlacelessTranslationService You have a stale entry for 'Products.CacheSetup' in your ZMI Products section.You should consider removing it.

既に削除されたプロダクトがZMIのControl_panel/Productsに残っているので、手動で削除する。今回の対象は以下の通り::

   CMFContentPanels
   CMFContentPanelsCB2Viewlet
   CMFSquidTool
   CacheSetup
   CallProfiler
   DDocument
   ExtImageDirective
   FCKeditor
   Hotfix_20060705
   Hotfix_20070320
   MJSplitter
   PloneErrorReporting
   PloneHotfix20060410
   PloneHotfix20060518
   PloneJSOrder
   PloneSVNView
   PloneTranslations
   VerboseSecurity
   WingDBG
   ZWeatherApplet
   ZopeTutorial


portal_skinsに残ってしまっている古いProductのskinを削除
-------------------------------------------------------

Ploneのページを表示するとコンソールに以下のように表示される::

   Products/CMFCore/DirectoryView.py:497: UserWarning:
   DirectoryView contentpanels refers to a non-existing path
   'Products.CMFContentPanels:skins/contentpanels'

同様に表示されれる以下のフォルダをportal_skinsから削除::

   'Products.CMFContentPanels:skins/contentpanels'
   'Products.CMFContentPanels:skins/cp_viewlets'
   'Products.CMFContentPanelsCB2Viewlet:skins/cp_cb2_viewlets'
   'PloneErrorReporting/skins/plone_error_reporting'


実行中に表示されるerrorを修正する
----------------------------------

CMFContentPanelsやPloneSVNViewをアンインストールせずに削除したため、portal_typesなどに情報が残っている。これを削除。
今回は portal_types にあった以下のフォルダを削除した::

   ContentPanels
   SVN View

また、portal_quickinstallerにある削除したはずのプロダクトを手動削除した::

   CMFContentPanels
   CMFContentPanelsCB2Viewlet
   PloneErrorReporting
   PloneJSOrder
   PloneSVNView


この流れで、 portal_javascripts と portal_css を確認したところ、リソースが無くなっている項目がいくつかあったので、手動削除した。


使われてないと思われるプロダクトを削除
---------------------------------------

ZMIのfindタブを使えば、特定のコンテンツタイプがDB内に存在するか調べることが出来る(一部例外あり)。これで例えばCOREBlogは全部COREBlog2に移行済みのはずだけど残ってないかな？といった状況で探すことが出来る。

今回探したもの::

   COREBlog           -> 実験用オブジェクト有り
   ATExtFlash         -> 無し
   CMFDynamicDocument -> 無し
   SilverCityDocument -> 無し
   ZAmazon            -> 実験用オブジェクト有り

しかし、上記で「無し」になっているインスタンスは実在しているのに、なぜか検索に出てこない。Zopeのdebugコンソールで起動してオブジェクト種別で検索する方法もあるけど、今回は1,2カ所くらいでしか使用していないことが分かっているので手動で対応した。

::

   COREBlog           -> 実験用オブジェクト有り -> 削除
   ATExtFlash         -> 無し -> 実際は有り -> そのまま使用
   CMFDynamicDocument -> 無し -> 実際は有り -> 削除
   SilverCityDocument -> 無し -> 実際は有り -> 削除
   ZAmazon            -> 実験用オブジェクト有り -> 削除


あと ejSplitter は以前 CJKSplitter に移行していたので、 portal_catalog の indexes で ZCTextIndex で参照されていないことを確認した上でcontentsタブでlexiconを削除。

最後にプロダクトを削除::

   $ sudo -u www rm -Rf CMFDynamicDocument
   $ sudo -u www rm -Rf FSCounter
   $ sudo -u www rm -Rf SilverCityDocument
   $ sudo -u www rm -Rf ZAmazon
   $ sudo -u www rm -Rf ejSplitter


products内の古いプロダクトをbuildoutへの記載に移行してupgradeする
--------------------------------------------------------------------------

いくつかのプロダクトがPyPIで提供されているので、buildout.cfgに記載しproductsから削除してバージョンアップすることにする。
目的のプロダクトがPyPIで提供されているかどうかを調べるためには http://pypi.python.org/simple/ を見表示してブラウザの検索機能を使うと早い。

:ATAlbumViewEx:
   Ploneのサムネイル表示で画像をlightbox表示するプロダクト。
   PyPIの Products.PloneSlimbox に移行。

:LDAPMultiPlugins:
   PyPIの Products.LDAPMultiPlugins に移行。

:LDAPUserFolder:
   PyPIの Products.LDAPUserFolder に移行。

:jaMailHost:
   とりあえずjaMailHostは削除。smtpにGMailを使用しているが問題なさそう。
   PyPIの c2.patch.plone3mail を使うべきか要検討。


上記を行う前に、LDAP認証関連が含まれているので、念のため Data.fs をpackしてバックアップしておいた。

Zopeを停止して、 buildout.cfg の eggs に以下を追記::

   eggs =
       Products.LDAPMultiPlugins
       Products.LDAPUserFolder
       Products.PloneSlimbox

移行したプロダクトを削除、 bin/buildout 実行、起動::

   $ cd products
   $ sudo -u www rm -Rf LDAPMultiPlugins
   $ sudo -u www rm -Rf LDAPUserFolder
   $ cd ..
   $ sudo -u www -H bin/buildout -v
   $ sudo -u www -H bin/instance fg

実はbuildout中に python-ldap-2.3.10 のビルド中に `LDAP_OPT_X_TLS_NEWCTX の問題`_ で止まってしまったけど、ググってコード書き換えてeggを手動で作成して解決したりなどした。

.. _`LDAP_OPT_X_TLS_NEWCTX の問題`: http://www.mail-archive.com/python-ldap-dev@lists.sourceforge.net/msg00717.html


もしかしたら役に立つかも知れない情報１
------------------------------------------

このサイトで使用していたプロダクトのバージョン

========================== ============ ============= ========================
Product name               Plone-2.5.2  Plone-3.3.2   Plone-3.3.2
========================== ============ ============= ========================
ATAlbumViewEx              0.2.1        ->            -> PloneSlimbox へ移行
ATBookshelf                0.0.2        ->            自作:どうしよう
ATExtFlash                 0.1          ->            自作:要Plone3対応
AdvancedQuery              0.6          plone include
CJKSplitter                0.7.3        ->            ->
CMFContentPanels           2.3          removed       removed
CMFContentPanelsCB2Viewlet svn          removed       removed
CMFDynamicDocument         1.1.2        ->            removed
COREBlog                   1.21         removed       removed
COREBlog2                  0.9b         9.83b         ->
CallProfiler               1.4(w/fixes) removed       removed
FSCounter                  1.4.0        ->            removed
Hotfix_20070320            20070320     removed       removed
ImageTag_CorePatch         0.3          ->            (need remove)
LDAPMultiPlugins           1.1          ->            pypi 1.8
LDAPUserFolder             2.6          ->            pypi 2.13
LocalFS                    1.7-andreas  ->            ->
MultiPatch                 2005/2/20    ->            (need modify)
MyScriptModules            2007/2/25    ->            (need modify)
PloneSlimbox               x            x             0.6
PloneFlashUpload           x            x             1.3b1
QuickImporter              0.2          ->            ->
SilverCityDocument         0.0.5        ->            removed
WingDBG                    WingIDE2.0.2 removed       removed
ZAmazon                    0.1          ->            removed
ZSilverCity                0.2-mod      ->            ->
ZWeatherApplet             1.51         removed       removed
ZWiki                      0.47.0       ->            (need update)
ZrstAmazon                 0.0.1        ->            自作:このまま
ZrstIFrame                 0.1          ->            自作:このまま
ejSplitter                 0.5.0        ->            removed
jaMailHost                 0.4.4        ->            removed
========================== ============ ============= ========================



もしかしたら役に立つかも知れない情報２
------------------------------------------

このサイトの環境を用意する ``buildout.cfg`` ::

  [buildout]
  parts =
      zope2
      productdistros
      instance
      zeoserver
      zopepy
  
  # Change the number here to change the version of Plone being used
  extends = http://dist.plone.org/release/3.3.2/versions.cfg
  versions = versions
  
  # Add additional egg download sources here. dist.plone.org contains archives
  # of Plone packages.
  find-links =
      http://dist.plone.org/release/3.3.2
      http://download.zope.org/ppix/
      http://download.zope.org/distribution/
      http://effbot.org/downloads
  
  # Add additional eggs here
  eggs =
      Products.LDAPMultiPlugins
      Products.LDAPUserFolder
      Products.PloneFlashUpload
      Products.PloneSlimbox
      Products.LinguaPlone
  
  # Reference any eggs you are developing here, one per line
  # e.g.: develop = src/my.package
  develop =
  
  
  
  [settings]
  effective-user = www
  http-port = 8180
  zeo-port = 8181
  initial-user = admin:admin
  
  
  
  [zope2]
  # For more information on this step and configuration options see:
  # http://pypi.python.org/pypi/plone.recipe.zope2install
  recipe = plone.recipe.zope2install
  fake-zope-eggs = true
  additional-fake-eggs =
      ZODB3
  url = ${versions:zope2-url}
  location = /usr/local/www/Zope210
  
  
  # Use this section to download additional old-style products.
  # List any number of URLs for product tarballs under URLs (separate
  # with whitespace, or break over several lines, with subsequent lines
  # indented). If any archives contain several products inside a top-level
  # directory, list the archive file name (i.e. the last part of the URL,
  # normally with a .tar.gz suffix or similar) under 'nested-packages'.
  # If any archives extract to a product directory with a version suffix, list
  # the archive name under 'version-suffix-packages'.
  [productdistros]
  # For more information on this step and configuration options see:
  # http://pypi.python.org/pypi/plone.recipe.distros
  recipe = plone.recipe.distros
  urls =
  nested-packages =
  version-suffix-packages =
  
  [instance]
  # For more information on this step and configuration options see:
  # http://pypi.python.org/pypi/plone.recipe.zope2instance
  recipe = plone.recipe.zope2instance
  zope2-location = ${zope2:location}
  user = ${settings:initial-user}
  http-address = ${settings:http-port}
  
  # If you want Zope to know about any additional eggs, list them here.
  # This should include any development eggs you listed in develop-eggs above,
  # e.g. eggs = Plone my.package
  eggs =
      Plone
      ${buildout:eggs}
      
  
  # If you want to register ZCML slugs for any packages, list them here.
  # e.g. zcml = my.package my.other.package
  zcml =
  
  products =
      ${buildout:directory}/products
      ${productdistros:location}
  
  effective-user = ${settings:effective-user}
  
  # for zeo
  zeo-client = true
  zeo-address = ${zeoserver:zeo-address}
  zeo-client-cache-size = 300MB
  
  zodb-temporary-storage =
      <zodb_db temporary>
        <zeoclient>
          server ${zeoserver:zeo-address}
          storage temp
          name zeostorage
          var ${buildout:directory}/var/filestorage
        </zeoclient>
        mount-point /temp_folder
        container-class Products.TemporaryFolder.TemporaryContainer
      </zodb_db>
  
  
  [zeoserver]
  recipe = plone.recipe.zope2zeoserver
  zope2-location = ${zope2:location}
  eggs = ${buildout:eggs}
  effective-user = ${settings:effective-user}
  zeo-address = 127.0.0.1:${settings:zeo-port}
  zeo-conf-additional =
       %import tempstorage
       <temporarystorage temp>
           name temp storage for sessioning
       </temporarystorage>
  
  
  [zopepy]
  # For more information on this step and configuration options see:
  # http://pypi.python.org/pypi/zc.recipe.egg
  recipe = zc.recipe.egg
  eggs = ${instance:eggs}
  interpreter = zopepy
  extra-paths = ${zope2:location}/lib/python
  scripts = zopepy



移行後のデザイン適用
-------------------------

* Plone3.3の流儀でheader/footer/cssのデザイン適用をやりなおした
* COREBlog2のportletをクラシックポートレットとして手動で適用
* エレメントの構成が一部変わっていたのでcssを数カ所修正


今後の作業
--------------

いくつかの問題を修正しなくてはいけない。

* COREBlog2のカレンダー表示が月変更出来ない
* ZWikiページが見れない
* 本棚ページの詳細が見れない
* ATExtFlashをPlone3対応しないといけない

あとは未来への展望

* Deliveranceかcollective.xdvでデザイン適用する
* plone.app.blob 導入で高速化(?)
* CacheFo 導入で高速化
* Vernish 導入で高速化


:comments:
:comment id: 2009-12-03.4889273535
:title: Re:Plone-3.3.2 にアップグレードして公開
:author: akiko
:date: 2009-12-03 08:44:50
:email: akiko@kk.iij4u.or.jp
:url: 
:body:
 清水川さま、こんにちは。 
Ploneに関わってから、ずっとこちらを参考にさせていただいております。 
Ploneのアップグレードの記事も、大変参考になります。ありがとうございます。 
※コメントのテスト用に再度投稿させていただきます。
（不要でしたら、削除いただければ幸いです）

実は、今朝同僚のCOREBlog2のデータを移行したのですが、やはりカレンダーが前後に切り替わってくれません。 
私自身の分は、先行してテストしていたんですが、 Plone3.2, Plone3.3でも動かない状態です。 
instance.log に、DEBUGの情報が出ているので、このあたりなんだろうな....とは思っていますが、手が出せません(^^; 
-------------- 
2009-11-27T10:11:02 INFO Plone Debug: The getPreviousMonth script is deprecated and will be removed in Plone 4.0. Use the getPreviousMonth method of the @@calendar_view view instead. 
-------------- 

Plone3は、インストーラーにまかせて作ってしまい、buildoutのこととかまったく理解していなかったので、意外に苦労しています。
今の環境を、ちゃんと理解したうえで作り直したいと思っているので、buildoutの設定なども、大変参考になりました。


なお、varnishはわたしも入れてみました。
でも、なにやらイタズラもあって、一筋縄ではいきません...。

%%%%%%%%%

:id: 687
:date: 2009-12-01 23:55:00
:title: COREBlog2をPlone3で動かすための修正: portletのカレンダー
:categories: ['Plone']
:body type: text/x-rst
:body:
`Plone-3.3.2 にアップグレードして公開`_ したときの課題として、 "COREBlog2のカレンダー表示が月変更出来ない" というものがありました。これを修正する方法が分かりました。

:対象: `COREBlog2_nightly.tgz`_ (2008/10時点)
:Plone: Plone-3.3.2

.. _`Plone-3.3.2 にアップグレードして公開`: http://www.freia.jp/taka/blog/686
.. _`COREBlog2_nightly.tgz`: http://coreblog.org/junk_l/COREBlog2_nightly.tgz


まず原因ですが、COREBlog2のポートレット表示用カレンダーは ``skins/COREBlog2/portlet_coreblogcalendar.pt`` というテンプレートで表示されます。ここで表示対象月を決めている変数が year, month なのですが、この変数の初期化時に ``options/year`` に年が設定されていないため、現在の日付を元にカレンダー表示されてしまっているようです。ここで使われている options 変数は  ``skins/COREBlog2/archives.py`` の最終行で cbarchive_view.pt に渡されていますが、これがどうやらportletには渡ってこないようです。（どこかにこの仕様変更について情報がないか探してみたのですが、見あたりませんでした）

この問題の修正の方針は3つあります。

1. Plone3向けのportletを書く
2. portlet_coreblogcalendar.pt 内でoptionsに頼らずにyear,monthを取得する
3. archives.py でrequest変数にyear,monthを設定しておいてportlet_coreblogcalendar.ptで使う

今回は2の方法で対応してみます。



:extend type: text/x-rst
:extend:
2. portlet_coreblogcalendar.pt 内でoptionsに頼らずにyear,monthを取得する
----------------------------------------------------------------------------

まず、 portlet_coreblogcalendar.pt をカスタマイズフォルダ(portal_skins/custom)に複製します。そして以下のように修正します::

     tal:define="DateTime python:modules['DateTime'].DateTime;
                 current python:DateTime();
    -            yearmonth here/getYearAndMonthToDisplay;
    -            year options/year | python:yearmonth[0];
    -            month options/month | python:yearmonth[1];
    +            yearmonth python:here.cbcalendar_date() or here.getYearAndMonthToDisplay();
    +            year python:yearmonth[0];
    +            month python:yearmonth[1];
                 prevMonthTime python:here.getPreviousMonth(month, year);
                 nextMonthTime python:here.getNextMonth(month, year);

次に、上記の書き換えで呼び出されることになった cbcalendar_date はまだどこにも存在していないので、このスクリプトを用意します。portal_skins/customフォルダで "Script(Python)" を新規追加して、名前を 'cbcalendar_date' として以下の内容を記載します。

.. code-block:: Python

  request = container.REQUEST
  sub_traverse = request.ACTUAL_URL[len(request.URL):].strip('/').split('/')
  isArchive = request.URL.split('/')[-1] == 'archives' and sub_traverse

  if isArchive:
      yearmonth = [
          int(sub_traverse[0]),
          int(sub_traverse[1]),
      ]
      return yearmonth

  else:
      return None

これでカレンダーを次月、前月に遷移できるようになると思います。



:comments:
:comment id: 2009-12-03.3357855840
:title: Re:COREBlog2をPlone3で動かすための修正: portletのカレンダー
:author: akiko
:date: 2009-12-03 09:48:57
:email: 
:url: 
:body:
コメントを書いた後に発見しました。
（すごい！）
ありがとうございます、早速自分のサイトでも試してみます！


:comments:
:comment id: 2010-06-30.1763376748
:title: Re:COREBlog2をPlone3で動かすための修正: portletのカレンダー
:author: akiko
:date: 2010-06-30 14:19:37
:email: 
:url: 
:body:
Plone3.3.5にしたら、WARNINGが出て、カレンダーポートレットの描画もうまくできませんでした。

yearmonth python:here.cbcalendar_date() or here.getYearAndMonthToDisplay();
を、
yearmonth python:here.cbcalendar_date() or context.restrictedTraverse('@@calendar_view').getYearAndMonthToDisplay();
に変えてみたら、動くようになりました。

また、前後の月は、下記のようにしてみました。
prevMonthTime python:context.restrictedTraverse('@@calendar_view').getPreviousMonth(month, year);
nextMonthTime python:context.restrictedTraverse('@@calendar_view').getNextMonth(month, year);

正しいのかどうかは判らないのですが...。
%%%%%%%%%

:id: 688
:date: 2009-12-02 23:00:00
:title: Zopeのdebugコンソールをipython化する
:categories: ['Zope']
:body type: text/x-rst
:body:
`Zope/Ploneアドベントカレンダーをtakanoryさんにお願いされた`_ ので2日目を担当します。Zopeのdebugコンソールをipython化します。

とりあえずipythonはインストール済み( easy_install ipython )ということにしておきます。

まず ``bin/zopectl debug`` コマンドで起動します。最近のPloneなら ``bin/instance debug`` ですね。次に起動したインタラクティブシェル上で以下のように入力します::

  >>> import IPython
  >>> IPython.Shell.IPShell(user_ns=locals()).mainloop(sys_exit=1)

これ以降の対話はipythonで行われるようになります。お手軽ですね！以下は実際にやってみたときの画面キャプチャ（見やすくするためにちょっと加工）。出力結果が自動的pprintされるので見やすくなっていますね。

.. figure:: images/20091202-zope-ipython1.png

  bin/instance debug 後にipython化する例

pyreadline_ がインストールしてあるとタブ補完も使えるようになります。

.. figure:: images/20091202-zope-ipython2.png

  ipython+pyreadlineでタブ補完する


ipythonの機能で、オブジェクトの後ろに `?` を付けると、型やソースの場所、doc stringが表示されます。さらに `??` (ハテナ２つ）を付けるとソースコードまで表示されます。とっても便利ですね。

.. figure:: images/20091202-zope-ipython3.png

  オブジェクトの後ろに?を付けると...


次はこれを ``import IPython`` 等せずに ``bin/zopectl debug`` 起動したら最初からipythonシェルにする方法を書こうと思ったのですが、時間切れで間に合わず＞＜ 



次のバトンは `田原悠西の日記`_ の田原さんです。よろしくー。


.. _`Zope/Ploneアドベントカレンダーをtakanoryさんにお願いされた`: http://takanory.net/takalog/1186#comments

.. _pyreadline: http://ipython.scipy.org/moin/PyReadline/Intro

.. _`田原悠西の日記`: http://yusei.tdiary.net/


関連するサイト
--------------

* `IPythonを使ってZope3デバッグ`_
* `Zope 2 wiki DebuggingWithIPythonAndOtherTips`_
* `Install and setup ipython for zope`_

.. _`IPythonを使ってZope3デバッグ`: http://makunouchi.jp/zope3/9900417093
.. _`Install and setup ipython for zope`: http://plone.org/documentation/how-to/setup-ipython-for-zope
.. _`Zope 2 wiki DebuggingWithIPythonAndOtherTips`: http://wiki.zope.org/zope2/DebuggingWithIPythonAndOtherTips


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2009-12-03.8209297329
:title: Re:Zopeのdebugコンソールをipython化する
:author: Tahara
:date: 2009-12-03 00:13:41
:email: yusei@domen.cx
:url: 
:body:
お願いされた！笑

%%%%%%%%%

:id: 689
:date: 2009-12-03 23:55:00
:title: COREBlog2をPlone3で動かすための修正: コメント時のメール送信
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
12/4修正。間違いが多かったため書き直しました。Plone3やZope2.10系の問題だと書いていたのですが、Zope2.9.10 + Plone-2.5.5でも発生します。

------------------------

`Plone-3.3.2 にアップグレードして公開`_ したときの課題からは抜けていたのですが（今日気づいた）、COREBlog2を setdefaultencoding('utf-8') 無しで動かしたとき、そのままではコメント時やトラックバック時にメール送信が行われない場合があります。

:対象: `COREBlog2_nightly.tgz`_ (2008/10時点)
:Plone: Plone-3.3.2
:Zope: Zope-2.10.9

.. _`Plone-3.3.2 にアップグレードして公開`: http://www.freia.jp/taka/blog/686
.. _`COREBlog2_nightly.tgz`: http://coreblog.org/junk_l/COREBlog2_nightly.tgz

以前の環境でエラー無くメール送信が行われていた理由は、 sitecustomize.py に ``sys.setdefaultencoding('uft-8')`` と書いていたためだと思います。今回の環境では sitecustomize.py 無しで動かそうとしているので、translateメソッドからUnicodeオブジェクトが返ってくるのと、REQUESTからの値を結合しようとしたときに、予期しないUnicodeDecodeErrorとなったためです。

という前置きはさておき、修正方法。

skins/COREBlog2/cbaddComment::

        to_addr   = context.getNotify_to()
        from_addr = context.getNotify_to()
      - msgbody = context.translate(msgid='comment_notify_body')
      + msgbody = context.translate(msgid='comment_notify_body').decode('utf-8')
        elements = {}
        for k in ('title','author','url','body'):
            if REQUEST.form.has_key(k):
                elements[k] = REQUEST.form[k]
            else:
                elements[k] = ''
        elements['post_ip'] = REQUEST.getClientAddr()
        elements['entry_url'] = context.absolute_url()
        msgbody = msgbody % (elements)
      - msgsubject = context.translate('comment_notify_title')
      + msgsubject = context.translate('comment_notify_title').decode('utf-8')
        mgsheader = """To: %s

同様に skins/COREBlog2/tbping も ``translate`` しているところを修正します。

これでコメントが正しくメール通知されるようになりました。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 690
:date: 2009-12-04 00:51:14
:title: Windowsでpyreadlineを使うとCtrl+H押下時にカーソルが進む
:categories: ['python']
:body type: text/x-rst
:body:
この問題はWindows上でIPythonを便利に使おうとすると発現するんじゃないかなと思います。必ず起きるのかどうかは知りませんが、この問題で困ったことがある人は自分以外に一人しか知らないので、レアな組み合わせなんでしょうね...。でももしかしたら `Zopeのdebugコンソールをipython化する`_ を見てやってみようという人が出てくるかも。

現象としては、Backspaceキー押下時にはちゃんとカーソルの前の文字が削除されてカーソルも1文字左に移動するのに、Ctrl+H押下時には、カーソルの前の文字は消えるもののカーソル自体は右に1つ進む、という状況になります。

この問題は以下のパッチで修正出来ます。Ctrl+H押下時にはBackspaceと同等に動作するように書き換えています::

  --- pyreadline/keysyms/keysyms.py.orig
  +++ pyreadline/keysyms/keysyms.py
  @@ -119,6 +119,10 @@
           char = chr(VkKeyScan(ord(char)) & 0xff)
       elif control:
           char=chr(keycode)
  +    if control and ord(char)==8 and keycode==72:
  +        keycode=8
  +        control=False
  +        state &= 0xfffffff7
       try:
           keyname=code2sym_map[keycode]
       except KeyError:


問題と解決方法は2年以上前に把握していたんですが、某所で書いたもののバグ報告していなかったので、 `IPython: Ctrl+H erase previous character, but cursor goes forward.`_ というタイトルでバグ報告してみました（ちょっと失敗してますが..）。こんなまずい英語でもpatchが付いてれば分かってくれるかなー。分かってくれると良いなー。

.. _`Zopeのdebugコンソールをipython化する`: http://www.freia.jp/taka/blog/688

.. _`IPython: Ctrl+H erase previous character, but cursor goes forward.`: https://bugs.launchpad.net/pyreadline/+bug/491941


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2009-12-18.3903854584
:title: Re:Windowsでpyreadlineを使うとCtrl+H押下時にカーソルが進む
:author: 檜山正幸
:date: 2009-12-18 15:39:51
:email: m.hiyama@gmail.com
:url: http://d.hatena.ne.jp/m-hiyama/
:body:
清水川さん、はじめまして。檜山と申します。
CatyというWebフレームワーク（http://d.hatena.ne.jp/m-hiyama/20091215/1260847179）に pyreadline を
同梱して配布しております。
このパッチを適用した keysyms.py も付けたいのですが、いかがでしょう？
README にお名前とURL（http://www.freia.jp/taka/blog/690 ）も記載したいと思いますが、差し障りがございますでしょうか？


:comments:
:comment id: 2009-12-18.6137357278
:title: Catyへの添付OKです！
:author: しみずかわ
:date: 2009-12-18 17:40:15
:email: 
:url: 
:body:
檜山さんこんにちは。CatyはBPStudyで聞きたかったんですが仕事が・・・＞＜

添付はもちろんOKです。
是非ご利用下さい。


:comments:
:comment id: 2009-12-21.7386887801
:title: パッチ使わせていただきます
:author: 檜山正幸
:date: 2009-12-21 08:12:19
:email: m.hiyama@gmail.com
:url: http://d.hatena.ne.jp/m-hiyama/
:body:
清水川さん、
メールにてご返答申し上げましたが、こちらにも； ありがとうございます。


:comments:
:comment id: 2010-07-18.1172560530
:title: pyreadline-1.6対応
:author: しみずかわ
:date: 2010-07-18 13:58:37
:email: 
:url: 
:body:
詳しくはこちら http://www.freia.jp/taka/blog/726

%%%%%%%%%

:id: 691
:date: 2009-12-05 18:50:00
:title: distutils, setuptools, distribute, pip, virtualenv, buildout
:categories: ['Zope', 'python', 'Plone']
:body type: text/x-rst
:body:
今日は `(第6回)Zope/Plone開発勉強会`_ に参加しています。

勉強会中に、結局eggって何？buildoutを使えるようになるにはどうすればいいの？最近たまに聞くpipって何？という質問が出たので、 distutils, setuptools, distribute, pip, virtualenv, buildout について、そろそろ整理しておこうかなーと思ってまとめてみました。

.. _`(第6回)Zope/Plone開発勉強会`: http://atnd.org/events/2258


各パッケージの用途と概要
-------------------------

:distutils:
   Python の標準パッケージです。eggは作れませんが、 ``python setup.py build`` したり、 ``python setup.py install`` したりの機能が提供されています。詳しくは `Pythonのマニュアル`_ を参照のこと...。

.. _`Pythonのマニュアル`: http://www.python.jp/doc/2.5/lib/module-distutils.html

:setuptools:
   setuptools_ はPython 標準の distutils を拡張しています。

   良く使われるのは easy_install コマンドで、 easy_install を使うために ez_setup.py を実行すると、陰でこっそり setuptools がインストールされます。 easy_install は ``easy_install Sphinx`` 等と書くと、PyPI(Python Package Index)から自動的に Sphinx パッケージを探してきて site-packages にインストールしてくれます。

   開発向けには、setuptoolsをインストールすると setup.py に egg を作るための記述が出来るようになり、また、 ``python setup.py bdist_egg`` で egg を作れるようになったり、 ``python setup.py register ...`` でPyPIに登録出来るようになったりします。

   現在の開発状況は、0.6c11 (2009-10-20) までリリースされていますが、 0.6c9 (2008-09-24) から 0.6c10 (2009-10-19) まで1年以上間が空いていて、6個のバグが修正されただけで、実質、開発が止まっているといえるかもしれません。

.. _setuptools: http://pypi.python.org/pypi/setuptools

:distribute:
   distribute_ は setuptools から分岐したプロジェクトです（というかクローンです）。 distribute は将来的に setuptools から置き換えて使えるように設計しています。また、0.6.2までで既存の setuptools との後方互換性対応が完了し、同時に Python3 への対応を始めました。

   distribute をインストールすると、 setuptools がインストール済みの場合、自動的にこれが使われないようにリネームします。インストールされた distribute-0.6.8-py2.6.egg の中には setuptools というパッケージ名が入っているので（と言うか名前なども全部互換なので）、これ以降 ``import setuptools`` 等と実行すると、distributeのコードがimportされるようになります。

   bin/easy_install も distribute を使うように書き換わります。

   Tarek の blog `virtualenv and zc.buildout now with Distribute included`_ から引用:

      Setuptools から Distribute に切り替えるとてもシンプルな理由:

      * Distribute 0.6.x は Setuptools の完全互換性を持っています
      * Distribute は活発にメンテナンスされており、10人以上のコミッターがいます
      * Distribute 0.6.x は Python3 をサポート!

   合わせて読みたい: `Distutils and Distribute status (part #1)`_

.. _distribute: http://pypi.python.org/pypi/distribute
.. _`virtualenv and zc.buildout now with Distribute included`: http://tarekziade.wordpress.com/2009/11/07/virtualenv-and-zc-buildout-now-with-distribute-included/
.. _`Distutils and Distribute status (part #1)`: http://tarekziade.wordpress.com/2009/11/18/distutils-and-distribute-status-part-1/

:pip:
   pip_ は easy_install と同様の機能を提供します。 distribute は setuptools 全体を置き換えようとしていますが、 pip は easy_install コマンドを置き換えようとしています（distribute とは異なり、easy_installを削除したり書き換えたりはしません）。

   pip は easy_install でインストール出来るものは同じようにインストールできます。パッケージ名を指定すれば自動的に PyPI から取ってきてくれたりします。ただし、 easy_install よりも良い動作をするよに設計されていて、複数パッケージを逐次インストールせずに、先にダウンロードしてからインストールを始めるとか、エラーメッセージが親切だとかが考慮されています

   pip の方針として、複数バージョンの共存は行わない設計のため、 pip でインストールする場合は virtualenv の環境下で行うことが推奨されています。なお、 ``pip install -E new-env/ MyPackage`` と実行すれば任意の virtualenv 環境をインストール先に指定できます。また、間違って実環境下で pip install してしまわないように環境変数 ``PIP_REQUIRE_VIRTUALENV=true`` しておく方法も提供されています。

   pip の便利な機能は, uninstall(パッケージのアンインストール), freeze(パッケージ名==Version番号、の羅列がstdoutに表示されます), bundle(対象パッケージがrequireしているパッケージを集めて1つの .pybundle ファイルに固めてくれる) などがあります。 .pybundle に固めたファイルは ``pip install foo.pybundle`` としてインストール出来ます。ソースが全て .pybundle に格納されているためこのとき通信出来なくても問題ありませんが、C拡張などはこの時点でビルドされるためコンパイラや関連ライブラリなどが必要になります。

   現在の所、制限事項も多く、eggパッケージからのインストールは出来ず、ソース提供されているパッケージのみインストール出来るなどがあります（＝バイナリ配布出来ません）。Windowsではテストされておらず、ちょっとしたバグのためにbundleが動作しません。またWindowsでちょっと試してみたところ、C拡張のビルド時にコンパイルエラーになってもインストールが継続してしまうようです。詳しくは pip の `Differences From easy_install`_ の説明を確認して下さい。

   非開発向けの視点からみると pip を使ったインストールはシンプルなので(単一バージョン,eggで固めず全て展開する,名前空間を結合する) 使いやすいという意見もあります。実際、setuptoolsの複数バージョン管理,egg化という複雑さや、jarっぽい設計よりも良いと評価している人もいるようです(`Why I like pip`_)。

.. _pip: http://pypi.python.org/pypi/pip
.. _`Differences From easy_install`: http://pypi.python.org/pypi/pip#differences-from-easy-install
.. _`Why I like pip`: http://www.b-list.org/weblog/2008/dec/15/pip/

:virtualenv:
   VirtualEnv_ はPythonの仮想環境を作ります。それだけですが、非常に便利です。 virtualenvwrapper も合わせて使うと便利らしいです。 workingenv や virtual-python の後継という位置づけのようです。

   virtualenv は標準で setuptools を取ってきてインストールしますが、 ``virtualenv --distribute envdir`` のようにして環境を作ると、 setuptools の代わりに distribute を使ってくれるようになります（環境を作ってから 'easy_install distribute` してもよいです）。

   virtualenv を導入して困ることはほとんど無いと思います。 distribute, pip, buildout, どれもが virtualenv 下で問題無く動作します。ただし、 mod_python や mod_wsgi など、 virtualenv 環境下の bin/python 以外から virtualenv 下のモジュールを呼び出す場合、 `Using Virtualenv without bin/python`_ を参考に多少の設定を行う必要があります。

.. _VirtualEnv: http://pypi.python.org/pypi/virtualenv
.. _`Using Virtualenv without bin/python`: http://pypi.python.org/pypi/virtualenv#using-virtualenv-without-bin-python

:buildout:
   `zc.buildout`_ は Python ベースのビルドシステムです。パーツという単位でアプリケーションを 作成、組み立て、配置などを行い、非Pythonベースのものも構築は可能です。

   buildout 自体は buildout.cfg の設定を元に環境を構築してくれます。処理の実体は buildout 用の recipe と呼ばれるパッケージで実装されていて、PyPIからeggを取ってくる、svnからチェックアウトする、などいろいろなrecipeがあります。 Zope 用としては Zope のインスタンスを作成する、Ploneのサイトインスタンスを作ってProductsをインストールする、などの recipe もあります。

   buildout では Python 本体の site-packages を切り離せないので、その必要がある場合は virtualenv 環境下で buildout を使うようにしましょう。

   buildout 自体は recipe を取ってくるために setuptools を使っていますが、代わりに distribute を使うようにも出来ます (``python bootstrap.py --distribute``)。

   詳しい使い方については `buildoutで開発0: zc.buildout で環境を作る - 清水川Web`_ を参照して下さい。

.. _`zc.buildout`: http://pypi.python.org/pypi/zc.buildout
.. _`buildoutで開発0: zc.buildout で環境を作る - 清水川Web`: http://www.freia.jp/taka/blog/677


各パッケージの現状
-------------------

:distutils:
   :作者: Python コミュニティー
   :PyPI: Python同梱です
   :最新: Python-2.6.x 同梱

:setuptools:
   :作者: Phillip J. Eby (PEAK)
   :PyPI: http://pypi.python.org/pypi/setuptools
   :最新: 0.6c11 (2009/10/20)
   :更新頻度: 低
   :目的: distutilsの拡張, egg作成, PyPIからのインストール
   :弱点: メンテが止まっているように見える、進化がない。

:distribute:
   :作者: Tarek Ziade
   :PyPI: http://pypi.python.org/pypi/distribute
   :最新: 0.6.8 (2009/11/01)
   :更新頻度: 高
   :目的: distutils の拡張。 setuptools の完全置き換え、完全互換。Python3対応(今後)
   :相性: setuptools を使っているのと変わらない使用感。 setuptools を排除する以外はとても良い。 virtualenv や buildout で最初から distribute を使うためのオプション(``--distribute``)が提供されている。

:pip:
   :作者: Ian Bicking
   :PyPI: http://pypi.python.org/pypi/pip
   :最新: 0.6.1 (2009/11/20)
   :更新頻度: 高
   :目的: easy_install コマンドの置き換え、uninstallサポート、bundleパッケージの作成。
   :弱点: eggをインストール出来ない。ソースからのみ可能。
   :相性: Windowsでは動作確認されてません(Maybe it doesn't work on Windows.)。実際、bundleコマンドはWindowsで動作せず。また、buildoutで構築した環境ではfreezeとuninstallも意味をなさないため、buildout使用時はpipの必要性が無いかも。

:virtualenv:
   :作者: Ian Bicking
   :PyPI: http://pypi.python.org/pypi/virtualenv
   :最新: 1.4.3 (2009/11/20)
   :更新頻度: 高
   :目的: Pythonの仮想環境を作成。site-packagesの切り離し。
   :相性: とくに競合するパッケージは無し。distributeをデフォルトにするオプション ``--distribute`` あり。

:buildout:
   :作者: Jim Fulton, Andreas Jung, Tarek, Tres Seaver, tlotze
   :PyPI: http://pypi.python.org/pypi/zc.buildout
   :最新: 1.4.2 (2009/11/01)
   :更新頻度: 高
   :目的: 環境やアプリケーションの構築を行う。egg取得、配置、設定、shellコマンド実行...等々。JavaならMavenに相当するらしい。
   :相性: virtualenv 無しで独立した環境を構築するが、virtualenv環境下で使うとさらにクリーンに使える。競合はしていない。distributeをデフォルトにするオプション ``--distribute`` あり。


調べてみた感想として、個人的には virtualenv + distribute 環境下で buildout + distribute を使うのが良いように思います。pipはbuildout環境下では積極的に使う必要はなさそう。pipにバイナリインストール機能が提供されてもうちょっと安定したら(開発以外の用途で)使いたいシーンが出てくるかもしれません。



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 692
:date: 2009-12-06 15:58:07
:title: 第6回 Zope/Plone開発勉強会に参加しました
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
昨日は `(第6回)Zope/Plone開発勉強会`_ に参加しました。 前回の `第5回`_ では一人待たせてしまいましたが、今回は40分前くらいに開場しました。二日酔いだったのに、すごいぞ俺。よく頑張った。

.. _`(第6回)Zope/Plone開発勉強会`: http://atnd.org/events/2258
.. _`第5回`: http://www.freia.jp/taka/blog/684

今回はPloneを始めて触る方が参加されていたので、Ploneハンズオンを1時間ちょっとかけてやってみました。先日のPlone研究会後に居酒屋でやったののちょっと拡張版ですが、Ploneの高機能化にはほんとに驚かされます。いつかそのうち説明文を付けてスクリーンキャストしたいですね（いつかそのうち...）。

午後は色々読んだり相談に乗ったりしているうちに16時を過ぎてしまい、成果発表まで残り2時間ということで慌てて `distutils, setuptools, distribute, pip, virtualenv, buildout - 清水川Web`_ を書き始めたりしてました。予定していた z3c.form + Deliverance はカケラも触りませんでしたが、まあまた次回にでも触ろうと思います（あっ、前回の成果をblogに書こうと思って忘れてる...）。

.. _`distutils, setuptools, distribute, pip, virtualenv, buildout - 清水川Web`: http://www.freia.jp/taka/blog/691


会場の様子
----------

.. figure:: images/20091205_zopeplonedev6_1.jpg/image_preview

  各自の勉強の予定

.. figure:: images/20091205_zopeplonedev6_2.jpg/image_preview

  会場の様子


他の参加者の報告
----------------

* `aodag blog: repoze.whoを調べてみた`_
* `aodag blog: buildoutでwebtestする`_
* `plone プロダクトの開発時には plone.reload を使おう — takanory.net`_
* `(第6回)Zope/Plone開発勉強会：ある nakagami の日記：So-netブログ`_
* `(第6回)Zope/Plone開発勉強会 - 人は歴史を創り出し、人は歴史を語り継ぐ`_
* `Plone:kupu のスタイル一覧プルダウンをカスタマイズ — Ciel Serein シエルセラン Web制作・映像制作・IT利用コンサルティング`_

.. _`aodag blog: repoze.whoを調べてみた`: http://blog.aodag.jp/2009/12/repozewho.html
.. _`aodag blog: buildoutでwebtestする`: http://blog.aodag.jp/2009/12/buildoutwebtest.html
.. _`plone プロダクトの開発時には plone.reload を使おう — takanory.net`: http://takanory.net/takalog/1189
.. _`(第6回)Zope/Plone開発勉強会：ある nakagami の日記：So-netブログ`: http://nakagami.blog.so-net.ne.jp/2009-12-05
.. _`(第6回)Zope/Plone開発勉強会 - 人は歴史を創り出し、人は歴史を語り継ぐ`: http://d.hatena.ne.jp/ytakeuch/20091205
.. _`Plone:kupu のスタイル一覧プルダウンをカスタマイズ — Ciel Serein シエルセラン Web制作・映像制作・IT利用コンサルティング`: http://ciel-serein.jp/blog/kupuStylesCustomise


前日・当日の #zopeplonedev の発言
----------------------------------

:jbking: @aodag 週末はZope/Plone勉強会よ http://atnd.org/events/2258 #zopeplonedev
:aodag: これ行こうかな。 RT @jbking: @aodag 週末はZope/Plone勉強会よ http://atnd.org/events/2258 #zopeplonedev
:ytakeuch: 今日は豊洲で 東のエデン 二回目観にいこうかと思っていたのだが、頭痛がしてきた。明日のZope/Plone開発勉強会があるから自重するかな。 #zopeplonedev
:ytakeuch: 起床。今日は (第6回)Zope/Plone開発勉強会 http://bit.ly/5QbJ5J に行く。 #zopeplonedev
:ytakeuch: 曙橋タイムインターメディアへ向かう。(第6回)Zope/Plone開発勉強会。まだ空きあります。 http://atnd.org/events/2258 #zopeplonedev
:shimizukawa: Zope/Plone 開発勉強会 開場しました。 #zopeplonedev
:shimizukawa: こいつ、速いぞ!? http://pypi.python.jp/ #zopeplonedev
:shimizukawa: pypi 復活したっぽいけど、jpの方が超速なのでそのまま使い続ける #zopeplonedev
:voluntas: RT @shimizukawa: pypi 復活したっぽいけど、jpの方が超速なのでそのまま使い続ける #zopeplonedev
:jbking: 一人Zope/Plone勉強会@会社 #zopeplonedev
:t2y: @shimizukawa 先生が plone の概要説明を始めた #zopeplonedev
:zenich: 私も向かう。遅れてすみません RT @ytakeuch: 曙橋タイムインターメディアへ向かう。(第6回)Zope/Plone開発勉強会。まだ空きあります。 http://atnd.org/events/2258 #zopeplonedev
:Terapyon: I'm starting Zope/Plone sprint Tokyo. #zopeplonedev I'll rebuild BigramSplitter & JaPatch recipe for PyPI.
:okuji: 一人じゃないよ、ここではみんな毎日Zopeだもん RT: @jbking: 一人Zope/Plone勉強会@会社 #zopeplonedev
:takanory: 曙橋なう #zopeplonedev
:zenich: #zopeplonedev でもお知らせさせてください RT ウェブサイトの公募が集まってきています！ぜひ、あなたのウェブサイトもこのチャンスにご応募ください。自推は1月15日までです。 #daremoga (via @daremogajp)
:takanory: おなかすいた #zopeplonedev
:zenich: 今日のゴールその1 Zope/Ploneアドベントカレンダーの記事を書く http://takanory.net/takalog/1187 #zopeplonedev その2は未定
:yosisa: RT @shimizukawa: pypi 復活したっぽいけど、jpの方が超速なのでそのまま使い続ける #zopeplonedev
:takanory: Zope/Plone開発勉強会(合宿バージョン) 日程調整中 http://chouseisan.com/schedule/List?h=8d7934debdbb5e2c3f971e959d241555 #zopeplonedev
:t2y: RT @takanory: Zope/Plone開発勉強会(合宿バージョン) 日程調整中 http://chouseisan.com/schedule/List?h=8d7934debdbb5e2c3f971e959d241555 #zopeplonedev
:t2y: http://tinyurl.com/yj6egqg Apache Tika は Lucene のサブプロジェクトで、各々のフォーマット毎に既にあるライブラリを利用するツールキット。OLE2 なら POI で、PDF なら PDFBox とか #zopeplonedev
:shimizukawa: コーヒー入りましたー #zopeplonedev
:takanory: 残り、およそ5分です #zopeplonedev
:ytakeuch: Grok全然進まず orz... #zopeplonedev
:takanory: @terapyon BigramSplitter を pypi に登録したよ #zopeplonedev
:takanory: @terapyon ploneの日本語メールバグなおしたプロダクトも pypi に入れたよ #zopeplonedev
:takanory: @terapyon 次は、このあたりをまとめてインストールするレシピを作りたいな #zopeplonedev
:takanory: http://pypi.python.org/pypi/Products.BigramSplitter #zopeplonedev
:Terapyon: RT @takanory: http://pypi.python.org/pypi/Products.BigramSplitter #zopeplonedev
:takanory: なかがみ: plone4a2を入れた。来月はがんばる #zopeplonedev
:takanory: @aodag repoze.who 調べた #zopeplonedev
:takanory: @ytakeuch grok チュートリアルのその先に #zopeplonedev
:takanory: @ytakeuch と思ったら、サンプルコードが動かないので、チュートリアルの次はなにしたらいいの? #zopeplonedev
:takanory: @shimizukawa distutils, setuptools, distribute, pip, virtualenv, buildout ? 清水川Webhttp://www.freia.jp/taka/blog/691 #zopeplonedev
:zenich: #zopeplonedev 本日のアウトプット、ようやくできました http://ciel-serein.jp/blog/kupuStylesCustomise
:takanory: 超長い :D RT: @zenich: #zopeplonedev 本日のアウトプット、ようやくできましたhttp://ciel-serein.jp/blog/kupuStylesCustomise
:takanory: こみや DBの関連を graphviz でやったら、ぐちゃぐちゃになった #zopeplonedev
:zenich: オープンソースソフトウェアコミュニティへの参加もプロボノ的な活動って言っていいでしょうか？ #zopeplonedev #helloprobono
:takanory: 合宿は 1/29-31 にする #zopeplonedev
:takanory: 第8回は 2/20 #zopeplonedev
:Terapyon: RT @takanory: 合宿は 1/29-31 にする #zopeplonedev
:k2mine: OKWaveがプロボノなら、オープンソースもプロボノでしょう。プロボノの範囲の定義によりますね。 RT @zenich: オープンソースソフトウェアコミュニティへの参加もプロボノ的な活動って言っていいでしょうか？ #zopeplonedev #helloprobono
:dateofrock: 私もそう思います。RT @k2mine: OKWaveがプロボノなら、オープンソースもプロボノでしょう。プロボノの範囲の定義によりますね。 RT @zenich: オープンソースソフトウェアコミュニティへの参加もプロボノ的な #zopeplonedev #helloprobono


これは search.twitter.com からコピーして逆順にソートして...とやったんですが、もうちょっと簡単に加工したい。時刻表示したいし、twitterの発言にリンクしたいし... と、前回と同じ事を思った。API叩くしかないのか..

次回 第7回
-----------

次回は 1/29(金)～31(日) に合宿！ まだ場所とか決まってないけど行くことだけは確定した雰囲気。
そのうち告知すると思いまーす。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 693
:date: 2009-12-07 23:55:00
:title: Goドキュメント翻訳のSphinxテーマをカスタマイズ中
:categories: ['web']
:body type: text/x-rst
:body:
Goの翻訳サイトのデザインを変更しましょう、ということで、 `GoogleGroupsの方`_ で話が進んでいて、 http://www.oswd.org/ から渋川さんが探してきた Aqua デザインを適用作業中です。

.. _`GoogleGroupsの方`: http://groups.google.co.jp/group/golang-docjp/browse_thread/thread/b981adb28f992451

適用作業の初めのうちは、Sphinxのdefaultテーマに沿う形で(extendして)組み込んでいっていたのですが、Sphinxテーマのカスタマイズが初めてだったのと、AquaのHTML/CSSが構造的に合わなかったのとがあり、途中で一旦全部捨てて、defaultテーマを無視して(extendせずに)組み込みました。捨てるまで2時間、捨ててから2時間くらいで組み込みは出来ましたが、Sphinxで使われているJinjaにもう少し詳しければもっと速く出来たかもしれません。

適用ついでLiquid対応もしてみました。一応Liquid化は出来たものの、デザイン・レイアウトのためだけのタグが多すぎ。もうちょっときれいに出来そうな気がする。しかも試行錯誤含めて2時間もかかってしまって、まだまだHTML力が足りない。

-------

ところで、こうしてデザイン組み込みをやってると Deliverance ってやっぱり便利ですね。Deliveranceは作業のレイヤーが1段異なる気がします（HTMLの作りを気にしなくなるという意味で）。Deliveranceの簡便さでデザイン組み込みが出来るようにならないもんだろうか。

* `Deliveranceをインストールする手順 in Python Hack-a-thon #2`_

.. _`Deliveranceをインストールする手順 in Python Hack-a-thon #2`: http://www.freia.jp/taka/blog/683


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 694
:date: 2009-12-08 23:55:00
:title: sidebarとfooter付きLiquidページのHTML練習
:categories: ['web']
:body type: text/x-rst
:body:
Sphinx_ のデザインを参考に、sidebarとfooterのあるLiquidなWebページを作る練習をしてみました。

.. _Sphinx: http://sphinx.shibu.jp/

HTMLコーディングはそれなりにちゃんと出来る方（遅いけど）だとは思うのですが、Liquid（画面幅に合わせてサイト幅が広がるデザイン）なページにサイドバーとフッターがある場合に自然にレイアウトすることが出来ませんでした。

それっぽいレイアウトとしては、サイドバーを左にfloatさせて、本文をabsoluteでleft位置をサイドバーの幅の分指定するという方法です。この方法は画面幅に合わせて本文部分の幅が可変になるものの、absoluteを使ってしまっているので、本文部分の高さがサイドバーよりも長くなってもfooterの縦位置はサイドバーの直下に張り付いたままになってしまったわけです。って、文字だけで説明してもわからんなあ。

ま、フッターの位置は本文・サイドバーどちらかの長い方の下（＝ページの最下端）に配置したいということです。

ということで、以下がうまくいったHTMLとCSSの例です。

.. code-block:: XML

  <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <title>Liquid Layout Test</title>
      <style type="text/css">
  <!--
  #header {
      background-color: #888;
      padding: 2px;
      height: 50px;
  }
  #navigation {
      background-color: #666;
      padding: 2px;
      height: 1em;
  }
  #document {
  }
  #documentwrapper {
      background-color: #eee;
      float: left;
  }
  #bodywrapper {
      background-color: #999;
      margin: 0 0 0 200px;
  }
  #body {
      background-color: #888;
      padding: 10px;
  }
  #sidebarwrapper {
      background-color: #bbb;
      width: 200px;
      float: left;
      margin-left: -100%;
  }
  #sidebar {
  }
  #footer1 {
      background-color: #666;
      padding: 2px;
      height: 1em;
  }
  #footer2 {
      background-color: #444;
      padding: 2px;
      height: 2em;
  }
  .clearer {
      clear: both;
  }
  -->
      </style>
    </head>
    <body>
      <div id="header">Header</div>
      <div id="navigation">Navigation</div>
      <div id="document">
        <div id="documentwrapper">
          <div id="bodywrapper">
            <div id="body">Body Body Body Body ... Body Body </div>
          </div>
        </div>
        <div id="sidebarwrapper">
          <div id="sidebar">Sidebar Sidebar ... Sidebar Sidebar</div>
        </div>
        <div class="clearer"></div>
      </div>
      <div id="footer1">Footer1</div>
      <div id="footer2">Footer2</div>
    </body>
  </html>


CSS部分を見ると分かりますが、 ``margin-left: -100%;`` という怪しい記述が。なるほど！これで幅のあるサイドバーの論理的な存在を画面外に追い出しつつ、同じエレメントを ``float:left`` にすることで画面内の左に乗るようにしているのか！思いついたヤツの頭はオカシイに違いない！

とりあえずここ3年くらいの疑問が解けた。ていうかよく見るCSSハックとかも好んで使いたくはないけど、こんな裏技もいやだ（笑）

---------------

あ、これ ``ネガティブマージン`` って言うんだ。理解してから検索するとすぐに例が見つかるという...。 chikin & egg pattern ですね。



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 695
:date: 2009-12-09 19:00:00
:title: Plone Party 2009 に参加中
:categories: ['Event', 'Plone']
:body type: text/x-rst
:body:
今日は `Plone Party 2009`_ に参加しています。

詳しくは後で書く！とりあえず生ビール、ゴルカ、ギネスと飲みながらバジルチキンとかタンドリーチキンを食べます！

.. _`Plone Party 2009`: http://plone.jp/events/party2009

追記
-----

今回のイベントは目黒の Spice_ で食事をしながら何人かの発表を聞く形式です。メインセッションではPlone4の紹介を寺田さんがプレゼンしました。資料は `Plone研究会&Ploneパーティー2009 - CMSコミュニケーションズ[Zope/Plone]`_ で公開されています。

詳しくは `Plone Party 2009 に参加 - takanory.net`_ に書かれているのでそちらをみてねっ！

関連サイト
-----------

* `Plone研究会&Ploneパーティー2009 - CMSコミュニケーションズ[Zope/Plone]`_
* `Plone Party 2009 に参加 - takanory.net`_
* 写真1: `本多さんのFlicker`_
* 写真2: Dropbox_
* `Zope/Ploneアドベントカレンダー 2009 — オープンソースCMS - plone.jp`_


.. _`Plone研究会&Ploneパーティー2009 - CMSコミュニケーションズ[Zope/Plone]`: http://www.cmscom.jp/blog/263
.. _`Plone Party 2009 に参加 - takanory.net`: http://takanory.net/takalog/1190
.. _Spice: http://r.tabelog.com/tokyo/A1316/A131601/13053574
.. _Dropbox: http://www.dropbox.com/gallery/284189/1/2009_12_ploneparty?h=21ed3e
.. _`Zope/Ploneアドベントカレンダー 2009 — オープンソースCMS - plone.jp`: http://plone.jp/documentation/advent-calendar/2009
.. _`本多さんのFlicker`: http://www.flickr.com/photos/shigeohonda/sets/72157622846189761/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 696
:date: 2009-12-10 23:55:00
:title: Python 忘年会 in 品川 (2009) に参加してきました
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
今週3回目の忘年会となる、 `Python 忘年会 in 品川 (2009)`_ に参加してきました。参加者数50人というPythonがキーワードの忘年会にこんなに人が来るというのはすごいことだなーと思います。同時に、 **この人数全員の顔と名前とハンドルネーム複数を全部覚えている主催者の @voluntas 先生はとてもすごい人だと思う** 。いやマジで。

会場の様子、の写真はこのへん。自分で撮らなかったのでURLで紹介してみる:

* http://twitpic.com/swvc3
* http://twitpic.com/swucc
* http://twitpic.com/swu9p
* http://twitpic.com/swtz4

そういえばPythonの話はあんまりしなかった。何の忘年会だっけ？途中から @everes が @yuitowest をPHPのお仕事に勧誘する会になっていたのは覚えてる。他にも色々とVSSとかJavaとかC++とか組み込みとかの話を聞いているウチに2時間経ってしまって、もうちょっとテーブルを回れば良かったなー、と反省。

それでは皆さん、良いお年を。また来年の忘年会でお会いしましょう。


.. _`Python 忘年会 in 品川 (2009)`: http://atnd.org/events/1727


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 697
:date: 2009-12-11 23:25:00
:title: Excelで複数のシートやブック印刷をしたときにプリンタ設定を全シート共通に設定出来ない問題、解決方法
:categories: ['IT-PC']
:body type: text/x-rst
:body:
昨日、Python忘年会に向かう電車の中でtwitterで名古屋の方の人と

 | **@wiroha**: 自分が仕事で主に時間をくってるのは印刷な気がする。EXCELで1シートずつ「集約」「両面」って選びながら印刷するの。ファイル閉じると設定リセットされるし…何とかならないの…
 | **@shimizukawa**: プリンタ設定のデフォルトを変えるのです。アプリから変えると一時的、コンパネから変えると恒久、のはず

なんて会話をして、その後忘年会も無事に終わって帰宅した後にとんでもない事実が発覚した！

先のtwitterを見た you_tomita からメッセンジャーで次のようなコメントが届いたのだ。

 | **@you_tomita**: エクセルは印刷設定をファイルに保存している
 | **@you_tomita**: シート毎に違うプリンタ設定(カラーとか集約とか両面とか)が保存される

なんだってー！（AA略

実際にやってみると、ほんとにそういう動きをしている。Excelから印刷を行った時点でプリンタのデフォルト設定がそのシートに保存されるし、印刷ダイアログからプリンタのプロパティーで変えた設定もシート単位で保存される。しかもシートに保存されている設定が優先されるので、プリンタのデフォルト設定を変えても効果が無い。これは痛い。
色々調べてみたけど、残念ながらシートに保存しないという設定はできないっぽい。

これはプリンタ名に依存しているらしいんだけど、共有プリンタなどを使っている場合、その辺の人たち全員が同じプリンタ名で、しかも(設定汚染された)Excelファイルをやりとりすることがとても多い、つまりハマる状況になりやすい。

これではプリンタ設定のデフォルトを変えて楽をしようというアイディアが台無しだ。

 | **@you_tomita**: 百歩譲って、保存するのは良いが、どうやって消すの？
 | **@shimizukawa**: なんかプリンタ切り替えればOKらしいっていうのを見つけた。やってみる
 | **@shimizukawa**: やった！できた！これでシート上の設定をリセットできるよ！

1. Excel開く
2. 印刷ダイアログ開く
3. 別のプリンタを選択する
4. 印刷ダイアログをキャンセルする
5. 保存する

 | **@you_tomita**: 裏技みたいになってきたな
 | **@shimizukawa**: これ、シート毎だろうか・・
 | **@you_tomita**: シート毎に決まってるじゃないか
 | **@shimizukawa**: さすがに違った。全シートの設定がリセットされてる
 | **@you_tomita**: ちぇ

ちぇ、じゃないよｗ

ということは、ブック全体を4in1印刷にしたいときは

1. Excel開く
2. 印刷ダイアログ開く
3. 別のプリンタを選択する
4. 印刷ダイアログをキャンセルする
5. 保存する
6. OSのプリンタ設定を変える
7. Excelを開いて印刷する

 | **@you_tomita**: 6が生理的に受け付けられんな

さらに保存しなくても良い手順を見つけた

1. OSのプリンタ設定を変える
2. Excel開く
3. 印刷ダイアログ開く
4. 別のプリンタを選択する
5. 目的のプリンタを選び直して印刷する

 | **@you_tomita**: 1がいきなりやだな

うるさいなｗ

とりあえず解決したって事で。Microsoftはちゃんと解決方法を用意してくれていたんだね。よかったよかった。


:extend type: text/x-rst
:extend:


:trackbacks:
:trackback id: 2010-12-16.2161462531
:title: Excelはシート単位でプリンタの印刷設定情報を持つとか
:blog name: やそきちの我楽多置場
:url: http://aruhi.cocolog-nifty.com/blog/2010/12/excel-ae73.html
:date: 2010-12-16 21:06:56
:body:
「Excelのファイルを印刷したら、シートによって両面ででたり片面で出たりするんだよ、何とかしてくれ

%%%%%%%%%

:id: 698
:date: 2009-12-12 23:00:00
:title: 電気通信大学 水野・安藤・石上研究室OB会2009に参加してきました
:categories: ['Event', 'misc']
:body type: text/x-rst
:body:
今日は大学研究室のOB会に行ってきました。今週4回目の忘年会です。

安藤先生は去年還暦を迎えたんですが (`大学恩師の還暦のお祝い`_) 、退官は2014年3月とのことでまだまだ元気そうでした。

OB会自体は17時～19時だったんですが、安藤先生が開始時間を間違えたと言うことで30分くらい遅れてきました。残念ながら水野先生は今日は来られなかったとのことで、前回参加したときに比べるとちょっと静かめな感じだったような気もします。

今回は1998年度卒業の同期が自分含めて5人も集まったのが卒業以来の快挙です。一人は大阪から来てるし。安藤先生が来ないのでなかなか始まらなかったのに1人飲み始めてるヤツはいるわ、シメのうどんに卵（有料）を追加注文するわ、98度卒は縦横無尽に好き勝手やってた感じです。追加注文した卵が来たときに「キター！」とか盛り上がって安藤先生の話聞いてないしｗ

なにはともあれ、みんな今年は元気そうで良かった。みんな良いお年を。また来年会いましょう～。

.. _`大学恩師の還暦のお祝い`: http://www.freia.jp/taka/blog/596



:extend type: text/x-rst
:extend:


:comments:
:comment id: 2009-12-14.3147007583
:title: Re:電気通信大学 水野・安藤・石上研究室OB会2009に参加してきました
:author: もいたろ
:date: 2009-12-14 09:58:43
:email: 
:url: 
:body:
カメラを構えたらピースする人ワラタｗ
まぁ古い人間なのでっ

目つぶってるけど、、、、orz

%%%%%%%%%

:id: 699
:date: 2009-12-13 23:07:21
:title: 久々にアロマを焚いてみる
:categories: ['misc']
:body type: text/x-rst
:body:
アロマって、焚くって言うの？お香と違うよね。「アロマを蒸発させる」も違うし。なんだろう。

2005年に前職を退職する時にみんなからもらった贈り物のアロマスタンド？を久々に使ってみた。ロウソクを使うタイプなので炎を見てるだけでも落ち着く。アロマオイルは、先週近所の無印に行ったときに買ったスウィートオレンジを使用。オレンジの香り好きなんだよね。ラベンダー系は1時間くらいで気持ち悪くなってきちゃうのでオレンジばっかり使ってるな。

人からもらったモノで使い続けてるのって他にほとんど無いけど、コーヒー好きへの贈り物だからコーヒー関連を避けた、というのはとっても正解だったと思う。

と、自宅で溢れた仕事をしながら、久々に思い出してみたり。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 700
:date: 2009-12-14 23:55:30
:title: 忙しいでござる
:categories: ['misc']
:body type: text/x-rst
:body:
今月は毎日1エントリ書こうと思っていたのに忙しくてBlog書くネタをそろえる時間が無いでござる。

と、これだけではなんなので、いつか書こうと思っているBlogネタを書いてみるでござる(除くZope/Plone)。

* SSD買った
* Windows7
* FFFTP via SOCKS5 on ssh
* IEでJSデバッグ Companion.JS
* python2.6用buidl環境(多分VC++2008Express)
* ssh Dynamic転送 socks
* ssh Dynamic転送とTortoiseSVNのsessoin利用を組み合わせる
* rails + oracle
* rails + mongrel => streaming download
* rails + buildbot
* rails + backgroundrb
* rails + IIS
* rails + SQLServer
* IIS + IsapiRewrite4(IIS用のmod_rewrite)
* IIS + fast-cgi
* Apache1.3用のmodを作った
* Screencast: Pythonのvnc, wink, Windows Media Encoder

ほとんど全部1年くらい寝かせてる...。でもこうやってBlogに書けば、ちゃんと書かざるを得ないのではないかという背水の陣メソッド。


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2009-12-15.0760721033
:title: Re:忙しいでござる
:author: 渋川
:date: 2009-12-15 08:41:16
:email: yoshiki@shibu.jp
:url: http://blog.shibu.jp
:body:
rails+IIS, IIS+fast-CGIとか、ブルーオーシャンなにおいがします。いいなSSD。どこの買われたんですか？

:comments:
:comment id: 2009-12-16.2890864665
:title: Re:忙しいでござる
:author: しみずかわ
:date: 2009-12-16 03:38:09
:email: 
:url: 
:body:
> rails+IIS, IIS+fast-CGIとか、ブルーオーシャンなにおいがします。

ニッチなだけでｗ
Windowsをサーバーに使うと変人扱いされる業界です。

> いいなSSD。どこの買われたんですか？

PhotoFast の G-Monster V2. 120GB  プチフリあり...
Intel製が欲しいけど160Gは高いし、80Gは容量が少ないし。困ったもんです。
%%%%%%%%%

:id: 701
:date: 2009-12-15 23:55:00
:title: Rubyでメール送信
:categories: ['ruby-on-rails']
:body type: text/x-rst
:body:
現在、12/15 27:05 です。忙しさのピークを迎えていますが、RailsのActionMailerでハマっています。SMTPサーバーの問題なのか、設定の問題なのか、Railsの問題なのかを切り分けるために、Rubyで直接SMTPを叩いてみました。

irbで対話形式でこんな感じにメールを送信します。

::

  irb(main):008:0> require 'net/smtp'
  true
  irb(main):009:0> smtp = Net::SMTP.new('127.0.0.1', 25)
  => #<Net::SMTP 127.0.0.1:25 started=false>
  irb(main):010:0> smtp.start()
  => #<Net::SMTP 127.0.0.1:25 started=true>
  irb(main):012:0> smtp.sendmail(
  irb(main):013:1*   "To: shimizukawa@example.com\r\n\r\nTestTestTest",
  irb(main):014:1*   'noreply@example.com', ['shimizukawa@example.com'])
  => #<Net::SMTP::Response:0x2da23dc @string="250 2.0.0 nBFHk4B3023515 Message accepted for delivery\n", @status="250">

ちょっと読みづらいですが、最終行で送信が成功しているのが分かります。

Railsではうまくいかないのに、Ruby直だとちゃんと動くという...。じゃあ次はsmtp.start()に色々パラメータを与えてみるかな。



:extend type: text/x-rst
:extend:


:comments:
:comment id: 2009-12-16.5854118613
:title: Re:Rubyでメール送信
:author: しみずかわ
:date: 2009-12-16 23:43:06
:email: 
:url: 
:body:
最終的には送信出来るようになりました。start()の:domainオプションがHELOコマンドに渡っているんですが、これがSMTPサーバー側の設定と合っていないとだめだったたけでした。

が、今度は別の問題が。initializers に以下の内容を書くと、手元の環境ではうまくいくのに本番環境では送信出来ないという...。どっちもWindowsなんだけどな。

config = Rails.configuration
config.action_mailer.delivery_method = :smtp
config.action_mailer.smtp_settings = {
  :address => 'smtp.example.com',
  :port => 25,
  :domain => 'example.com',
}

‥‥ RAILS_ENVがdevelopmentとproductionという違いがあるけど、関係あるかな？
%%%%%%%%%

:id: 702
:date: 2009-12-16 23:55:00
:title: Rails + SQLServer で data型を扱うとハマる話
:categories: ['ruby-on-rails']
:body type: text/x-rst
:body:
はまります。

Rails + SQLServer で data型を使おうとすると、とってもはまります。

あ、 Ruby on Rails 2.2.2 + sqlserever_adapter-1.0.0 での話です。

まず、DBを以下のように用意するわけですよ::

  create_table "contacts" do |t|
    t.string   :name
    t.date     :birthday
    t.timestamps
  end

で、フォームを用意するわけですよ::

  <%= f.text_field :name %>
  <%= f.date_select :birthday, :use_month_numbers => true %>

それを以下のようなコントローラで受けて処理するわけですよ::

  contact = Contact.new
  contact.attributes = params[:contact]

ところが、このフォームで実際に 1950/12/25 と言う日付をPOSTするとエラーになるわけですよ。

原因は、上記で作られる select box は年・月・日の３つのセレクトボックスとして表示されて、POSTすると ``{'birthday(1i)'=>'1950', 'birthday(2i)'=>'12', 'birthday(3i)'=>'25',..`` というようなデータがサーバーに送られるわけですが、 contact.attributes = params[:contact] としている箇所で Rails が色々やってくれようとして、そこで SQLServer では Date 型が無いために、一見原因が分からないややこしいエラーが発生します。

ということで、コードを追いかけてみました。

SQLServer用の sqlserver_adapter を使うと、dateを使う！ってdb/migrationsに書いても、DBに用意される型は datetime になります。型の対応は以下のような感じです::

    class SQLServerAdapter < AbstractAdapter

      def native_database_types
        {
          :primary_key => "int NOT NULL IDENTITY(1, 1) PRIMARY KEY",
          :string      => { :name => "varchar", :limit => 255  },
          :text        => { :name => "text" },
          :integer     => { :name => "int" },
          :float       => { :name => "float", :limit => 8 },
          :decimal     => { :name => "decimal" },
          :datetime    => { :name => "datetime" },
          :timestamp   => { :name => "datetime" },
          :time        => { :name => "datetime" },
          :date        => { :name => "datetime" },
          :binary      => { :name => "image"},
          :boolean     => { :name => "bit"}
        }
      end

で、ActiveRecordの仕組みによって、DBの型から自動的にRails内でのデータ型が以下のように決まります::

  module ActiveRecord
    module ConnectionAdapters #:nodoc:
      class Column
        def klass
          case type
            when :integer       then Fixnum
            when :float         then Float
            when :decimal       then BigDecimal
            when :datetime      then Time
            when :date          then Date
            when :timestamp     then Time
            when :time          then Time
            when :text, :string then String
            when :binary        then String
            when :boolean       then Object
          end
        end

そうすると、Date型のつもりの値がdatetimeを経由して結果としてTime型で扱われてしまうという問題が発生します（多分sqlserver_adapter の問題）。

このため、1970年より前の年数を扱いたいからDate型を指定したはずなのに、実際はRails内部のデータ型がTime型なので、1950年でPOSTするとTime型で扱える範囲を超えていて、エラーになります。

エラー起こしてる直接のコードの箇所は ActiveRecord::Base#execute_callstack_for_multiparameter_attributes でした。

この問題を回避するため、色々調べたら `こういう手`_ は見つけたんですが、リリース直前なので今回は避けて、結局データをstringで持つことにしてContactモデルに以下の実装を加えてごまかしました::

  class DateColumn
    def self.klass
      Date
    end
  end

  class Contact < ActiveRecord::Base

    def column_for_attribute(name)
      if name.to_s == 'birthday1'
        ::DateColumn
      else
        self.class.columns_hash[name.to_s]
      end
    end
  
    attr_accessor :birthday1
    def birthday1= value
      @birthday1 = value
      self.birthday = value.strftime('%Y/%m/%d') if value
    end
    def birthday1
      Date.new(*self.birthday.split('/').collect{|n|n.to_i}) rescue @birthday1
    end
  end

もっと良い手をご存じの方はご連絡下さい！＞＜


.. _`こういう手`: http://mspeight.blogspot.com/2007/12/solved-rails-mssql-dates-prior-to-1970.html

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 703
:date: 2009-12-17 03:06:47
:title: Python Testing: Beginner's Guide の目次の和訳
:categories: ['python']
:body type: text/x-rst
:body:
Daniel Arbuckle 著の Python Testing: Beginner's Guide の目次を和訳しました。と言ってもまだ発売前なので内容はよく分かりません。Twitterでなにやらプッシュされていたので、とりあえず目次等を訳してみました。

発売日は2010年1月ですが、本は以下から予約購入できます。

* PACKT_

なお、PDF版と同時に買うとほとんど本の定価分の金額でPDFが付いてきます。さらにページの中程には、この本のPDF版と、 Expert Python Programming のPDF版を合わせて買うと両方とも半額でGetできるプロモーションコードとかあって、どんだけ安売りするんだよって幹事です。 Expert Python Programming については `Expert Python Programming の目次の和訳`_ もどうぞ。


.. _PACKT: http://www.packtpub.com/python-testing-beginners-guide/book
.. _`Expert Python Programming の目次の和訳`: http://www.freia.jp/taka/blog/680


この本で学べること
===================
* Pythonのdoctestモジュールを使ってテストを簡単に行います。doctestはテストコードをdoc stringsに書くことが出来ます。
* ユニットテストで開発を駆動し、プロセスを速くする方法を学びます。
* Mockerの機能によって、各ユニットの独立を維持するのを助けます。また必要に応じてカスタマイズ出来るようになります。
* Embed your tests in a controlled and temporary environment using test fixtures
* Python Mcoker の MockerTestCasaeを使って簡潔にユニットテストとMockerを統合します
* テストを自動的に見つけて実行してくれる Nose - Noseはユニットテストを基本としたPythonのテストフレームワークで、テストの作成と実施を簡単にしてくれます。
* Webアプリケーション用のテストをTwillを使って書きます。Twill integrate it's capabilities as a library into Python testing code
* 結合テストの作成と実行によって、機能・プログラムが正しく動作していることを確認します。
* ソースコード管理がソースコード内のdoctest変更を検出して、自動的にテストをしてくれる Nose について。
* 継続的常時結合システム Buildbot のセットアップとテストを多数の異なる環境で実行する方法について。


Python テスティング: 初心者向けガイド
===========================================

1章 Python によるテスト駆動開発と様々なテスト手法の紹介
--------------------------------------------------------

2章 doctest ツールとその使い方について
---------------------------------------

3章 ユニットテストとテスト駆動開発のアイディアの紹介、そして doctest のユニットテストへの適用
----------------------------------------------------------------------------------------------

4章 モックオブジェクトとは何か、Pythonにおける Mocker ツールについて
----------------------------------------------------------------------

5章 ユニットテストフレームワークの紹介と doctest との組み合わせについての議論
------------------------------------------------------------------------------

6章 Nose テストランナーの紹介と、プロジェクトについての議論
-------------------------------------------------------------

7章 テスト駆動開発プロセス全体を通して見る
-------------------------------------------

8章 これまでに得た知識のWebアプリケーションへの適用と、Twillツールの紹介
-------------------------------------------------------------------------

9章 ユニットテストをソフトウェアシステム全体のテストへと組み上げる方法
-----------------------------------------------------------------------

10章 コードカバレッジと常時結合の紹介と、バージョン管理システムと連携した自動テストについて
--------------------------------------------------------------------------------------------


アプローチ
============
この本は、自動テストの基礎から始まり、最良のツールと手法について完全に紹介します。新しい概念は段階的に導入していきます。この初心者ガイドによってテストが簡単で、より楽しいものになるでしょう。


この本のターゲット
===================
もしあなたがPython技術者で、アプリケーションのためのテストコードを書きたいと考えているなら、この本で標準的な方法を入手できます。また、この本を読むことによってテスト手法をより簡単に学ぶことが出来ます。

あなたには一般的なPythonプログラミングの知識が必要です。
ソフトウェアテストの認識があること良いですが、テストに関する知識は必須ではありませんし、また、ライブラリに関する知識も必須ではありません。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 704
:date: 2009-12-18 23:55:00
:title: 讃岐うどん 新宿 楽釜製麺所
:categories: ['food']
:body type: text/x-rst
:body:
新宿西口の「どんどん」の跡地に `楽釜製麺所`_ ができたのが2ヶ月くらい前。気にはなっていたんだけど、大抵は天下一品で食べた後に店の前を通って「あ、忘れてた」という感じでなかなか入れなかった。しかし先日ついに入店を果たした！

で、今日また行ってきました。

実はここのうどんは自分の好みからは微妙に外れているんだけど、1回目に行ったときに天ぷらが超うまかったので、そして、他の人が食べてた釜揚げのインパクトがすごかったので、今回は釜揚げ+天ぷら1択で行ってきました。

他の（主にセルフの）讃岐うどんのお店は天ぷらって運が良ければ揚げたて、大抵は温いか冷たくなってる、という感じなんだなーと思ってたんだけど、ここのお店はセルフ方式ながら、大抵が揚げたて、というのがすごい。というか客の回転が良いからなだけかもしれないけど、とにかく天ぷらがでかくてうまい。安いし。

そして今日のメインは釜揚げ並280円。となりで @you_tomita が食べてたキツネ並330円と並べてみると安い方がインパクトでかいという。天ぷら２つ付けて540円という、懐にも優しくて満足感もあって、言うことなし！

（次回は釜揚げ＋かき揚げという愚は避けようと思う...）

----------------------------

12/19 訂正

キツネは380円じゃなくて330円でした。

----------------------------

麺の紹介はこちらの `新宿にさぬきうどんがまたひとつ - 楽釜製麺所 - タケルンバ卿日記`_ が良く書かれているので参考にドウゾ。


.. _`楽釜製麺所`: http://www.sankofoods.com/news/all_event/op1029udon.html
.. _`新宿にさぬきうどんがまたひとつ - 楽釜製麺所 - タケルンバ卿日記`: http://d.hatena.ne.jp/takerunba/20091126/p3

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2009-12-19.9277623463
:title: Re:讃岐うどん 新宿 楽釜製麺所
:author: とか★ちん
:date: 2009-12-19 01:48:48
:email: 
:url: 
:body:
そういえば、うんど屋できてたが一回も入ってなかった・・・
地元なのに・・・こんど試してみるわ。

:comments:
:comment id: 2009-12-19.4456626831
:title: Re:讃岐うどん 新宿 楽釜製麺所
:author: jack
:date: 2009-12-19 09:27:26
:email: 
:url: 
:body:
あのへんですか。
しかし西口に天一あったっけ？
最近、夜は徘徊していないのでわかんなくなってます。
# 昼は高層ビル街がメインだし。

:comments:
:comment id: 2009-12-19.5474408431
:title: いまきづいた
:author: jack
:date: 2009-12-19 09:29:07
:email: 
:url: 
:body:
釜揚げにかきあげは喰いづらぞう(笑)

:trackbacks:
:trackback id: 2011-03-30.4961186060
:title: 楽釜製麺所の「豚の角煮うどん大」
:blog name: まろまろ記
:url: http://maromaro.com/archive/2011/02/18/rakugama.php
:date: 2011-03-30 21:01:37
:body:
楽釜製麺所で、豚の角煮うどん大をいただく。 この楽釜製麺所は、金の蔵などを展開する三光マーケティングフーズのセルフうどん店。 自家製麺はラーメン二郎を思い出す太麺が特徴的で、豚の角煮にも負けない食べ応えがある。 チェーンのセルフうどん店の中では一番美味しく感じられたお店。 まろまろと今日ももぐもぐ。 池袋の「楽釜製麺所」池袋サンシャイン通り直売店にて。...

%%%%%%%%%

:id: 705
:date: 2009-12-19 23:55:00
:title: クリスマス会 2009
:categories: ['Event']
:body type: text/x-rst
:body:
(このエントリは12/25に書きました)

1997年から毎年やってる、清水川の友人達が集まるクリスマス会です。今年で、なんだかんだで13回目。年に一度しか会わない人もいるなあ。キーワードは、プレゼント交換とケーキとフライドチキン。あ、今年は自家製パンを用意しましたよ。

ほぼ毎年、一品料理とプレゼントを持参してもらっているんだけど、今年は ``「よつばと!」2010カレンダー`` を用意しました。たまたま自分用に買ったやつが当日朝にAmazonからとどいたからそれにした、とかそういう事はありません。もらったのはシナモンとレーズンのスコーン。美味しゅうございました。

(12月毎日Blog書く目標は18日まででストップ。残念)


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 706
:date: 2009-12-21 23:55:00
:title: pyreadlineのパッチを修正
:categories: ['python']
:body type: text/x-rst
:body:
`Windowsでpyreadlineを使うとCtrl+H押下時にカーソルが進む`_ というエントリに `檜山正幸のキマイラ飼育記`_ の檜山さんからコメントをもらって、その後メールで改善案と質問をもらいました。

::

  --- pyreadline/keysyms/keysyms.py.orig
  +++ pyreadline/keysyms/keysyms.py
  @@ -119,6 +119,10 @@
           char = chr(VkKeyScan(ord(char)) & 0xff)
       elif control:
           char=chr(keycode)
  +    if control and ord(char)==8 and keycode==72:
  +        keycode=8
  +        control=False
  +        state &= 0xfffffff7
       try:
           keyname=code2sym_map[keycode]
       except KeyError:

* 質問: 上記のコードで state &= 0xfffffff7 のコードの意味は？
* 回答: わかりません＞＜

パッチだけだと分かりませんが、関数全体でこの行以降でstate変数を参照している箇所が無いのです＞＜ パッチを作ったのが2年以上前の事とはいえ、さすがにこれは意味がなさ過ぎる。反省。

他にメールで、Ctrl+Mについても、Ctrl+Hと同様な問題があるという指摘と改善パッチをもらってやりとりした結果、以下のようなパッチに生まれ変わりました::

  --- pyreadline/keysyms/keysyms.py.orig
  +++ pyreadline/keysyms/keysyms.py
  @@ -119,6 +119,9 @@
           char = chr(VkKeyScan(ord(char)) & 0xff)
       elif control:
           char=chr(keycode)
  +    if control and (ord(char),keycode) in ((8,72),(13,77)):
  +        keycode=ord(char)
  +        control=False
       try:
           keyname=code2sym_map[keycode]
       except KeyError:
  
このパッチは `IPython: Ctrl+H erase previous character, but cursor goes forward.`_ にもUpし直しておきました。檜山さん、ありがとうございました。

(このエントリは12/25に書きました)

.. _`Windowsでpyreadlineを使うとCtrl+H押下時にカーソルが進む`: http://www.freia.jp/taka/blog/690

.. _`檜山正幸のキマイラ飼育記`: http://d.hatena.ne.jp/m-hiyama/

.. _`IPython: Ctrl+H erase previous character, but cursor goes forward.`: https://bugs.launchpad.net/pyreadline/+bug/491941


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2010-07-18.1278194579
:title: pyreadline-1.6対応
:author: しみずかわ
:date: 2010-07-18 13:58:47
:email: 
:url: 
:body:
詳しくはこちら http://www.freia.jp/taka/blog/726

%%%%%%%%%

:id: 707
:date: 2009-12-22 23:55:00
:title: Deliverance-0.3c1リリース、その後Windowsで動かない問題も修正された
:categories: ['python']
:body type: text/x-rst
:body:
先日 12/6 に Deliverance のPYPIリリース版が0.3c1に上がりました。

* `Deliverance 0.3c1`_

それまでは0.2系が登録されていたので0.3を使うにはeasy_installやbuildoutする時にSubversionのURLを指定しなければいけなかったのですが、これでやっとURL指定なしで使えるようになりました。

その後、以前自分が投稿した http://projects.openplans.org/deliverance/ticket/13 のバグも、12/21になって修正されました。Tracのタイムラインを見ると、ここ1ヶ月ほど主にegjによって頻繁に更新・修正されているようです。ianbによる立ち上げ -> 放置 -> 有志複数人によるメンテ（いまここ）、という感じで、ある意味、健全化されたのかなーという感じがします。

(このエントリは12/25に書きました)

.. _`Deliverance 0.3c1`: http://pypi.python.org/pypi/Deliverance/0.3c1


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 708
:date: 2009-12-23 23:55:00
:title: 満員電車でX61sの液晶が割れた！
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
満員電車の人圧でノートPCの液晶が割れました...。

昨夜、楽しい飲み会を京王線終電過ぎまでやったあと、吉祥寺発・調布行きの深夜バスに乗るためにJR新宿駅の総武線ホームに行ったのが良くなかった。1600円をケチらないで新宿発・調布行きの深夜バスに乗っていればこんなことには‥‥。

翌日、会社でパソコンを開けてみてびっくりですよ。アーッ＞＜

Twitterやメールでアドバイスをくれた皆さん、ありがとう！でもMacには乗り換えないよ！

(このエントリは12/25に書きました)

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 709
:date: 2009-12-24 23:55:00
:title: ステキなクリスマスプレゼントもらった！
:categories: ['misc', 'python']
:body type: text/x-rst
:body:
* 12月頭にPS3が起動しなって修理に出しました
* 不景気の煽りで、給料減、賞与1/3カットになりました
* 12/23にノートPCの液晶が割れました
* 修理に出したPS3、今日になって16,800円の修理費がかかると連絡が来ました

そして、12/24昼過ぎに @kahei さんからステキなクリスマスプレゼントをもらいました！

俺、もうすこしがんばるよ！


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 710
:date: 2009-12-25 23:55:00
:title: X61sを復活させるべく秋葉原へ
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
先日割れてしまった Thinkpad X61s の液晶交換のためにパーツ取り用のX61ｓを探しに、いくつかの助言に従って、池袋のビックカメラ・アウトレットと、秋葉原の若松通商に行ってきました。

ビックカメラには残念ながら互換性のありそうな機種は無かったけど、X40が22,800円で売っててびっくり。安いなー。でもそのくらいの金額が妥当なのかも？

秋葉原の若松通商では、X60,X61系が中古販売されていましたが、店員さんに修理の相談をしてみたところ、「一般的な液晶修理は2万円～なんだけど、X61sは液晶が薄型なのでメーカー修理に出した方が良い、それでも修理に7万円くらいかかる」ということを言われてしまいました。7万あったら割引クーポン使って直販でX200s買えるよ！

------------

ってBlog書いてたら aihatena からメッセンジャーでヤフオクのURLが送られてきた。 `X60s,X61S,X60,X61用12.1型液晶P/N:13N7095の同等品/x60s-lcds5s`_
12,800円。これは液晶パネルだけ売ってるみたい。でもX61s Anniversaryモデル(7666-BH5)が対象に書かれてないなぁ。質問してみようかなぁ。

`ThinkPad X6シリーズ X60/s X61/s 超高画質H-IPS液晶改造`_
25,980円。これはTN液晶をH-IPSに改造してくれるみたい。改造費用込みで25,980ならこれに頼むのは有りだなぁ。どうせ保証も切れてるし。


.. _`X60s,X61S,X60,X61用12.1型液晶P/N:13N7095の同等品/x60s-lcds5s`: http://page2.auctions.yahoo.co.jp/jp/auction/b104545627

.. _`ThinkPad X6シリーズ X60/s X61/s 超高画質H-IPS液晶改造`: http://page18.auctions.yahoo.co.jp/jp/auction/w45974551

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 711
:date: 2009-12-26 02:10:00
:title: Thinkpad X61s 15th Anniversary モデル 7666-BH5 の液晶型番を調べるために開けてみた
:categories: ['misc', 'IT-PC']
:body type: text/x-rst
:body:
LTD121ECHB, 13N7091 でした。

きれいな写真は型番で検索して勝手にもってきたやつ。手が映ってるのが自分のやつ。

危なく別の液晶パネルを買うところだった。コネクタ形状に互換性があっても、コネクタの位置がだいぶ違うので、こういうのの取り扱いになれてないと失敗する可能性が高そう。

しかしこの型番で調べると、2万後半だなあ。

あと、開けて閉めるのだけでかなり苦労した＞＜ 蓋のスライドロックのバネが外れてしまってもう‥‥＞＜ 出来ればもう開けたくないところだが、さて。。どうするか。。。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 712
:date: 2009-12-27 19:24:35
:title: Zope-2.12.2 リリース & buildout での環境構築メモ
:categories: ['Zope']
:body type: text/x-rst
:body:
Zope 2.12.2 が先週12/22にリリースされました。リリースされるのは、その１週間も前から分かっていたんだけど、ぼーっと過ごしていたら翻訳が遅れました＞＜

* 翻訳: http://docs.zope.jp/zope2/releases/2.12/CHANGES.html#zope-2-12-2-2009-12-22

同日、2.10.10, 2.11.5 もリリースされたけどこれはまあいいや。

Zope 2.12.2 ではついに management_page_charset のデフォルト値がiso-8859-1 から utf-8 に変更になって、これで日本語を使う際の必須TIPSが1つ不要になりました。また、Python-2.4 は完全にサポート外なり、正式サポートはPython 2.6のみになっています。2.5のサポートも非公式になっちゃったけど、Zope使ってる人は今まで2.4しか使えなかったわけだし、2.5はまあサポート無くてもあんまり困らなそうね。


buildoutでの環境構築
-----------------------

http://docs.zope.jp/zope2/releases/2.12/INSTALL.html に書かれている方法でも良いんですが、その方法ではZope2のソースコードが環境に残ってしまうので、もうすこしクリーンな感じにするためにbuildout.cfgを書いてみました。

::

  $ mkdir zope-env
  $ cd zope-env
  $ wget "http://svn.zope.org/*checkout*/zc.buildout/trunk/bootstrap/bootstrap.py"
  $ python-2.6 bootstrap.py init

生成された buildout.cfg に以下を記載

buildout.cfg::

  [buildout]
  parts = zope2 zopepy
  
  extends = http://download.zope.org/Zope2/index/2.12.2/versions.cfg
  versions = versions
  eggs = Zope2 
  
  [zope2]
  recipe = zc.recipe.egg
  eggs = ${buildout:eggs}
  
  [zopepy]
  recipe = zc.recipe.egg
  eggs = ${zope2:eggs}
  interpreter = zopepy
  scripts = zopepy

そして環境をビルドします::

  $ bin/buildout

最後にZopeのインスタンスを作成します::

  $ bin/mkzopeinstance -d inst2 -u admin:admin

あとは実行するだけです::

  $ cd inst2
  $ cd bin/runzope


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 713
:date: 2010-01-29 15:00:00
:title: Zope/Plone開発勉強会７（雪山合宿）
:categories: ['Zope', 'Plone']
:body type: text/x-rst
:body:
みなさん、新年あけましておめでとうございます。本年１投稿目が１月末ですみません。

ということで、 `Zope/Plone開発勉強会7`_ をしに菅平までやってきました。
これから３日間、スキーとZope/Ploneの勉強に集中します。
拠点になるのは `マウンテンパパ`_ というペンションです。無線LANが完備しており、場所もけっこう自由に使わせてもらえるということで大変充実した合宿になりそうです。

.. _`Zope/Plone開発勉強会7`: http://atnd.org/events/2479
.. _`マウンテンパパ`: http://homepage2.nifty.com/mtpapa/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 714
:date: 2010-02-03 23:50:00
:title: www.freia.jpのSSL証明書を更新
:categories: ['web', 'security']
:body type: text/x-rst
:body:
`www.rapidssl.com`_ で www.freia.jp のSSL証明書を更新。2年で$96.00。あれ、2年前は$79.00だったんだけど高くなってる？（2年前のエントリ http://www.freia.jp/taka/blog/497 ）

それでも1年$48.00だから、まだ安いとは思う。日本のケータイでも大丈夫な証明書だし（ `RapidSSLで購入したSSL証明書がケータイから閲覧可能なルート認証局になってる件`_ ）


.. _`www.rapidssl.com`: http://www.rapidssl.com/
.. _`RapidSSLで購入したSSL証明書がケータイから閲覧可能なルート認証局になってる件`: http://www.freia.jp/taka/blog/641


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 715
:date: 2010-02-04 23:00:00
:title: 松島かき祭り2010に行く準備
:categories: ['Event', 'food']
:body type: text/x-rst
:body:
今年は金曜の夜に `aihatena`_ 宅に泊まって、土曜朝イチの新幹線で仙台に向かう予定。現地でまたまた大場さんたちと合流予定。みんな牡蠣好きね－。

土日往復切符で往復18000円。比較的安く行けるけど去年は夜行バスで往復1万未満だったから結構高いな－。体力を削るか、お金を削るかって感じか。

持って行くものは、去年買った折りたたみイスと、防寒着、ホッカイロくらいか。
aihatenaから以下のメッセージもらった。

 軍手,殻外しナイフ,割り箸,焼いて食う物,湯飲みか加熱可能なコップ,ウェットティッシュ,ゴミ袋

サーモマグと割り箸と袋をいくつか持って行こう。

去年は以下のような感じだったようだ。

* `松島かき祭りに行く準備`_
* `松島かき祭りに行く準備で買った携帯イス`_
* `松島かき祭り 2009 に来た`_

.. _`aihatena`: http://www.freia.jp/aihatena/

.. _`松島かき祭りに行く準備`: http://www.freia.jp/taka/blog/619
.. _`松島かき祭りに行く準備で買った携帯イス`: http://www.freia.jp/taka/blog/624
.. _`松島かき祭り 2009 に来た`: http://www.freia.jp/taka/blog/630


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 716
:date: 2010-02-05 23:43:44
:title: 松島かき祭り前夜
:categories: ['Event']
:body type: text/x-rst
:body:
明日は朝イチの新幹線で仙台の松島かき祭りに向かいます！

今日は aihatena 宅に泊まって猫分を補給中。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 717
:date: 2010-05-22 13:05:00
:title: エキスパートPythonプログラミング
:categories: ['python']
:body type: text/x-rst
:body:
清水川が翻訳に参加した `エキスパートPythonプログラミング`_ (原題 `Expert Python Programming`_) が2010/5/31にアスキーメディアワークスさんより発売されます！

.. _`エキスパートPythonプログラミング`: http://ascii.asciimw.jp/books/books/detail/978-4-04-868629-7.shtml
.. _`Expert Python Programming`: http://www.packtpub.com/expert-python-programming/book

.. figure:: images/expert_python_programming_ja.jpg/image_preview

:タイトル: エキスパートPythonプログラミング
:出版社: アスキー・メディアワークス
:著者: Tarek Ziade
:翻訳: 稲田直哉, 渋川よしき, 清水川貴之, 森本哲也
:定価: 3,780円 (本体3,600円)
:ISBN13: 978-404-8686297
:ISBN10: 4048686291
:購入: `Amazonで購入`_ (アフィリエイト付き)

.. figure:: http://rcm-images.amazon.com/images/G/09/extranet/associates/buttons/remote-buy-jp1.gif
  :target: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291
  :alt: Amazon.co.jpで買う

.. _`Amazonで購入`: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291


この本について紹介
------------------

原著のレビューアであるShannon "-jj" Behrensが「私も実際に、5 年前にこの本が読みたかったと心から思った種類の本です。」と序文で語っていますが、私もその頃にこの本があればと強く思いました。書籍の目次を http://dl.dropbox.com/u/284189/epp/index.html#id17 で紹介していますが、この本はPython世界でどう活動していけば良いのかを知るのに最適です。また、「Python を知っている」状態から「Python をマスターしている」状態に成長するための本であると同時に、他の言語をある程度マスターしている人がPythonの世界でどのように活動していけばいいのかを知るのに最も適した本でもあります。

自分が翻訳を担当したのは5章～8章ですが、本に記載忘れている気がするので一覧をのせておきます(--;;

:序章: (渋川)
:1章: さあ、はじめよう (渋川)
:2章: 構文ベストプラクティス - クラス以外 (森本)
:3章: 構文ベストプラクティス - クラスの世界 (森本)
:4章: 良い名前を選ぶ (森本)
:5章: パッケージを作る (**清水川**)
:6章: アプリケーションを作る (**清水川**)
:7章: zc.buildoutを使う (**清水川**)
:8章: コードの管理 (**清水川**)
:9章: ライフサイクルの管理 (森本)
:10章: プロジェクトのドキュメント作成 (渋川) `sphinx-users.jpで内容公開中！`_
:11章: テスト駆動開発 (渋川)
:12章: 最適化: 一般原則とプロファイリングテクニック (稲田)
:13章: 最適化: 解法 (稲田)
:14章: Pythonのためのデザインパターン (稲田)
:Appendix: Unicode (稲田)

.. _`sphinx-users.jpで内容公開中！`: http://sphinx-users.jp/articles/index.html#id3

10章は現在 **先行無料公開中** です！HTML/PDF/ePub で10章がまるまる閲覧・ダウンロードできるので是非おためしください！

ところで、この本と同じような章構成・内容でRubyやPHP版をだれか書いてくれないかなあ。

参考
------

* `アスキー・メディアワークスの書籍ページ`_
* `Packt Publishingのページ`_
* `はてなブックマーク`_ 発売前に300ブクマ!
* `DSAS開発者の部屋:「エキスパートPythonプログラミング」を翻訳しました`_ 訳者稲田さんの書籍紹介
* `[mixi] しぶさん | 一部先行公開！今年２冊目のエキスパートPythonプログラミングを`_ 訳者渋川さんの書籍紹介

.. _`[mixi] しぶさん | 一部先行公開！今年２冊目のエキスパートPythonプログラミングを`: http://mixi.jp/view_diary.pl?id=1493809074&owner_id=176757
.. _`DSAS開発者の部屋:「エキスパートPythonプログラミング」を翻訳しました`: http://dsas.blog.klab.org/archives/51739566.html

.. _`アスキー・メディアワークスの書籍ページ`: http://ascii.asciimw.jp/books/books/detail/978-4-04-868629-7.shtml
.. _`Packt Publishingのページ`: https://www.packtpub.com/expert-python-programming/book
.. _`はてなブックマーク`: http://b.hatena.ne.jp/entry/dl.dropbox.com/u/284189/epp/index.html


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 718
:date: 2010-05-22 13:20:00
:title: エキスパートPythonプログラミングのサンプルが届いた！
:categories: ['misc', 'python']
:body type: text/x-rst
:body:
翻訳した本のサンプルがアスキーメディアワークスさんから送られてきた！(なぜかAmazonの箱で)。

自分の誕生日に自分が訳した本が届くとか、タイミング良すぎる。そういえば出版会議で出版が承認されたのは去年のクリスマスイブだったし。

Expert Python Programming と比べてみると若干厚くて、若干重い。オンデマンド印刷の原書に比べると紙の質は良い気がする！


.. figure:: images/expert_python_programming_ja.jpg/image_mini

:タイトル: エキスパートPythonプログラミング
:出版社: アスキー・メディアワークス
:著者: Tarek Ziade
:翻訳: 稲田直哉, 渋川よしき, 清水川貴之, 森本哲也
:定価: 3,780円 (本体3,600円)
:ISBN13: 978-404-8686297
:ISBN10: 4048686291
:購入: `Amazonで購入`_ (アフィリエイト付き)

.. _`Amazonで購入`: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291

.. figure:: http://rcm-images.amazon.com/images/G/09/extranet/associates/buttons/remote-buy-jp1.gif
  :target: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291
  :alt: Amazon.co.jpで買う


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2010-05-22.6570038152
:title: Re:エキスパートPythonプログラミングのサンプルが届いた！
:author: とか★ちん
:date: 2010-05-22 22:24:17
:email: 
:url: 
:body:
自分の名前が本に載るのってすごいな。
なにはともあれ、おめでとう。

:trackbacks:
:trackback id: 2010-05-30.6536916197
:title: [python] エキスパートPythonプログラミング
:blog name: 彷徨えるフジワラ
:url: http://d.hatena.ne.jp/flying-foozy/20100530/1275155241
:date: 2010-05-30 02:54:14
:body:
 稲田直哉氏/渋川よしき氏/清水川貴之氏/森本哲也氏による ”エキスパートPythonプログラミング” を頂きました。 エキスパートPythonプログラミング 作者: Tarek Ziade,稲田直哉,渋川よしき,清水川貴之,森本哲也 出版社/メーカー: アスキー・メディアワークス 発売日: 2010/05

%%%%%%%%%

:id: 719
:date: 2010-05-24 13:25:00
:title: "ブロガー名刺" で個人名刺を作ってみる
:categories: ['misc']
:body type: text/x-rst
:body:
個人の名刺なら個人サイトや本の紹介なんかも載せられるので、さっそくどうやって作るかを色々調べてみました。以前 `個人名刺を注文してみる - takanory.net`_ で紹介されていた `ブロガー名刺`_ も含めて以下のサイトで比較検討してみました。

* `ブロガー名刺／有限会社 前川企画印刷（神戸市兵庫区）`_
* `名刺21|meishi21|名刺印刷、高品質オフセット名刺、激安価格、税込み、全国送料無料、最短当日発送、イラストレーターデータ入稿`_
* `SuperPrint：印刷価格破壊プロジェクト　[名刺印刷最安値保証]`_

この3サイトで比較検討した結果、デザインも含めて作成してくれて一番安かったのが `ブロガー名刺`_ でした。他の2サイトは Adobe Illustrator 以外のデータからの名刺作成（PowerPointとか）は2倍～3倍かかってしまいます。Illustrator持ってないし。

載せるのは、サイトURL, Twitter, `エキスパートPythonプログラミング`_ の紹介, 顔写真, といったところ？自宅の住所や電話番号はどうしようか悩み中。


.. _`個人名刺を注文してみる - takanory.net`: http://takanory.net/takalog/1163/
.. _`ブロガー名刺`: http://www.kobe-maekawa.co.jp/products/bloger.html
.. _`ブロガー名刺／有限会社 前川企画印刷（神戸市兵庫区）`: http://www.kobe-maekawa.co.jp/products/bloger.html
.. _`名刺21|meishi21|名刺印刷、高品質オフセット名刺、激安価格、税込み、全国送料無料、最短当日発送、イラストレーターデータ入稿`: http://www.meishi21.jp/index.asp
.. _`SuperPrint：印刷価格破壊プロジェクト　[名刺印刷最安値保証]`: http://www.superprint.jp/
.. _`エキスパートPythonプログラミング`: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2010-05-24.3226905724
:title: Vistaprintは？
:author: jack
:date: 2010-05-24 15:08:43
:email: 
:url: 
:body:
250枚で2000円はかからないです。常になんかキャンペーンやってますし。

http://www.vistaprint.com/amazon[1-9][0-9]

とりあえず、amazon11で無料サンプル来ました(無料となってるが送料はかかります)。
あと欧米サイズになりますね。

%%%%%%%%%

:id: 720
:date: 2010-06-21 23:25:12
:title: Deliveranceから派生したxdvの開発が活発っぽい
:categories: ['Event', 'Zope', 'Plone']
:body type: text/x-rst
:body:
先日6/19の `(第12回)Zope/Plone開発勉強会`_ でDeliveranceを使いこなす練習をしようと思っていましたが、どうやら今はxdvというDeliveranceから派生したプロダクトの方が活発らしいということで色々と調べてみました。

Deliveranceって何？という方は `Deliveranceデモ`_ をどうぞ。

ということでxdvの特徴をまとめてみました。

* collective.xdv は Ian Bicking が開発したDeliveranceから派生
* xdvはcollective.xdvから分割されたコンテンツ変換ルールコンパイラ
* xdvはルールをコンパイルしてXSLTにしておくことでHTMLを高速に変換可能
* XSLT適用はDeliveranceの動的処理よりも高速
* XSLTの適用はmod_transformなどのXSLT専門モジュールで処理
* XSLT変換が扱えるApache,nginx,Varnish,Plone,WSGIなどに対応
* ルールはDeliverance同様にXPathとCSS3セレクタで記述可能
* Deliveranceで出来なかった特殊なルールも記述できるように拡張
* 実運用ではPython無しで動作可能(XSLT適用できればOK)
* ドキュメントが良い。PyPIのページを見るだけで大体理解できる

ということで、これだけあればOK的な使い方は出来なくなってしまいましたが、逆に組み合わせ自由なので色々な利点が増えました。そんなステキなxdvを詳しく知りたい方は `Python Package Index : xdv 0.3`_ の説明を読んでみて下さい。

来週末6/25からのPython温泉で、使いこなせるように練習する予定です。

-------------------------

勉強会では他にはsetuptoolsを使ったプラグイン機構についてサンプルコードを書いて@terapyonや@jhottaに説明してました。詳しくは次のエントリで。

次回の `(第13回)Zope/Plone開発勉強会`_ もよろしく。 `Sphinx-1.0 リリースパーティー`_ と日が被ってますケド。


.. _`(第12回)Zope/Plone開発勉強会`: http://atnd.org/events/5001
.. _`(第13回)Zope/Plone開発勉強会`: http://atnd.org/events/5844
.. _`Deliveranceデモ`: http://plone3d.freia.jp/deliverance
.. _`Python Package Index : xdv 0.3`: http://pypi.python.org/pypi/xdv
.. _`Sphinx-1.0 リリースパーティー`: http://atnd.org/events/5610


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 721
:date: 2010-06-22 00:55:00
:title: setuptoolsを使ったpluginサンプル
:categories: ['python']
:body type: text/x-rst
:body:
Pythonでplugin的な仕組みを作るとしたら__import__やimpを使う方法が
ありますが、今の流れ的にはsetuptools対応して簡単にパッケージング
や配布、PyPIでの公開、buildoutへの対応など行うことも視野に入れて
いきたいところです。

と言ってもやらないと行けないことは少ないので、__import__の使い方
を調べて試行錯誤するよりも簡単かもしれません。


前準備
------

Python環境にsetuptoolsをインストールしておきます。

.. topic:: wget
  :class: dos

  | $ wget http://peak.telecommunity.com/dist/ez_setup.py
  | $ sodo python ez_setup.py

OSの構成管理ツール(apt,yum,portsなど)でインストールしておいても可。
あるいはvirtualenvを使っても可です。

インストール出来ていれば `easy_install` コマンドが使えるように
なっているはずです。

.. topic:: check
  :class: dos

  | $ easy_install
  | error: No urls, filenames, or requirements specified (see --help)


次に `plugins.zip`_ を展開します::

  plugins/
     +-- README.txt
     +---p1/
     |   +-- foo_plugin.py
     |   +-- setup.py
     |
     +---p2/
     |   +-- bar_plugin.py
     |   +-- setup.py
     |
     +---server/
         +-- server.py


pluginの無い状態での実行
------------------------

'server' フォルダで以下のように実行します。

.. topic:: server
  :class: dos

  | $ cd server
  | $ python server.py
  | ## plugins call finished
  | 
  | $

pluginが無い状態のため、プラグイン呼び出し終了のメッセージのみ表示
されてプログラムが終了します。


pluginを追加
------------

p1というフォルダに入っているpluginを環境に追加します。

.. topic:: develop
  :class: dos

  | $ cd ../p1
  | $ python setup.py develop
  | running develop
  | running egg_info
  | ...
  | ...
  | Installed .../p1
  | Processing dependencies for foo-plugin==0.0.0
  | Finished processing dependencies for foo-plugin==0.0.0
  | 
  | $


今回は実験目的のため `python setup.py develop` でインストールして、あとで
アンインストールしやすいようにしていますが `python setup.py install` としても同じように動作します。


serverを再実行
--------------

'server' フォルダに移動してもう一度以下のように実行します。

.. topic:: server
  :class: dos

  | $ cd ../server
  | $ python server.py
  | ## call plugin: plugin:plugin_name1
  | Hello SERVER (by foo_plugin)
  | 
  | ## plugins call finished
  | 
  | $


pluginをもう一つ追加して再実行
------------------------------

plugin2つめを追加。

.. topic:: p2
  :class: dos

  | $ cd ../p2
  | $ python setup.py develop
  | ...
  | ...
  | Installed .../p2
  | Processing dependencies for bar-plugin==0.0.0
  | Finished processing dependencies for bar-plugin==0.0.0
  | 
  | $

serverを実行。

.. topic:: server
  :class: dos

  | $ cd ../server
  | $ python server.py WORLD
  | ## call plugin: foo_plugin:plugin_name1
  | Hello WORLD (by foo_plugin)
  | 
  | ## call plugin: bar_plugin:plugin_name2
  | Hello WORLD (by bar_plugin)
  | 
  | ## plugins call finished
  | 
  | $


pluginの仕組み
---------------

p1/setup.py のコードはsetuptoolsで拡張されたdistutilsのsetup関数です。

.. code-block:: Python

  setup(
      name="foo_plugin",
      py_modules=['foo_plugin'],
      entry_points="""
         [plugin_example]
         plugin_name1 = foo_plugin:func
      """,
  )

ここでentry_pointsに記載している 'plugin_example' というのがポイントで、
このように書いておくと別のプログラムから以下のようにして関数を取り出す
事ができるようになります。

.. code-block:: Python

  import pkg_resources
  for plugin in pkg_resources.iter_entry_points('plugin_example'):
      ...


後始末
-------

今回実験用にインストールしたプラグインパッケージをアンインストール
しておきましょう。

.. topic:: cleanup
  :class: dos

  | $ cd ../p1
  | $ python setup.py develop -u
  | running develop
  | Removing ../python26/lib/site-packages/foo-plugin.egg-link (link to .)
  | Removing foo-plugin 0.0.0 from easy-install.pth file
  | 
  | $ cd ../p2
  | $ python setup.py develop -u
  | running develop
  | Removing ../python26/lib/site-packages/bar-plugin.egg-link (link to .)
  | Removing bar-plugin 0.0.0 from easy-install.pth file
  | 
  | $


まとめ
-------
ここで説明した方法ではpluginを使えるようにするためには `python setup.py install`
等する必要があります。これはpluginをどこか(PyPI等)に公開しておけば `easy_install`
コマンド一発でpluginを使えるようになる、ということになります。

しかし、場合によってはpluginフォルダにファイルを置くだけで動作するようにしたい
と考えるかも知れません。その方法は次のエントリで書きたいと思います。


参考文献:
 * [Python] setuptools - SumiTomohikoの日記
    * http://d.hatena.ne.jp/SumiTomohiko/20070622
    * http://d.hatena.ne.jp/SumiTomohiko/20070623
    * http://d.hatena.ne.jp/SumiTomohiko/20070624
 * `エキスパートPythonプログラミング`_

.. _`エキスパートPythonプログラミング`: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291
.. _`plugins.zip`: stuff/plugins.zip/download


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2010-06-22.7583323027
:title: Re:setuptoolsを使ったpluginサンプル
:author: nakagami
:date: 2010-06-22 15:22:40
:email: 
:url: 
:body:
PyPI への道（続編）も期待します！

:comments:
:comment id: 2010-06-22.0619591066
:title: Re:setuptoolsを使ったpluginサンプル
:author: jhotta
:date: 2010-06-22 16:51:02
:email: 
:url: 
:body:
参考に成ります。また教えてください。

%%%%%%%%%

:id: 722
:date: 2010-06-22 23:05:00
:title: setuptoolsを使ったpluginサンプル(egg編)
:categories: ['python']
:body type: text/x-rst
:body:
`setuptoolsを使ったpluginサンプル`_ で作ったpluginの仕組みを
ちょっとだけ変更して、plugin用フォルダにファイルを追加したら
pluginとして認識されるようにしてみます。

ここで、pluginファイルの形式としてeggファイルを使うことにします。


前準備
------

Python環境にsetuptoolsをインストールしておきます。
手順は前のエントリ `setuptoolsを使ったpluginサンプル`_ を参照のこと。

次に `plugins_egg.zip`_ を展開します::

  plugins_egg/
     +-- README.txt
     +---p1/
     |   +-- foo_plugin.py
     |   +-- setup.py
     |
     +---p2/
     |   +-- bar_plugin.py
     |   +-- setup.py
     |
     +---server/
         +-- server.py
         +-- plugins/


pluginをegg化して追加
----------------------

p1フォルダでpluginをegg化します。

.. topic:: bdist_egg
  :class: dos

  | $ cd ../p1
  | $ python setup.py bdist_egg
  | running bdist_egg
  | running egg_info
  | ...
  | ...
  | creating dist
  | creating 'dist/foo_plugin-0.0.0-py2.6.egg' ...
  | removing 'build/bdist.xxx/egg' (and everything under it)
  | 
  | $

これでdistフォルダにeggファイルが生成されるので、この
foo_plugin-0.0.0-py2.6.egg をserver/pluginsフォルダに移動します。

.. topic:: install
  :class: dos

  | $ ls dist
  | foo_plugin-0.0.0-py2.6.egg
  | $ mv dist/* ../server/plugins


serverを実行
------------

'server' フォルダに移動して以下のように実行します。

.. topic:: run
  :class: dos

  | $ cd ../server
  | $ python server.py
  | ## call plugin: plugin:plugin_name1
  | Hello SERVER (by foo_plugin)
  | 
  | ## plugins call finished
  |
  | $


pluginの仕組み
---------------

plugin側のコードは前回の `setuptoolsを使ったpluginサンプル`_ で用意したものと
完全に同じで、pluginを使うserver.py側のコードをちょっとだけ変更しました。

server.pyでは以下のコードの例のように、pluginsフォルダの中身を自動的に
sys.pathに追加してからpkg_resourcesを使っています。

.. code-block:: Python

  import sys
  from glob import glob

  sys.path[0:0] = glob('plugins/*.egg')

  import pkg_resources
  for plugin in pkg_resources.iter_entry_points('plugin_example'):
      ...

上記は `import pkg_resources` すると内部でsys.pathを走査する作りになっているためにこのような手順になっていますが、あるいは以下のように書くこともできます。

.. code-block:: Python

  import sys
  from glob import glob
  import pkg_resources

  for p in glob('plugins/*.egg'):
      pkg_resources.working_set.add_entry(p)

  for plugin in pkg_resources.iter_entry_points('plugin_example'):
      ...


（6/26追記）さらにpkg_resources.pyに書かれているサンプルとして以下のコードもあります。

.. code-block:: Python

  import sys
  import pkg_resources

  distributions, errors = pkg_resources.working_set.find_plugins(
      pkg_resources.Environment(['plugins'])
  )
  map(pkg_resources.working_set.add, distributions)

  for plugin in pkg_resources.iter_entry_points('plugin_example'):
      ...


これならsys.pathも汚さないですね。



後始末
-------

今回はpluginをシステムにインストールした訳ではないので、後始末は
特に必要ありません。


まとめ
-------
`setuptoolsを使ったpluginサンプル`_ で説明した方法と比べて、pluginsフォルダ
にeggファイルを置いたりプログラムでpluginsフォルダをsys.pathに追加したりと
手動での管理が増えており、easy_installで自動的にプラグインを追加するなど
の方法は使えなくなってしまいました。しかしこれはこれで使い方によっては
メリットになるかもしれません。

ちなみに、eggファイルは実はzipファイルだとか、pythonはzip圧縮されたパッケージ
をsys.pathに追加しておけばimportできるようになるとか、色々なバックグラウンド
の上でこの仕組みは動作しています。

なお、buildoutを使うことで、buildout.cfgの設定を書き換えるだけでplugin
となるeggを自動的にPyPIから取ってきてシステムに組み込むと言うような
仕組みを作ることも簡単にできるようになります。



参考文献:
 * [Python] setuptools - SumiTomohikoの日記
    * http://d.hatena.ne.jp/SumiTomohiko/20070622
    * http://d.hatena.ne.jp/SumiTomohiko/20070623
    * http://d.hatena.ne.jp/SumiTomohiko/20070624
 * `エキスパートPythonプログラミング`_

.. _`エキスパートPythonプログラミング`: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291

.. _`plugins_egg.zip`: http://www.freia.jp/taka/blog/stuff/plugins_egg.zip/download
.. _`setuptoolsを使ったpluginサンプル`: http://www.freia.jp/taka/blog/721


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 723
:date: 2010-06-22 23:56:06
:title: 昼休みに御茶ノ水の「豚野郎」に行くも行列長くて諦め同じビルの「三浦ハンバーグ」に行ってきた
:categories: ['food']
:body type: text/x-rst
:body:
会社の昼休みに、某所で噂の `豚野郎`_ に行ってきました。場所は御茶ノ水なので会社から（四ッ谷駅まで10分で移動して中央線で10分で）電車で一駅ですね。メンツは@tk0miya,@nkd_aと自分で3人。

ということでお店到着。

.. image:: http://lh4.ggpht.com/_UFvBAM3zElY/TCA9sIj7QrI/AAAAAAAAAX8/GeG0-i1DK2o/s512/P1010911.JPG

ひとつ下の階のハンバーグのキャラが `Goopeのロースおじさん`_ っぽいのが気になる。

細い階段を上がって2階に上がったところで5人くらいの行列がハンバーグ待ちだったのを通り抜けて3階へ。と思ったら2階の階段まで行列が延びてて、豚野郎の店の外だけで10人くらいの行列が...。

1分くらい考えたものの、さすがに昼休み終わってしまうので待てないということになり、 **豚野郎断念** 。12時半という時間も良くなかったねー、と思いつつそのまま2階のロースおじさん、じゃなかった、 `三浦のハンバーグ`_ へ。

.. image:: http://lh5.ggpht.com/_UFvBAM3zElY/TCA92iXONTI/AAAAAAAAAYk/oCAlXON5Vbg/s640/P1010919.JPG

待つこと数分、ハンバーグ2枚+チーズ挟み+卵のせ。1180円。大変おいしゅうございました。

その他の写真はこちら。

* http://picasaweb.google.co.jp/shimizukawa/2010_06_miura_hanbarg


ちなみに、帰り13時ちょっと前くらいに3Fを覗いたら、店の外の行列は無くなってました。次行くときは昼の時間帯を避けて行くことにしよう。


.. _`Goopeのロースおじさん`: http://blog.goope.jp/?eid=65
.. _`豚野郎`: http://r.gnavi.co.jp/e450600/
.. _`三浦のハンバーグ`: http://r.gnavi.co.jp/g754706/


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2010-06-25.3708001587
:title: Re:昼休みに御茶ノ水の「豚野郎」に行くも行列長くて諦め同じビルの「三浦ハンバーグ」に行ってきた
:author: とか★ちん
:date: 2010-06-25 00:12:52
:email: 
:url: 
:body:
俺も今度秋葉原に行く途中でよってみようと思う。

%%%%%%%%%

:id: 724
:date: 2010-06-24 23:33:22
:title: ブロガー名刺、届きました！
:categories: ['misc']
:body type: text/x-rst
:body:
5/24に `"ブロガー名刺" で個人名刺を作ってみる`_ で申込みをしてから3,4回デザインの調整などをしてもらって先週6/14くらいに届きました！表カラー、裏白黒で100枚で1500円でした。封筒に入って届いたんだけど、封筒に定型でない手書きのコメントが入ってて、こういうのはなんだか嬉しいですね！

* `ブロガー名刺／有限会社 前川企画印刷（神戸市兵庫区）`_

名刺デザインのアイディアが全くない状態から載せたい文言と基本色の希望だけ送って作ってもらったにしてはけっこう良い感じになってるんじゃないかなー？

でも、先週Ploneユーザー会後に何人かに見せたら、写真の気合いが足りないって言われた。次更新するときは考えます（笑）


.. _`"ブロガー名刺" で個人名刺を作ってみる`: http://www.freia.jp/taka/blog/719

.. _`ブロガー名刺／有限会社 前川企画印刷（神戸市兵庫区）`: http://www.kobe-maekawa.co.jp/products/bloger.html

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 725
:date: 2010-06-30 20:15:00
:title: BPStudy#34 に参加しました キャバクラとErlangについて
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
`BPStudy#34`_ に参加してきました。
いままで3回くらい申込みだけして全然参加出来てませんでした。
ということで、今回初参加。ネタは"AWS+Tornado+Django+AS3"と"Erlang"。

# pyspaのネタも書かないとなー？


第一部「Amazon Web Service+Tornado+Django+AS3によるリアルチャットサービスの裏側」
---------------------------------------------------------------------------------

* 発表
   * @torufurukawa
   * @akisutesama
   * @wozozo

* https://xacariva.jp/
   * 特徴: アバター, チャット, 内緒話チャット, キャバクラ

導入 by @torufurukawa
~~~~~~~~~~~~~~~~~~~~~~
* チャットのレスポンスは大事だよね
   * EC2の応答性悪いかも知れないよね？
   * 国内のサーバーよりはやはり重い
   * staticについてはクラウドフロントを使うのでなんとか
   * スケーラビリティーを考慮してEC2に決めた

* 構成
   * nginx: フロント
   * django: アバターの着替えなど
   * CloudFront: 静的データ(画像/SWF)
   * Tornado: チャット, ロングポーリング

* nginx
   * ロードバランシング
   * 静的コンテンツ
   * SSL

SWF by @akisutesama
~~~~~~~~~~~~~~~~~~~~

SWFの話。開発中のswfファイルの分割などについての苦労話。
Flashは開発者向けじゃない感じがトークから伝わってきました(笑)

* SWCはマジ使えない http://akisute.com/2010/02/flash-swc.html
* 通信リクエストキューの独自実装
   * シリアル通信
   * パラレル通信
   * 排他的通信
* デザイナーさんがデザインを自由に決められる
   * クローゼット、部屋、歩行領域など。
   * レイヤーがたくさん、たくさんあります
* アバター
   * 1つのアバターを表示するのに120個のswfをとってきて合成
   * 遅そうに聞こえるがかなり実用的な速度で実現している
   * アニメーション、着せ替え(重ね着)、表上アニメーション
   * 重ね着の順番は自由。スーツの上にシャツとか
   * 10人くらい出すとパーツが1000を超える
* アバターを歩かせる
   * A*アルゴリズムを使う。経路探索。（清水川の大学の時の研究課題でした。なつかしい）
   * 目標近傍72ピクセルまで近づく、などもA*の拡張でできた
   * イスに回り込んで正しい角度で座る、という鬼門
* 成功した点（プログラム）
   * Trnadoのパフォーマンスがすさまじく強力, 25人同時スパムも難なく処理
   * 通信制御のキューは比較的うまくいった
   * リリースとテストのビルド環境を分けた
      * ASUnitとかあるけど非同期通信のテストなどは諦めた
      * 環境を分けたメリットはリリース回数に比例して出てきた
* 成功した点（デザイナー）
   * デザイナーさんにFlashの知識があると断然楽！
   * デザイナーさん、ディレクターさん向け確認ツールを用意した
      * アバターをAIRですぐ確認できる
      * ローカルファイルを読めるのでデザイナーさんが更新してすぐ確認できる
* 失敗した点
   * 全面Flashで作っていた方が良かったかも
   * HTTPリクエストが多すぎる
      * API実行がX本
      * チャットが常時1,2本
      * アバター読み込み時に100本以上の通信
      * IEは同時に2本しかできない
         * サブドメイン切って対処した
   * 椅子はやめとけ
      * アバターとの重ね合わせ、アニメーションとの整合性など、とにかく大変
      * flaファイルはできるだけ分割しとけ

うーん、Flashの話は難しいというか、Flashでとても難しいことを実現している。

結論、 **椅子はやめとけ** 。


Tornado by @wozozo
~~~~~~~~~~~~~~~~~~~~

@wozozo 本人を初めて見ました。

* チャット以外は全てDjangoでやっています
* 10000コネクションくらいいけた
* Tornadoのデモコードからインスパイア(笑)されたコード
* 自宅サーバーでデモ(笑)
   * 自宅サーバー程度のスペックでも20人くらいじゃ全然落ちない
* デバッグが大変。稼働中のオンメモリの内容を確認する
* タイムゾーンがハードコーディングで'+0:00'になってた

資料公開希望。シーケンス図とかメモれへんねん。


第二部 Erlang/OTP
------------------

発表 @voluntas

Erlangプロダクト
~~~~~~~~~~~~~~~~~
* RabbitMQ
   * AMQPサーバ
   * VMWareに買収された
   * オープンソース

* ejabberd
   * XMPPサーバ
   * eXtensible messaging and Presence Protocol
   * GoogleTalkが採用しているプロトコル
   * オープンソース

* MochiWeb
   * Webサーバ
   * MochiMediaで開発
   * FacebookやCouchDBで採用

* CouchDB
   * ドキュメント指向DBサーバ
   * IBMが投資
   * T-MobileやBBCで採用
   * オープンソース
   * Ubuntu 10.0.4に最初っから入ってます

* ErlyVideo
   * RTMPサーバ
   * 1台で数千クライアントを処理可能...らしい(ロシア語資料しかない)
   * ロシア製
   * オープンソース

* パケット可視化
   * WebSocket Server(Erlang)(HTML5)
   * WebGL (HTML5)
   * アクセンステクノロジーでDEMO用に開発
      * @MiCHiLU + @webos_godies
   * この組み合わせは世界初！
      * AppEngineで作った
      * サーバーからクライアントにJSONデータを送り続ける
      * ブラウザはJSONをWebGLで描画し続ける
      * ErlangサーバーなのでTornadoには負けません

Erlangってなに？
~~~~~~~~~~~~~~~~
* 並列指向言語
   * 関数型って言ったら怒られたので並列指向って言うことにします
   * spawn(Moduke, Function, Args)で別プロセスを生成可能
   * 軽量プロセス(fibre?)
   * プロセス生成が2,3マイクロ秒
      * コンテキストスイッチはVMがうまいことやってくれる。高速
   * メッセージパッシング
* 再代入禁止
   * A=10の後にA=20と書けません
   * Aという箱に10を入れているのではなく、10という数字をAに束縛している
* グローバル変数禁止
   * 関数単位でしか値が存在できない
   * グローバル変数という概念がそもそもない
* パターンマッチ
   * パターンマッチがあればifは要らない
   * ifは1万行のうち1回使うかどうか
   * 関数の引数でパターンマッチ
   * 関数の評価結果はcase ofでパターンマッチ
   * ビット列でパターンマッチ
      * <<A:1, B:2, C:5>> = <<255>>.  でA=1,B=3になる
      * ネットワークパケットをパターンマッチで処理分岐する
      * これをCでやることを考えると泣けてくる

OTP
~~~~
* Open Telecom Platform
   * 名前は負の遺産じゃない？
   * OTPがあることが重要。Erlangそのものより重要
   * サーバーが簡単に立てられる
      * そのサーバーを監視するSuperVisorも用意されている
      * gen_server, supervisr, applicationの3つが基本


ErlangのDB
~~~~~~~~~~~
* Mnesia
   * Erlang標準の分散DB
   * メモリとファイルの二方式
   * 障害にも強い
   * 同期はTCP
   * トランザクション処理すれば同期先まで保証
   * 2GBまでしか入らないという制限も。
   * QLCというSQLっぽいものもあるけどそんなに使えない
      * [ A || A <= [1,2,3,4] ].
      * << A:8 || A<- [1,2,3,4] >>.  (書き方忘れたvoluntas)
      * [ A || A <= mnesia:table(Schema), B <- mnesia:table(Schema2), A =:= B]
   * mnesiaの使い方
      * mnesia:write(Table, A).
      * mnesia:read(Table, Key).
      * activity いいよ！

CouchDBは自前のBTreeで作っている

R14A
~~~~~
* 末尾のAはアルファリリース, Bはベータ
* 2010/6/16 にR14Aがリリースされた
   * けっこう大きく更新された
* 9月にR14Bが公開される予定


その他
~~~~~~~

* こぼれ話
   * ErlangはJavaより遅くてPythonより早いです
   * 超簡単に負荷ツールを作れるのでTornadoくらい簡単に落とせます
   * でも経験上、先に送信元のルーターが落ちます(笑)
   * Erlangはすごい簡単。覚えること少ないのでPythonより簡単
   * パターンマッチ覚えたらPythonに戻れない
   * 将来載せたい機能は"取りあえず載せて置いて、アンドキュメント＆自己責任"
   * Erlangはネットワークサーバーを書くための言語
   * 文字列処理は本気でいけてない。OSSのサードパーティー製も放置が多い
      * XMLパーサはひどい (xmerl)
      * やるなら自社または個人で開発してGitHubなどに公開して採用する方がよほどよい
      * ScalaはXMLのパターンマッチが出来る(@methane)
      * Erlang陣営はXMLイケテナイと思っているので期待しない
   * C拡張するには
      * SEGV覚悟で内部に結合するか（速いけど落ちる）
      * 別プロセスにして通信するか（遅い）
   * ASN.1を食わせるとパーサーをはき出してくれる
      * LDAPのを食わせるとLDAPのプロトコルパーサーをすぐ作れる

* Q and A
   * プロセスの優先度設定などは？ -> 出来ません
   * escriptがR14Aで良い感じ
   * OMakeいいよ
      * OCamlで作られたMake
   * 1台に幾つのErlangを立ち上げるのがよいか？
     -> 1台1つが良いと思います -> 1つ落ちても死なない構成にするのがよい
   * GCの停止時間はありますか？ -> 無いです
   * TCPコネクション開きすぎでボトルネックにならない？
     -> fdは100万くらいいけるので大丈夫
   * デバッガは無いんですか？ -> printfです(笑)
   * UnitTestは？ -> あります。ゴリゴリテスト書きましょう

* (voluntas) 本音を言ってしまえば、Erlangに使い道は無いです
   * Erlangベースのプロダクトを使う、というのはあり。
   * MochiWebは現実的


第三部 懇親会
--------------

13人申込み http://atnd.org/events/5202



.. _`BPStudy#34`: http://atnd.org/events/5201



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 726
:date: 2010-07-18 12:51:53
:title: Windowsでpyreadline-1.6を使うとCtrl+H押下で文字削除出来ない問題のパッチ
:categories: ['python', 'Windows']
:body type: text/x-rst
:body:
Windows上のPythonでreadlineを使えるようにするパッケージ pyreadline_ 1.6 が2010/7/15にリリースされました。pyreadline-1.5ではCtrl+H押下時に以下の問題がありました。

* `Windowsでpyreadlineを使うとCtrl+H押下時にカーソルが進む`_
* `pyreadlineのパッチを修正`_

これが1.6で修正されたという通知がバグトラッカーから来たので確認してみましたが、今度はCtrl+H押下時に、文字削除もカーソル移動も何も起きなくなりました。うーん、問題は修正されたかも知れないですが、機能も減っちゃってますね。

ということで、さっそく1.6に対する修正パッチを作成してバグトラッカーに登録しておきました。 https://bugs.launchpad.net/pyreadline/+bug/491941

以下がそのパッチです::

    --- pyreadline-1.6/keysyms/keysyms.py.orig
    +++ pyreadline-1.6/keysyms/keysyms.py
    @@ -117,7 +117,12 @@
         meta = (state & (1+2)) != 0
         shift = (state & 0x10) != 0
         if control and not meta:#Matches ctrl- chords should pass keycode as char
    -        char = chr(keycode)
    +        if keycode in (0x48, 0x4d, 0x68, 0x6d):
    +            keycode = ord(char)
    +            control = False
    +            shift = False
    +        else:
    +            char = chr(keycode)
         elif control and meta:  #Matches alt gr and should just pass on char
             control = False
             meta = False

さて、これはいつになったら直るかなー。


.. _pyreadline: http://pypi.python.org/pypi/pyreadline
.. _`Windowsでpyreadlineを使うとCtrl+H押下時にカーソルが進む`: http://www.freia.jp/taka/blog/690
.. _`pyreadlineのパッチを修正`: http://www.freia.jp/taka/blog/706


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 727
:date: 2010-07-19 21:12:22
:title: Pythonで入れ子Zip内のファイルを透過的に開く方法 - zip_openを使う
:categories: ['python']
:body type: text/x-rst
:body:
Pythonは標準で、パッケージをzip圧縮しておいてこの中身を直接importすることができます。
例えば::

 packages.zip
  + foo.py
  + bar.py

このようなzipファイルを /path/to/packages.zip に置いて、Pythonインタプリタで以下のように実行することが出来ます。

.. code-block:: Python

  import sys
  sys.path.insert(0,'/path/to/packages.zip')

  import foo, bar
  foo.func()

この方法を使えば、 Google App Engine のような配置出来るファイル数に上限のある環境や、たくさんのファイルをベタに展開したくない状況（Pythonで作ったアプリを人にあげるとき）などに単純にファイル数を減らすことが出来ます。

このようなzip圧縮して配布する方法は、py2exe(-bオプション)やsetuptools(zip_safeオプション)などでも使われています。

しかし、対象パッケージが静的ファイル(htmlテンプレートやiniファイルなど)が含まれている場合にzip圧縮パッケージは問題になります。例えばpackages.zipが以下のようになっているとします::

 /path/to/packages.zip
  + foo.py
  + bar.py
  + setting.ini


そして、前述のfoo.pyのプログラム中で ``open(os.path.join(os.path.dirname(__file__)),'setting.ini'))`` などと書いていてると、ここでopenしようとするファイルは '/path/to/packages.zip/setting.ini' になります。このようなpathはopenで開くことが出来ないのでエラーになります。

このような理由でzip_safeでないeggファイルはかなりたくさんあり、これを解決するopen関数があれば割と嬉しい人がいるんじゃないかと思うわけです。Python標準のzipimport.zipimporterを使えば似たようなことは出来ますが、このモジュールでは入れ子のZipファイルを扱うことが出来ません。

作ってみました
--------------------

あったらうれしい、ということで `zip_open`_ パッケージを作ってみました。このパッケージは以下の機能を提供しています。

.. _`zip_open`: http://pypi.python.org/pypi/zip_open


インストール方法
~~~~~~~~~~~~~~~~~~~~~
::

  $ easy_install zip_open


利用例1: zipファイル内のファイルを開く
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

packages1.zip の例::

   packages1.zip
     + file1.txt

file1.txt を開きます::

   >>> from zip_open import zopen
   >>> fobj = zopen('packages1.zip/file1.txt')
   >>> data = fobj.read()
   >>> print data
   I am file1.txt, ok.

上記のコードは以下のコードと等価です::

   >>> from zipfile import ZipFile
   >>> zipobj = ZipFile('packages1.zip')
   >>> data = zipobj.read('file1.txt')
   >>> print data
   I am file1.txt, ok.


利用例2: 入れ子になったzipファイル内のファイルを開く
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

packages2.zip の例::

   packages2.zip
     + data2.zip
        + file2.txt

file2.txt を開きます::

   >>> from zip_open import zopen
   >>> fobj = zopen('packages2.zip/data2.zip/file2.txt')
   >>> print fobj.read()
   I am file2.txt, ok.


利用例3: zip圧縮されたパッケージ内のモジュールからファイルを開く
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

packages3.zip の例::

   packages3.zip
     + foo.py
     + file1.txt
     + data3.zip
        + file3.txt

foo.py のコード例::

   import os
   from zip_open import zopen

   def loader(filename):
       fobj = zopen(os.path.join(os.path.dirname(__file__), filename))
       return fobj

foo.pyのloader()をインタラクティブシェルから呼び出してファイルを開きます::

   >>> import sys
   >>> sys.path.insert(0, 'packages3.zip')
   >>> import foo
   >>> fobj = foo.loader('file1.txt')
   >>> print fobj.read()
   I am file1.txt, ok.
   >>> fobj = foo.loader('data3.zip/file3.txt')
   >>> print fobj.read()
   I am file3.txt, ok.


次の目標
---------
実際にこの仕組みを使うと嬉しいパッケージ(jinja2を使った自分のアプリ等)を調べて、この仕様で機能に過不足がないか検証する。あと入れ子になったzip内のモジュールをimport出来ると嬉しいかな。

元々は gaepytz_ を使っているGoogle App Engineアプリをzc.buildoutのappfy.recipe.gaeで環境管理しようとしたところ、zoneinfo.zipが入れ子zipの中に入ってしまってファイルを開けなくなってしまったため、なんとかできないかなーと思ったのが `zip_open`_ を作成した動機でした。 gaepytz_ の作者に入れ子zipでも動作するようにパッチを作って送ったはずみで、勢いでPyPIに登録してしまったという。。他に色々やることあったんだけど、これ作るのに半日使っちゃったよ。

.. _gaepytz: http://pypi.python.org/pypi/gaepytz


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 728
:date: 2010-08-23 13:35:00
:title: Zope/Plone開発勉強会#14 でxdvについてまとめました
:categories: ['python']
:body type: text/x-rst
:body:
8/21(土) は `Zope/Plone開発勉強会#14`_ でした。

.. _`Zope/Plone開発勉強会#14`: http://atnd.org/events/6694

そこでxdvのQuickStartについてまとめたので、貼っておきます。

なお、xdvはDeliveranceから派生した互換プロジェクトです。概念についてはDeliveranceの紹介スライドを参照して下さい。 -> `Deliveranceによるデザインカスタマイズ`_ (Ploneを題材にしていますがPlone以外、Python以外でも利用できますよ!)

.. _`Deliveranceによるデザインカスタマイズ`: http://plone3d.freia.jp/deliverance/deliverance-presentation/presentation_view



XDV クイックスタート
=====================

このクイックスタートでは、あるサイトの見た目を変化させて表示するHTTPサーバーを用意します。これで、xdvのルール設定をしながら画面がどう変わるかを確認することが出来るようになります。この目的のため、以下のパッケージを利用しています。

:xdv: ルールコンパイラ
:dv.xdvserver: WSGIフィルタ
:Paster: WSGIサーバー, Proxy


インストール: buildoutの場合
-----------------------------

zc.buildoutを利用すれば、OS上の/usr/lib/pythonなどにあるsite-packagesにインストールせずに色々なpythonライブラリを利用した環境を構築する事が出来ます。詳しくは `Python Hack-a-thon 4 ハンズオン 中級コース`_ などを参照してください。

.. _`Python Hack-a-thon 4 ハンズオン 中級コース`: http://dl.dropbox.com/u/284189/pyhack4/build/html/index.html

buildout環境
~~~~~~~~~~~~~
まずはbuildout環境を初期化します。

::

    $ mkdir /tmp/xdvenv
    $ cd /tmp/xdvenv
    $ wget http://svn.zope.org/repos/main/zc.buildout/trunk/bootstrap/bootstrap.py
    $ python bootstrap.py init

buildout.cfg
~~~~~~~~~~~~~
つぎにbuildout.cfgが生成されているので、このファイルを以下の内容で記載します。

::

    [buildout]
    parts = xdv xdvserver
    
    [xdv]
    recipe = zc.recipe.egg
    eggs =
    	xdv
    	dv.xdvserver
    	PasteDeploy
    interpreter = py

bin/buildout
~~~~~~~~~~~~~
以下のコマンドを実行して環境を構築して下さい。

::

    $ bin/buildout

これで環境構築は完了です。


dv.xdvserver-1.0b7 へのpatch
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
dv.xdvserver-1.0b7には日本語関連のバグがあるので、ちょっとパッチあてます。なお、これはxdvのバグではなくWSGI層のバグなので、Ploneで使われているcollective.xdvなどを使っている場合は、問題無いはずです。

::

    --- C:/Project/buildout-eggs/dv.xdvserver-1.0b7-py2.6.egg/dv/xdvserver/filter.py.orig	Sat Aug 21 17:05:44 2010
    +++ C:/Project/buildout-eggs/dv.xdvserver-1.0b7-py2.6.egg/dv/xdvserver/filter.py	Sat Aug 21 17:57:38 2010
    @@ -66,10 +66,9 @@
         
         def apply_transform(self, environ, body):
             
    +        body = body.decode('utf-8') # add this line
             content = etree.fromstring(body, parser=etree.HTMLParser())
             transformed = self.transform(content)
    -        return etree.tostring(transformed)
    +        return etree.tostring(transformed, encoding='utf-8') # add encoding
         
         def __call__(self, environ, start_response):
         

設定ファイルの作成
-------------------

wsgi.ini
~~~~~~~~~
動作確認用に設定ファイルを書きます。buildout.cfg等と同じディレクトリにwsgi.iniを作成して以下の内容を記載します。bin/pasterコマンド(PasteDeployのスクリプト)にこのファイルを渡すとWSGIアプリケーションを動的に作成してくれます。

::

    [server:main]
    use = egg:Paste#http
    host = 0.0.0.0
    port = 8000
    
    [composite:main]
    use = egg:Paste#urlmap
    /static = static
    / = default
    
    [app:static]
    use = egg:Paste#static
    document_root = %(here)s/static
    
    [pipeline:default]
    pipeline = egg:Paste#cgitb
               egg:Paste#httpexceptions
               xdv.theme
               proxy
    
    [filter:xdv.theme]
    use = egg:dv.xdvserver#xdv
    theme = %(here)s/static/theme.html
    rules = %(here)s/static/rule.xml
    live = true
    
    [app:proxy]
    use = egg:Paste#proxy
    address = http://www.ruby-lang.org/

上記の例では最後の行でRubyの公式サイトを表示するようにしています。

最後に、上記設定ファイルで指定しているディレクトリやファイルを用意します。まずstaticディレクトリを作成して、その中にそれぞれ以下の内容でtheme.htmlとrule.xmlを置いて下さい。

theme.html
~~~~~~~~~~~
このファイルでこれから作成するサイトのデザインを定義します。このHTMLファイルに、動的に内容を埋め込んでいくルールを、次に説明するrule.xmlで指定します。

::

    <html>
        <head>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
            <title>XDVの練習中です</title>
        </head>
        <body>
            ほげほげ
        </body>
    </html>


rule.xml
~~~~~~~~~
ルールです。取りあえず空。

::

    <rules xmlns="http://namespaces.plone.org/xdv"
           xmlns:css="http://namespaces.plone.org/xdv+css">
    
    </rules>


プログラムの実行とルールのカスタマイズ
---------------------------------------

起動とアクセス
~~~~~~~~~~~~~~~
以下のコマンドで起動して下さい。前述の設定通りであれば8000番ポートで起動します。

::

    $ bin/paster wsgi.ini

起動したら http://localhost:8000/ にアクセスして下さい。あ、対象サイトがリダイレクト応答を返してくる場合、今の設定ではリダイレクトしてしまうので、今回のrubyサイトの例では http://localhost:8000/ja/ にアクセスするなどしてください。

ルールのカスタマイズ
~~~~~~~~~~~~~~~~~~~~~

rule.xml を編集しましょう。例えば以下の行を追加します。

::

	<append theme="/html/head" content="/html/head/link"/>
	<replace theme="/html/body" content="/html/body"/>


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 729
:date: 2010-08-27 21:05:00
:title: BPStudy#36 に参加しました Jiemamyとbeproud-bot君の紹介
:categories: ['Event']
:body type: text/x-rst
:body:
BPStudy#36 に参加しました Jiemamyとbeproud-bot君の紹介

`BPStudy#36`_ に参加してきました。
前回35回にも参加してましたが疲れててメモ取らなかったからな……。

.. _`BPStudy#36`: http://atnd.org/events/7114

今回のネタは"Jiemamy"と"beproud-bot君"。


第一部「DB meets Jiemamy ? 「ＤＢも、進化せよ。」」
------------------------------------------------------

* 発表
    * `@daisuke_m`_, http://d.hatena.ne.jp/daisuke-m/
    * `@regtan`_, http://d.hatena.ne.jp/celitan/

.. _`@daisuke_m`: http://twitter.com/daisuke_m
.. _`@regtan`: http://twitter.com/regtan

* http://jiemamy.org/display/PORTAL/Home
    * これはモデリングツールじゃないですよ！


Jiemamyとは
~~~~~~~~~~~~
Jiemamyサイトから引用:

    Jiemamyは単なるER図エディタではありません。ER図を使ってデータの編集を行いますが、大局的な目的は、データベース構成管理プロセスを改善し、より変更に強いソフトウェア開発を実践できる環境づくりをすることです。

    機能
        * データベース構成（スキーマ＋データセット）情報のモデル化及びその操作
        * アプリケーションの各リビジョンに対応する構成情報の管理
        * アプリケーションのビルドに伴った、モデルに沿ったデータベース構成の自動構築

発表からポイントをメモ
~~~~~~~~~~~~~~~~~~~~~~~
* Jiemamyは `開発モデル`
* SVNからプロジェクトを持ってきてもすぐ動く訳じゃない
* antやMavenなどの `スマートビルド` はプロジェクトに必須
* DB構成(スキーマ)もプログラムのリビジョンと合わせて管理が必須
* JiemamyのデータはXML(マージの可能性)
* ER図エディタが欲しいならJiemamy以外に良いのが色々あるよ
* JiemamyのER図エディタはデータファイル形式を考え抜いている（まだ考えてる）
* モデルエディタで開始スクリプト・終了スクリプトを設定出来る
* Jiemamyが究極的に目指すのは一つのjerからどのDB向けのSQLも生成できる
    * だから開始スクリプト・終了スクリプトはあまり使わない方が良い

しみずかわの理解
~~~~~~~~~~~~~~~~~~
* ああ、ジーマミーって沖縄の豆腐料理ですね。
* Jiemamyプロジェクトは概念を伝えるプロジェクト
* 概念を伝えるための矯正器具・サポートツールを提供する
* DBスキーマ管理をJavaで提供するための補助ツール(ER図エディタ等)を提供
* Rubyのmigration管理の概念と同じ感じ

質疑応答なかったので質問を書いておく
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* dialectはエディタ上以外でも指定できますか？アプリが使うDBとJiemamyがはき出すDBのSQL形式が連動して欲しいので、DB形式指定は1カ所にしたいわけです

* モデル図のPDF出力や印刷など、納品物生成的な使い方はできますか？

結論
~~~~~
* Jiemamyは `開発モデル` ！


第二部 beproud-bot君の紹介
---------------------------

発表: `@haru860`_

.. _`@haru860`: http://twitter.com/haru860

発表からポイントをメモ
~~~~~~~~~~~~~~~~~~~~~~~
* 「子は鎹」という言葉があるが「beproud-botは鎹」
* メンバーの何名かがbot化されている
* グループチャットにbeproud-botを招待するとコマンドに答えてくれる
* Skypeを中心に据える
    * みんなが入ってるグループチャットを作る
    * コミットやNagiosのアラートなどもSkypeのグループチャットに集める
    * 同じ場所にいてもSkypeを見る
    * そのうち違う場所に居ることに気づかなくなる
        * 小さい会社だと場所の問題があるのでこれは重要
        * 能力を分かっている協力メンバーは完全リモートで参加が出来る
    * 週一回の進捗管理ミーティングなどが基本的に不要になる
        * 常に進行状況が見えている
    * 雑談の中にこそ会社のメンバーの要望などが潜んでいる
        * BP4などの効果的な福利厚生を提供できる
* beproud-botはオープンソースになっています


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 730
:date: 2010-08-29 21:30:00
:title: cmscomさん主催の開発合宿に参加してきました
:categories: ['Event', 'python', 'Programming', 'trip', 'web']
:body type: text/x-rst
:body:
8/28, 29 の2日間、 `CMSコミュニケーションズ`_ さん主催の開発合宿に初めて参加してきました。

今回の10回目まで毎回合宿会場を変えているらしいのですが、今回は残念ながらネットワーク難民が大量に発生するサバイバルな合宿になってしまいました。どうやら、 **初回以来の大遭難（ping的な意味で）** だったようです。会場は、那須塩原の少し先の黒磯。UQ-WiMAXは圏外、emobileもホテルの居室内ではギリギリでした。室内にLAN口があったのでこれでなんとか。2日目に借りたホテルの会議室ではLAN口もなく、emobileもアウトでping通らず。自分は普段オフラインでも開発出来るようにしているので問題無かったのですが、他の皆さんはなかなかキビシかったようで...。それでも最後にはかなり濃い成果発表を聞くことが出来ました。

参加者の方々の成果発表ではiPhoneやiPadのアプリ開発や活用関係が多く、プログラムを書かずにiPhoneアプリっぽいものを作れる `Sencha`_ は非常に興味深かったです。最近手を広げすぎなのでしばらく触る予定はないけど、いつか触るかも。

一緒に参加した `@tk0miya`_ 先生は定義からWeb画面のモックを生成するツールを作ってました。つまり、Sphinxのディレクティブに実装すれば画面設計図を作れるという話ですね、期待してます@tk0miya先生！（geckoエンジンでWeb画面を画像ファイルにする仕組みにする予定なのでSphinxに組み込むには依存が多すぎるらしいですが...）期待してます。

あとは教育系の話題が多かったのが興味深い。アルゴリズムの学習とか。

自分はまたまた `xdv`_ の活用方法について色々とまとめていて、今回の合宿ではまずまずの成果を上げることが出来ました。この成果は近いうちに公開出来るんじゃないかなと思っています。


.. _`CMSコミュニケーションズ`: http://www.cmscom.jp/
.. _`Sencha`: http://extjs.co.jp/products/touch/
.. _`@tk0miya`: http://twitter.com/tk0miya
.. _`xdv`: http://pypi.python.org/pypi/xdv

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 731
:date: 2010-09-04 17:10:00
:title: XP祭り2010に登壇しました「Pythonでアジャイル開発サイクル 2010ver.」
:categories: ['Agile(XP)', 'Event', 'python']
:body type: text/x-rst
:body:
XP祭り2010に参加して「Pythonでアジャイル開発サイクル 2010ver.」というタイトルでセッションを持たせていただきました。短時間で浅く広く駆け足での紹介だったため、満足いただける内容だったかどうか心配ですが…お役に立てれば幸いです。

というかですね、いつも準備が足りないんですよね。「夏休み最終日症候群」はなんとかならないものか。少しずつ準備は進めていたんですが、言い訳ですね。はい。

発表した資料は以下で閲覧できます。

* `Pythonでアジャイル開発サイクル 2010ver.`_

.. _`Pythonでアジャイル開発サイクル 2010ver.`: http://www.freia.jp/taka/docs/xpfest2010/

.. note:: 2010/9/6 追記:

  Jxckさんがセッションの雰囲気を再現した詳細なレポートを書いてくれました！資料と合わせてどうぞ！ `XP祭り「Pythonでアジャイル開発サイクル2010ver.」レポート - but hopeful`_ 

.. _`XP祭り「Pythonでアジャイル開発サイクル2010ver.」レポート - but hopeful`: http://d.hatena.ne.jp/Jxck/20100905

資料はreSTを書いて `Sphinx`_ でS6形式に変換して `S6`_ で表示するようにしています。上下左右キーでスクロール等できますが、Firefoxが一番動作が早いような気がします。

.. _`Sphinx`: http://sphinx-users.jp/
.. _`S6`: http://delicious.com/shimizukawa/s6

思い返すと、このblogの1投稿目がXPユーザー会のイベントで `Martin Fowler夫妻とGregor Hohpe氏を囲む会`_ に参加したレポートだったんですね。2004年ってだいぶ前だな－。

.. _`Martin Fowler夫妻とGregor Hohpe氏を囲む会`: http://www.freia.jp/taka/blog/1

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 732
:date: 2010-09-05 08:29:29
:title: XP祭り2010実行委員長の基調LTレポート
:categories: ['Agile(XP)', 'Event']
:body type: text/x-rst
:body:
XP祭り2010で、渋川さんの基調LTが行われたのでそのメモです。

----------------------------------

私（渋川さん）はXPJUGの会長になってしまったので、もうLTは出来ない！
なので渋川LTの秘密を語ります！

* ターゲット
	* あなたが話したいことを皆は聴きたいと思っていない
	* その場の人が聞きたいものをしゃべる

* USP(ユニークセリングポイント)
	* 得意なもの、あなたが上級者でいるもの
	* 客層と一緒ならそのまま発表
	* 特殊な組み合わせは1位になりやすい

ネタを決めたら迷わない
	* まずはテキストですぐに書き出す → しゃべり原稿になる
	* 動画やデモなどを集める
	* 話しやすい構成を作る

今回渋川さんのスライドが文字大量なので、ここから先は単純メモはしない

しかし、色々詰め込もうとする自分の癖を見抜かれている気がする。精進しよう。

----------------------------------


オレメモ
---------
* 今週、蕁麻疹になってしまって対処薬で眠くなってしまって絵が少ないらしい
* 今週蕁麻疹って、自分が先週かかった蕁麻疹がうつったんじゃないのか？（笑
* iPhoneかtouchでスライドめくりを操作していたけれど、途中から操作出来なくなったっぽい(笑
* XP祭り、コミュニティーの振り返り
* 後半はコミュニティーの話になってきた

基調LTだけどライトニングじゃない落ち着いた大人の渋川さんトークでした。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 733
:date: 2010-09-06 00:36:19
:title: Sphinx+翻訳Hack-a-thon2010.09に参加しアクセンスさんに初侵入しました
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
月1回行っているSphinx+翻訳Hack-a-thonも今回で2回目、今回の会場はアクセンステクノロジーさんの会議スペースをお借りしました。簡単なレポートがSphinx-users.jpサイトに上がっているので、レポートについてはそれを見ると良いんじゃないかな。

* `Sphinx翻訳ハッカソン(2010/09/05)`_

.. _`Sphinx翻訳ハッカソン(2010/09/05)`: http://sphinx-users.jp/event/20100905_translating_hackathon.html

-------------------------

以下、自分の記憶メモです。最近物忘れがひどいので。

* 最寄り駅が神楽坂と聞いて迷わず新宿→馬場→神楽坂と行ったら、牛込神楽坂だった。そんな駅があるんだ！？
* @tk0miya がエキPyのサイン欲しいけど本が会社にある、というので新品の本を持って行って貸してあげた。あとで返してもらう予定。
* アクセセンスさんには初めてお邪魔したけど、近未来的なオフィスカッコイイ！かった。
* 今回も初めて会う方（某英語公用語会社の方）が参加されて、結構長くSphinx使っているという話に刺激を受けるなど。
* Wiiで昼ご飯のCoCo壱カレーを注文。あれはこういう時に使うアプリだったんだね。
* `Pythonパッケージ ヒッチハイク・ガイド`_ 翻訳するつもりが、昨日のデモで失敗した原因を調べてるうちに夜になった。あれー・・・
* 夜は神楽坂のお店で焼き鳥とサラダをいただいた。神楽坂地ビールとかおいしかった。
  写真はこちら -> `Picasa`_
* 神楽坂ビールの名前がミケ、クロ、ドラだった。猫か！

.. _`Picasa`: http://picasaweb.google.co.jp/shimizukawa/2010_09_05_sphinxHack#
.. _`Pythonパッケージ ヒッチハイク・ガイド`: http://shimizukawa.bitbucket.org/python-distribute-ja/

参加された皆さん、お疲れ様でした！


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 734
:date: 2010-09-13 23:55:00
:title: Pythonの動的クラス生成と特殊メソッドとフレームの謎
:categories: ['python']
:body type: text/x-rst
:body:
先日、とある事情からクラス定義を動的に生成する必要があったのですが、そこでおかしな現象にはまってしまい、今もまだ解決出来ていません。

.. note::

  9/14 2:00 追記: この投稿の内容はWindowsのPython2.6.4, 2.7, FreeBSDのPython2.4.4で試しました。

  9/14 12:20 追記: 解決しました.... 勘違いした部分に追記入れておきます


動的なクラス生成
------------------

クラス定義を動的に生成するのは結構簡単にできます。例えば以下のように静的に定義して使う例があるとして、

.. code-block:: Python

    >>> class Foo(object):
    ...     def foo(self, a):
    ...         return a
    ...
    >>> f = Foo()
    >>> f.foo('hoge')
    'hoge'

これと同じことを以下のように書けます。

.. code-block:: Python

    >>> attrs = {
    ...     'foo': lambda self, a: a
    ... }
    >>> Foo = type('Foo', (object,), attrs)
    >>> f = Foo()
    >>> f.foo('hoge')
    'hoge'


ここまではtype()の使い方の一つとして知っていれば、詳しい原理などを知らなくても、まあ問題無く使える気がします。

特殊メソッド
--------------

もう一つ、本題に入る前に特殊メソッドの使い方の例。例えばあるクラスに__len__というメソッドを実装してその動きを見てみます。

.. code-block:: Python

    >>> class Bar(object):
    ...     def __len__(self):
    ...         return 10
    ...
    >>> b = Bar()
    >>> len(b)
    10
    >>> b.__len__()
    10

len(b)で10という値が返ってきているし、__len__()を直接呼び出しても10が返ってきます。でも、len()関数がオブジェクトの__len__()メソッドを呼んでる、のでは無いところには注意。表現としては「len()アダプタはその内部で、対象オブジェクトと__len__プロトコルで通信して10という結果を返している」と書いた方が良いと思います。

ちょっと脱線ですが、試しに以下のように書いてみます。

.. code-block:: Python

    >>> class Bar2(object): pass
    ...
    >>> b2 = Bar2()
    >>> b2.__len__ = lambda: 10
    >>> b2.__len__()
    10
    >>> len(b2)
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
    TypeError: object of type 'Bar2' has no len()

上記エラーメッセージを見ると、Bar2という型はlen()を持っていないというエラーが出ているので、インスタンスではなくクラスに__len__を後付けしてみます。

.. code-block:: Python

    >>> class Bar3(object): pass
    ...
    >>> b3 = Bar3()
    >>> len(b3)
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
    TypeError: object of type 'Bar3' has no len()

    >>> Bar3.__len__ = lambda self: 10
    >>> len(b3)
    10

クラスに特殊メソッドを後付けしてもちゃんと動作する事が分かりました。


ここからが本題
----------------

先の2つの話を組み合わせて、以下のように動的に特殊メソッドを持つクラスを生成します。これはうまく動くので、クラス生成する関数をgen_safe()という名前にしました。

.. code-block:: Python

    >>> d = {
    ...     '__len__': 10,
    ...     '__str__': 'va-',
    ... }
    ...
    >>> def gen_safe():
    ...     attrs = {}
    ...     attrs['__len__'] = lambda self: d['__len__']
    ...     attrs['__str__'] = lambda self: d['__str__']
    ...     return type('Gen', (object,), attrs)
    ...
    >>> Gen = gen_safe()
    >>> g = Gen()
    >>> str(g)
    'va-'
    >>> len(g)
    10

期待通りに動作したので、次に冗長なコードを最適化してみます。でもうまく動かなくなってしまったので、クラス生成関数をgen_fail()という名前にしました。

.. code-block:: Python

    >>> d = {
    ...     '__len__': 10,
    ...     '__str__': 'va-',
    ... }
    ...
    >>> def gen_fail():
    ...     attrs = {}
    ...     for name in ('__len__', '__str__'):
    ...         attrs[name] = lambda self: d[name]
    ...     return type('Gen', (object,), attrs)
    ...
    >>> Gen = gen_fail()
    >>> g = Gen()
    >>> str(g)
    'va-'
    >>> len(g)
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
    TypeError: an integer is required

``attrs`` を作成する処理をforループに書き換えたら動かなくなってしまいました。ここで内部的にはlen(g)した時点でgと__len__プロトコルで通信しているわけですが、その結果len()内部で ``'va-'`` という文字列を受け取ってしまい、__len__プロトコルで受け取る値は数値型であるという条件チェックにひっかかって ``TypeError: an integer is required`` エラーになっている事が分かりました。でも,,,

.. code-block:: Python

    >>> g.__len__()
    10

上記のコードはエラーにならないんですよね。謎は深まるばかりです。

.. note::

  9/14 12:20 追記: 上記は勘違いです。g.__len__()は'va-'を返します。
  色々やっているうちに混乱していたようで… 謎は深まりませんでした。

-------------------------

ところで、先日の `エキスパートPythonプログラミング読書会02`_ で、内包表記で閉じ込められた変数が属しているスタックはどこまで持って行かれるのか、という話が出ていたのに対して、@atsuoishimoto さんが `「スタックってか、フレームオブジェクトが保存される。」`_ とコメントしてくれていたことから、以下のように書き換えることを思いつきました。

.. _`エキスパートPythonプログラミング読書会02`: http://atnd.org/events/6954
.. _`「スタックってか、フレームオブジェクトが保存される。」`: http://twitter.com/atsuoishimoto/status/23230187180

.. code-block:: Python

    ...     for name in ('__len__', '__str__'):
    ...         attrs[name] = lambda self, __name=name: d[__name]

nameの値をlambda定義の外から渡すことでフレームオブジェクトを保存しないようにしてみようと思ったわけですが……、なんと！これで期待通りに動いてくれました！

いやー、これで無事解決です。よかったー！

--------------------------

……解決なわけ無いですね。引数有りのメソッドに対応出来ないし、そもそも根本解決してない。

と言うことで解決してません。解決するにはフレームオブジェクトを色々操作して頑張るしかないの？やだなー。

.. note::

  9/14 12:20 追記: コメントの方で「もう一段,関数でwrapすればよい」という指摘のもと、
  解決することが出来ました。結局の所、以下の挙動を理解していればこの問題にはまることも
  無かったと思います。

  .. code-block:: Python

      >>> funcs = {}
      >>> for name in ('foo', 'bar', 'baz'):
      ...     funcs[name] = lambda: name
      ...
      >>> for n,f in funcs.items():
      ...     print n, f()
      ...
      baz baz
      foo baz
      bar baz


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2010-09-14.0326482676
:title: Re:Pythonの動的クラス生成と特殊メソッドとフレームの謎
:author: atsuoishimoto
:date: 2010-09-14 01:23:54
:email: 
:url: 
:body:
attrs[name] = lambda self: d[name]

 は、

attrs[name] = lambda self, name=name: d[name]

としないと駄目なんじゃないかと思います

:comments:
:comment id: 2010-09-14.5779225607
:title: name=name
:author: しみずかわ
:date: 2010-09-14 01:32:58
:email: 
:url: 
:body:
や、そこは __name で大丈夫でした。


:comments:
:comment id: 2010-09-14.6206704434
:title: Re:Pythonの動的クラス生成と特殊メソッドとフレームの謎
:author: atsuoishimoto
:date: 2010-09-14 01:33:40
:email: 
:url: 
:body:
すいません、最後まで読んでませんでした。

この形でご要望通りにする方法は思いつかないですねぇ。eval()使ってlambda式を動的コンパイルするぐらいでしょうか。

:comments:
:comment id: 2010-09-14.9909940206
:title: Re:Pythonの動的クラス生成と特殊メソッドとフレームの謎
:author: atsuoishimoto
:date: 2010-09-14 01:39:51
:email: 
:url: 
:body:
あ、関数をもう一枚かませば良いのか

def gen():
    attrs = {}
    def gen_lambda(name):
        return lambda self: d[name]
        
    for name in ('__len__', '__str__'):
        attrs[name] = gen_lambda(name)
    return type('Gen', (object,), attrs)

でどうでしょ？

:comments:
:comment id: 2010-09-14.2712014002
:title: eval!?
:author: しみずかわ
:date: 2010-09-14 01:44:31
:email: 
:url: 
:body:
classの__dict__にはちゃんと入っていてg.__len__()やg.__str__()では正しく動作するのに、len(g)やstr(g)ではうまくいかない、というのが納得できないんです。len()を使った場合、フレーム処理まわりで g.__len__() したときとは何か違うんだとは想像してるんですが…。classobject.cやtypeobject.cを読んでるんですが、まだ追い切れていません＞＜

:comments:
:comment id: 2010-09-14.6980440469
:title: Re: 関数をもう一枚
:author: taka
:date: 2010-09-14 01:51:38
:email: 
:url: 
:body:
関数をもう一枚挟んだらいけました！

とりあえずやりたいことはできるようになりましたが、しかし、、フレームが保存されるとなぜ問題が出てしまったのか、これはこれで理解しておきたいですね（バグなのか仕様なのかも含めて）。追々調べてみます。

:comments:
:comment id: 2010-09-14.8462931789
:title: Re:Pythonの動的クラス生成と特殊メソッドとフレームの謎
:author: atsuoishimoto
:date: 2010-09-14 01:54:06
:email: 
:url: 
:body:
私の環境だと、 g.__len__()で 'va-'が返ってきますんで、何かの間違いじゃないかなぁと思うんですが。私の知る限りでは呼び出し方法が違うと言うことはありません。

:comments:
:comment id: 2010-09-14.7383183210
:title: Re: g.__len__()で 'va-'が返ってきます
:author: しみずかわ
:date: 2010-09-14 12:25:38
:email: 
:url: 
:body:
> 私の環境だと、g.__len__()で 'va-'が返ってきますんで、

うあー、確かに！このblogエントリを書こうと思ったきっかけの方のコードに別の要因が入ってました。切り分け不足でした＞＜

はずかしいエントリ書いちゃったなぁ… けど理解が深まったので良しとします。ありがとうございました。

:comments:
:comment id: 2010-09-21.3341715479
:title: Re:Pythonの動的クラス生成と特殊メソッドとフレームの謎
:author: Anonymous User
:date: 2010-09-21 09:52:43
:email: 
:url: 
:body:
クロージャの話ですよね？

:comments:
:comment id: 2010-09-21.5669440367
:title: Re:クロージャの話ですよね？
:author: しみずかわ
:date: 2010-09-21 09:56:07
:email: 
:url: 
:body:
クロージャの話です。クロージャの話だと言うことをatsuoishimotoさんに指摘されて理解しました＞＜

%%%%%%%%%

:id: 735
:date: 2010-09-20 17:00:00
:title: エキスパートPythonプログラミング読書会02のまとめ
:categories: ['Event', 'python', 'Programming', 'epp']
:body type: text/x-rst
:body:
先日9月7日に、 `エキスパートPythonプログラミング読書会02`_ を開催しました。まとめ遅くて申し訳ないです...。

.. _`エキスパートPythonプログラミング読書会02`: http://atnd.org/events/6954

発表資料などは @t2y の `エキスパートPythonプログラミング読書会02に参加しました - forest book`_ に載っているので、そちらをどうぞ。


当日の様子
-------------

当日は二十数名の方々の参加がありました。平日イベントだけあって、キャンセル数もけっこうありましたが、当日になって参加枠に入っても行けない、というか本持ってきてない＞＜という人が多かったみたいですね。こればっかりはどうしようもないので、気にしないことにします。

実際の所、20名を超えると発言しづらい環境になってしまうでしょうし、ワークショップ形式じゃないので発言を促すのも難しいし、悩ましいところです。

今回は、@t2y が司会をして、自分がTwitter発言を見ながらフォローを入れるようにしたので、まあまあ良い感じにまとまったんじゃないかと思います。



当日のTwitter発言まとめ
-----------------------------
* http://togetter.com/li/50261


当日の質問のまとめ
---------------------

* 質問: イテレータは全部ジェネレータに置き換えた方が良いんですか？
    * A: 基本的にはそう考えて問題ありません。
    * 状況に応じて使い分ける必要がありますが、ジェネレータで書けないか検討するべきです。

* 質問: ということは、[]と()の内包表記では()の方がジェネレータですが、これはあんまり使う機会はないんでしょうか？
    * A: list内包表記の置き換えとして使うと思います
    * 関数引数にジェネレータ表記をする場合、()を1段省略して使うことはまあまああります。

* 質問: 内包表記で変数束縛するとstackはどこまで引っ張って行っちゃうんでしょう？
    * スタックごと束縛されてメモリなども保持されてしまうと思う by shimizukawa
    * A: `スタックってか、フレームオブジェクトが保存される`_ by @atsuoishimoto

.. _`スタックってか、フレームオブジェクトが保存される`: http://twitter.com/atsuoishimoto/status/23230187180

関連ページ
------------------

* `エキスパートPythonプログラミング読書会02に参加しました - forest book`_
* `リスト内包表記とジェネレータの比較 - yanolabの日記`_

.. _`エキスパートPythonプログラミング読書会02に参加しました - forest book`: http://d.hatena.ne.jp/t2y-1979/20100908/1283948456
.. _`リスト内包表記とジェネレータの比較 - yanolabの日記`: http://d.hatena.ne.jp/yanolab/20100909/1284007840


次回、読書会03回と、02回（再）
---------------------------------

* 次回03回: 10月5日(火) 19:30～ `エキスパートPythonプログラミング読書会03: ATND`_ でお申し込みお願いします！

.. _`エキスパートPythonプログラミング読書会03: ATND`: http://atnd.org/events/8168

* 今回02回に参加出来なかった人が多かったため、「02回（再）」を実施します。日時は 9月29日(水) 19:30～, 場所は同じくアスキーメディアワークスさんです。 `エキスパートPythonプログラミング読書会02（再）: ATND`_ でお申し込みお願いします！

.. _`エキスパートPythonプログラミング読書会02（再）: ATND`: http://atnd.org/events/8167


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 736
:date: 2010-09-20 17:00:00
:title: Pythonのコーディング規約pep8チェックをUnitTestに組み込んでみた
:categories: ['python', 'testing', 'epp']
:body type: text/x-rst
:body:
Pythonには PEP_ という仕組みがあり、そのなかの `PEP-0008`_ がPythonのコードを書く上でのコーディング規約を定義しています。

.. _PEP: http://sphinx-users.jp/articles/pep1.html
.. _`PEP-0008`: http://oldriver.org/python/pep-0008j.html

で、このPEP8の規約通りに書けているかどうかをチェックするツールがいくつか PyPI_ で公開されているので、それをUnitTestに組み込んでみたら良いんじゃない？と言うわけでさっそく組み込んでみました。今回はテストに組み込むパッケージとして、 `エキスパートPythonプログラミング`_ でも軽く紹介されている pep8_ というパッケージを選んでみました。

.. _PyPI: http://pypi.python.org/pypi/
.. _pep8: http://pypi.python.org/pypi/pep8/
.. _`エキスパートPythonプログラミング`: http://astore.amazon.co.jp/freiaweb-22/detail/4048686291

以下のように test_pep8.py を作成しました。このテストはnoseで動作するように書いています。

.. code-block:: Python

    # -*- coding: utf-8 -*-

    import os
    import pep8

    CURRENT_DIR = os.path.dirname(os.path.abspath(__file__))
    BASE_DIR = os.path.dirname(CURRENT_DIR)


    def test_pep8():
        arglist = [
            '--statistics',
            '--filename=*.py',
            '--show-source',
            '--repeat',
            #'--show-pep8',
            #'-qq',
            #'-v',
            BASE_DIR,
        ]

        options, args = pep8.process_options(arglist)
        runner = pep8.input_file

        for path in args:
            if os.path.isdir(path):
                pep8.input_dir(path, runner=runner)
            elif not pep8.excluded(path):
                options.counters['files'] += 1
                runner(path)

        pep8.print_statistics()
        errors = pep8.get_count('E')
        warnings = pep8.get_count('W')
        message = 'pep8: %d errors / %d warnings' % (errors, warnings)
        print message
        assert errors + warnings == 0, message

これをテスト対象のファイル群があるディレクトリ下のtestsディレクトリに置いてテストを実行すると以下のように結果が出力されます。

::

    $ test
    F
    ======================================================================
    FAIL: test_pep8.test_pep8
    ----------------------------------------------------------------------
    Traceback (most recent call last):
    ...
    ...
    ...
    AssertionError: pep8 test detect 2 errors / 2 warnings
    -------------------- >> begin captured stdout << ---------------------
    ./somepkg/__init__.py:4:1: W391 blank line at end of file
    
    ^
    ./somepkg/somepkg.py:30:37: W602 deprecated form of raising exception
                    raise AttributeError, msg
                                        ^
    ./somepkg/parser.py:18:11: E401 multiple imports onone line
    import sys, os
              ^
    ./somepkg/parser.py:131:24: E211 whitespace before
    '('
            elif isinstance (x, Pair):
                           ^
    ./somepkg/parser.py:177:1: W391 blank line at end of file
    
    ^
    1       E211 whitespace before '('
    1       E401 multiple imports on one line
    1       W391 blank line at end of file
    1       W602 deprecated form of raising exception
    pep8: 2 errors / 2 warnings

    --------------------- >> end captured stdout << ----------------------

    ----------------------------------------------------------------------
    Ran 1 test in 0.512s

    FAILED (failures=1)

これで五月蠅いくらいにPEP8違反を教えてくれるようになります。 **「さいきん結合サーバーに接続したパトランプが回らなくて寂しいな－」という人にお勧め** です。

というか、某プロジェクトに組み込んでみたらかなりの規約違反が検出されてしまって案の定、表示されすぎたので（違反しているのが悪いんですけど）、もっと早くから組み込んでおけば良かったと反省中です…。Python標準のUnitTestに書き換えて使うのも簡単なので、今後の自分のコードにはかならず組み込むようにしようかな。

あわせて読みたい
---------------------

* `テスト自動化 - Python Developers Camp 2008冬 in 松本`_
* `エキスパートPythonプログラミング`_

.. _`テスト自動化 - Python Developers Camp 2008冬 in 松本`: http://www.slideshare.net/shimizukawa/python-autotest-pdc2008w


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 737
:date: 2010-09-22 16:41:03
:title: やっとPythonのクロージャの仕組みを少しは理解した件
:categories: ['python']
:body type: text/x-rst
:body:
先日、 `Pythonの動的クラス生成と特殊メソッドとフレームの謎`_ というBlog投稿をしたら複数の関係筋から「 `Pythonのクロージャはいわゆるレキシカルクロージャ`_ 」「 `これがPython的に正しい挙動`_ 」というツッコミをもらいました。 @atsuoishimoto さん @okuji さんありがとうございました。

.. _`Pythonの動的クラス生成と特殊メソッドとフレームの謎`: http://www.freia.jp/taka/blog/734
.. _`これがPython的に正しい挙動`: http://twitter.com/okuji/status/24442935510
.. _`Pythonのクロージャはいわゆるレキシカルクロージャ`: http://twitter.com/atsuoishimoto/status/24399596167

ということで、自分が何を分かってなかったのかのまとめです。

単純にlambdaを作った場合
------------------------

まず、以下のようにlambdaを使って関数を作るとします。

.. code-block:: Python

    >>> x = 1
    >>> f = lambda: x

この関数を呼び出したら以下のような結果になります。

.. code-block:: Python

    >>> f()
    1

ここまでは想定通りだと思いますが、以下の場合は想定通りでしょうか？

.. code-block:: Python

    >>> g = lambda: y
    >>> y = 1
    >>> g()
    1
    >>> y = 2
    >>> g()
    2

yを後から定義しても動作します。自分は、こういう動きをすることは知っていて、そのようなコードも書いていましたが、ちゃんとは理解できていませんでした＞＜


lambdaで関数を作ってdictに入れた場合
------------------------------------------

.. code-block:: Python

    >>> d = {}
    >>> d[1] = lambda: 1
    >>> d[2] = lambda: 2
    >>> d[3] = lambda: 3
    >>> d[1]()
    1
    >>> d[2]()
    2
    >>> d[3]()
    3

こういうことをしたいシーンは時々あります（dictのキーとlambdaの返す値が一緒かどうかはさておき）。で、こういうコードはfor文で回すコードにしたいと思いますよね。


for文でlambdaを作った場合
-----------------------------

.. code-block:: Python

    >>> d = {}
    >>> for i in (1, 2, 3):
    ...     d[i] = lambda: i
    ...

上記のようなコードを用意して、それぞれの関数を呼び出すと以下の結果になります。

.. code-block:: Python

    >>> d[1]()
    3
    >>> d[2]()
    3
    >>> d[3]()
    3

前述のgとyの例から、このような結果になることは想定できたはずですが、自分はこの動きは想定外でした。for文を使ったことと、dに代入するキーにもiを使ったこなど、あとは実際に書いていたコードがもうすこし複雑だったことなどが原因で、 **iの値が** lambda式の実行時に束縛されると思い込んでしまったんだと思います。

ちなみに、前の例でx=2とした時のように、i=2にすれば前述のコードと同様の結果になります。

.. code-block:: Python

    >>> i = 2
    >>> d[1]()
    2
    >>> d[2]()
    2
    >>> d[3]()
    2
    >>> i = d
    >>> d[1]()
    {1: <function <lambda> at 0x027C53F0>,
     2: <function <lambda> at 0x027EECF0>,
     3: <function <lambda> at 0x027EED70>}

ここで注意が必要なのは、あくまで名前とフレームオブジェクトを束縛しているのであって、値、または参照しているデータを束縛しているのではないという点。

解決版のコード
-------------------------

ここまでのことから、以下のようにコードを書き換えれば、束縛されるフレームオブジェクトがlambda毎に異なるため、最初のサンプルコードと同じ結果を得ることができます。

.. code-block:: Python

    >>> d = {}
    >>> for i in (1, 2, 3):
    ...     def wrap(x):
    ...         return lambda: x
    ...     d[i] = wrap(i)
    ...
    >>> d[1]()
    1
    >>> d[2]()
    2
    >>> d[3]()
    3

wrapという関数を呼び出すことで、lambdaが束縛する名前=x, フレームオブジェクト=wrap関数のフレーム, という組み合わせになります。lambda生成毎に関数を呼び出して個別のフレームを生成しているところがミソですね。

次の確認に向けてコードを修正
---------------------------------

とりあえずlambdaをdef文に置き換えます。

.. code-block:: Python

    >>> d = {}
    >>> for i in (1, 2, 3):
    ...     def wrap(x):
    ...         def f():
    ...             return x
    ...         return f
    ...     d[i] = wrap(i)
    ...
    >>> d[1]()
    1

さらにこれらの処理を再利用できるように、関数の中で行うようにします。


.. code-block:: Python

    >>> def gen():
    ...     d = {}
    ...     for i in (1, 2, 3):
    ...         def wrap(x):
    ...             def f():
    ...                 return x
    ...             return f
    ...         d[i] = wrap(i)
    ...     return d
    ...
    >>> d = gen()
    >>> d[1]()
    1

これで下準備完了。


f()呼び出し時のローカル変数を確認
-----------------------------------

前述のコードに以下のようにprint文を埋め込んで、f()関数内で使用できるローカル変数の一覧を確認します。

.. code-block:: Python

    >>> def gen():
    ...     d = {}
    ...     for i in (1, 2, 3):
    ...         def wrap(x):
    ...             def f():
    ...                 print '%%%', locals()
    ...                 return x
    ...             return f
    ...         d[i] = wrap(i)
    ...     return d
    ...
    >>> g = gen()
    >>> g[1]()
    %%% {'x': 1}
    1

このように、f()の中で利用できるローカル変数はxだけす。iやdは束縛されていないためか、ローカル変数にはありません。globals() で確認すればモジュール内のグローバル変数も確認できますが、i,dは含まれていないでしょう。

ここでf()の関数定義内でiやdを参照すれば、束縛されてf()内のローカル変数として参照できます。

.. code-block:: Python

    >>> def gen():
    ...     d = {}
    ...     for i in (1, 2, 3):
    ...         def wrap(x):
    ...             def f():
    ...                 i
    ...                 print '%%%', locals()
    ...                 return x
    ...             return f
    ...         d[i] = wrap(i)
    ...     return d
    ...
    >>> g = gen()
    >>> g[1]()
    %%% {'i': 3, 'x': 1}
    1


あとは、フレームオブジェクトはどこまで保存されるのかとか、コールスタックの途中のフレームオブジェクトは解放されるのかとか、もうちょっと調べたいことはありますが、それはまたいつか自分か、あるいは誰かが書いてくれるんじゃないかと期待。


.. スタックトレースの確認
.. ---------------------------
.. 
.. 以下のコードをファイルに保存して実行すれば、gen()関数がコールスタックに含まれていない事がわかります。つまり束縛されているのは変数束縛されているフレームだけだと言うことになります。
.. 
.. .. warning::
.. 
..   （ここは確認が足りない。本当にgen()のフレームが束縛されていないかどうかをどうやって調べる？）
.. 
.. .. code-block:: Python
.. 
..     import sys
..     
..     def stack_list(frame):
..         l = []
..         while frame:
..             l.append(frame)
..             frame = frame.f_back
..         return l
..     
..     def show_stacktrace(stacks):
..         for s in reversed(stacks):
..             print "%s(%d)%s()" % \
..                     (s.f_code.co_filename, s.f_lineno, s.f_code.co_name)
..     
..     def gen():
..         d = {}
..         for i in (1, 2, 3):
..             def wrap(x):
..                 def f():
..                     show_stacktrace(stack_list(sys._getframe()))
..                     return x
..                 return f
..             d[i] = wrap(i)
..         return d
..     
..     d = gen()
..     print d[1]()
..     


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 738
:date: 2010-09-30 19:33:50
:title: オープンソースカンファレンス2010秋 東京 に参加しました
:categories: ['Event', 'Zope', 'python', 'Plone', 'sphinx', 'translation']
:body type: text/x-rst
:body:
遅くなりましたが9/10,11の参加レポートです。9月10,11にオープンソースカンファレンス2010秋に参加してきました。今回は Plone, Zope, Sphinx の3つのブースを掛け持ちで店番していましたが、もっぱらSphinxの説明をしていた気がします。

以下、参加メモ。

* Zope単体の質問は聞かれなくなった
* Ploneとからめてデザイン適用の説明(Deliverance, XDV)を何回かした
* Sphinxの説明をしてチラシを配った -> Sphinx-users.jpに詳細レポート
* 1日目の懇親会は無料であった
* 2日目の懇親会は調布の自宅から数分の場所でやってたけど出席しませんでした。
* 会場は多摩動物公園近くの大学、モノレールで行きました
* @MiChiRuの人とOmegaTの人と昼ご飯
* OmegaTの説明を聞いて「これはすごい！」と思った
* OmegaTのコミュニティーに翻訳してくれる人が少ない？だっけ？
* OmegaTの日本語でのサポートをしてくれている人はフランス人（Tarekと同郷）だけど香川在住15年目
* となりの音声ナビ（障害者むけツールのやつ）がけっこう来訪者が多かったみたい


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 739
:date: 2010-09-30 19:40:00
:title: BPStudy#37 に参加しました 夜のDjango + LT
:categories: ['Event', 'python']
:body type: text/x-rst
:body:
`BPStudy#37`_ に参加してきました。
いつも通り走り書きメモです。

.. _`BPStudy#37`: http://atnd.org/events/8025

今回のネタは"夜のDjango"と"LT"。LTは初の試み？前回の `beproud-bot君`
の紹介もLTっぽかったよね。そこからの発展かな？

第一部「やっぱりDjango ja night」
------------------------------------------------------

* 発表
    * `@feiz`_, http://d.hatena.ne.jp/feiz/
    * `@tokibito`_, http://d.hatena.ne.jp/nullpobug/
    * `@IanMLewis`_, http://www.ianlewis.org/jp/
    * `@torufurukawa`_, http://oldriver.org/
    * `@shin_no_suke`_, http://www.facebook.com/profile.php?id=651258640

.. _`@feiz`: http://twitter.com/feiz
.. _`@tokibito`: http://twitter.com/tokibito
.. _`@IanMLewis`: http://twitter.com/IanMLewis
.. _`@torufurukawa`: http://twitter.com/torufurukawa
.. _`@shin_no_suke`: http://twitter.com/shin_no_suke


Djangoとは (`@feiz`_)
~~~~~~~~~~~~~~~~~~~~~~~
* 開発サーバーが入ってるのでApache無くても起動出来る
* モデルは継承できる. personモデルがbuchoモデルを継承とか
* ViewはPythonの関数だったりClassだったりするのが問題かも
* 汎用Viewがある
* URLディスパッチ (Controllerに相当?)
    * 設定次第でURLの逆引きが出来る（名前からURL生成）
* Template(HTMLと変数埋め込み)で使うタグやフィルタはカスタム可能
    * Templateの継承もあるよ, 普通のincludeには戻れん
* Admin: モデルに2,3行定義を書くときれいな管理画面が自動生成される
* なぜDjangoなのか
    * スピード
        * Admin の存在が大きい
        * 充実したライブラリ群
    * 安定性
        * バグがあんまり無い(full-stackの利点)
        * 後方互換がしっかりしてる
    * etc.
        * Python製
        * コミュニティーの愛を感じる

Django1.2の新機能 (`@feiz`_)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* マルチDB対応
    * DB設定の複数定義、切り替え
    * Routerを定義すると読み書きするDBを適切に切り替え出来る、らしい
* Templateのifブロックの書き方が変わった
    * ifnotequals -> if xx != yy
* Object-level Permission

Django1.3で予定されている新機能 (`@feiz`_)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* #14130 Catching ImportError in manage.py considered dangerous
    * manage.py でアプリロード中にraiseするとアプリロードが自動キャンセルされる
    * 握りつぶされると何が起きてるか分からない！
    * やっと直ります
* #12982 Pony:cache.get_or_set()
    * django.core.cache.cache にget or set

feizへの質問
~~~~~~~~~~~~~~
* DRYって何ですか？
    * Don't Repeat Yourself です


実開発に使えるDjangoの機能 (`@tokibito`_)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
資料: http://tokibito.orz.hm/presentation/9/ (上下左右キーで操作)

* tokibito でぐぐれ
* Djangoフォーム
    * （実際のform自動生成のためのコードを紹介）
    * selectプルダウンとか入力ボックスとか
    * バリデーションの指定と自動チェックとか
    * gettextで自動的に日本語表示, カスタマイズも可能
    * Widgetの例。チェックボックスとか,デフォルト表示とか
    * Templateでフォームを使う例
    * clean_xxx でフィールドの入力をバリデーションする
        * 検証の最後に呼ばれる
        * Form全体のクリーニング
        * 複数の入力項目からしか検証できないコードを書く
    * validator
        * Django1.2から関数で値をチェックできるようになった
    * ModelからFormを生成する
    * 細かいカスタマイズはDjangoのコード読んで、やる

* django.utils
    * Django内部で使われてるモジュール
    * SortedDict
        * 2.6ならOrderedDictを使うのが良いんじゃない
    * force_unicode
    * format
    * timesince
    * functional
        * wraps, lazy, memoize, ...
    * safe_join
        * 親より上のパスへのアクセスはエラーにするとか
    * ほかにもいっぱいあります


Djangoアプリの実践的設計手法 (`@IanMLewis`_)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* アプリの構成を覚えよう
    * そもそもDjangoアプリは何？
        * models.pyのあるPythonモジュール。
        * Pony
            * 子供が「子馬が欲しい！」と言うけどなかなか子馬はあげられない
            * 欲しいもの、プレゼントの理想の形
            * MLで、こんな機能が欲しい！ということが実現される
    * （色々アプリの構成の説明）

* アプリを細かく分けよう
    * Reusable Apps (巨大なCoreを細かいAppsに分けた)
        * 会員と会員登録と会員プロフィールと...を別アプリで実装
        * 今は標準アプリが20個以上に分割されている
        * INSTALLED_APPS が長くなぎすぎるんじゃないか！？
            * どうでもいい！
        * まじで James Bennettさんの発表をみてください！

* アプリはAPIを作ろう
    * モデルのクエリを直接使わない。チームにAPIを提供する(api.pyを作る)
    * クラス、関数、モデルメソッド、デコレータ、ミドルウェア、シグナル

Djangoによる開発のテスト (`@torufurukawa`_)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
資料: http://www.slideshare.net/torufurukawa/django-5323190

なんらかの理由でテストコードが必要。

* manage.py test
    * from django.test import TestCase
    * （テストの実装についてコード紹介）
    * database作成とか自動でやってくれる

* Fixtures
    * testdata.json
    * DBからjsonにdumpできる `python manage.py dumpdata`

* Client
    * Viewレベルのテストを支援するClient

buchoへの質問
~~~~~~~~~~~~~~~
* DjangoのClientテストはページ遷移も出来る？
    * できます by bucho

* Djangoでnoseやpy.testなどの最近のテストツールも使えますか？
    * 使えるはずですが...
    * DjangoのFixturesも使える？ -> どうだろう
    * Django的にはフレームワーク内に収まるように使うのが基本


Djangoの嵌りどころ、使用の注意点（アンチパターン） `@shin_no_suke`_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
資料: http://www.slideshare.net/bpstudy/bpstudy-37-djagno-tips

* app
    * 再利用（笑）
        * 日実用的な再利用性
    * appの分け方
        1. 再利用できるか
        2. 機能ごと

* settings
    * settings.py
    * settings_dev.py
    * settings_production.py
    * settings_bucho.py

* 論理削除・(非)公開データの扱い
    * 表示用と管理用のモデル定義を分ける(論理削除データの扱いのため)

* O/R Mapper
    * （聞き逃した）

* cron + djangoadmin.py
    * 便利

* middlewareでの例外注意
    * メールでのエラー通知が飛ばない

* BP社で利用しているオープンなApps
    * mysql_replicated
        * 参照先DB切り替え
        * 海外の人が作ったヤツをforkして改造してます
    * django_extensions
    * django-bpmobile

* 複数のDjangoサイトの運用の例
    * monjudoh.com, monjudoh.jp という2サイトある場合
    * settings.py を分けてそれぞれ定義する,Viewも分ける

* Django admin画面の活用
    * ちょっとカスタマイズして使ってます
    * 非常に便利。これだけでもDjangoの意味がある

しみずかわメモ
~~~~~~~~~~~~~~~~~~
* newforms, oldforms っていう名前は微妙じゃないか？
* 疑問, Django template のifnotequalsの変更はJinja2から取り込んだ？
* `@tokibito`_ のプレゼンがs6だ！
* Djangoフォームのコード例はschemaベースの自動フォーム生成を知らないとピンと来ないかも
* Djangoはいつかzope3に到達する気がする。語弊あるけど。
* DjangoのFixturesはjsonで用意する
    * Railsはyaml、Djangoはjson。趣味嗜好としては逆だよなぁ
* DjangoとRailsの用語比較
    * `manage.py test` <-> `rake test`
    * `Fixtures` <-> `Fixtures`
    * `Client` <-> `integration test`


第二部「LT大会」
------------------------------------------------------

LTのメモは省略しまーす

@yuroyoro「MIrah」
~~~~~~~~~~~~~~~~~~~~
jvm上で動くRubyっぽい性的過多漬け言語 Mirahを紹介

@akisutesama「Objective-CはLLです（キリッ」
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
@akisutesama はLLを使えないのでObjective-CをLLだと言い切るLTでした


第三部「懇親会」
-----------------
「やっぱりDjango ja naiyo」 by @aodag の予定。



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 740
:date: 2010-10-17 19:39:30
:title: 別解: lxmlを使ってXMLの要素をソートして返す
:categories: ['python']
:body type: text/x-rst
:body:
はじめに
---------

こんにちは、NERDです。先日、 `lxmlを使ってXMLの要素をソートして返す - YAMAGUCHI::weblog`_ というエントリが上がっていたので、XMLの変換と言えばxsltでしょう！とか思ったので実際にやってみました。xsltの適用は元記事の方でも使っているlxmlで簡単にできるのが良いですね。

.. _`lxmlを使ってXMLの要素をソートして返す - YAMAGUCHI::weblog`: http://d.hatena.ne.jp/ymotongpoo/20101008/1286499332

参考
-----
* `lxml.etree._Element`_
* `たのしいXML: XSLT基礎編: xsl:sort`_

.. _`lxml.etree._Element`: http://codespeak.net/lxml/api/lxml.etree._Element-class.html
.. _`たのしいXML: XSLT基礎編: xsl:sort`: http://www6.airnet.ne.jp/manyo/xml/


サンプルコード
---------------

.. code-block:: Python

    # -*- coding: utf-8 -*-
    from lxml import etree
    
    xml = """
    <statuses>
      <status>
        <id>5</id>
        <text>spam</text>
      </status>
      <status>
        <id>1</id>
        <text>egg</text>
      </status>
      <status>
        <id>100</id>
        <text>ham</text>
      </status>
      <status>
        <id>2</id>
        <text>bacon</text>
      </status>
    </statuses>
    """
    
    xslt = """
    <xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
      <xsl:template match="/statuses">
        <xsl:copy>
          <xsl:for-each select="status">
            <xsl:sort select="id" data-type="number" />
            <xsl:copy-of select="." />
          </xsl:for-each>
        </xsl:copy>
      </xsl:template>
    </xsl:stylesheet>
    """
    
    def sort_by_id(xml):
        try:
            tree = etree.fromstring(xml)
            transform = etree.XSLT(etree.fromstring(xslt))
            transformed = transform(tree)
            return etree.tostring(transformed, pretty_print=True)
    
        except Exception, e:
            """
            rescure here.
            """
            raise e
    
    
    if __name__ == '__main__':
        print xml
        print '--------------------'
        print sort_by_id(xml)


xsltの記述、けっこう長くなってしまってますね。もうちょっと短く書ける気がするんですが…。あと出来るだけタグ名に依存しないように書ければいいなあ。

実行結果
---------

.. code-block:: XML

    <statuses>
      <status>
        <id>5</id>
        <text>spam</text>
      </status>
      <status>
        <id>1</id>
        <text>egg</text>
      </status>
      <status>
        <id>100</id>
        <text>ham</text>
      </status>
      <status>
        <id>2</id>
        <text>bacon</text>
      </status>
    </statuses>
    
    --------------------
    <statuses>
      <status>
        <id>1</id>
        <text>egg</text>
      </status>
      <status>
        <id>2</id>
        <text>bacon</text>
      </status>
      <status>
        <id>5</id>
        <text>spam</text>
      </status>
      <status>
        <id>100</id>
        <text>ham</text>
      </status>
    </statuses>


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2010-10-21.4151359945
:title: Re:別解: lxmlを使ってXMLの要素をソートして返す
:author: ymotongpoo
:date: 2010-10-21 18:13:36
:email: 
:url: http://d.hatena.ne.jp/ymotongpoo/20101008/1286499332
:body:
XSLTを使うのは逆に僕がやりたかったことなのでとても助かります！！ありがとうございます！！

:comments:
:comment id: 2010-10-21.0959510319
:title: Re:別解: lxmlを使ってXMLの要素をソートして返す
:author: しみずかわ
:date: 2010-10-21 21:31:08
:email: 
:url: 
:body:
statusesに属性が付いていてそれを維持する場合は、以下の記述が必要。 <xsl:copy> 直後に。

::

  <xsl:for-each select="@*">
    <xsl:copy />
  </xsl:for-each>

%%%%%%%%%

:id: 741
:date: 2010-10-29 20:10:00
:title: BPStudy#38 に参加しました エンジニアなら知っておきたい仮想化 
:categories: ['Event']
:body type: text/x-rst
:body:
`BPStudy#38`_ に参加してきました。
いつも通り走り書きメモです。

.. _`BPStudy#38`: http://atnd.org/events/8895

今回のネタは"エンジニアなら知っておきたい「仮想マシン」のしくみ"。

第一部「エンジニアなら知っておきたい「仮想マシン」のしくみ」
-------------------------------------------------------------

* 発表
    * 長谷川　猛: `@hasegaw`_,  http://d.ballade.jp/

* 資料
    * http://slidesha.re/9jD1ns
  
.. _`@hasegaw`: http://twitter.com/hasegaw

「別のところで使う予定の資料だったこともあり、Web系の人にはもしかしたら厳しい内容かもしれません」

発表からひろったポイント & 清水川メモ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* x86ハードウェアで走らせる仮想マシン
* KVMは割と古いOSをざっくりと切ってるので注意。Vistaとか2000とか。
* 1985年の80386でもメモリ仮想化の機能は搭載されていました（「はじめて読む486」に詳しく書かれていた記憶があるなー）
* クラウドっていうキーワードを無理矢理こじつけてみました
* でもクラウドってもっと大きい概念ですよね
* 最近はLinuxをインストールしたら最初っから専用のドライバが使えるようになってきてる
* HyperVも同じ方向に行くんじゃないかと思っている
* 仮想環境で時刻管理は非常に難しい, これは割り込み回数の問題
* 必要無ければCPUを起こさない: Dynamic Tick, PVタイマーの仕組みをゲストOSでサポート
* リング0-4（特権モード）の仕組みは80386 (1985年)から搭載されていました
* リングのおかげで仮想マシン実行用モードを追加してオンデマンドでプログラム書き換えできる
* Intel-VTやAMD-Vならばプログラム命令書き換えしなくても仮想化支援機能でできるので良い
* Intel-VT, AMD-V はリングプロテクションのリング0よりも上位の権限で動作できる
* 初期のVTは遅かったため、最初のころはVMWareなどでもVT機能は利用していなかった
* みなさん、OSのメモリー管理ってどうなっているかご存じですか（これは組み込み系やってる人はなじみ深いかも？）
* プログラム毎におなじアドレス空間が（見た目上）使われている。
* CR3レジスタを読めば、アプリケーション毎にどのアドレスを使っているか（？）を読み取ることが出来る。要特権モード
* Shadow Page Table の処理が全体の75%をしめている（VMのメモリアドレッシング仮想化が全体として非常に遅いのは今の変わってないのか。）
* Core i7のアドレッシング仮想化サポート技術（そこのところ、もう少し詳しく知りたい）
* VMWareは歴史が長いので、CPUID別に細かく仮想化の制御方法を切り替えていて、それぞれカリカリにチューンしてある。
* デバイスの仮想化について。I/Oポートの仮想化。
* QEMUには同種のデバイスエミュレータが複数実装されている
* 一番気になる仮想NIC
    * rtl8139(Realtek 8139)
    * e1000(Intel PRO/1000)
* 仮想NICも本物の物理NICとおなじ挙動をするように作られているので、実際に試してみたら蟹さんとIntelとで性能差も6倍くらいでちゃった。
* 仮想NICにrtl8139を使うと、CPU資源を使ってしまい、性能が熱に消えていく……
* virtioというのはIOの共通化の仕組み。
    * 1, virtio net
    * 2, virtio block
    * 3, virtio console
    * 5, virtio balloon
* virtioはホスト-ゲスト間のデータ交換のためにデバイス当たり必ず1つ以上のリングバッファを使用
* virtioのリングバッファindirectモードは最近使われている方式。構造体を1ポインタに複数ぶら下げられるので効率的に処理出来る
* virtioのリングバッファにぶら下げるのはデータそのもではなく命令。DMA転送命令などをぶら下げておくことでゼロコピーでオーバーヘッドを押さえられる。
* FreeBSD用 virtio を開発中。Virtioを理解するために開発中。

スライドの公開は… 出来るだけ公開しようと思います。（やった！）


第二部「LT大会」
-----------------
LTのメモは省略しまーす

@kazunori_279
~~~~~~~~~~~~~~~
#appengine +HTML5リアルタイムお絵かき

@toshiak_netmark
~~~~~~~~~~~~~~~~~
#hbstudy 的ななにか

@koemu
~~~~~~~
VMwareで手っ取り早く社内システムをHAサーバ化してみました

* 資料: http://www.slideshare.net/koemu/vmwareha


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 742
:date: 2010-11-24 23:55:00
:title: Pythonでデータ定義行のファイル名と行番号を手に入れる
:categories: ['Agile(XP)', 'python', 'testing']
:body type: text/x-rst
:body:
iPhone 3GS のマルチタスク切れませんか？とiOS4にしてからずっと思っている清水川です。ここのところなぜかメタなコードを作ることが多いんですが、今回、Pythonでデータ定義行のファイル名と行番号を手に入れたいと思ったのは以下のような理由からでした。

  データ定義に従ってテストするコードを書いて、テストが失敗したらそのデータ定義の行を表示したい。

たとえば以下のようなコード。

.. code-block:: Python

  class FooURLTest(unittest.TestCase):

      # LINE 10
      url_test = [
          ('/search',
           {'method': 'GET', 'query': 'q=python', 'status': 200}),
          ('/login',
           {'method': 'GET', 'query': '', 'status': 200}),
          ('/login',
           {'method': 'POST', 'query': 'login=user&passwd=user',
            'status': 302}),
          ...
          ...
          ...
      ]

      ...
      ...

      def test_url(self):
          for ut in url_test:
              url, data = ut
              res = urllib.urlopen(url...)
              self.assertEqual(data['status'], res.getcode()) # LINE 200


上記のコードはURLにアクセスしてHTTPのステータスコードをチェックするよう動作します。しかし、例えば ``/login`` へのアクセスでエラーになったときに、テスト結果に表示されるのは最後のassertEqualを実行している行で、おそらく以下のような感じで表示されます::

    ======================================================================
    FAIL: test_url (tests.FooURLTest)
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "tests.py", line 200, in test_url
        self.assertEqual(data['status'], res.getcode())
    AssertionError: 200 != 404

    ----------------------------------------------------------------------
    Ran 15 test in 6.131s

    FAILED (failures=1)
    

一応、test_url関数内の200行目のところで、エラーになった事は分かりますが、 ``url_test`` のどのデータ行でエラーになったかを知るには情報が足りません。url_testの各データに ``'name': '/login access with no param',`` といった感じに名前を利用者が付けておいて、assertEqualの引数に渡しておけば、とりあえず大丈夫ですが、名前付けるのが面倒だし行番号が表示された方が分かりやすいと思うわけです。（話の展開上、そう思ってくだせえ）

ところが、上記のコードのような場合に、あるデータがどの行で定義されたかを知るスマートな方法は、残念ながらPythonでは提供されていないようでした（あれば知りたい！）。そこで色々試行錯誤した結果、以下の方法で解決出来ました。


.. code-block:: Python

  def factory(url, data):
      frame = sys._getframe().f_back
      data['filename'] = frame.f_code.co_filename
      data['lineno'] = frame.f_lineno
      return (url, data)

  class FooURLTest(unittest.TestCase):

      # LINE 10
      url_test = [
          factory('/search',
           {'method': 'GET', 'query': 'q=python', 'status': 200}),
          factory('/login',
           {'method': 'GET', 'query': '', 'status': 200}),
          ...
          ...

新たにfactoryという関数を導入して、その中でコールスタックをチェックして呼出元のファイル名と行番号を取得してデータに書き足しています。返値の形式は変えていないので、ある意味デコレータのように透過的に動作しつつ、辞書データにファイル名と行番号を仕込むことが出来ました。

あとはassertEqualを以下のように書けば、エラーの原因となったデータのファイル名と行番号が分かります。

.. code-block:: Python

    data['actual'] = res.getcode()
    msg = "Expect=%(status)r but Actual=%(actual)r at %(filename)r line %(lineno)d" % data
    self.assertEqual(data['status'], data['actual'], msg)

テストに失敗するとこんな感じになるはず::

    ======================================================================
    FAIL: test_url (tests.FooURLTest)
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "tests.py", line 200, in test_url
        self.assertEqual(data['status'], data['actual'], msg)
    AssertionError: Expect=200 but Actual=404 at 'tests.py' line 15

    ----------------------------------------------------------------------
    Ran 15 test in 6.131s

    FAILED (failures=1)
    

これでURLテストパターンがたくさんあってテスト失敗したときにも、原因となるURLテスト定義がどれかすぐに分かるようになるので、エラーのたびにイライラすることが無くなりますね！ヒャッホウ！


:extend type: text/x-rst
:extend:


:trackbacks:
:trackback id: 2010-12-01.8663231772
:title: [Python]Pythonでデータ定義行のファイル名と行番号を手に入れる
:blog name: atsuoishimotoの日記
:url: http://d.hatena.ne.jp/atsuoishimoto/20101130/1291130861
:date: 2010-12-01 00:27:47
:body:
 ふと思いついたので書いておく。 Pythonでデータ定義行のファイル名と行番号を手に入れる - 清水川Web では、Pythonでデータの定義位置を記録する方法として、データ生成用の関数を作ってその中でデータの定義位置を記録する方式が提案されている。 このようにデータの定義

:trackbacks:
:trackback id: 2010-12-02.2326312907
:title: [python]pythonで__line__を使う
:blog name: yanolabの日記
:url: http://d.hatena.ne.jp/yanolab/20101202/1291261115
:date: 2010-12-02 12:40:34
:body:
 データの定義位置を取得したいみたいなことを清水川さんのページで見た。pythonにはC言語のマクロみたいに__line__がないので、frameオブジェクトからファイル行数取ってとかを関数でやるのが一般的みたい。また、atsuoishimotoの日記の記事では、簡易DSLみたいな感じで実装

%%%%%%%%%

:id: 743
:date: 2010-11-25 23:55:00
:title: Pythonでtracebackに出現するファイル名や行番号を書き換える
:categories: ['python', 'testing']
:body type: text/x-rst
:body:
メタ清水川です。ここのところなぜかメタなコードを作ることが多いんですが、昨日の `Pythonでデータ定義行のファイル名と行番号を手に入れる`_ に引き続き今回も「Pythonでtracebackに出現するファイル名や行番号を書き換え」てみたいと思います。前回に引き続き、やりたいと思ったのは以下のような理由からです。

.. _`Pythonでデータ定義行のファイル名と行番号を手に入れる`: http://www.freia.jp/taka/blog/742

  データ定義に従ってテストするコードを書いて、テストが失敗したらそのデータ定義の行を表示したい。


前回の `Pythonでデータ定義行のファイル名と行番号を手に入れる`_ のエントリで、わざと関数呼び出しを発生させてそのときのコールスタックというかframe情報を使ってデータの定義位置（ファイル名と行番号）を取得する事は出来ました。前回はこの情報を以下のように表示させました::

    AssertionError: Expect=200 but Actual=404 at 'tests.py' line 15

このように表示させるためには、self.assertEqual()などのTestCaseクラスのアサートメソッドには必ずあるmsg引数に、ファイル名や行番号を表示するよう仕込む必要があります。しかしこれは ``テストを書く度にわざわざ仕込んであげないといけない`` と言うめんどくさい手間が増えてしまうので、出来ればそんな仕込みは無しにしたいところです。

ということで、次は手に入れた定義位置の情報をtracebackに表示させたいわけです。

例えば以下のようなコード(cook.pyとします)があるとします。このプログラムはcook関数が受け取った文字列を使って何か処理をする関数_cookerを生成して返しています（が、line6で必ずエラーになります）。そのような関数オブジェクトをline13,14で2つ生成して、line17でどちらかをランダムに実行しています。

.. code-block:: Python

    # -*- coding: utf-8 -*-
    import random

    def cook(base):
        def _cooker(addon):
            dish = base + x              # line 6
            # some program put here...

        return _cooker


    cooks = [
        cook('spam'),                    # line 13
        cook('ham'),                     # line 14
    ]
    f = random.choice(cooks)
    f('egg')                             # line 17


cook.pyを実行したときにトレースバックに出てくる情報は以下のような内容になります::

    $ python cook.py
    Traceback (most recent call last):
      File "cook.py", line 17, in <module>
        f('egg')
      File "cook.py", line 6, in _cooker
        dish = base + x
    NameError: global name 'x' is not defined

この上記のトレースバックを見たときに分かるのは cook.py 6行目の_cooker関数内でエラーがあったことです。しかし、実際のプログラムでは（昨日のテストのコードのように）line13が問題だったのかline14が問題だったのかを知りたいのですが、このトレースバックからそれは分かりません。実際、メタクラス使ってたりフレームワークとか作ったり使ってたりすると、時々こういうシーンに遭遇します。

そこで、_cookerの関数名がtracebackに表示されるときに `spam` とか `ham` とか表示させる方法はないか、ということで色々調べてみると、関数オブジェクトの属性を書き換えれば良さそうだと言うことが分かります。例えば::

    _cooker.func_name = 'bacon' # Python 2.x
    _cooker.__name__ = 'bacon' # Python 3.x (2.6以降)

上記のようにして関数名を書き換える訳です。しかし手元の環境ではこれではtracebackの表示は変わりませんでした。そこでもう少し調べると以下のように書き換えれば良さそうな事が分かりました::

    _cooker.func_code.co_name = 'bacon'

しかしこの書き換えは出来ません。func_code.co_nameは読み取り専用属性なので書き換えられません。このあたりの読み取り専用属性かどうかといった情報は `Python言語リファレンスのデータモデルの節`_ (`日本語訳`_)に ``読み出し専用の特殊属性: co_name は関数名を表します`` というふうに書かれています。

.. _`Python言語リファレンスのデータモデルの節`: http://docs.python.org/reference/datamodel.html#index-871
.. _`日本語訳`: http://www.python.jp/doc/2.4/ref/types.html

仕方がないので、関数オブジェクト(_cooker)とそのバイトコードが格納されているコードオブジェクト(_cooker.func_code)まるごと作り直してしまいましょう。ということで以下のように、frameから行番号を取得して、コードオブジェクトを作り直して関数名に行番号とbase名を仕込んでみました。

.. code-block:: Python

    # -*- coding: utf-8 -*-
    import sys
    import random
    import types

    def chsig(func, **replaces):
        code_arg_names = (
            'co_argcount', 'co_nlocals', 'co_stacksize', 'co_flags', 'co_code',
            'co_consts', 'co_names', 'co_varnames', 'co_filename', 'co_name',
            'co_firstlineno', 'co_lnotab', 'co_freevars', 'co_cellvars',
        )
        old_code = func.func_code
        code_args = [replaces.get(n, getattr(old_code, n)) for n in code_arg_names]
        new_code = types.CodeType(*code_args)

        func.func_code = new_code
        return func

    def cook(base):
        f = sys._getframe().f_back
        lineno = f.f_lineno
        def _cooker(addon):
            dish = base + x  # line 23
            # some program put here...

        name = "%s generated by '%s(%d)'" % (_cooker.func_name, base,lineno,)
        chsig(_cooker, co_name=name)
        return _cooker


    cooks = [
        cook('spam'),        # line 32
        cook('ham'),         # line 33
    ]
    f = random.choice(cooks)
    f('egg')                 # line 36

本当はファイル名もやりたいところですが、説明を分かりやすくするために今回は省略。実行した結果は以下のようになりました::

    $ python cook2.py
    Traceback (most recent call last):
      File "cook2.py", line 36, in <module>
        f('egg')
      File "cook2.py", line 23, in _cooker generated by 'ham(33)'
        dish = base + x
    NameError: global name 'x' is not defined

``_cooker generated by 'ham(33)'`` が表示されるようになったおかげで、エラーが発生したときにも非常に分かりやすくなりました。これでエラーがどこで起きてるか分からないんじゃ！などというつまらないことに引っかからずにデバッグできるようになりましたね！ヒャッホウ！


:extend type: text/x-rst
:extend:


:trackbacks:
:trackback id: 2010-12-02.2417151585
:title: [python]pythonで__line__を使う
:blog name: yanolabの日記
:url: http://d.hatena.ne.jp/yanolab/20101202/1291261115
:date: 2010-12-02 12:40:41
:body:
 データの定義位置を取得したいみたいなことを清水川さんのページで見た。pythonにはC言語のマクロみたいに__line__がないので、frameオブジェクトからファイル行数取ってとかを関数でやるのが一般的みたい。また、atsuoishimotoの日記の記事では、簡易DSLみたいな感じで実装

%%%%%%%%%

:id: 744
:date: 2010-12-06 23:55:00
:title: Python標準ライブラリだけでWebフレームワークっぽくしてみる - Python Web フレームワーク アドベントカレンダー2010
:categories: ['python', 'web']
:body type: text/x-rst
:body:
`@tokibito`_ から `Python Web フレームワーク アドベントカレンダー2010`_ のバトンを受け取った @shimizukawa です。 `@tokibito`_ には最近仕事中にいつもお世話になっています。Django爆発しろ！現在12/6の22時。あと2時間で持ち時間終わっちゃうじゃん！

まえおき
--------

とりあえずフレームワークとか忘れましょう。Pythonは標準でも色々できます。で、色々やってみて不便だと思ってから自分の目的に向いているフレームワークを探してみると良いんじゃないかな。

と言うことで環境は以下の条件で進めてみたいと思います。

:Python: 2.7.0
:OS: Windows 7 (どこでも大丈夫なはず)

MVC
-----

MVCというのはモデルとビューとコントローラのことらしいです。とりあえず、以下のように読み替えてMVCってことにします。

:Model: データストア
:View: 画面表示
:Controller: 上記２つを繋ぐ部分

とりあえずWebサーバー起動させる
---------------------------------

確認しながら動かした方が分かりやすいので、とりあえずWebサーバーを起動させます。
Webは最近はWSGIで書くと良いらしいので、 `wsgiref - WSGI ユーティリティとリファレンス実装`_
を参考にして（return部分以外コピ...再利用して） server.py というファイル名で保存しました。

.. _`wsgiref - WSGI ユーティリティとリファレンス実装`: http://www.python.jp/doc/nightly/library/wsgiref.html

.. code-block:: Python

    # -*- coding: utf-8 -*-
    from wsgiref.util import setup_testing_defaults
    from wsgiref.simple_server import make_server

    def simple_app(environ, start_response):
        setup_testing_defaults(environ)

        status = '200 OK'
        headers = [('Content-type', 'text/plain')]

        start_response(status, headers)

        return 'Haruo World!'

    httpd = make_server('', 8000, simple_app)
    print "Serving on port 8000..."
    httpd.serve_forever()

これをserver.pyとして保存してあとは以下のコマンドで起動します::

    $ python server.py

ブラウザで ``http://localhost:8080/`` にアクセスして ``Haruo World!`` と表示されればとりあえずサーバー起動部分は完成です。

表示作る
---------

表示は既に出来てますね。はい終了ー。現在22時15分。そろそろ家に帰ります。

…

帰り着きました。23時10分です。

さすがに今のままではアレなのでせめてHTMLを表示できるようにしたいと思います。
と言っても、server.pyのコードを見ると分かるように、文字列を返している部分をHTMLにすればHTML表示出来そうです。さっそくserver.pyを以下のように書き換えてみました。
書き換えるのは `simple_app` 関数のreturnの行だけですが、一応全文掲載しておきます。水増しじゃないです。


.. code-block:: Python

    # -*- coding: utf-8 -*-
    from wsgiref.util import setup_testing_defaults
    from wsgiref.simple_server import make_server

    def simple_app(environ, start_response):
        setup_testing_defaults(environ)

        status = '200 OK'
        headers = [('Content-type', 'text/plain')]

        start_response(status, headers)

        return '''<html><body><strong>Haruo</strong> <em>World!</em></body></html>'''

    httpd = make_server('', 8000, simple_app)
    print "Serving on port 8000..."
    httpd.serve_forever()

そうそう、さっき `python server.py` で起動したやつは1度Ctrl+Cで止めて再起動してください。実行したままだと書き換えたプログラムは反映されないので。

再起動してブラウザをリロードしたらHTMLがちゃんと表示されましたね！

.. image:: images/sample2.png

え、htmlタグとかそのまま表示されちゃダメ？じゃあ'text/plain'という部分を'text/html'に修正しましょう。

.. code-block:: Python

    # -*- coding: utf-8 -*-
    from wsgiref.util import setup_testing_defaults
    from wsgiref.simple_server import make_server

    def simple_app(environ, start_response):
        setup_testing_defaults(environ)

        status = '200 OK'
        headers = [('Content-type', 'text/html')]

        start_response(status, headers)

        return '''<html><body><strong>Haruo</strong> <em>World!</em></body></html>'''

    httpd = make_server('', 8000, simple_app)
    print "Serving on port 8000..."
    httpd.serve_forever()

.. image:: images/sample2b.png

これでHTMLを表示出来るようになりましたね！

……

え、まだだめ？プログラムで指定した値を埋め込みたい？じゃあPythonの ``string.Template`` モジュールを使ってやってみましょう。


.. code-block:: Python

    # -*- coding: utf-8 -*-
    from wsgiref.util import setup_testing_defaults
    from wsgiref.simple_server import make_server
    from string import Template
    import random

    def simple_app(environ, start_response):
        setup_testing_defaults(environ)

        status = '200 OK'
        headers = [('Content-type', 'text/html')]

        start_response(status, headers)

        template = Template(
            '''<html><body><strong>$name</strong> <em>$em</em></body></html>''')

        d = {
            'name': random.choice(['Haruo', 'bucho', 'tokibito']),
            'em': random.choice(['World!', 'Universe!', 'Heaven!']),
        }

        return template.substitute(d)

    httpd = make_server('', 8000, simple_app)
    print "Serving on port 8000..."
    httpd.serve_forever()


string.Template を使うと変数部分を ``$name`` という感じで埋め込んで置いて、後から辞書で ``substitute`` 関数に渡すことで文字列を整形してくれます。ついでに変数を使うんだから表示の度に画面が変わる方がいいよね、ということで、 ``random.choice`` を使ってブラウザをリロードするたびに表示が変わるようにしてみました。

.. image:: images/sample2c.png

これで表示はもういいですかね？ ……え、まだ？HTMLは別のファイルにしたい？そろそろ何かフレームワーク使った方が良いんじゃ…、じゃあ以下のようにHTMLファイルをindex.htmlという名前でserver.pyと同じディレクトリに保存してください。

.. code-block:: XML

    <html>
        <body>
            <strong>$name</strong> <em>$em</em>
        </body>
    </html>

そしてこのindex.htmlファイルを読み込んで表示するようにしましょう。

.. code-block:: Python

    # -*- coding: utf-8 -*-
    from wsgiref.util import setup_testing_defaults
    from wsgiref.simple_server import make_server
    from string import Template
    import random
    import os

    BASEDIR = os.path.dirname(os.path.abspath(__file__))
    def get_template(filename):
        path = os.path.join(BASEDIR, filename)
        return Template(open(path, 'r').read())

    def simple_app(environ, start_response):
        setup_testing_defaults(environ)

        status = '200 OK'
        headers = [('Content-type', 'text/html')]

        start_response(status, headers)

        template = get_template('index.html')

        d = {
            'name': random.choice(['Haruo', 'bucho', 'tokibito']),
            'em': random.choice(['World!', 'Universe!', 'Heaven!']),
        }

        return template.substitute(d)

    httpd = make_server('', 8000, simple_app)
    print "Serving on port 8000..."
    httpd.serve_forever()


これでserver.pyを再起動して画面をリロードすると！何も変わらず表示されますね。何か表示が変わってたらおかしいですよ。これだけだと寂しいのでHTMLにcssで装飾を付けてみましょう。

.. code-block:: XML

    <html>
        <style>strong{color:red;}</style>
        <body>
            <strong>$name</strong> <em>$em</em>
        </body>
    </html>

こんどはserver.pyを再起動せずにブラウザをリロードしてみてください。以下のように表示されました？

.. image:: images/sample2d.png

ということで、無事にテンプレート対応まで出来ました。

こういったテンプレートの機能はWebフレームワークによってはサーバー機能と一緒に用意していてくれたり(Django, Zope2など)、テンプレートのための個別のフレームワークを使ったり(Jinja2, Genshi, Cheetah など)して実現できます。string.Templateでもここまでできましたが、まあ既存のフレームワーク使った方が最終的には便利です。

データストア作る
------------------

さて、Webフレームワークというからにはデータ保存が出来ないと面白くありません。ということで、またPythonの標準ライブラリを使ってデータ保存するようにしてみましょう。

ここで使うのはPythonのオブジェクトをそのまま保存しておける ``shelve`` モジュールです。まあコード見た方が早いですね。

.. code-block:: Python

    # -*- coding: utf-8 -*-
    from wsgiref.util import setup_testing_defaults
    from wsgiref.simple_server import make_server
    from string import Template
    import random
    import os
    import shelve

    BASEDIR = os.path.dirname(os.path.abspath(__file__))
    def get_template(filename):
        path = os.path.join(BASEDIR, filename)
        return Template(open(path, 'r').read())

    def simple_app(environ, start_response):
        setup_testing_defaults(environ)

        status = '200 OK'
        headers = [('Content-type', 'text/html')]

        start_response(status, headers)

        template = get_template('index.html')

        db = shelve.open('shelve.db')
        if 'count' not in db:
            db['count'] = 0
        count = db['count']

        d = {
            'name': random.choice(['Haruo', 'bucho', 'tokibito']),
            'em': random.choice(['World!', 'Universe!', 'Heaven!']),
            'count': count,
        }

        db['count'] = count + 1
        db.close()

        return template.substitute(d)

    httpd = make_server('', 8000, simple_app)
    print "Serving on port 8000..."
    httpd.serve_forever()

dbという変数の部分が増えてますね。あとはcount。このcountをテンプレート側にも表示するように入れておきます。

.. code-block:: XML

    <html>
        <style>strong{color:red;}</style>
        <body>
            <strong>$name</strong> <em>$em</em>
            <br>
            count: $count
        </body>
    </html>


以下のようにカウントが表示されて、リロードする度に更新されていくと思います。ちなみにカウント数が12なのは tokibito Heaven! が表示されるまでリロードしたからです。

.. image:: images/sample3.png

これでだいぶWebフレームワークっぽくなってきましたね！でもこのDBは簡易的なものなので、ちょっとしたことで壊れたりします。同時アクセスとか。この辺も最近のWebフレームワークならSQLAlchemyやZODBなどと連携して、自分で作るよりは簡単に使うことが出来るんじゃないかと思います。


コントローラ作る
----------------

残念！23時59分です。時間が無くなってしまいました。コントローラはまた次の機会にやりたいと思います。


まとめ
--------

1時間でWebフレームワークを作ってみようと思いましたが、やっぱり既存のフレームワーク使った方が楽ですわね。
でもPythonは標準でこれくらいのことは出来るので、標準ライブラリは一通り眺めて置いて損は無いと思いますよ！

ということで、次は 世界のbucho `@torufurukawa`_ さん、お願いします！

.. _`Python Web フレームワーク アドベントカレンダー2010`: http://atnd.org/events/10465
.. _`@tokibito`: http://d.hatena.ne.jp/nullpobug/20101205/1291499395
.. _`@torufurukawa`: http://torufurukawa.blogspot.com/

# typo修正したら更新時刻が日付超えたんですが、まあ気にしない方向で。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 745
:date: 2010-12-21 20:00:00
:title: BPStudy#40 に参加しました Google Appengine 1.4.0
:categories: ['Event', 'python', 'study', 'gae']
:body type: text/x-rst
:body:
`BPStudy#40`_ に参加してきました。
いつも通り走り書きメモです。

.. _`BPStudy#40`: http://atnd.org/events/10717

今回のネタは"Google Appengine 1.4.0"。

第一部「Google App Engine1.4.0概説」
-------------------------------------------------------------

* 発表: Ian M Lewis (BeProud): `@IanMLewis`_

* 資料: http://www.slideshare.net/IanMLewis/bpstudy-40-google-appengine-140

.. _`@IanMLewis`: http://twitter.com/IanMLewis


発表からひろったポイント & 清水川メモ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* 今回の1.4.0はけっこう大きなリリース。
    * channel API
    * ライブラリ構成が変わって古いのはdeprecated扱い
    * Cronとタスクキュー時間制限が30秒から10分へ
    * タスクキューのデータがQuotaに含まれる

* ChannelAPI
    * サーバーからクライアントへデータをpushする
    * データが大容量だときついかも知れない
    * 使うための3つのステップ
        1. サーバーで ``Channel ID`` を生成してクライアントに渡す
        2. クライアントでそのIDを使って ``socket`` に接続する
        3. サーバーからchannelにメッセージを送信。クライアントで受け取る
    * 繋ぐためのサンプルコード
        * 資料のp14- http://www.slideshare.net/IanMLewis/bpstudy-40-google-appengine-140
    * データpushはJSONがお勧め（楽なので）
    * デモ:
        * http://s.beproud.jp/bpstudy40demo (検索)
        * http://s.beproud.jp/channel-api-demo (検索のソース)
        * http://s.beproud.jp/bpstudy40map (地図)
    * 質疑
        * channelは何個まで開けるのか？
            * 何個でも大丈夫なはず
            * channelはブラウザ毎でも全部で1つでもよい
            * ユーザー毎に別の作業をするページならユーザー毎に開く
            * 1つのページで共同作業する場合は全体で1つ開く
        * channelのタイムアウトは？
            * 2時間くらい
            * ブラウザ側で切れてたらつなぎ直す（自動？要実装）

* Taskキュー
    * 質疑
        * 課金は1.4から？
        * DataStoreのquotaに含むので普通のデータと合計でquota扱い
        * DataStoreが一杯で課金設定してなければTaskキューも積めない
        * Taskキューの処理は即時処理サーバーと遅いサーバーとで処理される
            * 長いTaskは遅いサーバーで。
            * どのあたりが境界線？
                * 「そうなんですよねー。よく分からないんです」@IanMLewis


第二部「Google App Engine1.4.0 ソースコードリーディング（python編）」
-----------------------------------------------------------------------

* 発表: `@tagomoris`_

.. _`@tagomoris`: http://twitter.com/tagomoris

発表からひろったポイント & 清水川メモ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* キャメルケース
* 同じ名前のメソッドがあちこちのモジュールにある
* SDKのインデントが2
* Google Python Style Guide は1度読むと良いと思いますよ
    * 本家: http://google-styleguide.googlecode.com/svn/trunk/pyguide.html
    * 日本語訳: http://works.surgo.jp/translation/pyguide.html
    * インデントは4を推奨
    * from xxx.xxx import * はNG
* SDKには不自然な空行がときどきある
    * リリース時に削除されているんじゃないかと思うが中の人じゃないと分からないだろう

以降、コードリーティング。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 746
:date: 2011-01-13 01:28:11
:title: "2011年は、Rails3を使おう！～masuidriveに学ぶ" に参加しました
:categories: ['Event', 'ruby-on-rails', 'study']
:body type: text/x-rst
:body:
`2011年は、Rails3を使おう！～masuidriveに学ぶ`_ に参加してきました。参加費1000円。

.. _`2011年は、Rails3を使おう！～masuidriveに学ぶ`: http://atnd.org/events/11360

ということで "Rails3" について自分的にポイントになりそうなところのイベント走り書きメモです。今回はtwitterで自分がつぶやいた内容をそのままコピペ。

第2部　Rails3を使おう！　～Railsの設計思想の変化とRails2からの移行
---------------------------------------------------------------------------

* 発表: 増井雄一郎氏: `@masuidrive`_

* 資料: http://bit.ly/co-rails3

.. _`@masuidrive`: http://twitter.com/masuidrive


発表からひろったポイント & 清水川メモ
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

* 「RubyConf（最大）、RailsConf（もっと最大）、RubyKaigi（国内最大）、ｒｙ」
* "2008年頃に Merb + DataMapper を使ってみたけど、想像以上に安定性が悪い。ほんとうに使ってる人がいるの？というくらい致命的なバグが見つかったりした" #raissemi
* "Merbのモジュール指向なのはRailsのテストやORMを差し替えられないのに対して良いかとおもったけど、いろいろなモジュールのリリースタイミングが異なり、整合性とるのが大変" #raissemi
* passenger多いな－。6割くらいの人が手を上げた。Mongrelは管理が大変なのと重いのとで避けられてるんだろうか？ apache cluster + mongrel + god でいくつか作ったことがある #raissemi
* "Rails3はSexy!" #raissemi
* "Rails3は振るスタックだがモジューラブル, クエリエンジンArel, 新しいルーティングエンジン, PluginAPI, Bundler" #raissemi
* "Railsはマイナーバージョンを1つトバしてアップグレードするのは大変, 2.3.xから3.0.xへのアップグレードは互換レイヤーがあるのでそれほど難しくないが、2.3.xから3.1は難しいだろう" 今までもそうねー #raissemi
* "APIに変更がない、ということはRailsではありえない。変化することは良いことだという文化" #raissemi
* "Rails3.0.2までは、胸を張ってプロダクションに使えるとはいえなかったけど、3.0.3以降ではクリティカルな問題はあまり出ていない。十分使えるようになった" #raissemi
* "Rails3, モジュール構造になるとどうしても遅くなる。3.0.0のActiveRecordは2.3.5の5倍遅かった！しかしチューニングも進み、3.0.2で大きく改善された" #raissemi
* Rails3.0.2で2.3.5のActiveRecordより速くなった、って言った？聞き逃しちゃった #raissemi
* "Rails3への移行: テストが書かれてなかったらあきらめる、2.3.8に上げてみる（だめならあきらめる）、使っているプラグインがRails3に対応しているか確認する（これ重要）。公開されているAPIを使っているプラグインなら大体は大丈夫" #raissemi
* "結論: 新規アプリはRails3で。" #raissemi
* "User.find(:all, ...) は User.where(...) と書くようになった。後方互換性のために古い書き方も3.0.xでは担保されることになっている" #raissemi
* "コマンド一つでインストール出来るBundlerは人に作業を依頼するとき非常に助かる" #raissemi
* されてなかったんですよー RT @tk0miya: Erb っていままでデフォルトではエスケープされていなかったのか… #raissemi
* しかしJinja2もデフォルトではエスケープしないようになっていて、それはポリシーとしてそうなっているようなことをドキュメントで読んだ。えー..
* "今後、3.1などを使っていくためには3.0のタイミングで切り替えておきたいところですが、今の3.0.3は切り替えるのにとても良いタイミングなのではないか。" #raissemi
* "資料はこちら: http://bit.ly/co-rails3 " #raissemi
* 質問タイム "Q, Rails3はRuby-1.8が良いのか、1.9が良いのか？ A, 自分は1.8で使っています。1.9は色々大変だけど動く、ということまでは聞いています" #raissemi
* Ruby-1.9はview連結でASCII8BIT問題がでてしまって、自分はあきらめました・・ RT @broccolimustdi>: #raissemi え、みんな1.8なの？


そして懇親会
------------------

イベント後に会場で懇親会でピザとビールいただきました。ごちそうさまでした。発表された皆さん、運営のみなさん、おつかれさまでした。



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 747
:date: 2011-01-23 17:20:00
:title: PyPIアップロードでありがちなreSTがHTMLにならない問題の対策
:categories: ['python']
:body type: text/x-rst
:body:
昨日の `(第4回)Python mini hack-a-thon`_ で@t2yが `多言語翻訳サポートツール ikazuchi`_ でPyPIデビューを果たしたんですが、そのときにlong_descriptionに記載したreStrucutredTextのちょっとしたsyntaxエラーのせいでHTMLに変換されないままドキュメントがPyPIにアップロードされてしまいました。そこでreSTのエラーを事前にチェック方法が `PyPIデビュー — Python Hack-a-thon 4: ハンズオン v1.0 documentation`_ に書いてあると良いよね、という指摘をもらったので以下の文面をそのページに追加してみました。

.. note::

   (2011/1/23 `@t2yからの指摘 <http://twitter.com/t2y/status/28845059566731265>`_ で追加. ありがとう!)

   実際にアップロードしてPyPIのページを確認したときに、long_description
   の内容がHTMLに変換されずにそのままreSTのテキストで表示されてしまう場合、
   reSTの記述にエラーがある可能性があります。この場合、upload前にエラーが
   あるかどうかを確認しておくのがよいでしょう。

   docutils付属の `rst2html` コマンドを使って以下のように実行して
   エラーが出るかどうか確認する方法があります。

   ::

      $ python setup.py --long-description | rst2html > output.html

   または、Python2.7以降でdocutilsがインストールされている環境であれば、
   以下のコマンドのようにエラーを確認することも出来ます。問題がなければ
   *running check* だけ表示されますが、問題があれば以下のように表示されます。

   ::

      $ python setup.py check -r
      running check
      warning: check: No directive entry for "foo" in module "docutils.parsers.rst.languages.en".
      Trying "foo" as canonical directive name. (line 19)

      warning: check: Could not finish the parsing.

   もう一つの方法として、 `haufe.releaser`_  をインストールして `python setup.py check_description` のように実行する方法もありそうです(未確認)。


.. _`(第4回)Python mini hack-a-thon`: http://atnd.org/events/10194
.. _`多言語翻訳サポートツール ikazuchi`: http://pypi.python.org/pypi/ikazuchi/
.. _`PyPIデビュー — Python Hack-a-thon 4: ハンズオン v1.0 documentation`: http://www.freia.jp/taka/docs/pyhack4/pypi/index.html#check
.. _`haufe.releaser`: http://pypi.python.org/pypi/haufe.releaser/


ところで、  `多言語翻訳サポートツール ikazuchi`_ 、poファイルを半自動でGoogle/Microsoft/Yahooの翻訳APIで翻訳してくれたり、vimからその機能を呼び出してインラインで翻訳実行したりと、かなり便利なツールでした。これはvimで翻訳する人にはかなり重宝しそう。いちどお試しあれ！


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 748
:date: 2011-01-23 18:00:49
:title: GAE/py + NoseGAEでUnitTestするときにimportエラーになる場合の対策
:categories: ['python', 'testing', 'gae']
:body type: text/x-rst
:body:
Google App Engine/Python での開発中にUnitTestを行うためには、データストアが使えるように環境を整えてくれる NoseGAE_ プラグインを使ってnoseでテストする方法があります。データストアの環境を整えてくれるオプション ``--with-gae`` をつけてテストするだけなのですが、ここで以下のようなエラーが出る場合があります。

::

  File "/path/to/index.py", line 4, in <module>
    from google.appengine.ext import webapp
  ImportError: No module named ext

NoseGAEでのテスト時以外にはこの問題は発生しないのですが、自分の環境ではなぜかテスト中だけ発生してしまいました。昨日の `(第4回)Python mini Hack-a-thon`_ で `@aodag`_ と話をして色々調べてみたところ、以下のことがわかりました。

* 本番のGAE環境ではsocketなどの一部ライブラリは利用できない
* NoseGAEはそういったパッケージを使えないようにしてくれる(sandbox機能)
* そのためにsys.modulesをゴニョゴニョしている
* 何か壊してるっぽい>< やめて！
* `--without-sandbox` オプションをつけること問題を回避出来る！

--without-sandbox オプションをつけると、GAEで使えないはずのライブラリが使用できてしまいますが、まあそのへんは自分で気をつけることにします。テスト出来ることの方が重要だしね。

この現象と対策は以下の環境で確認しました。

:Python: 2.5.x
:Nose: 1.0.0
:NoseGAE: 0.1.7
:GAE: 1.4.1



べつの話題として、テスト毎にデータストアを初期状態に戻してくれたり、fixtureデータを読み込んでくれたり、といったテスト環境の整備をパッケージ提供している人がまだ居ないようなので、この分野を整備して公開、だれかしてくれないかなぁ‥‥。

.. _`@aodag`: http://twitter.com/aodag
.. _`(第4回)Python mini Hack-a-thon`: http://atnd.org/events/10194


.. _NoseGAE: http://pypi.python.org/pypi/NoseGAE

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 749
:date: 2011-01-26 23:47:11
:title: JaSSTソフトウェアテストシンポジウム2011東京に行ってきた
:categories: ['Agile(XP)', 'Programming', 'testing']
:body type: text/x-rst
:body:
今日は `JaSSTソフトウェアテストシンポジウム`_ のイベントに行ってきました。仕事の都合で、2日目の `E5　新しいTDDアプローチ TDDの新しい活かし方をライブで見せます！`_ だけ聞いてきました。

拡張型TDD導入の提案、という発表と、それを受けてパネルディスカッションという感じでした。

拡張型TDDのポイントは:

1. UnitTestは開発者が思う仕様の記述なので、そこを定期的に補完して漏れのない単体テストとしての完成度を上げる
2. テスト自体のリファクタリングを明示的に導入する

上記の2点と理解しました。どちらもUnitTestとつきあっていく中で気づいて実践している人はいるとは思います。さらに、こうやってパターン化することでテストのやり方、考え方、守備範囲として広く定着しいって欲しいですね。

-----------------------

パネルディスカッションでは色々な話題がでて、拡張型TDDの話はあんまり出てこなかったんですが、いくつかキーワードがあったので（記憶から）書いておきます。

* "TDDは利用者の立場からの視点が重要" @t_wada
* "TDDの導入はヌルっと。何年かしたらみんなでやってた。良い方法は勝手に広まる" @m_seki
* "TDDはひとりでできる=言い訳出来ない。自分で始めて実績を作る。やれない理由を並べない。" @t_wada

あ、あとパネラーの @oota_ken さんの自己紹介で "EDD = Excel Driven Development" がすごく気になったｗ

-----------------------

今回のセッションでは、実は最後まで拡張型TDDのポイントというか、コンテキストが飲み込めていなかったため、プレゼンの内容が吸収できなかったのが残念でした。けっこう難しいテーマだったのでそのあたりの説明が欲しかったですね。上に書いたポイントは、パネルディスカッションが終わった後で `@yattom`_ さんをつかまえて聞いたのでした。

なにはともあれ、みなさんお疲れ様でした！

.. _`JaSSTソフトウェアテストシンポジウム`: http://www.jasst.jp/archives/jasst11e.html

.. _`E5　新しいTDDアプローチ TDDの新しい活かし方をライブで見せます！`: http://www.jasst.jp/archives/jasst11e/session_11e.html#e5

.. _`@yattom`: http://twitter.com/yattom


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 750
:date: 2011-01-27 01:20:57
:title: プログラマが知るべき97のこと、PDF版に電子サインもらった！
:categories: ['Event']
:body type: text/x-rst
:body:
1/26にJaSSTイベントにいってきたんですが( `レポ`__ )、セッションが終わったところで @t_wada さんをつかまえて `プログラマが知るべき97のこと - O'Reilly Japan 刊`_ のPDF版にサインをもらいました！

.. __: http://www.freia.jp/taka/blog/749

本はPDF版で買ったので、世界でもまだあまり実践されていないであろう、 **電子書籍に電子的にサインしてもらう** という無茶なお願いをしたところ、 @t_wada さんは快く引き受けてくれました。ありがとうございます！

* 「PDFにサインお願いします！」
* 「え、まじっすか。なんかスタイラスとか無いですか」
* 「無いです！」
* 「え、指でサインするんですか‥。えぇー」

えー、風邪が治りきらないところで無茶なお願いですみませんでした＞＜ ありがとうございました！

iPadでPDFに文字を書き入れてもらうのには、 iAnnotate_ を使いました。次にサインをお願いする時はスタイラスを用意しようと思います。

.. _iAnnotate: http://itunes.apple.com/jp/app/id363998953?mt=8

.. _`プログラマが知るべき97のこと - O'Reilly Japan 刊`: http://www.oreilly.co.jp/books/9784873114798/

:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 751
:date: 2011-04-12 11:15:00
:title: CentOS-5.5(i386, x86_64)でblockdiagを使って日本語入り画像を生成する手順
:categories: ['python', 'sphinx']
:body type: text/x-rst
:body:
大人気 blockdiag_ の環境構築にみんなはまっているようなので、CentOS-5.5で blockdiag_ 環境を構築する最短？っぽい手順をまとめてみました。

.. _blockdiag: http://tk0miya.bitbucket.org/blockdiag/build/html/examples.html

::

    yum install python-setuptools python-imaging fonts-japanese
    touch /usr/lib/python2.4/site-packages/PIL-1.1.5.egg-info
    easy_install blockdiag

これで動くようになります。easy_installの代わりにpipでも同様です。

みんながはまっているのは、python-imaging をyumでインストールしてもしなくても、 ``easy_install blockdiag`` したときにPIL-1.1.7がインストールされてしまい、このときにPILがインストールに失敗したり、png生成非対応状態でインストールされてしまうというあたりのようです。

そこで、前述の手順では ``touch ... PIL-1.1.5.egg-info`` してPILがインストールされてるという状態をeasy_installコマンド(python setup.py installでも同様)に教えてあげています。っていうバッドノウハウです。


念のため、以下のように出力のテストもやっておきましょう::

    wget http://pypi.python.org/packages/source/b/blockdiag/blockdiag-0.7.7.tar.gz
    tar zxf blockdiag-0.7.7.tar.gz
    cd blockdiag-0.7.7/examples
    blockdiag simple.diag
    blockdiag -f /usr/share/fonts/ja/TrueType/kochi-gothic-subst.ttf multibyte.diag

blockdiagに動作確認コマンドとか欲しいですね。

4/13追記
------------

CentOS-5.6でも同じ手順でOKだったみたいです。

  @togakushi: @shimizukawa 教えてもらった手順で CentOS5.6 環境であっさり動かせました！あざっす！

  -- http://twitter.com/togakushi/statuses/57774840882536448


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 752
:date: 2011-04-23 12:45:00
:title: Python-3.3 に標準搭載されるpackaging(Python3.3未満ではDistutils2)を試す
:categories: ['python']
:body type: text/x-rst
:body:
`(第7回)Python mini Hack-a-thon 午前の部`_

.. _`(第7回)Python mini Hack-a-thon 午前の部`: http://atnd.org/events/14178

pysetupきたー

  "distutils2 には pipやeasy_installと同じような "pysetup" コマンドが搭載され、インストール時の依存関係を解決してくれます。"

  "distutils2 will come with a "pysetup" command similar to pip/easy_install that will handle dependencies." 

`Distutils ML`_ で上記のようなメールを見かけて、Python標準で ``pysetup`` コマンドが搭載されるんだなーと言うことを知ったのでさっそくインストールしてみた。

https://bitbucket.org/tarek/distutils2/wiki/Home を見ると、以下のように書かれている。

* distutils2 はPython 2.4-3.2 では "Distutils2" というサードパーティーパッケージとして配布されます
* distutils2 はPython 3.3に "packaging" という名前で統合されます

なるほど。

最新はまだpypiに上がってないので、リポジトリから取ってきて実験。

.. topic:: Installing distutils2
  :class: dos

  | $ virtualenv du2
  | $ cd du2
  | $ source bin/activate
  | $ hg clone https://bitbucket.org/tarek/distutils2
  | $ python-2.7 setup.py install
  | $ bin/pysetup
  | Usage: pysetup [options] action [action_options]
  | 
  | Actions:
  |     run: Run one or several commands
  |     metadata: Display the metadata of a project
  |     install: Install a project
  |     remove: Remove a project
  |     search: Search for a project
  |     graph: Display a graph
  |     create: Create a Project
  | 
  | To get more help on an action, use:
  | 
  |     pysetup action --help
  | 
  | Global options:
  |   --verbose (-v)  run verbosely (default)
  |   --quiet (-q)    run quietly (turns verbosity off)
  |   --dry-run (-n)  don't actually do anything
  |   --help (-h)     show detailed help message
  |   --no-user-cfg   ignore pydistutils.cfg in your home directory
  |   --version       Display the version
  |
  | $

ふむふむ、動いた動いた。さっそく bucho をインストールしてみるか

.. topic:: pysetup commands
  :class: dos

  | $ bin/pysetup install bucho
  |
  | $

残念、ダメだった。何も起こらない。深くは追ってないけど。

runのサブコマンドはどんなのがあるのかな？

.. topic:: pysetup commands
  :class: dos

  | $ bin/pysetup run --list-commands
  | List of available commands:
  |   bdist: create a built (binary) distribution
  |   bdist_dumb: create a "dumb" built distribution
  |   bdist_wininst: create an executable installer for MS Windows
  |   build: build everything needed to install
  |   build_clib: build C/C++ libraries used by Python extensions
  |   build_ext: build C/C++ extensions (compile/link to build directory)
  |   build_py: "build" pure Python modules (copy to build directory)
  |   build_scripts: "build" scripts (copy and fixup #! line)
  |   check: perform some checks on the package
  |   clean: clean up temporary files from 'build' command
  |   install_data: install data files
  |   install_dist: install everything from build directory
  |   install_distinfo: create a .dist-info directory for the distribution
  |   install_headers: install C/C++ header files
  |   install_lib: install all Python modules (extensions and pure Python)
  |   install_scripts: install scripts (Python or otherwise)
  |   register: register the distribution with the Python package index
  |   sdist: create a source distribution (tarball, zip file, etc.)
  |   test: run the distribution's test suite
  |   upload: upload distribution to PyPI
  |   upload_docs: (no description available)

runはsetup.py相当のコマンドっぽい。なるほど。

.. _`Distutils ML`: http://mail.python.org/pipermail/distutils-sig/2011-April/017735.html


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 753
:date: 2011-04-23 16:00:00
:title: pyreadline を2to3でPython2/3両対応にするメモ
:categories: ['python']
:body type: text/x-rst
:body:
`(第7回)Python mini Hack-a-thon`_ 午後の部の成果です。

.. _`(第7回)Python mini Hack-a-thon`: http://atnd.org/events/14178

`Python 2からPython 3への移行 - YAMAGUCHI::weblog`_ を読みながら、python readline のWindows用パッケージ pyreadline_ を2to3を使ってPyhton2,3両対応にしてみました。


Python3対応メモ
-----------------

`2to3` 変換は ``python32 c:\Develop\Python32\Tools\Scripts\2to3.py -w --no-diffs target_dir`` という感じで実行。バックアップファイルが要らない場合は `-wn` みたいにオプションに n を付ける。

あとはひたすら Python2 でのテスト実行と 2to3.py での変換、Python3 でのテスト実行を繰り返す感じ。


以下、はまったところをメモ。

ctypes でwin32関数を取得出来なくなった
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

pyreadlineはWindowsで動作するために、Python本体が持っているHook関数のポインタを取得してゴニョゴニョしている。そのために以下のようにして関数ポインタを取得していた(Python2):

.. code-block:: Python

    import sys
    from ctypes import windll
    handler = windll.kernel32.GetProcAddress(
                    sys.dllhandle,
                    "PyOS_ReadlineFunctionPointer")

でもこれだとPython3では動作しなくて、PyOS_ReadlineFunctionPointer と言う名前が変わったのか？とか思ってPython2と3のソースコード(C言語)を読んだり、ctypesの仕様が変わった？とか色々やってみて、最終的には以下のようにしたら動作した(Python3):

.. code-block:: Python

    import sys
    from ctypes import windll
    handler = windll.kernel32.GetProcAddress(
                    sys.dllhandle,
                    b"PyOS_ReadlineFunctionPointer")

文字列の頭に ``b`` 付けただけ。あ゛ー、自動変換とか便利なものはPython3には無いんだっけなー‥


Python3でbytesになって欲しい文字列をPython2.5未満で表現出来ない
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Python3では ``b'spam'`` となって欲しい文字列があったとして、Python2.6であれば素直に b'spam' と書いておけば `2to3.py` で変換した後も b'spam' が維持される。

変換前(`Python2.6`):

.. code-block:: Python

    spam = b'spam'
    ham = u'ham'
    egg = 'egg'

2to3変換後(`Python3.2`):

.. code-block:: Python

    spam = b'spam'
    ham = 'ham'
    egg = 'egg'


しかし、Python2.6未満もサポートしているパッケージの場合、Python2.6未満では b'spam' とは書けないのでこの方法が使えない。どうするか？

変換前(`Python2.4`):

.. code-block:: Python

    spam = 'spam'.encode('latin-1')
    ham = u'ham'
    egg = 'egg'

2to3変換後(`Python3.2`):

.. code-block:: Python

    spam = 'spam'.encode('latin-1')
    ham = 'ham'
    egg = 'egg'

なんだかなー...

もう少しマシな方法としては `@mopemope`_ さんにアドバイス `(1)`_, `(2)`_ をもらった six_ の実装をまねて以下のように書くくらいか。

以下のコードをどこかに実装しておいて...

.. code-block:: Python

    import sys
    PY3 = (sys.version_info >= (3, 0))

    if PY3:
        b = lambda s: s.encode('latin-1')
        u = lambda s: s
    else:
        b = lambda s: s
        u = lambda s: unicode(s, "unicode_escape")

変換前(`Python2.4`):

.. code-block:: Python

    spam = b('spam')
    ham = u'ham'
    egg = 'egg'

2to3変換後(`Python3.2`):

.. code-block:: Python

    spam = b('spam')
    ham = 'ham'
    egg = 'egg'


文字列から1文字ずつ取り出す処理をbytesに行うと"文字は取り出されない
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
pyreadline はPythonのInteractiveShell上でカーソル移動や編集を行う関係上、外界と内界の境界上で str / unicode 変換 (Python3なら bytes / str 変換)を行う必要があるし、カーソル位置やなんかを保持したりいじったりする。

そんな処理の一部にこんなコードがあった(Python2):

.. code-block:: Python

    for c in text:
        self.line_buffer[self.point] = c
        self.point += 1
    ...
    line = ''.join.(self.line_buffer)

これはPython2時代なら文字列を1文字ずつ取り出して配列に突っ込んでいく処理なので、コードの文脈を無視して書き換えると以下のような処理をやっている(`Python2`):

.. code-block:: Python

    >>> text = b('spam')
    >>> buffer = [c for c in text]
    >>> buffer
    ['s', 'p', 'a', 'm']
    >>> line = ''.join.(buffer)
    >>> line
    'spam'

これを `Python3` に置き換えて実行すると...

.. code-block:: Python

    >>> text = b'spam'
    >>> buffer = [c for c in text]
    >>> buffer
    [115, 112, 97, 109]
    >>> line = b''.join.(buffer)
    Traceback (most recent call last):
      File "<stdin>", line 1, in <module>
    TypeError: sequence item 0: expected bytes, int found

buffer はintの配列なので b'' でjoinすることは出来ません、という事になってしまった。じゃあbytesに対して1文字ずつ処理するにはどうすれば良いのか‥ Python3.2のリファレンスを読んでも分からなかったので `@atsuoishimoto`_ 先生に助けを求めてみたところ、bytesはintの配列だから動作としては正しい、という趣旨のコメントを頂いた。うーん、、、 残念ながら標準的な解決法は今のところ無さそう。

intの配列から **文字列を** 取り出そうという考え方が良くないのかもしれないけど、2to3.pyでやろうとしている以上なんとかしないといけないので、以下のような互換レイヤーを挟んで解決を図ってみた。

.. code-block:: Python

    def biter(text):
        if PY3 and isinstance(text, bytes):
            return (s.to_bytes(1,'big') for s in text)
        else:
            return iter(text)

``s.to_bytes`` が気持ち悪いけどまあ仕方が無いということで。これでこんな感じに動くようになった。

`Python2` で実行:

.. code-block:: Python

    >>> text = b('spam')
    >>> [c for c in biter(text)]
    ['s', 'p', 'a', 'm']

`Python3` で実行:

.. code-block:: Python

    >>> text = b'spam'
    >>> [c for c in biter(text)]
    [b's', b'p', b'a', b'm']


とりあえず今日のまとめ
-----------------------
感想

* pyreadlineはsyntaxやモジュールの両対応は比較的簡単だった
* pyreadlineはコンソール操作を扱うので str / unicode / bytes 変換が多くて地獄

成果

* 実装コード: https://code.launchpad.net/~shimizukawa/pyreadline/python3
* 本家へのmergeリクエスト: https://code.launchpad.net/~shimizukawa/pyreadline/python3/+merge/57057

使い方

* `Python 2からPython 3への移行 - YAMAGUCHI::weblog`_ に書かれている方法でsetup.pyを調整してあるので、前述のlaunchpadからコードを取得して、 ``python setup.py install`` でPython2/3どちらでもインストール出来ます。


.. _`Python 2からPython 3への移行 - YAMAGUCHI::weblog`: http://d.hatena.ne.jp/ymotongpoo/20110406/1302061408

.. _pyreadline: http://pypi.python.org/pypi/pyreadline

.. _`@atsuoishimoto`: http://twitter.com/atsuoishimoto

.. _`@mopemope`: http://twitter.com/mopemope
.. _`(1)`: http://twitter.com/#!/mopemope/statuses/61236397843025921
.. _`(2)`: http://twitter.com/#!/mopemope/statuses/61237191485034496

.. _six: http://pypi.python.org./pypi/six


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 754
:date: 2011-04-23 18:10:00
:title: packaging (aka Distutils2) のcreateコマンド
:categories: ['python']
:body type: text/x-rst
:body:
`(第7回)Python mini Hack-a-thon`_ 夕方の部

.. _`(第7回)Python mini Hack-a-thon`: http://atnd.org/events/14178

`Python-3.3 に標準搭載されるpackaging(Python3.3未満ではDistutils2)を試す`_ で `pysetup` を使えるようになったので、コマンドを少しずつ見ていきます。

.. _`Python-3.3 に標準搭載されるpackaging(Python3.3未満ではDistutils2)を試す`: http://www.freia.jp/taka/blog/752 

.. topic:: pysetup commands
  :class: dos

  | $ python bin/pysetup
  | Usage: pysetup [options] action [action_options]
  | 
  | Actions:
  | .   run: Run one or several commands
  | .   metadata: Display the metadata of a project
  | .   install: Install a project
  | .   remove: Remove a project
  | .   search: Search for a project
  | .   graph: Display a graph
  | .   create: Create a Project

* run: 1つまたは複数のコマンドを実行
* metadata: プロジェクトのメタデータを表示
* install: プロジェクトをインストール
* remove: プロジェクトを削除
* search: プロジェクトを検索
* graph: グラフを表示
* create: プロジェクトを作成


まずはプロジェクト作成のための ``create`` コマンドをたたいてみます。

.. topic:: pysetup create
  :class: dos

  | $ python bin/pysetup create
  | Project name [du2]: spam
  | Current version number: 0.5
  | Package summary:
  |    > ham ham ham
  | Author name: shimizukawa
  | Author e-mail address: shimizukawa
  | Project Home Page: none
  | Do you want me to automatically build the file list with everything I can find
  | in the current directory ? If you say no, you will have to define them manually
  | . (y/n): y
  | Do you want to set Trove classifiers? (y/n): y
  | Please select the project status:
  | 
  | 1 - Planning
  | 2 - Pre-Alpha
  | 3 - Alpha
  | 4 - Beta
  | 5 - Production/Stable
  | 6 - Mature
  | 7 - Inactive
  | 
  | Status: 4
  | What license do you use: BSD
  | Matching licenses:
  | 
  |    1) License :: OSI Approved :: BSD License
  | 
  | Type the number of the license you wish to use or ? to try again:: 1
  | Do you want to set other trove identifiers (y/n) [n]: n
  | Wrote "setup.cfg".
  | 
  | $ ls
  | bin  lib  setup.cfg

上記のように、対話型で実行され、最終的には ``setup.cfg`` が生成されました。
setup.cfgの中身はこんな感じ::

    [metadata]
    name = spam
    version = 0.5
    summary = ham ham ham
    download_url = UNKNOWN
    home_page = none
    author = shimizukawa
    author_email = shimizukawa
    classifier = License :: OSI Approved :: BSD License
        Development Status :: 4 - Beta

    [files]
    packages =
    modules =
    resources =

なるほど、でもsetup.pyは作ってくれないんですね.. その辺りの仕組みも違うのかな？

ちなみに、既存のプロジェクトディレクトリで ``pysetup create`` を実行すると、以下のように setup.py から自動変換してくれるようです。便利ですね。

.. topic:: pysetup create
  :class: dos

  | $ pysetup create
  | A legacy setup.py has been found.
  | Would you like to convert it to a setup.cfg ? (y/n)



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 755
:date: 2011-05-01 15:49:47
:title: buchoを2to3でPython2/3両対応にするメモ
:categories: ['python']
:body type: text/x-rst
:body:
`bucho-0.1.0`_ for Python2/3

最近Python3対応パッケージがぼちぼち出始めているみたいで、4/30に `zc.buildout-2.0.0a`_ もリリースされました。そこで、お試しにインストール出来そうなPython3向けパッケージを探してみたけどあんまり見つからなかったので、 bucho_ をPython3対応してみました。

`pyreadline を2to3でPython2/3両対応にするメモ`_ ではまった経験を元に、サクサク対応を進めていきます。


.. _`pyreadline を2to3でPython2/3両対応にするメモ`: http://www.freia.jp/taka/blog/753
.. _`zc.buildout-2.0.0a`: http://pypi.python.org/pypi/zc.buildout/2.0.0a1
.. _bucho: http://pypi.python.org/pypi/bucho
.. _`bucho-0.1.0`: http://pypi.python.org/pypi/bucho/0.1.0

Python3対応メモ
----------------

例によって、とりあえず2to3変換してみます。 ``python32 c:\Develop\Python32\Tools\Scripts\2to3.py bucho`` という感じでオプション無しで実行して、まずは変換差分を確認。

.. code-block:: Python

    --- bucho/__init__.py	(original)
    +++ bucho/__init__.py	(refactored)
    @@ -1,6 +1,6 @@
     # encoding: utf-8
     import json
    -import urllib
    +import urllib.request, urllib.parse, urllib.error
     
     # these methods are exposed to Internet by wsgi.py
     __all__ = ['show', 'latest_status', 'all_status', 'torumemo']
    @@ -152,14 +152,14 @@
     def latest_status():
         """Print latest bucho's tweet.
         """
    -    url = urllib.urlopen('http://twitter.com/statuses/user_timeline/torufurukawa.json')
    +    url = urllib.request.urlopen('http://twitter.com/statuses/user_timeline/torufurukawa.json')
         tof = json.loads(url.read())
         return tof[0]['text']
     
     def all_status():
         """Print all bucho's tweet.
         """
    -    url = urllib.urlopen('http://twitter.com/statuses/user_timeline/torufurukawa.json')
    +    url = urllib.request.urlopen('http://twitter.com/statuses/user_timeline/torufurukawa.json')
         tof = json.loads(url.read())
         for t in tof:
             return t['text']
    --- bucho/command.py	(original)
    +++ bucho/command.py	(refactored)
    @@ -62,7 +62,7 @@
     for name in ['show', 'latest_status', 'all_status', 'torumemo']:
         def makecmd(n):
             def f(self, arg):
    -            print(getattr(bucho, n)())
    +            print((getattr(bucho, n)()))
                 return 0
             return f
         setattr(BuchoCmd, "do_" + name, makecmd(name))
    @@ -73,8 +73,8 @@
             if options is None:
                 options = BuchoOptions()
             c = cmdclass(options)
    -    except Exception, e:
    -        print e
    +    except Exception as e:
    +        print(e)
             return
     
         if options.args:
    --- bucho/wsgi.py	(original)
    +++ bucho/wsgi.py	(refactored)
    @@ -1,4 +1,4 @@
    -import urlparse
    +import urllib.parse
     import bucho
     
     
    @@ -11,8 +11,8 @@
     """
     
     def wsgi_app(environ, start_response):
    -    split_result = urlparse.urlsplit(environ['PATH_INFO'])
    -    paths = filter(None, split_result[2].split('/'))
    +    split_result = urllib.parse.urlsplit(environ['PATH_INFO'])
    +    paths = [_f for _f in split_result[2].split('/') if _f]
         headers = [('Content-Type', 'text/plain')]
     
         if not paths:


buchoはスレンダーなのであまり変換は多くありませんでしたが、実際に動かしてみると全然言うことを聞いてくれません。bucho, 見た目ほど単純ではないっぽい。

といことで、以下、はまったところをメモ。

printがbytesを受け付けない
----------------------------

Python2のUnicode文字列で、実行環境のコンソールに出力出来ない文字を含んでいる場合、 ``print value`` で出力出来ない場合があるので、以下のようにごまかすことがあります(良い代案募集):

.. code-block:: Python

    print value.encode(sys.stdout.encoding, 'replace')

しかしPython3のprint()にbytesを渡すと以下のようにreprした結果が出力されてしまいます。

`Python2` の場合:

.. code-block:: Python

    >>> print(b'bucho')
    bucho
    >>> print(u'部長'.encode(sys.stdout.encoding))
    部長

`Python3` の場合:

.. code-block:: Python

    >>> print(b'bucho')
    b'bucho'
    >>> print('部長'.encode(sys.stdout.encoding))
    b'\xe9\x83\xa8\xe9\x95\xb7'

とはいえ、Unicodeオブジェクトのままprintに渡してしまうと環境依存で出力出来ない文字に遭遇したときにUnicodeEncodeErrorになってしまうので、以下のようにして回避しました(ほんと、良い代案募集):

.. code-block:: Python

    bucho_encoding = sys.stdout.encoding
    if not bucho_encoding:
        bucho_encoding = 'utf-8'

    value = value.encode(bucho_encoding, 'replace')
    value = value.decode(bucho_encoding, 'replace')
    print(value)


なお、 `エキスパートPythonプログラミング`_ の日本語版で追加されたUnicode章(Appendix A)でこのあたりについて詳しく触れています (sys.stdout.buffer.writeでbytesを書き出せる (407ページ)、sys.stdout.encodingはファイルにリダイレクトしたときにNoneになるのでlocale.getpreferredencoding()を代わりに使う (399ページ)、など)。

.. _`エキスパートPythonプログラミング`: http://www.amazon.co.jp/dp/4048686291/freiaweb-22

wsgirefのappサンプルが動かない
-------------------------------

`Python-3.2のWSGIアプリケーションのサンプルコード`_ のアプリ部分を抜き出すと以下のように書かれていましたが、残念ながらこのままでは動きません。

.. code-block:: Python

    def simple_app(environ, start_response):
        setup_testing_defaults(environ)

        status = b'200 OK'
        headers = [(b'Content-type', b'text/plain; charset=utf-8')]

        start_response(status, headers)

        ret = [("%s: %s\n" % (key, value)).encode("utf-8")
               for key, value in environ.items()]
        return ret

status は str 型でなければいけません。headersに設定するkey/valueもstr型でなければいけません。returnする値はbytesのリストなので、これは上記の記述で問題ありませんが、別のサンプルでは ``return b"Hello World"`` って書いてあってこれは ``return [b"Hello World"]`` じゃないとNGでした。

...というような事をつぶやいたらところ、 @methane からコメントを頂きました:

.. highlights::

    それは、この間PEP3333とかで結論が出た話で、ドキュメントの更新が間に合って
    ないみたいですね。
    statusとheaderは両方共str型で、latin-1でエンコードして出力されるはずです。

    -- @methane http://twitter.com/methane/status/64516507572510720

なるほどー。とりあえず似たような報告は上がってなかったので http://bugs.python.org/issue11968 に超適当な報告をあげておきました。


.. _`Python-3.2のWSGIアプリケーションのサンプルコード`: http://docs.python.org/py3k/library/wsgiref.html#wsgiref.util.setup_testing_defaults


json.loads()はbytesを受け付けない
----------------------------------
以下のコードは `Python2` で動作します:

.. code-block:: Python

    url = urllib.urlopen('http://twitter.com/statuses/user_timeline/torufurukawa.json')
    tof = json.loads(url.read())

しかし、これを単純に2ty3しただけの以下のコードは `Python3` で動作しません:

.. code-block:: Python

    url = urllib.request.urlopen('http://twitter.com/statuses/user_timeline/torufurukawa.json')
    tof = json.loads(url.read())

原因は、json.loads()はstrを期待しているのに、url.read()の返値がbytesだったためです。ということで、Python3で動作させるために以下のように書き換えました:

.. code-block:: Python

    url = urllib.request.urlopen('http://twitter.com/statuses/user_timeline/torufurukawa.json')
    tof = json.loads(url.read().decode('ascii'))

さすがにasciiは手を抜きすぎか。 ``url.headers['content-type']`` のcharsetを見てdecodeしないとだめか。めんどくさいな。

2to3対応setup.py
------------------

最後に、Python2/3両対応にするためにsetup.pyに手を加えます。

.. code-block:: Python

    import setuptools
    extra = {}

    if sys.version_info >= (3, 0):
        if not getattr(setuptools, '_distribute', False):
            raise RuntimeError(
                    'You must installed `distribute` to setup bucho with Python3')
        extra.update(
            use_2to3=True
        )


    setuptools.setup(
        name = 'bucho',
        ....
        **extra
        )

.. ***

とりあえず今日のまとめ
-----------------------

* buchoは手強い
* `bucho-0.1.0`_ リリース (ロゴがPython3だ！)



:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 756
:date: 2011-05-01 18:20:00
:title: Python3でzc.buildout-2.0.0a1 を動かしてみた
:categories: ['python']
:body type: text/x-rst
:body:
昨夜、4/30の夜に `zc.buildout-2.0.0a1`_ がリリースされたので早速試してみました。

.. _`zc.buildout-2.0.0a1`: http://pypi.python.org/pypi/zc.buildout/2.0.0a1

.. topic:: bootstrap.py
    :class: dos

    | $ mkdir bo2
    | $ cd bo2
    | $ wget http://svn.zope.org/repos/main/zc.buildout/branches/2/bootstrap/bootstrap.py
    | $ python-3.2 bootstrap.py init

これで動いてくれれば話は早かったんですが、自分の環境ではなぜかzc.buildout-1.5.2がセットアップされてしまい、当然Python3では動きません。そこで、先にbuildout.cfgを作ってversions指定しておきました。

buildout.cfg::

    [buildout]
    parts =
    versions = versions
    
    [versions]
    zc.buildout = 2.0.0a1
    zc.recipe.egg = 2.0.0a1

改めてbootstrapを実行。 Python3では -d オプションはdefaultでonになりました。

.. topic:: bootstrap.py
    :class: dos

    | $ python-3.2 bootstrap.py init
    | ...
    | Generated script '/tmp/bo2/bin/buildout'.

次にbuildout.cfgにPython3アプリを使えるようにappセクションを追加します。

buildout.cfg::

    [buildout]
    parts = app
    versions = versions
    
    [app]
    recipe = zc.recipe.egg
    eggs = bucho
    interpreter = py
    
    [versions]
    zc.buildout = 2.0.0a1
    zc.recipe.egg = 2.0.0a1

.. topic:: bin/buildout
    :class: dos

    | $ bin/buildout
    | ...
    | Generated script '/tmp/bo2/bin/bucho'.
    | Generated interpreter '/tmp/bo2/bin/py'.

セットアップできました！ Python3でも zc.buildout が使えるようになりましたね。

.. topic:: bin/buildout
    :class: dos

    | $ bin/py -c "import sys;print(sys.version)"
    | 3.2 (r32:88445, Feb 20 2011, 21:30:00) [MSC v.1500 64 bit (AMD64)]
    |
    | $ bin/bucho latest_status
    | 雨降ってきまけど、池袋に飲みにいく。

雨の中のみに行くそうです。さすがbuchoですね。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 757
:date: 2011-05-04 01:45:53
:title: PILをWindowsで使う場合の問題への対策
:categories: ['python']
:body type: text/x-rst
:body:
WindowsでPIL-1.1.7を使う場合につまらない対策をする必要が有るらしいので、状況を調べてみた。

PIL配布元
http://www.pythonware.com/products/pil/

64bit Pythonだとインストール出来ない
-----------------------------------------------
情報元: http://www.flotsam-fareast.com/2011/02/64bit-windows-python-image-library-20110212.html

* インストーラがPythonを認識できない問題。
* 解決方法
    * Zip展開して手動でインストールする
    * distributeのeasy_installか、buildoutを使う
    * 根本的には配布元で64bit版インストーラを用意する必要がある。


1.1.7-py26,27ではDLL書き換えが必要
-----------------------------------------------
情報元: http://99blues.dyndns.org/blog/2011/01/blockdiag_for_win/

* 解決方法
    * DLLを書き換える
    * デバッグ版のDLLをインストールする(VC++9.0Express)

* 対象バージョン
    * 1.1.6 py24 OK
    * 1.1.6 py25 OK
    * 1.1.6 py26 OK
    * 1.1.7 py24 OK
    * 1.1.7 py25 OK
    * 1.1.7 py26 NG
    * 1.1.7 py27 NG


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2011-05-04.5743150465
:title: Re:PILをWindowsで使う場合の問題への対策
:author: KATO Kanryu
:date: 2011-05-04 02:09:34
:email: k.kanryu@gmail.com
:url: 
:body:
記事ありがとうございます。
64bit対応は今後行う可能性があるので
その時に改めてこの記事を参照したいと思います。

ですがPILのWindows版の対応については、
PythonのWindows版がVisual Studio 2008によるビルドが標準になっているにもかかわらず、
一部のディストリ(要するにPython公式のWindows版)で
msvcr90.dll等がバンドルされていないという可能性があるような気がします。
Windowsへの対策が十分に考えられているActivePythonや
PortablePythonを利用すれば、こういった問題は発生しないでしょう。

あと、PIL公式配布のバイナリの方がまずい可能性もありますね。

%%%%%%%%%

:id: 758
:date: 2011-05-04 15:40:00
:title: MeCab-0.98 ruby binding for Windows のビルド
:categories: ['Windows', 'ruby']
:body type: text/x-rst
:body:
Rubyで MeCab_ を使用するには `MecCab-rubyバインディング`_ を使用しますが、バンディングはビルド済みのものが提供されていないので、自分でビルドする必要があります。Linuxや*BSDならそれほどはまらないですが(実際CentOSでは簡単に出来た)、Windowsではコンパイル環境があってもはまったので、バインディングビルド手順をメモしておきます(完成物はこちら:  `mecab-ruby-0.98-win32-binary-20110504.zip`_)。

.. _MeCab: http://mecab.sourceforge.net/
.. _`MecCab-rubyバインディング`: http://sourceforge.net/projects/mecab/files/mecab-ruby/0.98/


バインディングをビルドせずに何とかする代替案
----------------------------------------------
バインディングをビルドしようとして調べたら、代替案が色々あったのでまとめてみました。

bindingをビルドせずにプロセス呼び出しで使う例
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ビルドするのが(実施や維持などが)難しいということで、shell経由で外部呼び出しして結果を手に入れる方法もいくつかあります。shell経由はデータ長(2047文字?)の上限など問題がありそうですが、テンポラリファイル経由でデータを渡す事でなんとかしているパターンもありますね。

* http://d.hatena.ne.jp/kenkitii/20060705/p1
* http://kyow.cocolog-nifty.com/blog/2009/05/windows-mecab-r.html
* http://rubyegginer.blogspot.com/2010/08/mecabrubywindows.html


libmecab.dllを直接呼び出す
~~~~~~~~~~~~~~~~~~~~~~~~~~~
データ長(2047文字?)問題を回避するスマートな方法として、libmecab.dllを使う方法も提案されてました。libmecab.dllは `MeCab-0.98 for Windows (mecab-win32)`_ に同梱されています。

* http://nlp.sfc.keio.ac.jp/~aihara/nlp.html
* http://kyow.cocolog-nifty.com/blog/2009/05/windows-mecab-r.html
* http://kitykey.jugem.jp/?eid=21
* `http://chezou.wordpress.com/2010/10/13/mecabをruby-1-9-2-on-windows764bit版で使う方法/`_

.. _`MeCab-0.98 for Windows (mecab-win32)`: http://sourceforge.net/projects/mecab/files/mecab-win32/
.. _`http://chezou.wordpress.com/2010/10/13/mecabをruby-1-9-2-on-windows764bit版で使う方法/`: http://chezou.wordpress.com/2010/10/13/mecab%E3%82%92ruby-1-9-2-on-windows764bit%E7%89%88%E3%81%A7%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95/


バインディングをビルドする手順
-------------------------------

この記事で対象にしているバージョン

* WindowsXP, 7 (95以降共通と思われる)
* ActiveRuby-1.8.7-p300
* MeCab-0.98
* mecab-ruby-0.98.tar.gz
* VisualStudio 6

環境の用意
~~~~~~~~~~~~
Windowsを用意します。そこにRuby-1.8.7(ActiveRuby), MeCab-0.98, VisualStudio6をインストールしておきます。


Ruby-1.8がVisualStudio6でビルドされているのでVS2008で動くようにする例
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ruby-1.8\lib\ruby\1.8\i386-mswin32\config.h を見ると ``_MSC_VER: 1200 is expected.`` と書かれていますね。VS6は無料で環境構築できないため、この時点でバインディングのビルドを断念する人も居そうです。この部分を書き換えて何とかしている例がいくつかありました。

* http://programming.jugglershu.net/programming/articles/rubyext.html
* http://ronspace.cocolog-nifty.com/blog/2009/02/ruby-pg-windows.html

‥いいのかな？動くならそれでもいいんでしょう。この記事ではVisualStudio6で話を進めます。

mecab-ruby-0.98.tar.gz を展開してextconf.rbを書き換え、Makefileを作成する
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Step1**

mecab-ruby-0.98.tar.gz に同梱されているextconf.rbには以下のような行があります::

    `mecab-config --libs-only-l`.chomp.split.each { | lib |

しかしWindowsではMeCabをインストールしてもmecab-configが無いのでこのままでは動きません。そこで以下のように書き換えます。

`元のextconf.rb`::

    require 'mkmf'

    mecab_config = with_config('mecab-config', 'mecab-config')
    use_mecab_config = enable_config('mecab-config')

    `mecab-config --libs-only-l`.chomp.split.each { | lib |
      have_library(lib)
    }

    $CFLAGS += ' ' + `#{mecab_config} --cflags`.chomp

    have_header('mecab.h') && create_makefile('MeCab')


`書き換えたextconf.rb`::

    require 'mkmf'

    $CFLAGS += ' -IC:\Develop\Mecab\sdk'
    $LOCAL_LIBS += ' libmecab.lib'
    $LIBPATH << 'C:\Develop\Mecab\sdk'

    have_header('mecab.h') && create_makefile('MeCab')

上記は、MeCabが ``C:\Develop\Mecab\`` にインストールされている場合です。それ以外にインストールしている場合は適宜パスを書き換えて使用してください。

**Step2**

``ruby extconf.rb`` を実行してMakefileを生成します。

.. Topic:: ruby extconf.rb
    :class: dos

    | C:> ruby extconf.rb
    | checking for mecab.h... yes
    | creating Makefile


nmakeを実行するために環境をセットアップする
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
VisualStudio6のnmakeを実行出来るように、vcvars32.batを実行してからnmakeします。

.. Topic:: ruby extconf.rb
    :class: dos

    | C:> "C:\Program Files\Microsoft Visual Studio\VC98\Bin\VCVARS32.BAT"
    | Setting environment for using Microsoft Visual C++ tools.

nmakeを実行するとビルドに失敗するのでコードを書き換える
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
nmakeを実行してMeCab.soをビルドします。

.. Topic:: ruby extconf.rb
    :class: dos

    | C:> nmake
    | Microsoft (R) Program Maintenance Utility   Version 6.00.8168.0
    | Copyright (C) Microsoft Corp 1988-1998. All rights reserved.
    |
    | ...
    |
    | MeCab_wrap.obj : error LNK2001: 外部シンボル ""__declspec(dllimport) char const * __cdecl MeCab::getTaggerError(void)" (__imp_?getTaggerError@MeCab@@YAPBDXZ)" は未解決です
    | MeCab_wrap.obj : error LNK2001: 外部シンボル ""__declspec(dllimport) class MeCab::Tagger * __cdecl MeCab::createTagger(char const \*)" (__imp_?createTagger@MeCab@@YAPAVTagger@1@PBD@Z)" は未解決です
    | MeCab_wrap.obj : error LNK2001: 外部シンボル ""public: static class MeCab::Tagger \*__cdecl MeCab::Tagger::create(int,char \* \*)" (?create@Tagger@MeCab@@SAPAV12@HPAPAD@Z)" は未解決です
    | MeCab_wrap.obj : error LNK2001: 外部シンボル ""public: static class MeCab::Tagger \*__cdecl MeCab::Tagger::create(char const \*)" (?create@Tagger@MeCab@@SAPAV12@PBD@Z)" は未解決です
    | MeCab_wrap.obj : error LNK2001: 外部シンボル ""public: static char const * __cdecl MeCab::Tagger::version(void)" (?version@Tagger@MeCab@@SAPBDXZ)" は未解決です
    | MeCab.so : fatal error LNK1120: 外部参照 5 が未解決です。
    | NMAKE : fatal error U1077: 'cl' : リターン コード '0x2'
    | Stop.

エラーになりました。上記にあるエラーメッセージでGoogleで検索しても解決策は見つかりませんでした（みんな同じところで引っかかってるというのは見つかりましたが）。そこで、エラーの原因を調べてみたところ、 ``MeCab::Tagger::create`` と ``MeCab::Tagger::version`` という2つのsingletonメソッドが原因っぽいので、ここはスッパリとこの2つのメソッドをあきらめる方向で対策してみます。

`MeCab_wrap.cpp` の以下の2行を削除します(4973行あたり)。singletonの定義部分::

  rb_define_singleton_method(SwigClassTagger.klass, "create", VALUEFUNC(_wrap_Tagger_create), -1);
  rb_define_singleton_method(SwigClassTagger.klass, "version", VALUEFUNC(_wrap_Tagger_version), -1);


これでビルドが通るはず。


改めてnmakeを実行してMeCab.soを作成する
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

改めてnmakeを実行してMeCab.soをビルドします。

.. Topic:: ruby extconf.rb
    :class: dos

    | C:> nmake
    | Microsoft (R) Program Maintenance Utility   Version 6.00.8168.0
    | Copyright (C) Microsoft Corp 1988-1998. All rights reserved.
    | 
    |         cl -I. -IC:/ruby-1.8/lib/ruby/1.8/i386-mswin32 -IC:/ruby-1.8/lib/ruby/1.8/i386-mswin32 -I. -MD -Zi  -O2b2xg- -G6 -IC:\Develop\Mecab\sdk -DHAVE_MECAB_H -c -TpMeCab_wrap.cpp
    | Microsoft (R) 32-bit C/C++ Optimizing Compiler Version 12.00.8804 for 80x86
    | Copyright (C) Microsoft Corp 1984-1998. All rights reserved.
    | 
    | MeCab_wrap.cpp
    |         C:\Program Files\Microsoft Visual Studio\VC98\include\xstring(521): クラステンプレートのメンバ関数 'void __thiscall std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> >::_Copy(unsigned int)' のコンパイル中
    |         cl -nologo -LD -FeMeCab.so MeCab_wrap.obj msvcrt-ruby18.lib  oldnames.lib user32.lib advapi32.lib shell32.lib ws2_32.lib   -link -incremental:no -debug -opt:ref -opt:icf -dll -libpath:"." -libpath:"C:/ruby-1.8/lib" -libpath:C:\Develop\Mecab\sdk  -implib:MeCab-i386-mswin32.lib -pdb:MeCab-i386-mswin32.pdb -def:MeCab-i386-mswin32.def
    |    ライブラリ MeCab-i386-mswin32.lib とオブジェクト MeCab-i386-mswin32.exp を作成中
    |
    | C:> dir MeCab.so
    | ...
    | 2011/05/04  14:51            57,399 MeCab.so

これでMeCab.soが作成出来ました。

完成物と変更を加えたファイルを公開しておきます。ライセンスなどは元のMeCabのものに従います。

* `mecab-ruby-0.98-win32-binary-20110504.zip`_

.. _`mecab-ruby-0.98-win32-binary-20110504.zip`: stuff/mecab-ruby-0.98-win32-binary-20110504.zip


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 759
:date: 2011-05-04 16:20:29
:title: MeCab-0.98 python binding for Windows のビルド
:categories: ['python', 'Windows']
:body type: text/x-rst
:body:
Pythonで MeCab_ を使用するには `MecCab-pythonバインディング`_ を使用しますが、バンディングはビルド済みのものが提供されていないので、自分でビルドする必要があります。Linuxや*BSDならそれほどはまらないと思いますが、Windowsではコンパイル環境があってもはまったので、バインディングビルド手順をメモしておきます(完成物はこちら: `mecab-python-0.98-win32-binary-20110504.zip`_)。

.. _MeCab: http://mecab.sourceforge.net/
.. _`MecCab-pythonバインディング`: http://sourceforge.net/projects/mecab/files/mecab-python/0.98/


バインディングをビルドする手順
-------------------------------

この記事で対象にしているバージョン

* Windows7 (95以降共通と思われる)
* Python-2.7
* MeCab-0.98
* mecab-python-0.98.tar.gz
* VisualC++ 2008 Express Edition (無料版)

環境の用意
~~~~~~~~~~~~
Windowsを用意します。そこにPython-2.7, MeCab-0.98, VisualC++ 2008 Express Editionをインストールしておきます。


mecab-python-0.98.tar.gz を展開してsetup.pyを書き換える
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

mecab-python-0.98.tar.gz に同梱されているsetup.pyには以下のような行があります::

    version = cmd1("mecab-config --version"),

しかしWindowsではMeCabをインストールしてもmecab-configが無いのでこのままでは動きません。そこで以下のように書き換えます。

`元のsetup.py`::

    #!/usr/bin/env python

    from distutils.core import setup,Extension,os
    import string

    def cmd1(str):
        return os.popen(str).readlines()[0][:-1]

    def cmd2(str):
        return string.split (cmd1(str))

    setup(name = "mecab-python",
        version = cmd1("mecab-config --version"),
        py_modules=["MeCab"],
        ext_modules = [
            Extension("_MeCab",
                ["MeCab_wrap.cxx",],
                include_dirs=cmd2("mecab-config --inc-dir"),
                library_dirs=cmd2("mecab-config --libs-only-L"),
                libraries=cmd2("mecab-config --libs-only-l"))
                ])


`書き換えたsetup.py`::

    #!/usr/bin/env python

    from distutils.core import setup, Extension

    setup(name = "mecab-python",
        version = '0.98',
        py_modules=["MeCab"],
        ext_modules = [
            Extension("_MeCab",
                ["MeCab_wrap.cxx",],
                include_dirs=[r'C:\Develop\Mecab\sdk'],
                library_dirs=[r'C:\Develop\Mecab\sdk'],
                libraries=['libmecab'])
                ])

上記は、MeCabが ``C:\Develop\Mecab\`` にインストールされている場合です。それ以外にインストールしている場合は適宜パスを書き換えて使用してください。

そして ``python setup.py dist`` を実行してビルドします。

.. Topic:: python setup.py
    :class: dos

    | C:> python setup.py build
    | running build
    | running build_py
    | running build_ext
    | building '_MeCab' extension
    | ...
    | build\lib.win32-2.7\_MeCab.pyd : fatal error LNK1120: 外部参照 3 が未解決です

しかし、上記のようにエラーになってしまいます。


python setup.py bdistを実行するとビルドに失敗するのでコードを書き換える
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
既に同じようなbindingをRuby用に作っていた経験から、エラーになる原因はわかっています。そこで、Ruby版と同じように ``MeCab.Tagger.version`` と ``MeCab.Tagger.create`` をあきらめる方向で対策します。

`MeCab_wrap.cxx` の以下の2行を削除かコメントアウトします(5597行あたり)::

    { (char *)"Tagger_create", _wrap_Tagger_create, METH_VARARGS, NULL},
    { (char *)"Tagger_version", _wrap_Tagger_version, METH_VARARGS, NULL},


これでビルドが通るはず。


改めてpython setup.py bdist を実行してMeCab.pydを作成する
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
正確には MeCab.py と _MeCab.pyd が作成されます。

.. Topic:: python setup.py
    :class: dos

    | C:> python setup.py bdist
    | ...
    | adding 'Develop\Python27\Lib\site-packages\MeCab.py'
    | adding 'Develop\Python27\Lib\site-packages\_MeCab.pyd'
    | ...
    |
    | C:> dir dist
    | ...
    | 2011/05/04  16:10            27,730 mecab-python-0.98.win32.zip

これでMeCabのPythonバインディングが作成出来ました。
python setup.py bdist の代わりに ``python setup.py install`` とすれば直接使用している環境にインストールすることもできます。

完成物(python2.7, 2.6用)と変更を加えたファイルを公開しておきます。ライセンスなどは元のMeCabのものに従います。egg化とかは要望があれば。

* `mecab-python-0.98-win32-binary-20110504.zip`_

.. _`mecab-python-0.98-win32-binary-20110504.zip`: stuff/mecab-python-0.98-win32-binary-20110504.zip


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 760
:date: 2011-06-16 00:00:00
:title: Djangoのモデルオブジェクトの値を自動表示する__repr__のデｨスクリプタ実装
:categories: ['python', 'django']
:body type: text/x-rst
:body:
`@podhmo がDjangoのモデルクラスで__unicode__を書き換える方法について、継承かdecoratorかという話をしていた`__ ので、別解を考えてみた。

.. __: http://twitter.com/#!/podhmo/status/80999729193959424

Djangoは__unicode__が実装されていればその結果を使って__repr__を整形表示してくれるのだけど、__repr__はPython2系ではASCII文字列を返すべきという話もあり、悩ましいところ。とりあえずその点は置いておく。

Djangoのモデルで__unicode__を実装せずに実装してshellで表示すると以下のようになる。

.. code-block:: Python

    >>> class Project(models.Model):
    ...     name = models.CharField(u'プロジェクト名', max_length=255)
    ...
    >>> p = Project(name="Foo")
    >>> p.save()
    >>> p
    <Project: Project object>

これをデバッグしやすいように表示するには__unicode__を実装するか、以下のように__repr__を実装する。

.. code-block:: Python

    >>> class Project(models.Model):
    ...     name = models.CharField(u'プロジェクト名', max_length=255)
    ...     def __repr__(self):
    ...         return '<Project: id=%d, name=%r>' % (self.pk, self.name)
    ...
    >>> p = Project(name="Foo")
    >>> p.save()
    >>> p
    <Project: id=1, name=u'Foo'>


しかしこの方法だとモデル毎に実装していかなければいけないし、クラス実装にべったりくっついてしまうので論理的に分解して理解しづらい。

__repr__ が自動的にModelのフィールド値を集めて返してくれれば良いし、継承したモデル毎に再実装するのはいやだし、デバッグ中以外は不要なので付け外しがあるいていどしやすい形式になっていれば良いということなので、ディスクリプタを使って実装してみる。

.. code-block:: Python

    class AutoFieldsRepr(object):
        def __get__(self, instance, cls):
            def __repr__():
                attrs = ((f.name, getattr(instance, f.name))
                         for f in cls._meta.fields)

                # formatting
                formatted = ', '.join("%s=%r" % x for x in attrs)
                return "<%s %s>" % (cls.__name__, formatted)

            return __repr__

これを以下のようにモデルクラスに差し込んで使う。

.. code-block:: Python

    class Project(models.Model):
        name = models.CharField(u'プロジェクト名', max_length=255)

        __repr__ = AutoFieldsRepr()

これをshellで使うと以下のように表示される。

::

    >>> Project.objects.all()[0]
    <Project: id=1, name=u'Foo'>

この方法なら、仮にProjectを継承したモデルがあっても自動的に継承したモデルのフィールドも表示してくれるので、あちこちに実装を差し込む必要は無い。

さらに、DjangoのModelクラスに__repr__を差し込んでしまえば、上記のようにProjectクラスに ``__repr__ = AutoFieldsRepr()`` を書く必要も無くなるので、たとえば auto_fields_repr.py を以下の内容で用意しておく。

auto_fields_repr.py:

.. code-block:: Python

    class AutoFieldsRepr(object):
        def __get__(self, instance, cls):
            def __repr__():
                attrs = ((f.name, getattr(instance, f.name))
                         for f in cls._meta.fields)

                # formatting
                formatted = ', '.join("%s=%r" % x for x in attrs)
                return "<%s %s>" % (cls.__name__, formatted)

            return __repr__

    from django.db import models
    models.Model.__repr__ = AutoFieldsRepr()

これを使いたいシーンでのみ（shellなどで） ``import auto_fields_repr`` すれば全てのモデルのオブジェクトが見やすく整形されて表示されるようになる。はず。

.. code-block:: Python

    >>> from django.contrib.auth.models import User
    >>> u = User.objects.all()[0]

    >>> u
    <User: admin@test.test>

    >>> import auto_fields_repr

    >>> u
    <User id=1, username=u'admin@test.test', first_name=u'', last_name=u'', .......


長くなりすぎたので上記例では末尾を省略したけど、期待通り動作しているみたい。
あとは__repr__のUnicode処理やエラー処理をちゃんと実装するとか、改行を入れてきれいに表示するとか、欲しいフィールドだけを表示するとか、もうちょっと手を入れればけっこう使えそうな気がする。

ディスクリプタについては清水川も翻訳に参加した `エキスパートPythonプログラミング`_ のP108, `3.3.1 ディスクリプタ` で、仕組みや便利な使い方などが紹介されているので、ぜひぜひご参照ください。 `エキPy読書会もやってます！`_

.. note::

  当初、__unicode__ を差し替える実装例で書いていましたが、Django以外では__repr__書き換えないと期待した動作にならないのと、django.db.models.Model.__unicode__差し替えでは期待した動作にならないため、__repr__差し替えの方針で書き直しました。

.. _`エキスパートPythonプログラミング`: http://www.amazon.co.jp/dp/4048686291/freiaweb-22
.. _`エキPy読書会もやってます！`: http://www.freia.jp/taka/docs/expertpython/reading/


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 761
:date: 2011-08-28 23:00:00
:title: マンションの総会2011
:categories: ['Event', 'misc']
:body type: text/x-rst
:body:
.. note:: このエントリは9/5に書きました

9/28に `PyCon JP 2011`_ の2日目イベント、Sprintがありましたが午後3時からマンションの総会だったため、そして理事長やってたので欠席・委任する訳にもいかず昼くらいで品川シーサイドから調布へ移動しました。

.. _`PyCon JP 2011`: http://2011.pycon.jp/

うちのマンションも昭和59年建築で築27年まできて、この日の総会で上水道配管更新という、大規模改修に次いで大きなイベントを清水川理事長のもと可決しました（仕事でお客さん調整するより全然楽）。しかし、理事長選任議案でげんなりすることが。詳細はアレなので省きますが、ウチのマンションは輪番制で理事会をやっているなかで「理事長はやりたい人がやればいいんじゃないですか？」という発言が出てきて、あぁ人間ってわかり合えないもんだよね、って思ったり。そんなので揉めるんなら毎年やってもいいよ、もう（きっと規約変更のために臨時総会が必要になって余計に忙しくなるんだけどね）。

ところで、上水道配管更新は元々のマンションの柱内のものを交換するのでは無く、建物の外側に増設交換することになりました。昭和のマンションはそのあたりまだ考慮されてなかったらしくて、元通りにするにはコンクリを破砕しないといけなかったりと工事費もかなり高くなるということで、増設する方針で決定しました。マンションの廊下上部に水道管が走るのは見た目がちょっと・・まあ仕方ないですね。

平成以降？のマンションは塩ビ製？なので半永久的に交換の必要がないなど、色々進んでるみたいです。大規模改修の費用が15戸で案分とか、構造が古いとかだと大変だということが分かったので、平成10年より前の建築だったり個数50戸未満だったりのマンションは避けた方がいいですよ。

(うちのマンション住人にも `アート・オブ・コミュニティー`_ 読ませようかな...)

.. _`アート・オブ・コミュニティー`: http://astore.amazon.co.jp/freiaweb-22/detail/4873114950


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 762
:date: 2011-09-06 00:50:00
:title: Rubyのrcov-0.9.8 for Windows のビルド
:categories: ['Programming', 'Windows', 'ruby']
:body type: text/x-rst
:body:
WindowsのRubyで rcov_ を使用するには一般的には http://rubyforge.org/frs/?group_id=1750&release_id=16551 にあるようなビルド済みバイナリを使用しますが、rcov-0.8.1.2以降はビルド済みのものが提供されていないので、自分でビルドする必要があります。Windowsではコンパイル環境があってもはまったので、バインディングビルド手順をメモしておきます(完成物はこちら:  `rcov-0.9.10-x86-mswin32-60.gem`_)。

.. _rcov: http://mecab.sourceforge.net/

ビルド手順
--------------

この記事で対象にしているバージョン

* WindowsXP, 7 (95以降共通と思われる)
* ActiveRuby-1.8.7-p300
* rcov-0.9.10
* VisualStudio 6

環境の用意
~~~~~~~~~~~~
Windowsを用意します。そこにRuby-1.8.7(ActiveRuby), VisualStudio6 をインストールしておきます。

gemからコンパイル済みのgemパッケージを作るRubyGemsプラグイン `gem-compile`_ をインストールします::

    C:\> gem install gem-compile

.. _`gem-compile`: http://d.hatena.ne.jp/viver/20100404/p1


Rubyのext.hを書き換え
~~~~~~~~~~~~~~~~~~~~~~~

環境の問題かもしれませんが、VisualStudio6でrcovをビルドしようとすると、以下のようなエラーが発生します::

  ライブラリ rcovrt-i386-mswin32.lib とオブジェクト rcovrt-i386-mswin32.exp を作成中
  callsite.obj : error LNK2001: 外部シンボル "_ruby_frame" は未解決です
  rcovrt.obj : error LNK2001: 外部シンボル "_ruby_frame" は未解決です
  rcovrt.so : fatal error LNK1120: 外部参照 1 が未解決です。
  NMAKE : fatal error U1077: 'cl' : リターンコード '0x2'
  Stop.

そこで調べてみると `RUBYFORGEのフォーラム`_ で情報が見つかったので、Ruby本体の ``C:\ruby-1.8\lib\ruby\1.8\i386-mswin32\env.h``  を以下のように書き換えます::

    - extern struct FRAME {
    + extern __declspec(dllimport) struct FRAME {


.. _`RUBYFORGEのフォーラム`: http://rubyforge.org/forum/forum.php?thread_id=45666&forum_id=16394


rcov-0.9.10.gem から rcov-0.9.10-x86-mswin32-60.gem を作成
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

http://rubygems.org/gems/rcov から rcov-0.9.10.gem を取得してコマンドラインで以下のように変換します::

  C:\>gem compile rcov-0.9.10.gem
  WARNING:  no rubyforge_project specified
    Successfully built RubyGem
    Name: rcov
    Version: 0.9.10
    File: rcov-0.9.10-x86-mswin32-60.gem

これで rcov-0.9.10-x86-mswin32-60.gem が作成出来ました。

完成物と変更を加えたファイルを公開しておきます。ライセンスなどは元のrcovのものに従います。

* `rcov-0.9.10-x86-mswin32-60.gem`_

.. _`rcov-0.9.10-x86-mswin32-60.gem`: stuff/rcov-0.9.10-x86-mswin32-60.gem


:extend type: text/x-rst
:extend:


:comments:
:comment id: 2011-09-06.2078596857
:title: 誤字 Re:Rubyのrcov-0.9.8 for Windows のビルド
:author: you_tomita
:date: 2011-09-06 16:47:02
:email: you.tomita@gmail.com
:url: 
:body:
通りすがりですが、

「環境の問題化も」→「環境の問題かも」

:comments:
:comment id: 2011-09-06.0725862509
:title: Re:誤字
:author: しみずかわ
:date: 2011-09-06 17:51:21
:email: 
:url: 
:body:
> 「環境の問題化も」→「環境の問題かも」

ありがとう！直しました。

%%%%%%%%%

:id: 763
:date: 2011-10-12 11:30:00
:title: Python本と扱っているPythonのバージョンを調べてみた
:categories: ['python']
:body type: text/x-rst
:body:
初めてのPython
=====================================
日本語

* 第1版 Python-1.5 2000/9 464ページ 3,990円
* 第2版 Python-2.2/2.3 2004/11 752ページ 5,040円
* 第3版 Python-2.5/3.0a 2009/2 808ページ 4,830円

英語 Learning Python 

* First Edition py-1.5 1999/4 384p $34.95
* Second Edition py-2.2/2.3 2003/12 624p $39.99
* Third Edition py-2.5/3.0a 2007/10 752p $39.99
* Forth Edition py-2.6/3.0 2009/9 1216p $54.99

英語の方のページ数が半端無いなー


Pythonクックブック
===================================
日本語

* Py-2.3/2.4 
* 第2版 Py-2.4 2007/6 652p 4,410円

英語 Python Cookbook

* Py-2.3/2.4 2002/7 608p $39.95
* Second Edition Py-2.4 2005/3 848p $39.99
* Third Edition Py-2.6/3.x 2011/12 800p $49.99 (予定)


みんなのPython
===================================
* Py-2.4 2006/8 464p 2,940円
* 改訂版 Py-2.6 2009/4 484p 2,940円

Pythonチュートリアル
===================================
* 第1版 Py-2.5 2007/9 200p 1,260円
* 第2版 Py-3.1.1/2.x 2010/2 244p 1,575円
* (web) Py-2.6.2 http://www.python.jp/doc/release/tutorial/

Pythonスタートブック
===================================
* Py-2.6.5 2010/4 320p 2,604円
* (改訂中) Py-2.7.2 http://tanopy.blog79.fc2.com/blog-entry-77.html

エキスパートPythonプログラミング
===================================
* Py-2.6.5/3.x 2010/5 416p 3,780円

Python入門 2-3対応
===================================
* Py-2.?/3.? 2010/6 543p 2,835円


調べ疲れたのでここまで。気が向いたら追記します。


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 764
:date: 2011-11-01 11:00:00
:title: 結婚しました
:categories: ['misc']
:body type: text/x-rst
:body:
さきほど区役所に婚姻届を出してきました。これからもよろしくお願いいたします。

彼女と初めて会ったのが6月、そして結婚式は11月にやることにしました。半年前はこうなるとは思ってもみませんでしたが、ここから先は一緒に生きていこうと思います。

彼女はチェロを弾いたり美術館にいったりする人で、ゲームやアニメは全く知らないみたい。以前はちょっとだけプログラマだったこともあるみたいで、情報処理2種をC言語で受けていたり、MCSEを持っていたりするらしい。本人は「暗黒時代」って言ってるけど。今聞いてびっくりしたｗ

.. image:: images/20111010-battleline.jpg/image_preview

旅行先でバトルライン対戦中

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2011-11-02.1244198560
:title: Re:結婚しました
:author: methane
:date: 2011-11-02 11:15:26
:email: 
:url: 
:body:
おめでとうございます！

:comments:
:comment id: 2011-11-02.5813877487
:title: Re:結婚しました
:author: uemura
:date: 2011-11-02 11:23:01
:email: 
:url: http://www.ueblog.org/blog
:body:
おめでとうございます！！！！

:comments:
:comment id: 2011-11-02.7172913739
:title: Re:結婚しました
:author: Surgo
:date: 2011-11-02 11:25:17
:email: surgo.jp@gmail.com
:url: 
:body:
おめでとうございます！！！！！！！

:comments:
:comment id: 2011-11-03.2345857884
:title: Re:結婚しました
:author: shidocchi
:date: 2011-11-03 01:43:55
:email: 
:url: 
:body:
おめでとうございます。お幸せに。

早速バトルラインw
趣味が共有できるのはいいですね。


:comments:
:comment id: 2011-11-05.4472149979
:title: Re:結婚しました
:author: しみずかわ
:date: 2011-11-05 17:57:27
:email: 
:url: 
:body:
みなさんありがとうございますーヽ('∀`)ﾉ

:comments:
:comment id: 2011-11-09.3355960219
:title: Re:結婚しました
:author: たはら
:date: 2011-11-09 23:02:16
:email: yusei@domen.cx
:url: 
:body:
おくればせながらおめでとうございます!!

%%%%%%%%%

:id: 765
:date: 2011-11-02 21:18:26
:title: PyPIで公開していないパッケージをeasy_installで手軽にインストール 
:categories: ['python']
:body type: text/x-rst
:body:

先日 @aodag と社内で話していたときにgithubやbitbucketの便利な使い方を聞いて、ナルホド！と思ったので、もうひと工夫してみた。

前置き
=======
easy_install はパッケージ名を指定すればネットワーク(PyPI)からそのパッケージを探してきて自動的にインストールしてくれる便利なツールだ。
例えば以下のように実行する::

   $ easy_install Pillow

   (venv2) D:\venv2>easy_install Pillow
   Searching for Pillow
   Reading http://pypi.python.org/simple/Pillow/
   Reading http://github.org/collective/pillow
   Reading http://github.org/collective/Pillow
   Reading http://github.com/Pillow
   Best match: Pillow 1.7.5
   Downloading http://pypi.python.org/packages/2.7/P/Pillow/Pillow-1.7.5-py2.7-win32.egg...

easy_installがPillow 1.7.5 を見つけたようだ。

既にインストールされていてアップデートする場合は以下のように実行する::

   $ easy_install -U Pillow


PyPIにリリースしていないパッケージのeasy_install
==================================================

先の例では、easy_installはPillowを標準のインデックスサーバー = PyPI( http://pypi.python.org/pypi/ )から自動的に探してインストールしてくれている。ではPyPIにパッケージがない、あるいは別の所にあるパッケージを指定してインストールするにはどうすればいいか。単にそのパッケージのURLを指定するだけで良い::

   $ easy_install https://bitbucket.org/shimizukawa/pillow/downloads/Pillow-1.7.5-py2.7-win32.egg

このeasy_installの機能と、githubやbitbucketで用意されているtag名やbranch名で自動的にzip/tgzを用意してくれる機能を組み合わせると、こんな事が出来るようになる。

自分がちょっとしたツールとして作った logfilter はPyPIに公開されていないので、easy_installは出来ない::

   $ easy_install logfilter
   Searching for logfilter
   Reading http://pypi.python.org/simple/logfilter/
   Couldn't find index page for 'logfilter' (maybe misspelled?)

しかし、先の例のようにURLを直接指定すれば任意のtagのパッケージを直接インストールすることが出来る。例えばgithubにあるWebDispatchの場合、tagを付けると https://github.com/aodag/WebDispatch/tags にあるように自動的にtag名でzipファイルが生成されるので、以下のようにeasy_installすることができるわけだ::

   $ easy_install https://github.com/aodag/WebDispatch/zipball/1.0a3
   Downloading https://github.com/aodag/WebDispatch/zipball/1.0a3
   Processing 1.0a3

同様のことはbitbucketでもちょっと前のアップデートでできるようになった。logfilterを置いている https://bitbucket.org/shimizukawa/logfilter/downloads を見ると、zipだけでなくtar.gzやbz2も提供されている。

ここまでが @aodag から教えてもらったこと。さすがaodagや！ヽ('∀`)ﾉ

easy_install -f の名前解決を使ってバージョンを自動認識
=======================================================

パッケージのURLを直接指定する方法には一つだけ難点があって、logfilter-0.9.2 の次のバージョンがリリースされたときに自動的に新しいバージョンを見つけてくれない。そこで、easy_installにある ``--find-links`` または ``-f`` オプションを使う方法を併用してみる。-fオプションに指定するのはパッケージへの ``リンク集`` があるページのURLだ::

   $ easy_install -f https://bitbucket.org/shimizukawa/logfilter/downloads logfilter
   Searching for logfilter
   Reading https://bitbucket.org/shimizukawa/logfilter/downloads
   Best match: logfilter 0.9.2
   Downloading https://bitbucket.org/shimizukawa/logfilter/get/logfilter-0.9.2.zip

このように -f オプションを指定すると、 ``ページ内にあるリンクをチェックして、パッケージ名を認識し、自動的に最新のバージョンを取得＆インストール`` してくれる。さらに、インデックスサーバー(PyPI等)を指定する-iオプションと異なり、複数指定もできてインデックスサーバーよりも優先されるので、独自のパッケージサーバーを利用しつつ、PyPIも使いたいといったシーンで活用できる。


* `Dependencies that aren't in PyPI - setuptools - The PEAK Developers' Center <http://peak.telecommunity.com/DevCenter/setuptools#dependencies-that-aren-t-in-pypi>`_

* `PyPIにない依存物 [Python] setuptools - SumiTomohikoの日記 <http://d.hatena.ne.jp/SumiTomohiko/20070622/1182537643>`_


ただし、パッケージ名に相当するリンクターゲット名は、easy_install(setuptools)の決めたルールに従って名前づけられていないとeasy_installがパッケージを見つけることが出来ない。名前は logfilter-0.9.2.zip を参考に説明すると、以下のようになっている::

   [パッケージ名]-[バージョン].[拡張子]

完全な名前付けのルールはもうすこし複雑で、プラットフォームやアーキテクチャが含まれる場合もある。そういったファイル名の例は http://docs.python.org/distutils/builtdist.html で参照することが出来る（仕様はPEPになってないのかな？）。

バージョン番号部分の付け方は、easy_installが導入したデファクトの名前付けルールについては以下のページを参照して欲しいが、 PEP386_ で正式に決められたバージョン番号体系に従うべきだ。

.. _PEP386: http://www.python.org/dev/peps/pep-0386/

* `Specifying Your Project's Version - setuptools - The PEAK Developers' Center <http://peak.telecommunity.com/DevCenter/setuptools#specifying-your-project-s-version>`_

* `プロジェクトのバージョンを指定する [Python] setuptools - SumiTomohikoの日記 <http://d.hatena.ne.jp/SumiTomohiko/20070622/1182537643>`_


ということで、bitbucketやgithubで自動生成されるzipファイルの名前を上記のルールに適合するようにタグ名を調整すれば、easy_installの-fオプションでインストール出来る様になる。 https://bitbucket.org/shimizukawa/logfilter の例でいうと、タグ名は以下のように設定した::

   logfilter-0.9.2
   logfilter-0.9.1
   logfilter-0.9

タグ名を ``0.9.2`` とかしてしまうと残念ながらPythonの配布パッケージとして認識されないので(先のWebDispatchの例のようにフルURL指定すればインストールは出来る)、パッケージ名付きでリポジトリにタグを設定するのがポイントだ。


まとめ
=======

タグ名を工夫すれば、PyPIで公開していないパッケージを自動名前解決&バージョン認識してeasy_installで手軽にインストールすることができる。

というか、0.9.2.zip とか tip.zip とかいう名前でダウンロード出来てもあとで何だか分からなくなるので、プロジェクト名も付けてzipファイルを生成してくださいよ、bitbucket & githubさん！


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 766
:date: 2011-11-15 13:05:16
:title: ANS-prog: pythonの-m指定で便利なモジュール類
:categories: ['misc', 'Memo', 'python', 'Programming']
:body type: text/x-rst
:body:
`ANS-prog`_ という日本版 `Stack Overflow`_ とでもいうべきサイトがあって、そこで色々な技術の質問をすると誰かが答えてくれる。「これはちょっとMLとかで質問するのは気が引ける」といった簡単な質問でもANS-progなら気軽に質問出来る気がする。MLと比べて便利なのは、Q&A集になることとや、良いAnswerを選んで「確定」できること、評価(カルマ)ポイントが貯まると **質問そのものを編集可能** なので質問になっていない質問を適切なQuestionに直せるところなど。

.. _`ANS-prog`: http://answer.pythonpath.jp/
.. _`Stack Overflow`: http://stackoverflow.com/

ということで、以下の質問を出してみた -> http://answer.pythonpath.jp/questions/506/python-m

--------------------------------------------------------

Pythonは標準モジュールを-mに指定して実行するといろいろな機能を提供してくれるのが便利です。

現在のディレクトリをHTTPで公開する::

    $ python -m SimpleHTTPServer
    Serving HTTP on 0.0.0.0 port 8000 ...

対象スクリプトをステップ実行する::

    $ python -m pdb foo.py
    > d:\foo.py(1)<module>()
    (Pdb)

メールサーバーを立てる::

    $ python -m smtpd -d -n localhost:25
    PureProxy started at Tue Nov 15 12:45:38 2011
            Local addr: ('localhost', 25)
            Remote addr:('localhost', 25)

メールを送る::

    $ python -m smtplib
    From:

JSONをバリデーションしてprettyprintする (by Masaki Tsuchiya)::

    $ echo '{"json":"obj"}' | python -mjson.tool
    {
        "json": "obj"
    }
    $ echo '{ 1.2:3.4}' | python -mjson.tool
    Expecting property name: line 1 column 2 (char 2)

他に、「普段こんな使い方をしていて便利だよ！」というモジュールがあったら教えてください。

--------------------------------------------------------


ということで教えてください！ => http://answer.pythonpath.jp/questions/506/python-m

あと、みんなもちょっとした質問を書くと良いよ！


:extend type: text/x-rst
:extend:
%%%%%%%%%

:id: 767
:date: 2011-11-21 10:00:00
:title: 11/24(木)に伊豆高原で挙式してきます
:categories: ['Event']
:body type: text/x-rst
:body:
.. figure:: http://farm7.staticflickr.com/6110/6272182737_853e57fbbe.jpg
   :target: http://www.flickr.com/photos/shimizukawa/6272182737/
   :alt: ミッシェルガーデンコート、教会

   ミッシェルガーデンコート、教会

熱海(来宮)で開催された `PySpa Final(写真)`_ から帰ってきた清水川です。おはようございます。PySpaでは温泉に3回入って、あとはほとんど InternetWeek2011_ で発表するSphinxの資料を書いてました。PySpaは原稿書くのには向いてないですね！

.. _`PySpa Final(写真)`: http://www.flickr.com/photos/shimizukawa/sets/72157628046164641/
.. _InternetWeek2011: https://internetweek.jp/program/t3/

ということで、挙式することになりました。両親兄弟のみで平日やることにしましたが、いろんな人への紹介や親戚挨拶回りとか考えると全然楽な選択じゃない気がしますね！

何人かから電報の送り先とか(個人のではない)Amazon Wishlistとか聞かれたので晒しておきますね

:場所: 伊豆高原 ミッシェルガーデンコート
:url: http://michaelresort.com/izu/
:日時: 2011/11/24(木) 10:00～
:Amazonくれくれ: http://www.amazon.co.jp/registry/wishlist/28VF1F5QI3LKR

なんと、伊豆高原って昨日までいた来宮から数駅先なんですね、びっくり！

追記:
=======

`@takanory`_ さんが作ってくれたblogパーツ貼っておきます。‥‥って、デッドラインタイマー！？

.. iframe:: https://www.freia.jp/taka/blog/767/wedding_countdown

.. _`@takanory`: https://twitter.com/takanory

:extend type: text/x-rst
:extend:


:comments:
:comment id: 2011-11-22.5020740743
:title: Re:11/24(木)に伊豆高原で挙式してきます
:author: richardx64
:date: 2011-11-22 14:25:02
:email: 
:url: 
:body:
超タイトスケジュールっぽいけどがんがーれ。改めておめでとー！

%%%%%%%%%
