(dp0
S'pubdate'
p1
cdatetime
datetime
p2
(S'\x07\xdc\x04\x0b\x17\x1e\x00\x00\x00\x00'
p3
tp4
Rp5
sS'link'
p6
Vhttp://www.freia.jp/taka/blog/replace-makefile-with-python/index.html
p7
sS'description'
p8
V<div id=makefilepython class=section>\u000a<h1>2012/04/11 Makefile\u3092Python\u3067\u7f6e\u304d\u63db\u3048\u308b<a class=headerlink href=http://www.freia.jp/taka/blog/replace-makefile-with-python/index.html#makefilepython title=\u3053\u306e\u30d8\u30c3\u30c9\u30e9\u30a4\u30f3\u3078\u306e\u30d1\u30fc\u30de\u30ea\u30f3\u30af>¶</a></h1>\u000a<p><em>Category: 'Python', 'make', 'Makefile', 'Library'</em></p>\u000a<p>\u4ed5\u4e8b\u3067Makefile\u3092\u66f8\u3044\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u3061\u3087\u3068\u8907\u96d1\u306a\u3053\u3068\u3092\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u66f8\u304d\u65b9\u3092\u8abf\u3079\u308b\u306e\u306b\u3084\u305f\u3089\u3068\u6642\u9593\u3092\u53d6\u3089\u308c\u307e\u3059\u3002Python\u3070\u3063\u304b\u308a\u66f8\u3044\u3066\u308b\u305b\u3044\u304b\u3001Makefile\u3084shell script\u306e\u66f8\u304d\u65b9\u306f\u6bce\u56de\u5fd8\u308c\u307e\u3059\u306d\u3002</p>\u000a<p><strong>Makefile\u3092Python\u3067\u66f8\u3051\u308c\u3070\u826f\u3044\u306e\u306b\uff01</strong> \u3068\u306f\u3044\u3048\u3001\u30d9\u30bf\u306bPython\u3067\u66f8\u3044\u3066\u3001\u30bf\u30fc\u30b2\u30c3\u30c8\u9593\u306e\u4f9d\u5b58\u95a2\u4fc2\u306a\u3069\u3092\u8003\u3048\u59cb\u3081\u308b\u3068\u30b3\u30fc\u30c9\u304c\u3081\u3061\u3083\u304f\u3061\u3083\u9577\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3068\u3044\u3046\u3053\u3068\u3067Python\u3067Makefile\u3092\u7f6e\u304d\u63db\u3048\u308b\u30c4\u30fc\u30eb\u304c\u7121\u3044\u304b\u8abf\u3079\u3066\u307f\u307e\u3057\u305f\u3002\u3056\u3063\u3068\u63a2\u3057\u3066\u898b\u3064\u3051\u305f\u306e\u304c\u4ee5\u4e0b\u306e\u30c4\u30fc\u30eb\u3067\u3059\u3002</p>\u000a<ul class=simple>\u000a<li><a class="reference external" href=http://pypi.python.org/pypi/Baker>http://pypi.python.org/pypi/Baker</a></li>\u000a<li><a class="reference external" href=http://pypi.python.org/pypi/mk>http://pypi.python.org/pypi/mk</a></li>\u000a<li><a class="reference external" href=http://pypi.python.org/pypi/shovel>http://pypi.python.org/pypi/shovel</a></li>\u000a<li><a class="reference external" href=http://pypi.python.org/pypi/Paver>http://pypi.python.org/pypi/Paver</a></li>\u000a</ul>\u000a<p>\u3053\u306e\u4e2d\u3067\u306f\u3001\u591a\u5206\u6b32\u3057\u3044\u306e\u306fPaver\u8fba\u308a\u3060\u308d\u3046\u306a\u3042\u3068\u601d\u3044\u3064\u3064\u3001\u81ea\u5206\u304c\u6b32\u3057\u3044\u306e\u306f\u3069\u3046\u3044\u3046\u4f7f\u3044\u65b9\u306a\u306e\u304b\u3092\u628a\u63e1\u3059\u308b\u305f\u3081\u306b\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002</p>\u000a<p>\u4ee5\u4e0b\u306e\u3088\u3046\u306amake.py\u3092\u8a18\u8ff0\u3067\u304d\u308b\u3068\u3001\u66f8\u304f\u306e\u304c\u697d\u305d\u3046\u3067\u3059\u3002</p>\u000a<div class=highlight-python><div class=highlight><pre><span class=c># -*- coding: utf-8 -*-</span>\u000a<span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>absolute_import</span><span class=p>,</span> <span class=n>print_function</span>\u000a\u000a<span class=kn>import</span> <span class=nn>os</span>\u000a<span class=kn>import</span> <span class=nn>sys</span>\u000a<span class=kn>import</span> <span class=nn>time</span>\u000a<span class=kn>import</span> <span class=nn>tarfile</span>\u000a\u000a<span class=kn>from</span> <span class=nn>.mk</span> <span class=kn>import</span> <span class=n>make</span>\u000a\u000a\u000a<span class=c>#defines</span>\u000a<span class=n>WORK_DIRS</span> <span class=o>=</span> <span class=p>[</span><span class=s>'bin'</span><span class=p>,</span> <span class=s>'parts'</span><span class=p>,</span> <span class=s>'develop-eggs'</span><span class=p>]</span>\u000a<span class=n>EGG_DIR</span> <span class=o>=</span> <span class=s>'eggs'</span>\u000a<span class=n>BUILDOUT_CMD</span> <span class=o>=</span> <span class=s>'bin/buildout'</span>\u000a<span class=k>if</span> <span class=n>sys</span><span class=o>.</span><span class=n>platform</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s>'win'</span><span class=p>):</span>\u000a    <span class=n>BUILDOUT_CMD</span> <span class=o>+=</span> <span class=s>'.exe'</span>\u000a\u000a\u000a<span class=nd>@make.target</span><span class=p>()</span> <span class=c>#this is make target.</span>\u000a<span class=nd>@make.depend</span><span class=p>(</span><span class=s>'buildout'</span><span class=p>)</span> <span class=c>#run dependents before target</span>\u000a<span class=k>def</span> <span class=nf>all</span><span class=p>():</span>\u000a    <span class=k>return</span> <span class=n>make</span><span class=o>.</span><span class=n>sh</span><span class=p>(</span><span class=n>BUILDOUT_CMD</span><span class=p>,</span> <span class=s>'-N'</span><span class=p>)</span> <span class=c>#call shell command</span>\u000a\u000a\u000a<span class=nd>@make.target</span><span class=p>(</span><span class=n>BUILDOUT_CMD</span><span class=p>)</span> <span class=c>#check existent</span>\u000a<span class=k>def</span> <span class=nf>buildout</span><span class=p>():</span>\u000a    <span class=n>make</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>EGG_DIR</span><span class=p>)</span> <span class=c>#make dir if not exist</span>\u000a    <span class=k>return</span> <span class=n>make</span><span class=o>.</span><span class=n>sh</span><span class=p>(</span>\u000a        <span class=n>sys</span><span class=o>.</span><span class=n>executable</span><span class=p>,</span> <span class=s>'-S'</span><span class=p>,</span> <span class=s>'bootstrap.py'</span><span class=p>,</span>\u000a        <span class=s>'-d'</span><span class=p>,</span>\u000a        <span class=s>'--eggs'</span><span class=p>,</span> <span class=n>EGG_DIR</span><span class=p>,</span>\u000a        <span class=s>'--setup-source'</span><span class=p>,</span> <span class=s>'distribute_setup.py'</span><span class=p>,</span>\u000a        <span class=s>'--version'</span><span class=p>,</span> <span class=s>'1.5.2'</span><span class=p>,</span>\u000a    <span class=p>)</span>\u000a\u000a\u000a<span class=nd>@make.target</span><span class=p>()</span>\u000a<span class=k>def</span> <span class=nf>clean</span><span class=p>():</span>\u000a    <span class=n>make</span><span class=o>.</span><span class=n>rm</span><span class=p>(</span><span class=o>*</span><span class=n>WORK_DIRS</span><span class=p>)</span> <span class=c>#remove directories if exist</span>\u000a\u000a\u000a<span class=nd>@make.target</span><span class=p>()</span>\u000a<span class=k>def</span> <span class=nf>remove_eggs</span><span class=p>():</span>\u000a    <span class=n>make</span><span class=o>.</span><span class=n>rm</span><span class=p>(</span><span class=n>EGG_DIR</span><span class=p>)</span>\u000a\u000a\u000a<span class=nd>@make.target</span><span class=p>()</span>\u000a<span class=nd>@make.depend</span><span class=p>(</span><span class=s>'clean'</span><span class=p>,</span> <span class=s>'remove_eggs'</span><span class=p>,</span> <span class=s>'buildout'</span><span class=p>)</span>\u000a<span class=k>def</span> <span class=nf>pkg</span><span class=p>():</span>\u000a    <span class=n>make</span><span class=o>.</span><span class=n>sh</span><span class=p>(</span><span class=n>BUILDOUT_CMD</span><span class=p>,</span> <span class=s>'-c'</span><span class=p>,</span> <span class=s>'buildout-mkpkg.cfg'</span><span class=p>)</span>\u000a    <span class=n>make</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=s>'clean'</span><span class=p>)</span> <span class=c>#call another make target</span>\u000a\u000a    <span class=n>name</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>basename</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>getcwd</span><span class=p>())</span>\u000a    <span class=n>filename</span> <span class=o>=</span> <span class=s>'{0}-{1}.tgz'</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>time</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s>'%Y%m</span><span class=si>%d</span><span class=s>-%H%M%S'</span><span class=p>))</span>\u000a    <span class=k>with</span> <span class=n>tarfile</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=s>'../'</span><span class=o>+</span><span class=n>filename</span><span class=p>,</span> <span class=s>'w|gz'</span><span class=p>)</span> <span class=k>as</span> <span class=n>tar</span><span class=p>:</span>\u000a        <span class=n>tar</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s>'.'</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>\u000a\u000a    <span class=k>print</span><span class=p>(</span><span class=s>'deploy package:'</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>\u000a\u000a\u000a<span class=k>if</span> <span class=n>__name__</span> <span class=o>==</span> <span class=s>'__main__'</span><span class=p>:</span>\u000a    <span class=n>make</span><span class=o>.</span><span class=n>run</span><span class=p>()</span>\u000a</pre></div>\u000a</div>\u000a<p>\u3053\u308c\u3092\u52d5\u304b\u3059\u305f\u3081\u306emk.py\u3092\u3056\u3056\u3063\u3068\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002</p>\u000a<div class=highlight-python><div class=highlight><pre><span class=c># -*- coding: utf-8 -*-</span>\u000a<span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>print_function</span>\u000a\u000a<span class=kn>import</span> <span class=nn>os</span>\u000a<span class=kn>import</span> <span class=nn>sys</span>\u000a<span class=kn>import</span> <span class=nn>subprocess</span>\u000a<span class=kn>import</span> <span class=nn>shutil</span>\u000a\u000a\u000a<span class=k>class</span> <span class=nc>Runner</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>\u000a    <span class=k>def</span> <span class=nf>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=n>depends</span><span class=o>=</span><span class=bp>None</span><span class=p>,</span> <span class=n>targets</span><span class=o>=</span><span class=bp>None</span><span class=p>):</span>\u000a        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>__class__</span><span class=p>):</span>\u000a            <span class=bp>self</span><span class=o>.</span><span class=n>func</span> <span class=o>=</span> <span class=n>func</span><span class=o>.</span><span class=n>func</span>\u000a            <span class=bp>self</span><span class=o>.</span><span class=n>depends</span> <span class=o>=</span> <span class=n>depends</span> <span class=ow>or</span> <span class=n>func</span><span class=o>.</span><span class=n>depends</span> <span class=ow>or</span> <span class=p>[]</span>\u000a            <span class=bp>self</span><span class=o>.</span><span class=n>targets</span> <span class=o>=</span> <span class=n>targets</span> <span class=ow>or</span> <span class=n>func</span><span class=o>.</span><span class=n>targets</span> <span class=ow>or</span> <span class=p>[]</span>\u000a        <span class=k>else</span><span class=p>:</span>\u000a            <span class=bp>self</span><span class=o>.</span><span class=n>func</span> <span class=o>=</span> <span class=n>func</span>\u000a            <span class=bp>self</span><span class=o>.</span><span class=n>depends</span> <span class=o>=</span> <span class=n>depends</span> <span class=ow>or</span> <span class=p>[]</span>\u000a            <span class=bp>self</span><span class=o>.</span><span class=n>targets</span> <span class=o>=</span> <span class=n>targets</span> <span class=ow>or</span> <span class=p>[]</span>\u000a        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>func</span><span class=o>.</span><span class=n>__name__</span>\u000a\u000a    <span class=k>def</span> <span class=nf>__call__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>\u000a        <span class=c># targets</span>\u000a        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>targets</span> <span class=ow>and</span> <span class=n>__builtins__</span><span class=o>.</span><span class=n>all</span><span class=p>(</span>\u000a                <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>target</span><span class=p>)</span> <span class=k>for</span> <span class=n>target</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>targets</span><span class=p>):</span>\u000a            <span class=k>print</span><span class=p>(</span><span class=s>"Skip:"</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>\u000a            <span class=k>print</span><span class=p>(</span><span class=s>" all targets are exists:"</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>targets</span><span class=p>)</span>\u000a            <span class=k>return</span> <span class=mi>0</span>\u000a\u000a        <span class=c># depends</span>\u000a        <span class=k>for</span> <span class=n>depend</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>depends</span><span class=p>:</span>\u000a            <span class=n>ret</span> <span class=o>=</span> <span class=n>make</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=n>depend</span><span class=p>)</span>\u000a            <span class=k>if</span> <span class=n>ret</span><span class=p>:</span>\u000a                <span class=k>return</span> <span class=n>ret</span>\u000a        <span class=c># main</span>\u000a        <span class=k>print</span><span class=p>(</span><span class=s>"In:"</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>\u000a        <span class=n>ret</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>func</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>\u000a        <span class=k>print</span><span class=p>(</span><span class=s>"Out:"</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=p>)</span>\u000a        <span class=k>return</span> <span class=n>ret</span>\u000a\u000a\u000a<span class=k>class</span> <span class=nc>make</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>\u000a    <span class=sd>"""class for namespace"""</span>\u000a    <span class=n>__commands</span> <span class=o>=</span> <span class=p>{}</span>\u000a\u000a    <span class=c>#private</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>_register</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span> <span class=n>func</span><span class=p>,</span> <span class=n>depends</span><span class=o>=</span><span class=bp>None</span><span class=p>,</span> <span class=n>targets</span><span class=o>=</span><span class=bp>None</span><span class=p>):</span>\u000a        <span class=n>func</span> <span class=o>=</span> <span class=n>Runner</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>depends</span><span class=o>=</span><span class=n>depends</span><span class=p>,</span> <span class=n>targets</span><span class=o>=</span><span class=n>targets</span><span class=p>)</span>\u000a        <span class=n>cls</span><span class=o>.</span><span class=n>__commands</span><span class=p>[</span><span class=n>func</span><span class=o>.</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>func</span>\u000a        <span class=k>return</span> <span class=n>func</span>\u000a\u000a    <span class=c>#decorator</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>depend</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>depends</span><span class=p>):</span>\u000a        <span class=k>def</span> <span class=nf>inner</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>\u000a            <span class=k>return</span> <span class=n>cls</span><span class=o>.</span><span class=n>_register</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>depends</span><span class=o>=</span><span class=n>depends</span><span class=p>)</span>\u000a        <span class=k>return</span> <span class=n>inner</span>\u000a\u000a    <span class=c>#decorator</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>target</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>targets</span><span class=p>):</span>\u000a        <span class=k>def</span> <span class=nf>inner</span><span class=p>(</span><span class=n>func</span><span class=p>):</span>\u000a            <span class=k>return</span> <span class=n>cls</span><span class=o>.</span><span class=n>_register</span><span class=p>(</span><span class=n>func</span><span class=p>,</span> <span class=n>targets</span><span class=o>=</span><span class=n>targets</span><span class=p>)</span>\u000a        <span class=k>return</span> <span class=n>inner</span>\u000a\u000a    <span class=c>#utility</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>sh</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>):</span>\u000a        <span class=k>print</span><span class=p>(</span><span class=s>' '</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>args</span><span class=p>))</span>\u000a        <span class=k>return</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>check_call</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>\u000a\u000a    <span class=c>#utility</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>rm</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>dirs</span><span class=p>):</span>\u000a        <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>dirs</span><span class=p>:</span>\u000a            <span class=n>shutil</span><span class=o>.</span><span class=n>rmtree</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=bp>True</span><span class=p>)</span>\u000a\u000a    <span class=c>#utility</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>mkdir</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>\u000a        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>path</span><span class=p>):</span>\u000a            <span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=n>EGG_DIR</span><span class=p>)</span>\u000a\u000a    <span class=c>#utility</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>call</span><span class=p>(</span><span class=n>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>[],</span> <span class=n>kw</span><span class=o>=</span><span class=p>{}):</span>\u000a        <span class=k>return</span> <span class=n>cls</span><span class=o>.</span><span class=n>__commands</span><span class=p>[</span><span class=n>name</span><span class=p>](</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>\u000a\u000a    <span class=c>#utility</span>\u000a    <span class=nd>@classmethod</span>\u000a    <span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=n>cls</span><span class=p>):</span>\u000a        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>:</span>\u000a            <span class=k>if</span> <span class=s>'all'</span> <span class=ow>in</span> <span class=n>cls</span><span class=o>.</span><span class=n>__commands</span><span class=p>:</span>\u000a                <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s>'all'</span><span class=p>)</span>\u000a            <span class=k>else</span><span class=p>:</span>\u000a                <span class=k>print</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=s>'need target.'</span><span class=p>)</span>\u000a                <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>cls</span><span class=o>.</span><span class=n>__commands</span><span class=o>.</span><span class=n>keys</span><span class=p>()):</span>\u000a                    <span class=k>print</span><span class=p>(</span><span class=s>' '</span><span class=p>,</span> <span class=n>key</span><span class=p>)</span>\u000a                <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>\u000a\u000a        <span class=n>target</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>\u000a        <span class=k>try</span><span class=p>:</span>\u000a            <span class=n>ret</span> <span class=o>=</span> <span class=n>cls</span><span class=o>.</span><span class=n>call</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>\u000a        <span class=k>except</span><span class=p>:</span>\u000a            <span class=k>print</span><span class=p>(</span><span class=s>'Error in'</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>\u000a            <span class=k>raise</span>\u000a\u000a        <span class=k>if</span> <span class=n>ret</span><span class=p>:</span>\u000a            <span class=k>print</span><span class=p>(</span><span class=s>'Error in'</span><span class=p>,</span> <span class=n>target</span><span class=p>,</span> <span class=s>'::'</span><span class=p>,</span> <span class=n>ret</span><span class=p>)</span>\u000a        <span class=k>if</span> <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>ret</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=ow>and</span> <span class=n>ret</span> <span class=ow>is</span> <span class=ow>not</span> <span class=bp>None</span><span class=p>:</span>\u000a            <span class=n>ret</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>\u000a        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span>\u000a</pre></div>\u000a</div>\u000a<p>\u306a\u305c\u304bclassmethod\u3060\u3089\u3051\u3002\u4f7f\u3044\u65b9\u306e\u308f\u304b\u308a\u3084\u3059\u3055\u512a\u5148\u3067\u5b9f\u88c5\u3057\u305f\u3089\u306a\u305c\u304b\u3053\u3093\u306a\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3057\u305f\u3002</p>\u000a<p>\u3053\u308c\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002</p>\u000a<div class=highlight-bash><pre>$ python make.py all\u000a...\u000a$ python make.py pkg\u000a...\u000adeploy package: maketest-20120406190450.tgz\u000a$</pre>\u000a</div>\u000a<p><cite>make all</cite> \u306b\u6bd4\u3079\u308b\u3068\u591a\u5c11\u5165\u529b\u6587\u5b57\u6570\u304c\u591a\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u65e2\u5b58\u306e\u624b\u9806\u3092\u7dad\u6301\u3057\u305f\u3044\u306a\u3089\u4ee5\u4e0b\u306e\u3088\u3046\u306aMakefile\u3092\u7528\u610f\u3057\u3066\u304a\u3051\u3070\u826f\u3044\u3067\u3059\u306d\u3002</p>\u000a<div class=highlight-make><pre>all:\u000a    python make.py all\u000a\u000apkg:\u000a    python make.py pkg\u000a\u000a...</pre>\u000a</div>\u000a<p>\u3042\u3068\u306f\u3001\u5148\u306e\u30b3\u30fc\u30c9\u306b\u8fd1\u3044\u8a18\u8ff0\u304c\u3067\u304d\u308b\u30c4\u30fc\u30eb(=\u81ea\u5206\u304c\u4f7f\u3044\u3084\u3059\u3044\u3068\u611f\u3058\u308b\u30c4\u30fc\u30eb)\u3092\u524d\u8ff0\u306e4\u3064\u304b\u3089\u63a2\u305b\u3070\u826f\u3044\u308f\u3051\u3067\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u306e\u76ee\u7684\u306f\u9054\u6210\u3057\u3061\u3083\u3063\u305f\u306e\u3067\u8abf\u3079\u308b\u306e\u306f\u307e\u305f\u4eca\u5ea6\u306b\u3057\u307e\u3059\u3002</p>\u000a<div id=id1 class=section>\u000a<h2>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9<a class=headerlink href=http://www.freia.jp/taka/blog/replace-makefile-with-python/index.html#id1 title=\u3053\u306e\u30d8\u30c3\u30c9\u30e9\u30a4\u30f3\u3078\u306e\u30d1\u30fc\u30de\u30ea\u30f3\u30af>¶</a></h2>\u000a<p>\u4f5c\u3063\u305f\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u304b\u3089\u53d6\u5f97\u51fa\u6765\u307e\u3059\u3002</p>\u000a<ul class=simple>\u000a<li><a class="reference external" href=https://bitbucket.org/shimizukawa/freia.jp/src/tip/site/source/blog/replace-makefile-with-python>https://bitbucket.org/shimizukawa/freia.jp/src/tip/site/source/blog/replace-makefile-with-python</a></li>\u000a</ul>\u000a</div>\u000a</div>\u000a
p9
sS'unique_id'
p10
g7
sS'title'
p11
V2012/04/11 Makefile\u3092Python\u3067\u7f6e\u304d\u63db\u3048\u308b
p12
s.